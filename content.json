{"posts":[{"title":"ç½‘ç«™è¿ç§»è¯´æ˜","text":"ç½‘ç«™è¿ç§»è¯´æ˜åšå®¢ç«™ blog.rustfisher.com å’Œæ•™ç¨‹ç«™ an.rustfisher.com çš„ç½‘ç«™èµ„æºå·²ç»ä¸Šä¼ åˆ°githubã€‚ rustfisher.github.io - github AnRFDev.github.io - github å¹¶æ‰˜ç®¡åœ¨cloudflare anrfdev-github-io.pages.dev -&gt; an.rustfisher.com rustfisher-github-io.pages.dev -&gt; blog.rustfisher.com è‹¥è®¿é—®é€Ÿåº¦è¿‡æ…¢ï¼Œå¯è€ƒè™‘ä½¿ç”¨ğŸªœ","link":"/2023/01/18/unclassified/web-res-move-2023/"},{"title":"2021å¹´11æœˆæ€»ç»“","text":"Androidæ–‡ç«  Jetpack Composeå¼•å…¥ç¤ºä¾‹å·¥ç¨‹ | AnRFDev ç°æœ‰å·¥ç¨‹ä½¿ç”¨Compose | AnRFDev Android SeekBar è‡ªå®šä¹‰thumbï¼Œthumbæ—‹è½¬åŠ¨ç”»æ•ˆæœ | AnRFDev è§†é¢‘ ã€Androidå¼€å‘åŸºç¡€ã€‘03-æ”¹é€ åˆå§‹å·¥ç¨‹ - bilibili çŸ¥ä¹è§†é¢‘ WebRTC WebRTCæ¦‚å¿µç®€ä»‹ | AnRFDev WebRTCæ‰“å¼€æœ¬åœ°æ‘„åƒå¤´ | AnRFDev WebRTCä»æ‘„åƒå¤´è·å–å›¾ç‰‡ä¼ å…¥canvas | AnRFDev WebRTCä¸CSSæ»¤é•œï¼ˆfilterï¼‰ | AnRFDev ç¤¾åŒºåä¸ºäº‘ç¤¾åŒº å¦‚ä½•å¿«é€Ÿå¾—åˆ°ä¸€ä¸ªåœ¨çº¿é—®å·åº”ç”¨ï¼Ÿï½œã€ç©è½¬åº”ç”¨é­”æ–¹ã€‘ åä¸ºäº‘è¯­éŸ³äº¤äº’å®æˆ˜ï½œã€æˆ‘ä»¬éƒ½æ˜¯åä¸ºäº‘ä¸“å®¶ã€‘ ã€äº‘é©»å…±åˆ›ã€‘åŒºå—é“¾æŠ€æœ¯æ˜¯å¦‚ä½•å½±å“å„ä¸ªäº§ä¸šçš„ï¼Ÿ","link":"/2021/11/30/Summary/2021-11/"},{"title":"WebRTCæ¦‚å¿µä»‹ç»","text":"WebRTCWebRTCï¼ˆWeb Real-Time Communicationï¼‰ã€‚Real-Time Communicationï¼Œå®æ—¶é€šè®¯ã€‚ WebRTCèƒ½è®©webåº”ç”¨å’Œç«™ç‚¹ä¹‹é—´é€‰æ‹©æ€§åœ°åˆ†äº«éŸ³è§†é¢‘æµã€‚åœ¨ä¸å®‰è£…å…¶å®ƒåº”ç”¨å’Œæ’ä»¶çš„æƒ…å†µä¸‹ï¼Œå®Œæˆç‚¹å¯¹ç‚¹é€šä¿¡ã€‚WebRTCèƒŒåçš„æŠ€æœ¯è¢«å®ç°ä¸ºä¸€ä¸ªå¼€æ”¾çš„Webæ ‡å‡†ï¼Œå¹¶åœ¨æ‰€æœ‰ä¸»è¦æµè§ˆå™¨ä¸­å‡ä»¥å¸¸è§„JavaScript APIçš„å½¢å¼æä¾›ã€‚å¯¹äºå®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚Androidå’ŒiOSï¼‰ï¼Œå¯ä»¥ä½¿ç”¨æä¾›ç›¸åŒåŠŸèƒ½çš„åº“ã€‚ WebRTCæ˜¯ä¸ªå¼€æºé¡¹ç›®ï¼Œå¾—åˆ°Googleï¼ŒAppleï¼ŒMicrosoftå’ŒMozillaç­‰ç­‰å…¬å¸çš„æ”¯æŒã€‚2011å¹´6æœˆ1æ—¥å¼€æºå¹¶åœ¨Googleã€Mozillaã€Operaæ”¯æŒä¸‹è¢«çº³å…¥ä¸‡ç»´ç½‘è”ç›Ÿçš„W3Cæ¨èæ ‡å‡†ã€‚ WebRTCåŒ…æ‹¬ä¸€ç³»åˆ—APIå’Œç›¸äº’å…³è”çš„åè®®æ¥å®ç°é€šä¿¡ã€‚ ç›¸å…³æŠ€æœ¯VoIPVoice over Internet Protocolï¼Œåœ¨ç½‘ç»œä¸Šä¼ è¾“å£°éŸ³æ¶ˆæ¯çš„æŠ€æœ¯ã€‚ä¾‹å¦‚ç½‘ç»œéŸ³é¢‘é€šè¯ã€‚æˆ–è€…å«åšIPç”µè¯ï¼Œå®½å¸¦ç”µè¯ã€‚ä½¿ç”¨VoIPæŠ€æœ¯çš„ä¸€å¤§åŸå› æ˜¯è´¹ç”¨ä½ã€‚ ç›¸å…³åè®®NATNetwork address translationï¼Œç½‘ç»œåœ°å€è½¬æ¢ã€‚NATèƒ½ç»™ä½ çš„è®¾å¤‡ä¸€ä¸ªå…¬å…±IPåœ°å€ã€‚ä¸€ä¸ªè·¯ç”±å™¨ï¼ˆrouterï¼‰æœ‰ä¸€ä¸ªå…¬å…±IPåœ°å€ï¼Œæ¯ä¸ªè¿æ¥åˆ°è·¯ç”±çš„è®¾å¤‡æœ‰ä¸€ä¸ªç§æœ‰çš„IPåœ°å€ã€‚è®¾å¤‡å‘é€è¯·æ±‚æ—¶ï¼Œä¼šä»ä¸€ä¸ªç‰¹å®šç«¯å£ï¼Œé€šè¿‡ç§æœ‰IPå‘é€åˆ°è·¯ç”±çš„å…¬å…±IPã€‚è¿™æ ·æ¯ä¸ªè®¾å¤‡åœ¨ç½‘ä¸Šä¸éœ€è¦éƒ½æœ‰ä¸€ä¸ªå…¬å…±IPåœ°å€ï¼Œä½†ä¹Ÿèƒ½è¢«å…¶å®ƒè®¾å¤‡å‘ç°ã€‚ å‚è€ƒ IP Network Address Translator (NAT) Terminology and Considerations ICEInteractive Connectivity Establishmentï¼Œäº’åŠ¨å¼è¿æ¥å»ºç«‹ï¼ˆäº¤äº’å¼è¿é€šæ€§å»ºç«‹ï¼‰ã€‚ICEæ˜¯ä¸€å¥—èƒ½è®©webæµè§ˆå™¨ä¹‹é—´äº’ç›¸è¿æ¥çš„æ¡†æ¶ã€‚é€šå¸¸æ¥è¯´ï¼ŒèŠ‚ç‚¹Aåˆ°Bæ˜¯å¾ˆéš¾ç›´æ¥ç›¸è¿çš„ã€‚é˜²ç«å¢™ä¼šé˜»æ­¢è¿æ¥ï¼Œè®¾å¤‡æ²¡æœ‰å…¬å…±IPåœ°å€ï¼Œè·¯ç”±ä¸å…è®¸ç›´æ¥è¿æ¥å…¶ä»–èŠ‚ç‚¹ã€‚ICEä½¿ç”¨STUNæˆ–è€…TURNæœåŠ¡ï¼ˆæˆ–è€…åŒæ—¶ä½¿ç”¨ä¸¤è€…ï¼‰æ¥å»ºç«‹è¿æ¥ã€‚ å‚è€ƒ ICE | rfc8445 STUNSession Traversal Utilities for NAT (STUN) ï¼ŒNATä¼šè¯ä¼ è¾“å·¥å…·ã€‚STUNåè®®èƒ½å‘ç°å®¢æˆ·ç«¯ï¼ˆèŠ‚ç‚¹ï¼‰çš„å…¬å…±åœ°å€ã€‚å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚ç»™ç½‘ä¸Šçš„STUNæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è¿”å›å®¢æˆ·ç«¯çš„å…¬å…±åœ°å€ã€‚ä¸ç®¡å®¢æˆ·ç«¯åœ¨è·¯ç”±å™¨çš„NATåèƒ½å¦å¯è¾¾ã€‚STUNä¸ºè¯·æ±‚è€…æä¾›äº†å¯å…¬å¼€è®¿é—®çš„IPåœ°å€ï¼Œå®ƒå°±ä¸å†å‚ä¸å¯¹è¯äº†ã€‚ æœ‰äº›è·¯ç”±å™¨ä¼šé™åˆ¶è®¾å¤‡ä¸å¤–é¢å…¶å®ƒè®¾å¤‡çš„è¿æ¥ã€‚è¿™æ„å‘³ç€å³ä½¿STUNæœåŠ¡å™¨çŸ¥é“äº†è·¯ç”±çš„å…¬å…±IPåœ°å€ï¼Œä¹Ÿæ²¡æ³•å»ºç«‹è¿æ¥ã€‚è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦ä½¿ç”¨TURNã€‚ TURNTraversal Using Relays around NATï¼Œä½¿ç”¨ä¸­ç»§ç»•è¿‡NATä¼ è¾“ã€‚ä¸€äº›è·¯ç”±å™¨ä½¿ç”¨ä¸€ç§å«â€œSymmetric NATâ€ï¼ˆå¯¹ç§°å‹NATï¼‰çš„é™åˆ¶ã€‚è¿™æ„å‘³ç€è·¯ç”±å™¨ä»…å…è®¸ä¹‹å‰è¿æ¥è¿‡çš„èŠ‚ç‚¹ï¼ˆpeerï¼‰æ¥å»ºç«‹è¿æ¥ã€‚ STUNæä¾›äº†ä¸€ä¸ªèƒ½è®©åº”ç”¨ï¼ˆç»ˆç«¯ï¼ŒèŠ‚ç‚¹ï¼‰ç©¿è¿‡NATçš„æ–¹æ³•ã€‚STUNå…è®¸å®¢æˆ·ç«¯è·å¾—ä¸€ä¸ªä¼ è¾“åœ°å€ï¼ˆä¸€ä¸ªIPå’Œç«¯å£ï¼‰æ¥è·å–å…¶å®ƒèŠ‚ç‚¹çš„æ•°æ®ã€‚ç„¶è€ŒSTUNè·å–åˆ°çš„åœ°å€ä¸ä¸€å®šèƒ½è¢«æ‰€æœ‰èŠ‚ç‚¹ä½¿ç”¨ã€‚è¿™äº›åœ°å€æ˜¯å¦å¯ç”¨å–å†³äºç½‘ç»œæ‹“æ‰‘çš„æƒ…å†µã€‚æ‰€ä»¥ï¼Œå•ç‹¬STUNæ— æ³•æä¾›å®Œæ•´çš„ç©¿è¶ŠNATçš„æ–¹æ¡ˆã€‚ TURNåè®®å…è®¸ä¸¤ä¸ªå¤„äºNATç¯å¢ƒçš„ä¸»æœºåˆ©ç”¨ä¸­ç»§è¿›è¡Œé€šè®¯ã€‚å®¢æˆ·ç«¯èƒ½å¤Ÿåœ¨TURNæœåŠ¡å™¨ä¸Šåˆ†é…èµ„æºï¼Œä¸å…¶å®ƒå®¢æˆ·ç«¯ï¼ˆpeerï¼‰è¿›è¡Œé€šè®¯ã€‚å®¢æˆ·ç«¯å…³è”ä¸€ä¸ªTURNæœåŠ¡å™¨çš„åœ°å€ï¼ˆrelayed server addressï¼‰æ¥ä½œä¸ºä¸­ç»§ã€‚å®¢æˆ·ç«¯å‘é€æŠ¥æ–‡ç»™TURNæœåŠ¡ï¼ŒTURNæœåŠ¡ä½¿ç”¨relayed server addressä½œä¸ºæºåœ°å€å‘å…¶ä»–å®¢æˆ·ç«¯ä¸­ç»§è½¬å‘æŠ¥æ–‡ã€‚ç©¿è¶ŠNATï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åƒæ˜¯â€œæ‰“æ´â€ã€‚ä¹Ÿæœ‰äººç§°TURNæœåŠ¡å™¨ä¸ºâ€œæ‰“æ´æœåŠ¡å™¨â€ã€‚ è¿™ä¹ˆçœ‹ï¼ŒTURNæœåŠ¡å™¨éœ€è¦æœ‰å¤§çš„å¸¦å®½ã€‚å› æ­¤ï¼ŒICEä¼šä¼˜å…ˆè€ƒè™‘ç›´æ¥é€šè®¯ï¼Œæ— æ³•ç›´æ¥é€šè®¯æƒ…å†µä¸‹ä¼šä½¿ç”¨TURNã€‚ å‚è€ƒ TURN rfc8656 SDPSession Description Protocolï¼Œä¼šè¯æè¿°åè®®ã€‚ æè¿°å¤šåª’ä½“è¿æ¥å†…å®¹çš„åè®®ã€‚ä¾‹å¦‚åˆ†è¾¨ç‡ï¼Œæ ¼å¼ï¼Œç¼–ç ï¼ŒåŠ å¯†ç®—æ³•ç­‰ç­‰ã€‚ å®é™…ä¸Šï¼ŒSDPä¸æ˜¯ä¸ªçœŸæ­£çš„åè®®ã€‚å®ƒä¹Ÿæ˜¯ç”¨æ¥æè¿°è®¾å¤‡ä¹‹é—´è¿æ¥ä¸ä¼ è¾“å¤šåª’ä½“çš„æ•°æ®æ ¼å¼ã€‚ å‚è€ƒ SDP: Session Description Protocol | rfc8866 å‚è€ƒ åª’ä½“è®¾å¤‡å…¥é—¨ ï½œ webrtc.org 2ä¸ªèŠ‚ç‚¹å»ºç«‹è¿æ¥æ—¶çš„æ²Ÿé€šè¿‡ç¨‹ ï½œ MDN WebRTC åè®®ä»‹ç» ï½œ developer.mozilla.org ä¿¡ä»¤ä¸è§†é¢‘é€šè¯ ï½œ developer.mozilla.org","link":"/2021/11/09/WebRTC/webRTC-concept-intro/"},{"title":"PythonæŠ“å–åšå®¢è®°å½•ï¼Œè·å–æ ‡é¢˜ä¸url","text":"åœ¨åšå®¢ç½‘ç«™å‘å¸ƒäº†ä¸€äº›åšå®¢ã€‚æ€»å…±æœ‰å››åå¤šç¯‡ã€‚ç°åœ¨æŸ¥çœ‹è¿™äº›åšå®¢éœ€è¦ç¿»é¡µï¼Œä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚æƒ³è¦å¼„å‡ºä¸€ä¸ªåˆ—è¡¨ï¼ŒæŠŠæ ‡é¢˜å’Œé“¾æ¥å±•ç¤ºå‡ºæ¥ã€‚å¦‚æœæ‰‹åŠ¨å»å¤åˆ¶ç²˜è´´ï¼Œè€—æ—¶è€—åŠ›ï¼Œä¹Ÿä¸å¤Ÿè‡ªåŠ¨åŒ–ã€‚æœ‰æ²¡æœ‰ä»€ä¹ˆè‡ªåŠ¨åŒ–çš„æ–¹æ³•å‘¢ï¼Ÿæƒ³åˆ°ä»¥å‰ç”¨pythonåšè¿‡æŠ“å–çš„åŠŸèƒ½ã€‚ å¼€å‘ç¯å¢ƒï¼š Python3.7 PyCharm 2018.3.7 (Community Edition) macOS 11.4 å®‰è£…scrapyæˆ‘ä»¬ä¸»è¦ä½¿ç”¨çš„æ¡†æ¶æ˜¯scrapyï¼Œå®˜ç½‘ https://scrapy.org/ å¦‚æœéœ€è¦æ¢ç”¨æ¸…åçš„pipæºï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤12pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pip -Upip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple æ ¹æ®å®˜ç½‘æ–‡æ¡£è¿›è¡Œå®‰è£…1pip3 install Scrapy åˆ†æç›®æ ‡ç½‘é¡µç›®æ ‡ç½‘é¡µçš„éƒ¨åˆ†htmlå¦‚ä¸‹12345&lt;div class=&quot;blog-menu blog-menu-noImg&quot;&gt; &lt;div class=&quot;blog-menu-header blog_no_attachment&quot;&gt; &lt;a id=&quot;portal_usercenter_2_usernew_blog_title_cus_i_0&quot; href=&quot;/blogs/301790&quot; class=&quot;common-blog-title&quot; title=&quot;Kotlinåç¨‹å–æ¶ˆä¸è¶…æ—¶&quot; target=&quot;_blank&quot; style=&quot;margin-left: 0px; color: rgb(51, 51, 51);&quot;&gt;&lt;span class=&quot;blog-title-wrap&quot; style=&quot;overflow-wrap: break-word;&quot;&gt; Kotlinåç¨‹å–æ¶ˆä¸è¶…æ—¶ &lt;/span&gt;&lt;/a&gt;&lt;/div&gt;éœ€è¦æå–çš„æ˜¯æ ‡é¢˜ï¼ˆtitleï¼‰å’Œç½‘å€ï¼ˆurlï¼‰ã€‚ shellå·¥å…·ä½¿ç”¨scrapy shellå·¥å…·æ¥åˆ†æä¸€ä¸‹ç›®æ ‡ç½‘é¡µ1scrapy shell 'https://bbs.huaweicloud.com/community/usersnew/id_1606985929124732/page_1'windowsä¸‹çš„urléœ€è¦ç”¨åŒå¼•å· å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„è¿è¡Œç»“æœ1234567891011121314152021-10-13 09:46:47 [asyncio] DEBUG: Using selector: KqueueSelector[s] Available Scrapy objects:[s] scrapy scrapy module (contains scrapy.Request, scrapy.Selector, etc)[s] crawler &lt;scrapy.crawler.Crawler object at 0x7fd889766990&gt;[s] item {}[s] request &lt;GET https://bbs.huaweicloud.com/community/usersnew/id_1606985929124732/page_1&gt;[s] response &lt;200 https://bbs.huaweicloud.com/community/usersnew/id_1606985929124732/page_1&gt;[s] settings &lt;scrapy.settings.Settings object at 0x7fd88987bb50&gt;[s] spider &lt;DefaultSpider 'default' at 0x7fd889c7b710&gt;[s] Useful shortcuts:[s] fetch(url[, redirect=True]) Fetch URL and update local objects (by default, redirects are followed)[s] fetch(req) Fetch a scrapy.Request and update local objects [s] shelp() Shell help (print this help)[s] view(response) View response in a browser2021-10-13 09:46:48 [asyncio] DEBUG: Using selector: KqueueSelector å°è¯•ç”¨scrapyçš„css()æ–¹æ³•æ¥æå–å…ƒç´ ï¼Œæ“ä½œå®ƒçš„responseå˜é‡ ä¾‹å¦‚æå–div.blog-menu1234In [2]: response.css('div.blog-menu')Out[2]: [&lt;Selector xpath=&quot;descendant-or-self::div[@class and contains(concat(' ', normalize-space(@class), ' '), ' blog-menu ')]&quot; data='&lt;div class=&quot;blog-menu blog-menu-noImg&quot;&gt;&lt;'&gt;,...å¯ä»¥å¾—åˆ°é¡µé¢ä¸Šæ‰€æœ‰æ»¡è¶³è¦æ±‚çš„å…ƒç´ ã€‚æ‹¿åˆ°çš„å…ƒç´ æ˜¯Selectorï¼Œå¯ä»¥å†è¿›è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œã€‚ ç”¨forå¾ªç¯è¯»å–æå–åˆ°çš„å…ƒç´ ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œå»æŠ“å–ä¸­æ–‡æ ‡é¢˜12345678910111213In [6]: for item in response.css('div.blog-menu'): ...: print(item.css('a.common-blog-title::attr(title)').extract()[0]) ...: Kotlinåç¨‹å–æ¶ˆä¸è¶…æ—¶Android Kotlinåç¨‹å…¥é—¨Kotlinåç¨‹åŸºç¡€Kotlinåç¨‹å…¥é—¨Android View post æ–¹æ³•Android Activity ä¼ é€’Parcelableå¯¹è±¡Android Handlerï¼ŒLooperä¸MessageQueueä½¿ç”¨ä¸åˆ†æAndroidçº¿ç¨‹æ± ä½¿ç”¨ä»‹ç»Javaçº¿ç¨‹ä»‹ç»ä½¿ç”¨EChartsç»˜åˆ¶ç½‘å€å¾„å‘æ ‘çŠ¶å›¾ a.common-blog-title::attr(title)è¡¨ç¤ºçš„æ˜¯æˆ‘ä»¬è¦æŸ¥æ‰¾&lt;a&gt;é‡Œé¢çš„å†…å®¹ï¼ŒæŒ‡å®šclassä¸ºcommon-blog-titleï¼Œå¹¶ä¸”æŸ¥æ‰¾titleå±æ€§ã€‚css().extract()å°†ç»“æœåˆ—è¡¨æå–å‡ºæ¥ã€‚æœ€åå¾—åˆ°æˆ‘ä»¬å…³å¿ƒçš„ä¿¡æ¯ã€‚ è·å–urlåŒç†ï¼ŒæŠŠæå–éƒ¨åˆ†ä¿®æ”¹ä¸º::attr(href) ä»£ç å‰é¢ç”¨shellå·¥å…·è¿›è¡Œåˆ†æï¼Œæˆ‘ä»¬äº†è§£æå–ç›®æ ‡ä¿¡æ¯çš„æ–¹æ³•ã€‚æ¥ä¸‹æ¥å†™Pythonä»£ç ã€‚ åœ¨åˆé€‚çš„åœ°æ–¹æ–°å»ºä¸€ä¸ªscrapyå·¥ç¨‹1scrapy startproject blogå¯ä»¥å¾—åˆ°ä¸€ç³»åˆ—æ–‡ä»¶123456789blog spiders .gitignore __init__.py __init__.py items.py middlewares.py pipelines.py settings.py åœ¨spidersç›®å½•é‡Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶Hw.pyï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬çš„â€œèœ˜è››â€ã€‚å®Œæ•´ä»£ç å¦‚ä¸‹ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556import jsonimport scrapydef cmp(item): return item['page']class HwBlog(scrapy.Spider): &quot;&quot;&quot; åœ¨æœ€å¤–å±‚çš„blogç›®å½•è¿›è¡Œæ“ä½œ scrapy crawl hw &quot;&quot;&quot; name = &quot;hw&quot; # scrapy crawl hw res_list = [] req_count = 0 total_url = 5 def start_requests(self): self.res_list = [] urls = [] base_url = 'https://bbs.huaweicloud.com/community/usersnew/id_1606985929124732/page_' for i in range(1, self.total_url + 1): urls.append(base_url + str(i)) for url in urls: yield scrapy.Request(url=url, callback=self.parse) def parse(self, response): self.req_count = self.req_count + 1 page = response.url.split(&quot;_&quot;)[-1] for item in response.css('div.blog-menu'): title_se = item.css(&quot;a.common-blog-title&quot;) blog_url = 'https://bbs.huaweicloud.com' + (title_se.css(&quot;::attr(href)&quot;).extract()[0]) blog_title = title_se.css(&quot;::attr(title)&quot;).extract()[0] self.res_list.append({&quot;title&quot;: blog_title, &quot;url&quot;: blog_url, &quot;page&quot;: page}) json_res = json.dumps(self.res_list, ensure_ascii=False) print(json_res) res_file_path = 'raw/hw.json' with open(res_file_path, 'w+') as f: f.write(json_res) if self.req_count &lt; self.total_url: return res_md = 'raw/hw.md' self.res_list.sort(key=cmp) # ç”¨é¡µç æ¥æ’åº with open(res_md, 'w+') as f: f.writelines('## åä¸ºäº‘ç¤¾åŒº') f.write('\\nåšå®¢æ•°é‡:' + str(len(self.res_list)) + '\\n') for d in self.res_list: f.write('\\n') f.write('- [' + d['title'] + '](' + d['url'] + ')') è¦å¯åŠ¨çš„è¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤1scrapy crawl hw æ¥ä¸‹æ¥ç®€å•çœ‹ä¸€ä¸‹ä»£ç  å˜é‡nameæ˜¯èœ˜è››çš„åå­—ã€‚æˆ‘ä»¬å¯åŠ¨çš„æ—¶å€™ä¼šç”¨åˆ°å®ƒã€‚è¿™ä¸ªåå­—ç”±æˆ‘ä»¬è‡ªå·±å®šä¹‰ã€‚ res_listæ˜¯æš‚å­˜ç»“æœçš„åˆ—è¡¨ã€‚æŠŠè·å–åˆ°çš„ç»“æœæš‚æ—¶å­˜æ”¾åœ¨é‡Œé¢ã€‚ total_urlè¡¨ç¤ºä¸€å…±è¦çˆ¬å‡ ä¸ªé¡µé¢ req_countè¡¨ç¤ºè¯·æ±‚æ¬¡æ•° start_requests(self)åœ¨è¿™ä¸ªæ–¹æ³•é‡Œè¿›è¡Œä¸€äº›é…ç½®å·¥ä½œã€‚æ¯”å¦‚é…ç½®ç›®æ ‡urlã€‚æˆ‘ä»¬æ˜¯é¢„å…ˆçŸ¥é“æœ‰5ä¸ªé¡µé¢ï¼Œæ‰€ä»¥é…ç½®äº†5ä¸ªurlã€‚ ç”¨scrapy.Request(url=url, callback=self.parse)æ„å»ºè¯·æ±‚ parseæ˜¯å›è°ƒå‡½æ•°ï¼Œè¯·æ±‚æˆåŠŸåèµ°è¿™ä¸ªæ–¹æ³•ã€‚ parse(self, response)è¯·æ±‚æˆåŠŸåï¼Œç»“æœä¿å­˜åœ¨responseä¸­ã€‚å‰é¢ç”¨shellè¿›è¡Œçš„æ“ä½œï¼Œå¯ä»¥ç›´æ¥å†™æˆpythonä»£ç ã€‚ å½“è¯·æ±‚æ¬¡æ•°è¾¾åˆ°ç›®æ ‡åï¼Œå¼€å§‹å†™æ–‡ä»¶ã€‚ å°ç»“è¿™æ˜¯Python scrapyçš„ä¸€æ¬¡ç®€å•åº”ç”¨ã€‚ å®‰è£…scrapyï¼Œåˆ†æç›®æ ‡ç½‘é¡µã€‚æŠŠè·å–åˆ°çš„æ•°æ®æ•´ç†åå†™æˆmarkdownæ–‡ä»¶ã€‚ è§†é¢‘åœ¨è¿™é‡Œ","link":"/2021/10/13/Python/scrapy-hw-blog-record/"},{"title":"2021å¹´9æœˆæ€»ç»“","text":"Androidç»™Androidç«™æ·»åŠ æ›´å¤šè‰²å½©ã€‚ä½¿ç”¨Mkdocsçš„åŠŸèƒ½ï¼Œå¢åŠ æŠ˜å åŠŸèƒ½å’ŒæŒ‰é’®ã€‚ å¢åŠ äº†ä¸€ä¸ªã€Œæœ€è¿‘æ›´æ–°ã€çš„ç•Œé¢ã€‚åœ¨mdé‡Œå†™htmlã€‚æ‰‹åŠ¨æ±‡æ€»ä¸€ä¸‹æœ€è¿‘çš„æ›´æ–°ä¿¡æ¯ã€‚ åšäº†ä¸€ä¸ªå¯¼èˆªé¡µé¢ https://an.rustfisher.com/an-tree.htmlã€‚å¼€å‘è®°å½•åœ¨è¿™é‡Œ -&gt; ä½¿ç”¨EChartsç»˜åˆ¶ç½‘å€å¾„å‘æ ‘çŠ¶å›¾ã€‚ Kotlinå…¥é—¨äº†åç¨‹ã€‚äº†è§£äº†åç¨‹çš„åŸºæœ¬æ¦‚å¿µã€‚ ç½‘ç«™ä¿®æ”¹åˆ©ç”¨mkdocsçš„æ’ä»¶ï¼Œå¢åŠ ä¸€äº›åŠŸèƒ½ã€‚ å¢åŠ å¼•ç”¨ä¸€ä¸ªmarkdownæ–‡ä»¶ï¼Œå¯ä»¥å¼•ç”¨å…¶å®ƒæ–‡ä»¶çš„å†…å®¹ã€‚ç”¨çš„æ¡†æ¶æ˜¯mkdocsï¼Œéœ€è¦åŠ å…¥æ’ä»¶ã€‚åœ¨mkdocs.ymlæ–‡ä»¶é‡ŒåŠ å…¥pluginså£°æ˜ 12345plugins: - search - macroscopyright: Copyright &amp;copy; 2020 - 2021 RustFisher æ³¨æ„å®ƒä¸copyrightåŒçº§ã€‚ ä½†æ˜¯è¿˜éœ€è¦åœ¨ç”µè„‘æœ¬åœ°å®‰è£…ä¸€ä¸‹è¿™ä¸ªmacros1pip3 install mkdocs-macros-plugin mdå¼•ç”¨å…¶ä»–æ–‡ä»¶çš„è¯­æ³•æ˜¯1{% include 'snippet.md' %} å¦‚æœè¦æŒ‡å®šè¢«å¼•ç”¨æ–‡ä»¶çš„è·¯å¾„12- macros: include_dir: include-mdæ³¨æ„include_dirå¿…é¡»å†ç¼©è¿›8ä¸ªç©ºæ ¼ å‚è€ƒ: https://www.mkdocs.org/user-guide/configuration/#configuration-inheritance https://mkdocs-macros-plugin.readthedocs.io/en/latest/#installation https://mkdocs-macros-plugin.readthedocs.io/en/latest/advanced/#including-snippets-in-pages æ€»è§ˆåŒä¸€ç¯‡æ–‡ä¼šå…ˆå‘åœ¨ğŸ”— Androidæ•™ç¨‹ç«™ï¼Œå¹¶åŒæ­¥å‘å¸ƒåˆ°å„ä¸ªç¤¾åŒºï¼Œæ›´æ–°å†…å®¹æ±‡æ€»: Androidåç¨‹åŸºç¡€ ğŸ”— Androidæ•™ç¨‹ç«™ åä¸ºäº‘ç¤¾åŒº ğŸ”— æ˜é‡‘ç¤¾åŒº ğŸ”— åšå®¢å›­ Kotlinåç¨‹å–æ¶ˆä¸è¶…æ—¶ ğŸ”— Androidæ•™ç¨‹ç«™ åä¸ºäº‘ç¤¾åŒº Kotlinåç¨‹åŸºç¡€ ğŸ”— Androidæ•™ç¨‹ç«™ åä¸ºäº‘ç¤¾åŒº ğŸ”— æ˜é‡‘ç¤¾åŒº ğŸ”— åšå®¢å›­ Kotlinåç¨‹å…¥é—¨ ğŸ”— Androidæ•™ç¨‹ç«™ åä¸ºäº‘ç¤¾åŒº ğŸ”— æ˜é‡‘ç¤¾åŒº ğŸ”— åšå®¢å›­ ğŸ”— é“¾æ»´ Android View post æ–¹æ³•è§£æ ğŸ”— Androidæ•™ç¨‹ç«™ åä¸ºäº‘ç¤¾åŒº ğŸ”— æ˜é‡‘ç¤¾åŒº ğŸ”— é“¾æ»´ ğŸ”— åšå®¢å›­ Android Activity ä¼ é€’Parcelableå¯¹è±¡ ğŸ”— Androidæ•™ç¨‹ç«™ åä¸ºäº‘ç¤¾åŒº ğŸ”— segmentfault Handlerï¼ŒLooperä¸MessageQueueä½¿ç”¨ä¸åˆ†æ ğŸ”— Androidæ•™ç¨‹ç«™ ğŸ”— åä¸ºäº‘ç¤¾åŒº Androidä½¿ç”¨çº¿ç¨‹æ± ä»‹ç» ğŸ”— Androidæ•™ç¨‹ç«™ åä¸ºäº‘ç¤¾åŒº ğŸ”— æ˜é‡‘ç¤¾åŒº ğŸ”— åšå®¢å›­ ğŸ”— é“¾æ»´ Androidå¤šçº¿ç¨‹ç»¼è¿° ğŸ”— Androidæ•™ç¨‹ç«™ Javaå¤šçº¿ç¨‹ä»‹ç» ğŸ”— Androidæ•™ç¨‹ç«™ åä¸ºäº‘ç¤¾åŒº ğŸ”— æ˜é‡‘ç¤¾åŒº ğŸ”— åšå®¢å›­ ğŸ”— é“¾æ»´ Androidåˆé›†çš„æœ€è¿‘æ›´æ–° å±•æœ›æ¯ä¸ªæœˆå¤šå†™ä¸€ç‚¹ã€‚åŠ å¼ºå¯¹ç½‘ç»œé€šä¿¡çš„å­¦ä¹ ã€‚","link":"/2021/09/30/Summary/2021-9/"},{"title":"ä½¿ç”¨EChartsç»˜åˆ¶ç½‘å€å¾„å‘æ ‘çŠ¶å›¾","text":"an.rustfisher.comæœ‰å¾ˆå¤šå†…å®¹ï¼Œå¾ˆå¤šé¡µé¢ã€‚å¦‚æœç”¨ä¸€ä¸ªæ ‘çŠ¶å›¾æŠŠæ‰€æœ‰é¡µé¢å±•ç¤ºå‡ºæ¥ä¼šæ˜¯ä»€ä¹ˆæ•ˆæœï¼Ÿç¬¬ä¸€æ—¶é—´æƒ³åˆ°äº†EChartsã€‚ æœ€åæ•ˆæœï¼š https://an.rustfisher.com/an-tree.html æ•°æ®å¤„ç†æ•°æ®æ¥æºäºé…ç½®æ–‡ä»¶ã€‚æˆ‘ä»¬åªéœ€è¦æŠŠå†…å®¹è¯»å‡ºæ¥ï¼Œæ•´ç†æˆEChartséœ€è¦çš„æ ¼å¼å¹¶ä¿å­˜ä¸ºæ–‡ä»¶ã€‚ ymlAndroidç«™ç”¨çš„æ¡†æ¶æ˜¯Mkdocsï¼Œç½‘å€éƒ½è®¾ç½®åœ¨mkdocs.ymlé‡Œã€‚å…³é”®é…ç½®å¦‚ä¸‹ 1234567nav: - Android basic: - å¼€å§‹: - æ–°å»ºå·¥ç¨‹: android/startProject/start_new_project.md - ä½¿ç”¨Kotlin: android/startProject/as-use-kotlin.md - Activity: - Activityç»¼è¿°: android/activity/overview.md æˆ‘ä»¬éœ€è¦æŠŠè¿™äº›æ•°æ®è¯»å‡ºæ¥ï¼Œå¼„æˆEChartså¯ä»¥ç”¨çš„æ ¼å¼ã€‚ æ‰“å¼€PyCharmï¼Œç”¨pythonæ¥å¤„ç†æ•°æ®ã€‚ pythonå¤„ç†æ•°æ®æˆ‘ä»¬ä½¿ç”¨3.7ç‰ˆæœ¬pythonã€‚è¦è¯»å–ymlçš„å†…å®¹ï¼Œä¸æƒ³ç”¨è¯»æ–‡æœ¬çš„æ–¹å¼ä¸€è¡Œè¡Œæ¥è¯»ï¼Œè¿˜å¾—è‡ªå·±è§£æã€‚pythonä¸­æœ‰ä¸ªåº“PyYAMLä¸“é—¨ç”¨äºè¯»å–ymlæ ¼å¼çš„æ•°æ®ã€‚ åœ¨PyCharmsé‡Œè£…ä¸Šè¿™ä¸ªåŒ…ã€‚ç”¨å®ƒæ¥è¯»å–ymlé‡Œçš„æ•°æ®ã€‚123456import yaml with open(md_file, encoding='utf8') as a_yaml_file: # è§£æyaml yaml_data = yaml.load(a_yaml_file, Loader=yaml.FullLoader) nav = yaml_data['nav'] EChartséœ€è¦çš„æ ¼å¼æ˜¯nameå’Œchildrenã€‚åŒæ—¶å¯ä»¥æ·»åŠ åˆ«çš„å­—æ®µã€‚12345678{ &quot;name&quot;: &quot;Androidæ•™ç¨‹&quot;, &quot;children&quot;: [ { &quot;name&quot;: &quot;Android basic&quot;, &quot;children&quot;: [] }]} è¯»å–åˆ°çš„æ•°æ®å±‚çº§æ¯”è¾ƒå¤šï¼Œç”¨é€’å½’æ–¹æ³•æ¥å¤„ç†å®ƒä»¬ã€‚æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½éå†ä¸€éï¼Œæ•´ç†æˆéœ€è¦çš„æ ¼å¼ã€‚ é€’å½’çš„æ—¶å€™ï¼Œé‡åˆ°æ•°ç»„ï¼Œåˆ™ç»§ç»­é€’å½’ï¼›é‡åˆ°å­—ç¬¦ä¸²ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥æ‹¼æ¥ç½‘å€äº†ã€‚ å®Œæ•´è„šæœ¬å¦‚ä¸‹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647import jsonimport osimport yamldef gen_url_map(main_site, md_file): with open(md_file, encoding='utf8') as a_yaml_file: # è§£æyaml yaml_data = yaml.load(a_yaml_file, Loader=yaml.FullLoader) nav = yaml_data['nav'] sorted_data = {&quot;name&quot;: &quot;Androidæ•™ç¨‹&quot;, &quot;children&quot;: [], &quot;collapsed&quot;: False} for big_dict in nav: load_url(main_site, big_dict, sorted_data) url_file = 'android-url-map.json' if os.path.exists(url_file): os.remove(url_file) with open(url_file, 'w') as s: s.write(str(json.dumps(sorted_data, ensure_ascii=False)))def load_url(main_site, input_dict, res_data): &quot;&quot;&quot; é€’å½’å¤„ç†æ•°æ® &quot;&quot;&quot; for k1 in input_dict: v1 = input_dict[k1] if isinstance(v1, list): item1 = {&quot;name&quot;: k1, &quot;children&quot;: []} res_data['children'].append(item1) for v1_child in v1: load_url(main_site, v1_child, item1) elif isinstance(v1, str): # æ­¤æ—¶å·²ç»æ˜¯urläº† final_item = {&quot;name&quot;: k1, &quot;url&quot;: main_site + v1[0:-3]} res_data['children'].append(final_item) return final_itemif __name__ == '__main__': print(&quot;ç”Ÿæˆandroidç«™çš„sitemap&quot;) gen_url_map('https://www.an.rustfisher.com/', '/Users/rustfisher/mkdocs.yml') æœ€åå†™ä¸€ä¸ªandroid-url-map.jsonæ–‡ä»¶ã€‚ åˆ¶ä½œç½‘é¡µç»è¿‡è§‚å¯Ÿï¼Œæˆ‘ä»¬é€‰ç”¨å¾„å‘æ ‘çŠ¶å›¾ï¼ˆtree-radialï¼‰ã€‚æŸ¥çœ‹EChartsçš„å¾„å‘æ ‘çŠ¶å›¾ä½¿ç”¨ç¤ºä¾‹ï¼Œä¸‹è½½ä¸€ä¸ªç¤ºä¾‹htmlï¼Œåœ¨å®ƒçš„åŸºç¡€ä¸Šä¿®æ”¹ã€‚ æ·»åŠ ä¸Šjqueryçš„å¼•ç”¨ã€‚1&lt;script src=&quot;https://cdn.bootcss.com/jquery/3.4.1/jquery.js&quot;&gt;&lt;/script&gt; ä¿®æ”¹è¦è¯»å–çš„jsonæ–‡ä»¶å1$.getJSON('./android-url-map.json', function (data) { /* ... */ } æŠŠå‰é¢å¾—åˆ°çš„jsonæ–‡ä»¶å’Œè¿™ä¸ªhtmlæ–‡ä»¶æ”¾åœ¨åŒä¸€å±‚çº§ï¼Œä¸Šä¼ æœåŠ¡å™¨ã€‚ æ‰“å¼€ï¼š https://an.rustfisher.com/an-tree.html å¯ä»¥çœ‹åˆ°æ•ˆæœã€‚ æ‰©å¤§æ˜¾ç¤ºèŒƒå›´è¿™ä¸ªæ—¶å€™çš„ç½‘é¡µä½“éªŒä¸æ˜¯å¾ˆå¥½ï¼Œé¡µé¢ä¸å¤Ÿå¤§ï¼Œå›¾è¡¨è¶…å‡ºä¸Šä¸‹èŒƒå›´äº†ã€‚å¯ä»¥ç»™å®ƒæ·»ä¸ªç«–ç›´çš„æ»šåŠ¨æ¡overflow-y: scrollã€‚1&lt;html style=&quot;height: 100%; width: 100%; overflow-y: scroll;&quot;&gt; ä¿®æ”¹ä¸€ä¸‹ç½‘é¡µçš„bodyã€‚å¤–å±‚çš„containerå 100%å®½é«˜ï¼Œé‡Œé¢çš„chartContainerç»™ä¸€ä¸ªmin-height: 1600pxã€‚1234&lt;body style=&quot;height: 100%; margin: 0; width: 100%;&quot;&gt; &lt;div id=&quot;container&quot; style=&quot;height: 100%; width: 100%;&quot;&gt; &lt;div id=&quot;chartContainer&quot; style=&quot;width: 100%; min-height: 1600px&quot;&gt;&lt;/div&gt; &lt;/div&gt; scripté‡ŒåŠ ä¸Šå¯¹resizeçš„ç›‘å¬12345$(window).on('resize', function () { if (myChart != null &amp;&amp; myChart != undefined) { myChart.resize(); }}); è¿™æ—¶å†çœ‹æµè§ˆå™¨çš„æ•ˆæœï¼Œå›¾è¡¨æœ‰äº†æ›´å¤šçš„ç©ºé—´æ˜¾ç¤ºã€‚ å‚è€ƒ https://stackoverflow.com/questions/33454946/echarts-and-bootstrap-responsive-width https://stackoverflow.com/questions/12575251/why-is-my-page-not-scrollable ç‚¹å‡»æ‰“å¼€é¡µé¢é»˜è®¤ç‚¹å‡»æ•ˆæœæ˜¯æŠ˜å å’Œå±•å¼€ã€‚å¯¹äºæœ€æœ«å°¾çš„å¶å­èŠ‚ç‚¹ï¼ŒåŠ ä¸€ä¸ªç‚¹å‡»äº‹ä»¶è®©å®ƒæ‰“å¼€ç›¸åº”çš„ç•Œé¢ã€‚ 12345myChart.on('click', function (params) { if (params.data &amp;&amp; params.data.url) { window.open(params.data.url); }}); æœ€åæ•ˆæœï¼š https://an.rustfisher.com/an-tree.html","link":"/2021/09/02/Web/note-echarts-py-url/"},{"title":"2021å¹´8æœˆæ€»ç»“","text":"é™¤äº†ç»§ç»­å­¦ä¹ Androidå¼€å‘ï¼Œä¹Ÿåœ¨å…¶å®ƒæ–¹é¢åšäº†ä¸€äº›æ‹“å±•å°è¯•ã€‚çœ‹äº†ä¸€äº›å…¶å®ƒçš„æŠ€æœ¯ã€‚ æŠ€æœ¯æ–‡ç« è¿™ä¸ªæœˆä¸»è¦ä»¥Androidä¸ºä¸»ã€‚å‚åŠ äº†åä¸ºäº‘ç¤¾åŒºçš„äº‘é©»å…±åˆ›æ´»åŠ¨ã€‚ çŠ¶æ€ç é€ æˆå¾®ä¿¡å…¬ä¼—å·â€œè¯¥å…¬ä¼—å·æä¾›çš„æœåŠ¡å‡ºç°æ•…éšœâ€ ã€äº‘é©»å…±åˆ›ã€‘Knativeåº”ç”¨å¼€å‘æŒ‡å— ã€äº‘é©»å…±åˆ›ã€‘åŸºäºè½¬ç§»çš„è¯­ä¹‰Parseråˆ†äº« Androidç»§ç»­å®Œå–„Androidç«™ã€‚è¿™ä¸ªæœˆçš„Androidæ–¹é¢åšå®¢/æ•™ç¨‹æ–‡ç« ä¸»è¦æ¶‰åŠåŠ¨ç”»ã€WorkManagerå’Œå¹¿æ’­ç­‰åŸºç¡€çŸ¥è¯†ã€‚ WorkManagerä½¿ç”¨å…¥é—¨ WorkManagerå·¥ä½œçº¦æŸï¼Œå»¶è¿Ÿä¸æŸ¥è¯¢å·¥ä½œ Android WorkManagerå®šæ—¶ä»»åŠ¡ ä½¿ç”¨AnimationDrawable è¡¥é—´åŠ¨ç”» ObjectAnimator æ›´æ”¹è§†å›¾ä½ç½® å¹¿æ’­æœºåˆ¶Broadcastä»‹ç»ä¸ä½¿ç”¨ å¯åŠ¨å‰å°æœåŠ¡ Viewç»¼è¿° å±•æœ›ç»§ç»­å®Œå–„Androidå†…å®¹ã€‚å°è¯•æ›´å¤šçš„æ–°æŠ€æœ¯ã€‚","link":"/2021/08/31/Summary/2021-8/"},{"title":"çŠ¶æ€ç é€ æˆå¾®ä¿¡å…¬ä¼—å·â€œè¯¥å…¬ä¼—å·æä¾›çš„æœåŠ¡å‡ºç°æ•…éšœâ€","text":"bugæè¿°æˆ‘ä»¬ä½¿ç”¨NestJSå†™åå°ä»£ç ï¼Œç»™å¾®ä¿¡å…¬ä¼—å·æä¾›æœåŠ¡ã€‚ç”¨æˆ·ç»™å…¬ä¼—å·å‘æ¶ˆæ¯æ—¶ï¼Œå…¬ä¼—å·ä¼šæ˜¾ç¤ºâ€œè¯¥å…¬ä¼—å·æä¾›çš„æœåŠ¡å‡ºç°æ•…éšœâ€ã€‚è™½ç„¶åå°ä»£ç å¯ä»¥æ­£å¸¸å¤„ç†ä¸šåŠ¡ï¼Œä½†è¿™ä¸ªæç¤ºéå¸¸å½±å“ç”¨æˆ·ä½“éªŒã€‚ æ£€æŸ¥æ ¹æ®å¾®ä¿¡å…¬ä¼—å·æ–‡æ¡£ç»™çš„æç¤ºï¼Œå‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯æ²¡æœ‰ç»™å¾®ä¿¡æœåŠ¡å™¨è¿”å›æ­£ç¡®çš„ä¿¡æ¯ã€‚ å¾®ä¿¡æœåŠ¡å™¨éœ€è¦çš„æ˜¯successæˆ–è€…ç©ºçš„å­—ç¬¦ä¸²ã€‚ä¸èƒ½æ˜¯jsonæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚æœäº†ä¸€ä¸‹å…¶ä»–æ–‡ç« ï¼Œæœ‰çš„è¯´xmlé‡Œä¹Ÿä¸èƒ½å¸¦æœ‰ç©ºæ ¼ï¼›æœ‰çš„è¯´å…¬ä¼—å·ç»‘å®šäº†ç¬¬ä¸‰æ–¹å¹³å°ï¼Œè¦å»è§£ç»‘ã€‚ä½†è¿™äº›å’Œæˆ‘ä»¬çš„æƒ…å†µä¸ä¸€è‡´ã€‚ ç»™å…¬ä¼—å·çš„æ¥å£æ˜¯é»˜è®¤è¿”å›successçš„ã€‚ æŸ¥çœ‹è¿è¡Œlogï¼Œå‘ç°ç”¨æˆ·å‘é€1æ¡æ¶ˆæ¯ç»™å…¬ä¼—å·ï¼Œæˆ‘ä»¬çš„æœåŠ¡ç«¯ä¼šæ”¶åˆ°4æ¡ä¸€æ¨¡ä¸€æ ·çš„æ¶ˆæ¯ã€‚è¿™4æ¡æ¶ˆæ¯çš„MsgIdæ˜¯ä¸€æ ·çš„ã€‚ç½‘ä¸Šä¹Ÿæœ‰äººæä¾›äº†é˜²æ­¢é‡å¤æ¶ˆæ¯çš„åŠæ³•ã€‚ äºæ˜¯å°è¯•ä»¥ä¸‹æ–¹æ³• ç»´æŠ¤ä¸€ä¸ªmapï¼Œkeyæ˜¯MsgIdã€‚ æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå¦‚æœå‘ç°æ˜¯é‡å¤çš„MsgIdï¼Œåˆ™ç«‹åˆ»è¿”å›successï¼ˆæˆ–è€…ç©ºå­—ç¬¦ä¸²ï¼‰ã€‚ ä½†æ˜¯é—®é¢˜ä¾æ—§æ²¡æœ‰è§£å†³ã€‚ å¾®ä¿¡æœåŠ¡å™¨è®¤ä¸ºå®ƒæ²¡æœ‰æ‹¿åˆ°æ­£ç¡®çš„è¿”å›å€¼ï¼Œäºæ˜¯èµ°äº†é‡è¯•çš„æµç¨‹ã€‚æˆ‘ä»¬ubuntuæœåŠ¡å™¨ä¸Šä½¿ç”¨äº†nginxï¼Œäºæ˜¯æˆ‘ä»¬æŸ¥çœ‹nginxçš„log123481.69.1.1 - - [03/Aug/2021:09:41:25 +0800] &quot;POST /mywxserve/?signature=sign1111&amp;timestamp=1627954885&amp;nonce=1832145745&amp;openid=qqq HTTP/1.1&quot; 201 0 &quot;-&quot; &quot;Mozilla/4.0&quot;81.69.1.1 - - [03/Aug/2021:09:41:26 +0800] &quot;POST /mywxserve/?signature=sign1111&amp;timestamp=1627954885&amp;nonce=1832145745&amp;openid=qqq HTTP/1.1&quot; 201 7 &quot;-&quot; &quot;Mozilla/4.0&quot;81.69.1.1 - - [03/Aug/2021:09:41:26 +0800] &quot;POST /mywxserve/?signature=sign1111&amp;timestamp=1627954885&amp;nonce=1832145745&amp;openid=qqq HTTP/1.1&quot; 201 7 &quot;-&quot; &quot;Mozilla/4.0&quot;42.192.1.1 - - [03/Aug/2021:09:41:26 +0800] &quot;POST /mywxserve/?signature=sign1111&amp;timestamp=1627954885&amp;nonce=1832145745&amp;openid=qqq HTTP/1.1&quot; 201 7 &quot;-&quot; &quot;Mozilla/4.0&quot;å¯ä»¥çœ‹åˆ°æœ‰2ä¸ªipåœ°å€ï¼Œå‘æ¥äº†3+1æ¬¡è¯·æ±‚ã€‚çœ‹åˆ°nginxè¿”å›çš„çŠ¶æ€ç éƒ½æ˜¯201ã€‚(ipåœ°å€å’Œä¿¡æ¯æ¨¡ç³Šå¤„ç†) çŠ¶æ€ç 201è¡¨ç¤ºâ€œå·²åˆ›å»ºâ€ã€‚NestJSé»˜è®¤çŠ¶æ€ç æ˜¯200ï¼Œä½†æ˜¯é»˜è®¤POSTçš„çŠ¶æ€ç æ˜¯201ã€‚ ä¿®å¤æˆ‘ä»¬å¼ºåˆ¶è®©nestjsè¿”å›çŠ¶æ€ç 200123@HttpCode(200)@Post()async onWxEvent(@Body('xml') xmlData: IWxMessageXmlData): Promise&lt;string&gt; {} å†å°è¯•ä¸€ä¸‹ï¼Œçœ‹åˆ°nginxçš„logï¼Œè¿”å›çŠ¶æ€ç æ˜¯200äº†ã€‚å…¬ä¼—å·ä¹Ÿæ­£å¸¸äº†ã€‚181.69.1.1 - - [03/Aug/2021:09:53:27 +0800] &quot;POST /mywxserve/?signature=rustfisher&amp;timestamp=1627955607&amp;nonce=1829147547&amp;openid=xxx0 HTTP/1.1&quot; 200 0 &quot;-&quot; &quot;Mozilla/4.0&quot; ç”±æ­¤å¯è§ï¼Œæ¥æ”¶å¾®ä¿¡å…¬ä¼—å·æ¶ˆæ¯çš„æ—¶å€™ï¼Œé™¤äº†è¦è¿”å›ç©ºå­—ç¬¦ä¸²æˆ–è€…successæ–‡æœ¬ï¼›è¿”å›çŠ¶æ€ç å¿…é¡»æ˜¯200ã€‚ç”¨å…¶ä»–çš„åå°æ¡†æ¶å¯èƒ½ä¸ä¼šé‡åˆ°çŠ¶æ€ç é—®é¢˜ã€‚ å‚è€ƒ wxåŸºç¡€æ¶ˆæ¯èƒ½åŠ›-è¢«åŠ¨å›å¤ç”¨æˆ·æ¶ˆæ¯ https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Passive_user_reply_message.html NestJS controller https://docs.nestjs.com/controllers#status-code NestJSæ–‡ç« é›†åˆ https://rustfisher.com/categories/NestJS/ httpçŠ¶æ€ç  https://rustfisher.com/2021/06/25/Network/http-code/","link":"/2021/08/03/NestJS/mp-wx-http-status-code/"},{"title":"NestJS WebSocket å¼€å§‹ä½¿ç”¨","text":"ä½¿ç”¨NestJsæä¾›WebSocketæœåŠ¡ã€‚æœ¬æ–‡ä¼šåœ¨æ–°å»ºé¡¹ç›®çš„åŸºç¡€ä¸Šå¢åŠ 2ä¸ªç±» Gateway å®ç°ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹ WebSocketAdapter WebSocketé€‚é…å™¨ æ–°å»ºé¡¹ç›®æ–°å»ºä¸€ä¸ªé¡¹ç›®æ¥æ¼”ç¤ºï¼Œç”¨npmæ¥ç®¡ç†é¡¹ç›®ã€‚1nest new websocket-start å¾—åˆ°ä¸€ä¸ªæœ‰åŸºç¡€åŠŸèƒ½çš„å·¥ç¨‹ã€‚ è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œå®‰è£…2ä¸ªåº“1npm i --save @nestjs/websockets @nestjs/platform-socket.io å¯åŠ¨ä½¿ç”¨ç«¯å£30011await app.listen(3001);npm run startå¯åŠ¨æˆ‘ä»¬çš„å·¥ç¨‹ã€‚ç”¨postmanæµ‹ä¸€ä¸‹ï¼ŒåŠŸèƒ½okã€‚ gatewayä»‹ç»Nesté‡Œçš„gateway(ç½‘å…³)åªæ˜¯ä¸€ä¸ªç”¨ @WebSocketGateway() è£…é¥°å™¨æ³¨é‡Šçš„ç±»ã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼Œç½‘å…³ä¸å¹³å°æ— å…³ï¼Œåœ¨åˆ›å»ºé€‚é…å™¨åå®ƒä»¬ä¸ä»»ä½• WebSockets åº“éƒ½å…¼å®¹ã€‚ æ–°å»ºGatewayæ–°å»ºws.gateway.tsæ–‡ä»¶ã€‚åœ¨è£…é¥°å™¨@WebSocketGateway()é‡Œç«¯å£æŒ‡å®šä¸º3002ã€‚123456789101112131415import { ConnectedSocket, MessageBody, SubscribeMessage, WebSocketGateway } from &quot;@nestjs/websockets&quot;;import * as WebSocket from 'ws';@WebSocketGateway(3002)export class WsStartGateway { @SubscribeMessage('hello') hello(@MessageBody() data: any): any { return { &quot;event&quot;: &quot;hello&quot;, &quot;data&quot;: data, &quot;msg&quot;: 'rustfisher.com' }; }}é‡Œé¢æœ‰ä¸€ä¸ªhelloæ–¹æ³•ï¼Œè®¢é˜…çš„æ¶ˆæ¯æ˜¯'hello'ã€‚ æŠŠå®ƒæ”¾è¿›AppModuleçš„providersé‡Œã€‚1providers: [WsStartGateway], å¦‚æœwebsocktå’Œhttpç”¨äº†åŒä¸€ä¸ªæ¥å£(æœ¬ä¾‹æ˜¯3001)ï¼Œå¯åŠ¨æ—¶ä¼šæŠ¥é”™1Error: listen EADDRINUSE: address already in use :::3001å› æ­¤æˆ‘ä»¬è¿™é‡Œç»™wsåˆ†é…å¦ä¸€ä¸ªç«¯å£å·ã€‚ è·å–WebSocketå¯¹è±¡åœ¨WsStartGatewayé‡Œæ–°å¢åŠ ä¸€ä¸ªæ¶ˆæ¯è®¢é˜…æ–¹æ³•ã€‚æ–¹æ³•é‡Œæ¥å—@ConnectedSocket() client: WebSocketï¼Œè¿™ä¸ªclientå°±æ˜¯ä¸å®¢æˆ·ç«¯çš„è¿æ¥å¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥ç»™å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚123456@SubscribeMessage('hello2')hello2(@MessageBody() data: any, @ConnectedSocket() client: WebSocket): any { console.log('æ”¶åˆ°æ¶ˆæ¯ client:', client); client.send(JSON.stringify({ event: 'tmp', data: 'è¿™é‡Œæ˜¯ä¸ªä¸´æ—¶ä¿¡æ¯' })); return { event: 'hello2', data: data };} è‡ªå®šä¹‰WebSocketAdapterå‰é¢æˆ‘ä»¬å»ºç«‹å¥½äº†Gatewayï¼Œè¿˜éœ€è¦ä¸€ä¸ªé€‚é…å™¨ã€‚æ–°å»ºæ–‡ä»¶ws.adapter.tsï¼Œç»§æ‰¿WebSocketAdapter1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162import * as WebSocket from 'ws';import { WebSocketAdapter, INestApplicationContext } from '@nestjs/common';import { MessageMappingProperties } from '@nestjs/websockets';import { Observable, fromEvent, EMPTY } from 'rxjs';import { mergeMap, filter } from 'rxjs/operators';export class WsAdapter implements WebSocketAdapter { constructor(private app: INestApplicationContext) { } create(port: number, options: any = {}): any { console.log('ws create') return new WebSocket.Server({ port, ...options }); } bindClientConnect(server, callback: Function) { console.log('ws bindClientConnect, server:\\n', server); server.on('connection', callback); } bindMessageHandlers( client: WebSocket, handlers: MessageMappingProperties[], process: (data: any) =&gt; Observable&lt;any&gt;, ) { console.log('[waAdapter]æœ‰æ–°çš„è¿æ¥è¿›æ¥') fromEvent(client, 'message') .pipe( mergeMap(data =&gt; this.bindMessageHandler(client, data, handlers, process)), filter(result =&gt; result), ) .subscribe(response =&gt; client.send(JSON.stringify(response))); } bindMessageHandler( client: WebSocket, buffer, handlers: MessageMappingProperties[], process: (data: any) =&gt; Observable&lt;any&gt;, ): Observable&lt;any&gt; { let message = null; try { message = JSON.parse(buffer.data); } catch (error) { console.log('wsè§£æjsonå‡ºé”™', error); return EMPTY; } const messageHandler = handlers.find( handler =&gt; handler.message === message.event, ); if (!messageHandler) { return EMPTY; } return process(messageHandler.callback(message.data)); } close(server) { console.log('ws server close'); server.close(); }}åœ¨bindMessageHandleræ–¹æ³•ä¸­ï¼Œä¼šå°†ä¼ æ¥çš„jsonæ¶ˆæ¯è§£æï¼Œç„¶åå‘é€åˆ°å¯¹åº”çš„å¤„ç†å™¨ä¸­ã€‚è¿™é‡Œå°±æ˜¯å‘ç»™gatewayè¿›è¡Œå¤„ç†ã€‚åˆ¤æ–­ä¾æ®æ˜¯message.eventï¼Œå°±æ˜¯eventå­—æ®µã€‚ åœ¨main.tsé‡Œä½¿ç”¨è¿™ä¸ªé€‚é…å™¨ã€‚12345678910import { NestFactory } from '@nestjs/core';import { AppModule } from './app.module';import { WsAdapter } from './ws/ws.adapter';async function bootstrap() { const app = await NestFactory.create(AppModule); app.useWebSocketAdapter(new WsAdapter(app)); // ä½¿ç”¨æˆ‘ä»¬çš„é€‚é…å™¨ await app.listen(3001);}bootstrap(); npm run startè¿è¡Œé¡¹ç›®ï¼Œå‡†å¤‡è¿›ä¸€æ­¥æµ‹è¯•ã€‚ ç”¨Postmanæ¥æµ‹è¯•WebSocketPostman8.8.0æä¾›äº†betaç‰ˆçš„WebSocketæµ‹è¯•åŠŸèƒ½ã€‚New -&gt; WebSocket Request betaæ–°å»ºä¸€ä¸ªWebSocketæµ‹è¯•ã€‚å½“å‰ç‰ˆæœ¬è¿˜ä¸æ”¯æŒä¿å­˜wsçš„æµ‹è¯•ä¾‹å­ã€‚è¾“å…¥ç›®æ ‡url ws://localhost:3002ï¼Œç‚¹å‡»è¿æ¥ Connect æŒ‰é’®ã€‚ å‘é€æµ‹è¯•æ¶ˆæ¯ã€‚åœ¨æ¶ˆæ¯æ¡†é‡Œå¡«å…¥ä»¥ä¸‹jsonæ•°æ®ã€‚1234{ &quot;event&quot; : &quot;hello&quot;, &quot;data&quot; : &quot;æµ‹è¯•æ•°æ®&quot;} å‘é€çš„æ•°æ®ç»è¿‡WsAdapteråˆ†å‘ç»™WsStartGatewayï¼Œå¤„ç†åè¿”å›æ•°æ®ã€‚ å‘é€hello2æµ‹è¯•æ•°æ®1234{ &quot;event&quot; : &quot;hello2&quot;, &quot;data&quot; : &quot;æµ‹è¯•æ•°æ®&quot;} å¯ä»¥çœ‹åˆ°æœåŠ¡è¿”å›äº†2æ¡æ•°æ®ã€‚ å‘é€ä¸€ä¸ªé”™è¯¯æ ¼å¼çš„æ•°æ®12{ &quot;event&quot; : &quot;hello2 æœåŠ¡ç«¯æ¥æ”¶åˆ°äº†æ•°æ®ï¼Œä½†æ˜¯è§£æå¤±è´¥1wsè§£æjsonå‡ºé”™ SyntaxError: Unexpected end of JSON input å°ç»“è¦ä½¿ç”¨WebSocketåŠŸèƒ½ï¼Œéœ€è¦å¢åŠ  Gateway å®ç°ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹ WebSocketAdapter WebSocketé€‚é…å™¨ wsçš„ç«¯å£å»ºè®®æ˜¯å’Œhttpçš„ç«¯å£åˆ†å¼€ã€‚ å‚è€ƒ NestJS WebSockets https://docs.nestjs.com/websockets/gateways NestJS åˆé›† https://rustfisher.com/categories/NestJS/ ç¤ºä¾‹å·¥ç¨‹ https://gitee.com/rustfisher/nest-sample","link":"/2021/07/22/NestJS/nestjs-websocket-start/"},{"title":"Pythonå›¾è¡¨åº“Matplotlib ç»„æˆéƒ¨åˆ†ä»‹ç»","text":"å›¾è¡¨æœ‰å¾ˆå¤šä¸ªç»„æˆéƒ¨åˆ†ï¼Œä¾‹å¦‚æ ‡é¢˜ã€x/yè½´åç§°ã€å¤§åˆ»åº¦å°åˆ»åº¦ã€çº¿æ¡ã€æ•°æ®ç‚¹ã€æ³¨é‡Šè¯´æ˜ç­‰ç­‰ã€‚ æˆ‘ä»¬æ¥çœ‹å®˜æ–¹ç»™çš„å›¾ï¼Œå›¾ä¸­æ ‡å‡ºäº†å„ä¸ªéƒ¨åˆ†çš„è‹±æ–‡åç§° Matplotlibæä¾›äº†å¾ˆå¤šapiï¼Œå¼€å‘è€…å¯æ ¹æ®éœ€æ±‚å®šåˆ¶å›¾è¡¨çš„æ ·å¼ã€‚å‰é¢æˆ‘ä»¬è®¾ç½®äº†æ ‡é¢˜å’Œx/yè½´çš„åç§°ï¼Œæœ¬æ–‡ä»‹ç»æ›´å¤šè®¾ç½®å…¶ä»–éƒ¨åˆ†çš„æ–¹æ³•ã€‚ ç»˜å›¾å…ˆç»˜åˆ¶ä¸€ä¸ªäº‹ä¾‹å›¾ã€‚ç„¶åä»¥æ­¤ä¸ºåŸºç¡€è¿›è¡Œå®šåˆ¶ã€‚123456789101112131415161718def demo2(): x_list = [] y_list = [] for i in range(0, 365): x_list.append(i) y_list.append(math.sin(i * 0.1)) ax = plt.gca() ax.set_title('rustfisher.com mapplotlib example') ax.set_xlabel('x') ax.set_ylabel('y = sin(x)') ax.grid() plt.plot(x_list, y_list) plt.show()if __name__ == '__main__': print('rustfisher å›¾è¡¨è®²è§£') demo2()è¿è¡Œå¾—åˆ° çº¢è‰²æ¡†æ¡†é‡Œçš„æ˜¯figureï¼›ç»¿è‰²æ¡†æ¡†é‡Œçš„å«åšaxã€‚ä»£ç ä¸­ax = plt.gca()è·å–åˆ°çš„å°±æ˜¯ç»¿è‰²æ¡†æ¡†é‡Œçš„éƒ¨åˆ†ï¼ˆå¯¹è±¡ï¼‰ã€‚ Figure å¤§å›¾Figureä»£è¡¨æ•´å¼ å›¾ï¼Œæš‚æ—¶ç§°ä¸ºâ€œå…¨å›¾â€æˆ–è€…â€œå¤§å›¾â€ã€‚ä¸€å¼ å›¾é‡Œå¯ä»¥æœ‰å¤šä¸ªå­å›¾è¡¨ã€‚æœ€å°‘å¿…é¡»è¦æœ‰ä¸€ä¸ªå›¾è¡¨ã€‚åƒä¸Šé¢é‚£æ ·ã€‚ Axes æ•°æ®å›¾ä¸€å¼ å¼ çš„å›¾ï¼Œå›¾é‡Œæ˜¾ç¤ºç€æ•°æ®ï¼Œæš‚ç§°ä¸ºâ€œæ•°æ®å›¾â€ã€‚ä¸€ä¸ªå¤§å›¾é‡Œå¯ä»¥æœ‰å¤šä¸ªæ•°æ®å›¾ã€‚ä½†å•ä¸ªæ•°æ®å›¾å¯¹è±¡åªèƒ½åœ¨1ä¸ªå¤§å›¾é‡Œã€‚ å¤šå¼ æ•°æ®å›¾ subplotsä¾‹å¦‚åŒæ—¶å­˜åœ¨2ä¸ªæ•°æ®å›¾ 123456789101112131415161718def demo_subplot(): x_list = [] y_list = [] y2_list = [] for i in range(0, 365): x_list.append(i) y_list.append(math.sin(i * 0.1)) y2_list.append(math.cos(i * 0.1)) fig, (ax1, ax2) = plt.subplots(2) ax1.set_title('rustfisher.com 1') ax2.set_title('rustfisher.com 2') ax1.set_xlabel('x') ax1.set_ylabel('y = sin(x)') ax2.set_xlabel('x') ax2.set_ylabel('y = cos(x)') ax1.plot(x_list, y_list) ax2.plot(x_list, y2_list) plt.show() è°ƒç”¨subplots()æ¥å£ï¼Œä¼ å…¥æ•°å­—æŒ‡å®šè¦å¤šå°‘å¼ æ•°æ®å›¾ã€‚è¿”å›çš„å¤šå¼ å›¾è¦ç”¨æ‹¬å·æ‹¬èµ·æ¥ã€‚æ¯ä¸ªæ•°æ®å›¾å¯ä»¥ç»˜åˆ¶(plot)ä¸åŒçš„æ•°æ®ã€‚æ ‡é¢˜ç”¨set_title()æ¥è®¾ç½®ã€‚ å¯ä»¥çœ‹åˆ°ä¸Šä¸‹ä¸¤å¼ å›¾å¤ªæŒ¤äº†ï¼Œæœ‰é‡å éƒ¨åˆ†ã€‚å¯ä»¥åœ¨plt.show()ä¹‹å‰åŠ ä¸€ä¸ªfig.tight_layout()è®©å®ƒä»¬æ‹‰å¼€ä¸€ç‚¹è·ç¦»ã€‚ åæ ‡è½´å¯¹äº2ç»´æ•°æ®å›¾ï¼Œå®ƒæœ‰2ä¸ªåæ ‡ï¼Œæ¨ªåæ ‡å’Œçºµåæ ‡ã€‚æœ‰ä¸€äº›æ¥å£å¯ä»¥è®¾ç½®å‚æ•°ã€‚ä¾‹å¦‚æ§åˆ¶åæ ‡è½´çš„åå­—set_xlabel() set_ylabelï¼› æ˜¾ç¤ºæ•°æ®èŒƒå›´set_xlimæ–¹æ³•å¯ä»¥æ§åˆ¶xè½´æ•°æ®æ˜¾ç¤ºèŒƒå›´ã€‚åŒç†yè½´ç”¨set_ylimæ¥æ§åˆ¶ã€‚å¯¹äºæ˜¾ç¤ºèŒƒå›´ï¼Œset_xlimæ–¹æ³•ä¸»è¦å‚æ•°ä¸ºleftå’Œrightï¼›æˆ–è€…ç”¨xmin xmaxã€‚è¿™ä¸¤å¥—ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚set_ylimä¸»è¦å‚æ•°æ˜¯top bottomï¼›æˆ–è€…ymin ymaxã€‚è¿™ä¸¤å¥—ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚ å¢åŠ æ˜¾ç¤ºèŒƒå›´æ§åˆ¶çš„ä»£ç 1234567891011121314151617181920212223242526def demo3(): x_list = [] y_list = [] y2_list = [] for i in range(0, 365): x_list.append(i) y_list.append(math.sin(i * 0.1)) y2_list.append(math.cos(i * 0.1)) fig, (ax1, ax2) = plt.subplots(2) ax1.set_title('rustfisher.com 1') ax1.set_xlabel('x') ax1.set_ylabel('y = sin(x)') ax2.set_title('rustfisher.com 2') ax2.set_xlabel('x') ax2.set_ylabel('y = cos(x)') ax1.set_xlim(left=50, right=200.6) # æ§åˆ¶xè½´æ˜¾ç¤ºèŒƒå›´ ax1.set_ylim(top=1, bottom=0.3) # æ§åˆ¶yè½´æ˜¾ç¤ºèŒƒå›´ ax2.set_xlim(xmin=1, xmax=156.6) # æ§åˆ¶xè½´æ˜¾ç¤ºèŒƒå›´ ax2.set_ylim(ymin=-0.3, ymax=0.3) # æ§åˆ¶yè½´æ˜¾ç¤ºèŒƒå›´ ax1.plot(x_list, y_list) ax2.plot(x_list, y2_list) fig.tight_layout() plt.show() è¿è¡Œç»“æœ åˆ»åº¦tickæ„æ€æ˜¯æ ‡è®°ã€‚åœ¨åæ ‡è½´ä¸Šçš„æ˜¯åˆ»åº¦ã€‚Major tickæš‚ç§°ä¸ºå¤§åˆ»åº¦ï¼Œminor tickæš‚ç§°ä¸ºå°åˆ»åº¦ã€‚ä½¿ç”¨set_xticksæ–¹æ³•æ§åˆ¶åˆ»åº¦æ˜¾ç¤ºã€‚ä¼ å…¥çš„åˆ—è¡¨æ˜¯æˆ‘ä»¬å¸Œæœ›æ˜¾ç¤ºçš„åˆ»åº¦ã€‚minorå‚æ•°é»˜è®¤ä¸ºFalseï¼Œä¸æ˜¾ç¤ºå°åˆ»åº¦ã€‚ å…³é”®ä»£ç å¦‚ä¸‹1234567ax1.set_xticks([50, 60, 70, 150])ax1.set_yticks([0.1, 0.2, 0.3, 0.7, 0.9])ax1.grid() # æ˜¾ç¤ºæ ¼å­ax2.set_xticks([1, 60, 70, 150], minor=True)ax2.set_yticks([-0.1, 0, 0.1, 0.3], minor=True)ax2.grid() å¯è§å½“minor=Trueï¼Œä¼ å…¥çš„åˆ»åº¦åˆ—è¡¨æœ‰å¯èƒ½ä¸æ˜¾ç¤ºã€‚ ä¹Ÿå¯ä»¥æ§åˆ¶å¤§åˆ»åº¦ä¸Šçš„æ–‡å­—æ—‹è½¬12plt.setp(ax1.xaxis.get_majorticklabels(), rotation=-45)plt.setp(ax2.xaxis.get_majorticklabels(), rotation=-60) è¾¹çº¿ spinespineæ˜¯è„ŠæŸ±çš„æ„æ€ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆç§°ä¸ºè¾¹çº¿ã€‚æœ‰ä¸Šä¸‹å·¦å³4æ¡è¾¹çº¿ã€‚åç§°æ˜¯top bottom left rightå¯ä»¥ç›´æ¥ä»å›¾è¡¨å¯¹è±¡è·å–å®ƒçš„è¾¹çº¿ï¼Œæ¯”å¦‚å³è¾¹çº¿ax1.spines.rightã€‚ ä¸€äº›ç®€å•çš„æ“ä½œï¼Œä¾‹å¦‚ set_visible æ˜¾ç¤ºå’Œéšè— set_ticks_position åˆ»åº¦æ˜¾ç¤ºçš„ä½ç½® set_bounds è¾¹çº¿æ˜¾ç¤ºèŒƒå›´ set_linewidth çº¿çš„å®½åº¦ éšè—å³è¾¹çº¿å’Œä¸Šè¾¹çº¿12ax1.spines.right.set_visible(False)ax1.spines.top.set_visible(False) è®©åˆ»åº¦æ˜¾ç¤ºåœ¨å³è¾¹å’Œä¸Šæ–¹12ax2.yaxis.set_ticks_position('right')ax2.xaxis.set_ticks_position('top') è®¾ç½®è¾¹çº¿æ˜¾ç¤ºèŒƒå›´12ax3.spines.left.set_bounds(-0.5, 0.5)ax3.spines.top.set_bounds(340, 400) è®¾ç½®çº¿çš„å®½åº¦1ax3.spines.bottom.set_linewidth(2) å®Œæ•´ä»£ç å¦‚ä¸‹123456789101112131415161718192021222324252627282930313233import mathimport matplotlib.pyplot as pltdef demo_spine(): x_list = [] y_list = [] for i in range(0, 365): x_list.append(i) y_list.append(math.sin(i * 0.1)) fig, (ax1, ax2, ax3) = plt.subplots(3) ax_list = [ax1, ax2, ax3] for i in range(0, 3): cur_ax = ax_list[i] cur_ax.set_title('rustfisher.com ' + str(i)) cur_ax.plot(x_list, y_list) cur_ax.set_xlabel('x') cur_ax.set_ylabel('y = sin(x)') ax1.spines.right.set_visible(False) ax1.spines.top.set_visible(False) ax2.spines.bottom.set_visible(False) ax2.spines.left.set_visible(False) ax2.yaxis.set_ticks_position('right') ax2.xaxis.set_ticks_position('top') ax3.spines.left.set_bounds(-0.5, 0.5) ax3.spines.top.set_bounds(340, 400) ax3.spines.bottom.set_linewidth(2) fig.tight_layout() plt.show() è¿è¡Œæˆªå›¾ æ•°æ®ç‚¹æ§åˆ¶æ•°æ®ç‚¹çš„æ ·å¼ã€‚ä¸‹é¢æˆ‘ä»¬åœ¨ä¸€å¼ å›¾è¡¨é‡Œç»˜åˆ¶å¤šæ¡æ•°æ®çº¿ã€‚ 123456789101112131415def demo_line(): x_list = [] y_list = [] y2_list = [] y3_list = [] for i in range(0, 20): x_list.append(i) y_list.append(math.sin(i) * 2 - 4) y2_list.append(math.sin(i) * 2) y3_list.append(math.cos(i) * 1.3 + 3) plt.plot(x_list, y_list, color='blue', linestyle='-.', linewidth=2, markersize=4) plt.plot(x_list, y2_list, 'go', linewidth=1) plt.plot(x_list, y3_list, 'r+') plt.show() plot()æ–¹æ³•ä¸­ï¼Œæ”¯æŒå¤šç§é€‰é¡¹ã€‚ linestyleæ”¯æŒçš„é€‰é¡¹â€˜-â€˜, â€˜â€“â€™, â€˜-.â€™, â€˜:â€™, â€˜Noneâ€™, â€˜ â€˜, â€˜â€™, â€˜solidâ€™, â€˜dashedâ€™, â€˜dashdotâ€™, â€˜dottedâ€™ æ³¨é‡Š legendæ·»åŠ æ³¨é‡Šï¼Œè°ƒç”¨lengend()æ–¹æ³•ã€‚ åœ¨å‰é¢ä»£ç åŸºç¡€ä¸Šæ·»åŠ 1234plt.plot(x_list, y_list, color='blue', linestyle='-.', linewidth=2, markersize=4)plt.plot(x_list, y2_list, 'go', linewidth=1)plt.plot(x_list, y3_list, 'r+')plt.legend(['math.sin(i) * 2 - 4', 'math.sin(i) * 2', 'math.cos(i) * 1.3 + 3']) æ§åˆ¶æ³¨é‡Šæ˜¾ç¤ºçš„åœ°æ–¹ï¼Œæ·»åŠ bbox_to_anchorå’Œbbox_transformå±æ€§12plt.legend(['math.sin(i) * 2 - 4', 'math.sin(i) * 2', 'math.cos(i) * 1.3 + 3'], bbox_to_anchor=(1, 1), bbox_transform=plt.gcf().transFigure) ä¸­æ–‡ä¹±ç é—®é¢˜åœ¨è®¾ç½®æ ‡é¢˜ç”¨åˆ°ä¸­æ–‡çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°ä¹±ç ã€‚å¯ä»¥è®¾ç½®rcParamsçš„å­—ä½“ï¼Œè§£å†³ä¹±ç é—®é¢˜ã€‚1plt.rcParams['font.sans-serif'] = ['Arial Unicode MS'] è‡³æ­¤ï¼Œæˆ‘ä»¬æŠŠå›¾è¡¨ä¸­å„ä¸ªéƒ¨åˆ†éƒ½ç®€è¦ä»‹ç»äº†ä¸€ä¸‹ã€‚ å‚è€ƒæœ¬ä¾‹ç¯å¢ƒ macOS PyCharm CE Python3 å‚è€ƒèµ„æ–™ ã€è¿è¥çš„PythonæŒ‡å—ã€‘ç»˜åˆ¶å›¾è¡¨Matplotlibå¿«é€Ÿå…¥é—¨ https://rustfisher.com/2021/07/16/Python/operation/matplotlib-intro1 Pythonç¬”è®° https://rustfisher.com/categories/Python/ matplotlib https://matplotlib.org/","link":"/2021/07/20/Python/operation/matplotlib-intro-parts/"},{"title":"ã€è¿è¥çš„PythonæŒ‡å—ã€‘ç»˜åˆ¶å›¾è¡¨Matplotlibå¿«é€Ÿå…¥é—¨","text":"ç»˜åˆ¶å›¾è¡¨æ˜¯è¿è¥å·¥ä½œä¸­å¸¸è§çš„éœ€æ±‚ã€‚å‰é¢æˆ‘ä»¬è¯•ç€ç”¨Pythonæ“ä½œExcelæ¥ç»˜åˆ¶å›¾è¡¨ï¼Œå…¶å®è°ƒç”¨çš„æ˜¯Excelé‡Œçš„å›¾è¡¨åŠŸèƒ½ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åˆ©ç”¨Matplotlibæ¥ç»˜åˆ¶å›¾è¡¨ã€‚ Matplotlib æ˜¯ä¸€ä¸ªç»¼åˆæ€§çš„åº“ã€‚å®ƒæ˜¯ Python çš„å¯è§†åŒ–å·¥å…·ï¼Œå¯åˆ›å»ºé™æ€ã€å¸¦åŠ¨ç”»å’Œå¯äº¤äº’çš„å›¾è¡¨Matplotlib å®˜ç½‘ https://matplotlib.org/å®˜æ–¹ä½¿ç”¨æ‰‹å†Œ https://matplotlib.org/stable/users/index.html å®‰è£…å®˜æ–¹ç»™å‡ºçš„å®‰è£…æ–¹æ³•æ˜¯ä½¿ç”¨pip12python -m pip install -U pippython -m pip install -U matplotlib æˆ‘ä»¬ä½¿ç”¨PyCharmï¼Œä¹Ÿå¯ä»¥å…ˆæ‰“1import matplotlib.pyplot as pltå…¶ä¸­matplotlibä¸‹é¢æœ‰çº¢çº¿ï¼Œè·Ÿç€PyCharmçš„æç¤ºï¼ŒæŠŠç¼ºå¤±çš„åŒ…è£…ä¸Šå°±å¥½ã€‚ ç®€å•ä¾‹å­-ç»˜åˆ¶æŠ˜çº¿å›¾æ¥ä¸‹æ¥ä½¿ç”¨matplotlibç»˜åˆ¶ä¸€ä¸ªç®€å•çš„æŠ˜çº¿å›¾ï¼Œå…ˆæŠŠè¿™ä¸ªåº“ç”¨èµ·æ¥ã€‚ å‡†å¤‡æ•°æ®æˆ‘ä»¬ç”¨math.sinæ¥æ¨¡æ‹Ÿã€‚xä»0åˆ°100ï¼Œy=sin(x)ã€‚ä¸€ä¸ªç®€å•çš„sinå‡½æ•°ã€‚ ç»˜åˆ¶å‡†å¤‡æ•°æ®ï¼Œç„¶åç»˜åˆ¶å‡ºå›¾è¡¨ã€‚å®Œæ•´ä»£ç å¦‚ä¸‹12345678910111213141516import mathimport matplotlib.pyplot as pltdef demo1(): x_list = [] y_list = [] for i in range(0, 100): x_list.append(i) y_list.append(math.sin(i * 0.1)) plt.plot(x_list, y_list) plt.show()if __name__ == '__main__': print('rustfisher ç»˜åˆ¶æŠ˜çº¿å›¾äº‹ä¾‹1') demo1() Macçš„PyCharmè¿è¡Œä¸‹èƒ½å¾—åˆ°è¿™æ ·çš„å›¾ ä»£ç ä¸­ plt.plot(x_list, y_list)æŒ‡å®šxï¼Œyå€¼ï¼Œéƒ½æ˜¯åˆ—è¡¨ã€‚è¿™2ä¸ªåˆ—è¡¨çš„é•¿åº¦è¦ç›¸ç­‰ã€‚ plt.show()æ˜¯ç›´æ¥ç»˜åˆ¶å›¾è¡¨ã€‚ å¯ä»¥çœ‹åˆ°å›¾ä¸­ç¼ºå°‘å¾ˆå¤šå…ƒç´ ã€‚å›¾çš„æ ‡é¢˜æ²¡æœ‰æŒ‡å®šï¼Œxè½´å’Œyè½´éƒ½æ²¡æœ‰è¯´æ˜ã€‚ å¢åŠ ä¸€äº›ç»†èŠ‚ä¸ºæ“ä½œå›¾è¡¨ï¼Œæˆ‘ä»¬éœ€æ‹¿åˆ°å›¾è¡¨å¯¹è±¡ax = plt.gca()12345ax = plt.gca()ax.set_title('rustfisher.com mapplotlib example')ax.set_xlabel('x')ax.set_ylabel('y = sin(x)')ax.grid() set_title è®¾ç½®å›¾è¡¨æ ‡é¢˜ set_xlabel è®¾ç½®xè½´åç§° set_ylabel è®¾ç½®yè½´åç§° grid() æ˜¾ç¤ºæ ¼å­ ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹12345678910111213def demo1(): x_list = [] y_list = [] for i in range(0, 100): x_list.append(i) y_list.append(math.sin(i * 0.1)) ax = plt.gca() ax.set_title('rustfisher.com mapplotlib example') ax.set_xlabel('x') ax.set_ylabel('y = sin(x)') ax.grid() plt.plot(x_list, y_list) plt.show() è¿è¡Œç»“æœ æ“ä½œè¯´æ˜ä»å‰é¢å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹é¢æœ‰ä¸€æ’æŒ‰é’®ã€‚è¿™äº›æŒ‰é’®æä¾›äº†ä¸€äº›æ“ä½œå›¾è¡¨çš„åŠŸèƒ½ã€‚ä»å·¦åˆ°å³æˆ‘ä»¬æ’ä¸ªåº1ï¼Œ2ï¼Œ3ï¼Œ4.. è®©å›¾è¡¨æ¢å¤åˆ°åˆå§‹çŠ¶æ€ ä¸Šä¸€ä¸ªå›¾è¡¨çŠ¶æ€ ä¸‹ä¸€ä¸ªå›¾è¡¨çŠ¶æ€ ç§»åŠ¨å›¾è¡¨ ç¼©æ”¾å›¾è¡¨ è°ƒæ•´å›¾è¡¨æ˜¾ç¤ºçš„ä½ç½® ç‚¹å‡»ç¼©æ”¾æŒ‰é’®åï¼Œé¼ æ ‡æŒ‰ä½å·¦é”®å»æ¡†é€‰ä¸€ä¸ªåŒºåŸŸï¼Œæ¾å¼€å·¦é”®åå°±æ˜¯æ”¾å¤§é‚£ä¸ªåŒºåŸŸã€‚ æŒ‰ä½å³é”®å†æ¡†é€‰ï¼Œåˆ™æ˜¯ç¼©å°æ˜¾ç¤ºåŒºåŸŸã€‚ ä¿å­˜å›¾ç‰‡ ç›´æ¥ä¿å­˜å¦‚æœæˆ‘ä»¬æƒ³ç›´æ¥ä¿å­˜å¾—åˆ°çš„å›¾ç‰‡ï¼Œå¯ä»¥ä¸è°ƒç”¨showæ–¹æ³•ã€‚è€Œæ˜¯è°ƒç”¨savefig()æ–¹æ³•ã€‚ 12# plt.show()plt.savefig('out.png') å‚è€ƒ Pythonæ“ä½œExcelæ¥ç»˜åˆ¶å›¾è¡¨ https://rustfisher.com/2019/11/19/Python/Python-op-excel_openpyxl_bar_column_chart/ Pythonç»˜åˆ¶æ¼æ–—å›¾ https://rustfisher.com/2021/06/28/Python/Python-op-draw-funnel-1/ Pythonåˆé›† https://rustfisher.com/categories/Python/","link":"/2021/07/16/Python/operation/matplotlib-intro1/"},{"title":"NestJS é™æ€æ–‡ä»¶","text":"ä¸ºäº†æä¾›é™æ€èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨@nestjs/serve-staticåŒ…é‡Œçš„ServeStaticModuleã€‚æœåŠ¡å™¨ä¸Šçš„é™æ€èµ„æºï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯æ–‡ä»¶ï¼Œæ¯”å¦‚å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ã€æ–‡æœ¬æ–‡ä»¶æˆ–è€…äºŒè¿›åˆ¶æ–‡ä»¶ç­‰ç­‰ã€‚ æˆ–è€…æ˜¯ä¸€äº›å•é¡µé¢åº”ç”¨ç¨‹åº(Single Page Application, SPA)ã€‚ä»æœåŠ¡å™¨ä¸Šè¯·æ±‚å¾—åˆ°ç½‘é¡µï¼Œç„¶åç½‘é¡µå†æ‰§è¡Œè‡ªå·±çš„ä¸šåŠ¡ã€‚ å®‰è£…é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…@nestjs/serve-staticåŒ…ã€‚åœ¨å·¥ç¨‹è·¯å¾„ä¸‹1$ npm install --save @nestjs/serve-static å®‰è£…å®Œæˆåï¼Œå·¥ç¨‹çš„package.jsoné‡Œä¼šå¤šå‡º123&quot;dependencies&quot;: { &quot;@nestjs/serve-static&quot;: &quot;^2.1.4&quot;,} ä½¿ç”¨åœ¨root AppModuleä¸­ï¼Œå¼•å…¥ServeStaticModuleæ¨¡å—ã€‚ 12345678910import { ServeStaticModule } from '@nestjs/serve-static';@Module({ imports: [ ServeStaticModule.forRoot({ rootPath: join(__dirname, '..', 'rustfisherData'), exclude: ['/api*'], }),],})export class AppModule { } importsé‡Œæ·»åŠ äº†ServeStaticModuleæ¨¡å—ã€‚éœ€è¦ç”¨åˆ°ServeStaticModule.forRootæ–¹æ³•ã€‚ rootPath æŒ‡å®šäº†é™æ€æ–‡ä»¶çš„æ ¹ç›®å½• exclude è¡¨æ˜æ’é™¤åœ¨å¤–çš„æ–‡ä»¶å’Œç›®å½• è·¯å¾„è¯´æ˜æˆ‘ä»¬å…³å¿ƒçš„æ˜¯ï¼ŒæœåŠ¡å™¨ä¸Šå“ªä¸ªç›®å½•å¯ä»¥è®©å®¢æˆ·ç«¯è®¿é—®ï¼Œå“ªä¸ªç›®å½•æ˜¯ä¸å¼€æ”¾çš„ã€‚ __dirname è·å–åˆ°çš„æ˜¯å½“å‰ç›®å½•çš„è·¯å¾„ã€‚ä½¿ç”¨join()æ–¹æ³•ï¼Œæ‹¼æ¥å‡ºä¸€ä¸ªæ–°çš„è·¯å¾„ã€‚ å·¥ç¨‹ç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶æ”¾åœ¨distç›®å½•ä¸­ã€‚app.module.jsæ–‡ä»¶ä¹Ÿåœ¨é‡Œé¢ã€‚æ­¤æ—¶__dirnameè¡¨ç¤ºçš„æ˜¯distç›®å½•çš„è·¯å¾„ã€‚é‚£ä¹ˆjoin(__dirname, '..', 'rustfisherData')å¾—åˆ°çš„è·¯å¾„å°±æ˜¯ä¸distç›®å½•åŒçº§çš„rustfisherDataã€‚ å‡è®¾æˆ‘ä»¬æœåŠ¡å™¨ä¸Šè¿è¡Œç›®å½•æ˜¯/home/rustfisher/server/rf-server-nest/disté‚£ä¹ˆé™æ€æ–‡ä»¶å­˜æ”¾çš„ç›®å½•å°±æ˜¯/home/rustfisher/server/rf-server-nest/rustfisherData é…ç½®ServeStaticModuleæä¾›äº†ä¸°å¯Œçš„è‡ªå®šä¹‰æ§åˆ¶ã€‚å¼€å‘è€…å¯ä»¥è‡ªå®šä¹‰å®ƒçš„è¡Œä¸ºã€‚æ¯”å¦‚åƒå‰é¢é‚£æ ·è®¾ç½®é™æ€æ–‡ä»¶æ ¹ç›®å½•rootPathï¼›è®¾ç½®æ’é™¤çš„è·¯å¾„excludeã€‚ GitHubä¸Šæœ‰è¯¦ç»†é…ç½® æ³¨æ„è®¿é—®ç›®å½•æ—¶ï¼Œé»˜è®¤ä¼šæ‰¾index.htmlæ–‡ä»¶å‘é€å›å»ã€‚åæ–‡ä¼šæœ‰æ›´å¤šè¯´æ˜ã€‚ å®¢æˆ·ç«¯è®¿é—®å‡è®¾æœåŠ¡éƒ¨ç½²å¥½äº†ï¼ˆå¹¶ä¸æ˜¯çœŸå®é¡¹ç›®ï¼‰ï¼Œç½‘å€æ˜¯ https://rustfisher.com ã€‚éƒ¨ç½²å¥½æœåŠ¡åï¼Œæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ã€‚ æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®urlï¼š https://rustfisher.com/some/path/to/img/11.jpgå¯ä»¥åœ¨ç½‘é¡µä¸Šçœ‹åˆ°å›¾ç‰‡ï¼ˆå¹¶ä¸æ˜¯çœŸå®é¡¹ç›®ï¼‰ã€‚ å¦‚æœè®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯å¾„ï¼ˆæ–‡ä»¶ï¼‰ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªé»˜è®¤çš„index.htmlã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œåˆ™ä¼šæŠ¥ä¸€ä¸ªENOENTé”™è¯¯ä¿¡æ¯12[Nest] 32378 - 07/10/2021, 8:15:00 PM [ExceptionsHandler] ENOENT: no such file or directory, stat '/home/rustfisher/server/rf-server-nest/rustfisherData/index.html' +234539ms ä¸æƒ³è®©å®ƒæŠ¥è¿™ä¸ªé”™ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å¼„ä¸€ä¸ªindex.htmlæ–‡ä»¶æ”¾åˆ°å¯¹åº”è·¯å¾„ä¸Šã€‚è¿™æ ·åšçš„è¯ï¼Œè®¿é—®ç›®å½•æˆ–è€…ä¸å­˜åœ¨çš„æ–‡ä»¶ä¼šé»˜è®¤è¿”å›index.htmlæ–‡ä»¶ã€‚ å°ç»“æä¾›è®¿é—®é™æ€æ–‡ä»¶çš„åŠŸèƒ½æ¯”è¾ƒå¸¸è§ã€‚å®¢æˆ·ç«¯ä½¿ç”¨ä¸€ä¸ªurlï¼Œå°±èƒ½è®¿é—®æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚ç°åœ¨å¾ˆå¸¸è§çš„åšæ³•æ˜¯æŠŠæ–‡ä»¶æ”¾åœ¨CDNä¸Šï¼Œå‡è½»æœåŠ¡å™¨çš„ioå‹åŠ›å’Œç½‘ç»œå‹åŠ›ã€‚åœ¨LinuxæœåŠ¡å™¨ä¸Šï¼Œnginxå’ŒåŒç±»çš„æœåŠ¡ä¹Ÿèƒ½è½»æ¾å®ç°ç±»ä¼¼çš„æä¾›é™æ€æ–‡ä»¶çš„åŠŸèƒ½ã€‚","link":"/2021/07/10/NestJS/nestjs-static-file/"},{"title":"MongoDBå®‰è£…å’Œéƒ¨ç½²","text":"MongoDBçš„ç‰ˆæœ¬å¯ä»¥åœ¨å®˜ç½‘ https://docs.mongodb.com/manual/installation/ ä¸ŠæŸ¥è¯¢ã€‚ æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ç¤¾åŒºç‰ˆã€‚ macç›®å‰ç”¨macæ¥å¼€å‘ï¼Œéœ€è¦åœ¨æœ¬åœ°å®‰è£…è¿è¡Œä¸€ä¸ªmongdbï¼Œä¾¿äºæµ‹è¯•è°ƒè¯•ã€‚ å®‰è£…macä¸Šå®‰è£…mongodbã€‚åœ¨ç»ˆç«¯ä¸­ç”¨brewæ¥å®‰è£…é€Ÿåº¦æœ‰ç‚¹å¤ªæ…¢äº†ã€‚ æˆ‘ä»¬å» https://www.mongodb.com/try/download/enterprise ä¸‹è½½ä¸€ä¸ªmacä½¿ç”¨çš„ç‰ˆæœ¬ã€‚åœ¨ç½‘é¡µå³ä¾§é€‰æ‹©mongodbç‰ˆæœ¬ï¼ˆè¿™é‡Œé€‰çš„æ˜¯4.4.4ï¼‰ï¼ŒPlatformé€‰æ‹©macOSï¼Œå‹ç¼©æ ¼å¼é€‰tgzå³å¯ã€‚ç‚¹å‡»Downloadéœ€è¦å¡«ä¸€äº›èµ„æ–™ã€‚å¡«å¥½åç¡®è®¤Submitå³å¯ã€‚ä¸‹è½½åè§£å‹æ–‡ä»¶ï¼Œå¾—åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚ 1234567891011121314151617181920mongodb-macos-x86_64-enterprise-4.4.6â”œâ”€â”€ LICENSE-Enterprise.txtâ”œâ”€â”€ MPL-2â”œâ”€â”€ READMEâ”œâ”€â”€ THIRD-PARTY-NOTICESâ”œâ”€â”€ binâ”‚ â”œâ”€â”€ install_compassâ”‚ â”œâ”€â”€ mongoâ”‚ â”œâ”€â”€ mongocryptdâ”‚ â”œâ”€â”€ mongodâ”‚ â”œâ”€â”€ mongodecryptâ”‚ â”œâ”€â”€ mongokerberosâ”‚ â”œâ”€â”€ mongoldapâ”‚ â””â”€â”€ mongosâ””â”€â”€ snmp â”œâ”€â”€ MONGOD-MIB.txt â”œâ”€â”€ MONGODBINC-MIB.txt â”œâ”€â”€ README-snmp.txt â”œâ”€â”€ mongod.conf.master â””â”€â”€ mongod.conf.subagent æˆ‘ä»¬å°†è¿™ä¸ªç›®å½•å¤åˆ¶åˆ°/usr/local/mongoä¸­ï¼Œéœ€è¦ç”¨åˆ°ç®¡ç†å‘˜æƒé™ã€‚ ä¿®æ”¹~/.bash_profileï¼Œæ·»åŠ å¦‚ä¸‹å‘½ä»¤ã€‚å³mongoçš„ç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­12# mongo dbexport PATH=$PATH:/usr/local/mongo/bin æ­¤æ—¶å¯ä»¥é‡å¯å‘½ä»¤è¡Œï¼ˆç»ˆç«¯ï¼‰ã€‚ æ£€æŸ¥ç‰ˆæœ¬mongod --version123456789101112~ $ mongod --versiondb version v4.4.4Build Info: { &quot;version&quot;: &quot;4.4.4&quot;, &quot;gitVersion&quot;: &quot;8db30a63db1a9d84bdcad0c83369623f708e0397&quot;, &quot;modules&quot;: [], &quot;allocator&quot;: &quot;system&quot;, &quot;environment&quot;: { &quot;distarch&quot;: &quot;x86_64&quot;, &quot;target_arch&quot;: &quot;x86_64&quot; }}èƒ½çœ‹åˆ°ç‰ˆæœ¬è¯´æ˜mongodbå®‰è£…å®Œæˆã€‚ å¯åŠ¨Macä¸Šå¯åŠ¨ã€‚æˆ‘ä»¬å¯ä»¥æŒ‡å®šæ•°æ®åº“è·¯å¾„--dbpathå’Œlogä½ç½®--logpath1sudo mongod --dbpath /Users/rustfisher/.mongodb/data --logpath /Users/rustfisher/.mongodb/log/mongodb1.log å¦‚æœä¸ç”¨sudoï¼Œå¯èƒ½ä¼šæŠ¥é”™1ERROR: child process failed, exited with 14 åå°å¯åŠ¨ï¼Œéœ€è¦åŠ ä¸Š--fork1234$ sudo mongod --dbpath /Users/rustfisher/.mongodb/data --logpath /Users/rustfisher/.mongodb/log/mongodb1.log --port 1993 --forkabout to fork child process, waiting until server is ready for connections.forked process: 7580child process started successfully, parent exiting æŸ¥è¯¢mongoè¿›ç¨‹123$ ps aux | grep mongrustfisher 7608 0.0 0.0 4268424 732 s003 S+ 7:45ä¸‹åˆ 0:00.00 grep mongroot 7580 0.0 0.2 5548488 27868 ?? S 7:44ä¸‹åˆ 0:01.02 mongod --dbpath /Users/rustfisher/.mongodb/data --logpath /Users/rustfisher/.mongodb/log/mongodb1.log --fork Ubuntuæˆ‘ä»¬çš„æœåŠ¡å™¨ä¸€èˆ¬æ˜¯Linuxã€‚æ¥ä¸‹æ¥åœ¨Ubuntuä¸Šå®‰è£…è¿è¡Œmongodbã€‚ å®‰è£…Ubuntuä¸Šå®‰è£…mongodbæ¯”è¾ƒç®€å•ï¼Œç”¨apt-getå‘½ä»¤ã€‚ å…ˆupadateä¸€æ¬¡1sudo apt-get update ç„¶åè£…ä¸Š4.4.4ç‰ˆæœ¬çš„mongodb1sudo apt-get install -y mongodb-org=4.4.4 mongodb-org-server=4.4.4 mongodb-org-shell=4.4.4 mongodb-org-mongos=4.4.4 mongodb-org-tools=4.4.4 ç­‰å®ƒè£…å®Œåï¼Œçœ‹ä¸€ä¸‹ç‰ˆæœ¬å·1234567891011121314~$ mongod --versiondb version v4.4.4Build Info: { &quot;version&quot;: &quot;4.4.4&quot;, &quot;gitVersion&quot;: &quot;8db30a63db1a9d84bdcad0c83369623f708e0397&quot;, &quot;openSSLVersion&quot;: &quot;OpenSSL 1.0.2g 1 Mar 2016&quot;, &quot;modules&quot;: [], &quot;allocator&quot;: &quot;tcmalloc&quot;, &quot;environment&quot;: { &quot;distmod&quot;: &quot;ubuntu1604&quot;, &quot;distarch&quot;: &quot;x86_64&quot;, &quot;target_arch&quot;: &quot;x86_64&quot; }}å¯ä»¥å‘ç°ï¼Œè¿™é‡Œçš„gitVersionå’Œå‰é¢ç”¨macè£…çš„æ˜¯ä¸€æ ·çš„ã€‚ä¸€äº›å…³äºLinuxçš„æ“ä½œç¬”è®°ï¼Œå¯ä»¥è®¿é—® https://rustfisher.com/tags/Linux/ è¿è¡ŒUbuntuæ“ä½œmongodbçš„å®˜æ–¹æ–‡æ¡£ é»˜è®¤çš„é…ç½®æ–‡ä»¶ä¸º /etc/mongod.conf æŠŠç«¯å£æ”¹ä¸º1993ï¼ŒæœåŠ¡å™¨å¦‚æœå¯ç”¨äº†é˜²ç«å¢™ï¼Œè®°å¾—å…è®¸1993ç«¯å£1sudo ufw allow 1993æˆ–è€…åœ¨äº‘æœåŠ¡å™¨æ§åˆ¶å°é‚£é‡Œæ£€æŸ¥ä¸€äº›ï¼Œæ˜¯å¦å¼€æ”¾äº†ç«¯å£ æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯systemctl å¯åŠ¨mongodb1sudo systemctl start mongod æŸ¥çœ‹çŠ¶æ€1sudo systemctl status mongod é‡å¯1sudo systemctl restart mongod MongoDB Compassså‰é¢æˆ‘ä»¬å·²ç»å®‰è£…å¥½äº†mongodbï¼Œå¹¶ä¸”è¿è¡Œèµ·æ¥äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ‰¾ä¸€ä¸ªæœ‰å›¾å½¢åŒ–ç•Œé¢çš„è½¯ä»¶æ¥è®¿é—®æ•°æ®åº“ã€‚ MongoDB Compassèƒ½è®©ç”¨æˆ·æ¸…æ™°åœ°çœ‹åˆ°æ–‡æ¡£ç»“æ„ï¼Œæ‰§è¡ŒæŸ¥è¯¢ï¼Œä¿®æ”¹ç­‰ç­‰æ“ä½œã€‚ åœ¨è¿™é‡Œå¯ä»¥ä¸‹è½½MongoDB Compasss https://www.mongodb.com/try/download/compassè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨macä¸‹çš„1.25.0ç‰ˆæœ¬ã€‚ è¿æ¥åˆ°æœ¬åœ°çš„æ•°æ®åº“ï¼Œåœ¨Compassä¸­é€‰æ‹©æ–°å»ºè¿æ¥1mongodb://127.0.0.1:1993/rustfisher-db?readPreference=primary&amp;appname=MongoDB%20Compass&amp;ssl=falseå‰é¢æˆ‘ä»¬å¯åŠ¨mongodbæ˜¯åœ¨1993ç«¯å£ï¼Œè¿æ¥çš„æ—¶å€™è¦æ³¨æ„ç«¯å£å·ã€‚ 127.0.0.1æ˜¯æˆ‘ä»¬æœ¬åœ°çš„ipï¼Œå¦‚æœè¦è¿æ¥åˆ°æœåŠ¡å™¨çš„mongodbï¼Œä¸€èˆ¬å¯ä»¥ç›´æ¥ç”¨æœåŠ¡å™¨ipæ¥è¿æ¥ã€‚ ä¾‹å¦‚æœåŠ¡å™¨å…¬ç½‘ipæ˜¯1.2.3.4ï¼Œç«¯å£æ˜¯19931mongodb://1.2.3.4:1993/rustfisher-db?readPreference=primary&amp;appname=MongoDB%20Compass&amp;ssl=false è¿ä¸Šmongodbåï¼Œå°±å¯ä»¥è‡ªç”±åœ°è¿›è¡Œæ“ä½œäº†ã€‚","link":"/2021/07/09/MongoDB/mongodb-install-deploy/"},{"title":"ã€è¿è¥çš„PythonæŒ‡å—ã€‘ç»˜åˆ¶æ¼æ–—å›¾","text":"å†™ç»™è¿è¥æœ‹å‹çš„PythonæŒ‡å—ã€‚ æ¼æ–—å›¾å¯å¯¹ä¸šåŠ¡çš„å„ä¸ªå…³é”®ç¯èŠ‚è¿›è¡Œæè¿°ï¼Œè¡¡é‡å„ä¸ªç¯èŠ‚çš„ä¸šåŠ¡è¡¨ç°ã€‚å¯ä»¥éå¸¸ç›´è§‚åœ°çœ‹åˆ°å„ä¸ªä¸šåŠ¡åœ°è½¬åŒ–ç¨‹åº¦ã€‚ æœ¬æ–‡ä»‹ç»ä½¿ç”¨Pythonä»Excelä¸­è¯»å–æ•°æ®ï¼Œä½¿ç”¨pyechartsç»˜åˆ¶æ¼æ–—å›¾ã€‚ æ“ä½œæ­¥éª¤è¯´æ˜ä¸‹é¢æ˜¯æ“ä½œçš„å…·ä½“æ­¥éª¤ã€‚ 1.å¼€å‘ç¯å¢ƒç¤ºä¾‹ä½¿ç”¨çš„IDEæ˜¯PyCharmç¤¾åŒºç‰ˆï¼Œå¼€å‘è¯­è¨€æ˜¯Python3.xã€‚ åœ¨å·¥ç¨‹ä¸­ï¼Œæ–°å»ºPythonæ–‡ä»¶demo_data_funnel.pyã€‚ç„¶ååœ¨åŒçº§çš„ä½ç½®æ–°å»ºä¸€ä¸ªresæ–‡ä»¶å¤¹ï¼Œåé¢ç”¨æ¥å­˜æ”¾æ–‡ä»¶ã€‚ 2.å‡†å¤‡æ•°æ®åˆ›å»ºä¸€ä¸ªExcelæ–‡ä»¶äº‹ä»¶demo.xlsxã€‚å°†è¡¨åæ”¹ä¸ºdata3ã€‚è¿™ä¸ªåå­—åœ¨ä»£ç ä¸­ä¼šç”¨åˆ°ã€‚ å†™å…¥ä¸¤åˆ—æ•°æ®123456äº‹ä»¶ æ¬¡æ•°e1 10000e2 4695e3 2584e4 1295e5 954å¾—åˆ°å¦‚ä¸‹çš„è¡¨æ ¼ï¼š ä¸demo_data_funnel.pyåŒçº§çš„åœ°æ–¹æ–°å»ºäº†resæ–‡ä»¶å¤¹ï¼ŒæŠŠExcelæ–‡ä»¶æ”¾è¿›å»ã€‚ è¿™é‡Œæˆ‘ä»¬æš‚æ—¶ç”¨æµ‹è¯•æ•°æ®çœ‹æ•ˆæœã€‚åé¢å†å¡«å…¥ä½ çš„çœŸå®æ•°æ®ã€‚ 3.ç¼–å†™è„šæœ¬ç°åœ¨å¼€å§‹å†™Pythonä»£ç ã€‚demo_data_funnel.pyå®Œæ•´çš„ä»£ç å¦‚ä¸‹12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273from openpyxl import load_workbookfrom pyecharts.charts import Funnelimport pyecharts.options as optsdef read_in_data(file_path): print('è·å–åŸå§‹æ•°æ® &gt;&gt;&gt;') wb = load_workbook(file_path) st = wb['data3'] data_list = [] for row_index in range(2, st.max_row + 1): event_name = st.cell(row=row_index, column=1).value event_value = st.cell(row=row_index, column=2).value data_list.append([event_name, event_value]) print(data_list) return data_listdef draw_funnel_default(input_data): print('ç»˜åˆ¶æ¼æ–—å›¾ &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base') ( Funnel(init_opts=opts.InitOpts(width=&quot;800px&quot;, height=&quot;400px&quot;)) .add(series_name='æ¼æ–—1', data_pair=input_data, ) .set_global_opts(title_opts=opts.TitleOpts(title=&quot;æ¼æ–—å›¾1&quot;, subtitle=&quot;é»˜è®¤æ ·å¼&quot;)) .render(&quot;funnel_chart_1.html&quot;) )def draw_funnel_2(input_data): print('ç»˜åˆ¶æ¼æ–—å›¾1 &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base') ( Funnel(init_opts=opts.InitOpts(width=&quot;1000px&quot;, height=&quot;600px&quot;)) .add(series_name='æ¼æ–—1', data_pair=input_data, label_opts=opts.LabelOpts(position=&quot;inside&quot;, formatter='{b} æ•°é‡: {c}'), gap=2, tooltip_opts=opts.TooltipOpts(trigger=&quot;item&quot;, formatter=&quot;{a} &lt;br/&gt;{b} æ•°é‡: {c}&quot;), ) .set_global_opts(title_opts=opts.TitleOpts(title=&quot;æ¼æ–—å›¾1&quot;, subtitle=&quot;æ”¹å˜äº†label&quot;)) .render(&quot;funnel_chart_2.html&quot;) )def draw_funnel_3(input_data): print('ç»˜åˆ¶æ¼æ–—å›¾2 &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base') data = input_data.copy() # å¤åˆ¶ä¸€ä»½å‡ºæ¥å¤„ç†æ ‡é¢˜ base_value = data[0][1] for x in range(0, len(data)): event_name = data[x][0] value = data[x][1] # æ‹¿åˆ°æ•°å€¼ ratio = value / base_value event_name += '\\næ€»ä½“è½¬åŒ–ç‡: {:.2f}%'.format(ratio * 100) if x &gt; 0: event_name += '\\nç›¸å¯¹è½¬åŒ–ç‡: {:.2f}%'.format(100 * value / data[x - 1][1]) data[x][0] = event_name print(event_name) ( Funnel(init_opts=opts.InitOpts(width=&quot;1000px&quot;, height=&quot;800px&quot;)) .add(series_name='æ¼æ–—1', data_pair=data, label_opts=opts.LabelOpts(position=&quot;inside&quot;, formatter='{b}\\næ•°é‡: {c}'), gap=2, tooltip_opts=opts.TooltipOpts(trigger=&quot;item&quot;, formatter=&quot;{a} &lt;br/&gt;{b} æ•°é‡: {c}&quot;), ) .set_global_opts(title_opts=opts.TitleOpts(title=&quot;æ¼æ–—å›¾1&quot;, subtitle=&quot;ä¿®æ”¹äº†å„é¡¹çš„æ ‡é¢˜&quot;)) .render(&quot;funnel_chart_3.html&quot;) )if __name__ == '__main__': src_data = read_in_data('res/äº‹ä»¶demo.xlsx') draw_funnel_default(src_data) draw_funnel_2(src_data) draw_funnel_3(src_data)æŠŠä¸Šé¢çš„ä»£ç å¤åˆ¶è¿›ä½ çš„è„šæœ¬é‡Œã€‚å¯èƒ½ä¼šéœ€è¦è£…ä¸Špyechartså’Œopenpyxlã€‚ç”¨PyCharmçš„æ—¶å€™ï¼Œå¯ä»¥ç‚¹åˆ°æŠ¥çº¢çº¿çš„åœ°æ–¹ï¼Œæ ¹æ®å®ƒçš„æç¤ºï¼ŒæŠŠè¿™2ä¸ªåº“è£…ä¸Šã€‚ è¿è¡Œä»£ç ï¼Œä¼šå¾—åˆ°3ä¸ªhtmlæ–‡ä»¶ ç”¨æµè§ˆå™¨æ‰“å¼€è¿™3ä¸ªhtmlå°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†ã€‚ æŠŠä½ çš„æ•°æ®å¡«åˆ°é‚£ä¸ªExcelé‡Œï¼Œä¿å­˜ã€‚ç„¶åè¿è¡Œä»£ç å³å¯ã€‚ æ¯”å¦‚è¯´æŠŠExcelé‡Œçš„äº‹ä»¶æ”¹ä¸€ä¸‹ è¿è¡Œä»£ç ï¼Œå¯ä»¥å¾—åˆ°æ–°çš„ç»“æœ ä»¥ä¸Šæ˜¯ç®€åŒ–æµç¨‹ï¼Œè¿è¥æœ‹å‹ç…§ç€åšï¼Œä¸€èˆ¬éƒ½å¯ä»¥çœ‹åˆ°è¿è¡Œç»“æœã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€äº›ç»†èŠ‚ã€‚ è¯»å–æ•°æ®æˆ‘ä»¬å…ˆå‡†å¤‡ä¸€äº›æµ‹è¯•æ•°æ®ã€‚æ–°å»ºä¸€ä¸ªxlsxæ–‡ä»¶ï¼Œå¡«å…¥æµ‹è¯•æ•°æ®ã€‚å¦‚ä¸‹å›¾ï¼š æˆ‘ä»¬æŠŠæ•°æ®æ”¾åœ¨äº†data3é‡Œã€‚Aåˆ—æ˜¯äº‹ä»¶åç§°ï¼ŒBåˆ—æ˜¯æ¬¡æ•°ã€‚åç§°è¿™é‡Œå¯ä»¥éšæ„æ›¿æ¢ï¼Œå¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿›è¡Œä¿®æ”¹ã€‚äº‹ä»¶æµç¨‹æŒ‰ç…§å…ˆåé¡ºåºï¼Œä»ä¸Šåˆ°ä¸‹æ’åˆ—å¥½ã€‚ é¦–å…ˆéœ€è¦æŠŠæ•°æ®ä»excelä¸­è¯»å–å‡ºæ¥ã€‚æˆ‘ä»¬ç”¨openpyxlæ¥æ“ä½œã€‚12345678910111213from openpyxl import load_workbookdef read_in_data(file_path): print('è·å–åŸå§‹æ•°æ® &gt;&gt;&gt;') wb = load_workbook(file_path) st = wb['data3'] data_list = [] for row_index in range(2, st.max_row + 1): event_name = st.cell(row=row_index, column=1).value event_value = st.cell(row=row_index, column=2).value data_list.append([event_name, event_value]) print(data_list) return data_listå°†äº‹ä»¶åå’Œæ•°æ®è£…åˆ°ä¸€ä¸ªå°çš„åˆ—è¡¨é‡Œ[event_name, event_value]ã€‚æ‰€æœ‰çš„äº‹ä»¶æ”¾è¿›ä¸€ä¸ªå¤§çš„åˆ—è¡¨ï¼Œå¹¶è¿”å›ã€‚ å½“ç„¶ï¼Œä»åˆ«çš„é€”å¾„æ‹¿åˆ°æ•°æ®ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ ç»˜åˆ¶æ¼æ–—å›¾æˆ‘ä»¬ç”¨pyechartsæ¥ç»˜åˆ¶æ¼æ–—å›¾ã€‚ Echarts æ˜¯ä¸€ä¸ªç”±ç™¾åº¦å¼€æºçš„æ•°æ®å¯è§†åŒ–ï¼Œå‡­å€Ÿç€è‰¯å¥½çš„äº¤äº’æ€§ï¼Œç²¾å·§çš„å›¾è¡¨è®¾è®¡ï¼Œå¾—åˆ°äº†ä¼—å¤šå¼€å‘è€…çš„è®¤å¯ã€‚è€Œ Python æ˜¯ä¸€é—¨å¯Œæœ‰è¡¨è¾¾åŠ›çš„è¯­è¨€ï¼Œå¾ˆé€‚åˆç”¨äºæ•°æ®å¤„ç†ã€‚å½“æ•°æ®åˆ†æé‡ä¸Šæ•°æ®å¯è§†åŒ–æ—¶ï¼Œpyecharts è¯ç”Ÿäº†ã€‚ pyechartsä¼šè¾“å‡ºhtmlæ–‡ä»¶ã€‚ é»˜è®¤æ ·å¼æ‹¿åˆ°æ•°æ®åï¼Œæˆ‘ä»¬æŠŠæ•°æ®ä¼ ç»™Funnelã€‚ 123456789101112131415from pyecharts.charts import Funnelimport pyecharts.options as optsdef draw_funnel_default(input_data): print('ç»˜åˆ¶æ¼æ–—å›¾ &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base') ( Funnel(init_opts=opts.InitOpts(width=&quot;800px&quot;, height=&quot;400px&quot;)) .add(series_name='æ¼æ–—1', data_pair=input_data, ) .set_global_opts(title_opts=opts.TitleOpts(title=&quot;æ¼æ–—å›¾1&quot;, subtitle=&quot;é»˜è®¤æ ·å¼&quot;)) .render(&quot;funnel_chart_1.html&quot;) )if __name__ == '__main__': src_data = read_in_data('res/äº‹ä»¶demo.xlsx') draw_funnel_default(src_data) åˆå§‹é…ç½®é‡Œè®¾å®šå®½é«˜ InitOpts(width=&quot;800px&quot;, height=&quot;400px&quot;) input_dataå°±æ˜¯æˆ‘ä»¬å‰é¢è·å–çš„æ•°æ®åˆ—è¡¨ï¼›å°†å®ƒä¼ ç»™data_pairï¼Œå³data_pair=input_data è¾“å‡ºçš„ç½‘é¡µæ–‡ä»¶åä¸ºfunnel_chart_1.html set_global_opts()æ–¹æ³•è®¾ç½®å…¨å±€é…ç½® æ ‡é¢˜è®¾ç½® title=&quot;æ¼æ–—å›¾1&quot; å‰¯æ ‡é¢˜è®¾ç½® subtitle=&quot;é»˜è®¤æ ·å¼&quot; è¾“å‡ºçš„htmlæ–‡ä»¶ï¼Œç”¨æµè§ˆå™¨æ‰“å¼€ï¼Œå¦‚å›¾ï¼š é¼ æ ‡æ”¾ä¸Šå»ä¼šæœ‰å°å¼¹æ¡†æç¤ºï¼ˆtooltipï¼‰ ğŸ”— é»˜è®¤æ ·å¼ç½‘é¡µçš„é“¾æ¥ ä¿®æ”¹labelpyechartså¼€æ”¾äº†å¾ˆå¤šé…ç½®ã€‚æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸€ä¸‹æ¯ä¸€é¡¹çš„æ ‡é¢˜ã€‚123456789101112def draw_funnel_2(input_data): print('ç»˜åˆ¶æ¼æ–—å›¾1 &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base') ( Funnel(init_opts=opts.InitOpts(width=&quot;1000px&quot;, height=&quot;600px&quot;)) .add(series_name='æ¼æ–—1', data_pair=input_data, label_opts=opts.LabelOpts(position=&quot;inside&quot;, formatter='{b} æ•°é‡: {c}'), gap=2, tooltip_opts=opts.TooltipOpts(trigger=&quot;item&quot;, formatter=&quot;{a} &lt;br/&gt;{b} æ•°é‡: {c}&quot;), ) .set_global_opts(title_opts=opts.TitleOpts(title=&quot;æ¼æ–—å›¾1&quot;, subtitle=&quot;æ”¹å˜äº†label&quot;)) .render(&quot;funnel_chart_2.html&quot;) ) formatter {a}æ˜¯series_nameï¼Œåœ¨è¿™é‡Œæ˜¯å›¾è¡¨çš„åå­— {b}æ˜¯è¿™ä¸€é¡¹çš„æ ‡é¢˜ {c}æ˜¯è¿™ä¸€é¡¹çš„æ•°é‡ tooltip_optså’Œlabel_optséƒ½ä¼šç”¨åˆ°formatterã€‚ ğŸ”— æµè§ˆç½‘é¡µ è‡ªå·±è®¡ç®—è½¬åŒ–ç‡ä¸ºäº†æ˜¾ç¤ºå‡ºç›¸å¯¹è½¬åŒ–ç‡å’Œæ€»ä½“è½¬åŒ–ç‡ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå·±è®¡ç®—ã€‚ 123456789101112131415161718192021222324def draw_funnel_3(input_data): print('ç»˜åˆ¶æ¼æ–—å›¾2 &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base') data = input_data.copy() # å¤åˆ¶ä¸€ä»½å‡ºæ¥å¤„ç†æ ‡é¢˜ base_value = data[0][1] for x in range(0, len(data)): event_name = data[x][0] value = data[x][1] # æ‹¿åˆ°æ•°å€¼ ratio = value / base_value event_name += '\\næ€»ä½“è½¬åŒ–ç‡: {:.2f}%'.format(ratio * 100) if x &gt; 0: event_name += '\\nç›¸å¯¹è½¬åŒ–ç‡: {:.2f}%'.format(100 * value / data[x - 1][1]) data[x][0] = event_name print(event_name) ( Funnel(init_opts=opts.InitOpts(width=&quot;1000px&quot;, height=&quot;800px&quot;)) .add(series_name='æ¼æ–—1', data_pair=data, label_opts=opts.LabelOpts(position=&quot;inside&quot;, formatter='{b}\\næ•°é‡: {c}'), gap=2, tooltip_opts=opts.TooltipOpts(trigger=&quot;item&quot;, formatter=&quot;{a} &lt;br/&gt;{b} æ•°é‡: {c}&quot;), ) .set_global_opts(title_opts=opts.TitleOpts(title=&quot;æ¼æ–—å›¾1&quot;, subtitle=&quot;ä¿®æ”¹äº†å„é¡¹çš„æ ‡é¢˜&quot;)) .render(&quot;funnel_chart_3.html&quot;) ) åœ¨forå¾ªç¯é‡Œè®¡ç®—è½¬åŒ–ç‡ï¼Œå¹¶æŠŠç»“æœå†™åˆ°äº‹ä»¶çš„åç§°é‡Œã€‚ ğŸ”— æµè§ˆç½‘é¡µ","link":"/2021/06/28/Python/Python-op-draw-funnel-1/"},{"title":"HTTPçŠ¶æ€ç ","text":"HTTPçŠ¶æ€ç è¢«åˆ†æˆäº†5å¤§ç±»ã€‚æœ¬æ–‡å¯¹æ¯ä¸€ç±»å¸¸è§çš„çŠ¶æ€ç è¿›è¡Œæ€»ç»“ã€‚ åˆ—å‡ºçš„æ˜¯HTTP/1.1è§„èŒƒæ¨èä½¿ç”¨çš„åŸå› çŸ­è¯­ã€‚ 100~199 ä¿¡æ¯æ€§çŠ¶æ€ç  çŠ¶æ€ç  åŸå› çŸ­è¯­ æè¿° (å›¾æ–‡æ— å…³) 100 Continue è¯´æ˜æ”¶åˆ°äº†è¯·æ±‚çš„åˆå§‹éƒ¨åˆ†ï¼Œè¯·å®¢æˆ·ç«¯ç»§ç»­ã€‚ 101 Switching Protocols è¯´æ˜æœåŠ¡å™¨æ­£åœ¨æ ¹æ®å®¢æˆ·ç«¯çš„æŒ‡å®šï¼Œå°†åè®®åˆ‡æ¢æˆUpdateé¦–éƒ¨æ‰€åˆ—çš„åè®® * 200~299 æˆåŠŸçŠ¶æ€ç  çŠ¶æ€ç  åŸå› çŸ­è¯­ æè¿° (å›¾æ–‡æ— å…³) 200 OK OK 201 Created * 202 Accepted * 203 Non-Authoritative Information * 204 No Content * 205 Reset Content * 206 Partical Content * 300~399 é‡å®šå‘çŠ¶æ€ç  çŠ¶æ€ç  åŸå› çŸ­è¯­ æè¿° (å›¾æ–‡æ— å…³) 300 Multiple Choices å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªå®é™…æŒ‡å‘å¤šä¸ªèµ„æºçš„URLæ—¶ä¼šè¿”å›è¿™ä¸ªçŠ¶æ€ç ï¼Œæ¯”å¦‚æœåŠ¡å™¨ä¸Šæœ‰æŸä¸ªHTMLæ–‡æ¡£çš„è‹±è¯­å’Œæ³•è¯­ç‰ˆæœ¬ã€‚æœåŠ¡å™¨å¯ä»¥åœ¨locationé¦–éƒ¨åŒ…å«é¦–é€‰URLã€‚ 301 Moved Permanently åœ¨è¯·æ±‚çš„URLå·²è¢«ç§»é™¤æ—¶ä½¿ç”¨ã€‚å“åº”çš„Locationé¦–éƒ¨ä¸­åº”è¯¥åŒ…å«èµ„æºç°åœ¨æ‰€å¤„çš„URLã€‚ 302 Found ä¸301ç±»ä¼¼ï¼Œä½†å®¢æˆ·ç«¯åº”è¯¥ä½¿ç”¨Locationé¦–éƒ¨ç»™å‡ºçš„URLæ¥ä¸´æ—¶å®šä½èµ„æºã€‚ 304 Not Modified æœ‰æ¡ä»¶çš„é¦–éƒ¨ã€‚å¦‚æœå®¢æˆ·ç«¯å‘èµ·äº†ä¸€ä¸ªæ¡ä»¶GETè¯·æ±‚ï¼Œè€Œæœ€è¿‘èµ„æºæœªè¢«ä¿®æ”¹ï¼Œå°±å¯ä»¥ç”¨è¿™ä¸ªçŠ¶æ€ç æ¥è¯´æ²¡èµ„æºæœªè¢«ä¿®æ”¹ã€‚å¸¦æœ‰è¿™ä¸ªçŠ¶æ€ç çš„å“åº”ä¸åº”è¯¥åŒ…å«å®ä½“çš„ä¸»ä½“éƒ¨åˆ†ã€‚ * 400~499 å®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç  çŠ¶æ€ç  åŸå› çŸ­è¯­ æè¿° (å›¾æ–‡æ— å…³) 400 Bad Request å‘ŠçŸ¥å®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªé”™è¯¯çš„è¯·æ±‚ã€‚ 401 Unauthorized æœªè®¤è¯ã€‚ 403 Forbidden è¯·æ±‚è¢«æœåŠ¡å™¨æ‹’ç»ã€‚ 404 Not Found æœåŠ¡å™¨æ— æ³•æ‰¾åˆ°æ‰€è¯·æ±‚çš„URLã€‚ 405 Method Not Allowed å‘èµ·çš„è¯·æ±‚ä¸­å¸¦æœ‰æ‰€è¯·æ±‚çš„URLä¸æ”¯æŒçš„æ–¹æ³•æ—¶ï¼Œä½¿ç”¨æ­¤çŠ¶æ€ç ã€‚åº”è¯¥åœ¨å“åº”ä¸­åŒ…å«Allowé¦–éƒ¨ï¼Œä»¥å‘ŠçŸ¥å®¢æˆ·ç«¯å¯¹æ‰€è¯·æ±‚çš„èµ„æºå¯ä»¥ä½¿ç”¨å“ªäº›æ–¹æ³•ã€‚ 406 Not Acceptable æœåŠ¡å™¨æ²¡æœ‰ä¸å®¢æˆ·ç«¯å¯æ¥å—çš„URLç›¸åŒ¹é…çš„èµ„æºæ—¶ï¼Œä½¿ç”¨æ­¤ä»£ç ã€‚ 408 Request Timeout å¦‚æœå®¢æˆ·ç«¯å®Œæˆè¯·æ±‚æ‰€èŠ±çš„æ—¶é—´å¤ªé•¿ï¼ŒæœåŠ¡å™¨å¯ä»¥å›é€æ­¤çŠ¶æ€ç ï¼Œå¹¶å…³é—­è¿æ¥ã€‚ 410 Gone ä¸404ç±»ä¼¼ï¼Œåªæ˜¯æœåŠ¡å™¨æ›¾ç»æœ‰è¿‡æ­¤èµ„æºã€‚ 411 Length Required æœåŠ¡å™¨è¦æ±‚Content-Lengthé¦–éƒ¨ã€‚ 412 Precondition Failed å®¢æˆ·ç«¯å‘èµ·äº†æ¡ä»¶è¯·æ±‚ï¼Œä¸”å…¶ä¸­ä¸€ä¸ªæ¡ä»¶å¤±è´¥äº†ã€‚ 415 Unsupported Media Type æœåŠ¡å™¨æ— æ³•ç†è§£æˆ–æ— æ³•æ”¯æŒå®¢æˆ·ç«¯æ‰€å‘å®ä½“çš„å†…å®¹ç±»å‹ã€‚ 416 Requested Range Not Satisfiable è¯·æ±‚æŠ¥æ–‡æ‰€è¯·æ±‚çš„æ˜¯æŒ‡å®šèµ„æºçš„æŸä¸ªèŒƒå›´ï¼Œè€Œæ­¤èŒƒå›´æ— æ•ˆæˆ–æ— æ³•æ»¡è¶³ã€‚ 500~599 æœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç  çŠ¶æ€ç  åŸå› çŸ­è¯­ æè¿° (å›¾æ–‡æ— å…³) 500 Internal Server Error æœåŠ¡å™¨é‡åˆ°ä¸€ä¸ªå¦¨ç¢å®ƒä¸ºè¯·æ±‚æä¾›æœåŠ¡çš„é”™è¯¯ 501 Not Implement å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚è¶…è¿‡æœåŠ¡å™¨èƒ½åŠ›èŒƒå›´ 503 Service Unavailable æœåŠ¡å™¨ç°åœ¨æ— æ³•ä¸ºè¯·æ±‚æä¾›æœåŠ¡ï¼Œä½†å°†æ¥å¯ä»¥ 504 Gateway Timeout ä¸408ç±»ä¼¼ï¼Œåªæ˜¯è¿™é‡Œçš„å“åº”æ¥è‡ªä¸€ä¸ªç½‘å…³æˆ–ä»£ç† 505 HTTP Version Not Supported æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ä½¿ç”¨äº†å®ƒæ— æ³•æˆ–ä¸æ„¿æ”¯æŒçš„åè®®ç‰ˆæœ¬ *","link":"/2021/06/25/Network/http-code/"},{"title":"NestJS éƒ¨ç½²ä¸ç»´æŠ¤","text":"æˆ‘ä»¬å¯ä»¥æŠŠnestjsçš„å·¥ç¨‹ä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼Œç„¶åç›´æ¥è¿›è¡Œnpmæ“ä½œã€‚ä¹Ÿå¯ä»¥åœ¨æœ¬åœ°æ‰“åŒ…å‡ºnestjsçš„åŒ…ï¼Œå°†distç›®å½•ä¼ åˆ°æœåŠ¡å™¨ä¸Šã€‚ åœ¨è¿™é‡Œä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘ä»¬æè¿°çš„æ˜¯å°†å·¥ç¨‹ä¼ åˆ°æœåŠ¡å™¨åçš„æ“ä½œã€‚ä¼ å·¥ç¨‹æ–‡ä»¶ï¼Œå¯ä»¥ç”¨github/giteeå½“ä½œä¸­é—´æ¡¥æ¢ï¼Œä¹Ÿå¯ä»¥ç”¨vscodeçš„æ’ä»¶ä¼ è¾“ï¼Œæˆ–è€…ä½¿ç”¨scpå‘½ä»¤ã€‚ åŒç†ï¼Œdistç›®å½•ä¹Ÿå¯ä»¥ä¼ åˆ°github/giteeä¸Šï¼ŒæœåŠ¡å™¨ç›´æ¥ä½¿ç”¨ç¼–è¯‘å¥½çš„æ–‡ä»¶ã€‚ ç›´æ¥å¯åŠ¨å¯åŠ¨å‰ï¼Œè¿›å…¥å·¥ç¨‹ç›®å½•ï¼Œå…ˆå®‰è£…ä¸€æ¬¡ã€‚1$ npm install ç”¨npm runå‘½ä»¤å¯åŠ¨æœåŠ¡12345# å¼€å‘æ¨¡å¼$ npm run start# è§‚å¯Ÿæ¨¡å¼$ npm run start:dev åœ¨æœåŠ¡å™¨ä¸Šï¼Œè¿è¡Œæ­£å¼ç¯å¢ƒï¼ˆç”Ÿäº§ç¯å¢ƒ productionï¼‰12345# å¯åŠ¨ç”Ÿäº§ç¯å¢ƒå‰ å…ˆstart$ npm run start# ç”Ÿäº§ç¯å¢ƒ$ npm run start:prodä½¿ç”¨npm runè¿è¡Œçš„ç¨‹åºï¼Œå¯ä»¥ctrl + cåœæ­¢ã€‚ runèµ·æ¥åï¼Œç¼–è¯‘åçš„æ–‡ä»¶åœ¨distç›®å½•é‡Œã€‚ ä½¿ç”¨pm2ç®¡ç†pm2æ˜¯å¸¸ç”¨çš„nodeè¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå®ƒå¯ä»¥æä¾›node.jsåº”ç”¨ç®¡ç†ï¼Œå¦‚è‡ªåŠ¨é‡è½½ã€æ€§èƒ½ç›‘æ§ã€è´Ÿè½½å‡è¡¡ç­‰ã€‚ åœ¨æœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨npmå®‰è£…è¿™ä¸ªå·¥å…·1npm install pm2 å®‰è£…å®Œæ¯•åï¼ŒæŸ¥çœ‹ä¸€ä¸‹ç‰ˆæœ¬12$ pm2 -v4.4.1 pm2å¯åŠ¨æœåŠ¡æˆ‘ä»¬çŸ¥é“ï¼Œnestjsç¼–è¯‘åçš„æ–‡ä»¶åœ¨distç›®å½•é‡Œï¼Œå…¥å£æ–‡ä»¶æ˜¯dist/main.js ç”¨pm2å¯åŠ¨æœåŠ¡ä¹‹å‰ï¼Œå…ˆæŠŠè¯¥è£…çš„åº“ç”¨npmè£…å¥½ã€‚è¿è¡Œnpm run start:prodï¼Œç„¶åctrl + cåœæ­¢ã€‚ æ¥ä¸‹æ¥ç”¨pm2å¯åŠ¨1pm2 start dist/main.js --name=&quot;è¿™é‡Œæ˜¯è‡ªå®šä¹‰çš„åå­—&quot; æŸ¥çœ‹æœåŠ¡ä½¿ç”¨å‘½ä»¤pm2 listæŸ¥çœ‹æœåŠ¡ ä¾‹å¦‚åœ¨æŸä¸ªæœåŠ¡å™¨ä¸Š12345678910$ pm2 list â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ id â”‚ name â”‚ namespace â”‚ version â”‚ mode â”‚ pid â”‚ uptime â”‚ â†º â”‚ status â”‚ cpu â”‚ mem â”‚ user â”‚ watching â”‚â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚ 3 â”‚ rustfisher-debug â”‚ default â”‚ 1.0.0 â”‚ fork â”‚ 12260 â”‚ 2M â”‚ 0 â”‚ online â”‚ 0% â”‚ 39.7mb â”‚ ubuntu â”‚ disabled â”‚â”‚ 2 â”‚ rustfisher-releaseâ”‚ default â”‚ 1.0.0 â”‚ fork â”‚ 12090 â”‚ 2M â”‚ 46 â”‚ online â”‚ 0% â”‚ 44.6mb â”‚ ubuntu â”‚ disabled â”‚â”‚ 0 â”‚ index â”‚ default â”‚ 1.0.0 â”‚ fork â”‚ 0 â”‚ 0 â”‚ 68 â”‚ stopped â”‚ 0% â”‚ 0b â”‚ ubuntu â”‚ disabled â”‚â”‚ 1 â”‚ index â”‚ default â”‚ 1.0.0 â”‚ fork â”‚ 0 â”‚ 0 â”‚ 15 â”‚ stopped â”‚ 0% â”‚ 0b â”‚ ubuntu â”‚ disabled â”‚â”‚ 4 â”‚ an.rustfisher â”‚ default â”‚ 0.0.1 â”‚ fork â”‚ 32252 â”‚ 74m â”‚ 0 â”‚ online â”‚ 0% â”‚ 51.5mb â”‚ ubuntu â”‚ disabled â”‚â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ åœæ­¢æœåŠ¡æƒ³è¦åœæ­¢æŸä¸ªæœåŠ¡ï¼Œä½¿ç”¨pm2 stop + æœåŠ¡åï¼ˆnameï¼‰æˆ–è€…id ä¾‹å¦‚1pm2 stop rustfisher-debugæ‰§è¡Œå®Œæ¯•åï¼Œä¼šè‡ªåŠ¨è¿è¡Œä¸€æ¬¡pm2 list é‡å¯æœåŠ¡ç”¨pm2 restart + æœåŠ¡åï¼ˆnameï¼‰æˆ–è€…id1pm2 restart rustfisher-debugæˆ–è€…1pm2 restart 3 æ—¥å¿—ç®¡ç†é»˜è®¤æƒ…å†µä¸‹ï¼Œpm2çš„æ—¥å¿—å­˜æ”¾åœ¨~/.pm2/logé‡Œã€‚æ¯ä¸ªå¯åŠ¨çš„æœåŠ¡æœ‰å¯¹åº”çš„logæ–‡ä»¶ã€‚ ä¾‹å¦‚ï¼Œåœ¨æŸä¸ªæœåŠ¡å™¨ä¸Š123$ ls .pm2/logs/app-error.log dr-debug-error.log dr-release-error.log index-error.log www-error.logapp-out.log dr-debug-out.log dr-release-out.log index-out.log www-out.log nohupåå°å¯åŠ¨æˆ‘ä»¬ä¹Ÿå¯ç”¨nohupåå°å¯åŠ¨ã€‚ è¿›å…¥å·¥ç¨‹ç›®å½•ï¼Œè¿è¡Œ1nohup npm run start:prod &gt;&gt; nohup.log &amp; æŸ¥çœ‹è¿›ç¨‹12345$ ps -aux | grep nodeubuntu 11826 0.0 1.2 674064 10988 ? Ssl Mar16 0:00 /usr/local/bin/node /usr/local/lib/node_modules/npm/node_modules/update-notifier/check.js {&quot;pkg&quot;:{&quot;name&quot;:&quot;npm&quot;,&quot;version&quot;:&quot;6.14.6&quot;}}ubuntu 16478 0.0 0.0 4512 788 pts/3 S 11:49 0:00 sh -c node dist/mainubuntu 16479 0.4 5.1 578840 45228 pts/3 Sl 11:49 0:00 node dist/mainubuntu 16959 0.0 0.1 13232 928 pts/3 S+ 11:52 0:00 grep --color=auto nodeå¯ä»¥çœ‹åˆ°æœ‰2ä¸ªç›¸å…³çš„è¿›ç¨‹16478å’Œ16479 æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µã€‚å‡è®¾æˆ‘ä»¬å·¥ç¨‹ç›‘å¬çš„æ˜¯8090ç«¯å£ã€‚12345$ netstat -anp | grep 8090(Not all processes could be identified, non-owned process info will not be shown, you would have to be root to see it all.)tcp 0 0 127.0.0.1:52788 127.0.0.1:8090 TIME_WAIT - tcp6 0 0 :::8090 :::* LISTEN 16479/node ç»“åˆä¸€çœ‹ï¼Œè¿›ç¨‹16479æ˜¯æˆ‘ä»¬åå°è¿è¡Œçš„æœåŠ¡æ²¡é”™äº†ã€‚ åœæ­¢åå°è¿›ç¨‹1sudo kill 16479killç„¶åå†æŸ¥è¯¢è¿›ç¨‹å’Œç«¯å£å ç”¨æƒ…å†µï¼Œå°±æ²¡æœ‰ç›¸å…³çš„è¿›ç¨‹äº†ã€‚ æ€»ç»“å¯ä»¥ç”¨ä¸åŒçš„æ–¹å¼åå°å¯åŠ¨æœåŠ¡ã€‚å¯åŠ¨ç”Ÿäº§ç¯å¢ƒä¹‹å‰ï¼Œè¦å…ˆåŒæ­¥å¹¶ç¼–è¯‘ã€‚","link":"/2021/06/20/NestJS/nest-devops/"},{"title":"Shell forå¾ªç¯è¯­å¥","text":"Shellé‡Œçš„forå¾ªç¯è¯­å¥å†™æ³•ã€‚æˆ‘ä»¬åˆ†åˆ«ç”¨å‘½ä»¤è¡Œå’Œshellè„šæœ¬æ¥è¿›è¡Œæ¼”ç¤ºã€‚ å¸¸è§çš„ä¸€ç§forç»“æ„å¦‚ä¸‹ã€‚foré‡Œé¢è¦è·Ÿç€doå’Œdoneå…³é”®å­—ã€‚ 1234for i in {1..3}do echo YES $i # è¿™é‡Œæ˜¯å¾ªç¯ä½“done æ•°å­—èŒƒå›´æ•°å­—èŒƒå›´ï¼Œä¾‹å¦‚ä»1åˆ°3ï¼Œä»1åˆ°100ã€‚ for infor in çš„å†™æ³•ï¼Œå®šä¹‰iä¸ºå˜é‡ï¼Œä½¿ç”¨å¤§æ‹¬å·æ¥æŒ‡å®šèŒƒå›´ã€‚èŒƒå›´çš„æ•°å­—ä¹‹é—´æœ‰2ä¸ªç‚¹..ã€‚ä¾‹å¦‚{1..3}1234$ for i in {1..3};do echo now is $i; donenow is 1now is 2now is 3ä¸Šé¢æ˜¯å‘½ä»¤è¡Œï¼Œä¸€è¡ŒæŠŠæ‰€æœ‰çš„æŒ‡ä»¤å†™å®Œã€‚ä¹Ÿå¯ä»¥å†åŠ ä¸€è¡Œä»£ç ï¼ŒåŒæ ·ç”¨åˆ†å·;æ¥åˆ†éš”ã€‚1234567$ for i in {1..3};do echo now is $i;echo rustfisher.com; donenow is 1rustfisher.comnow is 2rustfisher.comnow is 3rustfisher.com æˆ–è€…å†™æˆè„šæœ¬ã€‚å…¶å®å°±æ˜¯æ‹†æˆå‡ è¡Œã€‚1234567#!/bin/bash for i in {1..3}do echo now is $i echo rustfisher.comdone å‰é¢æˆ‘ä»¬ç”¨çš„æ˜¯å¤§æ‹¬å·æ¥æŒ‡å®šå¾ªç¯èŒƒå›´ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨$(seq 1 3)ã€‚å¼€å¤´ä¾æ—§æ˜¯for i in1234567$ for i in $(seq 1 3);do echo now is $i;echo rustfisher.com; donenow is 1rustfisher.comnow is 2rustfisher.comnow is 3rustfisher.com å†™æˆè„šæœ¬å¦‚ä¸‹1234567#!/bin/bash for i in $(seq 1 3)do echo now is $i echo rustfisher.comdone å®é™…ä¸Šæˆ‘ä»¬ä½¿ç”¨äº†seqå‘½ä»¤ã€‚seqåé¢æ¥2ä¸ªæ•°å­—ï¼Œå¯ä»¥è¾“å‡ºè¿™ä¸ªèŒƒå›´å†…çš„æ•°å­—ã€‚123456789101112$ seq 1 512345~ $ seq 5 154321 for((i=1;i&lt;=3;i++))æˆ‘ä»¬ä¹Ÿå¯ä»¥å†™æˆåƒJava/Cè¯­è¨€é‡Œçš„forå¾ªç¯é‚£æ ·ã€‚ä½†è¦æ³¨æ„è¿™é‡Œçš„foræœ‰2å±‚å°æ‹¬å·ã€‚1234$ for((i=1;i&lt;=3;i++));do echo -n now is [$i] ;echo rustfisher.com; donenow is [1]rustfisher.comnow is [2]rustfisher.comnow is [3]rustfisher.com æ›´æ”¹ä¸€ä¸‹æ­¥è¿›å€¼ï¼Œæ”¹ä¸ºi+=2123for((i=1;i&lt;=3;i+=2));do echo -n now is [$i] ;echo rustfisher.com; donenow is [1]rustfisher.comnow is [3]rustfisher.com æˆ–è€…åŠ ä¸Šä¸€äº›å°è¿ç®—ï¼Œç”¨expråŠ ä¸Šæˆ‘ä»¬æƒ³è¦çš„è¿ç®—ã€‚æ³¨æ„$iä¸\\*å’Œ3ä¹‹é—´è¦æœ‰ç©ºæ ¼ã€‚123$ for((i=1;i&lt;=3;i+=2));do echo -n $(expr $i \\* 3) ' ' ;echo rustfisher.com; done3 rustfisher.com9 rustfisher.comåé¢åŠ çš„ç©ºæ ¼æ˜¯ä¸ºäº†éš”å¼€å¥½çœ‹ä¸€äº›ã€‚ åœ¨shellè„šæœ¬ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ä¼šå®šä¹‰å˜é‡ã€‚å˜é‡ä¹Ÿå¯ä»¥ä½œä¸ºforå¾ªç¯çš„èŒƒå›´ã€‚123456789#!/bin/bash startNum=1endNum=3for i in $(seq $startNum $endNum)do echo current is $idoneæˆ‘ä»¬å®šä¹‰2ä¸ªå˜é‡startNumä¸endNumã€‚è¦ä½¿ç”¨å®ƒä»¬çš„å€¼æ—¶ï¼Œéœ€è¦åŠ ä¸Š$ç¬¦å·ã€‚ å­—ç¬¦å¾ªç¯forå¾ªç¯å¯ä»¥ä¸ä¸€äº›æŒ‡ä»¤ç»“åˆèµ·æ¥ï¼Œè·å–æŒ‡ä»¤ä¸­çš„ç»“æœã€‚ for i in lså…ˆç”¨å‘½ä»¤è¡Œçœ‹ä¸€ä¸ªæ•ˆæœï¼Œforä¸lsç»“åˆä½¿ç”¨12$ for i in `ls`; do echo $i ; donefor1.shå½“å‰ç›®å½•é‡Œåªæœ‰1ä¸ªæ–‡ä»¶ã€‚ å¦‚æœæ˜¯ls -aå‘½ä»¤ï¼Œè¾“å‡ºä¼šæ›´å¤šã€‚1234$ for i in `ls -a`; do echo $i ; done...for1.sh æ¢ä¸€ä¸ªç›®å½•ï¼Œæˆ‘ä»¬å¯ä»¥è¾“å‡ºæ‰€æœ‰pngæ–‡ä»¶çš„æ–‡ä»¶å123456789$ for i in `ls *.png`; do echo $i ; doneandroid-cover-2.pngfish.pngic_book_blue.pngic_tools_gear.pngic_web.pngkotlin-android-1.pngpython-logo.pngts-blue-1.png for i in llæ¢æˆllå‘½ä»¤ï¼Œè¾“å‡ºæ›´åŠ ä¸°å¯Œ123456789101112$ for i in `ll`; do echo $i ; donetotal8-rw-r--r--1rustfisherstaff18361921:25for1.sh æˆ‘ä»¬çŸ¥é“llå‘½ä»¤ä¼šè¾“å‡ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ä¿¡æ¯123$ lltotal 8-rw-r--r-- 1 rustfisher staff 183 6 19 21:25 for1.sh ç»“åˆforå¾ªç¯å¯ä»¥çœ‹å‡ºï¼Œforå¾ªç¯æ˜¯è·å–äº†ç©ºæ ¼æˆ–æ¢è¡Œä¸ºé—´éš”çš„å­—ç¬¦ä¸²ã€‚ æ˜¾ç¤ºå„ä¸ªå­ç›®å½•é‡Œmdæ–‡ä»¶çš„ä¸ªæ•°1for i in `ls`; do echo $i; find $i -name &quot;*.md&quot; | wc -l; done å­—ç¬¦ä¸²å˜é‡é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨è„šæœ¬ä¸­å°è¯•ä¸€äº›ï¼Œforå¾ªç¯é…åˆå­—ç¬¦ä¸²1234567#!/bin/bash word=&quot;Welcome to rustfisher.com&quot;for i in $worddo echo $idone wordä¸­é—´æœ‰å¾ˆå¤šä¸ªç©ºæ ¼ï¼Œä½†è¾“å‡ºçš„ä¾æ—§æ˜¯è¿™3è¡Œã€‚123Welcometorustfisher.com è¿›ä¸€æ­¥æ‰©å±•ï¼Œå®šä¹‰3ä¸ªå˜é‡ï¼Œéƒ½ä½œä¸ºfor inçš„å‚æ•°123456789#!/bin/bash word1=&quot;Welcome to rustfisher.com&quot;word2=&quot;Hello world&quot;word3=&quot;æˆ‘å¾ˆå¥½&quot;for i in $word1 $word2 $word3do echo $idone è¾“å‡º123456Welcometorustfisher.comHelloworldæˆ‘å¾ˆå¥½ ç›®å½•ä¾‹å¦‚æŸ¥æ‰¾æŸä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚ å½“å‰ç›®å½•ä¸­æœ‰ä¸€ä¸ªimgç›®å½•ï¼Œé‡Œé¢æœ‰ä¸€äº›å›¾ç‰‡ã€‚æˆ‘ä»¬åœ¨for in åé¢ç”¨img/*æ¥è¡¨ç¤ºæŸ¥æ‰¾è¿™ä¸ªç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶ã€‚123$ for i in img/*; do echo $i ; doneimg/android-2botsm.jpgimg/android-cover-2.png å¦‚æœåªæƒ³çœ‹pngæ–‡ä»¶ï¼Œè·¯å¾„å†™ä¸ºimg/*.pngã€‚12$ for i in img/*.png; do echo $i ; doneimg/android-cover-2.png ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œfor inç»“æ„ç”¨çš„ååˆ†é¢‘ç¹ã€‚","link":"/2021/06/19/Linux/for-use/"},{"title":"Cocos Creator æ‹–åŠ¨å»æŒ‡å®šåŒºåŸŸ","text":"æˆ‘ä»¬è¦å®ç°çš„æ•ˆæœæ˜¯ï¼ŒæŒ‰ä½å¹¶æ‹–åŠ¨ä¸€ä¸ªå°ç‰©ä½“ï¼Œç‰©ä½“è·Ÿéšæ‰‹æŒ‡ï¼ˆé¼ æ ‡ï¼‰ç§»åŠ¨ã€‚æ‹–åˆ°æŒ‡å®šä½ç½®æ”¾ä¸‹ã€‚å¦‚æœæ²¡æœ‰åˆ°æŒ‡å®šä½ç½®ï¼Œåˆ™å›åˆ°ä¸Šä¸€ä¸ªä½ç½®ã€‚ æ–°å»ºè„šæœ¬DragToTarget.tsï¼ŒæŒ‚åˆ°é¢„åˆ¶ä½“ä¸Šã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657const { ccclass, property } = cc._decorator;@ccclassexport default class DragToTarget extends cc.Component { @property(cc.Label) nameLabel: cc.Label = null; @property(cc.Node) targetOfDragList: cc.Node[] = []; _oldPos = null; // ä¸Šä¸€ä¸ªä½ç½® start() { this._oldPos = this.node.position; } onEnable() { this.node.on(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this); this.node.on(cc.Node.EventType.TOUCH_END, this._onTouchEnd, this); } onDisable() { this.node.off(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this); this.node.off(cc.Node.EventType.TOUCH_END, this._onTouchEnd, this); } // update (dt) {} _onTouchMove(touchEvent) { let location = touchEvent.getLocation(); this.node.position = this.node.parent.convertToNodeSpaceAR(location); // ç¡®å®šä½ç½® } _onTouchEnd(touchEvent) { if (this.targetOfDragList.length === 0) { return; // æ²¡æœ‰ç›®æ ‡ä½ç½® } let inTarget = false; for (const targetNode of this.targetOfDragList) { if (this._withinTarget(targetNode, touchEvent)) { inTarget = true; break; } } if (!inTarget) { this.node.position = this._oldPos; // å›å» } } // åˆ¤æ–­è§¦æ‘¸äº‹ä»¶æ˜¯å¦åœ¨æ§½ä½é‡Œ _withinTarget(targetNode: cc.Node, touchEvent) { let rect = targetNode.getBoundingBox(); let location = touchEvent.getLocation(); let point = targetNode.parent.convertToNodeSpaceAR(location); return rect.contains(point); }}æ€è·¯ä¸ä¹‹å‰çš„æ‹–åŠ¨ç±»ä¼¼ã€‚åœ¨æœ€åTOUCH_ENDçš„æ—¶å€™ï¼Œåˆ¤æ–­è‡ªå·±æ˜¯å¦åœ¨ç›®æ ‡åŒºåŸŸå†…ã€‚å¦‚æœä¸åœ¨åˆ™è¿”å›ä¸Šä¸€ä¸ªåæ ‡ã€‚ åœ¨åœºæ™¯ä¸­ä½¿ç”¨1234567891011121314151617181920212223242526272829import DragToTarget from &quot;./DragToTarget&quot;;const { ccclass, property } = cc._decorator;@ccclassexport default class DragToControl extends cc.Component { @property(cc.Prefab) drag_to_item: cc.Prefab = null; @property(cc.Node) dragTargets: cc.Node[] = []; itemNum = 1; start() { this.createItem(); } // update (dt) {} createItem() { let d = cc.instantiate(this.drag_to_item); this.node.addChild(d); let dragTo = d.getComponent(DragToTarget); dragTo.targetOfDragList = this.dragTargets; // è®¾ç½®ç›®çš„åœ° dragTo.nameLabel.string = '' + this.itemNum++; }}","link":"/2020/12/30/CocosCreator/ccc-drag-to-target/"},{"title":"Cocos Creator åæ ‡ä¸è½¬æ¢","text":"cccçš„åæ ‡ç³» cccæä¾›äº†apiï¼Œåœ¨ä¸–ç•Œåæ ‡å’Œæœ¬åœ°åæ ‡ä¹‹é—´å¯ä»¥ç›¸äº’è½¬æ¢ã€‚ 12345let postion = node.position; // postionæ˜¯åœ¨çˆ¶èŠ‚ç‚¹ä¸­çš„åæ ‡cc.log(name, 'position (', postion.x.toFixed(2), ',', postion.y.toFixed(2), ')');let worldPos = node.parent.convertToWorldSpaceAR(node.position); // ä¸–ç•Œåæ ‡cc.log(name, 'ä¸–ç•Œåæ ‡(', worldPos.x.toFixed(2), ',', worldPos.y.toFixed(2), ')'); node.positionæ˜¯æœ¬åœ°åæ ‡ï¼Œä¹Ÿå°±æ˜¯åœ¨çˆ¶èŠ‚ç‚¹ä¸­çš„åæ ‡ã€‚è®©çˆ¶èŠ‚ç‚¹è°ƒç”¨convertToWorldSpaceARæ–¹æ³•ï¼ŒæŠŠèŠ‚ç‚¹çš„æœ¬åœ°åæ ‡è½¬æ¢ä¸ºä¸–ç•Œåæ ‡ã€‚ pæ˜¯æœ¬åœ°åæ ‡ wæ˜¯ä¸–ç•Œåæ ‡ ä»£ç å‚è€ƒCCCTry","link":"/2020/12/29/CocosCreator/ccc-postion-and-cvt/"},{"title":"Cocos Creator æ‹–åŠ¨æ•ˆæœ","text":"æˆ‘ä»¬è¦å®ç°çš„æ•ˆæœæ˜¯ï¼ŒæŒ‰ä½å¹¶æ‹–åŠ¨ä¸€ä¸ªå°ç‰©ä½“ï¼Œç‰©ä½“è·Ÿéšæ‰‹æŒ‡ï¼ˆé¼ æ ‡ï¼‰ç§»åŠ¨ã€‚ ä»£ç DragToAnywhere.ts12345678910111213141516171819202122232425262728293031@ccclassexport default class DragToAnywhere extends cc.Component { @property(cc.Label) label: cc.Label = null; start () { } onEnable() { this.node.on(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this); this.node.on(cc.Node.EventType.TOUCH_END, this._onTouchEnd, this); } onDisable() { this.node.off(cc.Node.EventType.TOUCH_MOVE, this._onTouchMove, this); this.node.off(cc.Node.EventType.TOUCH_END, this._onTouchEnd, this); } // update (dt) {} _onTouchMove(touchEvent) { let location = touchEvent.getLocation(); this.node.position = this.node.parent.convertToNodeSpaceAR(location); // ç¡®å®šä½ç½® } _onTouchEnd(touchEvent) { // æ”¾ä¸‹ }} æŠŠDragToAnywhere.tsæŒ‚åœ¨é¢„åˆ¶ä½“ä¸Šã€‚åœ¨åœºæ™¯ä¸­åˆ›å»ºé¢„åˆ¶ä½“å¯¹è±¡ã€‚12345let node1 = cc.instantiate(this.drag_item);this.node.addChild(node1);node1.x = 100;node1.y = 100;node1.getComponent(DragToAnywhere).label.string = 'æ°´æ˜Ÿ';","link":"/2020/12/28/CocosCreator/ccc-drag-anywhere/"},{"title":"TypeScript å•ä¾‹æ¨¡å¼","text":"tsä¸­çš„å•ä¾‹æ¨¡å¼ æ„é€ å™¨è®¾ç½®ä¸ºç§æœ‰çš„ å»ºç«‹staticæ–¹æ³•ï¼Œè·å–å”¯ä¸€çš„å¯¹è±¡ 1234567891011121314export default class DataMgr { private static mgr: DataMgr; private constructor() { // æ„é€ å™¨ } public static getMgr(): DataMgr { if (this.mgr == null) { this.mgr = new DataMgr(); } return this.mgr; }} å†™æ³•ä¸Šä¸Javaçš„å•ä¾‹æ¨¡å¼ç±»ä¼¼","link":"/2020/12/27/Ts/ts-singleton-pattern/"},{"title":"Cocos Creator è§¦æ‘¸äº‹ä»¶ç©¿é€","text":"è§¦æ‘¸äº‹ä»¶å‡è®¾ç»™æ•´ä¸ªCanvasæ·»åŠ äº†äº‹ä»¶ç›‘å¬ã€‚ç”¨ç½‘é¡µæ¨¡æ‹Ÿæ—¶ï¼Œé¼ æ ‡ç§»åŠ¨ï¼Œç‚¹å‡»å­nodeéƒ½ä¼šç›‘å¬åˆ°ã€‚12345678910111213141516171819202122start() { this._cfgTouchField();}_onTouchFieldDown(e) { cc.log('table', '_onTouchFieldDown');}_onTouchFieldMove(e) { cc.log('table', '_onTouchFieldMove');}_onTouchFieldEnd(e) { cc.log('table', '_onTouchFieldEnd');}_cfgTouchField() { this.node.on(cc.Node.EventType.MOUSE_DOWN, this._onTouchFieldDown, this); this.node.on(cc.Node.EventType.MOUSE_MOVE, this._onTouchFieldMove, this); this.node.on(cc.Node.EventType.MOUSE_LEAVE, this._onTouchFieldEnd, this); this.node.on(cc.Node.EventType.MOUSE_UP, this._onTouchFieldEnd, this);} ç½‘é¡µæ¨¡æ‹Ÿï¼Œé¼ æ ‡ä»ç©ºç™½åœ°æ–¹ç§»å…¥Toggleçš„èŒƒå›´æ—¶ï¼Œä¼šè§¦å‘ä¸€æ¬¡cc.Node.EventType.MOUSE_LEAVEï¼›ç„¶ååˆæ˜¯cc.Node.EventType.MOUSE_MOVE","link":"/2020/12/26/CocosCreator/ccc-touch-event/"},{"title":"Kotlinå¿«é€Ÿä¸Šæ‰‹","text":"å¿«é€Ÿä»‹ç»Kotlinçš„ç”¨æ³•ã€‚æœ‰äº›åœ°æ–¹ä¼šå’ŒJavaè¿›è¡Œç±»æ¯”ã€‚ å˜é‡å£°æ˜Kotlin ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„å…³é”®å­—ï¼ˆå³ val å’Œ varï¼‰æ¥å£°æ˜å˜é‡ã€‚ val ç”¨äºå€¼ä»ä¸æ›´æ”¹çš„å˜é‡ã€‚æ‚¨ä¸èƒ½ä¸ºä½¿ç”¨ val å£°æ˜çš„å˜é‡é‡æ–°èµ‹å€¼ã€‚var ç”¨äºå€¼å¯ä»¥æ›´æ”¹çš„å˜é‡ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œcount æ˜¯ä¸€ä¸ª Int ç±»å‹çš„å˜é‡ï¼Œä¸ºå…¶èµ‹äºˆçš„åˆå§‹å€¼ä¸º 10ï¼š 1var count: Int = 10 Javaä¸­æˆ‘ä»¬ä¼šå†™æˆint count = 10;ï¼Œç±»å‹å†™åœ¨å‰é¢ï¼Œç»“å°¾éœ€è¦åˆ†å·ã€‚ Int æ˜¯ä¸€ç§è¡¨ç¤ºæ•´æ•°çš„ç±»å‹ï¼Œå®ƒæ˜¯å¯ä»¥åœ¨ Kotlin ä¸­è¡¨ç¤ºçš„ä¼—å¤šæ•°å€¼ç±»å‹ä¹‹ä¸€ã€‚ä¸å…¶ä»–è¯­è¨€ç±»ä¼¼ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ Byteã€Shortã€Longã€Float å’Œ Doubleï¼Œå…·ä½“å–å†³äºæ‚¨çš„æ•°å€¼æ•°æ®ã€‚ var å…³é”®å­—è¡¨ç¤ºæ‚¨å¯ä»¥æ ¹æ®éœ€è¦ä¸º count é‡æ–°èµ‹å€¼ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°† count çš„å€¼ä» 10 æ›´æ”¹ä¸º 15ï¼š12var count: Int = 10 count = 15 ä¸è¿‡ï¼Œæœ‰äº›å€¼ä¸åº”æ›´æ”¹ã€‚å‡è®¾æœ‰ä¸€ä¸ªåä¸º languageName çš„ Stringã€‚å¦‚æœæ‚¨è¦ç¡®ä¿ languageName çš„å€¼å§‹ç»ˆä¸ºâ€œKotlinâ€ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ val å…³é”®å­—æ¥å£°æ˜ languageNameï¼š 1val languageName: String = &quot;Kotlin&quot; é€šè¿‡è¿™äº›å…³é”®å­—ï¼Œæ‚¨å¯ä»¥æ˜ç¡®æŒ‡å‡ºå“ªäº›å˜é‡çš„å€¼å¯ä»¥æ›´æ”¹ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦åŠ ä»¥åˆ©ç”¨ã€‚å¦‚æœå˜é‡å¼•ç”¨å¿…é¡»å¯é‡æ–°èµ‹å€¼ï¼Œåˆ™å°†å…¶å£°æ˜ä¸º varã€‚å¦åˆ™ï¼Œè¯·ä½¿ç”¨ valã€‚ ç±»å‹æ¨æ–­æ¥ç€å‰é¢çš„ç¤ºä¾‹æ¥è®²ï¼Œå½“æ‚¨ä¸º languageName èµ‹äºˆåˆå§‹å€¼æ—¶ï¼ŒKotlin ç¼–è¯‘å™¨å¯æ ¹æ®æ‰€èµ‹å€¼çš„ç±»å‹æ¥æ¨æ–­ç±»å‹ã€‚ ç”±äº â€œKotlinâ€ çš„å€¼çš„ç±»å‹ä¸º Stringï¼Œå› æ­¤ç¼–è¯‘å™¨æ¨æ–­ languageName ä¹Ÿä¸º Stringã€‚è¯·æ³¨æ„ï¼ŒKotlin æ˜¯ä¸€ç§é™æ€ç±»å‹çš„è¯­è¨€ã€‚è¿™æ„å‘³ç€ï¼Œç±»å‹åœ¨ç¼–è¯‘æ—¶è§£æä¸”ä»ä¸æ”¹å˜ã€‚ åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼ŒlanguageName æ¨æ–­ä¸º Stringï¼Œå› æ­¤æ‚¨æ— æ³•å¯¹å…¶è°ƒç”¨ä»»ä½•ä¸å±äº String ç±»çš„å‡½æ•°ï¼š12345val languageName = &quot;Kotlin&quot; val upperCaseName = languageName.toUpperCase() // Fails to compile languageName.inc() toUpperCase() æ˜¯ä¸€ä¸ªåªèƒ½å¯¹ String ç±»å‹çš„å˜é‡è°ƒç”¨çš„å‡½æ•°ã€‚ç”±äº Kotlin ç¼–è¯‘å™¨å·²å°† languageName æ¨æ–­ä¸º Stringï¼Œå› æ­¤æ‚¨å¯ä»¥å®‰å…¨åœ°è°ƒç”¨ toUpperCase()ã€‚ä¸è¿‡ï¼Œinc() æ˜¯ä¸€ä¸ª Int è¿ç®—ç¬¦å‡½æ•°ï¼Œå› æ­¤æ— æ³•å¯¹ String è°ƒç”¨å®ƒã€‚åˆ©ç”¨ Kotlin çš„ç±»å‹æ¨æ–­ï¼Œæ‚¨æ—¢èƒ½ç¡®ä¿ä»£ç ç®€æ´ï¼Œåˆèƒ½ç¡®ä¿ç±»å‹å®‰å…¨ã€‚ Null å®‰å…¨åœ¨æŸäº›è¯­è¨€ä¸­ï¼Œå¯ä»¥å£°æ˜å¼•ç”¨ç±»å‹å˜é‡è€Œä¸æ˜ç¡®æä¾›åˆå§‹å€¼ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå˜é‡é€šå¸¸åŒ…å« null å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒKotlin å˜é‡ä¸èƒ½æŒæœ‰ null å€¼ã€‚è¿™æ„å‘³ç€ä»¥ä¸‹ä»£ç æ®µæ— æ•ˆï¼š 12// Fails to compile val languageName: String = null è¦ä½¿å˜é‡æŒæœ‰ null å€¼ï¼Œå®ƒå¿…é¡»æ˜¯å¯ä¸º null ç±»å‹ã€‚æ‚¨å¯ä»¥åœ¨å˜é‡ç±»å‹åé¢åŠ ä¸Š ? åç¼€ï¼Œå°†å˜é‡æŒ‡å®šä¸ºå¯ä¸º nullï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š1val languageName: String? = null æŒ‡å®š String? ç±»å‹åï¼Œæ‚¨å¯ä»¥ä¸º languageName èµ‹äºˆ String å€¼æˆ– nullã€‚ æ‚¨å¿…é¡»å°å¿ƒå¤„ç†å¯ä¸º null çš„å˜é‡ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°å¯æ€•çš„ NullPointerExceptionã€‚ä¾‹å¦‚ï¼Œåœ¨ Java ä¸­ï¼Œå¦‚æœæ‚¨å°è¯•å¯¹ null å€¼è°ƒç”¨æ–¹æ³•ï¼Œæ‚¨çš„ç¨‹åºä¼šå‘ç”Ÿå´©æºƒã€‚ æ¡ä»¶è¯­å¥Kotlin æä¾›äº†å‡ ç§ç”¨æ¥å®ç°æ¡ä»¶é€»è¾‘çš„æœºåˆ¶ï¼Œå…¶ä¸­æœ€å¸¸è§çš„æ˜¯ if-else è¯­å¥ã€‚å¦‚æœ if å…³é”®å­—åé¢æ‹¬åœ¨åœ†æ‹¬å·å†…çš„è¡¨è¾¾å¼æ±‚å€¼ä¸º trueï¼Œåˆ™ä¼šæ‰§è¡Œè¯¥åˆ†æ”¯ä¸­çš„ä»£ç ï¼ˆå³ï¼Œç´§è·Ÿåœ¨åé¢çš„æ‹¬åœ¨å¤§æ‹¬å·å†…çš„ä»£ç ï¼‰ã€‚å¦åˆ™ï¼Œä¼šæ‰§è¡Œ else åˆ†æ”¯ä¸­çš„ä»£ç ã€‚12345if (count == 42) { println(&quot;I have the answer.&quot;) } else { println(&quot;The answer eludes me.&quot;) } æ‚¨å¯ä»¥ä½¿ç”¨ else if è¡¨ç¤ºå¤šä¸ªæ¡ä»¶ã€‚è¿™æ ·ï¼Œæ‚¨å°±å¯ä»¥åœ¨å•ä¸ªæ¡ä»¶è¯­å¥ä¸­è¡¨ç¤ºæ›´ç²¾ç»†ä¸”æ›´å¤æ‚çš„é€»è¾‘ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š1234567if (count == 42) { println(&quot;I have the answer.&quot;) } else if (count &gt; 35) { println(&quot;The answer is close.&quot;) } else { println(&quot;The answer eludes me.&quot;) } æ¡ä»¶è¯­å¥å¯¹äºè¡¨ç¤ºæœ‰çŠ¶æ€çš„é€»è¾‘å¾ˆæœ‰ç”¨ï¼Œä½†æ‚¨å¯èƒ½ä¼šå‘ç°ï¼Œç¼–å†™è¿™äº›è¯­å¥æ—¶ä¼šé‡å¤ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå°±æ˜¯åœ¨æ¯ä¸ªåˆ†æ”¯ä¸­è¾“å‡ºä¸€ä¸ª Stringã€‚ä¸ºäº†é¿å…è¿™ç§é‡å¤ï¼ŒKotlin æä¾›äº†æ¡ä»¶è¡¨è¾¾å¼ã€‚æœ€åä¸€ä¸ªç¤ºä¾‹å¯ä»¥é‡æ–°ç¼–å†™å¦‚ä¸‹ï¼š123456789val answerString: String = if (count == 42) { &quot;I have the answer.&quot; } else if (count &gt; 35) { &quot;The answer is close.&quot; } else { &quot;The answer eludes me.&quot; } println(answerString) æ¯ä¸ªæ¡ä»¶åˆ†æ”¯éƒ½éšå¼åœ°è¿”å›å…¶æœ€åä¸€è¡Œä¸Šçš„è¡¨è¾¾å¼çš„ç»“æœï¼Œå› æ­¤æ‚¨æ— éœ€ä½¿ç”¨ return å…³é”®å­—ã€‚ç”±äºå…¨éƒ¨ä¸‰ä¸ªåˆ†æ”¯çš„ç»“æœéƒ½æ˜¯ String ç±»å‹ï¼Œå› æ­¤ if-else è¡¨è¾¾å¼çš„ç»“æœä¹Ÿæ˜¯ String ç±»å‹ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæ ¹æ® if-else è¡¨è¾¾å¼çš„ç»“æœä¸º answerString èµ‹äºˆäº†ä¸€ä¸ªåˆå§‹å€¼ã€‚å¯ä»¥åˆ©ç”¨ç±»å‹æ¨æ–­æ¥çœç•¥ answerString çš„æ˜¾å¼ç±»å‹å£°æ˜ï¼Œä½†ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œé€šå¸¸æœ€å¥½æ·»åŠ è¯¥å£°æ˜ã€‚ æ³¨æ„ï¼šKotlin ä¸åŒ…å«ä¼ ç»Ÿçš„ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œè€Œæ˜¯å€¾å‘äºä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼ã€‚ éšç€æ¡ä»¶è¯­å¥çš„å¤æ‚æ€§ä¸æ–­å¢åŠ ï¼Œæ‚¨å¯ä»¥è€ƒè™‘å°† if-else è¡¨è¾¾å¼æ›¿æ¢ä¸º when è¡¨è¾¾å¼ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š1234567val answerString = when { count == 42 -&gt; &quot;I have the answer.&quot; count &gt; 35 -&gt; &quot;The answer is close.&quot; else -&gt; &quot;The answer eludes me.&quot; } println(answerString) when è¡¨è¾¾å¼ä¸­çš„æ¯ä¸ªåˆ†æ”¯éƒ½ç”±ä¸€ä¸ªæ¡ä»¶ã€ä¸€ä¸ªç®­å¤´ (-&gt;) å’Œä¸€ä¸ªç»“æœæ¥è¡¨ç¤ºã€‚å¦‚æœç®­å¤´å·¦ä¾§çš„æ¡ä»¶æ±‚å€¼ä¸º trueï¼Œåˆ™ä¼šè¿”å›å³ä¾§çš„è¡¨è¾¾å¼ç»“æœã€‚è¯·æ³¨æ„ï¼Œæ‰§è¡Œå¹¶ä¸æ˜¯ä»ä¸€ä¸ªåˆ†æ”¯è·³è½¬åˆ°ä¸‹ä¸€ä¸ªåˆ†æ”¯ã€‚when è¡¨è¾¾å¼ç¤ºä¾‹ä¸­çš„ä»£ç åœ¨åŠŸèƒ½ä¸Šä¸ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­çš„ä»£ç ç­‰æ•ˆï¼Œä½†å¯ä»¥è¯´æ›´æ˜“è¯»ã€‚ Kotlin çš„æ¡ä»¶è¯­å¥å½°æ˜¾äº†å®ƒçš„ä¸€é¡¹æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œå³æ™ºèƒ½ç±»å‹è½¬æ¢ã€‚æ‚¨ä¸å¿…ä½¿ç”¨å®‰å…¨è°ƒç”¨è¿ç®—ç¬¦æˆ–é null æ–­è¨€è¿ç®—ç¬¦æ¥å¤„ç†å¯ä¸º null çš„å€¼ï¼Œè€Œæ˜¯å¯ä»¥ä½¿ç”¨æ¡ä»¶è¯­å¥æ¥æ£€æŸ¥å˜é‡æ˜¯å¦åŒ…å«å¯¹ null å€¼çš„å¼•ç”¨ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š12345val languageName: String? = null if (languageName != null) { // No need to write languageName?.toUpperCase() println(languageName.toUpperCase()) }å¦‚æœä»£ç ä¸­å·²ç»è¿›è¡Œnullæ£€æŸ¥ï¼Œå°±ä¸ç”¨å†™languageName?é‡Œçš„é—®å·äº†ã€‚ åœ¨æ¡ä»¶åˆ†æ”¯ä¸­ï¼ŒlanguageName å¯èƒ½ä¼šè¢«è§†ä¸ºä¸å¯ä¸º nullã€‚Kotlin éå¸¸æ™ºèƒ½ï¼Œèƒ½å¤Ÿæ˜ç™½æ‰§è¡Œåˆ†æ”¯çš„æ¡ä»¶æ˜¯ languageName ä¸æŒæœ‰ null å€¼ï¼Œå› æ­¤æ‚¨ä¸å¿…åœ¨è¯¥åˆ†æ”¯ä¸­å°† languageName è§†ä¸ºå¯ä¸º nullã€‚ å‡½æ•°æ‚¨å¯ä»¥å°†ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼å½’å…¥ä¸€ä¸ªå‡½æ•°ã€‚æ‚¨å¯ä»¥å°†ç›¸åº”çš„è¡¨è¾¾å¼å°è£…åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å¹¶è°ƒç”¨è¯¥å‡½æ•°ï¼Œè€Œä¸å¿…åœ¨æ¯æ¬¡éœ€è¦æŸä¸ªç»“æœæ—¶éƒ½é‡å¤åŒä¸€ç³»åˆ—çš„è¡¨è¾¾å¼ã€‚ è¦å£°æ˜å‡½æ•°ï¼Œè¯·ä½¿ç”¨ fun å…³é”®å­—ï¼Œåè·Ÿå‡½æ•°åç§°ã€‚æ¥ä¸‹æ¥ï¼Œå®šä¹‰å‡½æ•°æ¥å—çš„è¾“å…¥ç±»å‹ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œå¹¶å£°æ˜å®ƒè¿”å›çš„è¾“å‡ºç±»å‹ã€‚å‡½æ•°çš„ä¸»ä½“ç”¨äºå®šä¹‰åœ¨è°ƒç”¨å‡½æ•°æ—¶è°ƒç”¨çš„è¡¨è¾¾å¼ã€‚ ä»¥å‰é¢çš„ç¤ºä¾‹ä¸ºåŸºç¡€ï¼Œä¸‹é¢ç»™å‡ºäº†ä¸€ä¸ªå®Œæ•´çš„ Kotlin å‡½æ•°ï¼š12345678fun generateAnswerString(): String { val answerString = if (count == 42) { &quot;I have the answer.&quot; } else { &quot;The answer eludes me&quot; } return answerString } ä¸Šé¢ç¤ºä¾‹ä¸­çš„å‡½æ•°åä¸º generateAnswerStringã€‚å®ƒä¸æ¥å—ä»»ä½•è¾“å…¥ã€‚å®ƒä¼šè¾“å‡º String ç±»å‹çš„ç»“æœã€‚è¦è°ƒç”¨å‡½æ•°ï¼Œè¯·ä½¿ç”¨å‡½æ•°åç§°ï¼Œåè·Ÿè°ƒç”¨è¿ç®—ç¬¦ (())ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ generateAnswerString() çš„ç»“æœå¯¹ answerString å˜é‡è¿›è¡Œäº†åˆå§‹åŒ–ã€‚1val answerString = generateAnswerString() å‡½æ•°å¯ä»¥æ¥å—å‚æ•°è¾“å…¥ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š123456789fun generateAnswerString(countThreshold: Int): String { val answerString = if (count &gt; countThreshold) { &quot;I have the answer.&quot; } else { &quot;The answer eludes me.&quot; } return answerString } åœ¨å£°æ˜å‡½æ•°æ—¶ï¼Œæ‚¨å¯ä»¥æŒ‡å®šä»»æ„æ•°é‡çš„å‚æ•°åŠå…¶ç±»å‹ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒgenerateAnswerString() æ¥å—ä¸€ä¸ªåä¸º countThreshold ä¸”ç±»å‹ä¸º Int çš„å‚æ•°ã€‚åœ¨å‡½æ•°ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å‚æ•°çš„åç§°æ¥å¼•ç”¨å‚æ•°ã€‚ è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œæ‚¨å¿…é¡»åœ¨å‡½æ•°è°ƒç”¨çš„åœ†æ‹¬å·å†…æ·»åŠ ä¸€ä¸ªå‚æ•°ï¼š1val answerString = generateAnswerString(42) ç®€åŒ–å‡½æ•°å£°æ˜generateAnswerString() æ˜¯ä¸€ä¸ªç›¸å½“ç®€å•çš„å‡½æ•°ã€‚è¯¥å‡½æ•°å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œç„¶åç«‹å³è¿”å›ç»“æœã€‚ä»å‡½æ•°è¿”å›å•ä¸ªè¡¨è¾¾å¼çš„ç»“æœæ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡ç›´æ¥è¿”å›å‡½æ•°ä¸­åŒ…å«çš„ if-else è¡¨è¾¾å¼çš„ç»“æœæ¥è·³è¿‡å£°æ˜å±€éƒ¨å˜é‡ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š1234567fun generateAnswerString(countThreshold: Int): String { return if (count &gt; countThreshold) { &quot;I have the answer.&quot; } else { &quot;The answer eludes me.&quot; } } æ‚¨è¿˜å¯ä»¥å°† return å…³é”®å­—æ›¿æ¢ä¸ºèµ‹å€¼è¿ç®—ç¬¦ï¼š12345fun generateAnswerString(countThreshold: Int): String = if (count &gt; countThreshold) { &quot;I have the answer&quot; } else { &quot;The answer eludes me&quot; } åŒ¿åå‡½æ•°å¹¶éæ¯ä¸ªå‡½æ•°éƒ½éœ€è¦ä¸€ä¸ªåç§°ã€‚æŸäº›å‡½æ•°ç”±å…¶è¾“å…¥å’Œè¾“å‡ºæ›´ç›´æ¥åœ°è¿›è¡Œæ ‡è¯†ã€‚è¿™äº›å‡½æ•°ç§°ä¸ºâ€œåŒ¿åå‡½æ•°â€ã€‚æ‚¨å¯ä»¥ä¿ç•™å¯¹æŸä¸ªåŒ¿åå‡½æ•°çš„å¼•ç”¨ï¼Œä»¥ä¾¿æ—¥åä½¿ç”¨æ­¤å¼•ç”¨æ¥è°ƒç”¨è¯¥åŒ¿åå‡½æ•°ã€‚ä¸å…¶ä»–å¼•ç”¨ç±»å‹ä¸€æ ·ï¼Œæ‚¨ä¹Ÿå¯ä»¥åœ¨åº”ç”¨ä¸­ä¼ é€’å¼•ç”¨ã€‚123val stringLengthFunc: (String) -&gt; Int = { input -&gt; input.length }å°æ‹¬å·é‡Œè¡¨ç¤ºä¼ å…¥çš„ç±»å‹ï¼Œ-&gt;å³è¾¹æ˜¯è¿”å›ç±»å‹ã€‚inputä»£è¡¨è¾“å…¥çš„å˜é‡ã€‚ ä¸å‘½åå‡½æ•°ä¸€æ ·ï¼ŒåŒ¿åå‡½æ•°ä¹Ÿå¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„è¡¨è¾¾å¼ã€‚å‡½æ•°çš„è¿”å›å€¼æ˜¯æœ€ç»ˆè¡¨è¾¾å¼çš„ç»“æœã€‚ åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒstringLengthFunc åŒ…å«å¯¹ä¸€ä¸ªåŒ¿åå‡½æ•°çš„å¼•ç”¨ï¼Œè¯¥å‡½æ•°å°† String å½“ä½œè¾“å…¥ï¼Œå¹¶å°†è¾“å…¥ String çš„é•¿åº¦ä½œä¸º Int ç±»å‹çš„è¾“å‡ºè¿”å›ã€‚å› æ­¤ï¼Œè¯¥å‡½æ•°çš„ç±»å‹è¡¨ç¤ºä¸º (String) -&gt; Intã€‚ä¸è¿‡ï¼Œæ­¤ä»£ç ä¸ä¼šè°ƒç”¨è¯¥å‡½æ•°ã€‚è¦æ£€ç´¢è¯¥å‡½æ•°çš„ç»“æœï¼Œæ‚¨å¿…é¡»åƒè°ƒç”¨å‘½åå‡½æ•°ä¸€æ ·è°ƒç”¨è¯¥å‡½æ•°ã€‚è°ƒç”¨ stringLengthFunc æ—¶ï¼Œæ‚¨å¿…é¡»æä¾› Stringï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š12345val stringLengthFunc: (String) -&gt; Int = { input -&gt; input.length }val stringLength: Int = stringLengthFunc(&quot;Android&quot;) é«˜é˜¶å‡½æ•°ä¸€ä¸ªå‡½æ•°å¯ä»¥å°†å¦ä¸€ä¸ªå‡½æ•°å½“ä½œå‚æ•°ã€‚å°†å…¶ä»–å‡½æ•°ç”¨ä½œå‚æ•°çš„å‡½æ•°ç§°ä¸ºâ€œé«˜é˜¶å‡½æ•°â€ã€‚æ­¤æ¨¡å¼å¯¹ç»„ä»¶ä¹‹é—´çš„é€šä¿¡ï¼ˆå…¶æ–¹å¼ä¸åœ¨ Java ä¸­ä½¿ç”¨å›è°ƒæ¥å£ç›¸åŒï¼‰å¾ˆæœ‰ç”¨ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°çš„ç¤ºä¾‹ï¼š1234fun stringMapper(str: String, mapper: (String) -&gt; Int): Int { // Invoke function return mapper(str) }stringMapper() å‡½æ•°æ¥å—ä¸€ä¸ª String ä»¥åŠä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ ¹æ®æ‚¨ä¼ é€’ç»™å®ƒçš„ String æ¥æ¨å¯¼ Int å€¼ã€‚ è¦è°ƒç”¨ stringMapper()ï¼Œæ‚¨å¯ä»¥ä¼ é€’ä¸€ä¸ª String å’Œä¸€ä¸ªæ»¡è¶³å…¶ä»–è¾“å…¥å‚æ•°çš„å‡½æ•°ï¼ˆå³ï¼Œå°† String å½“ä½œè¾“å…¥å¹¶è¾“å‡º Int çš„å‡½æ•°ï¼‰ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š123stringMapper(&quot;Android&quot;, { input -&gt; input.length }) å¦‚æœåŒ¿åå‡½æ•°æ˜¯åœ¨æŸä¸ªå‡½æ•°ä¸Šå®šä¹‰çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œåˆ™æ‚¨å¯ä»¥åœ¨ç”¨äºè°ƒç”¨è¯¥å‡½æ•°çš„åœ†æ‹¬å·ä¹‹å¤–ä¼ é€’å®ƒï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š123stringMapper(&quot;Android&quot;) { input -&gt; input.length } æ‚¨å¯ä»¥åœ¨æ•´ä¸ª Kotlin æ ‡å‡†åº“ä¸­æ‰¾åˆ°åŒ¿åå‡½æ•°ã€‚ Javaä¸­å¯èƒ½è¦å®šä¹‰æ¥å£æ¥å®ç°ç±»ä¼¼åŠŸèƒ½ã€‚Kotlinä¸­éœ€è¦çš„æ˜¯æ»¡è¶³è¦æ±‚çš„æ–¹æ³•å³å¯ã€‚ ç¤ºä¾‹ï¼Œåœ¨viewModelä¸­å®šä¹‰å¦‚ä¸‹3ä¸ªå‡½æ•°123456789101112val stringLengthFunc: (String) -&gt; Int = { inputStr -&gt; inputStr.length}val stringLengthDouble: (String) -&gt; Int = { inputStr -&gt; inputStr.length * 2}fun stringMapper(str: String, mapper: (String) -&gt; Int): Int { // è°ƒç”¨ä¼ å…¥çš„æ–¹æ³• return mapper(str)}ä½¿ç”¨å‡½æ•°123val inputStr = &quot;Rust Fisher&quot;var res1: Int = viewModel.stringMapper(inputStr, viewModel.stringLengthFunc)var res2: Int = viewModel.stringMapper(inputStr, viewModel.stringLengthDouble) ç±»åˆ°ç›®å‰ä¸ºæ­¢æåˆ°çš„æ‰€æœ‰ç±»å‹éƒ½å†…ç½®åœ¨ Kotlin ç¼–ç¨‹è¯­è¨€ä¸­ã€‚å¦‚æœæ‚¨æƒ³è¦æ·»åŠ è‡ªå·±çš„è‡ªå®šä¹‰ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ class å…³é”®å­—æ¥å®šä¹‰ç±»ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š1class Car åƒå‰é¢çš„ä¾‹å­1234567891011121314151617import androidx.lifecycle.ViewModelclass KotlinGuideViewModel : ViewModel() { val stringLengthFunc: (String) -&gt; Int = { inputStr -&gt; inputStr.length } val stringLengthDouble: (String) -&gt; Int = { inputStr -&gt; inputStr.length * 2 } fun stringMapper(str: String, mapper: (String) -&gt; Int): Int { // è°ƒç”¨ä¼ å…¥çš„æ–¹æ³• return mapper(str) }} å±æ€§ç±»ä½¿ç”¨å±æ€§æ¥è¡¨ç¤ºçŠ¶æ€ã€‚å±æ€§æ˜¯ç±»çº§å˜é‡ï¼Œå¯ä»¥åŒ…å« getterã€setter å’Œåå¤‡å­—æ®µã€‚ç”±äºæ±½è½¦éœ€è¦è½®å­æ¥é©±åŠ¨ï¼Œå› æ­¤æ‚¨å¯ä»¥æ·»åŠ  Wheel å¯¹è±¡çš„åˆ—è¡¨ä½œä¸º Car çš„å±æ€§ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š123class Car { val wheels = listOf&lt;Wheel&gt;() }è¯·æ³¨æ„ï¼Œwheels æ˜¯ä¸€ä¸ª public valï¼Œè¿™æ„å‘³ç€ï¼Œå¯ä»¥ä» Car ç±»å¤–éƒ¨è®¿é—® wheelsï¼Œå¹¶ä¸”ä¸èƒ½ä¸ºå…¶é‡æ–°èµ‹å€¼ã€‚å¦‚æœè¦è·å– Car çš„å®ä¾‹ï¼Œæ‚¨å¿…é¡»å…ˆè°ƒç”¨å…¶æ„é€ å‡½æ•°ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ‚¨ä¾¿å¯ä»¥è®¿é—®å®ƒçš„ä»»ä½•å¯è®¿é—®å±æ€§ã€‚12val car = Car() // construct a Car val wheels = car.wheels // retrieve the wheels value from the Car å¦‚æœè¦è‡ªå®šä¹‰è½®å­ï¼Œæ‚¨å¯ä»¥å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰æ„é€ å‡½æ•°ï¼Œç”¨æ¥æŒ‡å®šå¦‚ä½•åˆå§‹åŒ–ç±»å±æ€§ï¼š1class Car(val wheels: List&lt;Wheel&gt;) åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œç±»æ„é€ å‡½æ•°å°† List å½“ä½œæ„é€ å‡½æ•°å‚æ•°ï¼Œå¹¶ä½¿ç”¨è¯¥å‚æ•°æ¥åˆå§‹åŒ–å…¶ wheels å±æ€§ã€‚ ç±»å‡½æ•°å’Œå°è£…ç±»ä½¿ç”¨å‡½æ•°å¯¹è¡Œä¸ºå»ºæ¨¡ã€‚å‡½æ•°å¯ä»¥ä¿®æ”¹çŠ¶æ€ï¼Œä»è€Œå¸®åŠ©æ‚¨åªå…¬å¼€å¸Œæœ›å…¬å¼€çš„æ•°æ®ã€‚è¿™ç§è®¿é—®æ§åˆ¶æœºåˆ¶å±äºä¸€ä¸ªæ›´å¤§çš„é¢å‘å¯¹è±¡çš„æ¦‚å¿µï¼ˆç§°ä¸ºâ€œå°è£…â€ï¼‰ã€‚ åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼ŒdoorLock å±æ€§å¯¹ Car ç±»å¤–éƒ¨çš„ä¸€åˆ‡éƒ½ä¸å…¬å¼€ã€‚è¦è§£é”æ±½è½¦ï¼Œæ‚¨å¿…é¡»è°ƒç”¨ unlockDoor() å‡½æ•°å¹¶ä¼ å…¥æœ‰æ•ˆçš„â€œé’¥åŒ™â€ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š12345678class Car(val wheels: List&lt;Wheel&gt;) { private val doorLock: DoorLock = ... fun unlockDoor(key: Key): Boolean { // Return true if key is valid for door lock, false otherwise } } å¦‚æœæ‚¨æƒ³è¦è‡ªå®šä¹‰å±æ€§çš„å¼•ç”¨æ–¹å¼ï¼Œåˆ™å¯ä»¥æä¾›è‡ªå®šä¹‰çš„ getter å’Œ setterã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³è¦å…¬å¼€å±æ€§çš„ getter è€Œé™åˆ¶è®¿é—®å…¶ setterï¼Œåˆ™å¯ä»¥å°†è¯¥ setter æŒ‡å®šä¸º privateï¼š1234567891011class Car(val wheels: List&lt;Wheel&gt;) { private val doorLock: DoorLock = ... val gallonsOfFuelInTank: Int = 15 private set fun unlockDoor(key: Key): Boolean { // Return true if key is valid for door lock, false otherwise } } é€šè¿‡ç»“åˆä½¿ç”¨å±æ€§å’Œå‡½æ•°ï¼Œæ‚¨å¯ä»¥åˆ›å»ºèƒ½å¤Ÿå¯¹æ‰€æœ‰ç±»å‹çš„å¯¹è±¡å»ºæ¨¡çš„ç±»ã€‚ äº’æ“ä½œæ€§Kotlin æœ€é‡è¦çš„åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯å®ƒä¸ Java ä¹‹é—´æµç•…çš„äº’æ“ä½œæ€§ã€‚ç”±äº Kotlin ä»£ç å¯ç¼–è¯‘ä¸º JVM å­—èŠ‚ç ï¼Œå› æ­¤ Kotlin ä»£ç å¯ç›´æ¥è°ƒç”¨ Java ä»£ç ï¼Œåä¹‹äº¦ç„¶ã€‚è¿™æ„å‘³ç€ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä» Kotlin åˆ©ç”¨ç°æœ‰çš„ Java åº“ã€‚æ­¤å¤–ï¼Œç»å¤§å¤šæ•° Android API éƒ½æ˜¯ç”¨ Java ç¼–å†™çš„ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä» Kotlin è°ƒç”¨å®ƒä»¬ã€‚","link":"/2020/04/10/Kotlin/kotlin-breif-intro/"},{"title":"å¾®ä¿¡å°ç¨‹åº å±…ä¸­å¸ƒå±€css","text":"å±…ä¸­æ”¾ç½®å…ƒç´ æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„éœ€æ±‚ã€‚å¯ä»¥æ°´å¹³å±…ä¸­ï¼Œå‚ç›´å±…ä¸­ã€‚åŒæ—¶æ°´å¹³å’Œå‚ç›´å±…ä¸­ç­‰ç­‰ã€‚åœ¨Androidçš„RelativeLayoutä¸­ï¼Œå¯ä»¥ä½¿ç”¨android:layout_centerInParent=&quot;true&quot;ã€‚åœ¨å°ç¨‹åºä¸­æˆ‘ä»¬è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ å±…ä¸­ç¤ºä¾‹ä¸‹é¢åˆ—ä¸¾å‡ ä¸ªå±…ä¸­çš„ä¾‹å­ã€‚ æ°´å¹³å±…ä¸­wxmlä¸­æ”¾ç½®ä¸€ä¸ªviewã€‚123&lt;view class=&quot;flex-center-in-row&quot;&gt; Rust Fisher æ°´å¹³æ–¹å‘å±…ä¸­&lt;/view&gt; wxssä¸­çš„classã€‚ä½¿ç”¨äº†flexå¸ƒå±€ï¼Œè®¾ç½®justify-content: center;ã€‚1234567.flex-center-in-row { background: #eaeaea; display: flex; flex-direction: row; justify-content: center; height: 40px;} å‚ç›´å±…ä¸­å‚ç›´æ–¹å‘å±…ä¸­ã€‚123&lt;view class=&quot;flex-center-in-column&quot;&gt; Rust Fisher å‚ç›´æ–¹å‘å±…ä¸­&lt;/view&gt; ç¡®å®šå®ƒçš„é«˜åº¦ï¼Œè®¾ç½®display: flex; align-items: center;ã€‚12345.flex-center-in-column { display: flex; align-items: center; height: 60px;} æ°´å¹³å¹¶ä¸”å‚ç›´å±…ä¸­è¦å±…ä¸­ï¼Œéœ€è¦ç¡®å®šå®½å’Œé«˜ã€‚123&lt;view class=&quot;flex-center-in-cube&quot;&gt; Rust Fisher æ–¹å—å†…å±…ä¸­&lt;/view&gt; éœ€è¦è®¾ç½®flexå¸ƒå±€ï¼Œjustify-content: center; align-items: center;ã€‚1234567.flex-center-in-cube { width: 100%; height: 60px; display: flex; justify-content: center; align-items: center;} å°ç»“ä»ä¸Šé¢çš„å‡ ä¸ªä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå®ƒä»¬éƒ½ç”¨äº†flexå¸ƒå±€ã€‚å‚ç›´å±…ä¸­éœ€è¦è®¾ç½®align-items: center;ï¼›æ°´å¹³å±…ä¸­éœ€è¦è®¾ç½®justify-content: center;ã€‚ å·¥ç¨‹æ”¾åœ¨ï¼š https://github.com/AnRFDev/tutorial-miniprogram æ›´å¤šé˜…è¯»: å°ç¨‹åºå¼€å‘è®°å½•","link":"/2020/02/03/Miniprogram/wx-mini-css_center_tutorial/"},{"title":"Android SurfaceView TextureView é¢„è§ˆCameraï¼Œè·å–NV21æ•°æ®","text":"win7 Android Studio 3.0.1 æœ¬æ–‡ç›®çš„ï¼šä½¿ç”¨ Camera API è¿›è¡Œè§†é¢‘çš„é‡‡é›†ï¼Œåˆ†åˆ«ä½¿ç”¨ SurfaceViewã€TextureView æ¥é¢„è§ˆ Camera æ•°æ®ï¼Œå–åˆ° NV21 çš„æ•°æ®å›è°ƒ å‡†å¤‡ä½¿ç”¨ç›¸æœºæƒé™1&lt;uses-permission android:name=&quot;android.permission.CAMERA&quot; /&gt;cameraé¢„è§ˆå›è°ƒä¸­é»˜è®¤ä½¿ç”¨NV21æ ¼å¼ã€‚ æ£€æŸ¥æ‰‹æœºæ˜¯å¦æ”¯æŒæ‘„åƒå¤´ã€‚ UIå‡†å¤‡12345&lt;!-- å…¨å±æ˜¾ç¤º --&gt;&lt;style name=&quot;FullScreenTheme&quot; parent=&quot;AppTheme&quot;&gt; &lt;item name=&quot;windowNoTitle&quot;&gt;true&lt;/item&gt; &lt;item name=&quot;android:windowFullscreen&quot;&gt;true&lt;/item&gt;&lt;/style&gt;æ‰¿è½½é¢„è§ˆå›¾åƒ1234&lt;FrameLayout android:id=&quot;@+id/camera_preview&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot; /&gt; ä½¿ç”¨ SurfaceView é¢„è§ˆ Cameraï¼Œå–åˆ°NV21æ•°æ®è‡ªå®šä¹‰CameraPreviewç»§æ‰¿SurfaceViewï¼Œå®ç°SurfaceHolder.Callbackæ¥å£ è·å–NV21æ•°æ®ï¼ŒCamera.setPreviewCallback() è¦æ”¾åœ¨ Camera.startPreview() ä¹‹å‰ã€‚ä½¿ç”¨Camera.PreviewCallbackè·å–é¢„è§ˆæ•°æ®å›è°ƒã€‚é»˜è®¤æ˜¯NV21æ ¼å¼ã€‚ surfaceChangedä¸­ï¼Œcameraå¯åŠ¨é¢„è§ˆå‰å¯ä»¥è¿›è¡Œè®¾ç½®ï¼Œä¾‹å¦‚è®¾ç½®å°ºå¯¸ï¼Œè°ƒæ•´æ–¹å‘123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778/** * cameraé¢„è§ˆè§†å›¾ * Created by Rust on 2018/2/26. */public class CameraPreview extends SurfaceView implements SurfaceHolder.Callback { private static final String TAG = &quot;rustApp&quot;; private SurfaceHolder mHolder; private Camera mCamera; private int mFrameCount = 0; public CameraPreview(Context context) { super(context); } public CameraPreview(Context context, Camera camera) { super(context); mCamera = camera; mHolder = getHolder(); mHolder.addCallback(this); mHolder.setType(SurfaceHolder.SURFACE_TYPE_PUSH_BUFFERS); } public void setCamera(Camera c) { this.mCamera = c; } @Override public void surfaceCreated(SurfaceHolder holder) { // å¼€å¯é¢„è§ˆ try { mCamera.setPreviewDisplay(holder); mCamera.startPreview(); } catch (IOException e) { Log.d(TAG, &quot;Error setting camera preview: &quot; + e.getMessage()); } } @Override public void surfaceDestroyed(SurfaceHolder holder) { // å¯åœ¨æ­¤é‡Šæ”¾camera } @Override public void surfaceChanged(SurfaceHolder holder, int format, int w, int h) { // è‹¥éœ€è¦æ—‹è½¬ã€æ›´æ”¹å¤§å°æˆ–é‡æ–°è®¾ç½®ï¼Œè¯·ç¡®ä¿è¯å·²åœæ­¢é¢„è§ˆ if (mHolder.getSurface() == null) { return; } try { mCamera.stopPreview(); } catch (Exception e) { // ignore: tried to stop a non-existent preview } Camera.Parameters parameters = mCamera.getParameters(); // ImageFormat.NV21 == 17 Log.d(TAG, &quot;parameters.getPreviewFormat(): &quot; + parameters.getPreviewFormat()); if (this.getResources().getConfiguration().orientation != Configuration.ORIENTATION_LANDSCAPE) { mCamera.setDisplayOrientation(90); } else { mCamera.setDisplayOrientation(0); } try { mCamera.setPreviewDisplay(mHolder); mCamera.setPreviewCallback(mCameraPreviewCallback); // å›è°ƒè¦æ”¾åœ¨ startPreview() ä¹‹å‰ mCamera.startPreview(); } catch (Exception e) { Log.d(TAG, &quot;Error starting camera preview: &quot; + e.getMessage()); } } private Camera.PreviewCallback mCameraPreviewCallback = new Camera.PreviewCallback() { @Override public void onPreviewFrame(byte[] data, Camera camera) { mFrameCount++; Log.d(TAG, &quot;onPreviewFrame: data.length=&quot; + data.length + &quot;, frameCount=&quot; + mFrameCount); } };} ä¸ºäº†é˜²æ­¢é˜»å¡UIçº¿ç¨‹ï¼Œåœ¨å­çº¿ç¨‹ä¸­æ‰“å¼€cameraã€‚cameraå¸¸æ”¾åœ¨try catchä¸­ä½¿ç”¨ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071public class MainActivity extends AppCompatActivity { private static final String TAG = &quot;rustApp&quot;; private Camera mCamera; private CameraPreview mPreview; @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); new InitCameraThread().start(); } @Override protected void onResume() { if (null == mCamera) { if (safeCameraOpen()) { mPreview.setCamera(mCamera); // é‡æ–°è·å–cameraæ“ä½œæƒ } else { Log.e(TAG, &quot;æ— æ³•æ“ä½œcamera&quot;); } } super.onResume(); } @Override protected void onPause() { super.onPause(); releaseCamera(); } private boolean safeCameraOpen() { boolean qOpened = false; try { releaseCamera(); mCamera = Camera.open(); qOpened = (mCamera != null); } catch (Exception e) { Log.e(TAG, &quot;failed to open Camera&quot;); e.printStackTrace(); } return qOpened; } private void releaseCamera() { if (mCamera != null) { mCamera.setPreviewCallback(null); mCamera.release(); // release the camera for other applications mCamera = null; } } private class InitCameraThread extends Thread { @Override public void run() { super.run(); if (safeCameraOpen()) { Log.d(TAG, &quot;å¼€å¯æ‘„åƒå¤´&quot;); runOnUiThread(new Runnable() { @Override public void run() { mPreview = new CameraPreview(MainActivity.this, mCamera); FrameLayout preview = findViewById(R.id.camera_preview); preview.addView(mPreview); } }); } } }} ä½¿ç”¨ TextureView é¢„è§ˆ Cameraï¼Œå–åˆ°NV21æ•°æ®TextureViewå¯ç”¨äºæ˜¾ç¤ºå†…å®¹æµã€‚å†…å®¹æµå¯ä»¥æ˜¯è§†é¢‘æˆ–è€…OpenGLçš„åœºæ™¯ã€‚å†…å®¹æµå¯æ¥è‡ªåº”ç”¨è¿›ç¨‹æˆ–æ˜¯è¿œç¨‹å…¶å®ƒè¿›ç¨‹ã€‚ Textureviewå¿…é¡»åœ¨ç¡¬ä»¶åŠ é€Ÿå¼€å¯çš„çª—å£ä¸­ä½¿ç”¨ã€‚è‹¥æ˜¯è½¯è§£ï¼ŒTextureViewä¸ä¼šæ˜¾ç¤ºä¸œè¥¿ã€‚ ä¸åŒäºSurfaceViewï¼ŒTextureViewä¸ä¼šå»ºç«‹ä¸€ä¸ªå•ç‹¬çš„çª—å£ï¼Œè€Œæ˜¯åƒä¸€ä¸ªå¸¸è§„çš„Viewä¸€æ ·ï¼ˆä¸ªäººè®¤ä¸ºè¿™æ˜¯ä¸ªä¼˜ç‚¹ï¼‰ã€‚è¿™ä½¿å¾—TextureViewå¯ä»¥è¢«ç§»åŠ¨ï¼Œè½¬æ¢æˆ–æ˜¯æ·»åŠ åŠ¨ç”»ã€‚æ¯”å¦‚ï¼Œå¯ä»¥è°ƒç”¨myView.setAlpha(0.5f)å°†å…¶è®¾ç½®æˆåŠé€æ˜ã€‚ ä½¿ç”¨TextureViewå¾ˆç®€å•ï¼šè·å–åˆ°å®ƒçš„SurfaceTextureï¼Œä½¿ç”¨SurfaceTextureå‘ˆç°å†…å®¹ã€‚ CameraPreviewç»§æ‰¿äº†TextureViewï¼Œå¤–éƒ¨éœ€è¦ä¼ å…¥cameraå®ä¾‹ã€‚åœ¨onSurfaceTextureAvailableä¸­ï¼Œé…ç½®cameraï¼Œæ¯”å¦‚è®¾ç½®å›¾åƒæ–¹å‘ã€‚é€šè¿‡è®¾ç½®Camera.PreviewCallbackæ¥å–å¾—é¢„è§ˆæ•°æ®ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667import java.io.IOException;import android.content.Context;import android.content.res.Configuration;import android.graphics.SurfaceTexture;import android.hardware.Camera;import android.util.Log;import android.view.TextureView;public class CameraPreview extends TextureView implements TextureView.SurfaceTextureListener { private static final String TAG = &quot;rustApp&quot;; private Camera mCamera; public CameraPreview(Context context) { super(context); } public CameraPreview(Context context, Camera camera) { super(context); mCamera = camera; } public void setCamera(Camera camera) { this.mCamera = camera; } @Override public void onSurfaceTextureAvailable(SurfaceTexture surface, int width, int height) { Log.d(TAG, &quot;TextureView onSurfaceTextureAvailable&quot;); if (this.getResources().getConfiguration().orientation != Configuration.ORIENTATION_LANDSCAPE) { mCamera.setDisplayOrientation(90); } else { mCamera.setDisplayOrientation(0); } try { mCamera.setPreviewCallback(mCameraPreviewCallback); mCamera.setPreviewTexture(surface); // ä½¿ç”¨SurfaceTexture mCamera.startPreview(); } catch (IOException ioe) { // Something bad happened } } @Override public void onSurfaceTextureSizeChanged(SurfaceTexture surface, int width, int height) { Log.d(TAG, &quot;TextureView onSurfaceTextureSizeChanged&quot;); // Ignored, Camera does all the work for us } @Override public boolean onSurfaceTextureDestroyed(SurfaceTexture surface) { Log.d(TAG, &quot;TextureView onSurfaceTextureDestroyed&quot;); mCamera.stopPreview(); mCamera.release(); return true; } @Override public void onSurfaceTextureUpdated(SurfaceTexture surface) { // Invoked every time there's a new Camera preview frame } private Camera.PreviewCallback mCameraPreviewCallback = new Camera.PreviewCallback() { @Override public void onPreviewFrame(byte[] data, Camera camera) { Log.d(TAG, &quot;onPreviewFrame: data.length=&quot; + data.length); } };} æ“ä½œç•Œé¢TextureActã€‚è·å–cameraæ“ä½œæƒï¼Œåˆå§‹åŒ–CameraPreviewå¹¶æ·»åŠ åˆ°å¸ƒå±€ä¸­ã€‚ç¬¬ä¸€æ¬¡è·å–cameraæ—¶åœ¨å­çº¿ç¨‹ä¸­æ“ä½œã€‚ åœ¨onPauseä¸­é‡Šæ”¾cameraï¼ŒonResumeä¸­å°è¯•å–å›cameraæ§åˆ¶æƒã€‚è¿™æ ·åº”ç”¨æš‚æ—¶é€€å›åå°æ—¶ï¼Œå…¶ä»–åº”ç”¨å¯ä»¥æ“ä½œæ‘„åƒå¤´ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576public class TextureAct extends AppCompatActivity { private static final String TAG = &quot;rustApp&quot;; private Camera mCamera; private CameraPreview mPreview; @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.activity_texture); new InitCameraThread().start(); } @Override protected void onResume() { if (null == mCamera) { if (safeCameraOpen()) { mPreview.setCamera(mCamera); // é‡æ–°è·å–cameraæ“ä½œæƒ } else { Log.e(TAG, &quot;æ— æ³•æ“ä½œcamera&quot;); } } super.onResume(); } @Override protected void onPause() { super.onPause(); releaseCamera(); } @Override protected void onDestroy() { super.onDestroy(); releaseCamera(); } private boolean safeCameraOpen() { boolean qOpened = false; try { releaseCamera(); mCamera = Camera.open(); qOpened = (mCamera != null); } catch (Exception e) { Log.e(TAG, &quot;failed to open Camera&quot;); e.printStackTrace(); } return qOpened; } private void releaseCamera() { if (mCamera != null) { mCamera.setPreviewCallback(null); mCamera.release(); // release the camera for other applications mCamera = null; } } private class InitCameraThread extends Thread { @Override public void run() { super.run(); if (safeCameraOpen()) { Log.d(TAG, &quot;TextureAct å¼€å¯æ‘„åƒå¤´&quot;); runOnUiThread(new Runnable() { @Override public void run() { mPreview = new CameraPreview(TextureAct.this, mCamera); mPreview.setSurfaceTextureListener(mPreview); FrameLayout preview = findViewById(R.id.camera_preview); preview.addView(mPreview); } }); } } }}Textureviewå¿…é¡»åœ¨ç¡¬ä»¶åŠ é€Ÿå¼€å¯çš„çª—å£ä¸­ä½¿ç”¨ã€‚android:hardwareAccelerated=&quot;true&quot; é»˜è®¤çš„è¿™ä¸ªå±æ€§å°±æ˜¯trueï¼Œæ— éœ€å†è®¾ç½®ã€‚ æ¯æ¥åˆ°ä¸€å¸§æ•°æ®ï¼Œå°±ä¼šè°ƒç”¨ä¸€æ¬¡onSurfaceTextureUpdated()ã€‚é€šè¿‡è¿™ä¸ªæ¥å£ã€‚èƒ½å¤Ÿå°†ä¸Šæ¥çš„SurfaceTextureé€ç»™OpenGLå†å»å¤„ç†ã€‚ å‚è€ƒèµ„æ–™ Controlling the Camera - Android Developer Camera API - Android Developer TextureView - Android Developer","link":"/2020/01/11/Android/Android-Camera_SurfaceView_TextureView_get_nv21/"},{"title":"Android Camera API éŸ³è§†é¢‘é‡‡é›†ã€ç¼–ç ã€å°åŒ…æˆmp4","text":"win7 Android Studio 3.0.1 ç›¸å…³ä»£ç è¯·å‚é˜…ï¼š https://github.com/RustFisher/android-CameraRecorder æ¦‚è¿°æœ¬æ–‡ç›®çš„ï¼šä½¿ç”¨ Android Camera API å®ŒæˆéŸ³è§†é¢‘çš„é‡‡é›†ã€ç¼–ç ã€å°åŒ…æˆ mp4 è¾“å‡º åŸºäºandroid.hardware.Cameraï¼Œåˆ›å»ºä¸€ä¸ªæ¨ªå±åº”ç”¨ï¼Œå®æ—¶é¢„è§ˆæ‘„åƒå¤´å›¾åƒï¼Œå®ç°å½•åƒå¹¶è¾“å‡ºMP4çš„åŠŸèƒ½ã€‚è¿™é‡Œä¸ä½¿ç”¨Camera2ã€‚ ç”³è¯·æƒé™123456&lt;!-- éœ€è¦å½•åˆ¶éŸ³è§†é¢‘æƒé™å’Œå†™å¤–éƒ¨å­˜å‚¨æƒé™ --&gt;&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;&lt;uses-permission android:name=&quot;android.permission.RECORD_AUDIO&quot; /&gt;&lt;uses-permission android:name=&quot;android.permission.CAMERA&quot; /&gt;&lt;uses-feature android:name=&quot;android.hardware.camera&quot; /&gt; åœ¨activityä¸­åŠ¨æ€ç”³è¯·æƒé™12345private static final String[] VIDEO_PERMISSIONS = { Manifest.permission.CAMERA, Manifest.permission.RECORD_AUDIO, Manifest.permission.WRITE_EXTERNAL_STORAGE}; å®ç°æ‘„åƒå¤´é¢„è§ˆåŠŸèƒ½ä½¿ç”¨SurfaceViewæ¥é¢„è§ˆã€‚æ–°å»ºCameraPreviewç±»ç»§æ‰¿è‡ªSurfaceViewå¹¶å®ç°SurfaceHolder.Callbackï¼›cameraç›¸å…³æ“ä½œéƒ½æ”¾åœ¨è¿™ä¸ªViewé‡Œã€‚ surfaceCreatedä¸­è·å–Cameraå®ä¾‹ï¼Œå¯åŠ¨é¢„è§ˆï¼›è®¾ç½®é¢„è§ˆç›¸å…³å‚æ•° surfaceDestroyedé‡Šæ”¾Camera 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869public class CameraPreview extends SurfaceView implements SurfaceHolder.Callback { private static final String TAG = &quot;rustAppCameraPreview&quot;; private SurfaceHolder mHolder; private Camera mCamera; public static final int MEDIA_TYPE_IMAGE = 1; public static final int MEDIA_TYPE_VIDEO = 2; private static int mOptVideoWidth = 1920; // é»˜è®¤è§†é¢‘å¸§å®½åº¦ private static int mOptVideoHeight = 1080; private Uri outputMediaFileUri; private String outputMediaFileType; public CameraPreview(Context context) { super(context); mHolder = getHolder(); mHolder.addCallback(this); } private static Camera getCameraInstance() { Camera c = null; try { c = Camera.open(); } catch (Exception e) { Log.d(TAG, &quot;camera is not available&quot;); } return c; } @Override public void surfaceCreated(SurfaceHolder holder) { mCamera = getCameraInstance(); try { mCamera.setPreviewDisplay(holder); mCamera.startPreview(); getCameraOptimalVideoSize(); // æ‰¾åˆ°æœ€åˆé€‚çš„åˆ†è¾¨ç‡ } catch (IOException e) { Log.d(TAG, &quot;Error setting camera preview: &quot; + e.getMessage()); } } private void getCameraOptimalVideoSize() { try { Camera.Parameters parameters = mCamera.getParameters(); List&lt;Camera.Size&gt; mSupportedPreviewSizes = parameters.getSupportedPreviewSizes(); List&lt;Camera.Size&gt; mSupportedVideoSizes = parameters.getSupportedVideoSizes(); Camera.Size optimalSize = CameraHelper.getOptimalVideoSize(mSupportedVideoSizes, mSupportedPreviewSizes, getWidth(), getHeight()); mOptVideoWidth = optimalSize.width; mOptVideoHeight = optimalSize.height; Log.d(TAG, &quot;prepareVideoRecorder: optimalSize:&quot; + mOptVideoWidth + &quot;, &quot; + mOptVideoHeight); } catch (Exception e) { Log.e(TAG, &quot;getCameraOptimalVideoSize: &quot;, e); } } @Override public void surfaceDestroyed(SurfaceHolder holder) { mHolder.removeCallback(this); mCamera.setPreviewCallback(null); mCamera.stopPreview(); mCamera.release(); mCamera = null; } @Override public void surfaceChanged(SurfaceHolder holder, int format, int w, int h) { }} åœ¨Fragmentä¸­æ˜¾ç¤ºæ‘„åƒå¤´é¢„è§ˆé¢„ç½®ä¸€ä¸ªFrameLayoutï¼Œå®ä¾‹åŒ–ä¸€ä¸ªCameraPreviewæ·»åŠ è¿›å»123456789101112131415161718192021222324252627282930313233343536373839/** * è§†é¢‘å½•åˆ¶ç•Œé¢ * Created by Rust on 2018/5/17. */public class VideoRecordFragment extends Fragment { private static final String TAG = &quot;rustAppVideoFrag&quot;; private Button mCaptureBtn; private CameraPreview mCameraPreview; public static VideoRecordFragment newInstance() { return new VideoRecordFragment(); } @Override public void onCreate(@Nullable Bundle savedInstanceState) { super.onCreate(savedInstanceState); Log.d(TAG, &quot;frag onCreate&quot;); } @Nullable @Override public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) { Log.d(TAG, &quot;frag onCreateView&quot;); return inflater.inflate(R.layout.frag_video_record, container, false); } @Override public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) { Log.d(TAG, &quot;frag onViewCreated&quot;); super.onViewCreated(view, savedInstanceState); mCaptureBtn = view.findViewById(R.id.capture_btn); //mCaptureBtn.setOnClickListener(mOnClickListener);// å½•åˆ¶é”® mCameraPreview = new CameraPreview(getContext()); FrameLayout preview = view.findViewById(R.id.camera_preview); preview.addView(mCameraPreview); }} ä½¿ç”¨MediaRecorderå½•åˆ¶ç»™MediaRecorderæŒ‡å®šå‚æ•°åï¼Œè°ƒç”¨start()å¼€å§‹å½•åˆ¶ï¼Œstop()ç»“æŸå½•åˆ¶ å½•åˆ¶å¼€å§‹å‰ï¼Œè·å–cameraï¼ŒmCamera.unlock()è§£é”ï¼›å½•åˆ¶å®Œæ¯•åï¼Œæ¸…é™¤MediaRecorderï¼ŒmCamera.lock() 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990private MediaRecorder mMediaRecorder; public boolean startRecording() { if (prepareVideoRecorder()) { mMediaRecorder.start(); return true; } else { releaseMediaRecorder(); } return false; } public void stopRecording() { if (mMediaRecorder != null) { mMediaRecorder.stop(); } releaseMediaRecorder(); } public boolean isRecording() { return mMediaRecorder != null; } private boolean prepareVideoRecorder() { if (null == mCamera) { mCamera = getCameraInstance(); } mMediaRecorder = new MediaRecorder(); mCamera.unlock(); mMediaRecorder.setCamera(mCamera); mMediaRecorder.setAudioSource(MediaRecorder.AudioSource.DEFAULT); mMediaRecorder.setVideoSource(MediaRecorder.VideoSource.CAMERA); mMediaRecorder.setProfile(CamcorderProfile.get(CamcorderProfile.QUALITY_HIGH)); mMediaRecorder.setVideoSize(mOptVideoWidth, mOptVideoHeight); mMediaRecorder.setOutputFile(getOutputMediaFile(MEDIA_TYPE_VIDEO).toString()); mMediaRecorder.setPreviewDisplay(mHolder.getSurface()); try { mMediaRecorder.prepare(); } catch (IllegalStateException e) { Log.d(TAG, &quot;IllegalStateException preparing MediaRecorder: &quot; + e.getMessage()); releaseMediaRecorder(); return false; } catch (IOException e) { Log.d(TAG, &quot;IOException preparing MediaRecorder: &quot; + e.getMessage()); releaseMediaRecorder(); return false; } return true; } private void releaseMediaRecorder() { if (mMediaRecorder != null) { mMediaRecorder.reset(); mMediaRecorder.release(); mMediaRecorder = null; mCamera.lock(); } } private File getOutputMediaFile(int type) { File mediaStorageDir = new File(Environment.getExternalStoragePublicDirectory( Environment.DIRECTORY_PICTURES), TAG); if (!mediaStorageDir.exists()) { if (!mediaStorageDir.mkdirs()) { Log.d(TAG, &quot;failed to create directory&quot;); return null; } } String timeStamp = new SimpleDateFormat(&quot;yyyyMMdd_HHmmss&quot;, Locale.CHINA).format(new Date()); File mediaFile; if (type == MEDIA_TYPE_IMAGE) { mediaFile = new File(mediaStorageDir.getPath() + File.separator + &quot;IMG_&quot; + timeStamp + &quot;.jpg&quot;); outputMediaFileType = &quot;image/*&quot;; } else if (type == MEDIA_TYPE_VIDEO) { mediaFile = new File(mediaStorageDir.getPath() + File.separator + &quot;VID_&quot; + timeStamp + &quot;.mp4&quot;); outputMediaFileType = &quot;video/*&quot;; } else { return null; } outputMediaFileUri = Uri.fromFile(mediaFile); return mediaFile; } åå°è¿”å›æ—¶é¢„è§ˆé»‘å±çš„é—®é¢˜CameraPreviewæ˜¯æˆ‘ä»¬åœ¨Fragmentåˆ›å»ºæ—¶å®ä¾‹åŒ–å¹¶æ·»åŠ è¿›å»çš„ã€‚åº”ç”¨é€€åˆ°åå°åï¼ŒCameraPreviewå·²ç»è¢«é”€æ¯ã€‚åº”ç”¨å›åˆ°å‰å°æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨onResumeæ–¹æ³•ä¸­è¿›è¡Œæ“ä½œã€‚æ¢å¤CameraPreviewã€‚ åœ¨Fragmentä¸­ï¼Œåˆ¤æ–­é”€æ¯å’Œé‡å»ºé¢„è§ˆçš„æ—¶æœºã€‚12345678910111213141516171819202122@Overridepublic void onPause() { super.onPause(); Log.d(TAG, &quot;onPause: é”€æ¯é¢„è§ˆ&quot;); mCameraPreview = null;}@Overridepublic void onResume() { super.onResume(); Log.d(TAG, &quot;onResume: å›åˆ°å‰å°&quot;); if (null == mCameraPreview) { initCameraPreview(); }}private void initCameraPreview() { mCameraPreview = new CameraPreview(getContext()); FrameLayout preview = mRoot.findViewById(R.id.camera_preview); preview.addView(mCameraPreview);} å‚è€ƒèµ„æ–™ Androidç›¸æœºå¼€å‘(ä¸‰): å®ç°æ‹ç…§å½•åƒå’ŒæŸ¥çœ‹ googlesamples/android-MediaRecorder Controlling the Camera - Android Developer Camera API - Android Developer","link":"/2020/01/11/Android/Android-Camera_record_video_and_output/"},{"title":"Android éŸ³é¢‘PCMæ•°æ®çš„é‡‡é›†å’Œæ’­æ”¾ï¼Œè¯»å†™éŸ³é¢‘wavæ–‡ä»¶","text":"æœ¬æ–‡ç›®çš„ï¼šä½¿ç”¨ AudioRecord å’Œ AudioTrack å®ŒæˆéŸ³é¢‘PCMæ•°æ®çš„é‡‡é›†å’Œæ’­æ”¾ï¼Œå¹¶è¯»å†™éŸ³é¢‘wavæ–‡ä»¶ å‡†å¤‡å·¥ä½œAndroidæä¾›äº†AudioRecordå’ŒMediaRecordã€‚MediaRecordå¯é€‰æ‹©å½•éŸ³çš„æ ¼å¼ã€‚AudioRecordå¾—åˆ°PCMç¼–ç æ ¼å¼çš„æ•°æ®ã€‚AudioRecordèƒ½å¤Ÿè®¾ç½®æ¨¡æ‹Ÿä¿¡å·è½¬åŒ–ä¸ºæ•°å­—ä¿¡å·çš„ç›¸å…³å‚æ•°ï¼ŒåŒ…æ‹¬é‡‡æ ·ç‡å’Œé‡åŒ–æ·±åº¦ï¼ŒåŒæ—¶ä¹ŸåŒ…æ‹¬é€šé“æ•°ç›®ç­‰ã€‚ PCMPCMæ˜¯åœ¨ç”±æ¨¡æ‹Ÿä¿¡å·å‘æ•°å­—ä¿¡å·è½¬åŒ–çš„ä¸€ç§å¸¸ç”¨çš„ç¼–ç æ ¼å¼ï¼Œç§°ä¸ºè„‰å†²ç¼–ç è°ƒåˆ¶ï¼ŒPCMå°†æ¨¡æ‹Ÿä¿¡å·æŒ‰ç…§ä¸€å®šçš„é—´è·åˆ’åˆ†ä¸ºå¤šæ®µï¼Œç„¶åé€šè¿‡äºŒè¿›åˆ¶å»é‡åŒ–æ¯ä¸€ä¸ªé—´è·çš„å¼ºåº¦ã€‚PCMè¡¨ç¤ºçš„æ˜¯éŸ³é¢‘æ–‡ä»¶ä¸­éšç€æ—¶é—´çš„æµé€çš„ä¸€æ®µéŸ³é¢‘çš„æŒ¯å¹…ã€‚Androidåœ¨WAVæ–‡ä»¶ä¸­æ”¯æŒPCMçš„éŸ³é¢‘æ•°æ®ã€‚ WAVWAVï¼ŒMP3ç­‰æ¯”è¾ƒå¸¸è§çš„éŸ³é¢‘æ ¼å¼ï¼Œä¸åŒçš„ç¼–ç æ ¼å¼å¯¹åº”ä¸é€šè¿‡çš„åŸå§‹éŸ³é¢‘ã€‚ä¸ºäº†æ–¹ä¾¿ä¼ è¾“ï¼Œé€šå¸¸ä¼šå‹ç¼©åŸå§‹éŸ³é¢‘ã€‚ä¸ºäº†è¾¨åˆ«å‡ºéŸ³é¢‘æ ¼å¼ï¼Œæ¯ç§æ ¼å¼æœ‰ç‰¹å®šçš„å¤´æ–‡ä»¶ï¼ˆheaderï¼‰ã€‚WAVä»¥RIFFä¸ºæ ‡å‡†ã€‚RIFFæ˜¯ä¸€ç§èµ„æºäº¤æ¢æ¡£æ¡ˆæ ‡å‡†ã€‚RIFFå°†æ–‡ä»¶å­˜å‚¨åœ¨æ¯ä¸€ä¸ªæ ‡è®°å—ä¸­ã€‚åŸºæœ¬æ„æˆå•ä½æ˜¯trunkï¼Œæ¯ä¸ªtrunkç”±æ ‡è®°ä½ï¼Œæ•°æ®å¤§å°ï¼Œæ•°æ®å­˜å‚¨ï¼Œä¸‰ä¸ªéƒ¨åˆ†æ„æˆã€‚ PCMæ‰“åŒ…æˆWAVPCMæ˜¯åŸå§‹éŸ³é¢‘æ•°æ®ï¼ŒWAVæ˜¯windowsä¸­å¸¸è§çš„éŸ³é¢‘æ ¼å¼ï¼Œåªæ˜¯åœ¨pcmæ•°æ®ä¸­æ·»åŠ äº†ä¸€ä¸ªæ–‡ä»¶å¤´ã€‚ èµ·å§‹åœ°å€ å ç”¨ç©ºé—´ æœ¬åœ°å€æ•°å­—çš„å«ä¹‰ 00H 4byte RIFFï¼Œèµ„æºäº¤æ¢æ–‡ä»¶æ ‡å¿—ã€‚ 04H 4byte ä»ä¸‹ä¸€ä¸ªåœ°å€å¼€å§‹åˆ°æ–‡ä»¶å°¾çš„æ€»å­—èŠ‚æ•°ã€‚é«˜ä½å­—èŠ‚åœ¨åé¢ï¼Œè¿™é‡Œå°±æ˜¯001437ECHï¼Œæ¢æˆåè¿›åˆ¶æ˜¯1325036byteï¼Œç®—ä¸Šè¿™ä¹‹å‰çš„8byteå°±æ­£å¥½1325044byteäº†ã€‚ 08H 4byte WAVEï¼Œä»£è¡¨wavæ–‡ä»¶æ ¼å¼ã€‚ 0CH 4byte FMT ï¼Œæ³¢å½¢æ ¼å¼æ ‡å¿— 10H 4byte 00000010Hï¼Œ16PCMï¼Œæˆ‘çš„ç†è§£æ˜¯ç”¨16bitçš„æ•°æ®è¡¨ç¤ºä¸€ä¸ªé‡åŒ–ç»“æœã€‚ 14H 2byte ä¸º1æ—¶è¡¨ç¤ºçº¿æ€§PCMç¼–ç ï¼Œå¤§äº1æ—¶è¡¨ç¤ºæœ‰å‹ç¼©çš„ç¼–ç ã€‚è¿™é‡Œæ˜¯0001Hã€‚ 16H 2byte 1ä¸ºå•å£°é“ï¼Œ2ä¸ºåŒå£°é“ï¼Œè¿™é‡Œæ˜¯0001Hã€‚ 18H 4byte é‡‡æ ·é¢‘ç‡ï¼Œè¿™é‡Œæ˜¯00002B11Hï¼Œä¹Ÿå°±æ˜¯11025Hzã€‚ 1CH 4byte Byteç‡=é‡‡æ ·é¢‘ç‡*éŸ³é¢‘é€šé“æ•°*æ¯æ¬¡é‡‡æ ·å¾—åˆ°çš„æ ·æœ¬ä½æ•°/8ï¼Œ00005622Hï¼Œä¹Ÿå°±æ˜¯22050Byte/s=11025*1*16/2 20H 2byte å—å¯¹é½=é€šé“æ•°æ¯æ¬¡é‡‡æ ·å¾—åˆ°çš„æ ·æœ¬ä½æ•°/8ï¼Œ0002Hï¼Œä¹Ÿå°±æ˜¯ `2 == 116/8` 22H 2byte æ ·æœ¬æ•°æ®ä½æ•°ï¼Œ0010Hå³16ï¼Œä¸€ä¸ªé‡åŒ–æ ·æœ¬å 2byteã€‚ 24H 4byte dataï¼Œä¸€ä¸ªæ ‡å¿—è€Œå·²ã€‚ 28H 4byte Wavæ–‡ä»¶å®é™…éŸ³é¢‘æ•°æ®æ‰€å çš„å¤§å°ï¼Œè¿™é‡Œæ˜¯001437C8Hå³1325000ï¼Œå†åŠ ä¸Š2CHå°±æ­£å¥½æ˜¯1325044ï¼Œæ•´ä¸ªæ–‡ä»¶çš„å¤§å°ã€‚ 2CH ä¸å®š é‡åŒ–æ•°æ® AudioRecordAudioRecordå¯å®ç°ä»éŸ³é¢‘è¾“å…¥è®¾å¤‡è®°å½•å£°éŸ³çš„åŠŸèƒ½ã€‚å¾—åˆ°PCMæ ¼å¼çš„éŸ³é¢‘ã€‚è¯»å–éŸ³é¢‘çš„æ–¹æ³•æœ‰read(byte[], int, int)ï¼Œ read(short[], int, int) æˆ– read(ByteBuffer, int)ã€‚å¯æ ¹æ®å­˜å‚¨æ–¹å¼å’Œéœ€æ±‚é€‰æ‹©ä½¿ç”¨è¿™é¡¹æ–¹æ³•ã€‚ éœ€è¦æƒé™&lt;uses-permission android:name=&quot;android.permission.RECORD_AUDIO&quot; /&gt; AudioRecord æ„é€ å‡½æ•°public AudioRecord(int audioSource, int sampleRateInHz, int channelConfig, int audioFormat, int bufferSizeInBytes) audioSource éŸ³æºè®¾å¤‡ï¼Œå¸¸ç”¨éº¦å…‹é£MediaRecorder.AudioSource.MIC samplerateInHz é‡‡æ ·é¢‘ç‡ï¼Œ44100Hzæ˜¯ç›®å‰æ‰€æœ‰è®¾å¤‡éƒ½æ”¯æŒçš„é¢‘ç‡ channelConfig éŸ³é¢‘é€šé“ï¼Œå•å£°é“è¿˜æ˜¯ç«‹ä½“å£° audioFormat è¯¥å‚æ•°ä¸ºé‡åŒ–æ·±åº¦ï¼Œå³ä¸ºæ¯æ¬¡é‡‡æ ·çš„ä½æ•° bufferSizeInBytes å¯é€šè¿‡getMinBufferSize()æ–¹æ³•ç¡®å®šï¼Œæ¯æ¬¡ä»ç¡¬ä»¶è¯»å–æ•°æ®æ‰€éœ€è¦çš„ç¼“å†²åŒºçš„å¤§å°ã€‚ è·å–wavæ–‡ä»¶è‹¥è¦è·å¾—wavæ–‡ä»¶ï¼Œéœ€è¦åœ¨PCMåŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªheaderã€‚å¯ä»¥å°†PCMæ–‡ä»¶è½¬æ¢æˆwavï¼Œè¿™é‡Œæä¾›ä¸€ç§PCMä¸wavå‡ ä¹åŒæ—¶ç”Ÿæˆçš„æ€è·¯ã€‚ PCMä¸wavåŒæ—¶åˆ›å»ºï¼Œç»™wavæ–‡ä»¶ä¸€ä¸ªé»˜è®¤çš„headerã€‚å½•åˆ¶çº¿ç¨‹å¯åŠ¨åï¼ŒåŒæ—¶å†™PCMä¸wavã€‚å½•åˆ¶å®Œæˆæ—¶ï¼Œé‡æ–°ç”Ÿæˆheaderï¼Œåˆ©ç”¨RandomAccessFileä¿®æ”¹wavæ–‡ä»¶çš„headerã€‚ AudioTrackä½¿ç”¨AudioTrackæ’­æ”¾éŸ³é¢‘ã€‚åˆå§‹åŒ–AudioTrackæ—¶ï¼Œè¦æ ¹æ®å½•åˆ¶æ—¶çš„å‚æ•°è¿›è¡Œè®¾å®šã€‚ ä»£ç ç¤ºä¾‹å·¥å…·ç±»WindEarå®ç°éŸ³é¢‘PCMæ•°æ®çš„é‡‡é›†å’Œæ’­æ”¾ï¼Œä¸è¯»å†™éŸ³é¢‘wavæ–‡ä»¶çš„åŠŸèƒ½ã€‚ AudioRecordThread ä½¿ç”¨AudioRecordå½•åˆ¶PCMæ–‡ä»¶ï¼Œå¯é€‰æ‹©åŒæ—¶ç”Ÿæˆwavæ–‡ä»¶ AudioTrackPlayThread ä½¿ç”¨AudioTrackæ’­æ”¾PCMæˆ–wavéŸ³é¢‘æ–‡ä»¶çš„çº¿ç¨‹ WindState è¡¨ç¤ºå½“å‰çŠ¶æ€ï¼Œä¾‹å¦‚æ˜¯å¦åœ¨æ’­æ”¾ï¼Œå½•åˆ¶ç­‰ç­‰ PCMæ–‡ä»¶çš„è¯»å†™é‡‡ç”¨FileOutputStreamå’ŒFileInputStream generateWavFileHeaderæ–¹æ³•å¯ä»¥ç”Ÿæˆwavæ–‡ä»¶çš„header 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384/** * éŸ³é¢‘å½•åˆ¶å™¨ * ä½¿ç”¨ AudioRecord å’Œ AudioTrack API å®ŒæˆéŸ³é¢‘ PCM æ•°æ®çš„é‡‡é›†å’Œæ’­æ”¾ï¼Œå¹¶å®ç°è¯»å†™éŸ³é¢‘ wav æ–‡ä»¶ * æ£€æŸ¥æƒé™ï¼Œæ£€æŸ¥éº¦å…‹é£çš„å·¥ä½œæ”¾åœ¨Activityä¸­è¿›è¡Œ * Created by Rust on 2018/2/24. */public class WindEar { private static final String TAG = &quot;rustApp&quot;; private static final String TMP_FOLDER_NAME = &quot;AnWindEar&quot;; private static final int RECORD_AUDIO_BUFFER_TIMES = 1; private static final int PLAY_AUDIO_BUFFER_TIMES = 1; private static final int AUDIO_FREQUENCY = 44100; private static final int RECORD_CHANNEL_CONFIG = AudioFormat.CHANNEL_IN_STEREO; private static final int PLAY_CHANNEL_CONFIG = AudioFormat.CHANNEL_OUT_STEREO; private static final int AUDIO_ENCODING = AudioFormat.ENCODING_PCM_16BIT; private AudioRecordThread aRecordThread; // å½•åˆ¶çº¿ç¨‹ private volatile WindState state = WindState.IDLE; // å½“å‰çŠ¶æ€ private File tmpPCMFile = null; private File tmpWavFile = null; private OnState onStateListener; private Handler mainHandler = new Handler(Looper.getMainLooper()); /** * PCMç¼“å­˜ç›®å½• */ private static String cachePCMFolder; /** * wavç¼“å­˜ç›®å½• */ private static String wavFolderPath; private static WindEar instance = new WindEar(); private WindEar() { } public static WindEar getInstance() { if (null == instance) { instance = new WindEar(); } return instance; } public void setOnStateListener(OnState onStateListener) { this.onStateListener = onStateListener; } /** * åˆå§‹åŒ–ç›®å½• */ public static void init(Context context) { // å­˜å‚¨åœ¨Appå†…æˆ–SDå¡ä¸Š// cachePCMFolder = context.getFilesDir().getAbsolutePath() + File.separator + TMP_FOLDER_NAME; cachePCMFolder = Environment.getExternalStorageDirectory().getAbsolutePath() + File.separator + TMP_FOLDER_NAME; File folder = new File(cachePCMFolder); if (!folder.exists()) { boolean f = folder.mkdirs(); Log.d(TAG, String.format(Locale.CHINA, &quot;PCMç›®å½•:%s -&gt; %b&quot;, cachePCMFolder, f)); } else { for (File f : folder.listFiles()) { boolean d = f.delete(); Log.d(TAG, String.format(Locale.CHINA, &quot;åˆ é™¤PCMæ–‡ä»¶:%s %b&quot;, f.getName(), d)); } Log.d(TAG, String.format(Locale.CHINA, &quot;PCMç›®å½•:%s&quot;, cachePCMFolder)); } wavFolderPath = Environment.getExternalStorageDirectory().getAbsolutePath() + File.separator + TMP_FOLDER_NAME;// wavFolderPath = context.getFilesDir().getAbsolutePath() + File.separator + TMP_FOLDER_NAME; File wavDir = new File(wavFolderPath); if (!wavDir.exists()) { boolean w = wavDir.mkdirs(); Log.d(TAG, String.format(Locale.CHINA, &quot;wavç›®å½•:%s -&gt; %b&quot;, wavFolderPath, w)); } else { Log.d(TAG, String.format(Locale.CHINA, &quot;wavç›®å½•:%s&quot;, wavFolderPath)); } } /** * å¼€å§‹å½•åˆ¶éŸ³é¢‘ */ public synchronized void startRecord(boolean createWav) { if (!state.equals(WindState.IDLE)) { Log.w(TAG, &quot;æ— æ³•å¼€å§‹å½•åˆ¶ï¼Œå½“å‰çŠ¶æ€ä¸º &quot; + state); return; } try { tmpPCMFile = File.createTempFile(&quot;recording&quot;, &quot;.pcm&quot;, new File(cachePCMFolder)); if (createWav) { SimpleDateFormat sdf = new SimpleDateFormat(&quot;yyMMdd_HHmmss&quot;, Locale.CHINA); tmpWavFile = new File(wavFolderPath + File.separator + &quot;r&quot; + sdf.format(new Date()) + &quot;.wav&quot;); } Log.d(TAG, &quot;tmp file &quot; + tmpPCMFile.getName()); } catch (IOException e) { e.printStackTrace(); } if (null != aRecordThread) { aRecordThread.interrupt(); aRecordThread = null; } aRecordThread = new AudioRecordThread(createWav); aRecordThread.start(); } public synchronized void stopRecord() { if (!state.equals(WindState.RECORDING)) { return; } state = WindState.STOP_RECORD; notifyState(state); } /** * æ’­æ”¾å½•åˆ¶å¥½çš„PCMæ–‡ä»¶ */ public synchronized void startPlayPCM() { if (!isIdle()) { return; } new AudioTrackPlayThread(tmpPCMFile).start(); } /** * æ’­æ”¾å½•åˆ¶å¥½çš„wavæ–‡ä»¶ */ public synchronized void startPlayWav() { if (!isIdle()) { return; } new AudioTrackPlayThread(tmpWavFile).start(); } public synchronized void stopPlay() { if (!state.equals(WindState.PLAYING)) { return; } state = WindState.STOP_PLAY; } public synchronized boolean isIdle() { return WindState.IDLE.equals(state); } /** * éŸ³é¢‘å½•åˆ¶çº¿ç¨‹ * ä½¿ç”¨FileOutputStreamæ¥å†™æ–‡ä»¶ */ private class AudioRecordThread extends Thread { AudioRecord aRecord; int bufferSize = 10240; boolean createWav = false; AudioRecordThread(boolean createWav) { this.createWav = createWav; bufferSize = AudioRecord.getMinBufferSize(AUDIO_FREQUENCY, RECORD_CHANNEL_CONFIG, AUDIO_ENCODING) * RECORD_AUDIO_BUFFER_TIMES; Log.d(TAG, &quot;record buffer size = &quot; + bufferSize); aRecord = new AudioRecord(MediaRecorder.AudioSource.MIC, AUDIO_FREQUENCY, RECORD_CHANNEL_CONFIG, AUDIO_ENCODING, bufferSize); } @Override public void run() { state = WindState.RECORDING; notifyState(state); Log.d(TAG, &quot;å½•åˆ¶å¼€å§‹&quot;); try { // è¿™é‡Œé€‰æ‹©FileOutputStreamè€Œä¸æ˜¯DataOutputStream FileOutputStream pcmFos = new FileOutputStream(tmpPCMFile); FileOutputStream wavFos = new FileOutputStream(tmpWavFile); if (createWav) { writeWavFileHeader(wavFos, bufferSize, AUDIO_FREQUENCY, aRecord.getChannelCount()); } aRecord.startRecording(); byte[] byteBuffer = new byte[bufferSize]; while (state.equals(WindState.RECORDING) &amp;&amp; !isInterrupted()) { int end = aRecord.read(byteBuffer, 0, byteBuffer.length); pcmFos.write(byteBuffer, 0, end); pcmFos.flush(); if (createWav) { wavFos.write(byteBuffer, 0, end); wavFos.flush(); } } aRecord.stop(); // å½•åˆ¶ç»“æŸ pcmFos.close(); wavFos.close(); if (createWav) { // ä¿®æ”¹header RandomAccessFile wavRaf = new RandomAccessFile(tmpWavFile, &quot;rw&quot;); byte[] header = generateWavFileHeader(tmpPCMFile.length(), AUDIO_FREQUENCY, aRecord.getChannelCount()); Log.d(TAG, &quot;header: &quot; + getHexString(header)); wavRaf.seek(0); wavRaf.write(header); wavRaf.close(); Log.d(TAG, &quot;tmpWavFile.length: &quot; + tmpWavFile.length()); } Log.i(TAG, &quot;audio tmp PCM file len: &quot; + tmpPCMFile.length()); } catch (Exception e) { Log.e(TAG, &quot;AudioRecordThread:&quot;, e); notifyState(WindState.ERROR); } notifyState(state); state = WindState.IDLE; notifyState(state); Log.d(TAG, &quot;å½•åˆ¶ç»“æŸ&quot;); } } private static String getHexString(byte[] bytes) { StringBuilder sb = new StringBuilder(); for (byte b : bytes) { sb.append(Integer.toHexString(b)).append(&quot;,&quot;); } return sb.toString(); } /** * AudioTrackæ’­æ”¾éŸ³é¢‘çº¿ç¨‹ * ä½¿ç”¨FileInputStreamè¯»å–æ–‡ä»¶ */ private class AudioTrackPlayThread extends Thread { AudioTrack track; int bufferSize = 10240; File audioFile = null; AudioTrackPlayThread(File aFile) { setPriority(Thread.MAX_PRIORITY); audioFile = aFile; int bufferSize = AudioTrack.getMinBufferSize(AUDIO_FREQUENCY, PLAY_CHANNEL_CONFIG, AUDIO_ENCODING) * PLAY_AUDIO_BUFFER_TIMES; track = new AudioTrack(AudioManager.STREAM_MUSIC, AUDIO_FREQUENCY, PLAY_CHANNEL_CONFIG, AUDIO_ENCODING, bufferSize, AudioTrack.MODE_STREAM); } @Override public void run() { super.run(); state = WindState.PLAYING; notifyState(state); try { FileInputStream fis = new FileInputStream(audioFile); track.play(); byte[] aByteBuffer = new byte[bufferSize]; while (state.equals(WindState.PLAYING) &amp;&amp; fis.read(aByteBuffer) &gt;= 0) { track.write(aByteBuffer, 0, aByteBuffer.length); } track.stop(); track.release(); } catch (Exception e) { Log.e(TAG, &quot;AudioTrackPlayThread:&quot;, e); notifyState(WindState.ERROR); } state = WindState.STOP_PLAY; notifyState(state); state = WindState.IDLE; notifyState(state); } } private synchronized void notifyState(final WindState currentState) { if (null != onStateListener) { mainHandler.post(new Runnable() { @Override public void run() { onStateListener.onStateChanged(currentState); } }); } } public interface OnState { void onStateChanged(WindState currentState); } /** * è¡¨ç¤ºå½“å‰çŠ¶æ€ */ public enum WindState { ERROR, IDLE, RECORDING, STOP_RECORD, PLAYING, STOP_PLAY } /** * @param out wavéŸ³é¢‘æ–‡ä»¶æµ * @param totalAudioLen ä¸åŒ…æ‹¬headerçš„éŸ³é¢‘æ•°æ®æ€»é•¿åº¦ * @param longSampleRate é‡‡æ ·ç‡,ä¹Ÿå°±æ˜¯å½•åˆ¶æ—¶ä½¿ç”¨çš„é¢‘ç‡ * @param channels audioRecordçš„é¢‘é“æ•°é‡ * @throws IOException å†™æ–‡ä»¶é”™è¯¯ */ private void writeWavFileHeader(FileOutputStream out, long totalAudioLen, long longSampleRate, int channels) throws IOException { byte[] header = generateWavFileHeader(totalAudioLen, longSampleRate, channels); out.write(header, 0, header.length); } /** * ä»»ä½•ä¸€ç§æ–‡ä»¶åœ¨å¤´éƒ¨æ·»åŠ ç›¸åº”çš„å¤´æ–‡ä»¶æ‰èƒ½å¤Ÿç¡®å®šçš„è¡¨ç¤ºè¿™ç§æ–‡ä»¶çš„æ ¼å¼ï¼Œ * waveæ˜¯RIFFæ–‡ä»¶ç»“æ„ï¼Œæ¯ä¸€éƒ¨åˆ†ä¸ºä¸€ä¸ªchunkï¼Œå…¶ä¸­æœ‰RIFF WAVE chunkï¼Œ * FMT Chunkï¼ŒFact chunk,Data chunk,å…¶ä¸­Fact chunkæ˜¯å¯ä»¥é€‰æ‹©çš„ * * @param pcmAudioByteCount ä¸åŒ…æ‹¬headerçš„éŸ³é¢‘æ•°æ®æ€»é•¿åº¦ * @param longSampleRate é‡‡æ ·ç‡,ä¹Ÿå°±æ˜¯å½•åˆ¶æ—¶ä½¿ç”¨çš„é¢‘ç‡ * @param channels audioRecordçš„é¢‘é“æ•°é‡ */ private byte[] generateWavFileHeader(long pcmAudioByteCount, long longSampleRate, int channels) { long totalDataLen = pcmAudioByteCount + 36; // ä¸åŒ…å«å‰8ä¸ªå­—èŠ‚çš„WAVæ–‡ä»¶æ€»é•¿åº¦ long byteRate = longSampleRate * 2 * channels; byte[] header = new byte[44]; header[0] = 'R'; // RIFF header[1] = 'I'; header[2] = 'F'; header[3] = 'F'; header[4] = (byte) (totalDataLen &amp; 0xff);//æ•°æ®å¤§å° header[5] = (byte) ((totalDataLen &gt;&gt; 8) &amp; 0xff); header[6] = (byte) ((totalDataLen &gt;&gt; 16) &amp; 0xff); header[7] = (byte) ((totalDataLen &gt;&gt; 24) &amp; 0xff); header[8] = 'W';//WAVE header[9] = 'A'; header[10] = 'V'; header[11] = 'E'; //FMT Chunk header[12] = 'f'; // 'fmt ' header[13] = 'm'; header[14] = 't'; header[15] = ' ';//è¿‡æ¸¡å­—èŠ‚ //æ•°æ®å¤§å° header[16] = 16; // 4 bytes: size of 'fmt ' chunk header[17] = 0; header[18] = 0; header[19] = 0; //ç¼–ç æ–¹å¼ 10Hä¸ºPCMç¼–ç æ ¼å¼ header[20] = 1; // format = 1 header[21] = 0; //é€šé“æ•° header[22] = (byte) channels; header[23] = 0; //é‡‡æ ·ç‡ï¼Œæ¯ä¸ªé€šé“çš„æ’­æ”¾é€Ÿåº¦ header[24] = (byte) (longSampleRate &amp; 0xff); header[25] = (byte) ((longSampleRate &gt;&gt; 8) &amp; 0xff); header[26] = (byte) ((longSampleRate &gt;&gt; 16) &amp; 0xff); header[27] = (byte) ((longSampleRate &gt;&gt; 24) &amp; 0xff); //éŸ³é¢‘æ•°æ®ä¼ é€é€Ÿç‡,é‡‡æ ·ç‡*é€šé“æ•°*é‡‡æ ·æ·±åº¦/8 header[28] = (byte) (byteRate &amp; 0xff); header[29] = (byte) ((byteRate &gt;&gt; 8) &amp; 0xff); header[30] = (byte) ((byteRate &gt;&gt; 16) &amp; 0xff); header[31] = (byte) ((byteRate &gt;&gt; 24) &amp; 0xff); // ç¡®å®šç³»ç»Ÿä¸€æ¬¡è¦å¤„ç†å¤šå°‘ä¸ªè¿™æ ·å­—èŠ‚çš„æ•°æ®ï¼Œç¡®å®šç¼“å†²åŒºï¼Œé€šé“æ•°*é‡‡æ ·ä½æ•° header[32] = (byte) (2 * channels); header[33] = 0; //æ¯ä¸ªæ ·æœ¬çš„æ•°æ®ä½æ•° header[34] = 16; header[35] = 0; //Data chunk header[36] = 'd';//data header[37] = 'a'; header[38] = 't'; header[39] = 'a'; header[40] = (byte) (pcmAudioByteCount &amp; 0xff); header[41] = (byte) ((pcmAudioByteCount &gt;&gt; 8) &amp; 0xff); header[42] = (byte) ((pcmAudioByteCount &gt;&gt; 16) &amp; 0xff); header[43] = (byte) ((pcmAudioByteCount &gt;&gt; 24) &amp; 0xff); return header; }} å‚è€ƒèµ„æ–™ AudioRecord - developer.android.com AudioTrack - developer.android.com AndroidéŸ³è§†é¢‘ç›¸å…³æ–‡ç« è¯·å‚è€ƒ https://rustfisher.com/tags/Android-Media/","link":"/2020/01/10/Android/Android-AudioRecord_AudioTrack_pcm_wav/"},{"title":"Androidæ•™ç¨‹2020 - ç³»åˆ—ç®€ä»‹","text":"Androidæ•™ç¨‹2020è¿ç§»åˆ°Androidæ•™ç¨‹2020ï¼Œæ¬¢è¿å¤§å®¶å‰æ¥é˜…è¯»ğŸ‘ ä¸ºäº†æ–¹ä¾¿æœ‹å‹å…¥é—¨å®‰å“åº”ç”¨å¼€å‘ï¼Œå¼€å§‹æ•´ç†2020å¹´çš„Androidæ–°æ‰‹æ•™ç¨‹ã€‚çªå‡ºä¸€ä¸ªç®€å•æ˜äº†ï¼Œä¸Šæ‰‹å¿«ã€‚ä»å®ç”¨æ€§å‡ºå‘ï¼Œå¿«é€ŸæŒæ¡Androidå¼€å‘åŸºæœ¬æŠ€èƒ½ã€‚éœ€è¦è¯»è€…æœ‰ä¸€å®šçš„JavaåŸºç¡€ã€‚ å­¦å®Œæœ¬è¯¾ç¨‹åï¼Œè¯»è€…å¯ä»¥è‡ªå·±åšå‡ºä¸€ä¸ªä¸ªæ–¹ä¾¿å·¥ä½œç”Ÿæ´»çš„å°å·¥å…·æ¥ã€‚ æˆ‘çš„åšå®¢å³å°†åŒæ­¥è‡³è…¾è®¯äº‘+ç¤¾åŒºï¼Œé‚€è¯·å¤§å®¶ä¸€åŒå…¥é©»ï¼šhttps://cloud.tencent.com/developer/support-plan?invite_code=1htj93xu8gcij","link":"/2019/12/08/Android_tutorial_2020/Android-tutorial_2020_a_menu/"},{"title":"ã€è¿è¥çš„PythonæŒ‡å—ã€‘Python Excel ç»˜åˆ¶æŸ±å½¢å›¾","text":"è¿™æ˜¯ä¸€ä»½å†™ç»™è¿è¥äººå‘˜çš„PythonæŒ‡å—ã€‚æœ¬æ–‡ä¸»è¦è®²è¿°å¦‚ä½•ä½¿ç”¨Pythonæ“ä½œExcelç»˜åˆ¶æŸ±å½¢å›¾ã€‚ ç›¸å…³ä»£ç è¯·å‚è€ƒ https://github.com/RustFisher/python-playground æœ¬æ–‡é“¾æ¥ï¼šhttps://www.rustfisher.com/2019/11/19/Python/Python-op-excel_openpyxl_bar_column_chart/ å¼€å‘å·¥å…·ï¼Œç¯å¢ƒ PyCharm Python3 Office Excel å‰é¢æˆ‘ä»¬å·²ç»åˆ›å»ºå¥½äº†ä¸€å¼ Excelè¡¨ã€‚ç°åœ¨æˆ‘ä»¬è¦æ ¹æ®å·²æœ‰çš„æ•°æ®ï¼Œå¾€é‡Œé¢æ·»åŠ æŸ±å½¢å›¾ã€‚ æŸ±å½¢å›¾ BarChartå‚è€ƒã€ŠPython openpyxl Excelç»˜åˆ¶æŸ±å½¢å›¾ã€‹å¾—çŸ¥ï¼Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨BarChartä¸BarChart3Dç±»ã€‚å›¾è¡¨ä¸­è®¸å¤šçš„ç»†èŠ‚ç”±BarChartå±æ€§æ§åˆ¶ã€‚ åæ–‡éƒ½ä»¥chart1æ¥è¡¨ç¤ºæŸ±å½¢å›¾å¯¹è±¡ chart1 = BarChart() ã€‚ æ•°æ®æ¥æºèŒƒå›´ Referenceé¦–å…ˆæˆ‘ä»¬åº”è¯¥ç¡®å®šæ•°æ®çš„èŒƒå›´ã€‚æœ‰æ•°æ®æ‰å¥½ç»˜å›¾ã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯Referenceç±»æ¥è¡¨ç¤ºæ•°æ®â€œå¼•ç”¨â€èŒƒå›´ã€‚12data1 = Reference(st, min_col=2, min_row=1, max_row=7, max_col=3)cats1 = Reference(st, min_col=1, min_row=2, max_row=7)éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒèŒƒå›´çš„ä¸‹æ ‡æ˜¯ä»1å¼€å§‹çš„ã€‚è¿™é‡Œçš„data1æŠŠæ ‡é¢˜ä¹Ÿæ¡†è¿›å»äº†ã€‚è®¾å®šæ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦è®¾ç½®titles_from_data=True1chart1.add_data(data1, titles_from_data=True) è®¾ç½®ç§ç±»ä½¿ç”¨set_categoriesæ–¹æ³•ï¼Œä¹Ÿæ˜¯æŠŠä¸€ä¸ªèŒƒå›´ï¼ˆReferenceï¼‰çš„æ•°æ®ä¼ å…¥ã€‚1chart1.set_categories(cats1) æŸ±å­æ–¹å‘æ§åˆ¶ typeæ–¹å‘ç”±å±æ€§typeæ¥æ§åˆ¶ï¼Œæœ‰2ä¸ªå¯é€‰å‚æ•°ï¼šbarè¡¨ç¤ºæ¨ªå‘ï¼Œcolè¡¨ç¤ºç«–ç›´ã€‚ 12chart1.type = &quot;bar&quot; # æ¨ªå‘æŸ±å½¢å›¾chart1.type = &quot;col&quot; # çºµå‘æŸ±å½¢å›¾ æ ‡é¢˜ titleå±æ€§titleæ§åˆ¶æ ‡é¢˜ã€‚å¦‚æœç½®ä¸ºNoneåˆ™ä¸æ˜¾ç¤ºæ ‡é¢˜ã€‚ å›¾è¡¨çš„æ ‡é¢˜ chart1.title = &quot;æ—¥å‡å€¼å¯¹æ¯”&quot; åæ ‡çš„æ ‡é¢˜ï¼Œé¦–å…ˆéœ€è¦æ‹¿åˆ°xï¼Œyçš„åæ ‡ã€‚12chart1.y_axis.title = 'æ•°å€¼'chart1.x_axis.title = st.cell(column=1, row=1).value # ç›´æ¥ç”¨å•å…ƒæ ¼çš„å†…å®¹åšæ ‡é¢˜ æ·»åŠ å›¾è¡¨add_chartå°†å›¾è¡¨æ·»åŠ åˆ°sheetä¸­ã€‚å›¾è¡¨çš„å·¦ä¸Šè§’å¯¹é½æŸä¸ªå•å…ƒæ ¼ã€‚ä¸‹é¢æ˜¯å¯¹é½A8ã€‚1st.add_chart(chart1, 'A8') 3DæŸ±å½¢å›¾ BarChart3DæŸ±å­çš„å½¢çŠ¶ shapeé»˜è®¤æ˜¯ç«‹æ–¹ä½“ï¼Œä½†ä¹Ÿå¯ä»¥ä»ä¸‹é¢çš„å½¢çŠ¶é‡Œé€‰ä¸€ä¸ªã€‚ {'box', 'pyramid', 'pyramidToMax', 'coneToMax', 'cone', 'cylinder'} 1chart1.type = 'cone' box æ˜¯ç«‹æ–¹ä½“ï¼Œä¸­è§„ä¸­çŸ©ã€‚pyramid æ˜¯é‡‘å­—å¡”ï¼Œé¡¶éƒ¨ä¹Ÿæ˜¯å°–çš„ã€‚cone æ˜¯åœ†é”¥ï¼Œçœ‹èµ·æ¥å¾ˆå°–é”ã€‚cylinder æ˜¯åœ†æŸ±ã€‚ é…è‰²é£æ ¼ stylestyle ä¼šå½±å“å›¾è¡¨çš„é…è‰²é£æ ¼ï¼Œä¸€èˆ¬ç”¨10æ¯”è¾ƒå¤šå½©å¤šæ ·ã€‚ ä»£ç ç¤ºä¾‹ç»˜åˆ¶å›¾è¡¨ç”¨çš„æ•°æ®æ¥è‡ªè¿è¥çš„PythonæŒ‡å— - Python æ“ä½œExcelã€‚æˆ‘ä»¬åœ¨å·²æœ‰çš„è¡¨æ ¼ä¸­æ·»åŠ æŸ±å½¢å›¾ã€‚ä»£ç å‚è€ƒpython-playground - Github ç»˜åˆ¶2DæŸ±å½¢å›¾123456789101112131415161718192021222324def create_bar_chart_1(file_path): &quot;&quot;&quot; æ’å…¥æŸ±å½¢å›¾ :param file_path: Excel æ–‡ä»¶è·¯å¾„ :return: None &quot;&quot;&quot; wb = load_workbook(file_path) st = wb.active data1 = Reference(st, min_col=2, min_row=1, max_row=7, max_col=3) cats1 = Reference(st, min_col=1, min_row=2, max_row=7) chart1 = BarChart() chart1.type = &quot;col&quot; chart1.style = 9 chart1.title = &quot;æ—¥å‡å€¼å¯¹æ¯”&quot; # chart1.y_axis.title = 'æ•°å€¼' chart1.x_axis.title = st.cell(column=1, row=1).value chart1.add_data(data1, titles_from_data=True) chart1.set_categories(cats1) chart1.shape = 0 st.add_chart(chart1, 'A8') wb.save(file_path) ç»˜åˆ¶3DæŸ±å½¢å›¾1234567891011121314151617181920212223def create_bar_chart_2(file_path): &quot;&quot;&quot; æ’å…¥3DæŸ±å½¢å›¾ :param file_path: Excel æ–‡ä»¶è·¯å¾„ :return: None &quot;&quot;&quot; wb = load_workbook(file_path) st = wb.active data1 = Reference(st, min_col=2, min_row=1, max_row=7, max_col=3) cats1 = Reference(st, min_col=1, min_row=2, max_row=7) chart1 = BarChart3D() chart1.type = &quot;bar&quot; chart1.style = 10 chart1.title = &quot;æ—¥å‡å€¼å¯¹æ¯”&quot; chart1.x_axis.title = None chart1.shape = 'cylinder' chart1.add_data(data1, titles_from_data=True) chart1.set_categories(cats1) st.add_chart(chart1, 'A26') wb.save(file_path) è¿è¡Œç»“æœç¤ºä¾‹å›¾ç‰‡ ç›¸å…³ä»£ç è¯·å‚è€ƒ https://github.com/RustFisher/python-playground","link":"/2019/11/19/Python/Python-op-excel_openpyxl_bar_column_chart/"},{"title":"Python openpyxl Excelç»˜åˆ¶æŸ±å½¢å›¾","text":"è¿™æ˜¯ä¸€ä»½openpyxlçš„ä½¿ç”¨æŒ‡å—ã€‚ å¤§ä½“å†…å®¹ç¿»è¯‘è‡ªå®˜ç½‘ https://openpyxl.readthedocs.io/en/stable/charts/bar.html#vertical-horizontal-and-stacked-bar-charts æœ¬æ–‡åœ¨å®˜ç½‘åŸºç¡€ä¸Šä¼šæœ‰ä¸€äº›æ”¹åŠ¨ã€‚ä»£ç è¯·å‚è€ƒ https://github.com/RustFisher/python-playground æœ¬æ–‡é“¾æ¥ https://rustfisher.com/2019/11/14/Python/Python-openpyxl_charts_Bar_and_Column/ æŸ±å½¢å›¾æ•°æ®ä¼šè¢«ç»˜åˆ¶æˆå‚ç›´ï¼Œæ°´å¹³æˆ–è€…æ˜¯å±‚å æ•ˆæœçš„æŸ±å½¢å›¾ã€‚ æ³¨æ„ï¼š æ¥ä¸‹æ¥çš„è®¾ç½®ä¼šå½±å“åˆ°ä¸åŒç±»å‹çš„å›¾è¡¨ã€‚ è®¾ç½®ç±»åˆ«å¯ä»¥æ§åˆ¶æŸ±å½¢å›¾æ˜¯å‚ç›´æˆ–æ˜¯æ°´å¹³ã€‚ ä½¿ç”¨å±‚å å›¾å½¢æ—¶ï¼Œéœ€è¦è®¾ç½®overlapæˆ100ã€‚ å¦‚æœæŸ±å½¢æ˜¯æ°´å¹³çš„ï¼Œxå’Œyåæ ‡ä¼šå¯¹è°ƒè¿‡æ¥ã€‚ 2Då›¾è¡¨ ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼Œæ ¹æ®ç»™å®šçš„æ•°æ®ç»˜åˆ¶äº†4å¼ å›¾è¡¨ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768from openpyxl import Workbookfrom openpyxl.chart import BarChart, Series, Referencedef bar_chart_demo(): wb = Workbook(write_only=True) ws = wb.create_sheet() rows = [ ('Number', 'Batch 1', 'Batch 2'), (2, 10, 30), (3, 40, 60), (4, 50, 70), (5, 20, 10), (6, 10, 40), (7, 50, 30), ] for row in rows: ws.append(row) chart1 = BarChart() chart1.type = &quot;col&quot; chart1.style = 10 chart1.title = &quot;Bar Chart&quot; chart1.y_axis.title = 'Test number' chart1.x_axis.title = 'Sample length (mm)' data = Reference(ws, min_col=2, min_row=1, max_row=7, max_col=3) cats = Reference(ws, min_col=1, min_row=2, max_row=7) chart1.add_data(data, titles_from_data=True) chart1.set_categories(cats) chart1.shape = 4 ws.add_chart(chart1, &quot;A10&quot;) from copy import deepcopy chart2 = deepcopy(chart1) chart2.style = 11 chart2.type = &quot;bar&quot; chart2.title = &quot;Horizontal Bar Chart&quot; ws.add_chart(chart2, &quot;I10&quot;) chart3 = deepcopy(chart1) chart3.type = &quot;col&quot; chart3.style = 12 chart3.grouping = &quot;stacked&quot; chart3.overlap = 100 chart3.title = 'Stacked Chart' ws.add_chart(chart3, &quot;A27&quot;) chart4 = deepcopy(chart1) chart4.type = &quot;bar&quot; chart4.style = 13 chart4.grouping = &quot;percentStacked&quot; chart4.overlap = 100 chart4.title = 'Percent Stacked Chart' ws.add_chart(chart4, &quot;I27&quot;) wb.save(&quot;out/bar.xlsx&quot;)if __name__ == '__main__': bar_chart_demo() è¯‘è€…æ³¨ï¼šè¿™é‡Œè°ƒæ•´äº†å›¾è¡¨åœ¨excelä¸­çš„ä½ç½®ï¼ŒåŸæ–‡æ˜¯åœ¨Gåˆ—ï¼Œå³G10å’ŒG27ï¼Œè¿™é‡Œæ”¹ä¸ºäº†Iåˆ—ã€‚ä»£ç æ ¼å¼ä¹Ÿæœ‰å¾®è°ƒã€‚ æˆ‘ä»¬éœ€è¦ç”Ÿæˆå›¾è¡¨çš„æ—¶å€™ï¼ŒExcelä¼šè¦æˆ‘ä»¬å…ˆé€‰å®šæ•°æ®èŒƒå›´ï¼ˆæ¥æºï¼‰ã€‚åœ¨ä»£ç ä¸­ç”¨Referenceæ¥æŒ‡å®šæ•°æ®æ¥æºèŒƒå›´ã€‚ 3Då›¾è¡¨ç»˜åˆ¶3Då›¾è¡¨ï¼Œä½¿ç”¨BarChart3Dã€‚1234567891011121314151617181920212223def bar_3d(): wb = Workbook() ws = wb.active rows = [ (None, 2013, 2014), (&quot;Apples&quot;, 5, 4), (&quot;Oranges&quot;, 6, 2), (&quot;Pears&quot;, 8, 3) ] for row in rows: ws.append(row) data = Reference(ws, min_col=2, min_row=1, max_col=3, max_row=4) titles = Reference(ws, min_col=1, min_row=2, max_row=4) chart = BarChart3D() chart.title = &quot;3D Bar Chart&quot; chart.add_data(data=data, titles_from_data=True) chart.set_categories(titles) ws.add_chart(chart, &quot;E5&quot;) wb.save(&quot;out/bar3d.xlsx&quot;) åˆ›å»ºå¥½çš„å›¾è¡¨ç”¨WPSæ‰“å¼€å‘ç°æ˜¯2Dçš„ã€‚ç”¨Office Excelæ‰“å¼€æ˜¯3Dçš„ã€‚ ä»£ç è¯·å‚è€ƒ https://github.com/RustFisher/python-playground","link":"/2019/11/14/Python/Python-openpyxl_charts_Bar_and_Column/"},{"title":"ã€è¿è¥çš„PythonæŒ‡å—ã€‘Python æ“ä½œExcel","text":"è¿™æ˜¯ä¸€ä»½å†™ç»™è¿è¥äººå‘˜çš„PythonæŒ‡å—ã€‚æœ¬æ–‡ä¸»è¦è®²è¿°å¦‚ä½•ä½¿ç”¨Pythonæ“ä½œExcelã€‚å®ŒæˆExcelçš„åˆ›å»ºï¼ŒæŸ¥è¯¢å’Œä¿®æ”¹æ“ä½œã€‚ç›¸å…³ä»£ç è¯·å‚è€ƒ https://github.com/RustFisher/python-playground æœ¬æ–‡é“¾æ¥ï¼šhttps://www.rustfisher.com/2019/11/05/Python/Python-op-excel_openpyxl_use/ å¼€å‘å·¥å…·ï¼Œç¯å¢ƒ PyCharm - æ–¹ä¾¿å¥½ç”¨çš„IDE Python3 è¿™é‡Œé»˜è®¤ä½ çš„ç”µè„‘ä¸Šå·²ç»è£…æœ‰python3.xï¼Œç¯å¢ƒå˜é‡å·²ç»é…ç½®å¥½ã€‚ å¼•å…¥openpyxlè¿™é‡Œä½¿ç”¨openpyxlåº“æ¥æ“ä½œExcelã€‚ç±»ä¼¼çš„åº“è¿˜æœ‰xlrdã€‚ penpyxlçš„åŸºç¡€ä½¿ç”¨æ–¹æ³•è¯·å‚è§Python openpyxl å¤„ç†Excelä½¿ç”¨æŒ‡å—ã€‚ 1pip install openpyxl æ•°æ®å‡†å¤‡å‡å®šæ•°æ®æ¥è‡ªç™¾åº¦æŒ‡æ•°ï¼Œä»¥å¸¸è§çš„ä¸€äº›æœç´¢æŒ‡æ•°ä¸ºä¾‹ã€‚ç»™åé¢çš„æ“ä½œå‡†å¤‡ä¸€äº›æ•°æ®ï¼ŒæŠŠæ•°æ®å†™å…¥Excelä¸­ã€‚ åˆ›å»ºWorkbookå¯¹è±¡ï¼Œè·å–åˆ°å½“å‰å¯ç”¨çš„è¡¨æ ¼ï¼ˆsheetï¼‰ã€‚ç›´æ¥ä½¿ç”¨appendæ–¹æ³•æŠŠä¸€è¡Œæ•°æ®è¿½åŠ å†™å…¥ã€‚æœ€åè°ƒç”¨Workbookçš„ä¿å­˜æ–¹æ³•ï¼Œå­˜å‚¨æ•°æ®ã€‚ 1234567891011121314151617def create_excel_demo(file_path): &quot;&quot;&quot; åˆ›å»ºExcelæ–‡ä»¶ï¼Œå¹¶å†™å…¥æ•°æ® :param file_path: ç›®æ ‡æ–‡ä»¶è·¯å¾„ :return none &quot;&quot;&quot; wb = Workbook() ws = wb.active ws.title = 'æœç´¢æŒ‡æ•°æ¦‚è§ˆ' ws.append(['å…³é”®è¯', 'æ•´ä½“æ—¥å‡å€¼', 'ç§»åŠ¨æ—¥å‡å€¼', 'æ•´ä½“åŒæ¯”', 'æ•´ä½“ç¯æ¯”', 'ç§»åŠ¨åŒæ¯”', 'ç§»åŠ¨ç¯æ¯”']) ws.append(['excel', 27782, 18181, -0.11, -2, 0.21, 0.02]) ws.append(['python', 24267, 8204, 0.27, 0.06, 0.56, 0.01]) ws.append(['æ–‡æ¡ˆ', 2411, 1690, 0.56, 0.33, 0.91, 0.46]) ws.append(['okr', 1928, 880, 0.38, 0.15, 0.29, 0.09]) ws.append(['kpi', 4212, 2784, 0.21, -0.19, 0.36, -0.22]) wb.save(file_path) åˆ›å»ºå‡ºæ¥çš„è¡¨æ ¼ï¼Œç¤ºä¾‹æ•°æ®å¦‚ä¸‹ å…³é”®è¯ æ•´ä½“æ—¥å‡å€¼ ç§»åŠ¨æ—¥å‡å€¼ æ•´ä½“åŒæ¯” æ•´ä½“ç¯æ¯” ç§»åŠ¨åŒæ¯” ç§»åŠ¨ç¯æ¯” excel 27782 18181 -0.11 -2 0.21 0.02 python 24267 8204 0.27 0.06 0.56 0.01 â€¦ â€¦ â€¦ â€¦ â€¦ â€¦ â€¦ è¯»å–æ•°æ®è®¿é—®æ•´ä¸ªè¡¨æ ¼çš„æ•°æ®è®¿é—®è¡¨æ ¼ä¸­æ‰€æœ‰çš„æ•°æ®ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“è¡¨æ ¼ä¸­æœ‰æ•°æ®çš„å•å…ƒæ ¼çš„èŒƒå›´ï¼Œä½¿ç”¨sheet.max_rowä¸sheet.max_columnè·å–è¡¨æ ¼çš„è¡Œåˆ—æ•°é‡ã€‚ 12345678910111213def read_xlsx_basic(file_path): &quot;&quot;&quot; è¯»å–Excelçš„æ•°æ®å¹¶æ‰“å°å‡ºæ¥ &quot;&quot;&quot; wb = load_workbook(file_path) st = wb.active end_row = st.max_row + 1 end_column = st.max_column + 1 print(st.title, 'æœ‰', end_row, 'è¡Œ', end_column, 'åˆ—') for row in range(1, end_row): for col in range(1, end_column): print('{:10}'.format(st.cell(row=row, column=col).value), end='') print() å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå•å…ƒæ ¼ä¸‹æ ‡æ˜¯ä»1å¼€å§‹çš„ã€‚å¦‚æœä½¿ç”¨äº†ä¸å½“çš„ä¸‹æ ‡ï¼ŒæŠ¥é”™ä¿¡æ¯ ValueError: Row or column values must be at least 1 å‚è€ƒï¼š https://stackoverflow.com/questions/34492322/how-to-scan-all-sheet-cells ä¿®æ”¹è¡¨æ ¼æœ‰äº†Excelè¡¨æ ¼åï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹è¡¨æ ¼çš„ä¸€äº›æ ¼å¼å’Œæ•°æ®ã€‚ stè¡¨ç¤ºå½“å‰è¡¨ã€‚ è°ƒæ•´åˆ—çš„å®½åº¦ç”¨ column_dimensions æ¥è·å–åˆ—ã€‚ä¾‹å¦‚column_dimensions[â€˜Aâ€™]è·å–åˆ°çš„æ˜¯ç¬¬Aåˆ—ã€‚ordæ–¹æ³•æ˜¯å°†å­—ç¬¦è½¬æ¢ä¸ºasciiç ã€‚ord(â€˜Aâ€™)å¾—åˆ°65ã€‚ è¿™é‡Œè°ƒæ•´çš„æ˜¯Aåˆ—åˆ°Gåˆ—çš„å®½åº¦ã€‚12for col in range(ord('A'), ord('G') + 1): st.column_dimensions[chr(col)].width = 15 è®¾ç½®å•å…ƒæ ¼æ ¼å¼æ ¼å¼ï¼Œæ¯”å¦‚å­—ä½“å¤§å°ï¼Œå¯¹é½æ¨¡å¼ï¼Œç²—ä½“æ–œä½“ç­‰ã€‚ å­—ä½“é¦–å…ˆæˆ‘ä»¬è¦æ‹¿åˆ°å•å…ƒæ ¼cellï¼Œè¿™é‡Œä½¿ç”¨st.cell(row=1, column=col)æ¥è·å–æŸä¸€ä¸ªæ ¼å­ã€‚CellæŒæœ‰çš„fontæ˜¯ä¸å¯ä¿®æ”¹çš„ã€‚ä¸èƒ½ä½¿ç”¨å¦‚cell.font.size = 13è¿™æ ·çš„æ“ä½œï¼Œä¼šæŠ¥å¼‚å¸¸ã€‚copyæ–¹æ³•æ˜¯å¤åˆ¶ä¸€ä¸ªå¯¹è±¡ã€‚è¿™é‡Œå¤åˆ¶çš„æ˜¯fontã€‚ 12345cell = st.cell(row=1, column=col)font = copy(cell.font)font.size = 13font.bold = Truecell.font = font å¯¹é½å¯¹é½æ¨¡å¼ã€‚ä½¿ç”¨alignmentå±æ€§ã€‚1cell.alignment = Alignment(horizontal=&quot;center&quot;, vertical=&quot;center&quot;) æ•°æ®æ˜¾ç¤ºæ“ä½œExcelæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å•å…ƒæ ¼æ•°æ®æ˜¾ç¤ºçš„æ–¹å¼ï¼Œæ¯”å¦‚å¸¸è§„ï¼Œæ•°å€¼ï¼Œè´§å¸ï¼Œç™¾åˆ†æ¯”ç­‰ç­‰ã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯number_formatå±æ€§ã€‚ å¦‚æœæ•°æ®ï¼ˆvalueï¼‰æ˜¯0.02ï¼Œç»è¿‡ä¸‹é¢çš„è®¾ç½®åï¼ŒExcelä¸­æ˜¾ç¤ºçš„æ˜¯2%ã€‚1cell.number_format = '0%' ä¿®æ”¹æ•°æ®ä¿®æ”¹å•å…ƒæ ¼çš„æ•°å€¼ï¼ˆvalueï¼‰ã€‚ä¿®æ”¹æ•°æ®é¦–å…ˆè¦æ‹¿åˆ°é‚£ä¸ªå•å…ƒæ ¼cellï¼Œç„¶åå¯¹å…¶valueèµ‹å€¼ã€‚1st.cell(row=2, column=7).value = 0.42 # ä¿®æ”¹æ•°å€¼ ä¿®æ”¹äº†å•å…ƒæ ¼çš„æ ·å¼å’Œæ•°æ®åï¼Œå¯ä»¥æ‰“å¼€è¡¨æ ¼çœ‹çœ‹æ•ˆæœã€‚ å‚è€ƒï¼š https://stackoverflow.com/questions/12387212/openpyxl-setting-number-format https://stackoverflow.com/questions/30050716/how-to-put-two-decimals-in-cell-with-type-of-percent ç›¸å…³ä»£ç è¯·å‚è€ƒ https://github.com/RustFisher/python-playground","link":"/2019/11/05/Python/Python-op-excel_openpyxl_use/"},{"title":"Python openpyxl å¤„ç†Excelä½¿ç”¨æŒ‡å—","text":"è¿™æ˜¯ä¸€ä»½openpyxlçš„ä½¿ç”¨æŒ‡å—ã€‚ç¿»è¯‘è‡ªå®˜ç½‘ https://openpyxl.readthedocs.io/en/stable/tutorial.html æœ¬æ–‡é“¾æ¥ https://rustfisher.com/2019/11/03/Python/Python-openpyxl_tutorial/ åˆ›å»ºå·¥ä½œæœ¬workbookæŒ‡çš„å°±æ˜¯Excelæ–‡ä»¶ã€‚ä½¿ç”¨openpyxlå¹¶ä¸éœ€è¦ä½ åœ¨ç”µè„‘ä¸Šè‡ªå·±åˆ›å»ºæ–‡ä»¶ã€‚ç›´æ¥å¼•å…¥Workbookç±»å°±å¯ä»¥å¼€å§‹å·¥ä½œã€‚ 12&gt;&gt;&gt; from openpyxl import Workbook&gt;&gt;&gt; wb = Workbook() è‡³æ­¤ä¸€ä¸ªè‡³å°‘æœ‰1ä¸ªå·¥ä½œè¡¨çš„å·¥ä½œæœ¬å·²ç»è¢«åˆ›å»ºäº†ã€‚ä½ å¯ä»¥é€šè¿‡Workbook.activeå±æ€§æ¥è·å–åˆ°å·¥ä½œè¡¨ã€‚1&gt;&gt;&gt; ws = wb.active æ³¨æ„ï¼šé»˜è®¤å·¥ä½œè¡¨åºå·æ˜¯è¢«è®¾ç½®æˆ0çš„ã€‚é™¤éä½ ä¿®æ”¹äº†è¿™ä¸ªå€¼ï¼Œå¦åˆ™ç”¨è¿™ä¸ªæ–¹æ³•è·å–åˆ°çš„éƒ½æ˜¯ç¬¬ä¸€å¼ è¡¨ã€‚ å¯ä»¥é€šè¿‡ Workbook.create_sheet() æ–¹æ³•æ¥åˆ›å»ºæ–°çš„å·¥ä½œè¡¨ 12345&gt;&gt;&gt; ws1 = wb.create_sheet(&quot;Mysheet&quot;) # é»˜è®¤åœ¨åé¢æ’å…¥ä¸€å¼ æ–°è¡¨# æˆ–è€…&gt;&gt;&gt; ws2 = wb.create_sheet(&quot;Mysheet&quot;, 0) # åœ¨ç¬¬ä¸€ä½æ’å…¥æ–°è¡¨# æˆ–è€…&gt;&gt;&gt; ws3 = wb.create_sheet(&quot;Mysheet&quot;, -1) # åœ¨å€’æ•°ç¬¬äºŒçš„ä½ç½®æ’å…¥è¡¨ å·¥ä½œè¡¨è¢«åˆ›å»ºçš„æ—¶å€™ä¼šè‡ªåŠ¨å‘½åï¼Œåå­—æ˜¯ä»¥æ•°å­—åºåˆ—æ¥æ’çš„ï¼ˆä¾‹å¦‚Sheet, Sheet1, Sheet2, â€¦ï¼‰ã€‚å¯ä»¥ä½¿ç”¨ Worksheet.title æ¥ä¿®æ”¹å·¥ä½œè¡¨çš„åå­—ã€‚ 1ws.title = &quot;New Title&quot; é»˜è®¤æƒ…å†µä¸‹ï¼Œå·¥ä½œè¡¨åå­—çš„æ ‡é¢˜é¢œè‰²æ˜¯ç™½è‰²çš„ã€‚èµ‹äºˆRGBå€¼ Worksheet.sheet_properties.tabColor æ¥ä¿®æ”¹é¢œè‰²ã€‚ 1ws.sheet_properties.tabColor = &quot;1072BA&quot; å½“ä½ å‘½åäº†å·¥ä½œè¡¨åï¼Œä¹Ÿå¯ä»¥é€šè¿‡åå­—æ¥è·å–åˆ°è¿™å¼ è¡¨ã€‚ 1&gt;&gt;&gt; ws3 = wb[&quot;New Title&quot;] æŸ¥çœ‹å·¥ä½œæœ¬ä¸­æ‰€æœ‰è¡¨æ ¼çš„åå­—ï¼Œä½¿ç”¨ Workbook.sheetname å±æ€§ã€‚ 12&gt;&gt;&gt; print(wb.sheetnames)['Sheet2', 'New Title', 'Sheet1'] å¾ªç¯æ‰“å°åå­—12&gt;&gt;&gt; for sheet in wb:... print(sheet.title) åœ¨åŒä¸€ä¸ªå·¥ä½œæœ¬ï¼ˆExcelæ–‡ä»¶ï¼‰ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Workbook.copy_worksheet() å¤åˆ¶è¡¨æ ¼ã€‚12&gt;&gt;&gt; source = wb.active&gt;&gt;&gt; target = wb.copy_worksheet(source) æ³¨æ„åªæœ‰å•å…ƒæ ¼ï¼ˆåŒ…æ‹¬æ•°å€¼ï¼Œé£æ ¼ï¼Œè¶…é“¾æ¥å’Œæ³¨é‡Šï¼‰å’Œç¡®å®šçš„å·¥ä½œè¡¨å±æ€§ï¼ˆåŒ…æ‹¬å°ºå¯¸ï¼Œæ ¼å¼å’Œå±æ€§ï¼‰å¯ä»¥è¢«å¤åˆ¶ã€‚å·¥ä½œè¡¨å…¶ä»–çš„å†…å®¹æ˜¯ä¸èƒ½å¤åˆ¶çš„ï¼Œæ¯”å¦‚å›¾ç‰‡ï¼Œå›¾è¡¨ç­‰ã€‚ ä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„Excelæ–‡ä»¶ä¸­å¤åˆ¶è¡¨æ ¼ã€‚å¦‚æœExcelæ–‡ä»¶æ˜¯åªè¯»æˆ–åªå†™çš„ï¼Œå°±ä¸èƒ½å¤åˆ¶è¡¨æ ¼ã€‚ å¤„ç†æ•°æ®å•å…ƒæ ¼ç°åœ¨æˆ‘ä»¬çŸ¥é“æ¥å¦‚ä½•è·å–åˆ°å·¥ä½œè¡¨ã€‚æˆ‘ä»¬å¯ä»¥å¼€å§‹ä¿®æ”¹å•å…ƒæ ¼æ•°æ®äº†ã€‚ç”¨å•å…ƒæ ¼çš„åæ ‡å¯ä»¥è·å–åˆ°å•å…ƒæ ¼ã€‚1&gt;&gt;&gt; c = ws['A4']è¿”å›çš„æ˜¯A4å•å…ƒæ ¼ã€‚å¦‚æœä¹‹å‰A4ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºA4å•å…ƒæ ¼ã€‚ ç»™å•å…ƒæ ¼ä¼ å…¥æ•°æ®ï¼Œç›´æ¥èµ‹å€¼1&gt;&gt;&gt; ws['A4'] = 4 æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ Worksheet.cell() æ–¹æ³•ï¼Œé€šè¿‡è¡Œåˆ—åºå·çš„æ–¹å¼æ¥æ‹¿åˆ°å•å…ƒæ ¼ã€‚1&gt;&gt;&gt; d = ws.cell(row=4, column=2, value=10) æ³¨æ„å¦‚æœå·¥ä½œè¡¨æ˜¯åœ¨å†…å­˜ä¸­åˆ›å»ºçš„ï¼Œå®ƒæ˜¯ä¸åŒ…å«å•å…ƒæ ¼çš„ã€‚ç¬¬ä¸€æ¬¡è·å–å•å…ƒæ ¼æ—¶ä¼šå…ˆåˆ›å»ºå•å…ƒæ ¼ã€‚ è­¦å‘Šï¼šå› ä¸ºè¿™ä¸ªç‰¹æ€§ï¼Œå°±ç®—æ˜¯æ²¡ç»™å•å…ƒæ ¼èµ‹å€¼ï¼Œéå†çš„æ—¶å€™ä¼šç›´æ¥åœ¨å†…å­˜ä¸­åˆ›å»ºå®ƒä»¬ã€‚ ä¾‹å¦‚123&gt;&gt;&gt; for x in range(1,101):... for y in range(1,101):... ws.cell(row=x, column=y)ä¼šåœ¨å†…å­˜ä¸­åˆ›å»º 100x100 ä¸ªæ²¡æœ‰å€¼çš„å•å…ƒæ ¼ã€‚ å¤„ç†å¤šä¸ªå•å…ƒæ ¼è·å–ä¸€ä¸ªèŒƒå›´å†…çš„å¤šä¸ªå•å…ƒæ ¼ã€‚1&gt;&gt;&gt; cell_range = ws['A1':'C2'] è·å–è¡Œæˆ–åˆ—çš„å•å…ƒæ ¼1234&gt;&gt;&gt; colC = ws['C']&gt;&gt;&gt; col_range = ws['C:D']&gt;&gt;&gt; row10 = ws[10]&gt;&gt;&gt; row_range = ws[5:10] ä¹Ÿå¯ä»¥ç”¨ Worksheet.iter_rows() æ–¹æ³•123456789&gt;&gt;&gt; for row in ws.iter_rows(min_row=1, max_col=3, max_row=2):... for cell in row:... print(cell)&lt;Cell Sheet1.A1&gt;&lt;Cell Sheet1.B1&gt;&lt;Cell Sheet1.C1&gt;&lt;Cell Sheet1.A2&gt;&lt;Cell Sheet1.B2&gt;&lt;Cell Sheet1.C2&gt; ç±»ä¼¼çš„ Worksheet.iter_cols() ä¹Ÿä¼šè¿”å›åˆ—å•å…ƒæ ¼123456789&gt;&gt;&gt; for col in ws.iter_cols(min_row=1, max_col=3, max_row=2):... for cell in col:... print(cell)&lt;Cell Sheet1.A1&gt;&lt;Cell Sheet1.A2&gt;&lt;Cell Sheet1.B1&gt;&lt;Cell Sheet1.B2&gt;&lt;Cell Sheet1.C1&gt;&lt;Cell Sheet1.C2&gt; æ³¨æ„ï¼šæ€§èƒ½åŸå›  Worksheet.iter_cols() æ–¹æ³•åœ¨åªè¯»æ¨¡å¼ä¸‹ä¸èƒ½ä½¿ç”¨ã€‚ å¦‚æœä½ éœ€è¦éå†æ–‡ä»¶ä¸­çš„æ‰€æœ‰è¡Œåˆ—ï¼Œå¯ä»¥ä½¿ç”¨Worksheet.rows123456789101112&gt;&gt;&gt; ws = wb.active&gt;&gt;&gt; ws['C9'] = 'hello world'&gt;&gt;&gt; tuple(ws.rows)((&lt;Cell Sheet.A1&gt;, &lt;Cell Sheet.B1&gt;, &lt;Cell Sheet.C1&gt;),(&lt;Cell Sheet.A2&gt;, &lt;Cell Sheet.B2&gt;, &lt;Cell Sheet.C2&gt;),(&lt;Cell Sheet.A3&gt;, &lt;Cell Sheet.B3&gt;, &lt;Cell Sheet.C3&gt;),(&lt;Cell Sheet.A4&gt;, &lt;Cell Sheet.B4&gt;, &lt;Cell Sheet.C4&gt;),(&lt;Cell Sheet.A5&gt;, &lt;Cell Sheet.B5&gt;, &lt;Cell Sheet.C5&gt;),(&lt;Cell Sheet.A6&gt;, &lt;Cell Sheet.B6&gt;, &lt;Cell Sheet.C6&gt;),(&lt;Cell Sheet.A7&gt;, &lt;Cell Sheet.B7&gt;, &lt;Cell Sheet.C7&gt;),(&lt;Cell Sheet.A8&gt;, &lt;Cell Sheet.B8&gt;, &lt;Cell Sheet.C8&gt;),(&lt;Cell Sheet.A9&gt;, &lt;Cell Sheet.B9&gt;, &lt;Cell Sheet.C9&gt;)) æˆ–è€…æ˜¯Worksheet.columnså±æ€§1234567891011121314151617181920&gt;&gt;&gt; tuple(ws.columns)((&lt;Cell Sheet.A1&gt;,&lt;Cell Sheet.A2&gt;,&lt;Cell Sheet.A3&gt;,&lt;Cell Sheet.A4&gt;,&lt;Cell Sheet.A5&gt;,&lt;Cell Sheet.A6&gt;,...&lt;Cell Sheet.B7&gt;,&lt;Cell Sheet.B8&gt;,&lt;Cell Sheet.B9&gt;),(&lt;Cell Sheet.C1&gt;,&lt;Cell Sheet.C2&gt;,&lt;Cell Sheet.C3&gt;,&lt;Cell Sheet.C4&gt;,&lt;Cell Sheet.C5&gt;,&lt;Cell Sheet.C6&gt;,&lt;Cell Sheet.C7&gt;,&lt;Cell Sheet.C8&gt;,&lt;Cell Sheet.C9&gt;)) æ³¨æ„ï¼šåŸºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼ŒWorksheet.columnsåœ¨åªè¯»æ¨¡å¼ä¸­ä¸èƒ½ä½¿ç”¨ã€‚ è¯»å–æ•°æ®å¦‚æœåªæ˜¯è¦è¯»å–è¡¨ä¸­çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ Worksheet.valuesã€‚å®ƒä¼šè¿”å›è¡¨ä¸­æ‰€æœ‰è¡Œçš„å•å…ƒæ ¼çš„å€¼ã€‚ 123for row in ws.values: for value in row: print(value) Worksheet.iter_rows() å’Œ Worksheet.iter_cols() éƒ½å¯ä»¥è·å–åˆ°å•å…ƒæ ¼çš„å€¼ã€‚12345&gt;&gt;&gt; for row in ws.iter_rows(min_row=1, max_col=3, max_row=2, values_only=True):... print(row)(None, None, None)(None, None, None) æ•°æ®å­˜å‚¨å½“æˆ‘ä»¬æœ‰äº†å•å…ƒæ ¼åï¼Œå¯ä»¥èµ‹å€¼1234567&gt;&gt;&gt; c.value = 'hello, world'&gt;&gt;&gt; print(c.value)'hello, world'&gt;&gt;&gt; d.value = 3.14&gt;&gt;&gt; print(d.value)3.14 ä¿å­˜æ–‡ä»¶æœ€ç®€å•å’Œæœ€å®‰å…¨çš„ä¿å­˜æ–‡ä»¶çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ Workbook.save()ã€‚ 12wb = Workbook()wb.save('balances.xlsx') æ³¨æ„ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨æ²¡æœ‰è­¦å‘Šçš„æƒ…å†µä¸‹è¦†ç›–å·²æœ‰çš„æ–‡ä»¶ã€‚ æ–‡ä»¶æ‰©å±•åå¹¶æ²¡æœ‰è¢«é™åˆ¶ä¸ºxlsxæˆ–xlsmã€‚ å­˜å‚¨æˆä¸ºæµï¼ˆstreamï¼‰å¦‚æœè¦æŠŠæ–‡ä»¶å­˜æˆæµï¼Œä¾‹å¦‚webåº”ç”¨Pyramid, Flask æˆ–è€…Djangoï¼Œæä¾›ä¸€ä¸ªNamedTemporaryFile()å³å¯1234567&gt;&gt;&gt; from tempfile import NamedTemporaryFile&gt;&gt;&gt; from openpyxl import Workbook&gt;&gt;&gt; wb = Workbook()&gt;&gt;&gt; with NamedTemporaryFile() as tmp: wb.save(tmp.name) tmp.seek(0) stream = tmp.read() æŠŠå·¥ä½œæœ¬ä¿å­˜æˆä¸ºæ¨¡æ¿ï¼Œéœ€è¦æŒ‡å®šå±æ€§ template=True123&gt;&gt;&gt; wb = load_workbook('document.xlsx')&gt;&gt;&gt; wb.template = True&gt;&gt;&gt; wb.save('document_template.xltx') è®¾templateä¸ºFalseï¼Œå³ä¿å­˜ä¸ºæ–‡æ¡£ã€‚123&gt;&gt;&gt; wb = load_workbook('document_template.xltx')&gt;&gt;&gt; wb.template = False&gt;&gt;&gt; wb.save('document.xlsx', as_template=False) æ³¨æ„ï¼šåœ¨ä¿å­˜æ–‡æ¡£çš„æ—¶å€™åº”è¯¥æ³¨æ„æ–‡ä»¶æ‰©å±•åï¼Œæ¯”å¦‚.xltxå’Œ.xlsxã€‚ä»¥é˜²åé¢ç”¨å…¶ä»–è½¯ä»¶æ‰“å¼€çš„æ—¶å€™é‡åˆ°éº»çƒ¦ã€‚ æ¥ä¸‹æ¥çš„è¿™äº›æ˜¯é”™è¯¯æ“ä½œ123456789101112131415161718&gt;&gt;&gt; wb = load_workbook('document.xlsx')&gt;&gt;&gt; # éœ€è¦å­˜å‚¨æˆ*.xlsxæ–‡ä»¶&gt;&gt;&gt; wb.save('new_document.xlsm')&gt;&gt;&gt; # MS Excel å°†æ— æ³•æ‰“å¼€è¿™ä¸ªæ–‡ä»¶&gt;&gt;&gt;&gt;&gt;&gt; # æˆ–è€…&gt;&gt;&gt;&gt;&gt;&gt; # éœ€è¦æŒ‡å®š keep_vba=True&gt;&gt;&gt; wb = load_workbook('document.xlsm')&gt;&gt;&gt; wb.save('new_document.xlsm')&gt;&gt;&gt; # MS Excel å°†æ— æ³•æ‰“å¼€è¿™ä¸ªæ–‡ä»¶&gt;&gt;&gt;&gt;&gt;&gt; # æˆ–è€…&gt;&gt;&gt;&gt;&gt;&gt; wb = load_workbook('document.xltm', keep_vba=True)&gt;&gt;&gt; # å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¨¡æ¿æ–‡ä»¶ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å®šæ‰©å±•åä¸ºxltm&gt;&gt;&gt; wb.save('new_document.xlsm')&gt;&gt;&gt; # MS Excel å°†æ— æ³•æ‰“å¼€è¿™ä¸ªæ–‡ä»¶ è¯»å–æ–‡ä»¶å’Œå†™æ–‡ä»¶ç±»ä¼¼ï¼Œä½¿ç”¨openpyxl.load_workbook()æ–¹æ³•å»æ‰“å¼€ä¸€ä¸ªå·²æœ‰æ–‡ä»¶ã€‚1234&gt;&gt;&gt; from openpyxl import load_workbook&gt;&gt;&gt; wb2 = load_workbook('test.xlsx')&gt;&gt;&gt; print wb2.sheetnames['Sheet2', 'New Title', 'Sheet1']","link":"/2019/11/03/Python/Python-openpyxl_tutorial/"},{"title":"Android OkHttp + Retrofit æ–­ç‚¹ç»­ä¼ ","text":"æœ¬æ–‡é“¾æ¥ å‰é¢æˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•ä½¿ç”¨OkHttp+Retrofitä¸‹è½½æ–‡ä»¶ã€‚ä¸‹è½½æ–‡ä»¶æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸€äº›æ„å¤–æƒ…å†µï¼Œæ¯”å¦‚ç½‘ç»œé”™è¯¯æˆ–æ˜¯ç”¨æˆ·æš‚åœäº†ä¸‹è½½ã€‚å†æ¬¡å¯åŠ¨ä¸‹è½½ï¼Œå¦‚æœåˆè¦ä»å¤´å¼€å§‹ï¼Œä¼šç™½ç™½æµªè´¹å‰é¢ä¸‹è½½å¥½çš„å†…å®¹ã€‚æ–­ç‚¹ç»­ä¼ åŠŸèƒ½å¯ä»¥ä»ä¸Šæ¬¡åœæ­¢çš„åœ°æ–¹ç»§ç»­ä¸‹è½½æ–‡ä»¶ã€‚ httpèŒƒå›´è¯·æ±‚Range æ˜¯ä¸€ä¸ªè¯·æ±‚é¦–éƒ¨ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨è¿”å›æ–‡ä»¶çš„å“ªä¸€éƒ¨åˆ†ã€‚åœ¨ä¸€ä¸ª Range é¦–éƒ¨ä¸­ï¼Œå¯ä»¥ä¸€æ¬¡æ€§è¯·æ±‚å¤šä¸ªéƒ¨åˆ†ï¼ŒæœåŠ¡å™¨ä¼šä»¥ multipart æ–‡ä»¶çš„å½¢å¼å°†å…¶è¿”å›ã€‚å¦‚æœæœåŠ¡å™¨è¿”å›çš„æ˜¯èŒƒå›´å“åº”ï¼Œéœ€è¦ä½¿ç”¨ 206 Partial Content çŠ¶æ€ç ã€‚å‡å¦‚æ‰€è¯·æ±‚çš„èŒƒå›´ä¸åˆæ³•ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¼šè¿”å› 416 Range Not Satisfiable çŠ¶æ€ç ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯é”™è¯¯ã€‚æœåŠ¡å™¨å…è®¸å¿½ç•¥Rangeé¦–éƒ¨ï¼Œä»è€Œè¿”å›æ•´ä¸ªæ–‡ä»¶ï¼ŒçŠ¶æ€ç ç”¨200ã€‚ ç¤ºä¾‹1234Range: &lt;unit&gt;=&lt;range-start&gt;-Range: &lt;unit&gt;=&lt;range-start&gt;-&lt;range-end&gt;Range: &lt;unit&gt;=&lt;range-start&gt;-&lt;range-end&gt;, &lt;range-start&gt;-&lt;range-end&gt;Range: &lt;unit&gt;=&lt;range-start&gt;-&lt;range-end&gt;, &lt;range-start&gt;-&lt;range-end&gt;, &lt;range-start&gt;-&lt;range-end&gt; å‘èµ·è¯·æ±‚æ—¶ï¼Œä¸€èˆ¬Rangeçš„å†…å®¹å†™æˆ bytes=0-100 è¿™æ ·çš„å½¢å¼ã€‚æˆ–è€…è¯·æ±‚å¤šä¸ªéƒ¨åˆ†æ—¶ï¼ŒæŒ‡å®šå¤šä¸ªèŒƒå›´ã€‚1Range: bytes=200-1000, 2000-6576, 19000- Content-Range è¡¨ç¤ºä¸»ä½“é•¿åº¦æˆ–è€…å°ºå¯¸ã€‚ å‚è€ƒï¼š https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Range ä½¿ç”¨ç¤ºä¾‹å‚è€ƒhttps://github.com/AnRFDev/android-Basic4/tree/master/appdowloadsample ä½¿ç”¨OkHttpæ·»åŠ Rangeå¤´éƒ¨ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨æˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶æ•°æ®èŒƒå›´ã€‚ å®šä¹‰çš„æ–¹æ³•ä¸­è¦æ±‚ä¼ å…¥ @Header(â€œRangeâ€)12345private interface ApiService { @Streaming @GET Observable&lt;ResponseBody&gt; downloadPartial(@Url String url, @Header(&quot;Range&quot;) String range);} éœ€è¦ä¼ å…¥çš„Rangeå­—ç¬¦ä¸²å½¢å¦‚ bytes=200-1000 123456789101112131415161718192021222324252627282930313233343536373839retrofit.create(ApiService.class) .downloadPartial(callBack.getUrl(), &quot;bytes=&quot; + startByte + &quot;-&quot;) .subscribeOn(Schedulers.newThread()) .observeOn(Schedulers.io()) .doOnNext(new Consumer&lt;ResponseBody&gt;() { @Override public void accept(ResponseBody responseBody) throws Exception { callBack.saveFile(responseBody); } }) .doOnError(new Consumer&lt;Throwable&gt;() { @Override public void accept(Throwable throwable) throws Exception { tellDownloadError(callBack.getUrl(), throwable); } }) .observeOn(AndroidSchedulers.mainThread()) .subscribe(new Observer&lt;ResponseBody&gt;() { @Override public void onSubscribe(Disposable d) { } @Override public void onNext(ResponseBody responseBody) { } @Override public void onError(Throwable e) { callBack.setState(DownloadTaskState.ERROR); tellDownloadError(callBack.getUrl(), e); } @Override public void onComplete() { } }); æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä¸‹è½½å‰ï¼Œå…ˆå»æ£€æŸ¥æ–‡ä»¶å·²ä¸‹è½½çš„éƒ¨åˆ†çš„å¤§å°ï¼Œå†å†³å®šRangeèŒƒå›´ã€‚ç»­ä¼ æ—¶ï¼Œå†™å…¥æœ¬åœ°æ–‡ä»¶æ³¨æ„é€‰æ‹©æµçš„appendæ¨¡å¼ã€‚ 1fos = new FileOutputStream(file, true); æ›´å¤šè¯·å‚è€ƒï¼š Android OkHttp + Retrofit ä½¿ç”¨ç¤ºä¾‹ Android OkHttp + Retrofit å–æ¶ˆè¯·æ±‚çš„æ–¹æ³• Android OkHttp + Retrofit ä¸‹è½½æ–‡ä»¶ä¸è¿›åº¦ç›‘å¬ Android OkHttp + Retrofit æ–­ç‚¹ç»­ä¼ ","link":"/2019/10/18/Android/Android-OkHttp_Retrofit_download_file_partial/"},{"title":"Android OkHttp + Retrofit ä¸‹è½½æ–‡ä»¶ä¸è¿›åº¦ç›‘å¬","text":"æœ¬æ–‡é“¾æ¥ ä¸‹è½½æ–‡ä»¶æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„éœ€æ±‚ã€‚ç»™å®šä¸€ä¸ªurlï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨URLConnectionä¸‹è½½æ–‡ä»¶ã€‚ä½¿ç”¨OkHttpä¹Ÿå¯ä»¥é€šè¿‡æµæ¥ä¸‹è½½æ–‡ä»¶ã€‚ç»™OkHttpä¸­æ·»åŠ æ‹¦æˆªå™¨ï¼Œå³å¯å®ç°ä¸‹è½½è¿›åº¦çš„ç›‘å¬åŠŸèƒ½ã€‚ ä½¿ç”¨æµæ¥å®ç°ä¸‹è½½æ–‡ä»¶ä»£ç å¯ä»¥å‚è€ƒï¼šhttps://github.com/AnRFDev/android-Basic4/tree/master/appdowloadsample è·å–å¹¶ä½¿ç”¨å­—èŠ‚æµï¼Œéœ€è¦æ³¨æ„ä¸¤ä¸ªè¦ç‚¹ï¼Œä¸€ä¸ªæ˜¯æœåŠ¡æ¥å£æ–¹æ³•çš„ @Streaming æ³¨è§£ï¼Œå¦ä¸€ä¸ªæ˜¯è·å–åˆ°ResponseBodyã€‚ è·å–æµï¼ˆStreamï¼‰ã€‚å…ˆå®šä¹‰ä¸€ä¸ªæœåŠ¡ApiServiceã€‚ç»™æ–¹æ³•æ·»åŠ ä¸Š@Streamingçš„æ³¨è§£ã€‚ 12345private interface ApiService { @Streaming @GET Observable&lt;ResponseBody&gt; download(@Url String url);} åˆå§‹åŒ–OkHttpã€‚è®°å¾—å¡«å…¥ä½ çš„baseUrlã€‚123456789OkHttpClient okHttpClient = new OkHttpClient.Builder() .connectTimeout(8, TimeUnit.SECONDS) .build();retrofit = new Retrofit.Builder() .client(okHttpClient) .addCallAdapterFactory(RxJava2CallAdapterFactory.create()) .baseUrl(&quot;https://yourbaseurl.com&quot;) .build(); å‘èµ·ç½‘ç»œè¯·æ±‚ã€‚è·å–åˆ°ResponseBodyã€‚123456789101112131415161718192021222324252627282930313233343536373839String downUrl = &quot;xxx.com/aaa.apk&quot;;retrofit.create(ApiService.class) .download(downUrl) .subscribeOn(Schedulers.io()) .observeOn(Schedulers.io()) .doOnNext(new Consumer&lt;ResponseBody&gt;() { @Override public void accept(ResponseBody responseBody) throws Exception { // å¤„ç† ResponseBody ä¸­çš„æµ } }) .doOnError(new Consumer&lt;Throwable&gt;() { @Override public void accept(Throwable throwable) throws Exception { Log.e(TAG, &quot;accept on error: &quot; + downUrl, throwable); } }) .observeOn(AndroidSchedulers.mainThread()) .subscribe(new Observer&lt;ResponseBody&gt;() { @Override public void onSubscribe(Disposable d) { } @Override public void onNext(ResponseBody responseBody) { } @Override public void onError(Throwable e) { Log.e(TAG, &quot;Download center retrofit onError: &quot;, e); } @Override public void onComplete() { } }); é€šè¿‡ResponseBodyæ‹¿åˆ°å­—èŠ‚æµ body.byteStream()ã€‚è¿™é‡Œä¼šå…ˆåˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶tmpFileï¼ŒæŠŠæ•°æ®å†™åˆ°ä¸´æ—¶æ–‡ä»¶é‡Œã€‚ä¸‹è½½å®Œæˆåå†é‡å‘½åæˆç›®æ ‡æ–‡ä»¶targetFileã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778public void saveFile(ResponseBody body) { state = DownloadTaskState.DOWNLOADING; byte[] buf = new byte[2048]; int len; FileOutputStream fos = null; try { Log.d(TAG, &quot;saveFile: body content length: &quot; + body.contentLength()); srcInputStream = body.byteStream(); File dir = tmpFile.getParentFile(); if (dir == null) { throw new FileNotFoundException(&quot;target file has no dir.&quot;); } if (!dir.exists()) { boolean m = dir.mkdirs(); onInfo(&quot;Create dir &quot; + m + &quot;, &quot; + dir); } File file = tmpFile; if (!file.exists()) { boolean c = file.createNewFile(); onInfo(&quot;Create new file &quot; + c); } fos = new FileOutputStream(file); long time = System.currentTimeMillis(); while ((len = srcInputStream.read(buf)) != -1 &amp;&amp; !isCancel) { fos.write(buf, 0, len); int duration = (int) (System.currentTimeMillis() - time); int overBytes = len - downloadBytePerMs() * duration; if (overBytes &gt; 0) { try { Thread.sleep(overBytes / downloadBytePerMs()); } catch (Exception e) { e.printStackTrace(); } } time = System.currentTimeMillis(); if (isCancel) { state = DownloadTaskState.CLOSING; srcInputStream.close(); break; } } if (!isCancel) { fos.flush(); boolean rename = tmpFile.renameTo(targetFile); if (rename) { setState(DownloadTaskState.DONE); onSuccess(url); } else { setState(DownloadTaskState.ERROR); onError(url, new Exception(&quot;Rename file fail. &quot; + tmpFile)); } } } catch (FileNotFoundException e) { Log.e(TAG, &quot;saveFile: FileNotFoundException &quot;, e); setState(DownloadTaskState.ERROR); onError(url, e); } catch (Exception e) { Log.e(TAG, &quot;saveFile: IOException &quot;, e); setState(DownloadTaskState.ERROR); onError(url, e); } finally { try { if (srcInputStream != null) { srcInputStream.close(); } if (fos != null) { fos.close(); } } catch (IOException e) { Log.e(TAG, &quot;saveFile&quot;, e); } if (isCancel) { onCancel(url); } }} æ¯æ¬¡è¯»æ•°æ®çš„å¾ªç¯ï¼Œè®¡ç®—è¯»äº†å¤šå°‘æ•°æ®å’Œç”¨äº†å¤šå°‘æ—¶é—´ã€‚è¶…è¿‡é™é€Ÿåä¸»åŠ¨sleepä¸€ä¸‹ï¼Œè¾¾åˆ°æ§åˆ¶ä¸‹è½½é€Ÿåº¦çš„æ•ˆæœã€‚è¦æ³¨æ„ä¸èƒ½sleepå¤ªä¹…ï¼Œä»¥å…socketå…³é—­ã€‚è¿™é‡Œæ§åˆ¶çš„æ˜¯ç½‘ç»œæ•°æ®æµä¸æœ¬åœ°æ–‡ä»¶çš„è¯»å†™é€Ÿåº¦ã€‚ ä¸‹è½½è¿›åº¦ç›‘å¬OkHttpå®ç°ä¸‹è½½è¿›åº¦ç›‘å¬ï¼Œå¯ä»¥ä»å­—èŠ‚æµçš„è¯»å†™é‚£é‡Œå…¥æ‰‹ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨æ‹¦æˆªå™¨ï¼Œå‚è€ƒå®˜æ–¹çš„ä¾‹å­ã€‚è¿™é‡Œç”¨æ‹¦æˆªå™¨çš„æ–¹å¼å®ç°ç½‘ç»œä¸‹è½½è¿›åº¦ç›‘å¬åŠŸèƒ½ã€‚ å®šä¹‰å›è°ƒä¸ç½‘ç»œæ‹¦æˆªå™¨å…ˆå®šä¹‰å›è°ƒã€‚123public interface ProgressListener { void update(String url, long bytesRead, long contentLength, boolean done);} è‡ªå®šä¹‰ProgressResponseBodyã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class ProgressResponseBody extends ResponseBody { private final ResponseBody responseBody; private final ProgressListener progressListener; private BufferedSource bufferedSource; private final String url; ProgressResponseBody(String url, ResponseBody responseBody, ProgressListener progressListener) { this.responseBody = responseBody; this.progressListener = progressListener; this.url = url; } @Override public MediaType contentType() { return responseBody.contentType(); } @Override public long contentLength() { return responseBody.contentLength(); } @Override public BufferedSource source() { if (bufferedSource == null) { bufferedSource = Okio.buffer(source(responseBody.source())); } return bufferedSource; } private Source source(final Source source) { return new ForwardingSource(source) { long totalBytesRead = 0L; @Override public long read(Buffer sink, long byteCount) throws IOException { long bytesRead = super.read(sink, byteCount); // read() returns the number of bytes read, or -1 if this source is exhausted. totalBytesRead += bytesRead != -1 ? bytesRead : 0; progressListener.update(url, totalBytesRead, responseBody.contentLength(), bytesRead == -1); return bytesRead; } }; }} å®šä¹‰æ‹¦æˆªå™¨ã€‚ä»Responseä¸­è·å–ä¿¡æ¯ã€‚1234567891011121314151617public class ProgressInterceptor implements Interceptor { private ProgressListener progressListener; public ProgressInterceptor(ProgressListener progressListener) { this.progressListener = progressListener; } @NotNull @Override public Response intercept(@NotNull Chain chain) throws IOException { Response originalResponse = chain.proceed(chain.request()); return originalResponse.newBuilder() .body(new ProgressResponseBody(chain.request().url().url().toString(), originalResponse.body(), progressListener)) .build(); }} æ·»åŠ æ‹¦æˆªå™¨åœ¨åˆ›å»ºOkHttpClientæ—¶æ·»åŠ ProgressInterceptorã€‚123456789OkHttpClient okHttpClient = new OkHttpClient.Builder() .connectTimeout(8, TimeUnit.SECONDS) .addInterceptor(new ProgressInterceptor(new ProgressListener() { @Override public void update(String url, long bytesRead, long contentLength, boolean done) { // tellProgress(url, bytesRead, contentLength, done); } })) .build(); å€¼å¾—æ³¨æ„çš„æ˜¯è¿™é‡Œçš„è¿›åº¦æ›´æ–°éå¸¸é¢‘ç¹ã€‚å¹¶ä¸ä¸€å®šæ¯æ¬¡å›è°ƒéƒ½è¦å»æ›´æ–°UIã€‚ æ›´å¤šè¯·å‚è€ƒï¼š Android OkHttp + Retrofit ä½¿ç”¨ç¤ºä¾‹ Android OkHttp + Retrofit å–æ¶ˆè¯·æ±‚çš„æ–¹æ³• Android OkHttp + Retrofit ä¸‹è½½æ–‡ä»¶ä¸è¿›åº¦ç›‘å¬ Android OkHttp + Retrofit æ–­ç‚¹ç»­ä¼ ","link":"/2019/10/18/Android/Android-OkHttp_Retrofit_download_file/"},{"title":"Python ä½¿ç”¨FFmpegæ“ä½œmp4","text":"ä½¿ç”¨FFmpegé¦–å…ˆå¾—äº†è§£FFmpegçš„ç”¨æ³•ã€‚ 1ffmpeg -i red.mkv -f flac -vn red.flac å¦‚æœéŸ³é¢‘ï¼ˆè§†é¢‘ï¼‰æ¯”å­—å¹•å¿«ï¼ˆæˆ–æ…¢ï¼‰ï¼Œåˆ™åœ¨è£å‰ªçš„æ—¶å€™ç»Ÿä¸€åŠ ä¸Šæˆ–å‡å»ä¸€ä¸ªæ—¶é—´å·®ã€‚ FFmpegPyCharm æŠ¥é”™ â€˜ffmpegâ€™ ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åº è™šæ‹Ÿç¯å¢ƒä¸­éœ€è¦æ‰¾åˆ°FFmpegçš„ç»å¯¹è·¯å¾„ 1ffmpeg_bin = 'E:/ffmpeg-20191019-31aafda-win64-static/bin/ffmpeg' 1subprocess.call(get_mp3_cmd, shell=True) Pythonpython è¯»å–æ–‡ä»¶æ—¶æŠ¥é”™ UnicodeDecodeError: 'gbk' codec can't decodeé”™è¯¯UnicodeEncodeError: â€˜gbk' codec can't encode character â€˜\\xa0' in position åœ¨ç½‘ä¸Šä¸€æŸ¥ï¼Œå‘ç°æ˜¯ Windows çš„æ§åˆ¶å°çš„é—®é¢˜ã€‚æ§åˆ¶å°çš„ç¼–ç æ˜¯ GBKï¼ŒPython æ˜¯ UTF-8ï¼Œé€ æˆäº†å†²çªã€‚ ç¬¬ä¸€ç§æ–¹æ³•ï¼šç›´æ¥æ›¿æ¢å‡ºé”™çš„å†…å®¹123import requests url = 'https://blog.csdn.net/jianhong1990/article/details/17349537'print(requests.get(url).text.replace('\\xa0', ' ')) ç¬¬äºŒç§æ–¹æ³•ï¼šå†è§£ç  å…ˆç”¨ GBK ç¼–ç ï¼ŒåŠ ä¸ª ignore ä¸¢å¼ƒé”™è¯¯çš„å­—ç¬¦ï¼Œç„¶åå†è§£ç ã€‚ 123import requestsurl = 'https://blog.csdn.net/jianhong1990/article/details/17349537'print(requests.get(url).text.encode('gbk', 'ignore').decode('gbk') intä¸stringä¹‹é—´çš„è½¬åŒ–strè½¬æˆæ•°å­—1ms = int(ms) æ•°å­—è½¬æˆstrè¡¥é›¶1'{:0&gt;2d}'.format(1) # output 01 è·å–å½“å‰æ—¶é—´1234567import timetime.time() # æ ¼å¼åŒ–æ—¶é—´æˆ³ä¸ºæ ‡å‡†æ ¼å¼print(time.strftime('%Y%m%d-%H%M%S', time.localtime(time.time())))# è·å–30å¤©å‰çš„æ—¶é—´ï¼ˆé€šè¿‡åŠ å‡ç§’æ•°æ¥è·å–ç°åœ¨æˆ–è€…æœªæ¥æŸä¸ªæ—¶é—´ç‚¹ï¼‰print time.strftime('%Y.%m.%d',time.localtime(time.time()-2592000)) å‚è€ƒ http://www.zimuku.la/detail/123853.html http://assrt.net/","link":"/2019/10/09/Python/Python-FFmpeg-extraction-mp4_tool/"},{"title":"Android MediaPlayer éŸ³é¢‘å€é€Ÿæ’­æ”¾ï¼Œè°ƒæ•´æ’­æ”¾é€Ÿåº¦","text":"æœ¬æ–‡é“¾æ¥ï¼š Android MediaPlayer éŸ³é¢‘å€é€Ÿæ’­æ”¾ï¼Œè°ƒæ•´æ’­æ”¾é€Ÿåº¦ ç°åœ¨å¸‚é¢ä¸Šçš„å¾ˆå¤šéŸ³è§†é¢‘Appéƒ½æœ‰å€é€Ÿæ’­æ”¾çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æŠŠæ’­æ”¾é€Ÿåº¦è°ƒæ•´ä¸º0.5ã€1.5ã€2å€ç­‰ç­‰ã€‚ ä»Android API 23 (Android M)å¼€å§‹ï¼ŒMediaPlayeræ”¯æŒè°ƒæ•´æ’­æ”¾é€Ÿåº¦ã€‚ä½¿ç”¨çš„æ–¹æ³•æ˜¯setPlaybackParamsï¼Œä¼ å…¥ä¸€ä¸ªä»£è¡¨æ’­æ”¾å±æ€§çš„ç±»PlaybackParamsã€‚ æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨MediaPlayerè°ƒæ•´æ’­æ”¾é€Ÿåº¦ã€‚ MediaPlayer.setPlaybackParams è¯´æ˜æ’­æ”¾é€Ÿåº¦è®¾ç½®åœ¨PlaybackParamså¯¹è±¡ä¸­ï¼Œå†å°†æ­¤å¯¹è±¡ä¼ å…¥setPlaybackParamsã€‚ setPlaybackParamsæ˜¯ä¸€ä¸ªnativeæ–¹æ³•ã€‚å¦‚æœMediaPlayeræ²¡æœ‰å‡†å¤‡ï¼ˆåœ¨preparedä¹‹å‰ï¼‰ï¼Œè°ƒç”¨æ­¤æ–¹æ³•å¹¶ä¸ä¼šæ”¹å˜MediaPlayerçš„çŠ¶æ€ã€‚åœ¨MediaPlayeræˆåŠŸprepareä¹‹åï¼Œå¦‚æœè®¾ç½®çš„é€Ÿåº¦ä¸º0ï¼Œç›¸å½“äºè°ƒç”¨äº†pauseæ–¹æ³•ï¼›å¦‚æœè®¾ç½®é€Ÿåº¦ä¸ä¸º0ï¼Œç›¸å½“äºè°ƒç”¨äº†startæ–¹æ³•ã€‚ å¼‚å¸¸æƒ…å†µå¦‚æœMediaPlayeræ²¡æœ‰åˆå§‹åŒ–æˆ–è€…å·²ç»è¢«é‡Šæ”¾ï¼Œå³å¤„äºIdleæˆ–EndçŠ¶æ€ï¼Œè°ƒç”¨setPlaybackParamsæ–¹æ³•ä¼šæŠ›å‡ºIllegalStateExceptionå¼‚å¸¸ã€‚ å¦‚æœä¼ å…¥çš„PlaybackParamsä¸è¢«æ”¯æŒï¼Œåˆ™æŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸ã€‚ å¦‚æœè®¾ç½®é€Ÿåº¦å°äº0ï¼Œåˆ™æŠ›å‡ºjava.lang.IllegalArgumentExceptionå¼‚å¸¸ã€‚ MediaPlayer.setPlaybackParams æ–¹æ³•ç¤ºä¾‹è®¾ç½®æ’­æ”¾é€Ÿåº¦ã€‚å…ˆåˆ¤æ–­å½“å‰ç³»ç»Ÿç‰ˆæœ¬ã€‚ 123456789private boolean setPlaySpeed(float speed) { if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) { PlaybackParams params = mediaPlayer.getPlaybackParams(); params.setSpeed(speed); mediaPlayer.setPlaybackParams(params); return true; } return false;} getPlaybackParamså¯ä»¥è·å–åˆ°MediaPlayerå½“å‰çš„PlaybackParamså¯¹è±¡ã€‚ä¹Ÿå¯ä»¥ç»™è¿™ä¸ªæ–¹æ³•åŠ ä¸Štry catchï¼Œç»“åˆè¿”å›çš„booleanå€¼åˆ¤æ–­è®¾ç½®é€Ÿåº¦æ˜¯å¦æˆåŠŸã€‚ 1234567891011121314private boolean setPlaySpeed(float speed) { if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) { try { PlaybackParams params = mediaPlayer.getPlaybackParams(); params.setSpeed(speed); mediaPlayer.setPlaybackParams(params); return true; } catch (Exception e) { Log.e(TAG, &quot;setPlaySpeed: &quot;, e); return false; } } return false;} å‚è€ƒä»£ç  https://github.com/RustFisher/android-MediaPlayer PlaybackParams åŒ…å«çš„é€Ÿåº¦å€¼è°ƒæ•´MediaPlayeræ’­æ”¾é€Ÿåº¦æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†PlaybackParamså¯¹è±¡ã€‚AudioTrackä¹Ÿä¼šç”¨åˆ°è¿™ä¸ªç±»ã€‚ PlaybackParamsåŒ…å«ç€æ’­æ”¾æ—¶å€™çš„ä¸€äº›å±æ€§ã€‚ä¾‹å¦‚speedå°±æ˜¯æ’­æ”¾é€Ÿåº¦ã€‚ PlaybackParams.setSpeed(float speed)ä¼ å…¥é€Ÿåº¦å€ç‡å€¼ã€‚ä¼šæ ‡è®°å½“å‰è®¾ç½®è¿‡äº†é€Ÿåº¦ã€‚ 12345public PlaybackParams setSpeed(float speed) { mSpeed = speed; mSet |= SET_SPEED; return this;} PlaybackParams.getSpeed()è·å–å·²è®¾ç½®çš„é€Ÿåº¦å€¼ã€‚å¦‚æœä¹‹å‰æ²¡è®¾ç½®è¿‡é€Ÿåº¦ï¼Œåˆ™æŠ›å‡ºIllegalStateExceptionå¼‚å¸¸ã€‚ 123456public float getSpeed() { if ((mSet &amp; SET_SPEED) == 0) { throw new IllegalStateException(&quot;speed not set&quot;); } return mSpeed;} æ›´å¤šå‚è€ƒï¼š Android MediaPlayer åŸºç¡€ç®€ä»‹ Android MediaPlayer æ’­æ”¾éŸ³é¢‘ Android ä½¿ç”¨URLConnectionä¸‹è½½éŸ³é¢‘æ–‡ä»¶ Android MediaPlayer éŸ³é¢‘å€é€Ÿæ’­æ”¾ï¼Œè°ƒæ•´æ’­æ”¾é€Ÿåº¦ AndroidéŸ³è§†é¢‘ç›¸å…³æ–‡ç« è¯·å‚è€ƒ https://rustfisher.com/tags/Android-Media/","link":"/2019/09/25/Android/Android-MediaPlayer_use_play_speed/"},{"title":"Android ä½¿ç”¨URLConnectionä¸‹è½½éŸ³é¢‘æ–‡ä»¶","text":"æœ¬æ–‡é“¾æ¥ï¼š Android ä½¿ç”¨URLConnectionä¸‹è½½éŸ³é¢‘æ–‡ä»¶ ä½¿ç”¨MediaPlayeræ’­æ”¾åœ¨çº¿éŸ³é¢‘ï¼Œè¯·å‚è€ƒAndroid MediaPlayer æ’­æ”¾éŸ³é¢‘ æœ‰æ—¶å€™æˆ‘ä»¬ä¼šéœ€è¦ä¸‹è½½éŸ³é¢‘æ–‡ä»¶ã€‚è¿™é‡Œæä¾›ä¸€ç§æ€è·¯ï¼Œå°†åœ¨çº¿éŸ³é¢‘æ–‡ä»¶é€šè¿‡æµå†™åˆ°æœ¬åœ°æ–‡ä»¶ä¸­ã€‚ä½¿ç”¨URLConnectionæ¥å»ºç«‹è¿æ¥ï¼Œè·å–åˆ°çš„æ•°æ®å†™åˆ°æ–‡ä»¶ä¸­ã€‚ URLConnectionå»ºç«‹è¿æ¥åï¼Œå¯ä»¥è·å–åˆ°æ•°æ®é•¿åº¦ã€‚ç”±æ­¤æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºä¸‹è½½è¿›åº¦ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344public class DownloadStreamThread extends Thread { String urlStr; final String targetFileAbsPath; public DownloadStreamThread(String urlStr, String targetFileAbsPath) { this.urlStr = urlStr; this.targetFileAbsPath = targetFileAbsPath; } @Override public void run() { super.run(); int count; File targetFile = new File(targetFileAbsPath); try { boolean n = targetFile.createNewFile(); Log.d(TAG, &quot;Create new file: &quot; + n + &quot;, &quot; + targetFile); } catch (IOException e) { Log.e(TAG, &quot;run: &quot;, e); } try { URL url = new URL(urlStr); URLConnection connection = url.openConnection(); connection.connect(); int contentLength = connection.getContentLength(); InputStream input = new BufferedInputStream(url.openStream()); OutputStream output = new FileOutputStream(targetFileAbsPath); byte[] buffer = new byte[1024]; long total = 0; while ((count = input.read(buffer)) != -1) { total += count; Log.d(TAG, String.format(Locale.CHINA, &quot;Download progress: %.2f%%&quot;, 100 * (total / (double) contentLength))); output.write(buffer, 0, count); } output.flush(); output.close(); input.close(); } catch (Exception e) { Log.e(TAG, &quot;run: &quot;, e); } }} å¯åŠ¨ä¸‹è½½ï¼Œå³å¯åŠ¨çº¿ç¨‹ã€‚1new DownloadStreamThread(urlStr, targetFileAbsPath).start(); å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæœ¬åœ°å·²ç»æœ‰äº†æ–‡ä»¶ï¼Œéœ€è¦åšä¸€äº›é€»è¾‘åˆ¤æ–­ã€‚ä¾‹å¦‚æ˜¯å¦åˆ æ‰æ—§æ–‡ä»¶ï¼Œé‡æ–°ä¸‹è½½ã€‚æˆ–æ˜¯åˆ¤æ–­å‡ºå·²æœ‰æ–‡ä»¶ï¼Œä¸­æ­¢æ­¤æ¬¡ä¸‹è½½ä»»åŠ¡ã€‚ä¾‹å¦‚å¯ä»¥ç”¨connection.getContentLength()ä¸å½“å‰æ–‡ä»¶é•¿åº¦æ¥æ¯”è¾ƒï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™åˆ æ‰æœ¬åœ°æ–‡ä»¶ï¼Œé‡æ–°ä¸‹è½½ã€‚ å®é™…ä¸Šï¼ŒURLConnectionèƒ½å¤„ç†å¾ˆå¤šæµåª’ä½“ã€‚åœ¨è¿™é‡Œæ˜¯ç”¨æ¥ä¸‹è½½éŸ³é¢‘æ–‡ä»¶ã€‚å¯ä»¥å®ç°ä¸‹è½½åŠŸèƒ½å’Œç±»ä¼¼â€œè¾¹ä¸‹è¾¹æ’­â€çš„åŠŸèƒ½ã€‚ ä»£ç å¯ä»¥å‚è€ƒç¤ºä¾‹å·¥ç¨‹ï¼š https://github.com/RustFisher/android-MediaPlayer æ›´å¤šå‚è€ƒï¼š Android MediaPlayer åŸºç¡€ç®€ä»‹ Android MediaPlayer æ’­æ”¾éŸ³é¢‘ Android ä½¿ç”¨URLConnectionä¸‹è½½éŸ³é¢‘æ–‡ä»¶ Android MediaPlayer éŸ³é¢‘å€é€Ÿæ’­æ”¾ï¼Œè°ƒæ•´æ’­æ”¾é€Ÿåº¦ AndroidéŸ³è§†é¢‘ç›¸å…³æ–‡ç« è¯·å‚è€ƒ https://rustfisher.com/tags/Android-Media/","link":"/2019/09/23/Android/Android-Media_download_stream_file/"},{"title":"Android MediaPlayer æ’­æ”¾éŸ³é¢‘","text":"æœ¬æ–‡é“¾æ¥ï¼š Android MediaPlayer æ’­æ”¾éŸ³é¢‘ ä¸»è¦ä»‹ç»ä½¿ç”¨MediaPlayeræ’­æ”¾éŸ³é¢‘çš„æ–¹å¼ã€‚å…³äºMediaPlayerçš„åŸºç¡€çŸ¥è¯†ï¼Œæ¯”å¦‚çŠ¶æ€ï¼Œå¯ä»¥å‚è€ƒAndroid MediaPlayer åŸºç¡€ç®€ä»‹ã€‚ ä¸ºäº†æ–¹ä¾¿è¡¨è¾¾ï¼Œå®šä¹‰å˜é‡åä¸ºmediaPlayerã€‚ MediaPlayerçš„ä½¿ç”¨æ–¹å¼åˆ›å»ºMediaPlayerå¯ä»¥ç›´æ¥ new MediaPlayerï¼Œä¹Ÿå¯ä»¥ç”¨MediaPlayeræä¾›çš„createæ–¹æ³•åˆ›å»ºã€‚1mediaPlayer = new MediaPlayer(); ä½¿ç”¨createæ–¹æ³•åˆ›å»ºæˆåŠŸåï¼ŒmediaPlayerå¤„äºPreparedçŠ¶æ€ã€‚å¯ä»¥ç›´æ¥startæ’­æ”¾ã€‚12mediaPlayer = MediaPlayer.create(getApplicationContext(), Uri.fromFile(file));mediaPlayer.start(); è®¾ç½®éŸ³æº - setDataSourceé€šè¿‡è°ƒç”¨setDataSourceæ¥è®¾ç½®éŸ³æºã€‚setDataSourceæœ‰å¤šä¸ªé‡è½½æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹å¸¸ç”¨çš„å‡ ç§ã€‚ ä¾‹å¦‚è®¾ç½®ä½¿ç”¨assetsé‡Œçš„èµ„æºã€‚å®é™…æƒ…å†µå¯èƒ½éœ€è¦try catchã€‚1234AssetFileDescriptor fd = null;MediaPlayer mediaPlayer = new MediaPlayer();fd = context.getApplicationContext().getAssets().openFd(name);mediaPlayer.setDataSource(fd.getFileDescriptor(), fd.getStartOffset(), fd.getLength()); æœ¬åœ°æ–‡ä»¶ï¼Œéœ€è¦æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚1mediaPlayer.setDataSource(file.getAbsolutePath()); æˆ–è€…è·å–æ–‡ä»¶çš„Uriæ¥åˆ›å»ºmediaPlayerã€‚1mediaPlayer = MediaPlayer.create(getApplicationContext(), Uri.fromFile(file)); è®¾ç½®ç½‘ç»œéŸ³é¢‘ï¼Œä¹Ÿæ˜¯ç”¨setDataSourceæ–¹æ³•ï¼Œè®¾ç½®urlã€‚1mediaPlayer.setDataSource(&quot;https://demo.com/sample.mp3&quot;)); æ’­æ”¾ç½‘ç»œéŸ³é¢‘æ—¶ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯httpï¼Œæœ‰å¯èƒ½ä¼šæŠ¥é”™1java.io.IOException: Cleartext HTTP traffic to demo.com not permitted å¯ä»¥ç®€å•åœ°è®¾ç½®ä¸€ä¸‹manifestï¼Œè®¾ç½®usesCleartextTraffic=â€trueâ€12&lt;application android:usesCleartextTraffic=&quot;true&quot;&gt; å‡†å¤‡ - prepareåŒæ­¥å’Œå¼‚æ­¥å‡†å¤‡éŸ³é¢‘èµ„æºã€‚prepareAsync()æ˜¯å¼‚æ­¥çš„æ–¹å¼ï¼Œprepareæ˜¯åŒæ­¥çš„ã€‚æ³¨æ„çº¿ç¨‹è°ƒåº¦é—®é¢˜ï¼ŒåŒæ—¶ä¸è¦é˜»å¡UIçº¿ç¨‹ã€‚ ä½¿ç”¨å¼‚æ­¥æ–¹å¼å‡†å¤‡éŸ³é¢‘ï¼Œç»å¸¸ä¸MediaPlayer.OnPreparedListenerç›‘å¬å™¨é…åˆä½¿ç”¨ã€‚å¼‚æ­¥å‡†å¤‡æ—¶ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œå…¶ä»–çš„è®¾ç½®ã€‚1234567mediaPlayer.prepareAsync();mediaPlayer.setOnPreparedListener(new MediaPlayer.OnPreparedListener() { @Override public void onPrepared(MediaPlayer mediaPlayer) { mediaPlayer.start(); // å‡†å¤‡å¥½äº†å°±æ’­æ”¾ }}); å¾ªç¯æ’­æ”¾ - Loopingè®¾ç½®å¾ªç¯æ’­æ”¾setLoopingã€‚1mediaPlayer.setLooping(true);æ’­æ”¾å®Œæ¯•åï¼Œä¸ä¼šå›è°ƒOnCompletionListenerï¼Œè€Œæ˜¯ä»å¤´æ’­æ”¾å½“å‰éŸ³é¢‘ã€‚ æ’­æ”¾ - startæ’­æ”¾éŸ³é¢‘ï¼Œè°ƒç”¨startæ–¹æ³•ã€‚1mediaPlayer.start(); å¤„äºPreparedï¼ŒPauseå’ŒPlaybackCompleteçŠ¶æ€æ—¶ï¼Œå¯ä»¥è°ƒç”¨startæ–¹æ³•ï¼Œè¿›å…¥StartedçŠ¶æ€ã€‚ æš‚åœ - pauseæš‚åœæ’­æ”¾ï¼Œä½¿ç”¨pauseæ–¹æ³•ã€‚åœ¨æš‚åœå‰å…ˆåˆ¤æ–­ä¸€ä¸‹mediaPlayerçš„æ˜¯å¦åœ¨æ’­æ”¾ã€‚ 123if (mediaPlayer.isPlaying()) { mediaPlayer.pause();} æš‚åœæˆåŠŸåˆ™å¤„äºPausedçŠ¶æ€ã€‚ åœæ­¢ - stopå›é¡¾ä¸€ä¸‹MediaPlayerçŠ¶æ€åˆ‡æ¢çš„å›¾ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥åœ¨æ’­æ”¾ä¸­ï¼Œæš‚åœï¼Œæ’­æ”¾å®Œæˆè¿™3ä¸ªçŠ¶æ€ä¸‹ï¼Œå¯ä»¥è°ƒç”¨stopæ–¹æ³•ï¼Œè¿›å…¥StoppedçŠ¶æ€ã€‚ 1mediaPlayer.stop(); è°ƒè¿›åº¦ - seekToè°ƒæ•´æ’­æ”¾è¿›åº¦ã€‚æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨éŸ³ä¹æ’­æ”¾è½¯ä»¶ä¸€èˆ¬éƒ½ä¼šæœ‰è¿™ä¸ªåŠŸèƒ½ã€‚seekToæ–¹æ³•æ¥å—ä¸€ä¸ªæ¯«ç§’å‚æ•°ã€‚ 12int targetMS = (int) (percent * mediaPlayer.getDuration());mediaPlayer.seekTo(targetMS); seekToå¹¶ä¸ä¼šæ”¹å˜MediaPlayerçš„çŠ¶æ€ã€‚ é‡ç½® - resetresetåçš„mediaPlayerè¿›å…¥IdleçŠ¶æ€ã€‚éœ€è¦é‡æ–°è®¾ç½®éŸ³æºä¸å‡†å¤‡ã€‚ é‡Šæ”¾ - releaseä¸å†ä½¿ç”¨è¿™ä¸ªmediaPlayeræ—¶ï¼Œåº”å½“å°½å¿«é‡Šæ”¾æ‰ï¼Œä»¥é‡Šæ”¾ç›¸å…³çš„èµ„æºã€‚è°ƒç”¨releaseåï¼ŒmediaPlayerè¿›å…¥EndçŠ¶æ€ã€‚æ­¤æ—¶è¿™ä¸ªmediaPlayerå°±ä¸èƒ½å†ä½¿ç”¨äº†ã€‚ å¸¸ç”¨ç›‘å¬å™¨ç¼“å†²ç›‘å¬å™¨ OnBufferingUpdateListeneræ¯”å¦‚æˆ‘ä»¬åŠ è½½ç½‘ç»œéŸ³é¢‘çš„æ—¶å€™ï¼Œå¸¸ç”¨è¿™ä¸ªç›‘å¬å™¨æ¥ç›‘å¬ç¼“å†²è¿›åº¦ã€‚æ˜¾ç¤ºç¼“å†²è¿›åº¦ï¼Œä¹Ÿå¯ä»¥æé«˜ç”¨æˆ·ä½“éªŒã€‚ 1234567mMediaPlayer.prepareAsync();mMediaPlayer.setOnBufferingUpdateListener(new MediaPlayer.OnBufferingUpdateListener() { @Override public void onBufferingUpdate(MediaPlayer mp, int percent) { // percentä»£è¡¨ç¼“å†²ç™¾åˆ†æ¯” }}); é”™è¯¯ç›‘å¬å™¨ OnErrorListener123456mediaPlayer.setOnErrorListener(new MediaPlayer.OnErrorListener() { @Override public boolean onError(MediaPlayer mediaPlayer, int i, int i1) { return true; // è¿”å›trueè¡¨ç¤ºåœ¨æ­¤å¤„ç†é”™è¯¯ï¼Œä¸ä¼šå›è°ƒonCompletion }}); æ³¨æ„onErrorçš„è¿”å›å€¼ã€‚å¯ä»¥é€‰æ‹©è‡ªå·±å¤„ç†errorã€‚ 12345 * @return True if the method handled the error, false if it didn't. * Returning false, or not having an OnErrorListener at all, will * cause the OnCompletionListener to be called. */boolean onError(MediaPlayer mp, int what, int extra); æ’­æ”¾å®Œæ¯•ç›‘å¬å™¨ OnCompletionListener123456mediaPlayer.setOnCompletionListener(new MediaPlayer.OnCompletionListener() { @Override public void onCompletion(MediaPlayer mediaPlayer) { // æ’­æ”¾å®Œæ¯• }}); ä½¿ç”¨ç¤ºä¾‹æ’­æ”¾assetsé‡Œçš„éŸ³é¢‘æ’­æ”¾assetsé‡Œçš„éŸ³é¢‘æ–‡ä»¶ï¼Œä½¿ç”¨åˆ°AssetFileDescriptorç±»ã€‚ä½¿ç”¨åè®°å¾—å…³é—­AssetFileDescriptorã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051private void playAssetsAudio(final String name, Context context) { Log.d(TAG, &quot;playAssetWordSound: try to play assets sound file. -&gt; &quot; + name); AssetFileDescriptor fd = null; try { MediaPlayer mediaPlayer; Log.v(TAG, &quot;Looking in assets.&quot;); fd = context.getApplicationContext().getAssets().openFd(name); mediaPlayer = new MediaPlayer(); mediaPlayer.reset(); mediaPlayer.setDataSource(fd.getFileDescriptor(), fd.getStartOffset(), fd.getLength()); mediaPlayer.prepareAsync(); mediaPlayer.setOnPreparedListener(new MediaPlayer.OnPreparedListener() { @Override public void onPrepared(MediaPlayer mediaPlayer) { Log.d(TAG, &quot;onPrepared: &quot; + name); mediaPlayer.start(); } }); mediaPlayer.setOnCompletionListener(new MediaPlayer.OnCompletionListener() { @Override public void onCompletion(MediaPlayer mp) { mp.release(); Log.d(TAG, &quot;onCompletion: &quot; + name); } }); mediaPlayer.setOnErrorListener(new MediaPlayer.OnErrorListener() { @Override public boolean onError(MediaPlayer mp, int i, int i1) { mp.release(); return true; } }); } catch (Exception e) { try { if (fd != null) { fd.close(); } } catch (Exception e1) { Log.e(TAG, &quot;Exception close fd: &quot;, e1); } } finally { if (fd != null) { try { fd.close(); } catch (IOException e) { Log.e(TAG, &quot;Finally, close fd &quot;, e); } } }} æ’­æ”¾æœ¬åœ°éŸ³é¢‘æ–‡ä»¶å°è¯•æ’­æ”¾éŸ³é¢‘æ–‡ä»¶ã€‚ä»…æ’­æ”¾ä¸€æ¬¡ã€‚ 1234567891011121314151617181920212223242526private void playAudioFile(final File file) { Log.d(TAG, &quot;playAudioFile: &quot; + file.getAbsolutePath()); MediaPlayer mediaPlayer; try { mediaPlayer = new MediaPlayer(); mediaPlayer.setLooping(false); mediaPlayer.setDataSource(file.getAbsolutePath()); mediaPlayer.prepare(); mediaPlayer.start(); mediaPlayer.setOnCompletionListener(new MediaPlayer.OnCompletionListener() { @Override public void onCompletion(MediaPlayer mp) { mp.release(); } }); mediaPlayer.setOnErrorListener(new MediaPlayer.OnErrorListener() { @Override public boolean onError(MediaPlayer mediaPlayer, int i, int i1) { Log.d(TAG, &quot;Play local sound onError: &quot; + i + &quot;, &quot; + i1); return true; } }); } catch (Exception e) { Log.e(TAG, &quot;playAudioFile: &quot;, e); }} æ’­æ”¾åœ¨çº¿éŸ³é¢‘è®¾ç½®urlï¼Œæ’­æ”¾åœ¨çº¿éŸ³é¢‘ 12345678910111213141516171819202122232425262728293031private void playOnlineSound(String soundUrlDict) { try { MediaPlayer mediaPlayer = new MediaPlayer(); mediaPlayer.setDataSource(soundUrlDict); mediaPlayer.prepareAsync(); mediaPlayer.setOnPreparedListener(new MediaPlayer.OnPreparedListener() { @Override public void onPrepared(MediaPlayer mediaPlayer) { mediaPlayer.start(); } }); mediaPlayer.setOnCompletionListener(new MediaPlayer.OnCompletionListener() { @Override public void onCompletion(MediaPlayer mp) { if (mp != null) { mp.release(); } Log.d(TAG, &quot;onCompletion: play sound.&quot;); } }); mediaPlayer.setOnErrorListener(new MediaPlayer.OnErrorListener() { @Override public boolean onError(MediaPlayer mediaPlayer, int i, int i1) { Log.d(TAG, &quot;Play online sound onError: &quot; + i + &quot;, &quot; + i1); return false; } }); } catch (IOException e1) { Log.e(TAG, &quot;url: &quot;, e1); }} ä»£ç å¯ä»¥å‚è€ƒç¤ºä¾‹å·¥ç¨‹ï¼š https://github.com/RustFisher/android-MediaPlayer æ›´å¤šå‚è€ƒï¼š Android MediaPlayer åŸºç¡€ç®€ä»‹ Android MediaPlayer æ’­æ”¾éŸ³é¢‘ Android ä½¿ç”¨URLConnectionä¸‹è½½éŸ³é¢‘æ–‡ä»¶ Android MediaPlayer éŸ³é¢‘å€é€Ÿæ’­æ”¾ï¼Œè°ƒæ•´æ’­æ”¾é€Ÿåº¦ AndroidéŸ³è§†é¢‘ç›¸å…³æ–‡ç« è¯·å‚è€ƒ https://rustfisher.com/tags/Android-Media/","link":"/2019/09/22/Android/Android-MediaPlayer_use_play_audio/"},{"title":"Android MediaPlayer åŸºç¡€ç®€ä»‹","text":"æœ¬æ–‡é“¾æ¥ï¼š Android MediaPlayer åŸºç¡€ç®€ä»‹ ç®€å•ä»‹ç»MediaPlayerçš„åŸºæœ¬æ¦‚å¿µï¼ŒçŠ¶æ€ï¼Œå¸¸ç”¨çš„æ–¹æ³•ä¸ç›‘å¬å™¨ã€‚ ä»€ä¹ˆæ˜¯MediaPlayerMediaPlayerç±»å¯ä»¥ç”¨æ¥æ’­æ”¾éŸ³è§†é¢‘æ–‡ä»¶ï¼Œæˆ–è€…æ˜¯éŸ³é¢‘æµã€‚å¼€å‘è€…å¯ä»¥ç”¨å®ƒæ¥æ’­æ”¾æœ¬åœ°éŸ³é¢‘ï¼Œæˆ–è€…æ˜¯ç½‘ç»œåœ¨çº¿éŸ³é¢‘ã€‚ MediaPlayerå±äºandroid.mediaåŒ…ã€‚ MediaPlayerçš„çŠ¶æ€æ’­æ”¾æ§åˆ¶ç”±çŠ¶æ€æœºæ§åˆ¶ã€‚åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬å¸¸è§çš„éŸ³é¢‘çŠ¶æ€æœ‰æ’­æ”¾ä¸­ï¼Œæš‚åœï¼Œåœæ­¢ï¼Œç¼“å†²ç­‰ç­‰ã€‚MediaPlayerçš„çŠ¶æ€æœ‰å¦‚ä¸‹å‡ ç§ï¼š Idle End Error Initialized Preparing Prepared Started Stopped Paused PlaybackCompleted çŠ¶æ€çš„åˆ‡æ¢å‚è€ƒå®˜æ–¹å›¾ä¾‹ã€‚è¿™é‡Œç¨å¾®è§£é‡Šä¸€ä¸‹çŠ¶æ€è½¬æ¢å›¾ç‰‡ã€‚æ¤­åœ†ä»£è¡¨MediaPlayerå¯èƒ½åœç•™çš„çŠ¶æ€ã€‚æ¤­åœ†ä¹‹é—´çš„ç®­å¤´è¡¨ç¤ºæ–¹æ³•è°ƒç”¨ï¼ŒçŠ¶æ€åˆ‡æ¢çš„æ–¹å‘ã€‚å•ç®­å¤´è¡¨ç¤ºæ–¹æ³•åŒæ­¥è°ƒç”¨ï¼ŒåŒç®­å¤´è¡¨ç¤ºå¼‚æ­¥è°ƒç”¨ã€‚ ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºçŠ¶æ€åˆ‡æ¢çš„è·¯å¾„å’Œæ¶‰åŠåˆ°çš„æ–¹æ³•ã€‚ Idleä¸EndçŠ¶æ€å½“newä¸€ä¸ªMediaPlayeræˆ–è€…è°ƒç”¨äº†resetæ–¹æ³•ï¼Œå½“å‰MediaPlayerä¼šå¤„äºIdleçŠ¶æ€ã€‚è°ƒç”¨releaseåï¼Œä¼šå¤„äºEndçŠ¶æ€ã€‚åœ¨è¿™2ä¸ªçŠ¶æ€ä¹‹é—´çš„çŠ¶æ€å¯ä»¥çœ‹åšæ˜¯MediaPlayerå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚ åœ¨æ–°åˆ›å»ºMediaPlayerå’Œè°ƒç”¨resetçš„MediaPlayerä¹‹é—´æœ‰ä¸€äº›ç»†å¾®çš„å·®åˆ«ã€‚è¿™ä¸¤ç§æƒ…å†µéƒ½å¤„äºIdleçŠ¶æ€ï¼Œè°ƒç”¨ getCurrentPosition(), getDuration(), getVideoHeight(), getVideoWidth(), setAudioAttributes(android.media.AudioAttributes), setLooping(boolean), setVolume(float, float), pause(), start(), stop(), seekTo(long, int), prepare() æˆ– prepareAsync()æ–¹æ³•éƒ½ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå¦‚æœæ˜¯æ–°å®ä¾‹åŒ–çš„MediaPlayerï¼Œä¸ä¼šå›è°ƒ OnErrorListener.onError()ï¼›ä½†å¦‚æœæ˜¯resetåçš„MediaPlayerï¼Œä¼šå›è°ƒ OnErrorListener.onError()å¹¶ä¸”è½¬æ¢åˆ°ErrorçŠ¶æ€ã€‚ å¦‚æœMediaPlayerå¯¹è±¡ä¸å†ä½¿ç”¨äº†ï¼Œç«‹å³è°ƒç”¨release()æ–¹æ³•ï¼Œé‡Šæ”¾å†…éƒ¨æ’­æ”¾å™¨å ç”¨çš„èµ„æºã€‚è¿™äº›èµ„æºå¯èƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ¯”å¦‚ç¡¬ä»¶åŠ é€Ÿç»„ä»¶ã€‚å¦‚æœè°ƒç”¨releaseå¤±è´¥ï¼Œå¯èƒ½ä¼šå¼•èµ·ä¸€è¿ä¸²çš„MediaPlayerå®ä¾‹å¤±æ•ˆã€‚å½“MediaPlayerå¤„äºEndçŠ¶æ€ï¼Œå®ƒå°±ä¸èƒ½å†è½¬ç§»åˆ°å…¶å®ƒçŠ¶æ€äº†ã€‚ newä¸€ä¸ªMediaPlayerï¼Œå¤„äºIdleçŠ¶æ€ã€‚å¦‚æœç”¨createæ–¹æ³•åˆ›å»ºå®ä¾‹ï¼Œå½“åˆ›å»ºå®Œæˆæ—¶å¤„äºPreparedçŠ¶æ€ã€‚ å‘ç”Ÿé”™è¯¯ä¸€äº›æƒ…å½¢å¯èƒ½ä¼šè®©MediaPlayeræ“ä½œå¤±è´¥ï¼Œæ¯”å¦‚ä¸æ”¯æŒçš„éŸ³è§†é¢‘æ ¼å¼ï¼Œåˆ†è¾¨ç‡è¿‡é«˜ï¼Œç½‘ç»œè¶…æ—¶ç­‰ç­‰ã€‚å› æ­¤åœ¨è¿™äº›æƒ…å½¢ä¸‹é”™è¯¯å¤„ç†å’Œæ¢å¤éå¸¸é‡è¦ã€‚æœ‰æ—¶å€™ç¼–ç¨‹é”™è¯¯ä¹Ÿä¼šå¯¼è‡´MediaPlayeræ“ä½œé”™è¯¯ã€‚å¼€å‘è€…å¯ä»¥è®¾ç½®é”™è¯¯ç›‘å¬å™¨setOnErrorListener(android.media.MediaPlayer.OnErrorListener)ã€‚å½“é”™è¯¯å‘ç”Ÿæ—¶ï¼Œä¼šè°ƒç”¨ç”¨æˆ·å®ç°çš„OnErrorListener.onError()æ–¹æ³•ã€‚ ä¸ç®¡æœ‰æ²¡æœ‰è®¾ç½®ç›‘å¬å™¨ï¼Œé”™è¯¯å‘ç”Ÿæ—¶MediaPlayerä¼šè¿›å…¥ErrorçŠ¶æ€ã€‚ ä¸ºäº†é‡å¤ä½¿ç”¨åŒä¸€ä¸ªMediaPlayerå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨reset()æ–¹æ³•æŠŠå®ƒä»ErrorçŠ¶æ€æ¢å¤åˆ°IdleçŠ¶æ€ã€‚è®¾ç½®é”™è¯¯ç›‘å¬å™¨OnErrorListeneræ˜¯ä¸€ä¸ªå¥½çš„ç¼–ç¨‹ä¹ æƒ¯ã€‚å¼€å‘è€…å¯ä»¥ç›‘å¬åˆ°æ’­æ”¾å¼•æ“çš„é”™è¯¯é€šçŸ¥ã€‚æœ‰æ—¶å€™ä¼šæŠ›å‡ºIllegalStateExceptionå¼‚å¸¸ï¼Œæ¯”å¦‚åœ¨é”™è¯¯çš„çŠ¶æ€è°ƒç”¨äº†prepare(), prepareAsync()æ–¹æ³•ï¼Œæˆ–æ˜¯setDataSourceæ–¹æ³•ã€‚ è®¾ç½®éŸ³æº setDataSourceè°ƒç”¨setDataSource(java.io.FileDescriptor), æˆ–è€… setDataSource(java.lang.String), æˆ–è€… setDataSource(android.content.Context, android.net.Uri), æˆ–è€… setDataSource(java.io.FileDescriptor, long, long), æˆ–è€… setDataSource(android.media.MediaDataSource) å¯ä»¥å°†MediaPlayerçš„çŠ¶æ€ä»Idleè½¬åˆ°InitializedçŠ¶æ€ã€‚å¦‚æœåœ¨IdleçŠ¶æ€ä¹‹å¤–çš„çŠ¶æ€è°ƒç”¨äº†setDataSource()ï¼Œä¼šæŠ›å‡ºIllegalStateExceptionå¼‚å¸¸ã€‚å¼€å‘è€…åº”è¯¥ç•™æ„setDataSourceæ–¹æ³•æŠ›å‡ºçš„IllegalArgumentExceptionå’ŒIOExceptionå¼‚å¸¸ã€‚ æ’­æ”¾éŸ³é¢‘å‰å¿…é¡»åœ¨PreparedçŠ¶æ€MediaPlayeråœ¨å¼€å§‹æ’­æ”¾éŸ³é¢‘å‰å¿…é¡»å¤„äºPreparedçŠ¶æ€ã€‚ MediaPlayeræœ‰åŒæ­¥å’Œå¼‚æ­¥2ç§æ–¹å¼æ¥è¿›å…¥PreparedçŠ¶æ€ã€‚å¦‚æœæ˜¯å¼‚æ­¥çš„æ–¹å¼ï¼Œä¼šå…ˆè½¬åˆ°PreparingçŠ¶æ€ï¼Œå†è½¬åˆ°PreparedçŠ¶æ€ã€‚å½“å‡†å¤‡å®Œæˆæ—¶ï¼Œå†…éƒ¨çš„æ’­æ”¾å¼•æ“ä¼šå›è°ƒç”¨æˆ·ä¹‹å‰è®¾ç½®çš„OnPreparedListenerçš„onPrepared()æ–¹æ³•ã€‚ å¼€å‘è€…å¿…é¡»æ³¨æ„çš„æ˜¯ï¼ŒPreparingçŠ¶æ€æ˜¯ä¸€ä¸ªè¿‡æ¸¡çŠ¶æ€ï¼ˆtransient stateï¼‰ã€‚ å¤„äºPreparedçŠ¶æ€æ—¶ï¼Œå¯ä»¥é€šè¿‡ç›¸å¯¹åº”çš„æ–¹æ³•è®¾ç½®éŸ³é‡ï¼Œå±å¹•å¸¸äº®ï¼Œæ’­æ”¾å¾ªç¯ç­‰ã€‚ å¼€å§‹æ’­æ”¾æ’­æ”¾éŸ³é¢‘å¿…é¡»è°ƒç”¨start()æ–¹æ³•ã€‚è°ƒç”¨start()è¿”å›æˆåŠŸåï¼ŒMediaPlayerå¤„äºStartedçŠ¶æ€ã€‚å¯ä»¥é€šè¿‡isPlaying()æ¥åˆ¤æ–­å½“å‰æ˜¯å¦åœ¨StartedçŠ¶æ€ã€‚ å¦‚æœå¼€å‘è€…è®¾ç½®äº†OnBufferingUpdateListenerï¼ŒAndroidå†…éƒ¨æ’­æ”¾å™¨ä¼šå‘å¤–ä¼ é€’bufferä¿¡æ¯ã€‚ å¦‚æœå½“å‰å¤„äºStartedçŠ¶æ€ï¼Œå†è°ƒç”¨start()æ–¹æ³•æ²¡æœ‰æ•ˆæœã€‚ æš‚åœæ’­æ”¾ä¸ç»§ç»­æ’­æ”¾éŸ³é¢‘å¯ä»¥è¢«æš‚åœæ’­æ”¾å’Œç»§ç»­æ’­æ”¾ï¼Œä¹Ÿå¯ä»¥è°ƒæ•´æ’­æ”¾çš„ä½ç½®ã€‚é€šè¿‡pause()æ–¹æ³•æ¥æš‚åœéŸ³é¢‘æ’­æ”¾ã€‚æˆåŠŸè°ƒç”¨pause()æ–¹æ³•åï¼ŒMediaPlayerè¿›å…¥PausedçŠ¶æ€ã€‚åº”å½“æ³¨æ„çš„æ˜¯ï¼ŒMediaPlayeråœ¨StartedçŠ¶æ€ä¸PausedçŠ¶æ€ä¹‹é—´åˆ‡æ¢æ˜¯å¼‚æ­¥çš„ã€‚æ’­æ”¾éŸ³é¢‘æµçš„æ—¶å€™ï¼Œè¿™ä¸ªè½¬æ¢è¿‡ç¨‹å¯èƒ½ä¼šéœ€è¦å‡ ç§’é’Ÿã€‚ MediaPlayeræš‚åœæ—¶ï¼Œstart()æ–¹æ³•å¯ä»¥ä»æš‚åœçš„ä½ç½®ç»§ç»­æ’­æ”¾ã€‚æˆåŠŸè°ƒç”¨startæ–¹æ³•åä¼šè¿›å…¥StartedçŠ¶æ€ã€‚ å¤„äºPausedçŠ¶æ€æ—¶ï¼Œè°ƒç”¨pause()æ–¹æ³•æ²¡æœ‰æ•ˆæœã€‚ åœæ­¢è°ƒç”¨stop()æ–¹æ³•è®©MediaPlayerä»Started, Paused, Prepared æˆ– PlaybackCompleted çŠ¶æ€è¿›å…¥ Stopped çŠ¶æ€ã€‚ åœ¨StoppedçŠ¶æ€æ—¶ï¼Œå¿…é¡»å…ˆè°ƒç”¨prepare() æˆ– prepareAsync()è¿›å…¥PreparedçŠ¶æ€åï¼Œæ‰èƒ½æ’­æ”¾éŸ³é¢‘ã€‚ å¤„äºStoppedçŠ¶æ€æ—¶ï¼Œè°ƒç”¨stop()æ–¹æ³•æ²¡æœ‰æ•ˆæœã€‚ è°ƒæ•´æ’­æ”¾ä½ç½®è°ƒç”¨seekTo(long, int)æ¥è°ƒæ•´æ’­æ”¾ä½ç½®ã€‚ seekTo(long, int)æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œè™½ç„¶å®ƒèƒ½ç«‹åˆ»è¿”å›ï¼Œä½†å®é™…çš„ä½ç½®è°ƒæ•´å¯èƒ½ä¼šæ¶ˆè€—ä¸€æ®µæ—¶é—´ï¼Œç‰¹åˆ«æ˜¯åœ¨æ’­æ”¾éŸ³é¢‘æµçš„æ—¶å€™ã€‚å½“å®é™…æ’­æ”¾ä½ç½®è°ƒæ•´åï¼Œå†…éƒ¨æ’­æ”¾å™¨ä¼šå›è°ƒå¼€å‘è€…è®¾ç½®çš„OnSeekComplete.onSeekComplete()ã€‚ åœ¨Prepared, Paused å’Œ PlaybackCompletedçŠ¶æ€ä¸­ï¼Œéƒ½å¯ä»¥è°ƒç”¨seekToæ–¹æ³•ã€‚ å¯ä»¥é€šè¿‡getCurrentPosition()æ–¹æ³•æ¥è·å–å½“å‰æ’­æ”¾ä½ç½®ã€‚å¼€å‘è€…å¯ä»¥å¾—çŸ¥å½“å‰æ’­æ”¾çš„è¿›åº¦ç­‰ç­‰ã€‚ æ’­æ”¾å®Œæ¯•éŸ³é¢‘æ’­æ”¾å®Œæˆåï¼Œæ’­æ”¾å®Œæ¯•ã€‚ å¦‚æœè°ƒç”¨setLooping(boolean)ä¸ºtrueï¼ŒMediaPlayerä¼šåœç•™åœ¨StartedçŠ¶æ€ã€‚ å¦‚æœsetLoopingä¸ºfalseï¼Œå†…éƒ¨æ’­æ”¾å™¨ä¼šè°ƒç”¨å¼€å‘è€…è®¾ç½®çš„OnCompletion.onCompletion()ï¼Œå¹¶ä¸”è¿›å…¥PlaybackCompletedçŠ¶æ€ã€‚ å¤„äºPlaybackCompletedçŠ¶æ€æ—¶ï¼Œè°ƒç”¨start()æ–¹æ³•å¯ä»¥ä»å¤´å¼€å§‹æ’­æ”¾éŸ³é¢‘ã€‚ å¸¸ç”¨ç›‘å¬å™¨å¼€å‘è€…å¯ä»¥è®¾ç½®ä¸€äº›ç›‘å¬å™¨ï¼Œç›‘å¬MediaPlayerçš„çŠ¶æ€ï¼Œé”™è¯¯äº‹ä»¶ç­‰ç­‰ã€‚å¼€å‘è€…åº”åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­åˆ›å»ºMediaPlayerä¸è®¾ç½®çš„ç›‘å¬å™¨ã€‚ setOnPreparedListener(android.media.MediaPlayer.OnPreparedListener)ç›‘å¬MediaPlayerå‡†å¤‡å®Œæˆã€‚ä¸€èˆ¬ä¸prepareAsyncé…åˆä½¿ç”¨ã€‚ setOnVideoSizeChangedListener(android.media.MediaPlayer.OnVideoSizeChangedListener)è·çŸ¥videoå¤§å°æˆ–videoå¤§å°æ”¹å˜æ—¶çš„ç›‘å¬ã€‚ setOnSeekCompleteListener(android.media.MediaPlayer.OnSeekCompleteListener)ç›‘å¬è°ƒæ•´ä½ç½®å®Œæˆã€‚ setOnCompletionListener(android.media.MediaPlayer.OnCompletionListener)æ’­æ”¾å®Œæˆã€‚ 123456mediaPlayer.setOnCompletionListener(new MediaPlayer.OnCompletionListener() { @Override public void onCompletion(MediaPlayer mediaPlayer) { // å½“å‰æ’­æ”¾å®Œæ¯• }}); setOnBufferingUpdateListener(android.media.MediaPlayer.OnBufferingUpdateListener)ç›‘å¬ç¼“å†²è¿›åº¦ã€‚åœ¨æ’­æ”¾ç½‘ç»œéŸ³é¢‘æ—¶å¸¸ç”¨ã€‚ ç¼“å†²ç›‘å¬å™¨OnBufferingUpdateListener 1234567mMediaPlayer.prepareAsync();mMediaPlayer.setOnBufferingUpdateListener(new MediaPlayer.OnBufferingUpdateListener() { @Override public void onBufferingUpdate(MediaPlayer mp, int percent) { // ä¾‹å¦‚åœ¨è¿™é‡Œæ›´æ–°UI }}); setOnInfoListener(android.media.MediaPlayer.OnInfoListener)ç›‘å¬æ™®é€šä¿¡æ¯æˆ–è€…è­¦å‘Šä¿¡æ¯ã€‚ setOnErrorListener(android.media.MediaPlayer.OnErrorListener)ç›‘å¬é”™è¯¯ä¿¡æ¯ã€‚é”™è¯¯å‘ç”Ÿæ—¶ï¼Œå¯ä»¥åœ¨è¿™é‡Œå¤„ç†é”™è¯¯ã€‚ 1234567mediaPlayer.setOnErrorListener(new MediaPlayer.OnErrorListener() { @Override public boolean onError(MediaPlayer mediaPlayer, int i, int i1) { LogUtil.e(TAG_PREFIX + &quot; onERR i = &quot; + i + &quot; i1 = &quot; + i1); return true; // è¿”å›trueè¡¨ç¤ºåœ¨æ­¤å¤„ç†é”™è¯¯ï¼Œä¸ä¼šå›è°ƒonCompletion }}); æ³¨æ„onErrorçš„è¿”å›å€¼ã€‚å¯ä»¥é€‰æ‹©è‡ªå·±å¤„ç†errorã€‚ 12345 * @return True if the method handled the error, false if it didn't. * Returning false, or not having an OnErrorListener at all, will * cause the OnCompletionListener to be called. */boolean onError(MediaPlayer mp, int what, int extra); éœ€è¦çš„æƒé™æ’­æ”¾ç½‘ç»œéŸ³é¢‘æ—¶éœ€è¦Manifest.permission.INTERNETæƒé™ã€‚ æ›´å¤šå‚è€ƒï¼š Android MediaPlayer åŸºç¡€ç®€ä»‹ Android MediaPlayer æ’­æ”¾éŸ³é¢‘ Android ä½¿ç”¨URLConnectionä¸‹è½½éŸ³é¢‘æ–‡ä»¶ Android MediaPlayer éŸ³é¢‘å€é€Ÿæ’­æ”¾ï¼Œè°ƒæ•´æ’­æ”¾é€Ÿåº¦ AndroidéŸ³è§†é¢‘ç›¸å…³æ–‡ç« è¯·å‚è€ƒ https://rustfisher.com/tags/Android-Media/","link":"/2019/09/19/Android/Android-MediaPlayer_intro/"},{"title":"Android mmap æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ä»‹ç»","text":"æœ¬æ–‡é“¾æ¥ï¼š Android mmap æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ä»‹ç» Androidå¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è®°å½•ä¸€äº›æ–‡ä»¶ã€‚ä¾‹å¦‚è®°å½•logæ–‡ä»¶ã€‚å¦‚æœä½¿ç”¨æµæ¥å†™æ–‡ä»¶ï¼Œé¢‘ç¹æ“ä½œæ–‡ä»¶ioå¯èƒ½ä¼šå¼•èµ·æ€§èƒ½é—®é¢˜ã€‚ä¸ºäº†é™ä½å†™æ–‡ä»¶çš„é¢‘ç‡ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡‡ç”¨ç¼“å­˜ä¸€å®šæ•°é‡çš„logï¼Œå†ä¸€æ¬¡æ€§æŠŠå®ƒä»¬å†™åˆ°æ–‡ä»¶ä¸­ã€‚å¦‚æœappå¼‚å¸¸é€€å‡ºï¼Œæˆ‘ä»¬æœ‰å¯èƒ½ä¼šä¸¢å¤±å†…å­˜ä¸­çš„logä¿¡æ¯ã€‚é‚£ä¹ˆæœ‰ä»€ä¹ˆæ¯”è¾ƒç¨³å¦¥çš„å†™æ–‡ä»¶æ–¹å¼ï¼Œæ—¢èƒ½é™ä½ioï¼Œåˆèƒ½å°½å¯èƒ½åœ°ä¿è¯æ•°æ®è¢«å†™å…¥æ–‡ä»¶å‘¢ï¼Ÿ mmapç®€ä»‹mmapæ¦‚å¿µmmapæ˜¯ä¸€ç§å†…å­˜æ˜ å°„æ–‡ä»¶çš„æ–¹æ³•ï¼Œå³å°†ä¸€ä¸ªæ–‡ä»¶æˆ–è€…å…¶å®ƒå¯¹è±¡æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œå®ç°æ–‡ä»¶ç£ç›˜åœ°å€å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ä¸€æ®µè™šæ‹Ÿåœ°å€çš„ä¸€ä¸€å¯¹æ˜ å…³ç³»ã€‚ ç‰¹ç‚¹ï¼šå®ç°è¿™æ ·çš„æ˜ å°„å…³ç³»åï¼Œè¿›ç¨‹å°±å¯ä»¥é‡‡ç”¨æŒ‡é’ˆçš„æ–¹å¼è¯»å†™æ“ä½œè¿™ä¸€æ®µå†…å­˜ï¼Œè€Œç³»ç»Ÿä¼šè‡ªåŠ¨å›å†™è„é¡µé¢åˆ°å¯¹åº”çš„æ–‡ä»¶ç£ç›˜ä¸Šï¼Œå³å®Œæˆäº†å¯¹æ–‡ä»¶çš„æ“ä½œè€Œä¸å¿…å†è°ƒç”¨read,writeç­‰ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚ç›¸åï¼Œå†…æ ¸ç©ºé—´å¯¹è¿™æ®µåŒºåŸŸçš„ä¿®æ”¹ä¹Ÿç›´æ¥åæ˜ ç”¨æˆ·ç©ºé—´ï¼Œä»è€Œå¯ä»¥å®ç°ä¸åŒè¿›ç¨‹é—´çš„æ–‡ä»¶å…±äº«ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š mmapå†…å­˜æ˜ å°„åŸç†mmapå†…å­˜æ˜ å°„çš„å®ç°è¿‡ç¨‹ï¼Œæ€»çš„æ¥è¯´å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š åº”ç”¨è¿›ç¨‹å¯åŠ¨æ˜ å°„ï¼Œåœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼Œå¯»æ‰¾ä¸€æ®µç©ºé—²çš„æ»¡è¶³è¦æ±‚çš„è¿ç»­çš„è™šæ‹Ÿåœ°å€ä½œä¸ºæ˜ å°„åŒºåŸŸï¼›è°ƒç”¨ç³»ç»Ÿå‡½æ•°mmapï¼Œå®ç°æ–‡ä»¶ç‰©ç†åœ°å€å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€çš„ä¸€ä¸€æ˜ å°„ï¼›åº”ç”¨è¿›ç¨‹å¯¹æ˜ å°„åŒºåŸŸè®¿é—®ï¼Œå¼•å‘ç¼ºé¡µå¼‚å¸¸ï¼Œå®ç°æ–‡ä»¶å†…å®¹åˆ°ç‰©ç†å†…å­˜ï¼ˆä¸»å­˜ï¼‰çš„æ‹·è´ã€‚ mmapä¼˜ç¼ºç‚¹åªæœ‰ä¸€æ¬¡æ•°æ®æ‹·è´ï¼šå½“å‘ç”Ÿç¼ºé¡µå¼‚å¸¸æ—¶ï¼Œç›´æ¥å°†æ•°æ®ä»ç£ç›˜æ‹·è´åˆ°è¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´ï¼Œè·³è¿‡äº†é¡µç¼“å­˜ã€‚å®ç°äº†ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„é«˜æ•ˆäº¤äº’æ–¹å¼ï¼šä¸¤ç©ºé—´çš„å„è‡ªä¿®æ”¹æ“ä½œå¯ä»¥ç›´æ¥åæ˜ åœ¨æ˜ å°„çš„åŒºåŸŸå†…ï¼Œä»è€Œè¢«å¯¹æ–¹ç©ºé—´åŠæ—¶æ•æ‰ã€‚æä¾›è¿›ç¨‹é—´å…±äº«å†…å­˜åŠç›¸äº’é€šä¿¡çš„æ–¹å¼ã€‚ ä¸ç®¡æ˜¯çˆ¶å­è¿›ç¨‹è¿˜æ˜¯æ— äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ï¼Œéƒ½å¯ä»¥å°†è‡ªèº«ç”¨æˆ·ç©ºé—´æ˜ å°„åˆ°åŒä¸€ä¸ªæ–‡ä»¶æˆ–åŒ¿åæ˜ å°„åˆ°åŒä¸€ç‰‡åŒºåŸŸã€‚ä»è€Œé€šè¿‡å„è‡ªå¯¹æ˜ å°„åŒºåŸŸçš„æ”¹åŠ¨ï¼Œè¾¾åˆ°è¿›ç¨‹é—´é€šä¿¡å’Œè¿›ç¨‹é—´å…±äº«çš„ç›®çš„ã€‚ åŒæ—¶ï¼Œå¦‚æœè¿›ç¨‹Aå’Œè¿›ç¨‹Béƒ½æ˜ å°„äº†åŒºåŸŸCï¼Œå½“Aç¬¬ä¸€æ¬¡è¯»å–Cæ—¶é€šè¿‡ç¼ºé¡µä»ç£ç›˜å¤åˆ¶æ–‡ä»¶é¡µåˆ°å†…å­˜ä¸­ï¼›ä½†å½“Bå†è¯»Cçš„ç›¸åŒé¡µé¢æ—¶ï¼Œè™½ç„¶ä¹Ÿä¼šäº§ç”Ÿç¼ºé¡µå¼‚å¸¸ï¼Œä½†æ˜¯ä¸å†éœ€è¦ä»ç£ç›˜ä¸­å¤åˆ¶æ–‡ä»¶è¿‡æ¥ï¼Œè€Œå¯ç›´æ¥ä½¿ç”¨å·²ç»ä¿å­˜åœ¨å†…å­˜ä¸­çš„æ–‡ä»¶æ•°æ®ã€‚ mmapæ³¨æ„ç‚¹å¯¹äºå¤§æ–‡ä»¶è€Œè¨€ï¼Œå†…å­˜æ˜ å°„æ¯”æ™®é€šIOæµè¦å¿«ï¼Œå°æ–‡ä»¶åˆ™æœªå¿…ï¼›ä¸è¦ç»å¸¸è°ƒç”¨MappedByteBuffer.force()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¼ºåˆ¶æ“ä½œç³»ç»Ÿå°†å†…å­˜ä¸­çš„å†…å®¹å†™å…¥ç¡¬ç›˜ï¼Œæ‰€ä»¥å¦‚æœä½ åœ¨æ¯æ¬¡å†™å†…å­˜æ˜ å°„æ–‡ä»¶åéƒ½è°ƒç”¨force()æ–¹æ³•ï¼Œä½ å°±ä¸èƒ½çœŸæ­£ä»å†…å­˜æ˜ å°„æ–‡ä»¶ä¸­è·ç›Šï¼Œè€Œæ˜¯è·Ÿdisk IOå·®ä¸å¤šã€‚è¯»å†™å†…å­˜æ˜ å°„æ–‡ä»¶æ˜¯æ“ä½œç³»ç»Ÿæ¥è´Ÿè´£çš„ï¼Œå› æ­¤ï¼Œå³ä½¿ä½ çš„Javaç¨‹åºåœ¨å†™å…¥å†…å­˜åå°±æŒ‚æ‰äº†ï¼Œåªè¦æ“ä½œç³»ç»Ÿå·¥ä½œæ­£å¸¸ï¼Œæ•°æ®å°±ä¼šå†™å…¥ç£ç›˜ã€‚å¦‚æœç”µæºæ•…éšœæˆ–è€…ä¸»æœºç˜«ç—ªï¼Œæœ‰å¯èƒ½å†…å­˜æ˜ å°„æ–‡ä»¶è¿˜æ²¡æœ‰å†™å…¥ç£ç›˜ï¼Œæ„å‘³ç€å¯èƒ½ä¼šä¸¢å¤±ä¸€äº›å…³é”®æ•°æ®ã€‚ å‚è€ƒ https://stackoverflow.com/questions/258091/when-should-i-use-mmap-for-file-access https://www.jianshu.com/p/187eada7b900 https://juejin.im/post/5c3ec9ebf265da61223a93de#heading-0 https://stackoverflow.com/questions/30180268/android-ndk-mmap-call-broken-on-32-bit-devices-after-upgrading-to-lollipop https://stackoverflow.com/questions/33897711/android-mmap-fails-with-out-of-memory Androidä¸­çš„Binderä¹Ÿåˆ©ç”¨çš„mmapã€‚Binderä¼ é€’æ•°æ®æ—¶ï¼Œåªéœ€è¦å¤åˆ¶ä¸€æ¬¡ï¼Œå°±èƒ½æŠŠæ•°æ®ä¼ é€’åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚å‚è€ƒBinderæœºåˆ¶ä»‹ç» Androidä¸­ä½¿ç”¨mmapAndroidä¸­ä½¿ç”¨mmapï¼Œå¯ä»¥é€šè¿‡RandomAccessFileä¸MappedByteBufferæ¥é…åˆã€‚å‚è€ƒdroneå¼€å‘è®°å½• - logè®°å½•å·¥å…· é€šè¿‡randomAccessFile.getChannel().mapè·å–åˆ°MappedByteBufferã€‚ç„¶åè°ƒç”¨ByteBufferçš„putæ–¹æ³•æ·»åŠ æ•°æ®ã€‚","link":"/2019/08/20/Android/Android-mmap_intro_and_use/"},{"title":"ã€Œå°ç¨‹åºã€å¼€å‘è®°å½•","text":"wxmlæ ‡ç­¾ä¸¥æ ¼é—­åˆã€‚rpxï¼ˆresponsive pixelï¼‰å°ºå¯¸å•ä½ã€‚å¤§å°å†™æ•æ„Ÿã€‚ æˆ‘ä»¬åªè¦ä¿æŒä¸€ä¸ªåŸåˆ™å°±å¯ä»¥æé«˜å°ç¨‹åºçš„æ¸²æŸ“æ€§èƒ½ï¼šæ¯æ¬¡åªè®¾ç½®éœ€è¦æ”¹å˜çš„æœ€å°å•ä½æ•°æ®ã€‚æ­¤å¤–éœ€è¦æ³¨æ„ä»¥ä¸‹3ç‚¹ï¼š ç›´æ¥ä¿®æ”¹ Pageå®ä¾‹çš„this.data è€Œä¸è°ƒç”¨ this.setData æ˜¯æ— æ³•æ”¹å˜é¡µé¢çš„çŠ¶æ€çš„ï¼Œè¿˜ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚ ç”±äºsetDataæ˜¯éœ€è¦ä¸¤ä¸ªçº¿ç¨‹çš„ä¸€äº›é€šä¿¡æ¶ˆè€—ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œæ¯æ¬¡è®¾ç½®çš„æ•°æ®ä¸åº”è¶…è¿‡1024kBã€‚ ä¸è¦æŠŠdataä¸­çš„ä»»æ„ä¸€é¡¹çš„valueè®¾ä¸ºundefinedï¼Œå¦åˆ™å¯èƒ½ä¼šæœ‰å¼•èµ·ä¸€äº›ä¸å¯é¢„æ–™çš„bugã€‚ â€œç”¨æˆ·åœ¨æ¸²æŸ“å±‚çš„è¡Œä¸ºåé¦ˆâ€ä»¥åŠâ€œç»„ä»¶çš„éƒ¨åˆ†çŠ¶æ€åé¦ˆâ€æŠ½è±¡ä¸ºæ¸²æŸ“å±‚ä¼ é€’ç»™é€»è¾‘å±‚çš„â€œäº‹ä»¶â€ æ•°æ®ç»‘å®šé€šè¿‡ å¤§æ‹¬å·å¤§æ‹¬å· è¯­æ³•å¯ä»¥ä½¿å¾— WXML æ‹¥æœ‰åŠ¨æ€æ¸²æŸ“çš„èƒ½åŠ›ï¼Œé™¤æ­¤å¤–è¿˜å¯ä»¥åœ¨å…¶ä¸­è¿›è¡Œç®€å•çš„é€»è¾‘è¿ç®—ã€‚å¤§æ‹¬å·å¤§æ‹¬å·ä¸­è¿˜å¯ä»¥ç›´æ¥æ”¾ç½®æ•°å­—ã€å­—ç¬¦ä¸²æˆ–è€…æ˜¯æ•°ç»„ã€‚ ä½¿ç”¨ wx:key æ¥æŒ‡å®šåˆ—è¡¨ä¸­é¡¹ç›®çš„å”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚ wx:key çš„å€¼ä»¥ä¸¤ç§å½¢å¼æä¾›ï¼š å­—ç¬¦ä¸²ï¼Œä»£è¡¨åœ¨ for å¾ªç¯çš„ array ä¸­ item çš„æŸä¸ª propertyï¼Œè¯¥ property çš„å€¼éœ€è¦æ˜¯åˆ—è¡¨ä¸­å”¯ä¸€çš„å­—ç¬¦ä¸²æˆ–æ•°å­—ï¼Œä¸”ä¸èƒ½åŠ¨æ€æ”¹å˜ã€‚ ä¿ç•™å…³é”®å­— this ä»£è¡¨åœ¨ for å¾ªç¯ä¸­çš„ item æœ¬èº«ï¼Œè¿™ç§è¡¨ç¤ºéœ€è¦ item æœ¬èº«æ˜¯ä¸€ä¸ªå”¯ä¸€çš„å­—ç¬¦ä¸²æˆ–è€…æ•°å­— æ¨¡æ¿WXMLæä¾›æ¨¡æ¿ï¼ˆtemplateï¼‰ï¼Œå¯ä»¥åœ¨æ¨¡æ¿ä¸­å®šä¹‰ä»£ç ç‰‡æ®µï¼Œç„¶ååœ¨ä¸åŒçš„åœ°æ–¹è°ƒç”¨ã€‚ä½¿ç”¨ name å±æ€§ï¼Œä½œä¸ºæ¨¡æ¿çš„åå­—ã€‚ç„¶ååœ¨ &lt;template/&gt; å†…å®šä¹‰ä»£ç ç‰‡æ®µ ä½¿ç”¨ is å±æ€§ï¼Œå£°æ˜éœ€è¦çš„ä½¿ç”¨çš„æ¨¡æ¿ï¼Œç„¶åå°†æ¨¡æ¿æ‰€éœ€è¦çš„ data ä¼ å…¥ WXML æä¾›ä¸¤ç§æ–‡ä»¶å¼•ç”¨æ–¹å¼importå’Œincludeã€‚ import å¯ä»¥åœ¨è¯¥æ–‡ä»¶ä¸­ä½¿ç”¨ç›®æ ‡æ–‡ä»¶å®šä¹‰çš„ template import ä¸å…·æœ‰é€’å½’çš„ç‰¹æ€§ã€‚ æ¡ä»¶æ¸²æŸ“åœ¨wxmlä¸­ä½¿ç”¨wx:ifã€‚1&lt;text wx:if=&quot;{{showPing}}&quot;&gt;{{s.ping}} &lt;/text&gt; WXML ä¸­ï¼Œä½¿ç”¨ wx:if=â€â€œ æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ¸²æŸ“è¯¥ä»£ç å—ã€‚æ ‡ç­¾å®šä¹‰çš„å‰éƒ¨ä½¿ç”¨é€»è¾‘åˆ¤æ–­ã€‚ä½¿ç”¨ wx:elif å’Œ wx:else æ¥æ·»åŠ ä¸€ä¸ª else å—ã€‚ æ’ç‰ˆå¸ƒå±€æ°´å¹³å±…ä¸­å†…å®¹123&lt;view style=&quot;width:100%; display:flex;flex-direction:row;justify-content:center;&quot;&gt;&lt;/view&gt; flexå‚ç›´æ–¹å‘å±…ä¸­ä¸»è¦é align-items: center;ã€‚ä¸è®¾ç½®é«˜åº¦çš„æ—¶å€™ã€‚123456.cfg-start { display: flex; flex-direction: row; margin-right: 20px; align-items: center;} è®¾ç½®äº†ç»å¯¹å®šä½ã€‚éœ€è¦åŒæ—¶è®¾ç½®é«˜åº¦ã€‚123456789.cfg-end { position: absolute; right: 0px; height: 5vh; display: flex; flex-direction: row; margin-right: 2px; align-items: center;} ç¡®å®šå®½é«˜çš„viewé‡Œå±…ä¸­å†…å®¹éœ€è¦è®¾ç½®display: flex;ï¼Œjustify-content:center;ï¼Œalign-items: center;ã€‚1234567891011.ball { width: 30px; height:30px; margin: 2px 2px; display: flex; justify-content:center; align-items: center; border-radius: 15px; color:white; font-size: 12px;} viewä½äºçˆ¶å®¹å™¨åº•éƒ¨æˆ–è€…å«åšdivä½äºçˆ¶å®¹å™¨åº•éƒ¨ã€‚çˆ¶å®¹å™¨è®¾ç½®position: relativeã€‚å­viewè®¾ç½®position: absoluteã€‚å¦‚æœçˆ¶å®¹å™¨æ²¡æœ‰è®¾ç½®relativeå±æ€§ï¼Œå­divï¼ˆæˆ–å­viewï¼‰ä¼šç›¸å¯¹äºé¡µé¢çš„åº•éƒ¨ã€‚ CSS DIVåœ¨å¦ä¸€ä¸ªDIVåº•éƒ¨å±…ä¸­ä¾‹å­1234&lt;div style=&quot;min-height: 360px;position:relative;&quot;&gt; &lt;div style=&quot;position: absolute;bottom: 0px;left: 50%;transform: translate(-50%, -50%);&quot;&gt; &lt;/div&gt;&lt;div&gt;è®¾ç½®bottomçš„æ—¶å€™è®°å¾—å¸¦å•ä½ã€‚ åŠ¨æ€åˆ¤æ–­èƒŒæ™¯è‰²ã€‚idxè¡¨ç¤ºä¸‹æ ‡ã€‚1&lt;view style=&quot;background:{{idx%2 == 0? '#757575':'#424242'}}&quot;&gt;äº”&lt;/view&gt; åŠ¨æ€æ”¹å˜æ–‡å­—é¢œè‰²1&lt;view bindtap=&quot;onTapShowType&quot; data-type='1' style=&quot;color:{{ showLetterType == 1? '#4fa003':'#424242'}}&quot;&gt;äº”&lt;/view&gt; textfont-size å­—ä½“å¤§å°ã€‚font-weight å­—ä½“ç²—ç»†ï¼Œ580å·¦å³èƒ½æœ‰ç²—ä½“æ•ˆæœã€‚ ä¸‹åˆ’çº¿1text-decoration: underline; scroll-viewä½¿ç”¨scroll viewã€‚12345&lt;scroll-view class='word-field' enable-back-to-top scroll-into-view=&quot;{{toView}}&quot; scroll-y=&quot;true&quot; scroll-with-animation=&quot;true&quot; &gt; &lt;view class=&quot;child-field&quot;&gt; &lt;/view&gt;&lt;/scroll-view&gt; wx:forå­é¡¹æ–¹å‘wx:forçš„å­é¡¹æ–¹å‘å…¶å®æ˜¯ç”±å®ƒçš„çˆ¶viewæ¥å†³å®šçš„ã€‚ åˆ—è¡¨è‡ªåŠ¨æ¢è¡Œå‡è®¾æ¨ªå‘ï¼ˆrowï¼‰æ’åˆ—å­é¡¹ï¼Œå­é¡¹å¤ªå¤šçš„æ—¶å€™ä¼šæ¢åˆ°ä¸‹ä¸€è¡Œã€‚éœ€è¦è®¾ç½®flex-flowã€‚1234.correct-field { display: flex; flex-flow: row wrap;} css åœ†è§’åªè®¾ç½®ä¸€ä¸ªå€¼çš„è¯ï¼Œæ˜¯4ä¸ªåœ†è§’ã€‚1border-radius: 4px;å•ä½æ˜¯pxã€‚å¦‚æœå•ä½ç”¨rpxï¼Œåˆ™ä¸æ˜¾ç¤ºåœ†è§’ã€‚ èƒŒæ™¯åŠé€æ˜çœŸæœºè°ƒè¯•æ—¶ï¼Œå°ç¨‹åºè®¾ç½®background: #895fcce0;æ˜¯æ— æ•ˆçš„ï¼Œçœ‹ä¸åˆ°é¢œè‰²ã€‚è¦ä½¿ç”¨opacityå±æ€§æ¥è®¾ç½®ä¸é€æ˜åº¦ã€‚12background: #895fcc;opacity:0.85; èƒŒæ™¯æ¸å˜è‰²https://developers.weixin.qq.com/community/develop/doc/06e11913e57af653ca251462fcc134f2 css class æŒ‰æ¡ä»¶é€‰æ‹©1&lt;view class=&quot;{{showPage==1?'chooser.chosen':'chooser'}}&quot; &gt;sample&lt;/view&gt; ç”¨å¤§æ‹¬å·é‡Œçš„ä¸‰ç›®åˆ¤æ–­ã€‚ ä¾‹å­ğŸŒ° - è¿›åº¦æ¡å’Œæ–‡å­— éœ€æ±‚ï¼šæ˜¾ç¤ºåšé¢˜çš„è¿›åº¦ã€‚è¿›åº¦æ¡ä½œä¸ºèƒŒæ™¯ã€‚æ–‡å­—ç›–åœ¨ä¸Šé¢ã€‚å¤´å°¾å„ä¸€ä¸ªæ–‡å­—ã€‚123456789101112131415161718.top-bar { position: relative; height: 40px;}.pb { position: absolute; width: 100%;}.top-title-field { position: absolute; margin-left: 10px; height: 100%; align-items: center; display: flex; justify-content: center;} 123456789&lt;view class=&quot;top-bar&quot;&gt; &lt;progress class=&quot;pb&quot; stroke-width=&quot;40px&quot; activeColor=&quot;#42A5F5&quot; percent=&quot;40&quot; /&gt; &lt;view class=&quot;top-title-field&quot;&gt; &lt;text&gt;å•é¡¹é€‰æ‹©&lt;/text&gt; &lt;/view&gt; &lt;view class=&quot;progress-text&quot;&gt; &lt;text&gt;4/10&lt;/text&gt; &lt;/view&gt;&lt;/view&gt; æ’­æ”¾éŸ³é¢‘æ’­æ”¾éŸ³é¢‘éœ€è¦ç”¨åˆ°InnerAudioContext æ’­æ”¾æœ¬åœ°æ–‡ä»¶æ’­æ”¾æœ¬åœ°éŸ³é¢‘ã€‚éŸ³é¢‘æ–‡ä»¶åœ¨audioç›®å½•é‡Œã€‚audioç›®å½•å’Œpagesç›®å½•åŒçº§ã€‚å…ˆåˆ›å»ºInnerAudioContextã€‚å¹¶ä¸”åœ¨onLoadæ–¹æ³•ä¸­è®¾ç½®ç›‘å¬ã€‚æ³¨æ„æœ¬åœ°éŸ³é¢‘æ–‡ä»¶çš„è·¯å¾„å†™æ³•ï¼Œä¸ç”¨å†™ç›¸å¯¹è·¯å¾„ï¼Œç”¨ç»å¯¹è·¯å¾„å°±å¥½ã€‚123456789101112131415161718192021222324252627282930313233343536373839const iac = wx.createInnerAudioContext()Page({ /** * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åŠ è½½ */ onLoad: function(options) { this.registerAudioContext() console.log('ac ', iac) }, onTapSound: function(event) { // console.log(event) var word = event.currentTarget.id; console.log('cilck', word) iac.src = 'audio/a.mp3' iac.volume = 2 iac.loop = false iac.play() console.log('tap sound done. ') }, // æ³¨å†ŒéŸ³é¢‘ registerAudioContext: function() { iac.onEnded((res) =&gt; { console.log('on ended', res) }) iac.onError((res) =&gt; { // æ’­æ”¾éŸ³é¢‘å¤±è´¥çš„å›è°ƒ console.log('æ’­æ”¾éŸ³é¢‘å¤±è´¥', res); }) iac.onStop((res) =&gt; { console.log('æ’­æ”¾ç»“æŸ!'); }) },}) æµ‹è¯•å‘ç°ï¼Œå®‰å“æ‰‹æœºæ’­æ”¾çš„éŸ³é¢‘æ”¯æŒmp3ä¸pepmã€‚iPhone Xsä¸èƒ½æ’­æ”¾pepmã€‚åœ¨æœ¬åœ°æ”¾éŸ³é¢‘æ–‡ä»¶æ—¶ï¼Œå°ç¨‹åºä¼šæç¤ºâ€œæ–‡ä»¶æœªä¸Šä¼ â€ã€‚å¯èƒ½æ˜¯å°ç¨‹åºç¼–è¯‘å®Œæˆéœ€å°äºæŸä¸ªå¤§å°ï¼ˆ2Mï¼‰æ‰èƒ½ä¸Šä¼ ã€‚é‚£ä¹ˆæˆ‘ä»¬æŠŠéŸ³é¢‘æ–‡ä»¶æ”¾åœ¨æœåŠ¡å™¨ä¸Šå§ã€‚å¯ä»¥ä½¿ç”¨å¾®ä¿¡äº‘å¼€å‘é‡Œçš„å­˜å‚¨ã€‚ä¸Šä¼ æ–‡ä»¶åï¼Œæ‰¾åˆ°æ–‡ä»¶çš„ä¸‹è½½åœ°å€ï¼Œhttpså¼€å¤´çš„ã€‚è®¾ç½®ç»™iacçš„srcã€‚ æ’­æ”¾ç½‘ç»œéŸ³é¢‘æ‰¾åˆ°éŸ³é¢‘æ–‡ä»¶çš„urlï¼Œèµ‹å€¼ç»™iac.srcã€‚ç„¶åæ’­æ”¾ã€‚1iac.src = 'https://audio....' æ–‡ä»¶ç³»ç»Ÿhttps://developers.weixin.qq.com/miniprogram/dev/framework/ability/file-system.html ä½¿ç”¨FileSystemManagerçš„æ–¹æ³•ã€‚ åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨å¼‚æ­¥çš„æ–¹å¼åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚1234567891011var fs = wx.getFileSystemManager()fs.access({ path: audioDir, success(res) { console.log(audioDir, remoteDir, res) }, fail(err) { console.log(err) }}); åŒæ­¥åˆ¤æ–­ã€‚å¦‚æœä¸å­˜åœ¨åˆ™ä¼šæŠ¥é”™ã€‚12345try { fs.accessSync(localFilePath)} catch (t) { console.log(localFilePath, 'not exists.')} åˆ›å»ºç›®å½• mkdir123456789fs.mkdir({ dirPath: audioDir, success(res) { console.log(res) }, fail(err) { console.log('Can not create dir.', audioDir, err) }}) ç•Œé¢è·³å›ä¸Šä¸€ä¸ªç•Œé¢1wx.navigateBack({}) 123wx.navigateBack({ delta: 1}) å®šæ—¶ä»»åŠ¡123setTimeout(function() { // æ“ä½œ}, 1000) ä¸‹è½½å¾®ä¿¡å°ç¨‹åºæä¾›äº†ä¸‹è½½apiã€‚ ä¸‹è½½æ–‡ä»¶12345678910wx.downloadFile({ url: targetUrl, filePath: localFilePath, success: res =&gt; { console.log('download success') }, fail: err =&gt; { console.log('download fail',err) }}) ç‚¹å‡»äº‹ä»¶ç‚¹å‡»äº‹ä»¶ä¸»è¦é bindtapæ–¹æ³•ã€‚ ç‚¹å‡»äº‹ä»¶ä¼ é€’å‚æ•°æ•°æ®åœ¨soundRowAé‡Œé¢ã€‚æ¸²æŸ“ä¸€ä¸ªåˆ—è¡¨ã€‚wxmlä¸­åŠ ä¸Šdataç±»å‹ï¼Œè¿™é‡Œæ˜¯data-wordã€‚ä¹Ÿå¯ä»¥èµ·åˆ«çš„åå­—ï¼Œä½†ä¸€å®šè¦data-å¼€å¤´ã€‚12345&lt;view wx:for=&quot;{{soundRowA}}&quot; wx:for-index=&quot;idx&quot; wx:for-item=&quot;s&quot;&gt; &lt;view bindtap=&quot;onTapSound&quot; data-word='{{s}}'&gt; æ˜¾ç¤ºä¸€äº›æ•°æ® &lt;/view&gt;&lt;/view&gt; jsä¸­å®ç°onTapSoundæ–¹æ³•ã€‚è·å–ç‚¹å‡»äº‹ä»¶eventã€‚ä¼ é€’å›æ¥çš„æ•°æ®æ˜¯åœ¨event.currentTarget.datasetä¸­ã€‚æ ¹æ®wxmlä¸­data-wordï¼Œä¼ é€’å›æ¥çš„æ•°æ®çš„keyæ˜¯wordã€‚123onTapSound: function(event) { var word = event.currentTarget.dataset.word}, tabbarhttps://developers.weixin.qq.com/miniprogram/dev/extended/weui/tabbar.html åœ¨åº•éƒ¨ï¼Œèµ·å¯¼èˆªä½œç”¨","link":"/2019/08/10/Dev-note/dev-note-miniapp-all/"},{"title":"Android Binder æœºåˆ¶ä»‹ç»","text":"é¢å‘å¯¹è±¡çš„IPC - Binderc/sæ¶æ„ï¼Œå®¢æˆ·ç«¯è¦æ‰¾å¾—åˆ°æœåŠ¡ç«¯ã€‚Binderä½¿ç”¨Client-Serveré€šä¿¡æ–¹å¼ï¼šä¸€ä¸ªè¿›ç¨‹ä½œä¸ºServeræä¾›è¯¸å¦‚è§†é¢‘/éŸ³é¢‘è§£ç ï¼Œè§†é¢‘æ•è·ï¼Œåœ°å€æœ¬æŸ¥è¯¢ï¼Œç½‘ç»œè¿æ¥ç­‰æœåŠ¡ï¼›å¤šä¸ªè¿›ç¨‹ä½œä¸ºClientå‘Serverå‘èµ·æœåŠ¡è¯·æ±‚ï¼Œè·å¾—æ‰€éœ€è¦çš„æœåŠ¡ã€‚è¦æƒ³å®ç°Client-Serveré€šä¿¡æ®å¿…é¡»å®ç°ä»¥ä¸‹ä¸¤ç‚¹ï¼šä¸€æ˜¯serverå¿…é¡»æœ‰ç¡®å®šçš„è®¿é—®æ¥å…¥ç‚¹æˆ–è€…è¯´åœ°å€æ¥æ¥å—Clientçš„è¯·æ±‚ï¼Œå¹¶ä¸”Clientå¯ä»¥é€šè¿‡æŸç§é€”å¾„è·çŸ¥Serverçš„åœ°å€ï¼›äºŒæ˜¯åˆ¶å®šCommand-Replyåè®®æ¥ä¼ è¾“æ•°æ®ã€‚ä¾‹å¦‚åœ¨ç½‘ç»œé€šä¿¡ä¸­Serverçš„è®¿é—®æ¥å…¥ç‚¹å°±æ˜¯Serverä¸»æœºçš„IPåœ°å€+ç«¯å£å·ï¼Œä¼ è¾“åè®®ä¸ºTCPåè®®ã€‚å¯¹Binderè€Œè¨€ï¼ŒBinderå¯ä»¥çœ‹æˆServeræä¾›çš„å®ç°æŸä¸ªç‰¹å®šæœåŠ¡çš„è®¿é—®æ¥å…¥ç‚¹ï¼Œ Clienté€šè¿‡è¿™ä¸ªâ€˜åœ°å€â€™å‘Serverå‘é€è¯·æ±‚æ¥ä½¿ç”¨è¯¥æœåŠ¡ï¼›å¯¹Clientè€Œè¨€ï¼ŒBinderå¯ä»¥çœ‹æˆæ˜¯é€šå‘Serverçš„ç®¡é“å…¥å£ï¼Œè¦æƒ³å’ŒæŸä¸ªServeré€šä¿¡é¦–å…ˆå¿…é¡»å»ºç«‹è¿™ä¸ªç®¡é“å¹¶è·å¾—ç®¡é“å…¥å£ã€‚ ä¸å…¶å®ƒIPCä¸åŒï¼ŒBinderä½¿ç”¨äº†é¢å‘å¯¹è±¡çš„æ€æƒ³æ¥æè¿°ä½œä¸ºè®¿é—®æ¥å…¥ç‚¹çš„BinderåŠå…¶åœ¨Clientä¸­çš„å…¥å£ã€‚Binderæ˜¯ä¸€ä¸ªå®ä½“ä½äºServerä¸­çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æä¾›äº†ä¸€å¥—æ–¹æ³•ç”¨ä»¥å®ç°å¯¹æœåŠ¡çš„è¯·æ±‚ï¼Œå°±è±¡ç±»çš„æˆå‘˜å‡½æ•°ã€‚éå¸ƒäºclientä¸­çš„å…¥å£å¯ä»¥çœ‹æˆæŒ‡å‘è¿™ä¸ªbinderå¯¹è±¡çš„â€˜æŒ‡é’ˆâ€™ï¼Œä¸€æ—¦è·å¾—äº†è¿™ä¸ªâ€˜æŒ‡é’ˆâ€™å°±å¯ä»¥è°ƒç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•è®¿é—®serverã€‚åœ¨Clientçœ‹æ¥ï¼Œé€šè¿‡Binderâ€˜æŒ‡é’ˆâ€™è°ƒç”¨å…¶æä¾›çš„æ–¹æ³•å’Œé€šè¿‡æŒ‡é’ˆè°ƒç”¨å…¶å®ƒä»»ä½•æœ¬åœ°å¯¹è±¡çš„æ–¹æ³•å¹¶æ— åŒºåˆ«ï¼Œå°½ç®¡å‰è€…çš„å®ä½“ä½äºè¿œç«¯Serverä¸­ï¼Œè€Œåè€…å®ä½“ä½äºæœ¬åœ°å†…å­˜ä¸­ã€‚â€˜æŒ‡é’ˆâ€™æ˜¯C++çš„æœ¯è¯­ï¼Œè€Œæ›´é€šå¸¸çš„è¯´æ³•æ˜¯å¼•ç”¨ï¼Œå³Clienté€šè¿‡Binderçš„å¼•ç”¨è®¿é—®Serverã€‚è€Œè½¯ä»¶é¢†åŸŸå¦ä¸€ä¸ªæœ¯è¯­â€˜å¥æŸ„â€™ä¹Ÿå¯ä»¥ç”¨æ¥è¡¨è¿°Binderåœ¨Clientä¸­çš„å­˜åœ¨æ–¹å¼ã€‚ä»é€šä¿¡çš„è§’åº¦çœ‹ï¼ŒClientä¸­çš„Binderä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯Server Binderçš„â€˜ä»£ç†â€™ï¼Œåœ¨æœ¬åœ°ä»£è¡¨è¿œç«¯Serverä¸ºClientæä¾›æœåŠ¡ã€‚æœ¬æ–‡ä¸­ä¼šä½¿ç”¨â€˜å¼•ç”¨â€™æˆ–â€˜å¥æŸ„â€™è¿™ä¸ªä¸¤å¹¿æ³›ä½¿ç”¨çš„æœ¯è¯­ã€‚ Binderå¯¹è±¡æ˜¯ä¸€ä¸ªå¯ä»¥è·¨è¿›ç¨‹å¼•ç”¨çš„å¯¹è±¡ï¼Œå®ƒçš„å®ä½“ä½äºä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œè€Œå®ƒçš„å¼•ç”¨å´éå¸ƒäºç³»ç»Ÿçš„å„ä¸ªè¿›ç¨‹ä¹‹ä¸­ã€‚ é¢å‘å¯¹è±¡æ€æƒ³çš„å¼•å…¥å°†è¿›ç¨‹é—´é€šä¿¡è½¬åŒ–ä¸ºé€šè¿‡å¯¹æŸä¸ªBinderå¯¹è±¡çš„å¼•ç”¨è°ƒç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œå…¶ç‹¬ç‰¹ä¹‹å¤„åœ¨äºBinderå¯¹è±¡æ˜¯ä¸€ä¸ªå¯ä»¥è·¨è¿›ç¨‹å¼•ç”¨çš„å¯¹è±¡ï¼Œå®ƒçš„å®ä½“ä½äºä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œè€Œå®ƒçš„å¼•ç”¨å´éå¸ƒäºç³»ç»Ÿçš„å„ä¸ªè¿›ç¨‹ä¹‹ä¸­ã€‚æœ€è¯±äººçš„æ˜¯ï¼Œè¿™ä¸ªå¼•ç”¨å’Œjavaé‡Œå¼•ç”¨ä¸€æ ·æ—¢å¯ä»¥æ˜¯å¼ºç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼±ç±»å‹ï¼Œè€Œä¸”å¯ä»¥ä»ä¸€ä¸ªè¿›ç¨‹ä¼ ç»™å…¶å®ƒè¿›ç¨‹ï¼Œè®©å¤§å®¶éƒ½èƒ½è®¿é—®åŒä¸€Serverï¼Œå°±è±¡å°†ä¸€ä¸ªå¯¹è±¡æˆ–å¼•ç”¨èµ‹å€¼ç»™å¦ä¸€ä¸ªå¼•ç”¨ä¸€æ ·ã€‚Binderæ¨¡ç³Šäº†è¿›ç¨‹è¾¹ç•Œï¼Œæ·¡åŒ–äº†è¿›ç¨‹é—´é€šä¿¡è¿‡ç¨‹ï¼Œæ•´ä¸ªç³»ç»Ÿä»¿ä½›è¿è¡ŒäºåŒä¸€ä¸ªé¢å‘å¯¹è±¡çš„ç¨‹åºä¹‹ä¸­ã€‚å½¢å½¢è‰²è‰²çš„Binderå¯¹è±¡ä»¥åŠæ˜Ÿç½—æ£‹å¸ƒçš„å¼•ç”¨ä»¿ä½›ç²˜æ¥å„ä¸ªåº”ç”¨ç¨‹åºçš„èƒ¶æ°´ï¼Œè¿™ä¹Ÿæ˜¯Binderåœ¨è‹±æ–‡é‡Œçš„åŸæ„ã€‚ å½“ç„¶é¢å‘å¯¹è±¡åªæ˜¯é’ˆå¯¹åº”ç”¨ç¨‹åºè€Œè¨€ï¼Œå¯¹äºBinderé©±åŠ¨å’Œå†…æ ¸å…¶å®ƒæ¨¡å—ä¸€æ ·ä½¿ç”¨Cè¯­è¨€å®ç°ï¼Œæ²¡æœ‰ç±»å’Œå¯¹è±¡çš„æ¦‚å¿µã€‚Binderé©±åŠ¨ä¸ºé¢å‘å¯¹è±¡çš„è¿›ç¨‹é—´é€šä¿¡æä¾›åº•å±‚æ”¯æŒã€‚ Binder é€šä¿¡æ¨¡å‹Binderæ¡†æ¶å®šä¹‰äº†å››ä¸ªè§’è‰²ï¼šServerï¼ŒClientï¼ŒServiceManagerï¼ˆä»¥åç®€ç§°SMgrï¼‰ä»¥åŠBinderé©±åŠ¨ã€‚å…¶ä¸­Serverï¼ŒClientï¼ŒSMgrè¿è¡Œäºç”¨æˆ·ç©ºé—´ï¼Œé©±åŠ¨è¿è¡Œäºå†…æ ¸ç©ºé—´ã€‚è¿™å››ä¸ªè§’è‰²çš„å…³ç³»å’Œäº’è”ç½‘ç±»ä¼¼ï¼šServeræ˜¯æœåŠ¡å™¨ï¼ŒClientæ˜¯å®¢æˆ·ç»ˆç«¯ï¼ŒSMgræ˜¯åŸŸåæœåŠ¡å™¨ï¼ˆDNSï¼‰ï¼Œé©±åŠ¨æ˜¯è·¯ç”±å™¨ã€‚ Binder é©±åŠ¨å’Œè·¯ç”±å™¨ä¸€æ ·ï¼ŒBinderé©±åŠ¨è™½ç„¶é»˜é»˜æ— é—»ï¼Œå´æ˜¯é€šä¿¡çš„æ ¸å¿ƒã€‚å°½ç®¡åå«â€˜é©±åŠ¨â€™ï¼Œå®é™…ä¸Šå’Œç¡¬ä»¶è®¾å¤‡æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œåªæ˜¯å®ç°æ–¹å¼å’Œè®¾å¤‡é©±åŠ¨ç¨‹åºæ˜¯ä¸€æ ·çš„ï¼šå®ƒå·¥ä½œäºå†…æ ¸æ€ï¼Œæä¾›open()ï¼Œmmap()ï¼Œpoll()ï¼Œioctl()ç­‰æ ‡å‡†æ–‡ä»¶æ“ä½œï¼Œä»¥å­—ç¬¦é©±åŠ¨è®¾å¤‡ä¸­çš„miscè®¾å¤‡æ³¨å†Œåœ¨è®¾å¤‡ç›®å½•/devä¸‹ï¼Œç”¨æˆ·é€šè¿‡/dev/binderè®¿é—®è¯¥å®ƒã€‚é©±åŠ¨è´Ÿè´£è¿›ç¨‹ä¹‹é—´Binderé€šä¿¡çš„å»ºç«‹ï¼ŒBinderåœ¨è¿›ç¨‹ä¹‹é—´çš„ä¼ é€’ï¼ŒBinderå¼•ç”¨è®¡æ•°ç®¡ç†ï¼Œæ•°æ®åŒ…åœ¨è¿›ç¨‹ä¹‹é—´çš„ä¼ é€’å’Œäº¤äº’ç­‰ä¸€ç³»åˆ—åº•å±‚æ”¯æŒã€‚é©±åŠ¨å’Œåº”ç”¨ç¨‹åºä¹‹é—´å®šä¹‰äº†ä¸€å¥—æ¥å£åè®®ï¼Œä¸»è¦åŠŸèƒ½ç”±ioctl()æ¥å£å®ç°ï¼Œä¸æä¾›read()ï¼Œwrite()æ¥å£ï¼Œå› ä¸ºioctl()çµæ´»æ–¹ä¾¿ï¼Œä¸”èƒ½å¤Ÿä¸€æ¬¡è°ƒç”¨å®ç°å…ˆå†™åè¯»ä»¥æ»¡è¶³åŒæ­¥äº¤äº’ï¼Œè€Œä¸å¿…åˆ†åˆ«è°ƒç”¨write()å’Œread()ã€‚Binderé©±åŠ¨çš„ä»£ç ä½äºlinuxç›®å½•çš„drivers/misc/binder.cä¸­ã€‚ ServiceManager ä¸å®åBinderå’ŒDNSç±»ä¼¼ï¼ŒSMgrçš„ä½œç”¨æ˜¯å°†å­—ç¬¦å½¢å¼çš„Binderåå­—è½¬åŒ–æˆClientä¸­å¯¹è¯¥Binderçš„å¼•ç”¨ï¼Œä½¿å¾—Clientèƒ½å¤Ÿé€šè¿‡Binderåå­—è·å¾—å¯¹Serverä¸­Binderå®ä½“çš„å¼•ç”¨ã€‚æ³¨å†Œäº†åå­—çš„Binderå«å®åBinderï¼Œå°±è±¡æ¯ä¸ªç½‘ç«™é™¤äº†æœ‰IPåœ°å€å¤–è¿˜æœ‰è‡ªå·±çš„ç½‘å€ã€‚Serveråˆ›å»ºäº†Binderå®ä½“ï¼Œä¸ºå…¶å–ä¸€ä¸ªå­—ç¬¦å½¢å¼ï¼Œå¯è¯»æ˜“è®°çš„åå­—ï¼Œå°†è¿™ä¸ªBinderè¿åŒåå­—ä»¥æ•°æ®åŒ…çš„å½¢å¼é€šè¿‡Binderé©±åŠ¨å‘é€ç»™SMgrï¼Œé€šçŸ¥SMgræ³¨å†Œä¸€ä¸ªåå«å¼ ä¸‰çš„Binderï¼Œå®ƒä½äºæŸä¸ªServerä¸­ã€‚é©±åŠ¨ä¸ºè¿™ä¸ªç©¿è¿‡è¿›ç¨‹è¾¹ç•Œçš„Binderåˆ›å»ºä½äºå†…æ ¸ä¸­çš„å®ä½“èŠ‚ç‚¹ä»¥åŠSMgrå¯¹å®ä½“çš„å¼•ç”¨ï¼Œå°†åå­—åŠæ–°å»ºçš„å¼•ç”¨æ‰“åŒ…ä¼ é€’ç»™SMgrã€‚SMgræ”¶æ•°æ®åŒ…åï¼Œä»ä¸­å–å‡ºåå­—å’Œå¼•ç”¨å¡«å…¥ä¸€å¼ æŸ¥æ‰¾è¡¨ä¸­ã€‚ ServiceManagerä»€ä¹ˆæ—¶å€™æ³¨å†Œçš„ç»†å¿ƒçš„è¯»è€…å¯èƒ½ä¼šå‘ç°å…¶ä¸­çš„è¹Šè··ï¼šSMgræ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼ŒServeræ˜¯å¦ä¸€ä¸ªè¿›ç¨‹ï¼ŒServerå‘SMgræ³¨å†ŒBinderå¿…ç„¶ä¼šæ¶‰åŠè¿›ç¨‹é—´é€šä¿¡ã€‚å½“å‰å®ç°çš„æ˜¯è¿›ç¨‹é—´é€šä¿¡å´åˆè¦ç”¨åˆ°è¿›ç¨‹é—´é€šä¿¡ï¼Œè¿™å°±å¥½è±¡è›‹å¯ä»¥å­µå‡ºé¸¡å‰æå´æ˜¯è¦æ‰¾åªé¸¡æ¥å­µè›‹ã€‚Binderçš„å®ç°æ¯”è¾ƒå·§å¦™ï¼šé¢„å…ˆåˆ›é€ ä¸€åªé¸¡æ¥å­µè›‹ï¼šSMgrå’Œå…¶å®ƒè¿›ç¨‹åŒæ ·é‡‡ç”¨Binderé€šä¿¡ï¼ŒSMgræ˜¯Serverç«¯ï¼Œæœ‰è‡ªå·±çš„Binderå¯¹è±¡ï¼ˆå®ä½“ï¼‰ï¼Œå…¶å®ƒè¿›ç¨‹éƒ½æ˜¯Clientï¼Œéœ€è¦é€šè¿‡è¿™ä¸ªBinderçš„å¼•ç”¨æ¥å®ç°Binderçš„æ³¨å†Œï¼ŒæŸ¥è¯¢å’Œè·å–ã€‚SMgræä¾›çš„Binderæ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒæ²¡æœ‰åå­—ä¹Ÿä¸éœ€è¦æ³¨å†Œï¼Œå½“ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨BINDER_SET_CONTEXT_MGRå‘½ä»¤å°†è‡ªå·±æ³¨å†ŒæˆSMgræ—¶Binderé©±åŠ¨ä¼šè‡ªåŠ¨ä¸ºå®ƒåˆ›å»ºBinderå®ä½“ï¼ˆè¿™å°±æ˜¯é‚£åªé¢„å…ˆé€ å¥½çš„é¸¡ï¼‰ã€‚å…¶æ¬¡è¿™ä¸ªBinderçš„å¼•ç”¨åœ¨æ‰€æœ‰Clientä¸­éƒ½å›ºå®šä¸º0è€Œæ— é¡»é€šè¿‡å…¶å®ƒæ‰‹æ®µè·å¾—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªServerè‹¥è¦å‘SMgræ³¨å†Œè‡ªå·±Binderå°±å¿…éœ€é€šè¿‡0è¿™ä¸ªå¼•ç”¨å·å’ŒSMgrçš„Binderé€šä¿¡ã€‚ç±»æ¯”ç½‘ç»œé€šä¿¡ï¼Œ0å·å¼•ç”¨å°±å¥½æ¯”åŸŸåæœåŠ¡å™¨çš„åœ°å€ï¼Œä½ å¿…é¡»é¢„å…ˆæ‰‹å·¥æˆ–åŠ¨æ€é…ç½®å¥½ã€‚è¦æ³¨æ„è¿™é‡Œè¯´çš„Clientæ˜¯ç›¸å¯¹SMgrè€Œè¨€çš„ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå¯èƒ½æ˜¯ä¸ªæä¾›æœåŠ¡çš„Serverï¼Œä½†å¯¹SMgræ¥è¯´å®ƒä»ç„¶æ˜¯ä¸ªClientã€‚ Client è·å¾—å®åBinderçš„å¼•ç”¨Serverå‘SMgræ³¨å†Œäº†Binderå®ä½“åŠå…¶åå­—åï¼ŒClientå°±å¯ä»¥é€šè¿‡åå­—è·å¾—è¯¥Binderçš„å¼•ç”¨äº†ã€‚Clientä¹Ÿåˆ©ç”¨ä¿ç•™çš„0å·å¼•ç”¨å‘SMgrè¯·æ±‚è®¿é—®æŸä¸ªBinderï¼šæˆ‘ç”³è¯·è·å¾—åå­—å«å¼ ä¸‰çš„Binderçš„å¼•ç”¨ã€‚SMgræ”¶åˆ°è¿™ä¸ªè¿æ¥è¯·æ±‚ï¼Œä»è¯·æ±‚æ•°æ®åŒ…é‡Œè·å¾—Binderçš„åå­—ï¼Œåœ¨æŸ¥æ‰¾è¡¨é‡Œæ‰¾åˆ°è¯¥åå­—å¯¹åº”çš„æ¡ç›®ï¼Œä»æ¡ç›®ä¸­å–å‡ºBinderçš„å¼•ç”¨ï¼Œå°†è¯¥å¼•ç”¨ä½œä¸ºå›å¤å‘é€ç»™å‘èµ·è¯·æ±‚çš„Clientã€‚ä»é¢å‘å¯¹è±¡çš„è§’åº¦ï¼Œè¿™ä¸ªBinderå¯¹è±¡ç°åœ¨æœ‰äº†ä¸¤ä¸ªå¼•ç”¨ï¼šä¸€ä¸ªä½äºSMgrä¸­ï¼Œä¸€ä¸ªä½äºå‘èµ·è¯·æ±‚çš„Clientä¸­ã€‚å¦‚æœæ¥ä¸‹æ¥æœ‰æ›´å¤šçš„Clientè¯·æ±‚è¯¥Binderï¼Œç³»ç»Ÿä¸­å°±ä¼šæœ‰æ›´å¤šçš„å¼•ç”¨æŒ‡å‘è¯¥Binderï¼Œå°±è±¡javaé‡Œä¸€ä¸ªå¯¹è±¡å­˜åœ¨å¤šä¸ªå¼•ç”¨ä¸€æ ·ã€‚è€Œä¸”ç±»ä¼¼çš„è¿™äº›æŒ‡å‘Binderçš„å¼•ç”¨æ˜¯å¼ºç±»å‹ï¼Œä»è€Œç¡®ä¿åªè¦æœ‰å¼•ç”¨Binderå®ä½“å°±ä¸ä¼šè¢«é‡Šæ”¾æ‰ã€‚é€šè¿‡ä»¥ä¸Šè¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼ŒSMgrè±¡ä¸ªç«è½¦ç¥¨ä»£å”®ç‚¹ï¼Œæ”¶é›†äº†æ‰€æœ‰ç«è½¦çš„è½¦ç¥¨ï¼Œå¯ä»¥é€šè¿‡å®ƒè´­ä¹°åˆ°ä¹˜åå„è¶Ÿç«è½¦çš„ç¥¨-å¾—åˆ°æŸä¸ªBinderçš„å¼•ç”¨ã€‚ åŒ¿å Binderå¹¶ä¸æ˜¯æ‰€æœ‰Binderéƒ½éœ€è¦æ³¨å†Œç»™SMgrå¹¿è€Œå‘Šä¹‹çš„ã€‚Serverç«¯å¯ä»¥é€šè¿‡å·²ç»å»ºç«‹çš„Binderè¿æ¥å°†åˆ›å»ºçš„Binderå®ä½“ä¼ ç»™Clientï¼Œå½“ç„¶è¿™æ¡å·²ç»å»ºç«‹çš„Binderè¿æ¥å¿…é¡»æ˜¯é€šè¿‡å®åBinderå®ç°ã€‚ç”±äºè¿™ä¸ªBinderæ²¡æœ‰å‘SMgræ³¨å†Œåå­—ï¼Œæ‰€ä»¥æ˜¯ä¸ªåŒ¿åBinderã€‚Clientå°†ä¼šæ”¶åˆ°è¿™ä¸ªåŒ¿åBinderçš„å¼•ç”¨ï¼Œé€šè¿‡è¿™ä¸ªå¼•ç”¨å‘ä½äºServerä¸­çš„å®ä½“å‘é€è¯·æ±‚ã€‚åŒ¿åBinderä¸ºé€šä¿¡åŒæ–¹å»ºç«‹ä¸€æ¡ç§å¯†é€šé“ï¼Œåªè¦Serveræ²¡æœ‰æŠŠåŒ¿åBinderå‘ç»™åˆ«çš„è¿›ç¨‹ï¼Œåˆ«çš„è¿›ç¨‹å°±æ— æ³•é€šè¿‡ç©·ä¸¾æˆ–çŒœæµ‹ç­‰ä»»ä½•æ–¹å¼è·å¾—è¯¥Binderçš„å¼•ç”¨ï¼Œå‘è¯¥Binderå‘é€è¯·æ±‚ã€‚ ä¸‹å›¾å±•ç¤ºäº†å‚ä¸Binderé€šä¿¡çš„æ‰€æœ‰è§’è‰²ï¼Œå°†åœ¨åé¢çš„å†…å®¹ä¸­ä¸€ä¸€æåˆ°ã€‚ Binder å†…å­˜æ˜ å°„å’Œæ¥æ”¶ç¼“å­˜åŒºç®¡ç†æš‚ä¸”æ’‡å¼€Binderï¼Œè€ƒè™‘ä¸€ä¸‹ä¼ ç»Ÿçš„IPCæ–¹å¼ä¸­ï¼Œæ•°æ®æ˜¯æ€æ ·ä»å‘é€ç«¯åˆ°è¾¾æ¥æ”¶ç«¯çš„å‘¢ï¼Ÿé€šå¸¸çš„åšæ³•æ˜¯ï¼Œå‘é€æ–¹å°†å‡†å¤‡å¥½çš„æ•°æ®å­˜æ”¾åœ¨ç¼“å­˜åŒºä¸­ï¼Œè°ƒç”¨APIé€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›å…¥å†…æ ¸ä¸­ã€‚å†…æ ¸æœåŠ¡ç¨‹åºåœ¨å†…æ ¸ç©ºé—´åˆ†é…å†…å­˜ï¼Œå°†æ•°æ®ä»å‘é€æ–¹ç¼“å­˜åŒºå¤åˆ¶åˆ°å†…æ ¸ç¼“å­˜åŒºä¸­ã€‚æ¥æ”¶æ–¹è¯»æ•°æ®æ—¶ä¹Ÿè¦æä¾›ä¸€å—ç¼“å­˜åŒºï¼Œå†…æ ¸å°†æ•°æ®ä»å†…æ ¸ç¼“å­˜åŒºæ‹·è´åˆ°æ¥æ”¶æ–¹æä¾›çš„ç¼“å­˜åŒºä¸­å¹¶å”¤é†’æ¥æ”¶çº¿ç¨‹ï¼Œå®Œæˆä¸€æ¬¡æ•°æ®å‘é€ã€‚è¿™ç§å­˜å‚¨-è½¬å‘æœºåˆ¶æœ‰ä¸¤ä¸ªç¼ºé™·ï¼šé¦–å…ˆæ˜¯æ•ˆç‡ä½ä¸‹ï¼Œéœ€è¦åšä¸¤æ¬¡æ‹·è´ï¼šç”¨æˆ·ç©ºé—´-&gt;å†…æ ¸ç©ºé—´-&gt;ç”¨æˆ·ç©ºé—´ã€‚Linuxä½¿ç”¨copy_from_user()å’Œcopy_to_user()å®ç°è¿™ä¸¤ä¸ªè·¨ç©ºé—´æ‹·è´ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­å¦‚æœä½¿ç”¨äº†é«˜ç«¯å†…å­˜ï¼ˆhigh memoryï¼‰ï¼Œè¿™ç§æ‹·è´éœ€è¦ä¸´æ—¶å»ºç«‹/å–æ¶ˆé¡µé¢æ˜ å°„ï¼Œé€ æˆæ€§èƒ½æŸå¤±ã€‚å…¶æ¬¡æ˜¯æ¥æ”¶æ•°æ®çš„ç¼“å­˜è¦ç”±æ¥æ”¶æ–¹æä¾›ï¼Œå¯æ¥æ”¶æ–¹ä¸çŸ¥é“åˆ°åº•è¦å¤šå¤§çš„ç¼“å­˜æ‰å¤Ÿç”¨ï¼Œåªèƒ½å¼€è¾Ÿå°½é‡å¤§çš„ç©ºé—´æˆ–å…ˆè°ƒç”¨APIæ¥æ”¶æ¶ˆæ¯å¤´è·å¾—æ¶ˆæ¯ä½“å¤§å°ï¼Œå†å¼€è¾Ÿé€‚å½“çš„ç©ºé—´æ¥æ”¶æ¶ˆæ¯ä½“ã€‚ä¸¤ç§åšæ³•éƒ½æœ‰ä¸è¶³ï¼Œä¸æ˜¯æµªè´¹ç©ºé—´å°±æ˜¯æµªè´¹æ—¶é—´ã€‚ Binderé‡‡ç”¨ä¸€ç§å…¨æ–°ç­–ç•¥ï¼šç”±Binderé©±åŠ¨è´Ÿè´£ç®¡ç†æ•°æ®æ¥æ”¶ç¼“å­˜ã€‚æˆ‘ä»¬æ³¨æ„åˆ°Binderé©±åŠ¨å®ç°äº†mmap()ç³»ç»Ÿè°ƒç”¨ï¼Œè¿™å¯¹å­—ç¬¦è®¾å¤‡æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ï¼Œå› ä¸ºmmap()é€šå¸¸ç”¨åœ¨æœ‰ç‰©ç†å­˜å‚¨ä»‹è´¨çš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œè€Œè±¡Binderè¿™æ ·æ²¡æœ‰ç‰©ç†ä»‹è´¨ï¼Œçº¯ç²¹ç”¨æ¥é€šä¿¡çš„å­—ç¬¦è®¾å¤‡æ²¡å¿…è¦æ”¯æŒmmap()ã€‚Binderé©±åŠ¨å½“ç„¶ä¸æ˜¯ä¸ºäº†åœ¨ç‰©ç†ä»‹è´¨å’Œç”¨æˆ·ç©ºé—´åšæ˜ å°„ï¼Œè€Œæ˜¯ç”¨æ¥åˆ›å»ºæ•°æ®æ¥æ”¶çš„ç¼“å­˜ç©ºé—´ã€‚å…ˆçœ‹mmap()æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼š fd = open(â€œ/dev/binderâ€, O_RDWR); mmap(NULL, MAP_SIZE, PROT_READ, MAP_PRIVATE, fd, 0); è¿™æ ·Binderçš„æ¥æ”¶æ–¹å°±æœ‰äº†ä¸€ç‰‡å¤§å°ä¸ºMAP_SIZEçš„æ¥æ”¶ç¼“å­˜åŒºã€‚mmap()çš„è¿”å›å€¼æ˜¯å†…å­˜æ˜ å°„åœ¨ç”¨æˆ·ç©ºé—´çš„åœ°å€ï¼Œä¸è¿‡è¿™æ®µç©ºé—´æ˜¯ç”±é©±åŠ¨ç®¡ç†ï¼Œç”¨æˆ·ä¸å¿…ä¹Ÿä¸èƒ½ç›´æ¥è®¿é—®ï¼ˆæ˜ å°„ç±»å‹ä¸ºPROT_READï¼Œåªè¯»æ˜ å°„ï¼‰ã€‚ æ¥æ”¶ç¼“å­˜åŒºæ˜ å°„å¥½åå°±å¯ä»¥åšä¸ºç¼“å­˜æ± æ¥æ”¶å’Œå­˜æ”¾æ•°æ®äº†ã€‚å‰é¢è¯´è¿‡ï¼Œæ¥æ”¶æ•°æ®åŒ…çš„ç»“æ„ä¸ºbinder_transaction_dataï¼Œä½†è¿™åªæ˜¯æ¶ˆæ¯å¤´ï¼ŒçœŸæ­£çš„æœ‰æ•ˆè´Ÿè·ä½äºdata.bufferæ‰€æŒ‡å‘çš„å†…å­˜ä¸­ã€‚è¿™ç‰‡å†…å­˜ä¸éœ€è¦æ¥æ”¶æ–¹æä¾›ï¼Œæ°æ°æ˜¯æ¥è‡ªmmap()æ˜ å°„çš„è¿™ç‰‡ç¼“å­˜æ± ã€‚åœ¨æ•°æ®ä»å‘é€æ–¹å‘æ¥æ”¶æ–¹æ‹·è´æ—¶ï¼Œé©±åŠ¨ä¼šæ ¹æ®å‘é€æ•°æ®åŒ…çš„å¤§å°ï¼Œä½¿ç”¨æœ€ä½³åŒ¹é…ç®—æ³•ä»ç¼“å­˜æ± ä¸­æ‰¾åˆ°ä¸€å—å¤§å°åˆé€‚çš„ç©ºé—´ï¼Œå°†æ•°æ®ä»å‘é€ç¼“å­˜åŒºå¤åˆ¶è¿‡æ¥ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œå­˜æ”¾binder_transaction_dataç»“æ„æœ¬èº«ä»¥åŠè¡¨4ä¸­æ‰€æœ‰æ¶ˆæ¯çš„å†…å­˜ç©ºé—´è¿˜æ˜¯å¾—ç”±æ¥æ”¶è€…æä¾›ï¼Œä½†è¿™äº›æ•°æ®å¤§å°å›ºå®šï¼Œæ•°é‡ä¹Ÿä¸å¤šï¼Œä¸ä¼šç»™æ¥æ”¶æ–¹é€ æˆä¸ä¾¿ã€‚æ˜ å°„çš„ç¼“å­˜æ± è¦è¶³å¤Ÿå¤§ï¼Œå› ä¸ºæ¥æ”¶æ–¹çš„çº¿ç¨‹æ± å¯èƒ½ä¼šåŒæ—¶å¤„ç†å¤šæ¡å¹¶å‘çš„äº¤äº’ï¼Œæ¯æ¡äº¤äº’éƒ½éœ€è¦ä»ç¼“å­˜æ± ä¸­è·å–ç›®çš„å­˜å‚¨åŒºï¼Œä¸€æ—¦ç¼“å­˜æ± è€—ç«­å°†äº§ç”Ÿå¯¼è‡´æ— æ³•é¢„æœŸçš„åæœã€‚ æœ‰åˆ†é…å¿…ç„¶æœ‰é‡Šæ”¾ã€‚æ¥æ”¶æ–¹åœ¨å¤„ç†å®Œæ•°æ®åŒ…åï¼Œå°±è¦é€šçŸ¥é©±åŠ¨é‡Šæ”¾data.bufferæ‰€æŒ‡å‘çš„å†…å­˜åŒºã€‚åœ¨ä»‹ç»Binderåè®®æ—¶å·²ç»æåˆ°ï¼Œè¿™æ˜¯ç”±å‘½ä»¤BC_FREE_BUFFERå®Œæˆçš„ã€‚ é€šè¿‡ä¸Šé¢ä»‹ç»å¯ä»¥çœ‹åˆ°ï¼Œé©±åŠ¨ä¸ºæ¥æ”¶æ–¹åˆ†æ‹…äº†æœ€ä¸ºç¹ççš„ä»»åŠ¡ï¼šåˆ†é…/é‡Šæ”¾å¤§å°ä¸ç­‰ï¼Œéš¾ä»¥é¢„æµ‹çš„æœ‰æ•ˆè´Ÿè·ç¼“å­˜åŒºï¼Œè€Œæ¥æ”¶æ–¹åªéœ€è¦æä¾›ç¼“å­˜æ¥å­˜æ”¾å¤§å°å›ºå®šï¼Œæœ€å¤§ç©ºé—´å¯ä»¥é¢„æµ‹çš„æ¶ˆæ¯å¤´å³å¯ã€‚åœ¨æ•ˆç‡ä¸Šï¼Œç”±äºmmap()åˆ†é…çš„å†…å­˜æ˜¯æ˜ å°„åœ¨æ¥æ”¶æ–¹ç”¨æˆ·ç©ºé—´é‡Œçš„ï¼Œæ‰€æœ‰æ€»ä½“æ•ˆæœå°±ç›¸å½“äºå¯¹æœ‰æ•ˆè´Ÿè·æ•°æ®åšäº†ä¸€æ¬¡ä»å‘é€æ–¹ç”¨æˆ·ç©ºé—´åˆ°æ¥æ”¶æ–¹ç”¨æˆ·ç©ºé—´çš„ç›´æ¥æ•°æ®æ‹·è´ï¼Œçœå»äº†å†…æ ¸ä¸­æš‚å­˜è¿™ä¸ªæ­¥éª¤ï¼Œæå‡äº†ä¸€å€çš„æ€§èƒ½ã€‚é¡ºä¾¿å†æä¸€ç‚¹ï¼ŒLinuxå†…æ ¸å®é™…ä¸Šæ²¡æœ‰ä»ä¸€ä¸ªç”¨æˆ·ç©ºé—´åˆ°å¦ä¸€ä¸ªç”¨æˆ·ç©ºé—´ç›´æ¥æ‹·è´çš„å‡½æ•°ï¼Œéœ€è¦å…ˆç”¨copy_from_user()æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œå†ç”¨copy_to_user()æ‹·è´åˆ°å¦ä¸€ä¸ªç”¨æˆ·ç©ºé—´ã€‚ä¸ºäº†å®ç°ç”¨æˆ·ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„æ‹·è´ï¼Œmmap()åˆ†é…çš„å†…å­˜é™¤äº†æ˜ å°„è¿›äº†æ¥æ”¶æ–¹è¿›ç¨‹é‡Œï¼Œè¿˜æ˜ å°„è¿›äº†å†…æ ¸ç©ºé—´ã€‚æ‰€ä»¥è°ƒç”¨copy_from_user()å°†æ•°æ®æ‹·è´è¿›å†…æ ¸ç©ºé—´ä¹Ÿç›¸å½“äºæ‹·è´è¿›äº†æ¥æ”¶æ–¹çš„ç”¨æˆ·ç©ºé—´ï¼Œè¿™å°±æ˜¯Binderåªéœ€ä¸€æ¬¡æ‹·è´çš„â€˜ç§˜å¯†â€™ã€‚ å‚è€ƒuniversusçš„ä¸“æ  - Android Binderè®¾è®¡ä¸å®ç° - è®¾è®¡ç¯‡Android AIDLç®€ä»‹ä¸ä½¿ç”¨","link":"/2019/08/08/Android/Android-Binder_mechanism_intro/"},{"title":"hexoä¸»é¢˜ä½¿ç”¨ä¸ä¿®æ”¹","text":"æ·»åŠ ä¸€ä¸ªå°å›¾æ ‡å¢åŠ äº†ä¸€ä¸ªæ›´æ–°æ—¥æœŸç±»åˆ«ï¼š updated style.scss æ·»åŠ ä¸€ä¸ªupdatedï¼Œä½¿ç”¨FontAwesome12345678910111213141516171819202122232425262728293031323334353637.post { padding: 25px 0 15px; .post-title { margin: 0; color: #555; text-align: left; font: bold 25px/1.1 &quot;ff-tisa-web-pro&quot;, Cambria, &quot;Times New Roman&quot;, Georgia, Times, sans-serif; a { color: #555; } } .post-meta { padding: 0; margin: 15px 0 0; color: #6E7173; float: left; display: inline; text-indent: .15em; &amp;:before { font-family: &quot;FontAwesome&quot;; content: &quot;\\f073&quot;; padding-right: 0.3em; } .category { &amp;:before { font-family: &quot;FontAwesome&quot;; content: &quot;\\f07c&quot;; padding-right: 0.3em; } } .updated { &amp;:before { font-family: &quot;FontAwesome&quot;; content: &quot;\\f044&quot;; padding-right: 0.3em; } } post.pug ä½¿ç”¨spanï¼Œæ·»åŠ updatedä¿¡æ¯12345678910111213block content .post h1.post-title= page.title .post-meta= page.date.format('ll') if page.categories.length &gt; 0 span= ' | ' span.category for category in page.categories.toArray() a(href=url_for(category.path))= category.name if page.updated span= ' | ' span.updated = page.updated.format('ll') å¦‚æœåœ¨markdownæ–‡ä»¶ä¸­ä¸æ·»åŠ updatedè¿™ä¸ªå€¼ï¼Œé‚£ä¹ˆhexoä¼šè·å–æ–‡ä»¶çš„ä¿®æ”¹æ—¥æœŸï¼Œå¹¶æ¸²æŸ“å‡ºæ¥ã€‚ å‚è€ƒï¼š Font Awesome å‚è€ƒæ‰‹å†Œ https://www.runoob.com/font-awesome/fontawesome-reference.html æ·»åŠ Google Adsenseåœ¨head.pugä¸­æ·»åŠ  123456script(src='https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js', async)script. (adsbygoogle = window.adsbygoogle || []).push({ google_ad_client: &quot;ca-pub-7286632197002340&quot;, enable_page_level_ads: true }); æ·»åŠ ä¾§è¾¹æ æ·»åŠ ä¸€ä¸ªå¾®ä¿¡å…¬ä¼—å·çš„ä¾§è¾¹æ å±•ç¤º ä¸»é¢˜layout/_widgetä¸­æ·»åŠ qr_code.pug1234.widget .widget-title i(class='fa fa-weixin')= ' ' + __('å¾®ä¿¡å…¬ä¼—å·') img(src='http://rustblogres.rustfisher.com/qrcode_for_rf_dev_gzh_258.jpg') _config.ymlä¸­æ·»åŠ  qr_code123widgets: # å‰é¢çš„ç»„å»º - qr_code æ›´æ”¹å½’æ¡£ç•Œé¢çš„é“¾æ¥ä¸ªæ•°åœ¨å·¥ç¨‹çš„é…ç½®æ–‡ä»¶_config.ymlé‡Œä¿®æ”¹ 123456789101112131415161718# Pagination## Set per_page to 0 to disable paginationpagination_dir: pageindex_generator: per_page: 15 order_by: -datecategory_generator: per_page: 15tag_generator: per_page: 10archive_generator: per_page: 30 yearly: true monthly: true daily: false æ–‡ç« ç½®é¡¶åŠç½®é¡¶æ ‡ç­¾é¦–å…ˆæ›´æ¢ä¸€ä¸‹generator12$ npm uninstall hexo-generator-index --save$ npm install hexo-generator-index-pin-top --save å†åˆ°themes/maupassanté‡Œï¼ŒæŸ¥æ‰¾.post-metaï¼Œå¹¶ä¸”åœ¨ä¸‹é¢æ·»åŠ topçš„åˆ¤æ–­ã€‚12345.post-meta= post.date.format(config.date_format) if post.top span.post-top-icon i(class=&quot;fa fa-thumb-tack&quot;) span.post-meta-item-text=&quot; ç½®é¡¶&quot; åœ¨æ–‡ç« å¼€å¤´çš„Front-matterä¸­åŠ ä¸Štop: trueå³å¯ã€‚ æŠ¥é”™å¤§æ‹¬å·æŠ¥é”™mdä¸­å‡ºç°å½¢å¦‚ å¤§æ‹¬å·å¤§æ‹¬å· çš„æ—¶å€™ï¼Œç¼–è¯‘ä¼šæŠ¥é”™ã€‚ fluidä¸»é¢˜é…ç½®leancloudè¯„è®ºä¸pvç»Ÿè®¡ä½¿ç”¨fluidï¼Œé…ç½®leancloudè¯„è®ºå’Œpvçš„æ—¶å€™ æ£€æŸ¥ç”Ÿæˆçš„ç½‘é¡µå‘ç°leancloudé‡Œçš„app_idæ˜¯ç©ºçš„ã€‚1&quot;leancloud&quot;:{&quot;app_id&quot;:null,&quot;app_key&quot;:null,&quot;server_url&quot;:null,&quot;appid&quot;:&quot;xxx&quot;,&quot;appkey&quot;:&quot;yyy&quot;}æ„è¯†åˆ°è¯„è®ºå’Œpvç»Ÿè®¡åœ¨é…ç½®ä¸Šä¸åŒï¼Œè¯„è®ºç”¨çš„æ˜¯appidã€‚pvç»Ÿè®¡ç”¨çš„æ˜¯app_idã€‚ é…ç½®åº”è¯¥å†™æˆè¿™æ ·12345678910111213141516171819202122232425web_analytics: # ç½‘é¡µè®¿é—®ç»Ÿè®¡ enable: true leancloud: # LeanCloud è®¡æ•°ç»Ÿè®¡ï¼Œå¯ç”¨äº PV UV å±•ç¤ºï¼Œå¦‚æœ web_analytics.enable æ²¡æœ‰å¼€å¯ï¼ŒPV UV å±•ç¤ºåªä¼šæŸ¥è¯¢ï¼Œä¸ä¼šå¢åŠ  app_id: xxx ## æ³¨æ„è¿™é‡Œçš„keyå†™æ³• app_key: yyy ## æ³¨æ„è¿™é‡Œçš„keyå†™æ³•# ...# æ–‡ç« çš„é…ç½®post: comments: enable: true type: valine meta: views: # é˜…è¯»æ¬¡æ•° enable: true source: leancloud # ç»Ÿè®¡æ•°æ®æ¥æºï¼Œå¯é€‰ï¼šleancloud | busuanzi æ³¨æ„ä¸è’œå­ä¼šé—´æ­‡æŠ½é£ format: &quot;{} æ¬¡&quot;valine: enable: true ## if you want to use Valine comment system, please set the value to true appid: ddddd ## æ³¨æ„è¿™é‡Œçš„keyï¼Œæ²¡æœ‰ä¸‹åˆ’çº¿ your leancloud application appid appkey: aaaaa ## æ³¨æ„è¿™é‡Œçš„keyï¼Œæ²¡æœ‰ä¸‹åˆ’çº¿ your leancloud application appkey placeholder: è¾“å…¥è¯„è®º... ## comment input placeholder text avatar: 'mp' ## header image https://github.com/xCss/Valine/wiki","link":"/2019/08/06/Web/hexo-themes_use/"},{"title":"ã€ŒPhoneInfoã€å¼€å‘è®°å½•","text":"å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸€äº›ä½é¢‘ä½¿ç”¨çš„APIä¸å¤ªè®°å¾—ï¼Œæ¯æ¬¡éƒ½è¦æŸ¥ä¸€ä¸‹ã€‚æ¯”å¦‚Buildè¿™ä¸ªç±»ã€‚åšä¸€ä¸ªappï¼Œä¸€è¾¹æ˜¾ç¤ºä»£ç ï¼Œä¸€è¾¹æ˜¾ç¤ºç»“æœï¼Œå²‚ä¸ç¾å“‰ã€‚ å‘å¸ƒåœ°å€ PhoneInfo - é…·å®‰ PhoneInfo - PlayStore é¡µé¢å¸ƒå±€ViewPager + TabLayout æ‰¿è½½å¤šä¸ªfragmentï¼Œæ˜¾ç¤ºä¸åŒçš„ä¿¡æ¯ã€‚ TabLayoutå­—ä½“å¤§å°æ”¹å°ä¸€ç‚¹ã€‚ style.xmlé‡Œå¢åŠ 123456789&lt;style name=&quot;DashPageTabText&quot; parent=&quot;TextAppearance.AppCompat.Button&quot;&gt; &lt;item name=&quot;android:textSize&quot;&gt;10sp&lt;/item&gt;&lt;/style&gt;&lt;style name=&quot;DashPageTabLayout&quot; parent=&quot;Widget.Design.TabLayout&quot;&gt; &lt;item name=&quot;tabTextAppearance&quot;&gt;@style/DashPageTabText&lt;/item&gt; &lt;!--&lt;item name=&quot;tabSelectedTextColor&quot;&gt;SELECTED TAB TEXT COLOR&lt;/item&gt;--&gt; &lt;!--&lt;item name=&quot;tabIndicatorColor&quot;&gt;SELECTED TAB INDICATOR COLOR&lt;/item&gt;--&gt;&lt;/style&gt; tabLayoutä¸­å¢åŠ style12345&lt;com.google.android.material.tabs.TabLayout android:id=&quot;@+id/dash_page_tabs&quot; style=&quot;@style/DashPageTabLayout&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;40dp&quot; /&gt; å‚è€ƒ https://stackoverflow.com/questions/31471177/text-size-of-android-design-tablayout-tabs æˆ–è€…è®¾ç½®é€‰ä¸­å’Œæœªé€‰ä¸­tabæ—¶æ–‡å­—çš„é¢œè‰²ï¼Œè®¾ç½®tabå¯ä»¥æ»šåŠ¨12345678&lt;com.google.android.material.tabs.TabLayout android:id=&quot;@+id/dash_page_tabs&quot; style=&quot;@style/DashPageTabLayout&quot; android:layout_width=&quot;wrap_content&quot; android:layout_height=&quot;40dp&quot; app:tabMode=&quot;scrollable&quot; app:tabSelectedTextColor=&quot;#000&quot; app:tabTextColor=&quot;#99222222&quot; /&gt; TabLayout ViewPager è”åŠ¨DashPagerAdapterç±»ã€‚123456789101112131415161718192021222324252627282930313233import android.view.View;import androidx.annotation.NonNull;import androidx.fragment.app.Fragment;import androidx.fragment.app.FragmentManager;import androidx.fragment.app.FragmentPagerAdapter;public class DashPagerAdapter extends FragmentPagerAdapter { private int fragCount; // è£…ç€fragment public DashPagerAdapter(FragmentManager fm, int count) { super(fm); fragCount = count; } @Override public int getCount() { return fragCount; } @Override public Fragment getItem(int position) { return // è¿”å›å¯¹åº”çš„fragment; } @Override public boolean isViewFromObject(@NonNull View view, @NonNull Object object) { return super.isViewFromObject(view, object); }} onCreateé‡Œåˆå§‹åŒ–12345678910111213141516171819202122232425262728293031mTabLayout = findViewById(R.id.dash_page_tabs);mViewPager = findViewById(R.id.dash_page_vp);mTabLayout.addTab(mTabLayout.newTab().setText(&quot;Build&quot;));mTabLayout.addTab(mTabLayout.newTab().setText(&quot;Screen&quot;));mTabLayout.addTab(mTabLayout.newTab().setText(&quot;WiFi&quot;));mTabLayout.addTab(mTabLayout.newTab().setText(&quot;ext-Storage&quot;));mTabLayout.addTab(mTabLayout.newTab().setText(&quot;app-Storage&quot;));mTabLayout.addTab(mTabLayout.newTab().setText(&quot;uri&quot;));mTabLayout.addTab(mTabLayout.newTab().setText(&quot;battery&quot;));mDashPagerAdapter = new DashPagerAdapter(getSupportFragmentManager(), mTabLayout.getTabCount());mViewPager.setAdapter(mDashPagerAdapter);mViewPager.addOnPageChangeListener(new TabLayout.TabLayoutOnPageChangeListener(mTabLayout));mTabLayout.addOnTabSelectedListener(new TabLayout.OnTabSelectedListener() { @Override public void onTabSelected(TabLayout.Tab tab) { final int pos = tab.getPosition(); mViewPager.setCurrentItem(pos); } @Override public void onTabUnselected(TabLayout.Tab tab) { } @Override public void onTabReselected(TabLayout.Tab tab) { }}); Buildç±»æ¯”å¦‚è¿™æ · 1234567891011if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O &amp;&amp; PackageManager.PERMISSION_GRANTED == ContextCompat.checkSelfPermission(this, Manifest.permission.READ_PHONE_STATE)) { mInfoReAdapter.addOrUpdate(K_SERIAL, &quot;Build.getSerial()&quot;, Build.getSerial());} else { mInfoReAdapter.addOrUpdate(Build.SERIAL, &quot;Build.SERIAL&quot;, Build.SERIAL);}mInfoReAdapter.addOrUpdate(&quot;Build.getRadioVersion()&quot;, &quot;Build.getRadioVersion()&quot;, Build.getRadioVersion());mInfoReAdapter.addOrUpdate(&quot;Build.ID &quot;, &quot;Build.ID&quot;, Build.ID);// ....mInfoReAdapter.addOrUpdate(&quot;Build.USER &quot;, &quot;Build.USER&quot;, Build.USER);mInfoReAdapter.notifyDataSetChanged(); å±å¹•ä¿¡æ¯è·å–å±å¹•å®½é«˜ã€‚è·å–å±å¹•å®½é«˜çš„æ–¹æ³•å¤§çº¦æœ‰3ç§ï¼Œè¿™é‡Œç›´æ¥ç”¨view.post(runnable)çš„æ–¹å¼æ¥è·å–å®é™…å®½é«˜ã€‚ 12345678910final View root = findViewById(R.id.container);root.post(new Runnable() { @Override public void run() { final int wid = root.getWidth(); final int height = root.getHeight(); Log.d(TAG, &quot;phone screen size [&quot; + wid + &quot;, &quot; + height + &quot;]&quot;); mDashPagerAdapter.setPhoneScreenSize(wid, height); }}); æŠŠåƒç´ è½¬æ¢æˆdp 123float pxToDp(int px) { return (px / Resources.getSystem().getDisplayMetrics().density);} å­˜å‚¨è·¯å¾„ä¿¡æ¯æ¯”å¦‚è·å–åˆ°å¤–éƒ¨å­˜å‚¨çš„è·¯å¾„ç­‰ç­‰ã€‚ 12mInfoReAdapter.addOrUpdateUpDown(&quot;root&quot;, &quot;Environment.getRootDirectory().getAbsolutePath()&quot;, Environment.getRootDirectory().getAbsolutePath()); Uriç±»ä¿¡æ¯å±•ç¤ºUriç±»çš„ä¸€äº›ä¿¡æ¯ã€‚ 1Uri uri = Uri.fromFile(getActivity().getApplicationContext().getFilesDir()); crash java.lang.ClassNotFoundExceptionGoogle play console æ”¶é›†åˆ°çš„crashä¿¡æ¯ã€‚å´©æºƒæœºå‹æ˜¯åä¸ºå’Œä¸‰æ˜Ÿã€‚ Galaxy A40 (a40)ï¼Œ Note9 (crownlte)ï¼Œ A70 (a70q)ï¼Œ Note8 (greatlte)ï¼›Mate 10 Pro (HWBLA) 1234567891011121314151617java.lang.RuntimeException: at android.app.ActivityThread.handleReceiver (ActivityThread.java:3586) at android.app.ActivityThread.access$1300 (ActivityThread.java:240) at android.app.ActivityThread$H.handleMessage (ActivityThread.java:1808) at android.os.Handler.dispatchMessage (Handler.java:106) at android.os.Looper.loop (Looper.java:214) at android.app.ActivityThread.main (ActivityThread.java:7094) at java.lang.reflect.Method.invoke (Native Method) at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run (RuntimeInit.java:494) at com.android.internal.os.ZygoteInit.main (ZygoteInit.java:975)Caused by: java.lang.ClassNotFoundException: at dalvik.system.BaseDexClassLoader.findClass (BaseDexClassLoader.java:134) at java.lang.ClassLoader.loadClass (ClassLoader.java:379) at java.lang.ClassLoader.loadClass (ClassLoader.java:312) at android.app.AppComponentFactory.instantiateReceiver (AppComponentFactory.java:84) at androidx.core.app.CoreComponentFactory.instantiateReceiver (CoreComponentFactory.java:56) at android.app.ActivityThread.handleReceiver (ActivityThread.java:3579) æ ¹æ®ActivityThread.handleReceiverçŒœæµ‹ï¼Œæœ‰ä¸€ä¸ªå¹¿æ’­æ¥æ”¶å™¨ç¤ºä¾‹åŒ–å¤±è´¥äº†ã€‚åº”ç”¨é‡Œåªæœ‰ä¸€ä¸ªåŠ¨æ€æ³¨å†Œçš„å¹¿æ’­æ¥æ”¶å™¨ã€‚åº”è¯¥æ˜¯æ³¨å†Œå¤±è´¥äº†ã€‚æ‰‹å¤´ä¸Šæ²¡æœ‰ä¸‰æ˜Ÿå’Œåä¸ºã€‚æš‚æ—¶æ²¡æ³•é‡ç°ã€‚ æ›´æ–°è®°å½• [1.1.4] 2020-1-7 ä½¿ç”¨æ–°çš„UIæ ·å¼ [1.1.1] 2019-11-10 ä¿®æ”¹ç”µæ± å¹¿æ’­æ¥æ”¶å™¨çš„ä¿¡æ¯ç±»å‹ [1.0.9] 2019-9-14 ä¿®æ”¹ui [1.0.8] 2019-9-13 å¢åŠ äº†Uriç±»çš„ä¿¡æ¯ [1.0.6] 2019-9-4 å¢åŠ äº†Environmentç±»çš„ä¿¡æ¯ ä¿®å¤äº†å®šä½æƒé™å¯¹Wi-Fiä¿¡æ¯ç•Œé¢çš„å½±å“ 2019-8-17 å¢åŠ äº†å±å¹•å°ºå¯¸ä¿¡æ¯ é‡‡ç”¨ViewPager + TabLayoutæ˜¾ç¤ºå¤šä¸ªé¡µé¢","link":"/2019/08/06/Dev-note/dev-note-app-PhoneInfo/"},{"title":"ã€ŒSDç¼–è¾‘ã€å¼€å‘è®°å½•","text":"SD - Slam Dumpï¼ˆå¹¶ä¸æ˜¯ï¼‰ è¿™ä¸ªAppçš„ä¸»è¦ç›®çš„æ˜¯æ»¡è¶³å¹¿å¤§äººæ°‘ç¾¤ä¼—å¯¹å›¾ç‰‡ç¼–è¾‘çš„éœ€æ±‚ã€‚ å­—ä½“é—®é¢˜Androidé»˜è®¤çš„å­—ä½“ä¸å¤ªå¥½çœ‹ï¼Œä¹Ÿä¸ä¸€å®šèƒ½å¾ˆå¥½åœ°åŒ¹é…èƒŒæ™¯å›¾ã€‚å¦‚æœå†…ç½®å­—ä½“ï¼Œé‡åˆ°æœ€å¤§çš„é—®é¢˜æ˜¯ç‰ˆæƒé—®é¢˜ã€‚å› æ­¤å†³å®šå¢åŠ ç”¨æˆ·è‡ªè¡Œå¯¼å…¥å­—ä½“çš„åŠŸèƒ½ï¼Œç”±ç”¨æˆ·æ¥å†³å®šä½¿ç”¨ä»€ä¹ˆå­—ä½“ã€‚ åŸæ¥çš„å­—ä½“æ–‡ä»¶æ˜¯æ”¾åœ¨assetä¸­ã€‚Typeface.createFromAssetç›´æ¥å¼•å…¥å¹¶ä½¿ç”¨ã€‚12Typeface tf = Typeface.createFromAsset(mgr, &quot;fonts/fz_grid.ttf&quot;);mContentTv.setTypeface(tf); è®¾è®¡ä¸€ä¸ªå­—ä½“ç®¡ç†ç•Œé¢ã€‚ç”¨æˆ·è‡ªè¡Œé€‰æ‹©å°†å­—ä½“æ–‡ä»¶å¤åˆ¶åˆ°Appå†…éƒ¨å­˜å‚¨è·¯å¾„ã€‚ä½¿ç”¨å­—ä½“æ—¶ï¼Œå†ç”¨Typeface.createFromFile()è·å–Typefaceã€‚ é€‰æ‹©æ–‡ä»¶è°ƒç”¨ç³»ç»Ÿæ–‡ä»¶é€‰æ‹©å™¨1234567891011121314151617181920212223242526272829303132private static final int REQ_CODE_CHOOSE_FILE = 10; // å¯åŠ¨é€‰æ‹©æ–‡ä»¶... Intent intent = new Intent(Intent.ACTION_GET_CONTENT); intent.setType(&quot;*/*&quot;); startActivityForResult(intent, REQ_CODE_CHOOSE_FILE); // ...... // å¤„ç†é€‰æ‹©çš„æ–‡ä»¶ @Override protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) { switch (requestCode) { case REQ_CODE_CHOOSE_FILE: if (data != null) { Uri uri = data.getData(); Log.d(TAG, &quot;onActivityResult: uri: &quot; + uri); if (uri != null &amp;&amp; !TextUtils.isEmpty(uri.getPath())) { copyFile(uri); } else { Log.e(TAG, &quot;onActivityResult: é€‰æ‹©çš„æ–‡ä»¶æ— æ•ˆ&quot;); } } else { showShort(getApplicationContext(), &quot;æ²¡é€‰ä¸­æ–‡ä»¶&quot;); Log.e(TAG, &quot;onActivityResult: data is NULL æ²¡é€‰ä¸­æ–‡ä»¶&quot;); } break; default: super.onActivityResult(requestCode, resultCode, data); break; } } å¤„ç†uriuriå½¢å¦‚ content://com.android.externalstorage.documents/document/primary%3ADownload%2Ffz_grid.ttf uri.getPathè·å–åˆ°çš„å¹¶ä¸æ˜¯æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚ä½†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ContentResolveræ¥è·å–åˆ°InputStreamã€‚ä¹Ÿå¯ä»¥è·å–åˆ°uriçš„æ–‡ä»¶åã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940private void copyFile(final Uri uri) { mAddIv.setClickable(false); Animation rotate = AnimationUtils.loadAnimation(getApplicationContext(), R.anim.rotate_scan); rotate.setDuration(400); mAddIv.startAnimation(rotate); new Thread(new Runnable() { @Override public void run() { try { Cursor cursor = getContentResolver().query(uri, null, null, null, null); int nameIndex = cursor.getColumnIndex(OpenableColumns.DISPLAY_NAME); cursor.moveToFirst(); String name = cursor.getString(nameIndex); cursor.close(); InputStream fis = getContentResolver().openInputStream(uri); File outputFile = new File(TypefaceStore.getStorePath(getApplicationContext()), name); if (outputFile.exists()) { boolean d = outputFile.delete(); Log.d(TAG, &quot;åˆ é™¤æ—§æ–‡ä»¶: &quot; + d); } boolean n = outputFile.createNewFile(); Log.d(TAG, &quot;copyFile: æ–°å»ºæ–‡ä»¶ &quot; + n); FileOutputStream fos = new FileOutputStream(outputFile); byte[] tmp = new byte[2048]; int i; while ((i = fis.read(tmp)) != -1) { fos.write(tmp, 0, i); } fos.flush(); fos.close(); fis.close(); } catch (Exception e) { Log.e(TAG, &quot;copyFile ERROR:&quot;, e); } } }).start();} ä¹Ÿå¯ä»¥ç®€å•åœ°ä½¿ç”¨uri.getLastPathSegmentæ¥è·å–æ–‡ä»¶å123uri.getLastPathSegment();String[] t = uriPath.split(File.separator);String name = t[t.length - 1]; https://stackoverflow.com/questions/4263002/how-to-get-file-name-from-uri Toolbaré—®é¢˜ä½¿ç”¨toolbaræ—¶ç»å¸¸ä¼šé‡åˆ°é—®é¢˜ã€‚ä¾‹å¦‚è®¾ç½®titleçš„é—®é¢˜ã€‚ è¿™é‡Œè‡ªå·±åˆ›å»ºä¸€ä¸ªç»Ÿä¸€çš„æ ‡é¢˜æ TitleBarã€‚æƒ³è¦ä»€ä¹ˆæ§ä»¶è‡ªå·±æ·»åŠ ã€‚ Google MobileAdsMobileAds.initialize(getApplicationContext(), AdsMgr.GOOGLE_ADS_APP_ID);çš„æ‰§è¡Œä¼šå ç”¨å¾ˆå¤šæ—¶é—´ã€‚æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°å°ç±³æ‰‹æœºç”šè‡³ä½¿ç”¨äº†3ç§’é’Ÿæ¥æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚ https://stackoverflow.com/questions/37418663/what-is-the-proper-way-to-call-mobileads-initialize ç»™å¯åŠ¨é¡µActivityä¸€ä¸ªçº¯è‰²çš„å¯åŠ¨èƒŒæ™¯ã€‚12345&lt;style name=&quot;AppTheme.NoActionBar&quot;&gt; &lt;item name=&quot;windowActionBar&quot;&gt;false&lt;/item&gt; &lt;item name=&quot;windowNoTitle&quot;&gt;true&lt;/item&gt; &lt;item name=&quot;android:windowBackground&quot;&gt;@color/colorPrimary&lt;/item&gt;&lt;/style&gt; å¯åŠ¨é¡µä¸­åˆå§‹åŒ–Adsæ—¶å®åœ¨æ˜¯è€—æ—¶å¤ªé•¿ï¼Œå¹²è„†æ”¾åˆ°å­çº¿ç¨‹ä¸­å»æ“ä½œã€‚è™½ç„¶å®˜æ–¹æ–‡æ¡£å»ºè®®çš„æ˜¯è¶Šæ—©åˆå§‹åŒ–è¶Šå¥½ã€‚ä½†ä¹Ÿä¸å¸Œæœ›å¤ªå½±å“ç”¨æˆ·ä½“éªŒã€‚ é€’å½’æŸ¥çœ‹æŸä¸ªè·¯å¾„ä¸‹çš„æ–‡ä»¶12345678910111213141516 private static void treeDir(File dir, int level) { StringBuilder sb = new StringBuilder(); for (int i = 0; i &lt; level; i++) { sb.append(&quot;-&quot;); } sb.append(&quot; &quot;); if (dir.isDirectory()) {// LL.d(TAG, sb.toString() + dir.getName()); level++; for (File f : dir.listFiles()) { treeDir(f, level); } } else {// LL.d(TAG, sb.toString() + dir.getName()); } } æä¾›è‰ç¨¿åŠŸèƒ½ä¸ºæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ï¼Œæä¾›è‰ç¨¿åŠŸèƒ½ã€‚è¿™å°±æ¶‰åŠåˆ°å¢åˆ æŸ¥æ”¹çš„æ“ä½œã€‚ [2019-7-31] æœ¬æ¥æƒ³ç›´æ¥ç”¨sqliteï¼Œä½†ä¸ºäº†å¼€å‘æ–¹ä¾¿ï¼Œé€‰ç”¨äº†greenDAOã€‚ https://github.com/greenrobot/greenDAO ä½¿ç”¨2ä¸ªè¡¨ï¼Œåˆ†åˆ«ä¸ºDraftï¼ˆå­˜æ¡£ï¼‰å’ŒDraftContentï¼ˆå›¾å±‚ï¼‰ã€‚DraftContentä¸­å­˜æ”¾ç€å…³è”çš„å­˜æ¡£IDã€‚ èƒ½ä¿å­˜çš„ä¸œè¥¿éƒ½ä¿å­˜ä¸‹æ¥ã€‚ greendaoæ’å…¥å…ƒç´ 1234567Draft draft1 = genDraft(&quot;ç¤ºä¾‹1&quot;, p1Path);Draft draft2 = genDraft(&quot;ç¤ºä¾‹2&quot;, p2Path);Draft draft3 = genDraft(&quot;ç¤ºä¾‹3&quot;, p3Path);Log.d(TAG, &quot;addDemoDraft: id: &quot; + draft1.getDraftId() + &quot;,&quot; + draft3.getDraftId());daoSession.insert(draft1);daoSession.insert(draft2);daoSession.insert(draft3); æ’å…¥å…ƒç´ åå°±æœ‰idäº†ã€‚ greendaoåˆ é™¤å…ƒç´ 1234567891011DraftDao draftDao = daoSession.getDraftDao();DraftContentDao draftContentDao = daoSession.getDraftContentDao();for (Draft d : drafts) { Log.d(TAG, &quot;åˆ é™¤ &quot; + d.getName()); draftDao.queryBuilder() .where(DraftDao.Properties.DraftId.eq(d.getDraftId())).buildDelete() .executeDeleteWithoutDetachingEntities(); draftContentDao.queryBuilder() .where(DraftContentDao.Properties.RelativeDraftId.eq(d.getDraftId())).buildDelete() .executeDeleteWithoutDetachingEntities();} ä½¿ç”¨DrawerLayoutæŠ¥é”™ï¼š IllegalArgumentException: No drawer view found with gravity LEFT 123java.lang.IllegalArgumentException: No drawer view found with gravity LEFT at androidx.drawerlayout.widget.DrawerLayout.openDrawer(DrawerLayout.java:1736) at androidx.drawerlayout.widget.DrawerLayout.openDrawer(DrawerLayout.java:1722) å¿˜è®°ä¸­xmlä¸­åŠ ä¸Šå¼€æŠ½å±‰æ–¹å‘äº† tools:openDrawer=â€startâ€12345678&lt;androidx.drawerlayout.widget.DrawerLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot; xmlns:tools=&quot;http://schemas.android.com/tools&quot; android:id=&quot;@+id/main_page_root&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot; android:orientation=&quot;vertical&quot; tools:context=&quot;.act.MainActivity&quot; tools:openDrawer=&quot;start&quot;&gt; æŠ½å±‰åŠ ä¸Šæ–¹å‘ android:layout_gravity=â€startâ€1234567&lt;!-- æŠ½å±‰ --&gt;&lt;LinearLayout android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;match_parent&quot; android:layout_gravity=&quot;start&quot; android:layout_marginEnd=&quot;100dp&quot; android:orientation=&quot;vertical&quot;&gt; ç¾æœ¯è®¾è®¡ï¼ŒAppäº¤äº’è®¾è®¡è®¾è®¡æ˜¯ä¸€ä¸ªæ¯”è¾ƒä»¤æˆ‘å¤´ç–¼çš„é—®é¢˜ã€‚åœ¨è¿™ä¸ªçœ‹è„¸çš„æ—¶ä»£ï¼ŒAppä¸€å®šè¦å¥½çœ‹ï¼å¯¹æˆ‘è€Œè¨€ï¼Œç›´æ¥é‡‡ç”¨material designçš„é£æ ¼ä¼šæ¯”è¾ƒçœäº‹ã€‚ç»è¿‡è°ƒæ•´å’Œå¯¹æ¯”ï¼Œæˆ‘é€‰æ‹©ä½¿ç”¨æš—è‰²çš„é£æ ¼ã€‚å› ä¸ºç°åœ¨ä¸»æµçš„å›¾å½¢ç¼–è¾‘è½¯ä»¶ï¼Œé¢œè‰²é£æ ¼ä»¥æš—è‰²å±…å¤šã€‚ å‚è€ƒï¼š çœ‹é¢œè‰²ç¤ºä¾‹ https://material.io/design/color/applying-color-to-ui.html#sheets-surfaces æŸ¥é¢œè‰² https://material-ui.com/customization/color/ æ–‡å­—ç¼–è¾‘æ–‡å­—å†…å®¹ï¼Œå¤§å°ï¼Œæ—‹è½¬æ–¹å‘ï¼Œé¢œè‰²éƒ½å¯ä»¥è°ƒæ•´ã€‚ éœ€è¦ä¸€ä¸ªè°ƒè‰²ç›˜æ¥è°ƒæ•´é¢œè‰²ã€‚æ‰¾ä¸ªç¬¬ä¸‰æ–¹çš„ï¼Œå¥½çœ‹èƒ½ç”¨å³å¯ã€‚ åˆ é™¤å­˜æ¡£æŠ¥é”™listç±»çš„ç»å…¸å¼‚å¸¸ ConcurrentModificationExceptionã€‚ 12java.util.ConcurrentModificationException at java.util.ArrayList$Itr.next(ArrayList.java:860) liståˆ é™¤å…ƒç´ æ—¶æŠ¥é”™ã€‚è¿™æ ·å†™æ˜¯ä¸è¡Œçš„ã€‚12345for (Data d : dataList) { if (d.selected) { dataList.remove(d); }} ç”¨è¿­ä»£å™¨æ¥åˆ é™¤å…ƒç´ ã€‚1234567Iterator&lt;Data&gt; iterator = dataList.iterator();while (iterator.hasNext()) { Data data = iterator.next(); if (data.selected) { iterator.remove(); }} è¾“å‡ºå›¾ç‰‡ä¿å­˜Viewçš„æ˜¾ç¤ºå†…å®¹è·å–ä¸€ä¸ªviewçš„bitmapï¼Œç„¶åä¿å­˜åˆ°æ–‡ä»¶å»ã€‚ 12345678910111213141516171819202122232425262728293031323334/** * è·å–ä¸€ä¸ª View çš„ç¼“å­˜è§†å›¾ */private Bitmap getCacheBitmapFromView(View view) { final boolean drawingCacheEnabled = true; view.setDrawingCacheEnabled(drawingCacheEnabled); view.buildDrawingCache(drawingCacheEnabled); final Bitmap drawingCache = view.getDrawingCache(); Bitmap bitmap; if (drawingCache != null) { bitmap = Bitmap.createBitmap(drawingCache); view.setDrawingCacheEnabled(false); } else { bitmap = null; } return bitmap;}public static boolean saveBitmapFile(Bitmap bitmap, String fileAbsPath) { File file = new File(fileAbsPath); // å°†è¦ä¿å­˜å›¾ç‰‡çš„è·¯å¾„ try { if (file.exists()) { file.delete(); } BufferedOutputStream bos = new BufferedOutputStream(new FileOutputStream(file)); bitmap.compress(Bitmap.CompressFormat.JPEG, 100, bos); bos.flush(); bos.close(); } catch (IOException e) { e.printStackTrace(); return false; } return true;} ä¿å­˜å›¾ç‰‡æ–‡ä»¶åçš„å¤„ç†ç”¨æˆ·è¾“å‡ºå›¾ç‰‡æ–‡ä»¶åï¼Œæ‰“å¼€å¾®ä¿¡æƒ³å‘é€è¿™å¼ å›¾ç‰‡ã€‚ä½†æ˜¯ç”¨æˆ·å‘ç°å¾®ä¿¡çš„å¿«æ·å‘é€åŠŸèƒ½æ‰¾ä¸åˆ°è¿™å¼ å›¾ç‰‡ã€‚æ€ä¹ˆæ‰èƒ½è®©å¾®ä¿¡çŸ¥é“è¿™é‡Œæ–°å¢äº†ä¸€å¼ å›¾ç‰‡å‘¢ï¼Ÿ å¦‚æœè¦å‘é€å¹¿æ’­ACTION_MEDIA_MOUNTED 1sendBroadcast(new Intent(Intent.ACTION_MEDIA_MOUNTED, Uri.fromFile(outputFile))); æŠ¥é”™ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„æƒé™ 1java.lang.SecurityException: Permission Denial: not allowed to send broadcast android.intent.action.MEDIA_MOUNTED Android KKå¼€å§‹ï¼Œè¿™ä¸ªå¹¿æ’­å¼€å§‹åªèƒ½ç”±ç³»ç»Ÿå‘å‡ºã€‚KKåŠä¹‹åçš„ç‰ˆæœ¬éœ€ä½¿ç”¨Intent.ACTION_MEDIA_SCANNER_SCAN_FILE 12File outputFile = new File(filePath);sendBroadcast(new Intent(Intent.ACTION_MEDIA_SCANNER_SCAN_FILE, Uri.fromFile(outputFile))); å‚è€ƒ https://stackoverflow.com/questions/24072489/java-lang-securityexception-permission-denial-not-allowed-to-send-broadcast-an ç§»åŠ¨TextViewç¼–è¾‘é¡µä¸­æœ‰ä¸€ä¸ªéœ€æ±‚æ˜¯æ‰‹æŒ‡æ‹–åŠ¨æ–‡å­—ã€‚ 1.1.xç‰ˆæœ¬1.1.0ç‰ˆæœ¬çš„åšæ³•æ˜¯ï¼Œåœ¨Activityçš„onTouchæ–¹æ³•é‡Œæ¥æ”¹å˜TextViewçš„åæ ‡ã€‚ä»è€Œå®ç°TextViewçš„æ‹–åŠ¨æ•ˆæœã€‚çˆ¶Viewå’Œå­Viewè®¾åŒä¸€ä¸ªOnTouchListenerã€‚ä½†æ˜¯åªæœ‰çˆ¶viewæ¥å¤„ç†è§¦æ‘¸äº‹ä»¶ã€‚å¦‚æœæ˜¯å­viewæ¥æ”¶åˆ°äº†è§¦æ‘¸äº‹ä»¶ï¼Œåˆ™åšä¸€ä¸ªboolæ ‡è®°firstOnTv = trueï¼Œè¿”å›falseï¼ŒæŠŠè§¦æ‘¸äº‹ä»¶äº¤ç»™çˆ¶viewæ¥å¤„ç†ã€‚çˆ¶viewå¤„ç†è§¦æ‘¸äº‹ä»¶æ—¶ï¼Œåˆ¤æ–­å¦‚æœåˆšæ‰ç‚¹ä¸­çš„æ˜¯å­viewï¼ˆå³mContentTvï¼‰ï¼Œåˆ™åœ¨MotionEvent.ACTION_MOVEæ—¶æ›´æ”¹å­viewçš„åæ ‡ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152 private View.OnTouchListener mWsOnTouchListener = new View.OnTouchListener() { boolean firstOnTv = false; // æœ€å¼€å§‹ç‚¹ä¸­çš„æ˜¯tv float originTvX; // tvæœ€å¼€å§‹çš„åæ ‡ float originTvY; float downX; float downY; @Override public boolean onTouch(View v, MotionEvent event) { final int id = v.getId();// Log.d(TAG, &quot;onTouch: touch tv: &quot; + (id == mContentTv.getId()) + &quot;, touch ws: &quot; + (id == mWorkspaceField.getId())); float x = event.getX(); float y = event.getY();// Log.d(TAG, &quot;onTouch: [&quot; + x + &quot;, &quot; + y + &quot;] , &quot; + event); if (event.getAction() == MotionEvent.ACTION_DOWN) { mSaveIv.setEnabled(true); if (id == mContentTv.getId()) { firstOnTv = true; originTvX = mContentTv.getX(); originTvY = mContentTv.getY();// Log.d(TAG, &quot;onTouch: ä¿å­˜tvåæ ‡ (&quot; + originTvX + &quot;, &quot; + originTvY + &quot;)&quot;); } downX = event.getX(); downY = event.getY();// Log.d(TAG, &quot;onTouch: down: x,y [&quot; + x + &quot;, &quot; + y + &quot;]&quot;); return id != mContentTv.getId(); } else if (event.getAction() == MotionEvent.ACTION_MOVE) {// Log.d(TAG, &quot;onTouch: move: x,y [&quot; + x + &quot;, &quot; + y + &quot;]&quot;); if (!firstOnTv) { return true; // ä¸ç§»åŠ¨tvï¼Œç›´æ¥æ¶ˆè€—æ‰è¿™ä¸ªæ“ä½œ } float dx = x - downX; float dy = y - downY; if (Math.abs(dx) &gt; 2 &amp;&amp; Math.abs(dy) &gt; 2) { mContentTv.setX(originTvX + dx); mContentTv.setY(originTvY + dy); } return true; } else if (event.getAction() == MotionEvent.ACTION_UP) { firstOnTv = false; if (mCanvasWid &gt; 0 &amp;&amp; mCanvasHeight &gt; 0) { mDraftContent.setTvLocationXRatio(mContentTv.getX() / mCanvasWid); mDraftContent.setTvLocationYRatio(mContentTv.getY() / mCanvasHeight); } return true; } return false; } }; ç‰ˆæœ¬æ›´æ–° 2019-8-8 v1.1.1 ç‰ˆæœ¬æ›´æ–° è§£å†³äº†ä¸€äº›bug UIè°ƒæ•´ï¼Œå¢åŠ äº†æŠ½å±‰çš„å¤´å›¾å’Œæ¬¢è¿æ–‡å­— 2019-8-4 v1.1.0 ç‰ˆæœ¬æ›´æ–°","link":"/2019/07/29/Dev-note/dev-note-app-SDEdit/"},{"title":"Web tools å¼€å‘è®°å½•","text":"http://tools.rustfisher.com/ å¹³æ—¶å¼€å‘ä¸­æˆ‘ä»¬ä¼šç”¨åˆ°ä¸€äº›å·¥å…·ï¼Œæ¯”å¦‚æ—¶é—´æˆ³å·¥å…·ï¼ŒæŸ¥è¯¢asciiç ï¼ŒæŸ¥è¯¢é¢œè‰²è‰²å€¼ç­‰ç­‰ã€‚åšä¸€äº›é™æ€ç½‘é¡µï¼ŒæŠŠè¿™äº›å¼€å‘è€…ï¼Œç¾æœ¯å¸¸ç”¨çš„åŠŸèƒ½é›†åˆèµ·æ¥ï¼Œä¾¿äºå¤§å®¶çš„å·¥ä½œå’Œå­¦ä¹ ã€‚ æ—¶é—´æˆ³å·¥å…·http://tools.rustfisher.com/timestamp-tool.html ä½¿ç”¨äº†bootstrapã€‚é¢œè‰²é£æ ¼ç±»ä¼¼material designã€‚ çˆ¶divå®šä¹‰position: relative;ï¼Œå­å…ƒç´ å¯ä»¥æŒ‡å®šä½ç½®123position: absolute;bottom: 10px;right: 10px; æ—¶é’Ÿç½‘é¡µ - ç”¨äºkindlehttps://tools.rustfisher.com/clock-k1.html ç»“åˆkindleçš„ç‰¹ç‚¹ï¼Œåšä¸€ä¸ªæ—¶é’Ÿé¡µé¢ã€‚é¢œè‰²é£æ ¼ä»¥é»‘ç™½ä¸ºä¸»ã€‚ç›®å‰çš„kindleæ²¡æœ‰é‡åŠ›ä¼ æ„Ÿå™¨ï¼Œè€ƒè™‘æ·»åŠ åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥è®©ç½‘é¡µæ—‹è½¬90åº¦ã€‚ éœ€è¦å°†å…ƒç´ å±…ä¸­æ˜¾ç¤ºã€‚è¿™é‡Œé‡‡ç”¨çš„æ–¹æ³•æ˜¯flexå¸ƒå±€ã€‚çˆ¶å…ƒç´ è®¾ç½®display: flexã€‚123456.parentMain{ margin: 0 auto; display: flex; justify-content: center; align-items: center;} å­å…ƒç´ çš„è®¾ç½®12&lt;div id=&quot;main&quot; class=&quot;parentMain&quot;&gt; &lt;div id=&quot;content&quot; style=&quot;display:inline-block; margin: auto; align-content: center;&quot;&gt; é…åˆåŠ¨æ€è°ƒæ•´divå¤§å°12345function autoResizeDiv(){ document.getElementById('main').style.height = window.innerHeight +'px';}window.onresize = autoResizeDiv;autoResizeDiv(); è®¾ç½®display:inline-block;text-align: center;åï¼Œå¯ä»¥å­å…ƒç´ æ°´å¹³å±…ä¸­æ˜¾ç¤ºã€‚ æ—‹è½¬divç‚¹å‡»æŒ‰é’®ï¼ŒæŠŠæŸä¸ªdivé¡ºæ—¶é’ˆæ—‹è½¬90åº¦ã€‚è¿™é‡Œæ˜¯æƒ³æŠŠæ—¶é—´æ˜¾ç¤ºåŒºå—æ—‹è½¬90åº¦ã€‚jsæ§åˆ¶cssçš„å±æ€§ï¼Œæ—‹è½¬div 123456789101112131415timeFieldRotateDeg = 0;function rotateTimeFieldRight() { timeFieldRotateDeg += 90; if(timeFieldRotateDeg == 360) { timeFieldRotateDeg = 0; } timeContentField = document.getElementById('timeContentField'); console.log('rotate time content field'); timeContentField.style.webkitTransform = 'rotate('+timeFieldRotateDeg+'deg)'; timeContentField.style.mozTransform = 'rotate('+timeFieldRotateDeg+'deg)'; timeContentField.style.msTransform = 'rotate('+timeFieldRotateDeg+'deg)'; timeContentField.style.oTransform = 'rotate('+timeFieldRotateDeg+'deg)'; timeContentField.style.transform = 'rotate('+timeFieldRotateDeg+'deg)'; } å‚è€ƒ https://stackoverflow.com/questions/19126432/rotate-a-div-using-javascript https://stackoverflow.com/questions/14233341/how-can-i-rotate-an-html-div-90-degrees kindleé€‚é…é—®é¢˜bootstrapä¼¼ä¹å¹¶ä¸èƒ½åœ¨kindleçš„æµè§ˆå™¨ä¸Šå¾ˆå¥½çš„å·¥ä½œã€‚ä¸é‡‡ç”¨åŠ¨æ€è®¡ç®—å±å¹•å®½é«˜çš„æ–¹å¼ã€‚å±…ä¸­å…ƒç´ ã€‚ https://tools.rustfisher.com/clock-k2.html","link":"/2019/07/21/Dev-note/dev-note-web-tools/"},{"title":"Android OkHttp + Retrofit å–æ¶ˆè¯·æ±‚çš„æ–¹æ³•","text":"æœ¬æ–‡é“¾æ¥ å‰è¨€åœ¨æŸä¸€ä¸ªç•Œé¢ï¼Œç”¨æˆ·å‘èµ·äº†ä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œå› ä¸ºæŸç§åŸå› ç”¨æˆ·åœ¨ç½‘ç»œè¯·æ±‚å®Œæˆå‰ç¦»å¼€äº†å½“å‰ç•Œé¢ï¼Œæ¯”è¾ƒå¥½çš„åšæ³•æ˜¯å–æ¶ˆè¿™ä¸ªç½‘ç»œè¯·æ±‚ã€‚å¯¹äºOkHttpæ¥è¯´ï¼Œå…·ä½“æ˜¯è°ƒç”¨Callçš„cancelæ–¹æ³•ã€‚ å¦‚ä½•æ‰¾åˆ°è¿™ä¸€ä¸ªç½‘ç»œè¯·æ±‚å¹¶å–æ¶ˆæ‰å®ƒå‘¢ï¼Ÿ æ“ä½œå¤§è‡´åˆ†ä¸º3æ­¥ã€‚ç¬¬ä¸€æ­¥ï¼Œåœ¨å»ºç«‹è¯·æ±‚æ—¶ï¼Œç»™è¯·æ±‚ï¼ˆrequestï¼‰æ·»åŠ æ ‡è®°ï¼›ç¬¬äºŒæ­¥ï¼Œæ ¹æ®æ ‡è®°ï¼Œæ‰¾åˆ°è¯·æ±‚ï¼›æœ€åï¼Œå–æ¶ˆè¿™ä¸ªè¯·æ±‚ã€‚ OkHttpä¸­çš„tagè¦å–æ¶ˆä¸€ä¸ªè¯·æ±‚ï¼ŒOkHttpä¸­å¯ä»¥ä½¿ç”¨cancelæ–¹æ³•ï¼Œå‚è€ƒã€‚ OkHttpçš„requestå¯¹è±¡æœ‰tagã€‚å¯ä»¥æ ¹æ®tagæ¥æ ‡ç¤ºè¯·æ±‚ã€‚å‚è€ƒStack Overflowã€‚ 1234567891011121314151617//Set tags for your requests when you build them:Request request = new Request.Builder().url(url).tag(&quot;requestKey&quot;).build();//When you want to cancel://A) go through the queued calls and cancel if the tag matches:for (Call call : mHttpClient.dispatcher().queuedCalls()) { if (call.request().tag().equals(&quot;requestKey&quot;)) call.cancel();}//B) go through the running calls and cancel if the tag matches:for (Call call : mHttpClient.dispatcher().runningCalls()) { if (call.request().tag().equals(&quot;requestKey&quot;)) call.cancel();} Retrofitä¸­å¹¶æ²¡æœ‰æ˜¾ç¤ºåœ°æä¾›å–æ¶ˆè¯·æ±‚çš„æ¥å£ã€‚2018å¹´æ—¶Retrofitä»æœªæä¾›ç›´æ¥è®¿é—®callå¯¹è±¡çš„æ–¹æ³•é‚£ä¹ˆå¦‚ä½•æ‰¾åˆ°ç›®æ ‡ç½‘ç»œè¯·æ±‚å‘¢ï¼Ÿ RetrofitåŠ å…¥è‡ªå®šä¹‰headerç»™æ¯ä¸ªä¸é¡µé¢ï¼ˆActivityï¼ŒFragmentï¼‰ç›¸å…³çš„requeståŠ å…¥è‡ªå®šä¹‰headerï¼Œå‚è€ƒã€‚ç»™OkHttpClientæ·»åŠ æ‹¦æˆªå™¨ã€‚æ ‡è®°å‡ºé¡µé¢çš„ç”Ÿå­˜çŠ¶æ€ã€‚å¦‚æœé¡µé¢é”€æ¯äº†ï¼Œåˆ™å–æ¶ˆå¯¹åº”çš„requestã€‚ ä»¥GithubOnAndroidé¡¹ç›®ä¸ºä¾‹ï¼Œhttps://github.com/RustFisher/GithubOnAndroid æ·»åŠ æ ‡è®°æŒæœ‰ä¸€ä¸ªConcurrentHashMap&lt;String, Boolean&gt;æ¥æ ‡è®°é¡µé¢å­˜æ´»çŠ¶æ€ã€‚ 123456789private static ConcurrentHashMap&lt;String, Boolean&gt; actLiveMap = new ConcurrentHashMap&lt;&gt;(); // æ ‡è®°Activityæ˜¯å¦å­˜æ´»public static void markPageAlive(String actName) { actLiveMap.put(actName, true);}public static void markPageDestroy(String actName) { actLiveMap.put(actName, false);} Activityä¸­ç™»è®°ç•Œé¢çŠ¶æ€ç»™å½“å‰Activityèµ·åå­—ã€‚æ¯ä¸ªActivityçš„æ ‡è®°åå¿…é¡»å”¯ä¸€ã€‚ 123456789101112131415private static final String MY_ACT_NAME = &quot;xxx1Activity&quot;; @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); NetworkCenter.markPageAlive(MY_ACT_NAME); // ... } @Override protected void onDestroy() { super.onDestroy(); NetworkCenter.markPageDestroy(MY_ACT_NAME); // ... } OkHttpClientæ·»åŠ æ‹¦æˆªå™¨ç»™OkHttpClientæ·»åŠ æ‹¦æˆªå™¨ï¼Œåœ¨æ‹¦æˆªå™¨ä¸­æ£€æŸ¥é¡µé¢çš„å­˜æ´»æƒ…å†µã€‚æ£€æŸ¥åï¼ŒæŠŠè¿™ä¸ªè‡ªå®šä¹‰headerç§»é™¤æ‰ã€‚ 12345678910111213141516171819202122232425262728 public static final String HEADER_ACT_NAME = &quot;Activity-Name&quot;; // æ ‡è®°Activityç•Œé¢åå­— private Interceptor lifeInterceptor = new Interceptor() { @Override public Response intercept(Chain chain) throws IOException { Request request = chain.request(); String actName = request.header(HEADER_ACT_NAME); if (!TextUtils.isEmpty(actName)) { Log.d(TAG, &quot;lifeInterceptor: actName: &quot; + actName); Boolean actLive = actLiveMap.get(actName); if (actLive == null || !actLive) { chain.call().cancel(); Log.d(TAG, &quot;lifeInterceptor: å–æ¶ˆè¯·æ±‚, actName: &quot; + actName); } else { Log.d(TAG, &quot;lifeInterceptor: å‘èµ·è¯·æ±‚, actName: &quot; + actName); } } Request newRequest = request.newBuilder().removeHeader(HEADER_ACT_NAME).build(); return chain.proceed(newRequest); } };OkHttpClient = new OkHttpClient.Builder() .readTimeout(10, TimeUnit.SECONDS) .connectTimeout(10, TimeUnit.SECONDS) .addInterceptor(lifeInterceptor) // æ·»åŠ æ‹¦æˆªå™¨ .build(); call.cancel()åï¼Œä¸ä¼šå†èµ°Retrofitçš„subscribeæ–¹æ³•ã€‚ æ·»åŠ header12345@GET(&quot;users/{owner}/repos&quot;)Observable&lt;List&lt;UserRepo&gt;&gt; userRepo( @Header(NetworkCenter.HEADER_ACT_NAME) @Nullable String actName, @Path(&quot;owner&quot;) String owner, @Query(&quot;sort&quot;) String sortType); æ›´å¤šè¯·å‚è€ƒï¼š Android OkHttp + Retrofit ä½¿ç”¨ç¤ºä¾‹ Android OkHttp + Retrofit å–æ¶ˆè¯·æ±‚çš„æ–¹æ³• Android OkHttp + Retrofit ä¸‹è½½æ–‡ä»¶ä¸è¿›åº¦ç›‘å¬ Android OkHttp + Retrofit æ–­ç‚¹ç»­ä¼ ","link":"/2019/06/26/Android/Android-OkHttp_Retrofit_cancel_request/"},{"title":"Android SparseArray åŸç†è§£æ","text":"Android SparseArray åŸç†è§£æä»€ä¹ˆæ˜¯SparseArrayï¼ŸSparseArrayå­˜å‚¨çš„æ˜¯é”®å€¼å¯¹ï¼Œä»¥intä½œä¸ºkeyï¼ŒObjectä½œä¸ºvalueã€‚Sparseæœ‰ç¨€ç–ã€ç¼ºå°‘çš„æ„æ€ã€‚SparseArrayåº”ç”¨åœºæ™¯æ˜¯ç›¸å¯¹ç¨€å°‘çš„æ•°æ®ï¼Œä¸€èˆ¬æ˜¯å‡ ç™¾ä»¥å†…ã€‚ SparseArrayé‡‡ç”¨çš„æ•°æ®ç»“æ„ï¼ŸSparseArrayå¹¶ä¸åƒHashMapé‡‡ç”¨ä¸€ç»´æ•°ç»„+å•é“¾è¡¨å’ŒäºŒå‰æ ‘ç»“æ„ï¼Œè€Œæ˜¯é‡‡ç”¨ä¸¤ä¸ªä¸€ç»´æ•°ç»„ï¼Œä¸€ä¸ªæ˜¯å­˜å‚¨key(intç±»å‹),ä¸€ä¸ªæ˜¯å­˜value objectã€‚ 123private int[] mKeys; // å­˜å‚¨keyprivate Object[] mValues; // å­˜å‚¨valueå¯¹è±¡private int mSize; // è®°å½•å­˜å‚¨é”®å€¼å¯¹çš„æ•°é‡ mKeyså’ŒmValuesè¯»å†™æ—¶é‡‡ç”¨çš„ä¸‹æ ‡æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚ SparseArrayé»˜è®¤å®¹é‡å¤šå¤§ï¼ŸSparseArrayåœ¨é»˜è®¤æ„é€ å‡½æ•°ä¸­æŒ‡å®šå…¶é»˜è®¤å®¹é‡å¤§å°ã€‚é»˜è®¤ä¸º10 åˆå§‹åŒ–åmSize = 0ï¼Œå®ä¾‹åŒ–mKeyså’ŒmValuesã€‚ SparseArray getæ–¹æ³•çš„æµç¨‹åˆ†æè¾“å…¥ä¸€ä¸ªintå‹çš„keyï¼Œé€šè¿‡äºŒåˆ†æ³•æŸ¥æ‰¾åŒ¹é…çš„ä¸‹æ ‡ã€‚è‹¥æ²¡æ‰¾åˆ°å¯¹åº”çš„ä¸‹æ ‡ï¼Œåˆ™è¿”å›nullæˆ–ç”¨æˆ·æŒ‡å®šçš„é»˜è®¤å¯¹è±¡ã€‚ keyæ˜¯é€’å¢å­˜æ”¾çš„ã€‚äºŒåˆ†æ³•æŸ¥æ‰¾ä¸‹æ ‡æ—¶ï¼Œå¯èƒ½ä¼šè¿”å›ä¸€ä¸ªè´Ÿå€¼ï¼Œæ­¤æ—¶è¡¨ç¤ºåœ¨mKeysä¸­æ²¡æ‰¾åˆ°å¯¹åº”çš„é”®ã€‚ 12345678910111213141516171819public E get(int key) { return get(key, null);}/** * Gets the Object mapped from the specified key, or the specified Object * if no such mapping has been made. */@SuppressWarnings(&quot;unchecked&quot;)public E get(int key, E valueIfKeyNotFound) { int i = ContainerHelpers.binarySearch(mKeys, mSize, key); // äºŒåˆ†æ³•æŸ¥æ‰¾ä¸‹æ ‡ if (i &lt; 0 || mValues[i] == DELETED) { // æ‰¾åˆ°çš„ä¸‹æ ‡ä¸ºè´Ÿæˆ–å½“å‰ä½ç½®å…ƒç´ ä»¥è¢«åˆ é™¤ï¼Œè¡¨æ˜æ²¡æ‰¾åˆ° return valueIfKeyNotFound; } else { return (E) mValues[i]; // æ‰¾åˆ°æŒ‡å®šå…ƒç´  }} SparseArray putæ–¹æ³•çš„æµç¨‹åˆ†æ1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162public void put(int key, E value) { // äºŒåˆ†æ³•æ‰¾åˆ°keyçš„ä¸‹æ ‡ int i = ContainerHelpers.binarySearch(mKeys, mSize, key); if (i &gt;= 0) { // ä»£è¡¨å½“å‰å·²ç»å­˜åœ¨keyåŠå…¶å¯¹åº”çš„å€¼ï¼Œç›´æ¥æ›¿æ¢value mValues[i] = value; } else { // è¡¨ç¤ºå½“å‰å¹¶ä¸å­˜åœ¨keyï¼Œåˆ™åº”æ·»åŠ æ–°çš„é”®å€¼å¯¹ // iå–åï¼Œå¾—åˆ°è¦æ·»åŠ çš„æ•°ç»„ä½ç½®ä¸‹æ ‡ã€‚äºŒå‰æŸ¥æ‰¾è¿”å›çš„æ˜¯keyçš„â€œåº”å½“â€å­˜æ”¾çš„ä½ç½®ä¸‹æ ‡ã€‚ i = ~i; if (i &lt; mSize &amp;&amp; mValues[i] == DELETED) { // åŸæ¥ä½ç½®ä¸Šçš„å…ƒç´ å·²ç»è¢«åˆ æ‰äº†ï¼Œç›´æ¥èµ‹å€¼æ›¿æ¢ mKeys[i] = key; mValues[i] = value; return; } if (mGarbage &amp;&amp; mSize &gt;= mKeys.length) { // å®¹é‡ä¸è¶³ï¼Œè¿›è¡Œå›æ”¶æ“ä½œ gc(); // é‡æ–°æŸ¥æ‰¾ç›®æ ‡ä¸‹æ ‡ i = ~ContainerHelpers.binarySearch(mKeys, mSize, key); } // ç›®æ ‡ä¸‹æ ‡ä¸ºiï¼Œå°†keyæ·»åŠ è¿›mKeysæ•°ç»„ä¸­ mKeys = GrowingArrayUtils.insert(mKeys, mSize, i, key); // ç›®æ ‡ä¸‹æ ‡ä¸ºiï¼Œå°†valueæ’å…¥mValuesæ•°ç»„ä¸­ mValues = GrowingArrayUtils.insert(mValues, mSize, i, value); // å·²å­˜å‚¨çš„æ•°æ®ä¸ªæ•°åŠ 1 mSize++; }}// GrowingArrayUtils.javapublic static &lt;T&gt; T[] insert(T[] array, int currentSize, int index, T element) { assert currentSize &lt;= array.length; if (currentSize + 1 &lt;= array.length) { // å½“å‰æ•°ç»„å®¹é‡å……è¶³ï¼Œindexå¼€å§‹çš„å…ƒç´ åç§»1ä½ System.arraycopy(array, index, array, index + 1, currentSize - index); array[index] = element; return array; } // å®¹é‡ä¸è¶³ï¼Œå…ˆæ‰©å®¹ç”Ÿæˆæ–°çš„æ•°ç»„newArray @SuppressWarnings(&quot;unchecked&quot;) T[] newArray = ArrayUtils.newUnpaddedArray((Class&lt;T&gt;)array.getClass().getComponentType(), growSize(currentSize)); // å°†åŸæ¥æ•°ç»„indexä¹‹å‰çš„éƒ¨åˆ†å¤åˆ¶åˆ°æ–°æ•°ç»„å¯¹è±¡ä¸­ System.arraycopy(array, 0, newArray, 0, index); newArray[index] = element; // æ’å…¥å…ƒç´  // å°†åŸæ•°ç»„index+1ä¹‹åçš„å…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„ä¸­ System.arraycopy(array, index, newArray, index + 1, array.length - index); return newArray; }// æ‰©å®¹è®¡ç®—è§„åˆ™ï¼Œå½“å‰å®¹é‡å°äºç­‰äº4åˆ™è¿”å›8ï¼›å¦åˆ™è¿”å›2å€çš„å®¹é‡// æ‰©å®¹åæœ€å°å®¹é‡æ˜¯8public static int growSize(int currentSize) { return currentSize &lt;= 4 ? 8 : currentSize * 2;} keyä¸‹æ ‡çš„äºŒå‰æŸ¥æ‰¾æ–¹æ³•åˆ†æäºŒå‰æŸ¥æ‰¾æ–¹æ³•ContainerHelpers.binarySearch(int[] array, int size, int value)123456789101112131415161718static int binarySearch(int[] array, int size, int value) { int lo = 0; int hi = size - 1; while (lo &lt;= hi) { final int mid = (lo + hi) &gt;&gt;&gt; 1; final int midVal = array[mid]; if (midVal &lt; value) { lo = mid + 1; } else if (midVal &gt; value) { hi = mid - 1; } else { return mid; // value found } } return ~lo; // value not present} å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¾“å…¥valueå¯¹åº”çš„ä¸‹æ ‡ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªæŒ‰ä½å–ååçš„å€¼ï¼ˆä¸€èˆ¬æ˜¯ä¸ªè´Ÿå€¼ï¼‰ã€‚ ä¾‹å¦‚è¾“å…¥arrayæ˜¯ [1,2,4,5]ï¼Œsizeæ˜¯4ï¼Œvalueæ˜¯3ï¼›é‚£ä¹ˆä¼šå¾—åˆ°2çš„å–åå€¼ã€‚è€Œ2å°±æ˜¯valueçš„ç›®æ ‡ä½ç½®ä¸‹æ ‡ã€‚ SparseArrayæœ€å¤§å®¹é‡ï¼Ÿæ¯æ¬¡æ‰©å®¹å¤šå°‘ï¼ŸSparseArrayå¹¶ä¸åƒHashMapä¸€æ ·å®šä¹‰æœ‰æœ€å¤§å®¹é‡æ˜¯å¤šå°‘ï¼Œæœ€å¤§å¯ä»¥è¾¾åˆ°Integer.MAX_VALUEï¼Œå¯èƒ½ä¼šæŠ¥oomã€‚æ¯æ¬¡æ‰©å®¹æ—¶å¦‚æœå½“å‰å®¹é‡å°äº5åˆ™æ‰©å®¹æ˜¯8ï¼Œå¦åˆ™æ‰©å®¹ä¸ºåŸå®¹é‡çš„2å€ã€‚ 123public static int growSize(int currentSize) { return currentSize &lt;= 4 ? 8 : currentSize * 2;} SparseArrayä¸HashMapçš„æ¯”è¾ƒï¼Œåº”ç”¨åœºæ™¯æ˜¯ï¼Ÿ SparseArrayé‡‡ç”¨çš„ä¸æ˜¯å“ˆå¸Œç®—æ³•ï¼ŒHashMapé‡‡ç”¨çš„æ˜¯å“ˆå¸Œç®—æ³•ã€‚ SparseArrayé‡‡ç”¨çš„æ˜¯ä¸¤ä¸ªä¸€ç»´æ•°ç»„åˆ†åˆ«ç”¨äºå­˜å‚¨é”®å’Œå€¼ï¼ŒHashMapé‡‡ç”¨çš„æ˜¯ä¸€ç»´æ•°ç»„+å•å‘é“¾è¡¨æˆ–äºŒå‰æ ‘ã€‚ SparseArray keyåªèƒ½æ˜¯intç±»å‹ï¼Œè€ŒHashMapçš„keyæ˜¯Objectã€‚ SparseArray keyæ˜¯æœ‰åºå­˜å‚¨ï¼ˆå‡åºï¼‰ï¼Œè€ŒHashMapä¸æ˜¯ã€‚ SparseArray é»˜è®¤å®¹é‡æ˜¯10ï¼Œè€ŒHashMapé»˜è®¤å®¹é‡æ˜¯16ã€‚ SparseArray é»˜è®¤æ¯æ¬¡æ‰©å®¹æ˜¯2å€äºåŸæ¥çš„å®¹é‡ï¼Œè€ŒHashMapé»˜è®¤æ¯æ¬¡æ‰©å®¹æ—¶æ˜¯åŸå®¹é‡*0.75å€ SparseArray valueçš„å­˜å‚¨è¢«ä¸åƒHashMapä¸€æ ·éœ€è¦é¢å¤–çš„éœ€è¦ä¸€ä¸ªå®ä½“ç±»ï¼ˆNodeï¼‰è¿›è¡ŒåŒ…è£… SparseArrayæŸ¥æ‰¾å…ƒç´ æ€»ä½“è€Œè¨€æ¯”HashMapè¦é€Šè‰²ï¼Œå› ä¸ºSparseArrayæŸ¥æ‰¾æ˜¯éœ€è¦ç»è¿‡äºŒåˆ†æ³•çš„è¿‡ç¨‹ï¼Œè€ŒHashMapä¸å­˜åœ¨å†²çªçš„æƒ…å†µå…¶æŠ€æœ¯å¤„çš„hashå¯¹åº”çš„ä¸‹æ ‡ç›´æ¥å°±å¯ä»¥å–åˆ°å€¼ã€‚ é’ˆå¯¹ä¸Šé¢ä¸HashMapçš„æ¯”è¾ƒï¼Œé‡‡ç”¨SparseArrayè¿˜æ˜¯HashMapï¼Œå»ºè®®æ ¹æ®å¦‚ä¸‹éœ€æ±‚é€‰å–ï¼š å¦‚æœå¯¹å†…å­˜è¦æ±‚æ¯”è¾ƒé«˜ï¼Œè€Œå¯¹æŸ¥è¯¢æ•ˆç‡æ²¡ä»€ä¹ˆå¤§çš„è¦æ±‚ï¼Œå¯ä»¥æ˜¯ä½¿ç”¨SparseArray æ•°é‡åœ¨ç™¾çº§åˆ«çš„SparseArrayæ¯”HashMapæœ‰æ›´å¥½çš„ä¼˜åŠ¿ è¦æ±‚keyæ˜¯intç±»å‹çš„ï¼Œå› ä¸ºHashMapä¼šå¯¹intè‡ªå®šè£…ç®±å˜æˆIntegerç±»å‹ è¦æ±‚keyæ˜¯æœ‰åºçš„ä¸”æ˜¯å‡åº å‚è€ƒhttps://www.jianshu.com/p/30a2bfb202b4","link":"/2019/04/21/Android/Android-SparseArray_src_code_note/"},{"title":"MySQL Mac å®‰è£…ä¸ç®€å•é…ç½®","text":"homebrewå®‰è£…mysqlä½¿ç”¨brewå‘½ä»¤å®‰è£…mysql1mb:~ rustfisher$ brew install mysql å¯åŠ¨åœæ­¢mysqlæœåŠ¡å¯åŠ¨æœåŠ¡ mysql.server startå®‰è£…æ—¶æ²¡æœ‰è®¾ç½®å¯†ç ï¼Œå¯ä»¥ç›´æ¥mysql -urootç™»å…¥ã€‚12345678910111213141516171819mb:~ rustfisher$ mysql.server startStarting MySQL. SUCCESS! mb:~ rustfisher$ mysql -urootWelcome to the MySQL monitor. Commands end with ; or \\g.Your MySQL connection id is 9Server version: 8.0.12 HomebrewCopyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.mysql&gt; exit;Bye è¾“å…¥mysqlæŒ‡ä»¤é‡åˆ°é”™è¯¯12mysql&gt; show database;ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'database' at line 1 æŒ‡ä»¤è¾“å…¥é”™è¯¯ï¼Œä¿®æ­£ä¸€ä¸‹12345678910mysql&gt; show databases;+--------------------+| Database |+--------------------+| information_schema || mysql || performance_schema || sys |+--------------------+4 rows in set (0.00 sec) åœæ­¢mysqlæœåŠ¡çš„å‘½ä»¤ mysql.server stop123mb:anindexserver rustfisher$ mysql.server stopShutting down MySQL... SUCCESS! ç®€å•æ“ä½œæ›´æ”¹å¯†ç 12mysql&gt; ALTER USER 'root'@'localhost' IDENTIFIED BY 'yourpwd';Query OK, 0 rows affected (0.05 sec) è®¾å®šäº†å¯†ç åï¼Œç™»å½•éœ€è¦è¾“å…¥å¯†ç 1234mb:anindexserver rustfisher$ mysql -uroot -pEnter password: Welcome to the MySQL monitor. Commands end with ; or \\g. å‚è€ƒï¼š https://dev.mysql.com/doc/refman/8.0/en/resetting-permissions.html å¯è§†åŒ–å·¥å…· mysql workbenchå®˜æ–¹æ–‡æ¡£è¯·å‚è€ƒ https://dev.mysql.com/downloads/workbench/ mysql workbench éœ€è¦primary keyéœ€è¦æœ‰primary keyæ‰èƒ½ç¼–è¾‘å†…å®¹ https://stackoverflow.com/questions/10815029/mysql-workbench-edit-table-data-is-read-only é…ç½®æ–‡ä»¶macä¸­é…ç½®æ–‡ä»¶é»˜è®¤è·¯å¾„ä¸º /usr/local/etc/my.cnf å¯ä»¥ä¿®æ”¹portã€‚12345# Default Homebrew MySQL server config[mysqld]# Only allow connections from localhostport=9527bind-address = 127.0.0.1è¿™é‡Œé™åˆ¶äº†è¿æ¥çš„ç«¯å£ã€‚ å‚è€ƒï¼š https://www.cyberciti.biz/faq/change-default-mysql-port-under-linuxunix/","link":"/2019/02/26/Database/MySQL-install_and_config_Mac/"},{"title":"python3 å‘é€é‚®ä»¶åŠŸèƒ½","text":"å‘ä¿¡é‚®ç®±æ˜¯è…¾è®¯ä¼ä¸šé‚®ç®±ã€‚å¼€å‘ç¯å¢ƒ Windows7ã€‚ ä¸»è¦ä½¿ç”¨smtplibæ¥å®ç°å‘é‚®ä»¶çš„åŠŸèƒ½ã€‚ ç®€å•çš„å‘é€é‚®ä»¶åŠŸèƒ½1234567891011121314151617181920212223242526272829# å‘é€é‚®ä»¶import smtplibfrom email.mime.multipart import MIMEMultipartfrom email.mime.text import MIMETextdef send_email(): fromaddr = &quot;from1@your_email.com&quot; # ä½ çš„å‘ä»¶é‚®ç®± toaddr = &quot;to1@your_email.com&quot; # ç›®æ ‡é‚®ç®± msg = MIMEMultipart() msg['From'] = fromaddr msg['To'] = toaddr msg['Subject'] = &quot;SUBJECT OF THE MAIL&quot; body = &quot;YOUR MESSAGE HERE&quot; msg.attach(MIMEText(body, 'plain')) server = smtplib.SMTP('smtp.exmail.qq.com', 25) # é»˜è®¤ç«¯å£25 server.starttls() server.login(fromaddr, &quot;xxxxå¯†ç &quot;) text = msg.as_string() server.sendmail(fromaddr, toaddr, text) server.quit()if __name__ == '__main__': print('start sending email') send_email() print('end...') é‚®ä»¶å¸¦ä¸Šé™„ä»¶Windowsä¸‹æ³¨æ„æ–‡ä»¶è·¯å¾„çš„è¡¨è¾¾æ–¹å¼ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263# å‘é€é‚®ä»¶import smtplibfrom email import encodersfrom email.mime.base import MIMEBasefrom email.mime.multipart import MIMEMultipartfrom email.mime.text import MIMETextdef send_email(from_email, pwd, target_email_list=[], attachment_file_list=[]): &quot;&quot;&quot; å•ç‹¬å‘é€é‚®ä»¶ create on 2018-11-14 :param from_email: æºé‚®ç®± :param pwd: æºé‚®ç®±å¯†ç  :param target_email_list: ç›®æ ‡é‚®ä»¶åˆ—è¡¨ :param attachment_file_list: é™„ä»¶è·¯å¾„åˆ—è¡¨ :return: void &quot;&quot;&quot; if len(target_email_list) &lt;= 0: print('ERR: ç›®æ ‡é‚®ä»¶åˆ—è¡¨ä¸ºç©º -&gt; é€€å‡º') return for target_email in target_email_list: print('sending to ' + target_email) msg = MIMEMultipart() msg['From'] = from_email msg['To'] = target_email msg['Subject'] = &quot;æ›´æ–°&quot; body = '''å°Šæ•¬çš„å®¢æˆ·ï¼Œ ä½ å¥½ï¼Œè¯·æŸ¥æ”¶æ–‡ä»¶ã€‚è°¢è°¢ï¼ ''' msg.attach(MIMEText(body, 'plain')) for file_path in attachment_file_list: filename = str(file_path).split('\\\\')[-1] print(&quot;file_path &quot; + file_path + &quot; filename: &quot; + filename) attachment = open(file_path, &quot;rb&quot;) part = MIMEBase('application', 'octet-stream') part.set_payload(attachment.read()) encoders.encode_base64(part) part.add_header('Content-Disposition', &quot;attachment; filename= %s&quot; % filename) msg.attach(part) server = smtplib.SMTP('smtp.exmail.qq.com', 25) server.starttls() server.login(from_email, pwd) text = msg.as_string() server.sendmail(from_email, target_email, text) server.quit()if __name__ == '__main__': print('start sending email') send_email(from_email=&quot;your_email.com&quot;, pwd=&quot;å¯†ç &quot;, target_email_list=[&quot;target1@foxmail.com&quot;, &quot;target2@qq.com&quot;], attachment_file_list=[ r&quot;E:\\your_path.rar&quot;]) print('end...') å‚è€ƒï¼š https://blog.csdn.net/u011846143/article/details/78274911?locationNum=9&amp;fps=1 http://naelshiab.com/tutorial-send-email-python/","link":"/2018/11/14/Python/python3-send-email/"},{"title":"Flutter - å¤„ç†æ‰‹åŠ¿","text":"Flutter - å¤„ç†æ‰‹åŠ¿ç‚¹å‡»ï¼Œæ»‘åŠ¨ç­‰ç­‰æ‰‹åŠ¿ã€‚ å¤„ç†ç‚¹å‡»æ­¥éª¤ åˆ›å»ºè‡ªå®šä¹‰buttonç±» åœ¨å…¶ä¸­ä½¿ç”¨GestureDetectorå¹¶å¤å†™onTapå›è°ƒ ä»£ç å®ç°1234567891011121314151617181920212223import 'package:flutter/material.dart';/// è‡ªå®šä¹‰buttonclass ButtonSample1 extends StatelessWidget { @override Widget build(BuildContext context) { return GestureDetector( onTap: () { final snackBar = SnackBar(content: Text(&quot;Now you tap the $this&quot;),); Scaffold.of(context).showSnackBar(snackBar); }, child: Container( padding: EdgeInsets.all(12.0), margin: EdgeInsets.all(12.0), decoration: BoxDecoration(color: Theme .of(context) .buttonColor, borderRadius: BorderRadius.circular(8.0)), child: Text(&quot;$this&quot;),), ); }} å‚è€ƒï¼š https://flutter.io/cookbook/gestures/handling-taps/ å¸¦æ³¢çº¹æ•ˆæœçš„æŒ‰é’®ä½¿ç”¨InkWellã€‚12345678910111213141516/// å¸¦æœ‰æ³¢çº¹æ•ˆæœçš„æŒ‰é’®class ButtonSample2 extends StatelessWidget { @override Widget build(BuildContext context) { return InkWell( onTap: () { final snackBar = SnackBar(content: Text(&quot;Now you tap the $this&quot;),); Scaffold.of(context).showSnackBar(snackBar); }, child: Container( padding: EdgeInsets.all(12.0), child: Text(&quot;$this&quot;), ), ); }} Flutteræä¾›çš„æŒ‰é’®æ§ä»¶è¿˜æœ‰RaisedButtonå’ŒFlatButtonã€‚ åˆ—è¡¨ä¾§æ»‘åˆ é™¤æ­¥éª¤ï¼š åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ ç”¨DismissibleåŒ…è£…æ¯ä¸€ä¸ªitem æä¾›åˆ é™¤æ—¶çš„UIæ˜¾ç¤º åˆ›å»ºåˆ—è¡¨1final items = List&lt;String&gt;.generate(10, (i) =&gt; &quot;Item $i&quot;); åˆ›å»ºå­—ç¬¦ä¸²åˆ—è¡¨ã€‚è¿™ä¸ªåˆ—è¡¨ä¸èƒ½æ”¾åœ¨buildä¸­ï¼Œè¦å®šä¹‰ä¸ºStateçš„å…¨å±€å˜é‡ã€‚å¦åˆ™åˆ é™¤itemæ—¶ï¼Œæ— æ³•ä»view treeä¸­ç§»é™¤itemï¼Œä»è€ŒæŠ¥é”™ã€‚ åˆ é™¤æ—¶çš„UIè®¾ç½®Dismissibleçš„backgroundï¼Œå¯ä»¥åœ¨åˆ é™¤æ—¶æ˜¾ç¤ºã€‚ ç¤ºä¾‹ç•Œé¢ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748import 'package:flutter/material.dart';/// ä¾§æ»‘åˆ é™¤åˆ—è¡¨ç•Œé¢class SwipeToDismissPage extends StatefulWidget { SwipeToDismissPage({Key key}) : super(key: key); @override State&lt;StatefulWidget&gt; createState() { return SwipeState(); }}class SwipeState extends State&lt;SwipeToDismissPage&gt; { final items = List&lt;String&gt;.generate(10, (i) =&gt; &quot;Item $i&quot;); // åˆ—è¡¨å¿…é¡»æ”¾åœ¨å¤–é¢å®šä¹‰ @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar( title: Text( &quot;Swipe to dismiss&quot;, ), ), body: ListView.builder( itemCount: items.length, itemBuilder: (context, index) { final item = items[index]; return Dismissible( key: Key(item), onDismissed: (direction) { setState(() { items.removeAt(index); print(direction); }); Scaffold.of(context) .showSnackBar(SnackBar(content: Text('remove $item'))); }, child: ListTile( title: Text('$item'), ), background: Container( color: Colors.red, ), ); }), ); }} é€‰æ‹©GestureDetectorçš„å“åº”å½¢å¼1behavior: HitTestBehavior.opaque https://docs.flutter.io/flutter/rendering/HitTestBehavior-class.html","link":"/2018/09/06/Flutter/Flutter-Gesture_handle/"},{"title":"Flutter - é¡µé¢é—´è·³è½¬æ“ä½œ","text":"åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°çš„ç•Œé¢å¹¶ä¸”èƒ½è·³å›æ¥å¤§å¤šæ•°Appéƒ½åŒ…å«å¤šä¸ªç•Œé¢ã€‚æ¯”å¦‚æ•°æ®åˆ—è¡¨é¡µå’Œè¯¦ç»†é¡µã€‚Androidä¸­çš„é¡µé¢å¯ä»¥æ˜¯Activityï¼›iOSä¸­ä½¿ç”¨ViewControllerã€‚åœ¨Flutterä¸­ï¼Œé¡µé¢ä¹Ÿæ˜¯widgetã€‚ä½¿ç”¨Navigatoræ¥åˆ‡æ¢é¡µé¢ã€‚ æ­¥éª¤ï¼š 1.åˆ›å»º2ä¸ªé¡µé¢ 2.ç”¨Navigator.pushè·³å»ç¬¬äºŒä¸ªé¡µé¢ 3.ç”¨Navigator.popå›åˆ°ç¬¬ä¸€ä¸ªé¡µé¢ pushå’Œpopå¾ˆå®¹æ˜“è®©äººè”æƒ³åˆ°æ ˆã€‚Androidä¸­æœ‰ActivityStackï¼Œç”¨æ¥å­˜æ”¾Activityã€‚å½“å‰çš„Activityå°±åœ¨æ ˆé¡¶ã€‚ 1.åˆ›å»º2ä¸ªé¡µé¢åˆ›å»º2ä¸ªç®€å•çš„ç•Œé¢ï¼Œç•Œé¢ä¸­åªæœ‰ä¸€ä¸ªæŒ‰é’®ã€‚1234567891011121314151617181920212223242526class FirstScreen extends StatelessWidget { @override Widget build(BuildContext context) { return Scaffold(appBar: AppBar(title: Text('First page'),), body: Center(child: RaisedButton( child: Text('Go to 2nd page'), onPressed: () { print('This is first page'); // æ‰§è¡Œæƒ³è¦çš„æ“ä½œ.......... }),),); }}class SecondScreen extends StatelessWidget { @override Widget build(BuildContext context) { print('${this} hashCode=${this.hashCode}'); return Scaffold(appBar: AppBar(title: Text('Second page'),), body: Center(child: RaisedButton( child: Text(&quot;Go back&quot;), onPressed: () { print('This is 2nd page'); // æ‰§è¡Œæ“ä½œ........ }),),); }} 2.ç”¨Navigator.pushè·³è½¬å»ç¬¬äºŒä¸ªç•Œé¢pushæ–¹æ³•ä¼šå‘æ ˆä¸­æ·»åŠ ä¸€ä¸ªç”±Navigatorç®¡ç†çš„Routeã€‚pushæ–¹æ³•æ¥å—ä¸€ä¸ªRouteï¼ˆæš‚ç§°ä¸ºè·¯ç”±ï¼‰ï¼Œè¿™é‡Œæ–°å»ºä¸€ä¸ªRouteï¼Œä½¿ç”¨ç”¨MaterialPageRouteã€‚ åœ¨ç¬¬ä¸€ä¸ªé¡µé¢ä¸­æŒ‰é’®æ·»åŠ å›è°ƒçš„æ“ä½œ1234onPressed: () {Navigator.push(context, MaterialPageRoute(builder: (context) =&gt; SecondScreen()));} 3.ç”¨Navigator.popå›åˆ°ç¬¬ä¸€ä¸ªç•Œé¢Navigator.popä¼šç§»é™¤navigatorç®¡ç†çš„å½“å‰çš„è·¯ç”±ï¼ˆæ•ˆæœæ˜¯ç§»é™¤å½“å‰ç•Œé¢ï¼‰ã€‚ 12345// ç¬¬äºŒä¸ªé¡µé¢ä¸­onPressed: () { Navigator.pop(context);} å®Œæ•´ä»£ç 1234567891011121314151617181920212223242526272829303132333435import 'package:flutter/material.dart';void main() { runApp(new MaterialApp( title: 'navigate demo', home: new FirstScreen(),));}class FirstScreen extends StatelessWidget { @override Widget build(BuildContext context) { return Scaffold(appBar: AppBar(title: Text('First page'),), body: Center(child: RaisedButton( child: Text('Go to 2nd page'), onPressed: () { print('This is first page'); Navigator.push(context, MaterialPageRoute(builder: (context) =&gt; SecondScreen())); }),),); }}class SecondScreen extends StatelessWidget { @override Widget build(BuildContext context) { print('${this} hashCode=${this.hashCode}'); return Scaffold(appBar: AppBar(title: Text('Second page'),), body: Center(child: RaisedButton( child: Text(&quot;Go back&quot;), onPressed: () { print('This is 2nd page'); Navigator.pop(context); }),),); }} ä»£ç è¯·å‚é˜…ï¼š https://github.com/RustFisher/flutter_basic","link":"/2018/09/05/Flutter/Flutter-Navigator_demo1/"},{"title":"ã€ŒLearnã€å¼€å‘è®°å½•","text":"å¼€å‘Appè¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œè§£å†³åŠæ³•ã€‚ä¸´æ—¶è®°å½•ä¸€äº›è§£å†³æ–¹æ¡ˆã€‚ éŸ³é¢‘Android MediaPlayeråŸºç¡€ã€‚åœ¨çº¿éŸ³é¢‘æ’­æ”¾ï¼Œä½¿ç”¨MediaPlayerã€‚ä¸‹è½½åœ¨çº¿éŸ³é¢‘åˆ°æœ¬åœ°ï¼Œä½¿ç”¨URLConnectionã€‚ è‡ªå®šä¹‰ViewGroupç»§æ‰¿è‡ªLinearLayoutï¼Œè‡ªå®šä¹‰å­Viewçš„æ’å¸ƒæ–¹å¼ã€‚ crash ViewGroup.resetResolvedLayoutDirectionç»™LinearLayout addViewçš„æ—¶å€™æŠ¥é”™12E/AndroidRuntime: at android.view.ViewGroup.resetResolvedLayoutDirection(ViewGroup.java:7291) at android.view.ViewGroup.resetResolvedLayoutDirection(ViewGroup.java:7291) æ£€æŸ¥ä»£ç ï¼Œå‘ç°addViewçš„æ—¶å€™æŠŠLinearLayoutè‡ªå·±æ·»åŠ è¿›å»äº†ã€‚12final LinearLayout wordCube = new LinearLayout(this);wordCube.addView(wordCube, chTvParams); æ”¹æˆ12final LinearLayout wordCube = new LinearLayout(this);wordCube.addView(tv, chTvParams); // è¦åŠ çš„æ˜¯tv Buglyçƒ­æ›´æ–°Buglyçƒ­æ›´æ–°æ–¹æ¡ˆé›†æˆäº†è…¾è®¯çš„tinkerï¼Œè‡ªå¸¦äº†è¡¥ä¸åŒ…å‘å¸ƒå¹³å°ã€‚ æ–‡æ¡£ https://bugly.qq.com/docs/user-guide/instruction-manual-android-hotfix/?v=20181014122344#_3 tinkerä¸æ”¯æŒçƒ­æ›´æ–°æ–°å¢å››å¤§ç»„ä»¶ï¼Œä¸èƒ½ä¿®æ”¹Manifestæ–‡ä»¶ã€‚ä½†æ˜¯å¯ä»¥ä¿®æ”¹å››å¤§ç»„ä»¶é‡Œé¢çš„é€»è¾‘ã€‚å¯ä»¥ä¿®æ”¹layoutæ–‡ä»¶å’Œèµ„æºæ–‡ä»¶ã€‚ Assetséå†æ–‡ä»¶assetsé‡Œå­˜æ”¾ç€å››åƒå¤šä¸ªæ–‡ä»¶ï¼Œçº¢ç±³6Aéå†ä¸€æ¬¡è¦2ç§’å¤šã€‚ 1String[] list = context.getAssets().list(&quot;folder&quot;); // æ‰§è¡Œè¿™ä¸€å¥è¦ä¸¤åƒå¤šæ¯«ç§’ è¯­éŸ³è¯†åˆ«æ–¹æ¡ˆä¸»åŠ›æ–¹æ¡ˆä¸ºç™¾åº¦è¯­éŸ³è¯†åˆ«ã€‚ ç»¼åˆä»·æ ¼è€ƒè™‘ï¼Œå°†ç§‘å¤§è®¯é£çš„è¯­éŸ³å¬å†™ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆã€‚ å°†ç™¾åº¦è¯­éŸ³è¯†åˆ«ä¸è®¯é£å¬å†™çš„SDKä¸€èµ·å¼•å…¥åˆ°Appä¸­ã€‚ç”±åå°æ§åˆ¶ç”¨æˆ·ä½¿ç”¨å“ªä¸€ä¸ªè¯­éŸ³å¼•æ“ã€‚ ä¸‹è½½æ–‡ä»¶é¡¹ç›®é‡‡ç”¨çš„æ˜¯mvvmæ¶æ„ã€‚æœ‰2ä¸ªé¡µé¢è¦ç”¨åˆ°åŒä¸€ä¸ªæ•°æ®æºã€‚æŠŠè¿™ä¸ªæ•°æ®æºå•ç‹¬æŠ½å‡ºæ¥ï¼Œè®¾è®¡ç›‘å¬å™¨ã€‚ åŸæ¡†æ¶çš„ä¸‹è½½æ–‡ä»¶åŠŸèƒ½æœ‰ä¸€ä¸ªbugã€‚å¦‚æœä¸‹è½½æ—¶æŠ›å‡ºäº†å¼‚å¸¸ï¼Œä¹Ÿä¼šè°ƒç”¨successå›è°ƒã€‚è¿™é‡Œæ˜¯åœ¨ä¸‹è½½æ—¶è®°å½•ç›®æ ‡æ–‡ä»¶çš„é•¿åº¦ï¼Œåœ¨successå›è°ƒä¸­æ£€æŸ¥æœ¬åœ°æ–‡ä»¶å¤§å°ä¸è¿™ä¸ªé•¿åº¦æ˜¯å¦ä¸€è‡´ã€‚ é™é€Ÿä¸‹è½½åœ¨ioæµé‚£é‡Œè¿›è¡Œå»¶æ—¶æ“ä½œã€‚ç”¨Thread.sleepæ–¹æ³•ã€‚é˜»å¡çš„æ˜¯socketçš„æ“ä½œã€‚ ä¸‹è½½å®‰è£…apkä¸‹è½½äº†æ–°ç‰ˆæœ¬apkåï¼Œè°ƒç”¨ä»£ç è¿›è¡Œå®‰è£…ã€‚æ ¹æ®æ‰‹æœºç³»ç»Ÿç‰ˆæœ¬çš„ä¸åŒé€‰æ‹©ä¸åŒçš„å®‰è£…æ–¹å¼ã€‚ 12345678910111213141516public static void installApk(Context context,String downloadApk) { Intent intent = new Intent(Intent.ACTION_VIEW); File file = new File(downloadApk); if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) { Uri apkUri = FileProvider.getUriForFile(context, &quot;com.iNTGO.nndc.fileprovider&quot;, file); intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK); intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION| Intent.FLAG_GRANT_WRITE_URI_PERMISSION); intent.setDataAndType(apkUri, &quot;application/vnd.android.package-archive&quot;); } else { Uri uri = Uri.fromFile(file); intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK); intent.setDataAndType(uri, &quot;application/vnd.android.package-archive&quot;); } context.startActivity(intent);} å¯¹äºå°ç±³4c android 5.1.1ï¼ˆAPI 22ï¼‰ï¼Œå¦‚æœæŠŠapkæ”¾åœ¨appå†…éƒ¨å­˜å‚¨ï¼ŒpackageInstalleræ˜¯æ— æ³•å®‰è£…çš„ã€‚è¦æŠŠapkæ”¾åœ¨å…¬å…±å­˜å‚¨ä¸­æ‰èƒ½å®‰è£…ã€‚ ä¿®æ”¹Androidç³»ç»Ÿé•œåƒï¼ˆimgï¼‰è£…ä¸€ä¸ªVMware Workstation Proï¼Œä¸‹è½½ä¸€ä¸ªUbuntu 16çš„é•œåƒï¼ˆisoï¼‰ã€‚ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„èµ„æºï¼Œæ¯”è¾ƒå¿«ã€‚ä¸€ç³»åˆ—çš„mountï¼Œæ‰“åŒ…åï¼Œåˆ·æœºä¸€ç›´ä¸æˆåŠŸã€‚æ‰¾åˆ°ä¸ªROMåŠ©æ‰‹ï¼Œå°è¯•ä¸€ä¸‹ã€‚ä¿®æ”¹äº†system.imgåï¼Œçº¿åˆ·è¿›å»ï¼Œå¡ç±³ï¼ˆå¡åœ¨å¼€æœºçš„MI logoç•Œé¢ï¼‰ã€‚æŸ¥ä¸€ä¸‹å‘ç°ï¼Œæ˜¯selinuxå¤„äºenforcingçŠ¶æ€ï¼Œæ²¡æ³•è£…ã€‚å°ç±³4cç”¨çš„æ˜¯MIUI8ï¼Œå•†å®¶è¯´æ²¡æ³•rootã€‚MiUI7å¯ä»¥rootã€‚è¿˜æ²¡æ‰¾åˆ°érootæƒ…å†µä¸‹å…³é—­selinuxçš„æ–¹æ³•ã€‚ åŠ¨ç”»æ•ˆæœåŠ ä¸€äº›åŠ¨æ•ˆä¼šè®©ç•Œé¢æ›´åŠ ç”ŸåŠ¨æœ‰æ´»åŠ›ã€‚ å±æ€§åŠ¨ç”» - æ˜Ÿæ˜Ÿé£è¡Œæ§åˆ¶æ˜Ÿæ˜Ÿé£å…¥ï¼Œå®šä½ï¼Œé£å‡ºã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455 final int flyInTime = 100; final int stayTime = 520; final int flyOutTime = 250; final int totalTime = flyInTime + stayTime + flyOutTime; binding.starIv.setX(inX); binding.starIv.setY(yStay); binding.starIv.setVisibility(View.VISIBLE); setStarIvSize(0, 0); final ValueAnimator animator = ValueAnimator.ofInt(1, totalTime); animator.setDuration(totalTime); animator.setInterpolator(new AccelerateInterpolator()); animator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() { @Override public void onAnimationUpdate(ValueAnimator valueAnimator) { int value = (int) valueAnimator.getAnimatedValue(); ImageView starIv = binding.starIv; if (value &lt; flyInTime) { float inProgress = value / (1.0f * flyInTime); float x = inProgress * (xStay - inX) + inX; float y; if (value &lt; flyInTime / 2) { y = yStay + 20 - inProgress * 60; } else { y = yStay - 20 + inProgress * 60; } starIv.setX(x); starIv.setY(y); setStarIvSize((int) (mStarIvOriginWid * (inProgress)), (int) (mStarIvOriginHeight * (inProgress)));// Log.d(TAG, &quot;onAnimationUpdate: value: &quot; + value + &quot;, progress: &quot; + inProgress + &quot;, x: &quot; + x); } else if (value &lt; flyInTime + stayTime) { starIv.setX(xStay); starIv.setY(yStay); setStarIvSize(mStarIvOriginWid, mStarIvOriginHeight); } else { if (valueAnimator.isRunning()) { float progress = (value - flyInTime - stayTime) / (1.0f * flyOutTime); starIv.setX(xStay + (progress * Math.abs(endX - xStay))); starIv.setY(yStay - (progress * Math.abs(endY - yStay))); setStarIvSize((int) (mStarIvOriginWid * (1 - progress)), (int) (mStarIvOriginHeight * (1 - progress))); } } if (value &gt;= totalTime - 10) { binding.starIv.setVisibility(View.GONE); } } }); animator.start(); // æ”¹å˜æ˜Ÿæ˜ŸImageViewçš„å¤§å°ï¼ŒLayoutParamsä¸èƒ½å¼„é”™äº† private void setStarIvSize(int wid, int height) { RelativeLayout.LayoutParams lp = (RelativeLayout.LayoutParams) binding.starIv.getLayoutParams(); lp.width = wid; lp.height = height; binding.starIv.setLayoutParams(lp); } å¦‚æœä¸€ä¸ªViewåœ¨LinearLayouté‡Œï¼Œå®ƒçš„åæ ‡æ²¡æœ‰é‚£ä¹ˆå®¹æ˜“è·å–ã€‚ ä¸‹é¢çš„ä»£ç è·å–åˆ°çš„åæ ‡æ˜¯[0,0]ã€‚1234567imageView.post(new Runnable() { @Override public void run() { int[] location = new int[2]; imageView.getLocationOnScreen(location); }}); åˆ›å»ºè‡ªå®šä¹‰è¿‡æ¸¡åŠ¨ç”» - Googleè‡ªåŠ¨ä¸ºå¸ƒå±€æ›´æ–°æ·»åŠ åŠ¨ç”» - Google é€€å‡ºAppåœ¨ç™»å½•ç•Œé¢ï¼Œç‚¹å‡»è¿”å›é”®å³é€€å‡ºæ•´ä¸ªAppã€‚ 123456789101112131415private boolean mExitApp = false; @Override public void onBackPressed() { super.onBackPressed(); mExitApp = true; } @Override protected void onDestroy() { super.onDestroy(); if (mExitApp) { System.exit(0); } } crashä¸ºäº†æé«˜ç¨‹åºçš„å¥å£®æ€§ï¼Œå¾ˆå¤šæ—¶å€™å¹¶ä¸èƒ½è¿‡äºç›¸ä¿¡æœåŠ¡å™¨è¿”å›çš„ç»“æœã€‚è¯¥åŠ åˆ¤ç©ºå°±åˆ¤ç©ºã€‚å¦‚æœæœåŠ¡å™¨è¿”å›ç©ºçš„æ•°æ®æˆ–è€…å­—æ®µï¼Œè¦æœ‰å¯¹åº”çš„æªæ–½ã€‚ gcè¶…æ—¶è¯¥å¼‚å¸¸è¡¨ç¤ºè°ƒç”¨è¶…æ—¶ã€‚ è§£å†³æ–¹æ¡ˆï¼šä¸€èˆ¬æ˜¯ç³»ç»Ÿåœ¨gcæ—¶ï¼Œè°ƒç”¨å¯¹è±¡çš„finalizeè¶…æ—¶å¯¼è‡´ è§£å†³åŠæ³•ï¼š1.æ£€æŸ¥åˆ†æfinalizeçš„å®ç°ä¸ºä»€ä¹ˆè€—æ—¶è¾ƒé«˜ï¼Œä¿®å¤å®ƒï¼›2.æ£€æŸ¥æ—¥å¿—æŸ¥çœ‹GCæ˜¯å¦è¿‡äºé¢‘ç¹ï¼Œå¯¼è‡´è¶…æ—¶ï¼Œå‡å°‘å†…å®¹å¼€é”€ï¼Œé˜²æ­¢å†…å­˜æ³„éœ²ã€‚ 123456789101112android.content.res.XmlBlock$Parser.finalize() timed out after 10 secondsandroid.content.res.AssetManager.xmlBlockGone(AssetManager.java:500)android.content.res.AssetManager.xmlBlockGone(AssetManager.java:500)android.content.res.XmlBlock.decOpenCountLocked(XmlBlock.java:63)android.content.res.XmlBlock.access$1600(XmlBlock.java:34)android.content.res.XmlBlock$Parser.close(XmlBlock.java:448)android.content.res.XmlBlock$Parser.finalize(XmlBlock.java:454)java.lang.Daemons$FinalizerDaemon.doFinalize(Daemons.java:191)java.lang.Daemons$FinalizerDaemon.run(Daemons.java:174)java.lang.Thread.run(Thread.java:818) RuntimeException: Cannot create an instance of classä½¿ç”¨äº†MVVMçš„æ¡†æ¶ï¼Œåˆ›å»ºviewModelæ—¶æŠ¥é”™ã€‚æ£€æŸ¥å‘ç°å¿˜è®°å¤å†™æ–¹æ³•initViewModelã€‚12345@Overridepublic MyViewModel initViewModel() { MyAppViewModelFactory factory = MyAppViewModelFactory.getInstance(getApplication()); return ViewModelProviders.of(this, factory).get(MyViewModel.class);} ANRæ­»å¾ªç¯å¯¼è‡´çš„ANRä¹‹å‰ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œæœ‰ä¸€ä¸ªéšæœºæ·»åŠ ä¸é‡å¤å­—ç¬¦ä¸²çš„åŠŸèƒ½ã€‚12345678while (needCheckList.size() &lt; 3) { Random rd = new Random(); String word = wordList.get(rd.nextInt(wordList.size())); if(!needCheckList.contains(word)) { needCheckList.add(word); } // .....}è¿™æ®µä»£ç çš„æ•ˆç‡ä¸é«˜ã€‚ä¼ªéšæœºæ•°ä¸èƒ½ä¿è¯é«˜æ•ˆåœ°ä¸é‡å¤åœ°å–åˆ°æ–°çš„ä¸‹æ ‡ã€‚åœ¨æŸäº›æ€§èƒ½è¾ƒå·®çš„æ‰‹æœºä¸Šï¼Œé™·å…¥å¤šæ¬¡å¾ªç¯åæœ‰å¯èƒ½å¯¼è‡´anrã€‚ anr message è¡¨æ˜æ­¤æ—¶CPUå ç”¨ç‡è¶…è¿‡100%ã€‚æˆ‘ä»¬ä½¿ç”¨Collections.shuffle(wordList);æ¥ä»£æ›¿ä¼ªéšæœºæ•°ï¼Œä¹Ÿèƒ½å®ç°éšæœºå–å‡ºå­—ç¬¦ä¸²çš„æ•ˆæœã€‚æé«˜å¥å£®æ€§ã€‚ gradleæƒ³åœ¨Terminalé‡Œä½¿ç”¨gradlewå‘½ä»¤ï¼Œè¿˜å¾—å…ˆåœ¨ç”µè„‘ä¸Šå®‰è£…jdkã€‚ç°åœ¨ï¼ˆ2019-11-18ï¼‰æƒ³åœ¨å®˜ç½‘ä¸‹è½½ä¸ªjdkï¼Œè¿˜å¾—ç™»å½•oracleè´¦å·ã€‚ç½‘é€Ÿå¾ˆæ…¢ï¼Œå»åˆ«çš„åœ°æ–¹ä¸‹è½½jdk-8u181-windows-x64ã€‚ å¤šæ¸ é“è‡ªåŠ¨æ‰“åŒ…å‡è®¾æˆ‘ä»¬æœ‰å¾ˆå¤šç§æ¸ é“ï¼Œæ¯ä¸ªæ¸ é“çš„manifestPlaceholdersçš„å†…å®¹éƒ½ä¸åŒã€‚123456productFlavors { xxx { manifestPlaceholders = [XX_ID : &quot;123&quot;, XX_KEY : &quot;key_key&quot;] }} ä¹‹å‰æ¸ é“å°‘çš„æ—¶å€™ï¼Œå¯ä»¥ç‚¹å‡»gradle taskä¸€ä¸ªä¸ªæ¥æ‰“åŒ…ã€‚ç°åœ¨æ¸ é“ç§ç±»å¤šäº†ï¼ˆæ¯”å¦‚äºŒåå¤šä¸ªï¼‰ï¼Œå†ä¸€ä¸ªä¸ªç‚¹å‡»å°±å¾ˆç´¯ã€‚æƒ³è¦ä¸€é”®æ‰“åŒ…æˆ–è€…ä¸€è¡Œå‘½ä»¤æ‰“åŒ…ï¼Œæœ‰ä»€ä¹ˆæˆç†Ÿå¥½ç”¨çš„å¤šæ¸ é“æ‰“åŒ…æ–¹å¼å‘¢ï¼Ÿæˆ‘ä»¬å°è¯•äº†ç¾å›¢ç‚¹è¯„çš„walleï¼Œå·ç§°æ˜¯Android Signature V2 Schemeç­¾åä¸‹çš„æ–°ä¸€ä»£æ¸ é“åŒ…æ‰“åŒ…ç¥å™¨ã€‚è¯•ç€æ¥å…¥walleçš„å§¿åŠ¿å¯èƒ½ä¸å¯¹ï¼Œæ‰“åŒ…ä¸æˆåŠŸã€‚æ­¤æ—¶çœ‹åˆ°æœ‰äººè¯´ä¸æ”¯æŒå¤šæ¸ é“ä¸åŒçš„åŒ…åå’Œé…ç½®manifestPlaceholdersï¼Œæš‚æ—¶å…ˆä¸ä½¿ç”¨walleã€‚ å·²ç»ä½¿ç”¨äº†Buglyï¼Œæœ‰å¾ˆå¤šå½¢å¦‚assembleXxxReleaseçš„ä»»åŠ¡ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ç»ˆç«¯å‘½ä»¤è¡Œé‡Œæ‰§è¡Œgradlewå‘½ä»¤æ¥æ‰“åŒ…ã€‚Windowsç¯å¢ƒä¸‹å°±æ˜¯1gradlew assembleXxxRelease é‚£ä¹ˆå†™ä¸€ä¸ªbatè„šæœ¬ï¼ŒæŠŠè¿™å‡ åä¸ªæ¸ é“åŒ…æŒ‰é¡ºåºä¸€ä¸ªä¸ªæ‰“åŒ…å‡ºæ¥ã€‚1gradlew assembleXxxRelease &amp;&amp; gradlew assembleYyyRelease &amp;&amp; gradlew assembleZzzReleaseè¿™ä¸ªæ–¹æ³•éå¸¸â€œæš´åŠ›â€ï¼Œä»…ä»…æ˜¯æ›¿ä»£äº†æ‰‹åŠ¨æ‰§è¡Œçš„è¿‡ç¨‹ã€‚ æ¡†æ¶BindingCommand é—®é¢˜ç”±äºå†å²åŸå› ï¼ŒAppä½¿ç”¨äº†ä¸€ä¸ªMVVMæ¡†æ¶ã€‚layoutä¸­å¯ä»¥ç»‘å®šBindingCommandã€‚ä¸çŸ¥é“æ˜¯ä¸æ˜¯å¼€å‘å§¿åŠ¿ä¸å¯¹ï¼Œå¿«é€Ÿç‚¹å‡»æŸä¸ªæŒ‰é’®æ—¶ï¼Œå¯¹åº”çš„BindingCommandå¹¶ä¸èƒ½ç«‹å³å“åº”ã€‚è¿ç»­ç‚¹å‡»ä¼šé”™è¿‡ç‚¹å‡»äº‹ä»¶ã€‚123456public BindingCommand myCommand = new BindingCommand(new BindingAction() { @Override public void call() { // my logic }}); è€Œæ¢ç”¨setOnClickListenerå¯ä»¥ç«‹åˆ»ç›‘å¬åˆ°æ¯ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ã€‚ä¸ºäº†è¿½æ±‚å“åº”é€Ÿåº¦ï¼Œåœ¨æŸäº›åœ°æ–¹é‡‡ç”¨è®¾ç½®ç›‘å¬å™¨çš„æ–¹å¼äº†ã€‚ ç•Œé¢UIandroid è·‘é©¬ç¯é‡å¤æŠ–åŠ¨çš„è§£å†³æ–¹æ³•è§£å†³çš„æ–¹æ³•ï¼Œåœ¨è·‘é©¬ç¯æ§ä»¶å¤–å±‚ï¼Œå†åµŒå¥—ä¸€ä¸ªå¸ƒå±€æ§ä»¶ã€‚ 12345678910111213141516171819&lt;LinearLayout android:layout_width=&quot;0dp&quot; android:layout_height=&quot;wrap_content&quot; android:layout_weight=&quot;55&quot; android:orientation=&quot;horizontal&quot;&gt; &lt;com.rustfisher.view.MarqueeTextView android:id=&quot;@+id/tv_name&quot; android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;wrap_content&quot; android:ellipsize=&quot;marquee&quot; android:focusable=&quot;true&quot; android:focusableInTouchMode=&quot;true&quot; android:maxWidth=&quot;150dp&quot; android:singleLine=&quot;true&quot; android:text=&quot;&quot; android:textSize=&quot;10sp&quot; /&gt;&lt;/LinearLayout&gt; EditTextåˆ’è¯é€‰è¯å¼¹å‡ºèœå•etå¯é€‰ï¼Œå¼¹å‡ºäº†ç³»ç»Ÿçš„èœå•ã€‚ etä¸å¯é€‰ï¼Œå¼¹å‡ºäº†è‡ªå®šä¹‰çš„èœå•ã€‚12345678registerForContextMenu(mEt);mEt.setOnCreateContextMenuListener(new View.OnCreateContextMenuListener() { @Override public void onCreateContextMenu(final ContextMenu menu, View v, ContextMenu.ContextMenuInfo menuInfo) { Log.d(TAG, &quot;onCreateContextMenu: selected: &quot; + mEt.getSelectionStart() + &quot;, &quot; + mEt.getSelectionEnd()); // éƒ½æ˜¯0 getMenuInflater().inflate(R.menu.et_menu, menu); }}); etå¯é€‰ï¼Œå¼¹å‡ºäº†è‡ªå®šä¹‰èœå•ã€‚123456789101112131415161718192021222324252627282930313233mEt.setCustomSelectionActionModeCallback(genActionModeCallback1());private ActionMode.Callback genActionModeCallback1() { return new ActionMode.Callback() { @Override public boolean onCreateActionMode(ActionMode mode, Menu menu) { Log.d(TAG, &quot;onCreateActionMode:&quot; + &quot; selected: &quot; + mEt.getSelectionStart() + &quot;, &quot; + mEt.getSelectionEnd()); return true; } @Override public boolean onPrepareActionMode(ActionMode mode, Menu menu) { Log.d(TAG, &quot;onPrepareActionMode: &quot; + &quot; selected: &quot; + mEt.getSelectionStart() + &quot;, &quot; + mEt.getSelectionEnd()); menu.clear(); mode.getMenuInflater().inflate(R.menu.et_menu, menu); return true; } @Override public boolean onActionItemClicked(ActionMode mode, MenuItem item) { Log.d(TAG, &quot;onActionItemClicked: &quot; + &quot; selected: &quot; + mEt.getSelectionStart() + &quot;, &quot; + mEt.getSelectionEnd()); mode.finish(); return false; } @Override public void onDestroyActionMode(ActionMode mode) { Log.d(TAG, &quot;onDestroyActionMode: &quot; + &quot; selected: &quot; + mEt.getSelectionStart() + &quot;, &quot; + mEt.getSelectionEnd()); } };}1+æ‰‹æœºå¯ä»¥ç”¨ï¼Œä½†å°ç±³æ‰‹æœºæ— æ³•å¼¹å‡ºè‡ªå®šä¹‰èœå•ã€‚æ­¤æ³•ä¸èƒ½é€šç”¨ã€‚ ç«–ç›´çš„è¿›åº¦æ¡https://stackoverflow.com/questions/3926395/android-set-a-progressbar-to-be-a-vertical-bar-instead-of-horizontal è·å–statusbaré«˜åº¦åœ¨Activityä¸­è·å–DecorViewã€‚é€šè¿‡DecorViewçš„ä½ç½®æ¥åˆ¤æ–­statusBarçš„é«˜åº¦ã€‚Activityåˆ«è®¾ç½®æˆå…¨å±çš„å°±å¥½ã€‚ 123456private void getStatusBarHeight() { Rect rectangle = new Rect(); Window window = getWindow(); window.getDecorView().getWindowVisibleDisplayFrame(rectangle); Log.d(TAG, &quot;getStatusBarHeight: &quot; + rectangle.top);} è®©statusbarä¸å ä½ç½®ï¼Œå¹¶è®¾ç½®æˆé€æ˜èƒŒæ™¯ã€‚åº•ä¸‹çš„è™šæ‹Ÿç³»ç»ŸæŒ‰é”®ï¼ˆHomeï¼Œbackï¼Œmenuï¼‰ä¸èƒ½å—å½±å“ã€‚12345&lt;style name=&quot;AppTheme&quot; parent=&quot;Theme.AppCompat.DayNight.NoActionBar&quot;&gt; &lt;item name=&quot;android:windowTranslucentStatus&quot;&gt;true&lt;/item&gt; &lt;item name=&quot;android:windowTranslucentNavigation&quot;&gt;false&lt;/item&gt; &lt;item name=&quot;android:statusBarColor&quot;&gt;@android:color/transparent&lt;/item&gt;&lt;/style&gt; drawable - vector assetsé€šè¿‡å¼•å…¥svgæ–‡ä»¶å¾—åˆ°çš„drawableï¼Œlayoutä¸­ç›´æ¥è®¾ç½®srcä½¿ç”¨drawableã€‚å°ç±³4cå’Œçº¢ç±³6Aæ‰‹æœºå±å¹•ä¸Šå›¾åƒé”™ä¹±ã€‚æ”¹å˜ImageViewçš„å¤§å°ä¸èµ·ä½œç”¨ã€‚æ¸…æ¥šasç¼“å­˜ä¹Ÿä¸èµ·ä½œç”¨ã€‚ å¦‚æœä¸åœ¨layoutä¸­è®¾ç½®ï¼Œè€Œæ˜¯åœ¨ä»£ç ä¸­setImageResourceåˆ™æ˜¾ç¤ºæ­£å¸¸ã€‚ è®¾è®¡ç•Œé¢å»èŠ±ç“£ç½‘ä¸Šæ‰¾çµæ„Ÿã€‚æ¯”å¦‚è®¾è®¡åˆ—è¡¨ç•Œé¢ï¼Œå¯ä»¥ç»™æ¯ä¸ªé¡¹ç›®å¢åŠ ä¸€ä¸ªå°èƒŒæ™¯ã€‚å¯ä»¥æ˜¯é¢œè‰²ï¼Œå¯ä»¥æ˜¯èƒŒæ™¯å›¾ã€‚ ç½‘ç»œè¯·æ±‚è®¾è®¡æ¥å£è·å–æ•°æ®é¡¹ç›®é‡Œç”¨OKHttpæ¡†æ¶æ¥è¿›è¡Œç½‘ç»œè¯·æ±‚ã€‚è¿”å›ç»“æœè¢«è½¬åŒ–æˆå¯¹è±¡Entityã€‚åŒä¸€ä¸ªæœåŠ¡å™¨è¿”å›é‡Œè£…æœ‰ç›¸åŒç»“æ„çš„A,B,Cå¯¹è±¡ã€‚å®ƒä»¬çš„åå­—ä¸ä¸€æ ·ï¼ŒGsonFormatçš„æ—¶å€™æ˜¯åˆ†å¼€æˆ3ä¸ªç±»çš„ã€‚ä¸ºäº†è®©ä»£ç æ›´ç®€æ´ï¼ŒæŠŠè¿™3ä¸ªå¯¹è±¡è¿›è¡ŒæŠ½è±¡ã€‚ä¸€å¼€å§‹æ˜¯åšäº†ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè®©è¿™3ä¸ªç±»ç»§æ‰¿ã€‚ä½†æ˜¯OKHttpé‚£è¾¹ä¼šæŠ¥é”™ã€‚ ç„¶åæ”¹ç”¨äº†æ¥å£çš„æ–¹å¼ã€‚è®¾è®¡çš„æ¥å£é‡Œæœ‰ä¸€äº›é€šç”¨æ–¹æ³•ã€‚åœ¨Entityé‡Œè®©é‚£3ä¸ªç±»éƒ½å®ç°è¿™ä¸ªæ¥å£ï¼Œç„¶ååœ¨æ–¹æ³•ä¸­è¿”å›æˆ‘ä»¬è¦çš„æ•°æ®ã€‚ AsyncTaskèµ„æºåˆ†é…AsyncTaskèƒŒåæœ‰ä¸€ä¸ªçº¿ç¨‹æ± ã€‚è°ƒç”¨äº†execute()å¹¶ä¸èƒ½ä¿è¯ä»»åŠ¡ç«‹åˆ»è¢«æ‰§è¡Œã€‚æ¢ç”¨Threadã€‚ Appè®¾ç½®åˆ†å±è®¾ç½®å¦‚æœä¸è¿›è¡Œè®¾ç½®ï¼Œé»˜è®¤æ˜¯å…è®¸åˆ†å±çš„ã€‚è¿™é‡Œæˆ‘ä»¬æŠŠåˆ†å±ç»™ç¦æ­¢ã€‚12android:networkSecurityConfig=&quot;@xml/network_security_config&quot;android:resizeableActivity=&quot;false&quot; æ·»åŠ åœ¨applicationæ ‡ç­¾é‡Œã€‚1234567&lt;application android:name=&quot;.app.MyApplication&quot; android:allowBackup=&quot;true&quot; android:icon=&quot;@mipmap/ic_launcher&quot; android:label=&quot;@string/app_name&quot; android:networkSecurityConfig=&quot;@xml/network_security_config&quot; android:theme=&quot;@style/AppTheme&quot;&gt; adbç³»ç»ŸAppæŠŠapkæ”¾è¿›rootåçš„æ‰‹æœºé‡Œï¼Œå½“åšæ˜¯ç³»ç»Ÿappã€‚ 1234567891011F:\\IE\\MyApp0826\\app\\libs&gt;adb rootF:\\IE\\MyApp0826\\app\\libs&gt;adb remountremount succeededF:\\IE\\MyApp0826\\app\\libs&gt;adb shell mkdir /system/priv-app/MyAppF:\\IE\\MyApp0826\\app\\libs&gt;adb shell chmod 755 /system/priv-app/MyAppF:\\IE\\MyApp0826\\app\\libs&gt;adb shell chmod 644 /system/priv-app/MyApp/MyApp.apkF:\\IE\\MyApp0826\\app\\libs&gt;adb shell chmod 755 /system/priv-app/MyApp/libF:\\IE\\MyApp0826\\app\\libs&gt;adb shell chmod 755 /system/priv-app/MyApp/lib/armF:\\IE\\MyApp0826\\app\\libs&gt;adb shell syncF:\\IE\\MyApp0826\\app\\libs&gt;adb shell reboot èŒƒå›´å†…éšæœºæ•°12Random rand = new Random(seed);int random_integer = rand.nextInt(upperbound-lowerbound) + lowerbound; å†…å­˜æ³„æ¼Handlerä¸å•ä¾‹å•ä¾‹æ¨¡å¼åŠ ä¸ŠHandlerã€‚æœ‰äººæŠŠhandlerç›´æ¥äº¤ç»™å•ä¾‹ã€‚é•¿ç”Ÿå‘½å‘¨æœŸçš„ä¸€ç›´æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼Œæ²¡æ³•å›æ”¶é€ æˆå†…å­˜æ³„æ¼ã€‚ viewModelä¸­æœ‰ä¸€ä¸ªhandlerï¼Œè€Œhandlerè¢«å•ä¾‹æŒæœ‰ã€‚handleræ˜¯ç›´æ¥å®ä¾‹åŒ–çš„ã€‚123456aHandler = new Handler() { @Override public void handleMessage(@NonNull Message msg) { handleResult(msg); }};handleResultæ–¹æ³•ä¸­ä½¿ç”¨äº†viewModelçš„æ•°æ®åˆ—è¡¨ã€‚ è¿™æ ·åœ¨æ–°å»ºä¸€ä¸ªviewModelçš„æ—¶å€™ï¼Œå•ä¾‹æŒæœ‰æ—§çš„handlerï¼ŒhandleræŒæœ‰çš„è¿˜æ˜¯æ—§çš„é‚£ä¸ªæ•°æ®åˆ—è¡¨ã€‚å†…å­˜ä¸­å°±æœ‰2ä»½ä¸ä¸€æ ·çš„æ•°æ®åˆ—è¡¨ã€‚ ä¿®å¤æ–¹æ¡ˆï¼šé¦–å…ˆä¸èƒ½è®©å•ä¾‹æŒæœ‰è¿™ä¸ªhandlerã€‚å…¶æ¬¡é€€å‡ºviewModelçš„æ—¶å€™ï¼ŒæŠŠhandlerä¸­çš„æ¶ˆæ¯æ¸…ç©ºã€‚","link":"/2018/09/01/Dev-note/dev-note-app-learn/"},{"title":"Android OkHttp + Retrofit ä½¿ç”¨ç¤ºä¾‹","text":"æœ¬æ–‡é“¾æ¥ OkHttp + Retrofitä½¿ç”¨ç¤ºä¾‹ã€‚ä»å¼•å…¥ä¾èµ–ï¼Œç¼–å†™æ¥å£ï¼Œåˆ°å‘èµ·ç½‘ç»œè¯·æ±‚ã€‚ https://github.com/square/okhttp ç®€å•ä½¿ç”¨å¼•å…¥ä¾èµ–å¼•å…¥ä¾èµ–ï¼Œä½¿ç”¨Retrofit2ã€‚123implementation 'com.squareup.retrofit2:retrofit:2.1.0'implementation 'com.squareup.retrofit2:converter-gson:2.1.0'implementation 'com.squareup.retrofit2:adapter-rxjava:2.1.0' æŸ¥è¯¢ @Queryä¾‹å¦‚URL https://base_url/backend-service/config?env=devï¼Œé—®å·åé¢å±äºæŸ¥è¯¢å†…å®¹ã€‚ä¸è®ºæ˜¯GETæˆ–POSTï¼Œéƒ½è¦ç”¨@Queryè¿™ä¸ªæ³¨è§£ã€‚å¦åˆ™ä¼šæŠ¥å¼‚å¸¸ã€‚ URLå¡«å……ä¸æ‹¼æ¥å•çº¯URLå¡«å……å¯ä»¥ç”¨@Pathæ³¨è§£ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªpostè¯·æ±‚ã€‚12@POST(&quot;user-service/user/{uid}/token/refresh&quot;)Call&lt;RefreshTokenResp&gt; refreshToken(@Path(&quot;uid&quot;) String uid, @Query(&quot;token&quot;) String token); GETå¸¦æœ‰æŸ¥è¯¢çš„å‚æ•°12345public interface CfgService { @GET(&quot;backend-service/config&quot;) Call&lt;ServerCfgResp&gt; getServerCfg(@Query(&quot;env&quot;) String env);} POSTï¼Œå¸¦æœ‰æŸ¥è¯¢çš„å‚æ•°å’Œbody123456789public interface UserService { @POST(&quot;user-service/login&quot;) Call&lt;LoginResp&gt; login(@Query(&quot;lenovoST&quot;) String token, @Query(&quot;realm&quot;) String realm, @Body RequestBody body); @POST(&quot;user-service/logout&quot;) Call&lt;CommonEntity&gt; logout(@Query(&quot;token&quot;) String token, @Body RequestBody body);} è°ƒç”¨çš„æ—¶å€™è¦åˆ›å»ºRequestBodyï¼›å…ˆè°ƒæŸ¥å¥½åå°æ¥å—çš„bodyç±»å‹ã€‚1234567Map&lt;String, String&gt; map = new HashMap&lt;&gt;();map.put(&quot;system&quot;, &quot;Android&quot;);map.put(&quot;phoneBrand&quot;, Build.BRAND);map.put(&quot;modelNum&quot;, Build.MODEL);Gson gson = new Gson();String bodyJson = gson.toJson(map);RequestBody requestBody = RequestBody.create(MediaType.parse(&quot;application/json&quot;), bodyJson); åˆå§‹åŒ–OkHttpClientï¼›è¿™é‡Œä¿¡ä»»æ‰€æœ‰çš„SSLè¯ä¹¦ï¼ˆæ­£å¼ç¯å¢ƒä¸å»ºè®®è¿™ä¹ˆåšï¼‰ã€‚12345678910111213141516171819202122232425262728293031private CfgService cfgService; public void initService() { SSLSocketFactory sslSocketFactory = null; try { sslSocketFactory = SSLUtils.getSSLSocketFactory(); } catch (Exception e) { e.printStackTrace(); } OkHttpClient.Builder builder = new OkHttpClient.Builder(); if (sslSocketFactory != null) { Log.d(TAG, &quot;sslSocketFactory != null&quot;); builder.sslSocketFactory(sslSocketFactory); } else { Log.w(TAG, &quot;sslSocketFactory == null&quot;); } builder.hostnameVerifier(new HostnameVerifier() { @Override public boolean verify(String hostname, SSLSession session) { return true; // å¼ºåˆ¶è¿”å›true } }); OkHttpClient lenClient = builder.build(); Retrofit retrofit = new Retrofit.Builder() .baseUrl(ServerCfg.HOST_URL) .client(lenClient) .addCallAdapterFactory(RxJavaCallAdapterFactory.create()) .addConverterFactory(GsonConverterFactory.create()) .build(); cfgService = retrofit.create(CfgService.class); } è°ƒç”¨ç½‘ç»œè¯·æ±‚1234567891011mNetworkManager.getUserApi().login(mLenovoToken, ServerCfg.RID, requestBody).enqueue(new Callback&lt;LoginResp&gt;() { @Override public void onResponse(Call&lt;LoginResp&gt; call, final Response&lt;LoginResp&gt; response) { //... } @Override public void onFailure(Call&lt;LoginResp&gt; call, final Throwable t) { //... } }); ä¿¡ä»»æ‰€æœ‰æœåŠ¡å™¨çš„sslå¹¶ä¸æ¨èè¿™ä¹ˆåš 12345678910111213141516171819202122232425262728293031323334353637public class SSLUtils { /** * @return ä¿¡ä»»æ‰€æœ‰æœåŠ¡å™¨ */ public static SSLSocketFactory getSSLSocketFactory() throws Exception { SSLSocketFactory sslSocketFactory = null; SSLContext sslContext = SSLContext.getInstance(&quot;TLS&quot;); sslContext.init(null, new TrustManager[]{createTrustAllManager()}, new SecureRandom()); sslSocketFactory = sslContext.getSocketFactory(); return sslSocketFactory; } public static X509TrustManager createTrustAllManager() { X509TrustManager tm = null; try { tm = new X509TrustManager() { public void checkClientTrusted(X509Certificate[] chain, String authType) throws CertificateException { //do nothingï¼Œæ¥å—ä»»æ„å®¢æˆ·ç«¯è¯ä¹¦ } public void checkServerTrusted(X509Certificate[] chain, String authType) throws CertificateException { //do nothingï¼Œæ¥å—ä»»æ„æœåŠ¡ç«¯è¯ä¹¦ } public X509Certificate[] getAcceptedIssuers() { return new X509Certificate[0]; } }; } catch (Exception e) { } return tm; }} serviceä½¿ç”¨io.reactivex.Observable1234567891011121314import io.reactivex.Observable; // è¿™ä¸ªæ˜¯rx2çš„åŒ…// --- /** * ç”¨æˆ·åé¦ˆæ¥å£ * * @param content ç”¨æˆ·è¾“å…¥çš„åé¦ˆå†…å®¹ */ @POST(&quot;feedbackAction&quot;) Observable&lt;UserFeedback&gt; userFeedback(@Query(&quot;appVersion&quot;) String appVersion, @Query(&quot;phoneModel&quot;) String phoneModel, @Query(&quot;phoneOsVersion&quot;) String osVersion, @Query(&quot;submitContent&quot;) String content); ç¤ºä¾‹1 - Retrofit2ï¼ŒRxJava2å¼•å…¥ä¾èµ–12345implementation 'com.squareup.retrofit2:retrofit:2.5.0'implementation 'com.squareup.retrofit2:converter-gson:2.5.0'implementation 'com.squareup.retrofit2:adapter-rxjava2:2.3.0'implementation 'io.reactivex.rxjava2:rxandroid:2.1.1'implementation 'io.reactivex.rxjava2:rxjava:2.2.8' å®šä¹‰interface1234567891011121314151617181920212223242526272829303132333435363738import java.util.Map;import io.reactivex.Observable;import retrofit2.http.Field;import retrofit2.http.FieldMap;import retrofit2.http.FormUrlEncoded;import retrofit2.http.GET;import retrofit2.http.POST;import retrofit2.http.Query;/** * RustDroneåå°æ¥å£ * Created on 2019-5-17 */public interface RustDroneCommonService { /** * ç”¨æˆ·åé¦ˆæ¥å£ * * @param content ç”¨æˆ·è¾“å…¥çš„åé¦ˆå†…å®¹ */ @FormUrlEncoded @POST(&quot;feedbackAction&quot;) Observable&lt;FeedbackResp&gt; userFeedback(@Field(&quot;appVersion&quot;) String appVersion, @Field(&quot;phoneModel&quot;) String phoneModel, @Field(&quot;phoneOsVersion&quot;) String osVersion, @Field(&quot;submitContent&quot;) String content, @FieldMap Map&lt;String, String&gt; map); /** * è·å–æ‰‹æœºéªŒè¯ç  * * @param mobile æ‰‹æœºå· */ @GET(&quot;verifyCode&quot;) Observable&lt;PhoneCodeResp&gt; getPhoneCode(@Query(&quot;mobile&quot;) String mobile, @Query(&quot;oprType&quot;) int type);} è°ƒç”¨æ¥å£12345678910111213141516171819202122232425262728293031323334353637383940import io.reactivex.Observer;import io.reactivex.android.schedulers.AndroidSchedulers;import io.reactivex.disposables.Disposable;import io.reactivex.schedulers.Schedulers;RustDroneDataCenter.getCenter().getCommonService().userFeedback(BuildConfig.VERSION_NAME, Build.MODEL.replace(&quot; &quot;, &quot;-&quot;), Build.VERSION.RELEASE, fd, ext) .subscribeOn(Schedulers.newThread()) .observeOn(AndroidSchedulers.mainThread()) .subscribe(new Observer&lt;FeedbackResp&gt;() { @Override public void onSubscribe(Disposable d) {// LL.dn(TAG, &quot;onSubscribe: &quot; + d); } @Override public void onNext(FeedbackResp feedbackResp) { LL.dn(TAG, &quot;onNext: &quot; + feedbackResp); if (feedbackResp.getCode() == 0) { popSubmitSuccessDialog(); } else { LL.e(&quot;ä¸Šä¼ ç”¨æˆ·åé¦ˆå¤±è´¥&quot;); mPbLayout.setVisibility(View.GONE); popRetryDialog(); } } @Override public void onError(Throwable e) { LL.e(&quot;ä¸Šä¼ ç”¨æˆ·åé¦ˆå¤±è´¥ code: &quot; + e); mPbLayout.setVisibility(View.GONE); popRetryDialog(); } @Override public void onComplete() { mPbLayout.setVisibility(View.GONE); LL.dn(TAG, &quot;onComplete: ä¸Šä¼ ç»“æŸ&quot;); } }); GithubOnAndroidç¤ºä¾‹ä»£ç åœ°å€ï¼š https://github.com/RustFisher/GithubOnAndroid æ·»åŠ æ‹¦æˆªå™¨å®šä¹‰æ‹¦æˆªå™¨12345678// ä»…ä»…æ˜¯ç¤ºä¾‹ï¼Œä¸åšä»»ä½•å¤„ç†private Interceptor doNothingInterceptor = new Interceptor() { @Override public Response intercept(Chain chain) throws IOException { Log.d(TAG, &quot;Interceptor1: intercept&quot;); return chain.proceed(chain.request()); }}; æ·»åŠ æ‹¦æˆªå™¨12345678910111213141516171819OkHttpClient okHttpClient = new OkHttpClient.Builder() .readTimeout(10, TimeUnit.SECONDS) .connectTimeout(10, TimeUnit.SECONDS) .addInterceptor(doNothingInterceptor) // æ·»åŠ æ‹¦æˆªå™¨ .addInterceptor(new Interceptor() { @Override public Response intercept(Chain chain) throws IOException { Log.d(TAG, &quot;Interceptor2: intercept&quot;); return chain.proceed(chain.request()); } }) .addNetworkInterceptor(new Interceptor() { @Override public Response intercept(Chain chain) throws IOException { Log.d(TAG, &quot;NetworkInterceptor1: intercept&quot;); return chain.proceed(chain.request()); } }) .build(); æ‹¦æˆªå™¨ä¸­å¢åŠ headeræ“ä½œchainä¸­çš„requestã€‚ 1234567891011// æ·»åŠ ä¸€äº›å…¬å…±å‚æ•°private Interceptor RustDroneInterceptor = new Interceptor() { @Override public Response intercept(Chain chain) throws IOException { Request request = chain.request().newBuilder() .addHeader(&quot;token&quot;, UserCenter.getToken()) .build(); return chain.proceed(request); }}; æ›´å¤šè¯·å‚è€ƒï¼š Android OkHttp + Retrofit ä½¿ç”¨ç¤ºä¾‹ Android OkHttp + Retrofit å–æ¶ˆè¯·æ±‚çš„æ–¹æ³• Android OkHttp + Retrofit ä¸‹è½½æ–‡ä»¶ä¸è¿›åº¦ç›‘å¬ Android OkHttp + Retrofit æ–­ç‚¹ç»­ä¼ ","link":"/2018/08/22/Android/Android-OkHttp_Retrofit_use_intro/"},{"title":"ã€Œdroneã€å¼€å‘è®°å½•","text":"æ–œä½“æ–‡å­—è¢«åˆ‡æ‰äº†ä¸€å—TextView.setTextçš„æ—¶å€™åœ¨å³è¾¹åŠ ä¸Šä¸€ä¸ªç©ºæ ¼ã€‚ æˆ–è€…string.xmlä¸­æ·»åŠ &amp;#x200A;æ¥å ä½ã€‚ 1&lt;string name=&quot;dp_page_ready&quot;&gt;READY&amp;#x200A;&lt;/string&gt; æˆ–è€…åœ¨TextView.setTextçš„æ—¶å€™åŠ ä¸Šä¸€ä¸ªç©ºæ ¼ã€‚ åŠ¨æ€ç»™LinearLayoutæ·»åŠ å­Viewä¸€åˆ—27ä¸ªè‡ªå®šä¹‰viewï¼Œå¦‚æœè¦å†™åˆ°xmlé‡Œå°±å¤ªéº»çƒ¦äº†ã€‚åœ¨Javaä»£ç ä¸­æ–°å»ºå­Viewï¼Œè®¾ç½®LayoutParamsï¼Œç„¶åæ·»åŠ åˆ°LinearLayouté‡Œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142private void initGrids() { final int bigGridHeightPx = (int) dpToPx(10); final int bigGrid2MarginVerticalPx = (int) dpToPx(3); final int smallGridHeightPx = (int) dpToPx(6); // è¿™é‡Œæœ‰27ä¸ªæ ¼ç‚¹ final int smallGridMarginBotPx = (int) dpToPx(1); LinearLayout linearLayoutLeft1 = findViewById(R.id.dp_page_g_field_left1); LinearLayout linearLayoutLeft2 = findViewById(R.id.dp_page_g_field_left2); mLeftGridList = new ArrayList&lt;&gt;(); GridsHorView g1 = new GridsHorView(this); GridsHorView g2 = new GridsHorView(this); GridsHorView g3 = new GridsHorView(this); LinearLayout.LayoutParams p1 = new LinearLayout.LayoutParams(LinearLayout.LayoutParams.MATCH_PARENT, bigGridHeightPx); LinearLayout.LayoutParams p2 = new LinearLayout.LayoutParams(LinearLayout.LayoutParams.MATCH_PARENT, bigGridHeightPx); p2.setMargins(0, bigGrid2MarginVerticalPx, 0, bigGrid2MarginVerticalPx); linearLayoutLeft1.addView(g1, p1); linearLayoutLeft1.addView(g2, p2); linearLayoutLeft1.addView(g3, p1); mLeftGridList.addAll(Arrays.asList(g1, g2, g3)); for (int i = 0; i &lt; 27; i++) { GridsHorView smallGrid = new GridsHorView(this); smallGrid.setAlphaValue((int) (255 * (1 - 0.02 * i))); LinearLayout.LayoutParams sp = new LinearLayout.LayoutParams(LinearLayout.LayoutParams.MATCH_PARENT, smallGridHeightPx); sp.setMargins(0, 0, 0, smallGridMarginBotPx); mLeftGridList.add(smallGrid); linearLayoutLeft2.addView(smallGrid, sp); } for (GridsHorView g : mLeftGridList) { g.setOri(GridsHorView.Ori.RIGHT_TO_LEFT); g.disableMode(); g.setCubeCount(1); } // åˆå§‹åŒ–å³è¾¹ï¼ˆP2ï¼‰çš„æ ¼å­...}private float dpToPx(float dp) { return dp * getResources().getDisplayMetrics().density;} è·å–å½“å‰WiFiçš„åå­—éœ€è¦å®šä½æƒé™ã€‚ 1234567891011121314public static String getWiFiName(Context context) { String wifiId = &quot;WIFI_NAME_NOT_FOUND&quot;; try { WifiManager wifiMgr = (WifiManager) context.getSystemService(Context.WIFI_SERVICE); WifiInfo info = wifiMgr.getConnectionInfo(); wifiId = info != null ? info.getSSID() : null; } catch (Exception e) { e.printStackTrace(); } if (!TextUtils.isEmpty(wifiId) &amp;&amp; wifiId.startsWith(&quot;\\&quot;&quot;)) { wifiId = wifiId.substring(1); // åˆ å»å‰é¢é‚£ä¸ªå¼•å· } return wifiId;} è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºåˆ¤æ–­WiFiåç§°çš„å‰ç¼€ã€‚ æ£€æŸ¥æƒé™çš„æ–¹æ³•12345678910111213141516protected void checkPermission(String[] permissions, final int reqCode) { List&lt;String&gt; perList = new ArrayList&lt;&gt;(); for (String p : permissions) { if (PackageManager.PERMISSION_GRANTED != ContextCompat.checkSelfPermission(this, p)) { LL.e(&quot;æ²¡æœ‰æƒé™: &quot; + p); perList.add(p); } } if (!perList.isEmpty()) { String[] per = new String[perList.size()]; for (int i = 0; i &lt; per.length; i++) { per[i] = perList.get(i); } ActivityCompat.requestPermissions(this, per, reqCode); }} è®¾ç½®Clickç›‘å¬å™¨åº”ç”¨åœ¨Activityä¸­ï¼Œç»™ä¸€å †viewè®¾ç½®åŒä¸€ä¸ªç›‘å¬å™¨ 123456789101112// è®¾ç½®ç‚¹å‡»ç›‘å¬å™¨protected void setOnClickListeners(View.OnClickListener l, View... views) { for (View v : views) { v.setOnClickListener(l); }}protected void setOnClickListeners(View.OnClickListener l, int... resIds) { for (int r : resIds) { findViewById(r).setOnClickListener(l); }} è®¾ç½®å­—ä½“å…ˆæŠŠå­—ä½“åŠ è½½å¥½ã€‚ 1234567891011protected void setTvPangMenAndItalic(int... tvResIds) { for (int i : tvResIds) { ((TextView) findViewById(i)).setTypeface(AppControl.getPangMenTf(), Typeface.ITALIC); }}protected void setTvPangMenAndItalic(TextView... tvs) { for (TextView t : tvs) { t.setTypeface(AppControl.getPangMenTf(), Typeface.ITALIC); }} æ”¶èµ·è½¯é”®ç›˜12345678void hideSoftKeyboard() { try { InputMethodManager inputMgr = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE); inputMgr.hideSoftInputFromWindow(getCurrentFocus().getWindowToken(), InputMethodManager.HIDE_NOT_ALWAYS); } catch (Exception e) { LL.e(&quot;rustApp&quot;, e); }} åˆ¤æ–­ç½‘ç»œæ˜¯å¦æœ‰è¿æ¥1234567891011121314151617protected boolean isNetworkAvailable(Context context) { ConnectivityManager connectivity = (ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE); if (connectivity == null) { return false; } else { NetworkInfo[] info = connectivity.getAllNetworkInfo(); if (info != null) { for (NetworkInfo anInfo : info) { if (anInfo.getState() == NetworkInfo.State.CONNECTED) { return true; } } } } return false;} åˆ¤æ–­æŸä¸ªAppæ˜¯å¦å®‰è£…è·å–PackageManageré€šè¿‡åŒ…åæ¥åˆ¤æ–­æŸä¸ªAppæ˜¯å¦å®‰è£…ã€‚ä½†æ˜¯æœ‰çš„æ‰‹æœºåœ¨è·å–PackageManagerçš„æ—¶å€™å°±èƒ½æŠ›å‡ºå¼‚å¸¸ã€‚12345678910protected boolean appInstalledOrNot(String uri) { try { PackageManager pm = getPackageManager(); pm.getPackageInfo(uri, PackageManager.GET_ACTIVITIES); return true; } catch (Exception e) { LL.e(&quot;appInstalledOrNot: &quot; + uri, e); } return false;} æ€»è€Œè¨€ä¹‹è¿™å¹¶ä¸æ˜¯ä¸ªå¾ˆå¥½çš„åŠæ³•ã€‚ æ€§èƒ½ä¼˜åŒ–ä¸€äº›æ€§èƒ½ä¼˜åŒ–çš„å¤„ç†æªæ–½å’Œæ€è€ƒã€‚ ç»™UIçº¿ç¨‹æ›´å¤šçš„CPUèµ„æºæ•°æ®åº“çš„æ“ä½œæ”¾åœ¨å­çº¿ç¨‹ä¸­è¿›è¡Œã€‚æ•°æ®åº“çº¿ç¨‹ä¹Ÿå¯èƒ½ä¼šå’ŒUIçº¿ç¨‹äº‰æŠ¢CPUçš„æ—¶é—´ç‰‡ã€‚å‡è®¾æ•°æ®åº“è¦åˆ é™¤å¤§é‡æ•°æ®ï¼ˆæ¯”å¦‚1ä¸‡æ¡ï¼‰ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•åœ¨æ•°æ®åº“å¤„ç†äº†æŸä¸ªæ•°é‡ï¼ˆä¾‹å¦‚1åƒï¼‰çš„æ“ä½œåï¼Œsleepä¸€ä¸‹ï¼Œç»™UIçº¿ç¨‹è®©å‡ºCPUæ—¶é—´ã€‚ä½†ç°åœ¨ä¸€èˆ¬éƒ½æ˜¯å¤šæ ¸æ‰‹æœºï¼Œå…·ä½“æ•ˆæœæœ‰å¾…è€ƒé‡ã€‚ logè®°å½•å·¥å…·æŠŠlogå†™åˆ°æ–‡ä»¶é‡Œã€‚ç”¨RandomAccessFileä¸MappedByteBufferå†™æ—¥å¿—åˆ°æ–‡ä»¶ä¸­ã€‚ä»»åŠ¡å¤„ç†æ”¾åœ¨å­çº¿ç¨‹ä¸­ï¼Œç”±HandlerThreadæ¥ç®¡ç†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250public class LL { public static abstract class Level { public static final String D = &quot;D&quot;; // æ™®é€šdebug public static final String W = &quot;W&quot;; // è­¦å‘Š public static final String E = &quot;E&quot;; // é”™è¯¯ } private static String defTag = &quot;App&quot;; private static boolean showLogcat = true; private static boolean writeFile = true; // æ³¨æ„ç”³è¯·SDå¡è¯»å†™æƒé™ private static String logFileDir = Environment.getExternalStorageDirectory().getAbsolutePath() + File.separator + &quot;rust&quot; + File.separator + &quot;logs&quot;; private static String fileName; private static List&lt;LogListener&gt; listenerList = new ArrayList&lt;&gt;(); private static HandlerThread handlerThread; private static Handler writerHandler; private static final int LOG_FILE_GROW_SIZE = 1024 * 10; // logæ–‡ä»¶æ¯æ¬¡å¢é•¿çš„å¤§å° private static long gCurrentLogPos = 0; // logæ–‡ä»¶å½“å‰å†™åˆ°çš„ä½ç½® - æ³¨æ„è¦å•çº¿ç¨‹å¤„ç† /** * ä½¿ç”¨å‰å¿…é¡»è°ƒç”¨æ­¤æ–¹æ³•è¿›è¡Œå‡†å¤‡ * * @param context å»ºè®®ä¼ å…¥applicationContext * @param fileDir å­˜æ”¾logæ–‡ä»¶çš„ç›®å½• */ public static void prepare(Context context, @NonNull String fileDir, String logFilePrefix) { gCurrentLogPos = 0; if (TextUtils.isEmpty(fileDir)) { if (Environment.getExternalStorageState().equals( Environment.MEDIA_MOUNTED)) { logFileDir = Environment.getExternalStorageDirectory().getAbsolutePath() + File.separator + &quot;rust&quot; + File.separator + &quot;logs&quot;; } else { logFileDir = context.getFilesDir().getAbsolutePath() + File.separator + &quot;rust&quot; + File.separator + &quot;logs&quot;; } } else { logFileDir = fileDir; } if (null == handlerThread) { handlerThread = new HandlerThread(&quot;LL&quot;); handlerThread.start(); } writerHandler = new Handler(handlerThread.getLooper()); fileName = logFilePrefix + &quot;_&quot; + System.currentTimeMillis() + &quot;.txt&quot;; Log.d(defTag, &quot;[prepare] file: &quot; + fileName); } public static String getLogFileDir() { return logFileDir; } public static String getFileName() { return fileName; } // é€€å‡º public static void quit() { if (writerHandler != null) { writerHandler.removeCallbacksAndMessages(null); } if (handlerThread != null) { handlerThread.quit(); } } public static void setDefTag(String t) { LL.defTag = t; } public static void setWriteFile(boolean w) { LL.writeFile = w; } public static void d(String content) { d(defTag, content, writeFile); } public static void d(String tag, String content) { d(tag, content, writeFile); } public static void dn(String content) { d(defTag, content, false); } // ä¸å†™åˆ°æ–‡ä»¶ä¸­ public static void dn(String tag, String content) { d(tag, content, false); } public static void d(String tag, String content, boolean write) { if (showLogcat) { Log.d(tag, content); } tellLog(Level.D, tag, content); if (write) { if (writerHandler != null) { writerHandler.post(new WriteRunnable(tag, content)); } } } // logçº§åˆ« WARN - w public static void w(String content) { w(defTag, content, writeFile); } public static void w(String tag, String content) { w(tag, content, writeFile); } // ä¸å†™åˆ°æ–‡ä»¶ä¸­ public static void wn(String content) { w(defTag, content, false); } // ä¸å†™åˆ°æ–‡ä»¶ä¸­ public static void wn(String tag, String content) { w(tag, content, false); } public static void w(String tag, String content, boolean write) { if (showLogcat) { Log.w(tag, content); } tellLog(Level.W, tag, content); if (write) { if (writerHandler != null) { writerHandler.post(new WriteRunnable(tag, content)); } } } public static void e(String content) { e(defTag, content); } public static void e(String tag, String content) { e(tag, content, writeFile); } public static void e(String tag, Exception e) { e(tag, e.getMessage(), writeFile); } // åªæ‰“log ä¸å†™æ–‡ä»¶ public static void en(String tag, String content) { e(tag, content, false); } public static void e(String tag, String content, boolean write) { if (showLogcat) { Log.e(tag, content); } tellLog(Level.E, tag, content); if (write) { if (writerHandler != null) { writerHandler.post(new WriteRunnable(tag, content)); } } } private static void tellLog(String level, String tag, String content) { if (null != listenerList) { for (LogListener l : listenerList) { l.onLog(level, tag, content); } } } public static void addListener(LogListener l) { if (null == listenerList) { listenerList = new ArrayList&lt;&gt;(); } listenerList.add(l); } public static void removeListener(LogListener l) { if (null != listenerList) { listenerList.remove(l); } } static class WriteRunnable implements Runnable { String mmTag; String mmContent; WriteRunnable(String tag, String content) { this.mmTag = tag; this.mmContent = content; } @Override public void run() { SimpleDateFormat logTimeFormat = new SimpleDateFormat(&quot;HH:mm:ss.SSS&quot;, Locale.CHINA); String logContent = logTimeFormat.format(new Date()) + &quot; [&quot; + mmTag + &quot;] &quot; + mmContent + &quot;\\r\\n&quot;; try { File dir = new File(logFileDir); if (!dir.exists()) { boolean mk = dir.mkdirs(); Log.d(defTag, &quot;make dir &quot; + mk); } File eFile = new File(logFileDir + File.separator + fileName); byte[] strBytes = logContent.getBytes(); try { RandomAccessFile randomAccessFile = new RandomAccessFile(eFile, &quot;rw&quot;); MappedByteBuffer mappedByteBuffer; final int inputLen = strBytes.length; if (!eFile.exists()) { boolean nf = eFile.createNewFile(); Log.d(defTag, &quot;new log file &quot; + nf); mappedByteBuffer = randomAccessFile.getChannel().map(FileChannel.MapMode.READ_WRITE, gCurrentLogPos, LOG_FILE_GROW_SIZE); } else { mappedByteBuffer = randomAccessFile.getChannel().map(FileChannel.MapMode.READ_WRITE, gCurrentLogPos, inputLen); } if (mappedByteBuffer.remaining() &lt; inputLen) { mappedByteBuffer = randomAccessFile.getChannel().map(FileChannel.MapMode.READ_WRITE, gCurrentLogPos, LOG_FILE_GROW_SIZE + inputLen);// Log.d(defTag, &quot;run: grow size &quot;); }// Log.d(defTag, &quot;run: gCurrentLogPos: &quot; + gCurrentLogPos + &quot;, pos: &quot; + mappedByteBuffer.position() + &quot;, remaining: &quot; + mappedByteBuffer.remaining()); mappedByteBuffer.put(strBytes); gCurrentLogPos += inputLen; } catch (Exception e) { Log.e(defTag, &quot;WriteRunnable run: &quot;, e); if (!eFile.exists()) { boolean nf = eFile.createNewFile(); Log.d(defTag, &quot;new log file &quot; + nf); } FileOutputStream os = new FileOutputStream(eFile, true); os.write(logContent.getBytes()); os.flush(); os.close(); } } catch (Exception e) { e.printStackTrace(); Log.e(defTag, &quot;å†™logæ–‡ä»¶å‡ºé”™: &quot;, e); } } }} ç›‘å¬å™¨ 123public abstract class LogListener { public abstract void onLog(String level, String tag, String content);} è‡ªå®šä¹‰Viewä¸€äº›è‡ªå®šä¹‰çš„viewï¼Œæ¯”å¦‚ä¸€äº›æŠ˜çº¿å›¾ï¼Œæ¡å½¢å›¾ã€‚ æŠ˜çº¿å›¾ ColorAutoLineChartå•ç‹¬ä¸€æ¡æŠ˜çº¿ï¼Œå¯è‡ªåŠ¨ç¼©æ”¾Yè½´é«˜åº¦ã€‚ä½¿ç”¨FloatBufferæ¥å­˜å‚¨æ•°æ®ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151public class ColorAutoLineChart extends View { private static final String TAG = &quot;AppColorAutoLineChart&quot;; private float yMax = 1856f; private float yMin = -1024f; // å›¾è¡¨çº¿æ¡åœ¨viewé¡¶éƒ¨ç•™å‡ºçš„é—´è· float viewYStart = 2; float axisTextSize = 7; private int onShowPointsCount = 256; // å½“å‰æ˜¾ç¤ºçš„æ•°æ®ä¸ªæ•° private int cacheMaxPoint = 9000; // æ•°æ®å­˜å‚¨æœ€å¤§ä¸ªæ•° float axisLineWid = 1f; // åæ ‡è½´çº¿æ¡å®½åº¦ int dataLineWid = 2; // æ•°æ®çº¿é¢œè‰² private int dataColor = Color.WHITE; private float xStep = 1.0f; private float viewWidth; private float viewHeight; private float botLeftXOnView = 0; // å›¾è¡¨å·¦ä¸‹ç‚¹åœ¨viewä¸­çš„xåæ ‡ private float botLeftYOnView = 0; private float originYToBottom = 20; // å›¾è¡¨åŸç‚¹è·ç¦»viewåº•éƒ¨çš„è·ç¦» private FloatBuffer dataBuffer; private Paint bgPaint; private Paint linePaint; private Paint wavePaint; Path wavePath = new Path(); // ç”¨æ¥ç”»æ¸å˜è‰² int waveTopColor = Color.parseColor(&quot;#f65212&quot;); public ColorAutoLineChart(Context context) { this(context, null); } public ColorAutoLineChart(Context context, AttributeSet attrs) { this(context, attrs, 0); } public ColorAutoLineChart(Context context, AttributeSet attrs, int defStyleAttr) { super(context, attrs, defStyleAttr); init(context); } public void addData(int[] data) { for (int i : data) { addData(i); } } public void addData(float data) { dataBuffer.put(data); if (dataBuffer.position() &gt; (dataBuffer.capacity() * 2 / 3)) { float[] bufferArr = dataBuffer.array(); System.arraycopy(bufferArr, dataBuffer.position() - cacheMaxPoint, bufferArr, 0, cacheMaxPoint); dataBuffer.position(cacheMaxPoint);// Log.d(TAG, &quot;æŠŠå½“å‰æ•°æ®ç§»åŠ¨åˆ°bufferèµ·å§‹ä½ç½® &quot; + dataBuffer); } invalidate(); } private void init(Context context) { dataBuffer = FloatBuffer.allocate(3 * cacheMaxPoint); // åˆ†é…3å€çš„ç©ºé—´ bgPaint = new Paint(Paint.ANTI_ALIAS_FLAG); linePaint = new Paint(Paint.ANTI_ALIAS_FLAG); wavePaint = new Paint(Paint.ANTI_ALIAS_FLAG); bgPaint.setStrokeWidth(axisLineWid); bgPaint.setStyle(Paint.Style.STROKE); linePaint.setStrokeWidth(dataLineWid); linePaint.setStyle(Paint.Style.STROKE); linePaint.setColor(dataColor); botLeftXOnView = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 0, context.getResources().getDisplayMetrics()); originYToBottom = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 20, context.getResources().getDisplayMetrics()); viewYStart = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 20, context.getResources().getDisplayMetrics()); axisLineWid = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, 1, context.getResources().getDisplayMetrics()); axisTextSize = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_SP, 8, context.getResources().getDisplayMetrics()); } @Override protected void onSizeChanged(int w, int h, int oldw, int oldh) { super.onSizeChanged(w, h, oldw, oldh); viewWidth = getWidth(); viewHeight = getHeight(); botLeftYOnView = viewHeight - originYToBottom; } @Override protected void onDraw(Canvas canvas) { super.onDraw(canvas); canvas.drawColor(Color.TRANSPARENT); xStep = (viewWidth - botLeftXOnView) / (onShowPointsCount - 1); int dataStartIndexInBuffer = 0; // æ•°æ®åœ¨bufferä¸­çš„èµ·å§‹ä¸‹æ ‡ if (dataBuffer.position() &gt; onShowPointsCount) { dataStartIndexInBuffer = dataBuffer.position() - onShowPointsCount; } float[] bufferArr = dataBuffer.array(); float maxData = bufferArr[0]; float minData = bufferArr[0]; for (int i = dataStartIndexInBuffer; i &lt; dataBuffer.position(); i++) { float cur = bufferArr[i]; if (cur &lt; minData) { minData = cur; } else if (cur &gt; maxData) { maxData = cur; } } drawWave(canvas, dataStartIndexInBuffer); } private void drawWave(Canvas canvas, int dataStartIndexInBuffer) { wavePath.reset(); final float yDataRange = yMax - yMin; final float yAxisRangeOnView = botLeftYOnView - viewYStart; final float yDataStep = yAxisRangeOnView / yDataRange; float[] dataArr = dataBuffer.array(); float maxData = dataArr[dataStartIndexInBuffer]; float waveStartX = botLeftXOnView; float waveStartY = getYL(dataArr[dataStartIndexInBuffer], yDataStep); wavePath.moveTo(waveStartX, waveStartY); for (int i = dataStartIndexInBuffer; i &lt; dataBuffer.position() - 1; i++) { float curData = dataArr[i]; float nextData = dataArr[i + 1]; wavePath.lineTo(botLeftXOnView + (i - dataStartIndexInBuffer + 1) * xStep, getYL(nextData, yDataStep)); canvas.drawLine(botLeftXOnView + (i - dataStartIndexInBuffer) * xStep, getYL(curData, yDataStep), botLeftXOnView + (i - dataStartIndexInBuffer + 1) * xStep, getYL(nextData, yDataStep), linePaint); maxData = Math.max(maxData, nextData); } wavePath.lineTo(viewWidth, viewHeight); wavePath.lineTo(botLeftXOnView, viewHeight); wavePath.lineTo(waveStartX, waveStartY); wavePath.close(); wavePaint.setShader(new LinearGradient(0, getYL(maxData, yDataStep), 0, viewHeight, waveTopColor, Color.TRANSPARENT, Shader.TileMode.CLAMP)); canvas.drawPath(wavePath, wavePaint); } private float getYL(final float yData, float yDataStep) { return botLeftYOnView - (yData - yMin) * yDataStep; }} åå°ç”¨æˆ·è¡Œä¸ºè®°å½•æœ€å¼€å§‹è®¾è®¡åå°æœåŠ¡çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°å¤ªå¤šçš„è®°å½•åŠŸèƒ½ã€‚ä»…ä»…è®°å½•äº†ç”¨æˆ·ç™»å½•è¡Œä¸ºã€‚ä»Šååº”è¯¥è®°å½•æ›´è¯¦ç»†çš„ã€‚ä¾‹å¦‚è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ—¶é—´ï¼Œå®¢æˆ·ç«¯ç±»å‹ï¼ŒuserIDç­‰ç­‰ã€‚è·å–ç”¨æˆ·ä¿¡æ¯æ˜¯å¦æˆåŠŸï¼Œå¯ä½œä¸ºç¼“å­˜ç™»å½•çš„ä¾æ®ã€‚ åå°å¯ä»¥è®°å½•çš„ç”¨æˆ·è¡Œä¸ºï¼Œä¾‹å¦‚è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œç”¨æˆ·æŸ¥çœ‹é£è¡Œè®°å½•åˆ—è¡¨ï¼Œç”¨æˆ·æŸ¥çœ‹é£è¡Œè®°å½•è¯¦æƒ…ï¼Œç”¨æˆ·ç‚¹èµã€‚ WebViewè®¾ç½®webviewä¸æ˜¾ç¤ºå›¾ç‰‡çš„é—®é¢˜ã€‚LLååŠ è½½httpsçš„ç½‘é¡µï¼Œé»˜è®¤ä¼šä¸åŠ è½½httpçš„èµ„æºã€‚éœ€è¦è®¾ç½®ã€‚ 12webSettings.setBlockNetworkImage(false);webSettings.setMixedContentMode(WebSettings.MIXED_CONTENT_ALWAYS_ALLOW); æ–¹æ³•è°ƒç”¨è®°å½•è°ƒç”¨åŸå› è°ƒç”¨æŸä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œæ¯”å¦‚ä¸­æ­¢æŸé¡¹åŠŸèƒ½ã€‚å¯ä»¥åœ¨logä¸Šè®°å½•ä¸€äº›åŸå› ï¼Œæ–¹ä¾¿debugã€‚ Glideè®¾å®šæ’­æ”¾gifçš„æ¬¡æ•°1234567891011121314151617181920Glide.get(getApplicationContext()).setMemoryCategory(MemoryCategory.NORMAL);Glide.with(this).asGif().listener(new RequestListener&lt;GifDrawable&gt;() { @Override public boolean onLoadFailed(@Nullable GlideException e, Object model, Target&lt;GifDrawable&gt; target, boolean isFirstResource) { return false; } @Override public boolean onResourceReady(GifDrawable resource, Object model, Target&lt;GifDrawable&gt; target, DataSource dataSource, boolean isFirstResource) { resource.setLoopCount(1); return false; }}).load(R.drawable.app_start_up).into(imageView);imageView.setOnApplyWindowInsetsListener(new View.OnApplyWindowInsetsListener() { @Override public WindowInsets onApplyWindowInsets(View v, WindowInsets insets) { MyAppControl.setPhoneStatusBarHeight(insets.getSystemWindowInsetTop()); return insets; }});","link":"/2018/07/29/Dev-note/dev-note-app-drone/"},{"title":"Flutter International å›½é™…åŒ–ï¼ŒLocalization æœ¬åœ°åŒ–ï¼Œ ä½¿ç”¨å­—ç¬¦ä¸²Map","text":"è®°å½•ä¸€ç§ç®€å•çš„æ–¹å¼å®ç°å­—ç¬¦ä¸²çš„å›½é™…åŒ–ã€‚ è¿™é‡Œæ²¡æœ‰ç”¨åˆ°IntlåŒ…ï¼Œè€Œæ˜¯å°†æ‰€éœ€çš„å­—ç¬¦ä¸²å­˜æ”¾åœ¨ä¸€ä¸ªmapä¸­ã€‚ æ­¥éª¤ï¼š MaterialAppä¸­æ·»åŠ æœ¬åœ°åŒ–ä»£ç†å’Œè¯­è¨€ç±»å‹ åˆ›å»ºæ–‡å­—èµ„æºæ–‡ä»¶ æ–°å»ºä¸€ä¸ªç±»ç»§æ‰¿LocalizationsDelegateï¼Œå’Œæ–‡å­—èµ„æºæ–‡ä»¶è”ç³»èµ·æ¥ ä½¿ç”¨ä»£ç†è·å–æƒ³è¦çš„æ–‡å­—èµ„æº æ–°å»ºé¡¹ç›®international_demoï¼Œå¾—åˆ°ä¸€ä¸ªå¸¦æŒ‰é’®ç¤ºä¾‹å·¥ç¨‹ã€‚æ”¹é€ ä¸€ä¸‹MaterialAppã€‚12345678910111213141516171819202122class MyApp extends StatelessWidget { @override Widget build(BuildContext context) { return new MaterialApp( title: 'Flutter Demo', theme: new ThemeData( primarySwatch: Colors.blue, ), localizationsDelegates: [// æ·»åŠ åŒºåŸŸ // å‡†å¤‡åœ¨è¿™é‡Œæ·»åŠ æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„ä»£ç† GlobalMaterialLocalizations.delegate, GlobalWidgetsLocalizations.delegate, ], supportedLocales: [ // æ·»åŠ åŒºåŸŸ const Locale('en', 'US'), // English const Locale('he', 'IL'), // Hebrew // å¯ä»¥ç»§ç»­æ·»åŠ æˆ‘ä»¬æƒ³è¦æ”¯æŒçš„è¯­è¨€ç±»å‹ ], home: new MyHomePage(title: 'Flutter Demo Home Page'), ); }} åˆ›å»ºèµ„æºæ–‡ä»¶æ–°å»ºlocalization_src.dartï¼Œå°†å­—ç¬¦ä¸²å­˜å…¥ä¸€ä¸ªmapä¸­ã€‚123456789101112131415161718192021222324252627import 'package:flutter/material.dart';class DemoLocalizations { DemoLocalizations(this.locale); final Locale locale; static DemoLocalizations of(BuildContext context) { return Localizations.of&lt;DemoLocalizations&gt;(context, DemoLocalizations); } static Map&lt;String, Map&lt;String, String&gt;&gt; _localizedValues = { 'en': { 'title': 'Hello World', }, 'es': { 'title': 'Hola Mundo', }, 'zh': { 'title': 'ä½ å¥½å‘€', }, }; String get title { return _localizedValues[locale.languageCode]['title']; }}è¿™é‡Œä»…ä»¥titleä¸ºä¾‹ï¼Œæœ‰è‹±è¯­ã€è¥¿ç­ç‰™è¯­å’Œä¸­æ–‡ä¸‰ç§ã€‚ åˆ›å»ºä»£ç†æ–°å»ºä¸€ä¸ªç±»ç»§æ‰¿LocalizationsDelegateï¼Œå¤å†™3ä¸ªæ–¹æ³•ã€‚12345678910111213141516171819202122import 'dart:async';import 'package:flutter/foundation.dart';import 'package:flutter/material.dart';import 'package:international_demo/localization_src.dart';class DemoLocalizationsDelegate extends LocalizationsDelegate&lt;DemoLocalizations&gt; { const DemoLocalizationsDelegate(); @override bool isSupported(Locale locale) =&gt; ['en', 'es', 'zh'].contains(locale.languageCode); @override Future&lt;DemoLocalizations&gt; load(Locale locale) { return SynchronousFuture&lt;DemoLocalizations&gt;(DemoLocalizations(locale)); } @override bool shouldReload(DemoLocalizationsDelegate old) =&gt; false;}å¤å†™çš„loadæ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†SynchronousFutureã€‚ ä½¿ç”¨ä»£ç†å›åˆ°main.dartã€‚12345678910111213141516171819202122class MyApp extends StatelessWidget { @override Widget build(BuildContext context) { return new MaterialApp( title: 'Flutter Demo', theme: new ThemeData( primarySwatch: Colors.blue, ), localizationsDelegates: [ DemoLocalizationsDelegate(),// è¿™æ˜¯æˆ‘ä»¬æ–°å»ºçš„ä»£ç† GlobalMaterialLocalizations.delegate, GlobalWidgetsLocalizations.delegate, ], supportedLocales: [ const Locale('en', 'US'), // English const Locale('he', 'IL'), // Hebrew const Locale('zh', ''), // æ–°æ·»ä¸­æ–‡ï¼Œåé¢çš„countryCodeæš‚æ—¶ä¸æŒ‡å®š ], home: new MyHomePage(title: 'Flutter Demo Home Page'), ); }} åœ¨_MyHomePageStateä¸­è°ƒç”¨DemoLocalizationsã€‚12DemoLocalizations localizations = DemoLocalizations.of(context);print(localizations); // æ‰“å°å‡º I/flutter (25535): Instance of 'DemoLocalizations'è§‚å¯Ÿlogcatï¼Œå¯çŸ¥æˆ‘ä»¬è·å¾—äº†DemoLocalizationsçš„å®ä¾‹ã€‚ è·å–title1DemoLocalizations.of(context).title å¦‚æœéœ€è¦æ›´å¤šçš„å­—ç¬¦ä¸²ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åœ¨èµ„æºæ–‡ä»¶çš„mapä¸­æ·»åŠ ã€‚è¿™é‡Œä»…ä»¥titleä¸ºä¾‹ã€‚ å‚è€ƒï¼š å®˜æ–¹æ–‡æ¡£ https://flutter.io/tutorials/internationalization/","link":"/2018/07/16/Flutter/Flutter-International_localization_with_string_map/"},{"title":"Flutter International å›½é™…åŒ–ï¼ŒLocalization æœ¬åœ°åŒ–ï¼Œ ä½¿ç”¨Intl","text":"æ–°å»ºé¡¹ç›®ï¼Œå¾—åˆ°ä¸€ä¸ªç¤ºä¾‹å·¥ç¨‹ã€‚æœ¬ä¾‹ä¸­ä½¿ç”¨intlåŒ…æ¥ç®¡ç†æ–‡å­—èµ„æºã€‚ é¡¹ç›®åœ°å€ï¼š https://github.com/RustFisher/localization_demo æ­¥éª¤ï¼š æ·»åŠ ä¾èµ–é¡¹ - intl åˆ›å»ºæ–‡å­—èµ„æºæ–‡ä»¶ ç”Ÿæˆarbæ–‡ä»¶ æ–°å¢å’Œä¿®æ”¹arbæ–‡ä»¶ æ ¹æ®arbç”Ÿæˆdartæ–‡ä»¶ åˆ›å»ºlocalizationä»£ç†ï¼Œæ–°å»ºä¸€ä¸ªç±»ç»§æ‰¿LocalizationsDelegateï¼Œå’Œæ–‡å­—èµ„æºæ–‡ä»¶è”ç³»èµ·æ¥ MaterialAppä¸­æ·»åŠ æœ¬åœ°åŒ–ä»£ç†å’Œè¯­è¨€ç±»å‹ ä½¿ç”¨æ–‡å­—èµ„æº æ·»åŠ ä¾èµ–é¡¹pubspec.yamlæ·»åŠ ä¾èµ–é¡¹flutter_localizationsï¼Œç„¶åè¿è¡Œä¸€ä¸‹flutter packages getã€‚12345678dependencies: flutter: sdk: flutter# æ·»åŠ ä¸‹é¢çš„ä¾èµ–é¡¹ flutter_localizations: sdk: flutter intl: 0.15.6 intl_translation: 0.16.7 ç¼–è¾‘dartæ–‡ä»¶æ–°å»ºapp_strings.dartæ–‡ä»¶ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344import 'dart:async';import 'package:intl/intl.dart';import 'package:flutter/widgets.dart';class AppStrings { AppStrings(Locale locale) : _localeName = locale.toString(); final String _localeName; static Future&lt;AppStrings&gt; load(Locale locale) { return initializeMessages(locale.toString()) .then((Object _) { return new AppStrings(locale); }); } static AppStrings of(BuildContext context) { return Localizations.of&lt;AppStrings&gt;(context, AppStrings); } String title() { return Intl.message( 'Localization Demo', name: 'title', desc: 'åº”ç”¨æ ‡é¢˜', locale: _localeName, ); } String click() =&gt; Intl.message( 'Click', name: 'click', desc: 'ç‚¹å‡»', locale: _localeName, ); String helloFromDemo() =&gt; Intl.message( 'Hello~', name: 'helloFromDemo', desc: 'ä¸€å¥é—®å€™', locale: _localeName, );}æ­¤æ—¶initializeMessagesæ–¹æ³•ä¼šæ˜¾ç¤ºè­¦å‘Šï¼Œæš‚æ—¶ä¸ç”¨ç®¡ï¼Œç”Ÿæˆarbæ–‡ä»¶åå†æ·»åŠ å¼•ç”¨ã€‚ ç”Ÿæˆarbæ–‡ä»¶è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œè¿è¡Œintlçš„å‘½ä»¤ã€‚12/e/ws/localization_demo$ flutter pub pub run intl_translation:extract_to_arb --output-dir=lib/l10n lib/app_strings.dart ç”Ÿæˆl10n/intl_messages.arbï¼Œå†…å®¹å¦‚ä¸‹ã€‚å¯ä»¥çœ‹å‡ºæ˜¯JSONæ ¼å¼çš„æ–‡æœ¬ã€‚123456789101112131415161718192021{ &quot;@@last_modified&quot;: &quot;2018-07-15T22:13:19.218221&quot;, &quot;title&quot;: &quot;Localization Demo&quot;, &quot;@title&quot;: { &quot;description&quot;: &quot;åº”ç”¨æ ‡é¢˜&quot;, &quot;type&quot;: &quot;text&quot;, &quot;placeholders&quot;: {} }, &quot;click&quot;: &quot;Click&quot;, &quot;@click&quot;: { &quot;description&quot;: &quot;ç‚¹å‡»&quot;, &quot;type&quot;: &quot;text&quot;, &quot;placeholders&quot;: {} }, &quot;helloFromDemo&quot;: &quot;Hello~&quot;, &quot;@helloFromDemo&quot;: { &quot;description&quot;: &quot;ä¸€å¥é—®å€™&quot;, &quot;type&quot;: &quot;text&quot;, &quot;placeholders&quot;: {} }} æ–°å¢å’Œä¿®æ”¹arbæ–‡ä»¶å‰é¢ç”Ÿæˆäº†l10n/intl_messages.arbï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒå½“æˆæ¨¡æ¿ã€‚å¤åˆ¶ç²˜è´´ä¸€ä¸‹ï¼ŒåŒç›®å½•ä¸‹å¾—åˆ°intl_en.arbå’Œintl_zh.arbã€‚æ–‡ä»¶åè§„åˆ™å¯ä»¥è‡ªå·±å®šã€‚ä»¥intl_zh.arbä¸ºä¾‹ï¼š123456789101112131415161718192021{ &quot;@@last_modified&quot;: &quot;2018-07-15T22:13:19.218221&quot;, &quot;title&quot;: &quot;å›½é™…åŒ–ç¤ºä¾‹App&quot;, &quot;@title&quot;: { &quot;description&quot;: &quot;åº”ç”¨æ ‡é¢˜&quot;, &quot;type&quot;: &quot;text&quot;, &quot;placeholders&quot;: {} }, &quot;click&quot;: &quot;ç‚¹å‡»&quot;, &quot;@click&quot;: { &quot;description&quot;: &quot;ç‚¹å‡»&quot;, &quot;type&quot;: &quot;text&quot;, &quot;placeholders&quot;: {} }, &quot;helloFromDemo&quot;: &quot;ä½ å¥½å‘€~&quot;, &quot;@helloFromDemo&quot;: { &quot;description&quot;: &quot;ä¸€å¥é—®å€™&quot;, &quot;type&quot;: &quot;text&quot;, &quot;placeholders&quot;: {} }}è¿™é‡Œä¹Ÿå¯ä»¥æŠŠintl_messages.arbåˆ æ‰ã€‚æœ¬ä¾‹ä¿ç•™è¿™ä¸ªæ–‡ä»¶ã€‚ æ ¹æ®arbç”Ÿæˆdartæ–‡ä»¶123456$ flutter pub pub run intl_translation:generate_from_arb --output-dir=lib/l10n \\ --no-use-deferred-loading lib/app_strings.dart lib/l10n/intl_*.arbNo @@locale or _locale field found in intl_en, assuming 'en' based on the file name.No @@locale or _locale field found in intl_messages, assuming 'messages' based on the file name.No @@locale or _locale field found in intl_zh, assuming 'zh' based on the file name. æš‚æ—¶æ— è§†è­¦å‘Šã€‚æ­¤æ—¶åœ¨app_strings.dartä¸­æ·»åŠ å¯¹l10n/intl_messages.arbçš„å¼•ç”¨ã€‚1import 'package:localization_demo/l10n/messages_all.dart';è­¦å‘Šæ¶ˆå¤±~ æ›´æ–°äº†arbæ–‡ä»¶åï¼Œéœ€è¦é‡æ–°ç”Ÿæˆdartæ–‡ä»¶ã€‚ åˆ›å»ºlocalizationä»£ç†åˆ›å»ºlocalizations_delegate.dartã€‚æ–°å»ºAppLocalizationsDelegateç±»ç»§æ‰¿LocalizationsDelegateï¼Œå¤å†™æ–¹æ³•ã€‚æ³›å‹æŒ‡å®šä¸ºå‰é¢çš„AppStringsã€‚123456789101112131415161718import 'dart:async';import 'package:flutter/widgets.dart';import 'package:localization_demo/app_strings.dart';class AppLocalizationsDelegate extends LocalizationsDelegate&lt;AppStrings&gt; { @override Future&lt;AppStrings&gt; load(Locale locale) { return AppStrings.load(locale); } @override bool isSupported(Locale locale) =&gt; ['zh', 'en'].contains(locale.languageCode); // æ”¯æŒçš„ç±»å‹è¦åŒ…å«Appä¸­æ³¨å†Œçš„ç±»å‹ @override bool shouldReload(AppLocalizationsDelegate old) =&gt; false;} MaterialAppä¸­æ·»åŠ æœ¬åœ°åŒ–ä»£ç†å’Œè¯­è¨€ç±»å‹123456789101112131415161718192021class MyApp extends StatelessWidget { @override Widget build(BuildContext context) { return new MaterialApp( title: 'Flutter Demo', theme: new ThemeData( primarySwatch: Colors.blue, ), localizationsDelegates: [ AppLocalizationsDelegate(), // æˆ‘ä»¬å®šä¹‰çš„ä»£ç† GlobalMaterialLocalizations.delegate, GlobalWidgetsLocalizations.delegate, ], supportedLocales: [ // æ”¯æŒçš„è¯­è¨€ç±»å‹ const Locale('en', 'US'), // English const Locale('zh', ''), ], home: new MyHomePage(title: 'Flutter Demo Home Page'), ); }} ä½¿ç”¨æ–‡å­—èµ„æºè·å–åˆ°AppStringsçš„å®ä¾‹ã€‚12AppStrings appStrings = AppStrings.of(context);print(appStrings); // logcat: I/flutter ( 7478): Instance of 'AppStrings' æ³¨æ„ï¼Œåœ¨MaterialAppä¸­ä½¿ç”¨æ–‡å­—èµ„æºæ—¶ï¼Œå› ä¸ºcontextçš„å…³ç³»ï¼Œè¦ä½¿ç”¨onGenerateTitleã€‚123onGenerateTitle: (context) { return AppStrings.of(context).title();}, æ”¯æŒè¯­è¨€çš„ç±»å‹ä»£ç†isSupportedæ–¹æ³•ä¸­çš„è¯­è¨€ç±»å‹æœ€å¥½æ˜¯å’ŒAppä¸­supportedLocalesçš„ä¸€è‡´123456789 @override bool isSupported(Locale locale) =&gt; ['zh', 'en'].contains(locale.languageCode);// Appä¸­`supportedLocales` supportedLocales: [ const Locale('en', 'US'), // English const Locale('zh', ''), ],å¦åˆ™å¯èƒ½å‡ºç°è·å–ä¸åˆ°AppStringsçš„å¼‚å¸¸ã€‚ å‚è€ƒï¼š https://flutter.io/tutorials/internationalization/","link":"/2018/07/16/Flutter/Flutter-International_localization_with_Intl/"},{"title":"Flutter Drawer æŠ½å±‰è§†å›¾ä¸è‡ªå®šä¹‰header","text":"ç§»åŠ¨å¼€å‘ä¸­ï¼ŒdrawerLayoutæŠ½å±‰è§†å›¾æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§æ§ä»¶ã€‚ä¸€èˆ¬å°†ç”¨æˆ·çš„å¤´åƒï¼Œç”¨æˆ·åç­‰ä¿¡æ¯åœ¨æŠ½å±‰è§†å›¾ä¸­å‘ˆç°ã€‚drawerä¸­ä¹Ÿå¯ä»¥æä¾›ä¸€äº›é€‰é¡¹ï¼Œæ¯”å¦‚è·³è½¬å»è®¾ç½®é¡µï¼Œè·³è½¬å»ç”¨æˆ·èµ„æ–™é¡µé¢ç­‰ç­‰ã€‚ Flutteræä¾›äº†Drawerç»„ä»¶ï¼›ç»“åˆListViewç­‰ç»„ä»¶ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåœ°åˆ¶ä½œå‡ºæŠ½å±‰è§†å›¾ã€‚ ä½¿ç”¨materialä¸­çš„UserAccountsDrawerHeaderä½¿ç”¨materialä¸­çš„UserAccountsDrawerHeaderï¼Œè®¾ç½®accountNameå’ŒcurrentAccountPictureã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445class MyHomePage extends StatefulWidget { @override State&lt;StatefulWidget&gt; createState() { return new _MyHomePageState(); }}class _MyHomePageState extends State&lt;MyHomePage&gt; { @override Widget build(BuildContext context) { Widget userHeader = UserAccountsDrawerHeader( accountName: new Text('Tom'), accountEmail: new Text('tom@xxx.com'), currentAccountPicture: new CircleAvatar( backgroundImage: AssetImage('images/pic1.jpg'), radius: 35.0,),); return Scaffold(appBar: AppBar(title: Text(&quot;Home&quot;),), body: new Center(child: new Text('Home page'),), drawer: Drawer( child: ListView( padding: EdgeInsets.zero, children: &lt;Widget&gt;[ userHeader , // å¯åœ¨è¿™é‡Œæ›¿æ¢è‡ªå®šä¹‰çš„header ListTile(title: Text('Item 1'), leading: new CircleAvatar(child: new Icon(Icons.school),), onTap: () { Navigator.pop(context); },), ListTile(title: Text('Item 2'), leading: new CircleAvatar(child: new Text('B2'),), onTap: () { Navigator.pop(context); },), ListTile(title: Text('Item 3'), leading: new CircleAvatar( child: new Icon(Icons.list),), onTap: () { Navigator.pop(context); },), ], ), ),); }} ä½¿ç”¨UserAccountsDrawerHeaderæ•ˆæœå¦‚ä¸‹ UserAccountsDrawerHeaderæ–‡æ¡£è¯·è§ https://docs.flutter.io/flutter/material/UserAccountsDrawerHeader-class.html è‡ªå®šä¹‰headerFlutteræœ‰DrawerHeaderï¼Œæˆ‘ä»¬å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰ã€‚ DrawerHeaderè®¾ç½®paddingä¸º0ï¼Œå……æ»¡æ•´ä¸ªé¡¶éƒ¨ DrawerHeaderçš„childä½¿ç”¨Stackï¼Œç›®çš„æ˜¯æ”¾ç½®èƒŒæ™¯å›¾ç‰‡ åœ¨Stackåå·¦ä¸‹çš„ä½ç½®æ”¾ç½®å¤´åƒå’Œç”¨æˆ·å å…ˆç”¨Alignç¡®å®šå¯¹é½æ–¹å¼ä¸ºFractionalOffset.bottomLeft Alignçš„childä¸ºContainerï¼Œå¹¶è®¾å®šä¸€ä¸ªå…·ä½“é«˜åº¦ å¤´åƒä¸æ–‡å­—çš„Containerä»¿ç…§ListTileçš„é£æ ¼ï¼Œå·¦è¾¹æ˜¯ä¸€ä¸ªå¤´åƒï¼Œå³è¾¹æ˜¯æ–‡å­—ï¼›ä½¿ç”¨Rowæ¥åˆ†éš”å¤´åƒå’Œæ–‡å­— æ–‡å­—éƒ¨åˆ†å…ˆç”¨Containerçš„marginåšå‡ºé—´éš”ï¼Œå†æ”¾å…¥ä¸€ä¸ªColumnæ¥å­˜æ”¾Text æ–‡å­—Columnè®¾ç½®æ°´å¹³æ–¹å‘å·¦å¯¹é½ä¸ç«–ç›´æ–¹å‘å±…ä¸­ 12345678910111213141516171819202122232425262728293031323334353637Widget header = DrawerHeader( padding: EdgeInsets.zero, /* paddingç½®ä¸º0 */ child: new Stack(children: &lt;Widget&gt;[ /* ç”¨stackæ¥æ”¾èƒŒæ™¯å›¾ç‰‡ */ new Image.asset( 'images/p_h_r_600.png', fit: BoxFit.fill, width: double.infinity,), new Align(/* å…ˆæ”¾ç½®å¯¹é½ */ alignment: FractionalOffset.bottomLeft, child: Container( height: 70.0, margin: EdgeInsets.only(left: 12.0, bottom: 12.0), child: new Row( mainAxisSize: MainAxisSize.min, /* å®½åº¦åªç”¨åŒ…ä½å­ç»„ä»¶å³å¯ */ crossAxisAlignment: CrossAxisAlignment.start, mainAxisAlignment: MainAxisAlignment.start, children: &lt;Widget&gt;[ new CircleAvatar( backgroundImage: AssetImage('images/pic1.jpg'), radius: 35.0,), new Container( margin: EdgeInsets.only(left: 6.0), child: new Column( crossAxisAlignment: CrossAxisAlignment.start, // æ°´å¹³æ–¹å‘å·¦å¯¹é½ mainAxisAlignment: MainAxisAlignment.center, // ç«–ç›´æ–¹å‘å±…ä¸­ children: &lt;Widget&gt;[ new Text(&quot;Tom&quot;, style: new TextStyle( fontSize: 20.0, fontWeight: FontWeight.w400, color: Colors.white),), new Text(&quot;What's up&quot;, style: new TextStyle( fontSize: 14.0, color: Colors.white),), ], ), ), ],), ), ), ]),); è‡ªå®šä¹‰headerçš„æ•ˆæœå›¾ åœ¨è‡ªå®šä¹‰headerçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»„åˆä½¿ç”¨äº†å¤šç§widgetï¼› æœ‰å±‚å çš„Stackï¼Œç”¨äºå¯¹é½çš„Alignï¼Œè®¾å®šå…·ä½“å°ºå¯¸å’Œmarginçš„Containerï¼Œæ°´å¹³æ”¾ç½®çš„Rowä»¥åŠç«–ç›´æ”¾ç½®çš„Columnã€‚ è¿™äº›widgetçš„å„æœ‰ç‰¹ç‚¹ï¼Œæ ¹æ®å…·ä½“æƒ…å†µæ¥ç»„åˆä½¿ç”¨ã€‚åŒä¸€ä¸ªUIæ•ˆæœï¼Œåšæ³•ä¹Ÿä¸æ­¢ä¸€ç§ã€‚","link":"/2018/07/03/Flutter/Flutter-Drawer_and_custom_header/"},{"title":"Flutter widgetåŠ¨ç”»æ•ˆæœä¹‹CurvedAnimation","text":"åœ¨Androidä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨XMLæ¥æŒ‡å®šåŠ¨ç”»æ ·å¼ï¼Œæˆ–è€…è°ƒç”¨Viewçš„animate()æ–¹æ³•ã€‚åœ¨Flutterä¸­ï¼Œwidgetçš„åŠ¨ç”»æ•ˆæœåˆ©ç”¨animatedåŠ¨ç”»åŒ–ç»„ä»¶çš„åŠ¨ç”»åº“æ¥å®ç°ã€‚ Flutterä¸­ï¼Œä½¿ç”¨AnimationControlleræ¥æ§åˆ¶åŠ¨ç”»æš‚åœã€è°ƒæ•´è¿›åº¦ã€åœæ­¢å’Œå€’é€€ã€‚AnimationControllerç»§æ‰¿è‡ªAnimation&lt;double&gt;ã€‚ åœ¨vsyncä¿¡å·å‘å‡ºæ—¶ï¼Œéœ€è¦ä¸€ä¸ªè§¦å‘å™¨æ¥é€šçŸ¥å®ƒï¼Œä»è€Œåœ¨æ¯å¸§ä¸­äº§ç”Ÿä¸€ä¸ª0åˆ°1çš„çº¿æ€§å·®å€¼ã€‚ ä¸€ä¸ªControllerå¯ä»¥ä¸å¤šä¸ªåŠ¨ç”»è¿›è¡Œå…³è”ã€‚ å½“æ•´ä¸ªå±å¹•åˆ·æ–°å®Œæ¯•ï¼Œå³ä¸€ä¸ªå‚ç›´åˆ·æ–°å‘¨æœŸå®Œæˆï¼Œä¼šæœ‰çŸ­æš‚çš„ç©ºç™½æœŸï¼Œæ­¤æ—¶å‘å‡º VSync ä¿¡å·ã€‚ åŠ¨ç”»æ ·å¼ç¤ºä¾‹ - CurvedAnimationä¸FadeTransitionç”¨CurvedAnimationå®ç°ä¸€ä¸ªåŠ¨ç”»æ•ˆæœã€‚ç»™widgetæŒ‡å®šåŠ¨ç”»æ•ˆæœï¼Œç”¨Controlleræ¥æ§åˆ¶åŠ¨ç”»çš„æ’­æ”¾ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­æ˜¯å…³äºFadeTransitionçš„ã€‚ç”¨ä¸€ä¸ªFloatingActionButtonæ¥æ§åˆ¶åŠ¨ç”»æ’­æ”¾ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101import 'package:flutter/material.dart';void main() =&gt; runApp(new AnimationApp());class AnimationApp extends StatelessWidget { @override Widget build(BuildContext context) { return new MaterialApp( title: 'Animation', theme: new ThemeData(primarySwatch: Colors.blue), home: new HomePage( title: 'åŠ¨ç”»ç¤ºä¾‹', ), ); }}class HomePage extends StatefulWidget { final String title; HomePage({Key key, this.title}) : super(key: key); @override State&lt;StatefulWidget&gt; createState() =&gt; new _HomePageState();}// éœ€è¦Tickerclass _HomePageState extends State&lt;HomePage&gt; with TickerProviderStateMixin { AnimationController controller; CurvedAnimation curveEaseIn, bounceIn, linear, decelerate; bool _animationFlag = true; @override void initState() { super.initState(); controller = new AnimationController( duration: new Duration(milliseconds: 2000), vsync: this); curveEaseIn = new CurvedAnimation(parent: controller, curve: Curves.easeIn); bounceIn = new CurvedAnimation(parent: controller, curve: Curves.bounceIn); linear = new CurvedAnimation(parent: controller, curve: Curves.linear); decelerate = new CurvedAnimation(parent: controller, curve: Curves.decelerate); } @override Widget build(BuildContext context) { buildItemWidget( CurvedAnimation animation, MaterialColor color, String itemText) { return new Column( children: &lt;Widget&gt;[ new FadeTransition( opacity: animation, child: new FlutterLogo( size: 100.0, colors: color, ), ), new Text(itemText) ], ); } return new Scaffold( appBar: new AppBar( title: new Text(widget.title), ), floatingActionButton: new FloatingActionButton( onPressed: () { if (_animationFlag) { controller.forward(); } else { controller.reverse(); } _animationFlag = !_animationFlag; }, child: new Icon(Icons.star), ), body: new Center( child: new GridView.extent( maxCrossAxisExtent: 170.0, padding: const EdgeInsets.all(12.0), children: &lt;Widget&gt;[ buildItemWidget(curveEaseIn, Colors.blue, 'Curves.easeIn'), buildItemWidget(bounceIn, Colors.amber, 'Curves.bounceIn'), buildItemWidget(linear, Colors.red, 'Curves.linear'), buildItemWidget(decelerate, Colors.indigo, 'Curves.decelerate'), buildItemWidget( new CurvedAnimation( parent: controller, curve: Curves.elasticIn), Colors.pink, 'Curves.elasticIn'), buildItemWidget( new CurvedAnimation(parent: controller, curve: Curves.ease), Colors.purple, 'Curves.ease'), ], ), ), ); }}","link":"/2018/06/26/Flutter/Flutter-CurvedAnimation/"},{"title":"Flutter åŠ è½½ç½‘ç»œå›¾ç‰‡çš„å‡ ç§æ–¹å¼","text":"å¯¹å¾ˆå¤šç§»åŠ¨åº”ç”¨æ¥è¯´ï¼ŒåŠ è½½ç½‘ç»œå›¾ç‰‡æ˜¯å¾ˆå¸¸è§çš„åŸºæœ¬åŠŸèƒ½ã€‚Androidä¸­å¸¸ç”¨Glideç­‰å›¾ç‰‡åº“ã€‚Flutteræä¾›äº†Imageç»„ä»¶æ¥å±•ç¤ºä¸åŒç±»å‹çš„å›¾ç‰‡ã€‚ åŠ è½½ç½‘ç»œå›¾ç‰‡æœ‰å‡ ç§æ–¹å¼ï¼š Image.network FadeInImage.memoryNetwork ä½¿ç”¨cached_network_imageä¸­çš„CachedNetworkImage ä½¿ç”¨Image.networkåŠ è½½å›¾ç‰‡æ ¹æ®URLåŠ è½½å›¾ç‰‡ï¼Œä½¿ç”¨Image.networkæ„é€ å™¨123Image.network( 'https://raw.githubusercontent.com/flutter/website/master/_includes/code/layout/lakes/images/lake.jpg',) Imageç»„ä»¶ä¹Ÿæ”¯æŒGIFæ ¼å¼çš„å›¾ç‰‡ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼Œå’Œä¸Šé¢çš„ç”¨æ³•ä¸€æ ·123Image.network( 'https://github.com/flutter/plugins/raw/master/packages/video_player/doc/demo_ipod.gif?raw=true',); Image.networkçš„ä¾‹å­12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152import 'package:flutter/material.dart';void main() =&gt; runApp(new ImageDemoApp());class ImageDemoApp extends StatelessWidget { @override Widget build(BuildContext context) { return new MaterialApp( title: 'Image Demo', home: new HomePage(), ); }}class HomePage extends StatefulWidget { @override State&lt;StatefulWidget&gt; createState() =&gt; new _HomePageState();}class _HomePageState extends State&lt;HomePage&gt; { @override Widget build(BuildContext context) { return new Scaffold( appBar: new AppBar(title: new Text('Web Image Demo Page'),), body: new ListView(children: &lt;Widget&gt;[ Container( margin: EdgeInsets.only(bottom: 12.0), decoration: BoxDecoration(color: Colors.grey), child: Column(children: &lt;Widget&gt;[ Image.network( 'https://raw.githubusercontent.com/flutter/website/master/_includes/code/layout/lakes/images/lake.jpg', ), Text('Image.network') ],), ), Container( margin: EdgeInsets.only(bottom: 12.0), decoration: BoxDecoration(color: Colors.grey), child: Column(children: &lt;Widget&gt;[ Image.network( 'https://github.com/flutter/plugins/raw/master/packages/video_player/doc/demo_ipod.gif?raw=true', ), Text('Image.network Animated Gifs') ],), ), ],), ); }} æœ‰é»˜è®¤å ä½å›¾å’Œæ·¡å…¥æ•ˆæœåœ¨å›¾ç‰‡åŠ è½½è¿‡ç¨‹ä¸­ï¼Œç»™ç”¨æˆ·å±•ç¤ºä¸€å¼ é»˜è®¤çš„å›¾ç‰‡ï¼Œèƒ½æé«˜ç”¨æˆ·ä½“éªŒã€‚ä½¿ç”¨FadeInImageç»„ä»¶æ¥è¾¾åˆ°è¿™ä¸ªåŠŸèƒ½ã€‚FadeInImageèƒ½å¤„ç†å†…å­˜ä¸­ï¼ŒAppèµ„æºæˆ–è€…ç½‘ç»œä¸Šçš„å›¾ç‰‡ã€‚ åŠ è½½ç½‘ç»œå›¾ç‰‡123456import 'package:transparent_image/transparent_image.dart';FadeInImage.memoryNetwork( placeholder: kTransparentImage, image: 'https://github.com/flutter/website/blob/master/_includes/code/layout/lakes/images/lake.jpg?raw=true',); ç¤ºä¾‹æ•ˆæœä½¿ç”¨FadeInImage.memoryNetwork1234567891011121314151617181920212223242526272829303132333435363738import 'package:flutter/material.dart';import 'package:transparent_image/transparent_image.dart';void main() =&gt; runApp(new FadeInImageDemoApp());class FadeInImageDemoApp extends StatelessWidget { @override Widget build(BuildContext context) { return new MaterialApp( title: 'Image Demo', home: new HomePage(), ); }}class HomePage extends StatefulWidget { @override State&lt;StatefulWidget&gt; createState() =&gt; new _HomePageState();}class _HomePageState extends State&lt;HomePage&gt; { @override Widget build(BuildContext context) { return new Scaffold( appBar: new AppBar(title: new Text('Fade In Image Demo Page'),), body: Stack( children: &lt;Widget&gt;[ Center(child: CircularProgressIndicator()), Center(child: FadeInImage.memoryNetwork( image: 'https://raw.githubusercontent.com/flutter/website/master/_includes/code/layout/lakes/images/lake.jpg', placeholder: kTransparentImage/* é€æ˜å›¾ç‰‡ */,)), ], ), ); }} ä½¿ç”¨åº”ç”¨å†…çš„å›¾ç‰‡æ¥åšå ä½å›¾ä½¿ç”¨FadeInImage.assetNetwork ä»£ç 12345678910111213class _HomePageState extends State&lt;HomePage&gt; { @override Widget build(BuildContext context) { return new Scaffold( appBar: new AppBar(title: new Text('Fade In Image Demo Page'),), body: Center(child: FadeInImage.assetNetwork( image: 'https://raw.githubusercontent.com/flutter/website/master/_includes/code/layout/lakes/images/lake.jpg', placeholder: 'images/birds.gif' /* æŒ‡å®šgif */,)), ); }} ä½¿ç”¨ç¼“å­˜å›¾ç‰‡ä½¿ç”¨cached_network_imageåŒ…ã€‚å‚è§ https://pub.dartlang.org/packages/cached_network_image ã€‚123CachedNetworkImage( imageUrl: 'https://github.com/flutter/website/blob/master/_includes/code/layout/lakes/images/lake.jpg?raw=true',); æ·»åŠ placeholdercached_network_imageçš„placeholderæ”¯æŒä»»æ„ç»„ä»¶ï¼Œæ¯”å¦‚CircularProgressIndicator1234CachedNetworkImage( placeholder: CircularProgressIndicator(), imageUrl: 'https://github.com/flutter/website/blob/master/_includes/code/layout/lakes/images/lake.jpg?raw=true',); ä»£ç ç¤ºä¾‹123456789101112131415161718import 'package:flutter/material.dart';import 'package:cached_network_image/cached_network_image.dart';void main() =&gt; runApp(new MyApp());class MyApp extends StatelessWidget { @override Widget build(BuildContext context) { return MaterialApp( title: 'Cached image load', home: Scaffold(appBar: AppBar(title: new Text('Cache Image Load'),), body: Center(child: CachedNetworkImage( placeholder: CircularProgressIndicator(), imageUrl: 'https://github.com/flutter/website/blob/master/_includes/code/layout/lakes/images/lake.jpg?raw=true'),),), ); }}","link":"/2018/06/26/Flutter/Flutter-Load_image_from_network/"},{"title":"Flutter å¸ƒå±€å¸¸ç”¨çš„ widgetsï¼ˆCommon layout widgetsï¼‰","text":"ç®€å•åˆ—ä¸¾æ€»ç»“ä¸€ä¸‹å¸¸ç”¨çš„å¸ƒå±€widgetã€‚Flutteræœ‰ä¸°å¯Œçš„layoutç»„ä»¶åº“ã€‚å…¶ä¸­æœ‰ä¸€äº›æ˜¯å¸¸ç”¨åº“ã€‚ä¸‹é¢çš„widgetåˆ†ä¸ºä¸¤ç±»ï¼šæ ‡å‡†ç»„ä»¶å’Œæ¥è‡ªMaterial Componentsçš„ç‰¹æ®Šç»„ä»¶ã€‚åªæœ‰Material Appèƒ½å¤Ÿä½¿ç”¨Material Componentsçš„ç»„ä»¶ã€‚ æ ‡å‡†ç»„ä»¶ - Standard widgets Container ç»™ä¸€ä¸ªç»„ä»¶æ·»åŠ  padding, margins, è¾¹ç•Œï¼ˆbordersï¼‰, èƒŒæ™¯é¢œè‰²æˆ–å…¶å®ƒè£…é¥°ï¼ˆdecorationsï¼‰ã€‚ GridView å°†å¤šä¸ªwidgetæ”¾åœ¨ä¸€ä¸ªå¯æ»‘åŠ¨çš„è¡¨æ ¼ä¸­ã€‚ ListView å°†å¤šä¸ªwidgetæ”¾åœ¨ä¸€ä¸ªå¯æ»‘åŠ¨çš„åˆ—è¡¨ä¸­ã€‚ Stack åœ¨ä¸€ä¸ªwidgetä¸Šé¢ç›–ä¸Šå¦ä¸€ä¸ªwidgetã€‚ Material Components Card å°†ä¸€äº›ç›¸è¿‘çš„ä¿¡æ¯è£…è¿›ä¸€ä¸ªæœ‰åœ†è§’å’Œé˜´å½±çš„ç›’å­é‡Œã€‚ ListTile ä¸€ä¸ªRowä¸­è£…è½½æœ€å¤š3è¡Œæ–‡å­—ï¼›å¯é€‰åˆ™åœ¨å‰é¢æˆ–å°¾éƒ¨æ·»åŠ å›¾æ ‡ã€‚ ContainerContainerç”¨æ³•æ¯”è¾ƒè‡ªç”±ã€‚å¯ä»¥æŠŠæ•´ä¸ªlayoutæ”¾è¿›containeré‡Œé¢ï¼Œç„¶åæ”¹å˜èƒŒæ™¯é¢œè‰²æˆ–å›¾ç‰‡ã€‚ Container å°ç»“: æ·»åŠ  padding, margins, å’Œè¾¹ç•Œï¼ˆbordersï¼‰ èƒ½å¤Ÿæ›´å¥½èƒŒæ™¯é¢œè‰²å’Œå›¾ç‰‡ åŒ…å«ä¸€ä¸ªå•ç‹¬çš„å­widgetï¼Œè¿™ä¸ªå­widgetå¯ä»¥æ˜¯Rowã€Columnæˆ–ä¸€ä¸ªwidgetæ ‘çš„æ ¹widget æµ‹è¯•ä»£ç widgetdemo/container_page.dart12345678910111213141516import 'package:flutter/material.dart';import 'package:demo_flutter/widgetdemo/container_page.dart';// å¼•å…¥è‡ªå®šä¹‰çš„åŒ…......void main() =&gt; runApp(new MyApp());class MyApp extends StatelessWidget { @override Widget build(BuildContext context) { return new MaterialApp( title: 'Container demo 1', theme: new ThemeData(primarySwatch: Colors.brown), home: new ContainerDemoPage(), // è¿™é‡Œæ¢ä¸Šæƒ³è¦æµ‹è¯•çš„ç•Œé¢ ); }} widgetdemo/container_page.dartä»£ç 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849import 'package:flutter/material.dart';/// containerç¤ºä¾‹ç•Œé¢class ContainerDemoPage extends StatefulWidget { @override State&lt;StatefulWidget&gt; createState() =&gt; new _ContainerDemoPageState();}class _ContainerDemoPageState extends State&lt;ContainerDemoPage&gt; { @override Widget build(BuildContext context) { Expanded imageExpanded(String img) { return new Expanded(child: new Container( decoration: new BoxDecoration( border: new Border.all(width: 10.0, color: Colors.black38), borderRadius: const BorderRadius.all( const Radius.circular(8.0))), margin: const EdgeInsets.all(4.0), child: new Image.asset(img), )); } var container = new Container( decoration: new BoxDecoration(color: Colors.black26), child: new Column( children: &lt;Widget&gt;[ new Row(children: &lt;Widget&gt;[ imageExpanded('images/c1.jpg'), imageExpanded('images/c2.jpg'), ],), new Row(children: &lt;Widget&gt;[ imageExpanded('images/d1.jpg'), imageExpanded('images/d2.jpg'), ],), new Row(children: &lt;Widget&gt;[ imageExpanded('images/p1.jpg'), ],) ], ), ); return new Scaffold( appBar: new AppBar(title: new Text('Container Page demo'),), body: new Center( child: container, ), ); }} GridViewç”¨GridViewæ¥å°†widgetæ”¾å…¥ä¸€ä¸ª2ç»´çš„åˆ—è¡¨ä¸­ã€‚GridViewæä¾›äº†2ä¸ªé¢„è£…é…å¥½çš„åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å»ºç«‹è‡ªå®šä¹‰åˆ—è¡¨ã€‚GridViewæ”¯æŒæ»šåŠ¨ã€‚ GridView å°ç»“: å°†å¤šä¸ªwidgetæ”¾è¿›ä¸€ä¸ªè¡¨æ ¼ä¸­ å½“è¶…å‡ºæ¸²æŸ“èŒƒå›´æ—¶ï¼Œè‡ªåŠ¨æä¾›æ»šåŠ¨åŠŸèƒ½ å¯è‡ªå®šä¹‰æ ¼å­ï¼Œä¹Ÿå¯ç”¨ä¸‹é¢æä¾›çš„2ç§ GridView.count æŒ‡å®šåˆ—çš„æ•°ç›® GridView.extent å…è®¸æŒ‡å®šå­é¡¹çš„æœ€å¤§åƒç´ å®½åº¦ ç¤ºä¾‹1 - ç”¨GridView.extentGridView.extentæŒ‡å®šå­é¡¹å æ®çš„æœ€å¤§å®½åº¦123456789101112131415161718192021222324252627282930313233import 'package:flutter/material.dart';/// gridViewç¤ºä¾‹ç•Œé¢1class GridDemo1Page extends StatefulWidget { @override State&lt;StatefulWidget&gt; createState() =&gt; new _GridDemo1PageState();}class _GridDemo1PageState extends State&lt;GridDemo1Page&gt; { @override Widget build(BuildContext context) { return new Scaffold( appBar: new AppBar(title: new Text('Grid Page 1 demo'),), body: new Center( child: buildGrid(), ), ); } List&lt;Container&gt; _buildGridTileList(int count) { return new List&lt;Container&gt;.generate(count, (int index) =&gt; new Container(child: new Image.asset('images/pic${index + 1}.jpg'),)); } Widget buildGrid() { return new GridView.extent( maxCrossAxisExtent: 150.0, padding: const EdgeInsets.all(4.0), mainAxisSpacing: 4.0, crossAxisSpacing: 4.0, children: _buildGridTileList(30),); }} ç¤ºä¾‹2 - ç”¨GridView.countcrossAxisCountè®¾ä¸º2ï¼Œåˆ†æˆ2åˆ—ã€‚1234567891011Widget buildGrid() { var countGrid = GridView.count( crossAxisCount: 2, mainAxisSpacing: 4.0, crossAxisSpacing: 4.0, padding: const EdgeInsets.all(4.0), childAspectRatio: 1.3, children: _buildGridTileList(30), ); return countGrid;} ListViewListViewèƒ½ä»¥åˆ—çš„å½¢å¼å±•ç¤ºæ•°æ®ã€‚å½“å†…å®¹è¶…è¿‡æ¸²æŸ“èŒƒå›´æ—¶ï¼Œè‡ªåŠ¨æä¾›æ»šåŠ¨çš„åŠŸèƒ½ã€‚ ListView å°ç»“ æŠŠå­è§†å›¾è£…è¿›åˆ—è¡¨ä¸­ æ°´å¹³æˆ–ç«–ç›´éƒ½å¯ä»¥ æ”¯æŒæ»‘åŠ¨ ç›¸æ¯”äºColumnï¼Œå¯é€‰é…ç½®æ¯”è¾ƒå°‘ï¼Œä½†æ›´æ˜“ç”¨å¹¶ä¸”æ”¯æŒæ»‘åŠ¨ å’ŒAndroidä¸­çš„ListViewå·®åˆ«ä¸å¤§ ç¤ºä¾‹1æŠŠListTileå½“åšå­é¡¹æ¥è£…è½½æ•°æ®ã€‚123456789101112131415161718192021222324252627282930import 'package:flutter/material.dart';class ListViewPage extends StatefulWidget { @override State&lt;StatefulWidget&gt; createState() =&gt; new _ListViewPageState();}class _ListViewPageState extends State&lt;ListViewPage&gt; { @override Widget build(BuildContext context) { List&lt;Widget&gt; list = &lt;Widget&gt;[]; for (int i = 0; i &lt; 30; i++) { list.add(new ListTile( title: new Text('title$i', style: _itemTextStyle,), subtitle: new Text('A'), leading: i % 3 == 0 ? new Icon(Icons.theaters, color: Colors.blue,) : new Icon(Icons.restaurant, color: Colors.blue,), )); } return new Scaffold( appBar: new AppBar(title: new Text('ListView Demo'),), body: new Center(child: new ListView(children: list,),), ); }}TextStyle _itemTextStyle = new TextStyle( fontWeight: FontWeight.w500, fontSize: 14.0); å¦å¤–å¯ä»¥å‚è€ƒ https://github.com/flutter/flutter/blob/master/examples/flutter_gallery/lib/demo/colors_demo.dart Stackä½¿ç”¨Stackåœ¨widgetä¹‹ä¸Šæ˜¾ç¤ºå¦ä¸€äº›widgetï¼Œé€šå¸¸ç”¨æ¥æ˜¾ç¤ºå›¾ç‰‡ã€‚æ˜¾ç¤ºçš„widgetå¯ä»¥å®Œå…¨åœ°æŠŠåº•éƒ¨widgetç›–ä½ã€‚ Stack å°ç»“: ç”¨æ¥åœ¨å½“å‰widgetä¸Šé¢å†ç›–ä¸Šä¸€å±‚widget Stack childrenä¸­çš„ç¬¬ä¸€ä¸ªwidgetæ”¾åœ¨æœ€ä¸‹ï¼Œåé¢çš„widgetä¼šä¸€å±‚å±‚ç›–ä¸Šå» Stackçš„å†…å®¹ä¸æ”¯æŒæ»šåŠ¨ å¯ä»¥è£å‰ªè¶…å‡ºèŒƒå›´çš„å­widget Stackç¤ºä¾‹1æ˜¾ç¤ºä¸€ä¸ªCircleAvatar12345678910111213141516171819202122232425262728293031323334import 'package:flutter/material.dart';class StackPage1 extends StatefulWidget { @override State&lt;StatefulWidget&gt; createState() =&gt; new _StackPage1State();}class _StackPage1State extends State&lt;StackPage1&gt; { @override Widget build(BuildContext context) { var stack = new Stack( alignment: const Alignment(0.6, 0.6), children: &lt;Widget&gt;[ new CircleAvatar( backgroundImage: new AssetImage('images/android_1.jpg'), radius: 100.0,), new Container(decoration: new BoxDecoration(color: Colors.black45), child: new Text( 'Android Avatar', style: new TextStyle(color: Colors.white70),),), new Container(decoration: new BoxDecoration(color: Colors.transparent), padding: const EdgeInsets.fromLTRB(0.0, 0.0, 100.0, 0.0), child: new CircleAvatar( backgroundImage: new AssetImage('images/p_box1.png'), backgroundColor: Colors.transparent, radius: 10.0,),), ], ); return new Scaffold( appBar: new AppBar(title: new Text('Stack Demo 1'),), body: new Center(child: stack,), ); }} CardCardæ¥è‡ªMaterialç»„ä»¶åº“ï¼Œå¯åŒ…å«ä¸€äº›æ•°æ®ï¼Œé€šå¸¸ç”¨ListTileæ¥ç»„è£…ã€‚Cardåªæœ‰ä¸€ä¸ªå­widgetï¼Œå¯ä»¥æ˜¯columnã€rowã€listã€gridæˆ–å…¶å®ƒç»„åˆwidgetã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCardæŠŠè‡ªå·±çš„å°ºå¯¸ç¼©å°ä¸º0åƒç´ ã€‚å¯ä»¥ç”¨SizedBoxæ¥æŒ‡å®šcardçš„å°ºå¯¸ã€‚ Flutterä¸­çš„Cardæœ‰åœ†è§’å’Œé˜´å½±æ•ˆæœã€‚ä¿®æ”¹elevationå¯æ”¹å˜é˜´å½±æ•ˆæœã€‚ elevationå–å€¼èŒƒå›´ï¼Œå‚è€ƒ Elevation and Shadows è‹¥è®¾ç½®çš„èŒƒå›´å¤–çš„å€¼ï¼Œé˜´å½±æ•ˆæœä¼šæ¶ˆå¤±ã€‚ Card å°ç»“: å®ç°äº†Material Design card ç”¨äºå±•ç¤ºç›¸å…³çš„æ•°æ® æœ‰ä¸€ä¸ªå­é¡¹ï¼ˆchildï¼‰ï¼Œå¯ä»¥æ˜¯columnã€rowã€listã€gridæˆ–å…¶å®ƒç»„åˆwidget æœ‰åœ†è§’å’Œé˜´å½±æ•ˆæœ ä¸æ”¯æŒæ»šåŠ¨ Cardç¤ºä¾‹1å°†å‰é¢çš„ListViewç¤ºä¾‹ä¿®æ”¹ä¸€ä¸‹123456789101112131415161718192021222324252627282930313233343536import 'package:flutter/material.dart';class ListViewPage extends StatefulWidget { @override State&lt;StatefulWidget&gt; createState() =&gt; new _ListViewPageState();}class _ListViewPageState extends State&lt;ListViewPage&gt; { @override Widget build(BuildContext context) { List&lt;Widget&gt; list = &lt;Widget&gt;[]; for (int i = 0; i &lt; 30; i++) { list.add(new Card(child: new Column( children: &lt;Widget&gt;[ new Image.asset( 'images/pic${i + 1}.jpg',), new ListTile( title: new Text('title$i', style: _itemTextStyle,), subtitle: new Text('A'), leading: i % 3 == 0 ? new Icon(Icons.theaters, color: Colors.blue,) : new Icon(Icons.restaurant, color: Colors.blue,), ), ], ),)); } return new Scaffold( appBar: new AppBar(title: new Text('ListView Demo'),), body: new Center(child: new ListView(children: list,),), ); }}TextStyle _itemTextStyle = new TextStyle( fontWeight: FontWeight.w500, fontSize: 14.0); ListTileæ¥è‡ªMaterialç»„ä»¶åº“çš„æ¨ªå‘ç»„ä»¶ã€‚å¯è‡ªå®šä¹‰3è¡Œæ–‡å­—åŠå…¶å¯é€‰çš„å¤´å°¾å›¾æ ‡ã€‚æ­¤æ§ä»¶å¸¸ä¸Cardæˆ–ListViewä¸€èµ·ç”¨ã€‚ ListTile å°ç»“: å¯å®šåˆ¶3è¡Œå¸¦å›¾æ ‡çš„æ–‡å­— ç›¸æ¯”äºRowï¼Œé…ç½®æ›´å°‘ï¼Œä½†æ›´æ˜“ç”¨ åŠ ä¸€ä¸ªä¸»ç•Œé¢æ”¾ç½®ä¸€äº›æŒ‰é’®ï¼Œç‚¹å‡»è·³è½¬åˆ°ç›¸åº”çš„ç•Œé¢ã€‚ä½¿ç”¨Navigator.of(context).pushNamed(routeName)æ¥è·³è½¬ã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354import 'package:flutter/material.dart';import 'package:demo_flutter/widgetdemo/container_page.dart';import 'package:demo_flutter/widgetdemo/grid_page.dart';import 'package:demo_flutter/widgetdemo/listview_demo.dart';import 'package:demo_flutter/widgetdemo/stack_page1.dart';import 'package:demo_flutter/widgetdemo/button_page.dart';const String CONTAINER_DEMO_PAGE = '/a';void main() { runApp(new MaterialApp( home: new HomePage(), routes: { CONTAINER_DEMO_PAGE: (BuildContext context) =&gt; new ContainerDemoPage(), '/b': (BuildContext context) =&gt; new GridDemo1Page(), '/c': (BuildContext context) =&gt; new ListViewPage(), '/d': (BuildContext context) =&gt; new StackPage1(), '/e': (BuildContext context) =&gt; new ButtonPage(), }, ));}class HomePage extends StatefulWidget { @override State&lt;StatefulWidget&gt; createState() =&gt; new _HomePageState();}class _HomePageState extends State&lt;HomePage&gt; { @override Widget build(BuildContext context) { getGestureDetector(String routeName, String content) { return new GestureDetector ( onTap: () { Navigator.of(context).pushNamed(routeName); }, child: new Container ( padding: EdgeInsets.all(20.0), child: new Center(child: new Text (content),)), ); } return new Scaffold( appBar: new AppBar(title: new Text('Home'),), body: new Column(children: &lt;Widget&gt;[ getGestureDetector(CONTAINER_DEMO_PAGE, 'Container Demo'), getGestureDetector('/b', 'Grid Demo 1'), getGestureDetector('/c', 'ListView Demo'), getGestureDetector('/d', 'Stack Demo'), getGestureDetector('/e', 'Button Page'), ],), ); }}","link":"/2018/06/26/Flutter/Flutter-Layout_common_widgets/"},{"title":"Flutterå·¥ç¨‹å¸¸è§é—®é¢˜é›†åˆ","text":"åœ¨å­¦ä¹ ä½¿ç”¨flutterçš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ä¸€äº›å·¥ç¨‹ä¸Šçš„é—®é¢˜ã€‚æ¯”å¦‚flutterçš„é…ç½®ï¼ŒIDEçš„è®¾ç½®ç­‰ç­‰ã€‚ flutter doctor éœ€è¦jdk1.8éœ€è¦jdk1.8ï¼›å¦‚æœè£…çš„æ˜¯jdk9åŠä»¥åçš„ç‰ˆæœ¬ï¼Œflutter doctorä¼šä¸€ç›´æç¤ºä½ éœ€è¦å‡çº§android SDK https://flutter.io/flutter-for-android/#views flutterå‡çº§é‡åˆ°ç½‘ç»œé”™è¯¯ - Got socket errorwin7åŒå‡»æ‰“å¼€flutter_console.batï¼Œå°è¯•ç”¨flutter upgradeå‡çº§æ—¶ï¼Œé‡åˆ°é”™è¯¯ã€‚12345678E:\\sdk_flutter\\flutter&gt;flutter upgradeChecking Dart SDK version...Downloading Dart SDK from Flutter engine 09d05a38912a3c1a906e95099cac9a7e14fae85f...Unzipping Dart SDK...Updating flutter tool...Got socket error trying to find package mockito at https://pub.dartlang.org.Error: Unable to 'pub upgrade' flutter tool. Retrying in five seconds...æŠ¥é”™ï¼šè¿æ¥ä¸ä¸Šhttps://pub.dartlang.org ç”¨æ¢¯å­å’Œä¸ç”¨æ¢¯å­éƒ½ä¼šæŠ¥è¿™ä¸ªé”™è¯¯ã€‚æŸ¥é˜…å®˜ç½‘https://flutter.io/get-started/install/ å®˜ç½‘è¯´ä¸­å›½ç”¨æˆ·è¯·å‚è€ƒhttps://github.com/flutter/flutter/wiki/Using-Flutter-in-China å‚è€ƒæ–‡ç« å»ºè®®è®¾ç½®2ä¸ªç¯å¢ƒå˜é‡12export PUB_HOSTED_URL=[https://pub.flutter-io.cn](https://pub.flutter-io.cn/) export FLUTTER_STORAGE_BASE_URL=[https://storage.flutter-io.cn](https://storage.flutter-io.cn/)æˆ‘ç”¨çš„æ˜¯win7ï¼Œåœ¨ç¯å¢ƒå˜é‡ -&gt; ç”¨æˆ·å˜é‡ä¸­æ·»åŠ äº†è¿™2ä¸ªå˜é‡12FLUTTER_STORAGE_BASE_URL https://storage.flutter-io.cnPUB_HOSTED_URL https://pub.flutter-io.cn å†é‡æ–°æ‰§è¡Œflutter upgradeå³å¯ ä½¿ç”¨flutter_console.batæ—¶ï¼Œåº”è¯¥ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ Android Studio 3.0.1 çš„flutteré¡¹ç›®æ‰¾ä¸åˆ°è®¾å¤‡ - no connected deviceå°è¯•è¿è¡Œflutteré¡¹ç›®æ—¶ï¼Œå‡ºç°æç¤ºæ¡† æ­¤æ—¶æ³¨æ„åˆ°asé¡¶éƒ¨å·¥å…·æ çš„å³è¾¹å°‘äº†è®¾å¤‡æ¡†ã€Flutter Device Selectionã€‘ çº¢åœˆçš„ä½ç½®æœ¬åº”è¯¥æ˜¾ç¤ºå½“å‰è¿æ¥çš„è®¾å¤‡ï¼Œä½†æ˜¯åœ¨ä»£ç å†™é”™ä¸€æ¬¡åï¼Œè¿™ä¸€æ å°±æ¶ˆå¤±äº†ã€‚ é”™è¯¯æ’æŸ¥å°è¯•æ¸…ç¼“å­˜å¹¶é‡å¯asï¼Œé‚£ä¸€æ ä»ç„¶æœªå‡ºç° flutterå·²ç»å‡çº§åˆ°å½“å‰æœ€æ–°ç‰ˆæœ¬ã€‚åœ¨git-bashä¸­è¿è¡Œflutter doctorï¼Œå¹¶æ²¡æœ‰å‘ç°ä»€ä¹ˆé—®é¢˜ã€‚12345678$ flutter doctorDoctor summary (to see all details, run flutter doctor -v):[âˆš] Flutter (Channel beta, v0.5.1, on Microsoft Windows [Version 6.1.7601], locale zh-CN)[âˆš] Android toolchain - develop for Android devices (Android SDK 27.0.3)[âˆš] Android Studio (version 3.0)[âˆš] Connected devices (1 available)â€¢ No issues found!ç”±æ­¤çŒœæµ‹æ˜¯Android Studioçš„é—®é¢˜ã€‚æ–°å»ºä¸€ä¸ªflutterå·¥ç¨‹ï¼Œè§‚å¯Ÿåˆ°è®¾å¤‡æ¡†åˆæ­£å¸¸äº† é‚£ä¹ˆåŸæ¥å·¥ç¨‹é‡Œé¢ä¸ºä½•æ€»æ˜¯è¯´æ‰¾ä¸åˆ°è®¾å¤‡ï¼Ÿ ä»”ç»†å›æƒ³äº†ä¸€ä¸‹ï¼Œå‚è€ƒflutteræ•™ç¨‹æ—¶ï¼Œæ·»åŠ äº†ä¸€ä¸ªimagesç›®å½•ï¼Œå¹¶ä¸”ä¿®æ”¹äº†pubspec.yamlæ–‡ä»¶ã€‚æ£€æŸ¥å‘ç°assetsçš„ç¼©è¿›å¼„é”™äº†ã€‚æŠŠç¼©è¿›æ”¹æˆ2ä¸ªç©ºæ ¼åï¼Œè®¾å¤‡æ¡†å°±å‡ºç°äº†ã€‚123# To add assets to your application, add an assets section, like this:assets: - images/lake.jpgç”±æ­¤å¯è§ï¼Œaså¯¹pubspec.yamlæ–‡ä»¶ååˆ†æ•æ„Ÿã€‚ Flutter ç¤ºä¾‹å·¥ç¨‹flutter_galleryé‡åˆ°çš„ç½‘ç»œé—®é¢˜betaåˆ†æ”¯çš„flutter_galleryæŠŠèµ„æºæ–‡ä»¶éƒ½æ”¾åœ¨äº† https://flutter.googlesource.com/gallery-assets/ è¿™ä¸ªç”¨æµè§ˆå™¨æ˜¯å¯ä»¥æ‰“å¼€çš„ï¼Œä½†æ˜¯asè¿è¡Œçš„æ—¶å€™ä¼šæŠ¥ fatal: not a git repository ï¼› å‚è€ƒ https://github.com/flutter/flutter/issues/13763 ï¼Œå†³å®šæŠŠchannelåˆ‡æ¢åˆ°master åˆ‡æ¢åˆ°master channelåï¼ŒæŠŠflutterä¸­çš„binç›®å½•æ•´ä¸ªåˆ æ‰ï¼›è¿è¡Œflutter doctoré‡æ–°ä¸‹è½½ä¸€æ¬¡dartçš„SDKã€‚å¯è¿è¡Œmasterä¸­çš„demoã€‚ Android Studioæ‰¾ä¸åˆ°Flutter SDKè¿è¡Œäº†flutter upgradeåï¼Œæ‰“å¼€aså‘ç°æ‰¾ä¸åˆ°SDKäº†ã€‚å¼€å‘ç¯å¢ƒæ˜¯win7ï¼Œè¿›è¡Œæ£€æŸ¥ï¼š ç¯å¢ƒå˜é‡æ˜¯æ­£å¸¸çš„ ä½¿ç”¨cmdè¿è¡Œflutter doctoræ­£å¸¸ asèƒ½è·‘æ™®é€šçš„å®‰å“å·¥ç¨‹ æ£€æŸ¥flutter sdk git ä»“åº“çš„æƒ…å†µï¼Œå‘ç°æœ‰äº›æ–‡ä»¶è¢«ä¿®æ”¹äº†ã€‚ä½¿ç”¨gitå°†å…¶æ›´æ–°ã€‚è¿è¡Œflutter doctoré‡æ–°ç¼–è¯‘SDKã€‚æ‰“å¼€aså‘ç°é—®é¢˜è§£å†³ã€‚","link":"/2018/06/24/Flutter/Flutter-project_common_questions/"},{"title":"Android Intent ä¼ é€’æ•°æ®å¤§å°é™åˆ¶","text":"åœ¨sendBroadcastï¼ŒstartActivityæ—¶ï¼Œæˆ‘ä»¬ä¼šç”¨åˆ°Intentã€‚Intentå¯ä»¥æºå¸¦ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚åŸºæœ¬ç±»å‹æ•°æ®intã€Booleanï¼Œæˆ–æ˜¯Stringï¼Œæˆ–æ˜¯åºåˆ—åŒ–å¯¹è±¡ï¼ŒParcelableä¸Serializableã€‚ Intentä¼ é€’æ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®å¤ªå¤§ï¼Œå¯èƒ½ä¼šå‡ºç°å¼‚å¸¸ã€‚æ¯”å¦‚Appé—ªé€€ï¼Œæˆ–æ˜¯Intentå‘é€ä¸æˆåŠŸï¼ŒlogcatæŠ¥é”™ç­‰ç­‰ã€‚ è¿™å°±ç‰µæ¶‰åˆ°ä¸€ä¸ªé—®é¢˜ï¼šIntent ä¼ é€’æ•°æ®å¤§å°é™åˆ¶ã€‚ Intentåˆ°åº•èƒ½å¤Ÿæºå¸¦å¤šå°‘æ•°æ®å‘¢ï¼Ÿ ä½¿ç”¨Intentä¼ é€æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å¼‚å¸¸åœ¨Intentä¸­ä¼ å…¥ä¸€ä¸ªParcelableå¯¹è±¡ï¼›ä¾‹å¦‚ä¼ å…¥ä¸€ä¸ªbitmapå¯¹è±¡ã€‚ ä»£ç å‚è€ƒï¼š https://github.com/AnRFDev/android-Basic4123Bitmap b1 = Bitmap.createScaledBitmap(srcBmp, dstWid, dstHeight, false);Intent intent = new Intent(MSG_INTENT);intent.putExtra(K_PIC, b1);é€‰æ‹©bitmapçš„åŸå› æ˜¯ï¼ŒBitmapå®ç°äº†Parcelableæ¥å£ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡getByteCount()å¾—çŸ¥æ‰€å å†…å­˜å¤§å°ã€‚ sendBroadcastæ—¶ï¼ŒæŠ¥å‡ºå¦‚ä¸‹ä¿¡æ¯123456789101112131415V/ActivityManager: Broadcast: Intent { act=intent_bi flg=0x10 (has extras) } ordered=false userid=0 callerApp=ProcessRecord{27aeaaf5 31217:com.rustfisher.basic4/u0a113}E/JavaBinder: !!! FAILED BINDER TRANSACTION !!!W/BroadcastQueue: Failure sending broadcast Intent { act=intent_bi flg=0x10 (has extras) } android.os.TransactionTooLargeException at android.os.BinderProxy.transactNative(Native Method) at android.os.BinderProxy.transact(Binder.java:504) at android.app.ApplicationThreadProxy.scheduleRegisteredReceiver(ApplicationThreadNative.java:1170) at com.android.server.am.BroadcastQueue.performReceiveLocked(BroadcastQueue.java:576) at com.android.server.am.BroadcastQueue.deliverToRegisteredReceiverLocked(BroadcastQueue.java:848) at com.android.server.am.BroadcastQueue.processNextBroadcast(BroadcastQueue.java:917) at com.android.server.am.BroadcastQueue$BroadcastHandler.handleMessage(BroadcastQueue.java:254) at android.os.Handler.dispatchMessage(Handler.java:111) at android.os.Looper.loop(Looper.java:194) at android.os.HandlerThread.run(HandlerThread.java:61) at com.android.server.ServiceThread.run(ServiceThread.java:46) æŸ¥çœ‹å¼‚å¸¸ç±»TransactionTooLargeExceptionï¼Œå®ƒç»§æ‰¿äº†RemoteException12345678910package android.os;public class TransactionTooLargeException extends RemoteException { public TransactionTooLargeException() { super(); } public TransactionTooLargeException(String msg) { super(msg); }} ä»æŠ¥é”™ä¿¡æ¯FAILED BINDER TRANSACTIONå¯ä»¥çœ‹å‡ºï¼Œbinderä¼ é€æ•°æ®å¤±è´¥äº†ã€‚è¿½è¸ªåˆ°Binderï¼Œå®ƒçš„transactNativeæ–¹æ³•æŠ¥å‡ºRemoteException12public native boolean transactNative(int code, Parcel data, Parcel reply, int flags) throws RemoteException;æŠ›å‡ºçš„å¼‚å¸¸ä¸Binderæœ‰å…³ã€‚ Intentæºå¸¦ä¿¡æ¯çš„å¤§å°å—Binderé™åˆ¶Intentæºå¸¦ä¿¡æ¯çš„å¤§å°å…¶å®æ˜¯å—Binderé™åˆ¶ã€‚æœ¬æ–‡æ ‡é¢˜ä¹Ÿå¯ä»¥æ”¹ä¸ºâ€œBinderä¼ é€’æ•°æ®å¤§å°é™åˆ¶â€ã€‚ æ•°æ®ä»¥Parcelå¯¹è±¡çš„å½¢å¼å­˜æ”¾åœ¨Binderä¼ é€’ç¼“å­˜ä¸­ã€‚å¦‚æœæ•°æ®æˆ–è¿”å›å€¼æ¯”ä¼ é€’bufferå¤§ï¼Œåˆ™æ­¤æ¬¡ä¼ é€’è°ƒç”¨å¤±è´¥å¹¶æŠ›å‡ºTransactionTooLargeExceptionå¼‚å¸¸ã€‚ Binderä¼ é€’ç¼“å­˜æœ‰ä¸€ä¸ªé™å®šå¤§å°ï¼Œé€šå¸¸æ˜¯1Mbã€‚ä½†åŒä¸€ä¸ªè¿›ç¨‹ä¸­æ‰€æœ‰çš„ä¼ è¾“å…±äº«ç¼“å­˜ç©ºé—´ã€‚ å¤šä¸ªåœ°æ–¹åœ¨è¿›è¡Œä¼ è¾“æ—¶ï¼Œå³æ—¶å®ƒä»¬å„è‡ªä¼ è¾“çš„æ•°æ®ä¸è¶…å‡ºå¤§å°é™åˆ¶ï¼ŒTransactionTooLargeExceptionå¼‚å¸¸ä¹Ÿå¯èƒ½ä¼šè¢«æŠ›å‡ºã€‚ åœ¨ä½¿ç”¨Intentä¼ é€’æ•°æ®æ—¶ï¼Œ1Mbå¹¶ä¸æ˜¯å®‰å…¨ä¸Šé™ã€‚å› ä¸ºBinderä¸­å¯èƒ½æ­£åœ¨å¤„ç†å…¶å®ƒçš„ä¼ è¾“å·¥ä½œã€‚ä¸åŒçš„æœºå‹å’Œç³»ç»Ÿç‰ˆæœ¬ï¼Œè¿™ä¸ªä¸Šé™å€¼ä¹Ÿå¯èƒ½ä¼šä¸åŒã€‚ åœ¨å…¶å®ƒåœ°æ–¹ï¼Œä¾‹å¦‚onSaveInstanceState(@NonNull Bundle outState)ï¼Œä¹Ÿå¯èƒ½ä¼šé‡åˆ°ä¸Binderæœ‰å…³çš„ç±»ä¼¼é—®é¢˜ã€‚ ä¸ºä»€ä¹ˆBinderè¦é™åˆ¶ä¼ è¾“æ•°æ®çš„å¤§å°ä¸ªäººæ¨æµ‹ï¼Œä½œä¸ºä¸€ç§IPCçš„æ–¹å¼ï¼ŒBinderå¹¶ä¸æ˜¯ä¸ºä¼ è¾“å¤§é‡æ•°æ®è€Œè®¾è®¡ã€‚ ä¼ è¾“å¤§é‡æ•°æ®ï¼Œå¯ä»¥è€ƒè™‘URLä¹‹ç±»çš„æ–¹æ³•ã€‚ å‚è€ƒ https://stackoverflow.com/questions/8434423/android-remote-method-data-limit https://developer.android.com/reference/android/os/TransactionTooLargeException","link":"/2018/06/01/Android/Android-Intent_extra_size_limit/"},{"title":"Android NDK Makefileç›¸å…³ä¸ç¤ºä¾‹","text":"Android.mkä¸Application.mkAndroid Studio 3ä¹‹å‰ï¼Œéœ€è¦ç¼–å†™Android.mkå’ŒApplication.mkæ–‡ä»¶ã€‚ ä½¿ç”¨jdk8æˆ–jdk7ä¸­æä¾›çš„javahæ¥ç”Ÿæˆå¤´æ–‡ä»¶ã€‚ build.gradleè®¾å®šjniä»¥ä¸‹æ˜¯æŸæ¨¡å—çš„build.gradleæ–‡ä»¶1234567android { // .... sourceSets.main { jni.srcDirs = [] // ç¦æ­¢è‡ªåŠ¨æ‰§è¡Œndk-build jniLibs.srcDirs = ['src/main/libs'] // è®¾å®šæˆsoæ–‡ä»¶ç”Ÿæˆçš„ç›®å½• }} æŒ‡å®šæ¨¡å—çš„åå­—åœ¨Android.mkæ–‡ä»¶ä¸­æŒ‡å®šæ¨¡å—çš„åå­—1LOCAL_MODULE := modnameç¼–è¯‘å¾—åˆ°libmodname.soæ–‡ä»¶ åŠ è½½åº“æ–‡ä»¶123static { System.loadLibrary(&quot;modname&quot;);} åˆ©ç”¨$(TARGET_ARCH_ABI)åˆ¤æ–­ç›®æ ‡æ¶æ„ç±»åˆ«Android Studio 3ä¹‹å‰ï¼Œéœ€è¦ç¼–å†™Android.mkå’ŒApplication.mkæ–‡ä»¶ã€‚ä½¿ç”¨jdk8æˆ–jdk7ã€‚ ä¸€ä¸ªå…¸å‹Application.mk1234APP_ABI := arm64-v8a armeabi-v7aAPP_PLATFORM := android-19APP_STL := gnustl_staticAPP_CPPFLAGS += -std=c++11æŒ‡å®šäº†2ç§æ¶æ„ åœ¨Android.mkä¸­ï¼Œå¯ä»¥ç”¨$(TARGET_ARCH_ABI)åˆ¤æ–­ç›®æ ‡æ¶æ„ç±»åˆ«ï¼›ä¾‹å¦‚jniç›®å½•ä¸­æœ‰å¦‚ä¸‹çš„æ–‡ä»¶1234567891011jni|-- Android.mk|-- Application.mk|-- something.cpp|-- include| |-- something.h|-- lib| |-- arm64-v8a| | `-- libcustom.a| `-- armeabi-v7a| `-- libcustom.a Android.mkä¸­åˆ¤æ–­å½“å‰ç¼–è¯‘çš„ç›®æ ‡æ¶æ„è€ŒåŠ è½½åº“æ–‡ä»¶libcustom.a1LOCAL_LDFLAGS := $(LOCAL_PATH)/lib/$(TARGET_ARCH_ABI)/libcustom.a å¼•ç”¨OpenCVæ¨¡å—å‡è®¾å·²ç»ä¸‹è½½å¥½opencv-3.2.0SDKï¼ŒAndroid.mkä¸­å¼•ç”¨123456OPENCVROOT:=$(LOCAL_PATH)/../../../../../opencv-3.2.0-android-sdk/OpenCV-android-sdkOPENCV_CAMERA_MODULES:=offOPENCV_INSTALL_MODULES:=onOPENCV_LIB_TYPE:=STATICinclude ${OPENCVROOT}/sdk/native/jni/OpenCV.mkä½¿ç”¨ç›¸å¯¹è·¯å¾„æ‰¾åˆ°sdkï¼Œå¼•å…¥OpenCVçš„mkæ–‡ä»¶ Android NDK é€šç”¨ makefile ä¸ç›¸å…³é…ç½®Android.mk12345678910LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE := waveExtractTARGET_ARCH_ABI := allLOCAL_SRC_FILES := src/wave_display.c src/FFT.cLOCAL_LDLIBS+= -L$(SYSROOT)/usr/lib -lloginclude $(BUILD_SHARED_LIBRARY) Application.mk1234567APP_PLATFORM := android-19APP_MODULES := waveExtractAPP_ABI := armeabi-v7a arm64-v8aAPP_STL := stlport_staticAPP_CPPFLAGS += -fexceptions# for using c++ features,you need to enable these in your MakefileAPP_CPP_FEATURES += exceptions rtti build.gradle123456789101112131415161718192021222324252627282930313233343536373839apply plugin: 'com.android.library'android { compileSdkVersion 28 defaultConfig { minSdkVersion 19 targetSdkVersion 28 versionCode 1 versionName &quot;1.0&quot; testInstrumentationRunner &quot;android.support.test.runner.AndroidJUnitRunner&quot; } buildTypes { release { minifyEnabled false proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro' } } sourceSets { main { jni.srcDirs = [] jniLibs.srcDirs = ['src/main/libs'] } }}dependencies { implementation fileTree(dir: 'libs', include: ['*.jar']) implementation 'com.android.support:appcompat-v7:28.+' testImplementation 'junit:junit:4.12' androidTestImplementation 'com.android.support.test:runner:1.0.2' androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'}","link":"/2018/05/21/Android/NDK-Makefile_example/"},{"title":"Activityä¸­è·å–Viewçš„å®½é«˜","text":"æœ‰äº›æ—¶å€™æˆ‘ä»¬éœ€è¦è·å–åˆ°Viewçš„å®½é«˜ä¿¡æ¯ã€‚åœ¨onCreateå’ŒonResumeä¸­å°è¯•view.getWidth()æˆ–æ˜¯view.getHeiht()æ—¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°è·å–åˆ°çš„æ˜¯0ã€‚Activityè§†å›¾åœ¨åˆ›å»ºå®Œæˆåï¼Œå„ä¸ªå­viewå¹¶ä¸ä¸€å®šè¢«åŠ è½½å®Œæˆã€‚è·å–å®½é«˜æ­£ç¡®çš„æ–¹æ³•æœ‰å“ªäº›å‘¢ï¼Ÿ æ–¹æ³•1 - åœ¨Activityçš„onWindowFocusChangedè·å–å®½é«˜123456@Overridepublic void onWindowFocusChanged(boolean hasFocus) { super.onWindowFocusChanged(hasFocus); // åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°Viewçš„çœŸå®å®½é«˜ Log.d(TAG, &quot;onWindowFocusChanged: mBtn1.getWidth == &quot; + mBtn1.getWidth());} æ–¹æ³•2 - ä½¿ç”¨ViewTreeObserverçš„OnGlobalLayoutListenerå›è°ƒè·å–Viewçš„ViewTreeObserverï¼Œæ·»åŠ å›è°ƒ12345678910ViewTreeObserver vto = mBtn1.getViewTreeObserver();vto.addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() { @Override public void onGlobalLayout() { int height = mBtn1.getHeight(); int width = mBtn1.getWidth(); Log.d(TAG, &quot;onGlobalLayout: mBtn1 &quot; + width + &quot;, &quot; + height); mBtn1.getViewTreeObserver().removeOnGlobalLayoutListener(this); }}); æ–¹æ³•3 - ä½¿ç”¨View.post(Runnable action)æ–¹æ³•ä¾‹å¦‚æˆ‘ä»¬åœ¨onCreateä¸­postä¸€ä¸ªRunnable123456789101112131415161718 @Override protected void onCreate(@Nullable Bundle savedInstanceState) { super.onCreate(savedInstanceState); mBtn1 = findViewById(R.id.btn1); Log.d(TAG, &quot;mBtn1 post runnable&quot;); mBtn1.post(new Runnable() { @Override public void run() { Log.d(TAG, &quot;mBtn1: &quot; + mBtn1.getWidth() + &quot;, &quot; + mBtn1.getHeight()); } }); }/* log06-19 11:54:17.865 28009-28009/com.rustfisher.basic4 D/rustApp: mBtn1 post runnable06-19 11:54:17.867 28009-28009/com.rustfisher.basic4 D/rustApp: [act2] onResume06-19 11:54:17.899 28009-28009/com.rustfisher.basic4 D/rustApp: mBtn1: 355, 144*/å¯ä»¥è·å–åˆ°viewçš„å®½é«˜ã€‚ä»logçš„æ—¶é—´ä¸Šå¯ä»¥çœ‹å‡ºï¼Œåœ¨viewåŠ è½½å®Œæ¯•åï¼Œæ‰§è¡Œçš„Runnableã€‚ åº”ç”¨ - åŠ¨æ€è°ƒæ•´ImageViewçš„å®½é«˜è·å–åˆ°viewçš„å®½é«˜åï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€åœ°è°ƒæ•´ImageViewçš„é«˜åº¦ã€‚å‡è®¾å›¾ç‰‡å®½é«˜ä¸º704 * 440ã€‚xmlä¸­è®¾ç½®scaleTypeä¸ºfitXYã€‚å·²çŸ¥ImageViewçš„å®½åº¦æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒæ•´é«˜åº¦ã€‚ 1234&lt;ImageView android:layout_width=&quot;match_parent&quot; android:layout_height=&quot;wrap_content&quot; android:scaleType=&quot;fitXY&quot;/&gt; æ ¹æ®å›¾ç‰‡çœŸå®å¤§å°æ¥é‡è®¾ImageViewçš„é«˜åº¦ã€‚123456789101112131415@Overridepublic void onWindowFocusChanged(boolean hasFocus) { super.onWindowFocusChanged(hasFocus); resetIntroIvParams();}private void resetIntroIvParams() { int height = mIntroIv.getHeight(); // 704 * 440 int wid = mIntroIv.getWidth(); if (height &gt; 0 &amp;&amp; wid &gt; 0) { ViewGroup.LayoutParams layoutParams = mIntroIv.getLayoutParams(); layoutParams.height = (int) (wid * 440.0 / 704.0); mIntroIv.setLayoutParams(layoutParams); }}","link":"/2018/04/19/Android/Android-Activity_View_get_size/"},{"title":"Android ä½¿ç”¨ MediaExtractor å’Œ MediaMuxer è§£æå’Œå°è£… mp4 æ–‡ä»¶","text":"æœ¬æ–‡ç›®çš„ï¼šä½¿ç”¨ MediaExtractor å’Œ MediaMuxer è§£æå’Œå°è£… mp4 æ–‡ä»¶ ç®€ä»‹MP4æˆ–ç§°MPEG-4ç¬¬14éƒ¨åˆ†ï¼ˆè‹±è¯­ï¼šMPEG-4 Part 14ï¼‰æ˜¯ä¸€ç§æ ‡å‡†çš„æ•°å­—å¤šåª’ä½“å®¹å™¨æ ¼å¼ã€‚ MP4ä¸­çš„éŸ³é¢‘æ ¼å¼é€šå¸¸ä¸ºAAC(audio/mp4a-latm) MediaExtractorMediaExtractor å¯ç”¨äºåˆ†ç¦»å¤šåª’ä½“å®¹å™¨ä¸­è§†é¢‘trackå’ŒéŸ³é¢‘track setDataSource() è®¾ç½®æ•°æ®æºï¼Œæ•°æ®æºå¯ä»¥æ˜¯æœ¬åœ°æ–‡ä»¶åœ°å€ï¼Œä¹Ÿå¯ä»¥æ˜¯ç½‘ç»œåœ°å€ getTrackFormat(int index) æ¥è·å–å„ä¸ªtrackçš„MediaFormatï¼Œé€šè¿‡MediaFormatæ¥è·å–trackçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ï¼šMimeTypeã€åˆ†è¾¨ç‡ã€é‡‡æ ·é¢‘ç‡ã€å¸§ç‡ç­‰ç­‰ selectTrack(int index) é€šè¿‡ä¸‹æ ‡é€‰æ‹©æŒ‡å®šçš„é€šé“ readSampleData(ByteBuffer buffer, int offset) è·å–å½“å‰ç¼–ç å¥½çš„æ•°æ®å¹¶å­˜åœ¨æŒ‡å®šå¥½åç§»é‡çš„bufferä¸­ MediaMuxerMediaMuxer å¯ç”¨äºæ··åˆåŸºæœ¬ç æµã€‚å°†æ‰€æœ‰çš„ä¿¡é“çš„ä¿¡æ¯åˆæˆä¸€ä¸ªè§†é¢‘ã€‚ç›®å‰è¾“å‡ºæ ¼å¼æ”¯æŒMP4ï¼ŒWebmï¼Œ3GPã€‚ä»Android Nougatå¼€å§‹æ”¯æŒå‘MP4ä¸­æ··å…¥B-framesã€‚ æå–å¹¶è¾“å‡ºMP4æ–‡ä»¶ä¸­çš„è§†é¢‘éƒ¨åˆ†ä»ä¸€ä¸ªMP4æ–‡ä»¶ä¸­æå–å‡ºè§†é¢‘ï¼Œå¾—åˆ°ä¸å«éŸ³é¢‘çš„MP4æ–‡ä»¶ã€‚ å®ç°æµç¨‹ï¼Œé¦–å…ˆæ˜¯ä½¿ç”¨MediaExtractoræå–ï¼Œç„¶åä½¿ç”¨MediaMuxerè¾“å‡ºMP4æ–‡ä»¶ã€‚ MediaExtractorè®¾ç½®æ•°æ®æºï¼Œæ‰¾åˆ°å¹¶é€‰æ‹©è§†é¢‘è½¨é“çš„æ ¼å¼å’Œä¸‹æ ‡ MediaMuxerè®¾ç½®è¾“å‡ºæ ¼å¼ä¸ºMUXER_OUTPUT_MPEG_4ï¼Œæ·»åŠ å‰é¢é€‰å®šçš„æ ¼å¼ï¼Œè°ƒç”¨start()å¯åŠ¨ MediaExtractorè¯»å–å¸§æ•°æ®ï¼Œä¸åœåœ°å°†å¸§æ•°æ®å’Œç›¸å…³ä¿¡æ¯ä¼ å…¥MediaMuxer æœ€ååœæ­¢å¹¶é‡Šæ”¾MediaMuxerå’ŒMediaExtractoræœ€å¥½æ”¾åœ¨å­çº¿ç¨‹ä¸­æ“ä½œã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546/** * æå–è§†é¢‘ * * @param sourceVideoPath åŸå§‹è§†é¢‘æ–‡ä»¶ * @throws Exception å‡ºé”™ */public static void extractVideo(String sourceVideoPath, String outVideoPath) throws Exception { MediaExtractor sourceMediaExtractor = new MediaExtractor(); sourceMediaExtractor.setDataSource(sourceVideoPath); int numTracks = sourceMediaExtractor.getTrackCount(); int sourceVideoTrackIndex = -1; // åŸå§‹è§†é¢‘æ–‡ä»¶è§†é¢‘è½¨é“å‚æ•° for (int i = 0; i &lt; numTracks; ++i) { MediaFormat format = sourceMediaExtractor.getTrackFormat(i); String mime = format.getString(MediaFormat.KEY_MIME); Log.d(TAG, &quot;MediaFormat: &quot; + mime); if (mime.startsWith(&quot;video/&quot;)) { sourceMediaExtractor.selectTrack(i); sourceVideoTrackIndex = i; Log.d(TAG, &quot;selectTrack index=&quot; + i + &quot;; format: &quot; + mime); break; } } MediaMuxer outputMediaMuxer = new MediaMuxer(outVideoPath, MediaMuxer.OutputFormat.MUXER_OUTPUT_MPEG_4); outputMediaMuxer.addTrack(sourceMediaExtractor.getTrackFormat(sourceVideoTrackIndex)); outputMediaMuxer.start(); ByteBuffer inputBuffer = ByteBuffer.allocate(1024 * 1024 * 2); // åˆ†é…çš„å†…å­˜è¦å°½é‡å¤§ä¸€äº› MediaCodec.BufferInfo info = new MediaCodec.BufferInfo(); int sampleSize; while ((sampleSize = sourceMediaExtractor.readSampleData(inputBuffer, 0)) &gt;= 0) { long presentationTimeUs = sourceMediaExtractor.getSampleTime(); info.offset = 0; info.size = sampleSize; info.flags = MediaCodec.BUFFER_FLAG_SYNC_FRAME; info.presentationTimeUs = presentationTimeUs; outputMediaMuxer.writeSampleData(sourceVideoTrackIndex, inputBuffer, info); sourceMediaExtractor.advance(); } outputMediaMuxer.stop(); outputMediaMuxer.release(); // åœæ­¢å¹¶é‡Šæ”¾ MediaMuxer sourceMediaExtractor.release(); sourceMediaExtractor = null; // é‡Šæ”¾ MediaExtractor} å¦‚æœä¸Šé¢çš„ByteBufferåˆ†é…çš„ç©ºé—´å¤ªå°ï¼ŒreadSampleData(inputBuffer, 0)å¯èƒ½ä¼šå‡ºç°IllegalArgumentExceptionå¼‚å¸¸ã€‚ æå–MP4æ–‡ä»¶ä¸­çš„éŸ³é¢‘éƒ¨åˆ†ï¼Œè·å–éŸ³é¢‘æ–‡ä»¶åŸºäºJava MP4 Parseræå–å‡ºAACæ–‡ä»¶çš„æ–¹æ³•Java MP4 Parser - https://github.com/sannies/mp4parserJavaå®ç°è¯»ã€å†™å’Œåˆ›å»ºMP4å®¹å™¨ã€‚ä½†æ˜¯å’Œç¼–è§£ç éŸ³è§†é¢‘æœ‰åŒºåˆ«ã€‚è¿™é‡Œä¸»è¦æ˜¯æå–ä¸å†åˆæˆã€‚ ä¸‹è½½isoparser-1.1.22.jarå¹¶æ·»åŠ è¿›å·¥ç¨‹ä¸­ï¼›å°è¯•è¿‡gradleç›´æ¥å¯¼å…¥ï¼Œä½†ä¸æˆåŠŸ æ‰¾åˆ°è§†é¢‘æ–‡ä»¶ä¸­æ‰€æœ‰çš„éŸ³è½¨ï¼Œå°†å®ƒä»¬æå–å‡ºæ¥å†™å…¥æ–°çš„æ–‡ä»¶ä¸­1234567891011121314151617public void extractAudioFromMP4(String outAudioPath, String sourceMP4Path) throws IOException { Movie movie = MovieCreator.build(sourceMP4Path); List&lt;Track&gt; audioTracks = new ArrayList&lt;&gt;(); for (Track t : movie.getTracks()) { if (t.getHandler().equals(&quot;soun&quot;)) { audioTracks.add(t); } } Movie result = new Movie(); if (audioTracks.size() &gt; 0) { result.addTrack(new AppendTrack(audioTracks.toArray(new Track[audioTracks.size()]))); } Container out = new DefaultMp4Builder().build(result); FileChannel fc = new RandomAccessFile(outAudioPath, &quot;rw&quot;).getChannel(); out.writeContainer(fc); fc.close();}åœ¨çº¢ç±³æ‰‹æœºä¸Šæµ‹è¯•æˆåŠŸã€‚ä»MP4æ–‡ä»¶ï¼ˆæ—¶é•¿çº¦2åˆ†20ç§’ï¼‰ä¸­æå–å‡ºçš„AACæ–‡ä»¶å¯åœ¨æ‰‹æœºä¸Šç›´æ¥æ’­æ”¾ã€‚ å°†AACéŸ³è½¨æ¢åˆ°å¦ä¸€ä¸ªMP4æ–‡ä»¶MediaExtractorå¯ä»¥ç›´æ¥ä»æå–AACæ–‡ä»¶æˆ–MP4æ–‡ä»¶ä¸­æå–ACCéŸ³è½¨ï¼ŒMediaMuxeræ¥å†™å…¥æ–°çš„MP4æ–‡ä»¶ã€‚ æä¾›éŸ³é¢‘çš„æ–‡ä»¶å¯ä»¥æ˜¯MP4æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯AACæ–‡ä»¶ï¼›å¦ä¸€ä¸ªæä¾›è§†é¢‘ï¼Œæ··åˆè¾“å‡ºæ–°çš„MP4æ–‡ä»¶ã€‚ ç”Ÿæˆçš„è§†é¢‘çš„é•¿åº¦ç”±æä¾›è§†é¢‘çš„æ–‡ä»¶å†³å®šã€‚123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081/** * @param outputVideoFilePath è¾“å‡ºè§†é¢‘æ–‡ä»¶è·¯å¾„ * @param videoProviderPath æä¾›è§†é¢‘çš„MP4æ–‡ä»¶ æ—¶é•¿ä»¥æ­¤ä¸ºå‡† * @param audioProviderPath æä¾›éŸ³é¢‘çš„æ–‡ä»¶ * @throws Exception è¿è¡Œå¼‚å¸¸ ä¾‹å¦‚è¯»å†™æ–‡ä»¶å¼‚å¸¸ */public static void replaceAudioForMP4File(String outputVideoFilePath, String videoProviderPath, String audioProviderPath) throws Exception { MediaMuxer mediaMuxer = new MediaMuxer(outputVideoFilePath, MediaMuxer.OutputFormat.MUXER_OUTPUT_MPEG_4); // è§†é¢‘ MediaExtractor MediaExtractor mVideoExtractor = new MediaExtractor(); mVideoExtractor.setDataSource(videoProviderPath); int videoTrackIndex = -1; for (int i = 0; i &lt; mVideoExtractor.getTrackCount(); i++) { MediaFormat format = mVideoExtractor.getTrackFormat(i); if (format.getString(MediaFormat.KEY_MIME).startsWith(&quot;video/&quot;)) { mVideoExtractor.selectTrack(i); videoTrackIndex = mediaMuxer.addTrack(format); Log.d(TAG, &quot;Video: format:&quot; + format); break; } } // éŸ³é¢‘ MediaExtractor MediaExtractor audioExtractor = new MediaExtractor(); audioExtractor.setDataSource(audioProviderPath); int audioTrackIndex = -1; for (int i = 0; i &lt; audioExtractor.getTrackCount(); i++) { MediaFormat format = audioExtractor.getTrackFormat(i); if (format.getString(MediaFormat.KEY_MIME).startsWith(&quot;audio/&quot;)) { audioExtractor.selectTrack(i); audioTrackIndex = mediaMuxer.addTrack(format); Log.d(TAG, &quot;Audio: format:&quot; + format); break; } } mediaMuxer.start(); // æ·»åŠ å®Œæ‰€æœ‰è½¨é“åstart long videoEndPreTimeUs = 0; // å°è£…è§†é¢‘track if (-1 != videoTrackIndex) { MediaCodec.BufferInfo info = new MediaCodec.BufferInfo(); info.presentationTimeUs = 0; ByteBuffer buffer = ByteBuffer.allocate(1024 * 1024); int sampleSize; while ((sampleSize = mVideoExtractor.readSampleData(buffer, 0)) &gt;= 0) { info.offset = 0; info.size = sampleSize; info.flags = MediaCodec.BUFFER_FLAG_SYNC_FRAME; info.presentationTimeUs = mVideoExtractor.getSampleTime(); videoEndPreTimeUs = info.presentationTimeUs; mediaMuxer.writeSampleData(videoTrackIndex, buffer, info); mVideoExtractor.advance(); } } Log.d(TAG, &quot;è§†é¢‘ videoEndPreTimeUs &quot; + videoEndPreTimeUs); // å°è£…éŸ³é¢‘track if (-1 != audioTrackIndex) { MediaCodec.BufferInfo info = new MediaCodec.BufferInfo(); info.presentationTimeUs = 0; ByteBuffer buffer = ByteBuffer.allocate(1024 * 1024); int sampleSize; while ((sampleSize = audioExtractor.readSampleData(buffer, 0)) &gt;= 0 &amp;&amp; audioExtractor.getSampleTime() &lt;= videoEndPreTimeUs) { info.offset = 0; info.size = sampleSize; info.flags = MediaCodec.BUFFER_FLAG_SYNC_FRAME; info.presentationTimeUs = audioExtractor.getSampleTime(); mediaMuxer.writeSampleData(audioTrackIndex, buffer, info); audioExtractor.advance(); } } mVideoExtractor.release(); // é‡Šæ”¾MediaExtractor audioExtractor.release(); mediaMuxer.stop(); mediaMuxer.release(); // é‡Šæ”¾MediaMuxer} 12Video: format:{csd-1=java.nio.ByteArrayBuffer[position=0,limit=9,capacity=9], mime=video/avc, frame-rate=30, height=1080, width=1920, max-input-size=1572864, isDMCMMExtractor=1, durationUs=12425577, csd-0=java.nio.ByteArrayBuffer[position=0,limit=20,capacity=20]}Audio: format:{max-input-size=5532, aac-profile=2, mime=audio/mp4a-latm, durationUs=340101875, csd-0=java.nio.ByteArrayBuffer[position=0,limit=2,capacity=2], channel-count=2, sample-rate=44100} MP3è½¬æ¢ä¸ºAACä½¿ç”¨ AndroidAudioConverterAndroidAudioConverter - https://github.com/adrielcafe/AndroidAudioConverter åŸºäºFFmpegçš„ç¬¬ä¸‰æ–¹åº“ã€‚æ”¯æŒæ ¼å¼æœ‰AAC, MP3, M4A, WMA, WAV å’Œ FLAC ä½¿ç”¨æ–¹æ³•ï¼š app/build.gradle123456789repositories { maven { url &quot;https://jitpack.io&quot; }}dependencies { compile 'com.github.adrielcafe:AndroidAudioConverter:0.0.8'} ç”³è¯·è¯»å†™å¤–éƒ¨å­˜å‚¨æƒé™12&lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot; /&gt;&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;åœ¨Applicationç±»ä¸­åŠ è½½åº“1234567891011121314151617public class MuxerApp extends Application { @Override public void onCreate() { super.onCreate(); AndroidAudioConverter.load(this, new ILoadCallback() { @Override public void onSuccess() { // Great! } @Override public void onFailure(Exception error) { // FFmpeg is not supported by device } }); }}ä½¿ç”¨è½¬æ¢åŠŸèƒ½1234567891011121314151617181920212223242526final String sourceMP3Path = SOURCE_PATH + File.separator + &quot;music1.mp3&quot;;Log.d(TAG, &quot;è½¬æ¢å¼€å§‹ &quot; + sourceMP3Path);File srcFile = new File(sourceMP3Path);IConvertCallback callback = new IConvertCallback() { @Override public void onSuccess(File convertedFile) { Log.d(TAG, &quot;onSuccess: &quot; + convertedFile); } @Override public void onFailure(Exception error) { Log.e(TAG, &quot;onFailure: &quot;, error); }};AndroidAudioConverter.with(getApplicationContext()) // Your current audio file .setFile(srcFile) // Your desired audio format .setFormat(AudioFormat.AAC) // An callback to know when conversion is finished .setCallback(callback) // Start conversion .convert(); åœ¨ä¸‰æ˜ŸNote4ä¸Šæµ‹è¯•ï¼Œè½¬æ¢13MBçš„MP3æ–‡ä»¶ç”¨äº†å¤§çº¦3åˆ†18ç§’ã€‚ å‚è€ƒ MediaExtractor - Android Developer MediaMuxer - Android Developer Java MP4 Parser AndroidéŸ³è§†é¢‘ç›¸å…³æ–‡ç« Android tutorial 2020","link":"/2018/03/01/Android/Android-MediaMuxer_MediaExtractor_mp4/"},{"title":"Android æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»","text":"Androidæ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»ã€‚åœ¨è‡ªåŠ¨åŒ–æµ‹è¯•ä¸­å¯ä½¿ç”¨çš„å·¥å…·ã€‚å¯ä»¥åˆ©ç”¨adbå‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Android SDKä¸­çš„monkeyrunnerå·¥å…·ã€‚ win7-64 gitbash ä½¿ç”¨adbå‘½ä»¤ä¸»è¦ä½¿ç”¨inputå‘½ä»¤123456usage: input ... input text &lt;string&gt; input keyevent &lt;key code number or name&gt; input tap &lt;x&gt; &lt;y&gt; input swipe &lt;x1&gt; &lt;y1&gt; &lt;x2&gt; &lt;y2&gt;keyeventæŒ‡çš„æ˜¯androidå¯¹åº”çš„keycodeï¼Œæ¯”å¦‚homeé”®çš„keycode=3ï¼Œbacké”®çš„keycode=4 tapæ˜¯touchå±å¹•çš„äº‹ä»¶ï¼Œåªéœ€ç»™å‡ºxã€yåæ ‡å³å¯ swipeæ¨¡æ‹Ÿæ»‘åŠ¨çš„äº‹ä»¶ï¼Œç»™å‡ºèµ·ç‚¹å’Œç»ˆç‚¹çš„åæ ‡å³å¯ 12345# æ¨¡æ‹Ÿç‚¹å‡»ä½ç½® (100,100)adb shell input tap 100 100# æ¨¡æ‹Ÿæ»‘åŠ¨ ä»(650, 250)åˆ°(200,300)adb shell input swipe 650 250 200 300 ç¼–å†™ä¸€ä¸ªbatè„šæœ¬ï¼Œæ¨¡æ‹Ÿç”¨æˆ·æ»‘åŠ¨1234567891011@echo offecho --------- Mock start ----------:tag_startecho running...adb shell input swipe 650 250 200 666@ping 127.0.0.1 -n 8 &gt;nulgoto tag_startecho --------- Mock finish ---------pause æ­»å¾ªç¯å‘é€æ»‘åŠ¨å‘½ä»¤ï¼Œå»¶æ—¶è¯­å¥1@ping 127.0.0.1 -n 8 &gt;nul monkeyrunnerç¯å¢ƒé…ç½®ï¼Œé…ç½®å¥½Javaä¸Android SDKçš„ç¯å¢ƒå˜é‡ã€‚æ‰‹æœºè¿æ¥åˆ°ç”µè„‘ã€‚ç³»ç»Ÿå˜é‡ä¸­åŠ å…¥ANDROID_SWTï¼Œæ­¤ä¾‹ä¸­è·¯å¾„ä¸ºG:\\SDK\\tools\\lib\\x86_64 ä¿®æ”¹åçš„è„šæœ¬rustmonkeyrunner.batï¼ŒWindowsç¯å¢ƒä¸‹éœ€è¦åœ¨gitbashæˆ–CMDé‡Œè¿è¡Œ æ¥è‡ªunable-to-access-jarfile-framework-monkeyrunner-25-3-2-jar1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162@echo offrem Copyright (C) 2010 The Android Open Source Projectremrem Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);rem you may not use this file except in compliance with the License.rem You may obtain a copy of the License atremrem http://www.apache.org/licenses/LICENSE-2.0remrem Unless required by applicable law or agreed to in writing, softwarerem distributed under the License is distributed on an &quot;AS IS&quot; BASIS,rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.rem See the License for the specific language governing permissions andrem limitations under the License.rem don't modify the caller's environmentsetlocalrem Set up prog to be the path of this script, including following symlinks,rem and set up progdir to be the fully-qualified pathname of its directory.set prog=%~f0rem Change current directory and drive to where the script is, to avoidrem issues with directories containing whitespaces.cd /d %~dp0rem Check we have a valid Java.exe in the path.set java_exe=call ..\\lib\\find_java.batif not defined java_exe goto :EOFfor /f %%a in (&quot;%APP_HOME%\\lib\\monkeyrunner-25.3.2.jar&quot;) do set jarfile=%%~nxaset frameworkdir=.set libdir=if exist %frameworkdir%\\%jarfile% goto JarFileOk set frameworkdir=..\\libif exist %frameworkdir%\\%jarfile% goto JarFileOk set frameworkdir=..\\framework:JarFileOkset jarpath=%frameworkdir%\\%jarfile%if not defined ANDROID_SWT goto QueryArch set swt_path=%ANDROID_SWT% goto SwtDone:QueryArch for /f &quot;delims=&quot; %%a in ('%frameworkdir%\\..\\bin\\archquery') do set swt_path=%frameworkdir%\\%%a:SwtDoneif exist &quot;%swt_path%&quot; goto SetPath echo SWT folder '%swt_path%' does not exist. echo Please set ANDROID_SWT to point to the folder containing swt.jar for your platform. exit /B:SetPathcall &quot;%java_exe%&quot; -Xmx512m &quot;-Djava.ext.dirs=%frameworkdir%;%swt_path%&quot; -Dcom.android.monkeyrunner.bindir=..\\..\\platform-tools -jar %jarpath% %* è¿è¡Œè„šæœ¬1234Administrator@rust-PC ~$ /cygdrive/g/SDK/tools/bin/rustmonkeyrunner.batJython 2.5.3 (2.5:c56500f08d34+, Aug 13 2012, 14:54:35)[Java HotSpot(TM) 64-Bit Server VM (Oracle Corporation)] on java1.8.0_77 é¦–æ¬¡è¿è¡Œæ—¶importæ¨¡å—è¿Ÿè¿Ÿæ²¡æœ‰ååº”1&gt;&gt;&gt; from com.android.monkeyrunner import MonkeyRunner, MonkeyDevice, MonkeyImage å°è¯•è¿è¡Œè„šæœ¬an_test2.py 123456789101112131415161718192021222324252627282930import osprint(&quot;importing module...&quot;)from com.android.monkeyrunner import MonkeyRunner, MonkeyDevice, MonkeyImageprint(&quot;waiting for connection...&quot;)device = MonkeyRunner.waitForConnection()print(&quot;device found!&quot;)s_wid = int(device.getProperty(&quot;display.width&quot;)) # è·å–å±å¹•å®½åº¦åƒç´ s_height = int(device.getProperty(&quot;display.height&quot;)) # è·å–å±å¹•é«˜åº¦åƒç´ print(&quot;build.version.sdk &quot; + str(device.getProperty(&quot;build.version.sdk&quot;)))print(&quot;display.width &quot; + str(s_wid))print(&quot;display.height &quot; + str(s_height))drag_point_left_x = 20drag_point_right_x = s_wid - 20drag_point_y = s_height / 2for i in range(0, 10): print(&quot;current loop is &quot; + str(i)) device.drag((drag_point_right_x, drag_point_y), (drag_point_left_x, drag_point_y), 1.0, 50) print(&quot;waiting...&quot;) MonkeyRunner.sleep(1) print(&quot;continue&quot;) device.drag((drag_point_left_x, drag_point_y), (drag_point_right_x, drag_point_y), 0.5, 3) MonkeyRunner.sleep(3)print(&quot;-------- finish --------&quot;) å‘½ä»¤è¡Œç›´æ¥æ‰§è¡Œï¼Œå¯ä»¥çœ‹åˆ°æ‰§è¡Œç»“æœå’Œç›¸åº”çš„æŠ¥é”™ä¿¡æ¯12345678910111213C:\\Users\\Administrator&gt;G:\\SDK\\tools\\bin\\rustmonkeyrunner.bat H:\\fisher_p\\py_ws\\an_test2.pyimporting module...waiting for connection...device found!build.version.sdk 23display.width 1440display.height 2560current loop is 0waiting...continuecurrent loop is 1# .....-------- finish --------æµ‹è¯•ä¸­å‘ç°ï¼Œè„šæœ¬å¯ä»¥è¿è¡Œåœ¨ç³»ç»Ÿappã€‚è‹¥å½“å‰æ‰“å¼€çš„æ˜¯ç¬¬ä¸‰æ–¹appï¼Œä¼šç›´æ¥æŠ¥é”™ï¼Œè·å–ä¸åˆ°ç›¸åº”ä¿¡æ¯ å‚è€ƒ monkeyrunner è·å–ç³»ç»Ÿä¿¡æ¯ Android MonkeyDevice - Google","link":"/2018/02/05/Android/adb_mock_touch_and_monkeyrunner/"},{"title":"Android MediaCodec ç¼–è§£ç ","text":"Android MediaCodec ä½¿ç”¨æ–¹å¼ä½¿ç”¨MediaCodecè¿›è¡Œç¼–è§£ç ã€‚è¾“å…¥H.264æ ¼å¼çš„æ•°æ®ï¼Œè¾“å‡ºå¸§æ•°æ®å¹¶å‘é€ç»™ç›‘å¬å™¨ã€‚ H.264çš„é…ç½®åˆ›å»ºå¹¶é…ç½®codecã€‚é…ç½®codecæ—¶ï¼Œè‹¥æ‰‹åŠ¨åˆ›å»ºMediaFormatå¯¹è±¡çš„è¯ï¼Œä¸€å®šè¦è®°å¾—è®¾ç½®â€csd-0â€å’Œâ€csd-1â€è¿™ä¸¤ä¸ªå‚æ•°ã€‚â€œcsd-0â€å’Œâ€csd-1â€è¿™ä¸¤ä¸ªå‚æ•°ä¸€å®šè¦å’Œæ¥æ”¶åˆ°çš„å¸§å¯¹åº”ä¸Šã€‚ è¾“å…¥æ•°æ®ç»™codecè¾“å…¥æ•°æ®æ—¶ï¼Œå¦‚æœå¯¹è¾“å…¥æ•°æ®è¿›è¡Œæ’é˜Ÿï¼Œéœ€è¦æ£€æŸ¥æ’é˜Ÿé˜Ÿåˆ—çš„æƒ…å†µã€‚ä¾‹å¦‚ä¸€å¸§æ•°æ®æš‚ç”¨1Må†…å­˜ï¼Œ1ç§’30å¸§ï¼Œæ’é˜Ÿé˜Ÿåˆ—æœ‰å¯èƒ½ä¼šæš‚ç”¨30Mçš„å†…å­˜ã€‚å½“å†…å­˜æš‚ç”¨è¿‡é«˜ï¼Œæˆ‘ä»¬éœ€è¦é‡‡å–ä¸€å®šçš„æªæ–½æ¥å‡å°å†…å­˜å ç”¨ã€‚codecç¡¬è§£ç æ—¶ä¼šå—åˆ°æ‰‹æœºç¡¬ä»¶çš„å½±å“ã€‚è‹¥æ‰‹æœºæ€§èƒ½ä¸ä½³ï¼Œç¼–è§£ç çš„é€Ÿåº¦æœ‰å¯èƒ½æ…¢äºåŸå§‹æ•°æ®è¾“å…¥ã€‚ä¸å¾—å·²çš„æƒ…å†µæˆ‘ä»¬å¯ä»¥å°†æ’é˜Ÿä¸­çš„æ—§æ•°æ®æŠ›å¼ƒï¼Œè¾“å…¥æ–°æ•°æ®ã€‚ è§£ç å™¨æ€§èƒ½å¯¹è§†é¢‘å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œcodecæ²¡æœ‰å¯ç”¨çš„è¾“å…¥ç¼“å†²åŒºï¼ŒmCodec.dequeueInputBufferè¿”å›-1ã€‚ä¸ºäº†å®æ—¶æ€§ï¼Œè¿™é‡Œä¼šå¼ºåˆ¶é‡Šæ”¾æ‰è¾“å…¥è¾“å‡ºç¼“å†²åŒºmCodec.flush()ã€‚ é—®é¢˜1 - MediaCodecè¾“å…¥æ•°æ®å’Œè¾“å‡ºæ•°æ®æ•°é‡ä¹‹é—´æœ‰æ²¡æœ‰ç‰¹å®šçš„å…³ç³»å¯¹äºMediaCodecï¼Œè¾“å…¥æ•°æ®å’Œè¾“å‡ºæ•°æ®æ•°é‡ä¹‹é—´æœ‰æ²¡æœ‰ç‰¹å®šçš„å…³ç³»ï¼Ÿå‡è®¾è¾“å…¥10å¸§çš„æ•°æ®ï¼Œå¯ä»¥å¾—åˆ°å¤šå°‘æ¬¡è¾“å‡ºï¼Ÿ å®æµ‹å‘ç°ï¼Œä¸èƒ½ç™¾åˆ†ç™¾ä¿è¯è¾“å…¥è¾“å‡ºæ¬¡æ•°æ˜¯ç›¸ç­‰çš„ã€‚ä¾‹å¦‚vivo x6 plusï¼Œè¾“å…¥30å¸§ï¼Œèƒ½å¾—åˆ°28å¸§ç»“æœã€‚æˆ–è€…300æ¬¡è¾“å…¥ï¼Œå¾—åˆ°298æ¬¡è¾“å‡ºã€‚ å¼‚å¸¸1 - dequeueInputBuffer(0)ä¸€ç›´è¿”å›-1æŸäº›æ‰‹æœºé•¿æ—¶é—´ç¼–è§£ç åï¼Œå¯èƒ½ä¼šå‡ºç°å°è¯•è·å–codecè¾“å…¥ç¼“å†²åŒºæ—¶ä¸‹æ ‡ä¸€ç›´è¿”å›-1ã€‚ä¾‹å¦‚vivo x6 plusï¼Œè¿è¡Œçº¦20åˆ†é’Ÿåï¼ŒmCodec.dequeueInputBuffer(0)ä¸€ç›´è¿”å›-1ã€‚ å¤„ç†æ–¹æ³•ï¼šå¦‚æœä¸€ç›´è¿”å›-1ï¼ŒåŒæ­¥æ–¹å¼ä¸‹å°è¯•è°ƒç”¨codec.flush()æ–¹æ³•ï¼Œå¼‚æ­¥æ–¹å¼ä¸‹å°è¯•codec.flush()åå†è°ƒç”¨codec.start()æ–¹æ³•ã€‚ æœ‰ä¸€äº›æ‰‹æœºè§£ç é€Ÿåº¦å¤ªæ…¢ï¼Œæœ‰å¯èƒ½ä¼šç»å¸¸è¿”å›-1ã€‚ä¸è¦é¢‘ç¹è°ƒç”¨codec.flush()ï¼Œä»¥å…æ˜¾ç¤ºä¸æ­£å¸¸ã€‚ ä»£ç ç¤ºä¾‹ - åŒæ­¥æ–¹å¼è¿›è¡Œç¼–è§£ç è¿™ä¸€ä¸ªä¾‹å­ä½¿ç”¨åŒæ­¥æ–¹å¼è¿›è¡Œç¼–è§£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216/** * è§£ç å™¨ */public class CodecDecoder { private static final String TAG = &quot;CodecDecoder&quot;; private static final String MIME_TYPE = &quot;video/avc&quot;; private static final String CSD0 = &quot;csd-0&quot;; private static final String CSD1 = &quot;csd-1&quot;; private static final int TIME_INTERNAL = 1; private static final int DECODER_TIME_INTERNAL = 1; private MediaCodec mCodec; private long mCount = 0; // åª’ä½“è§£ç å™¨MediaCodecç”¨çš„ // é€å…¥ç¼–è§£ç å™¨å‰çš„ç¼“å†²é˜Ÿåˆ— // éœ€è¦å®æ—¶ç›‘æ§è¿™ä¸ªé˜Ÿåˆ—æ‰€æš‚ç”¨çš„å†…å­˜æƒ…å†µ åœ¨è¿™é‡Œå µå¡çš„è¯å¾ˆå®¹æ˜“å¼•èµ·OOM private Queue&lt;byte[]&gt; data = null; private DecoderThread decoderThread; private CodecListener listener; // è‡ªå®šä¹‰çš„ç›‘å¬å™¨ å½“è§£ç å¾—åˆ°å¸§æ•°æ®æ—¶é€šè¿‡å®ƒå‘é€å‡ºå» public CodecDecoder() { data = new ConcurrentLinkedQueue&lt;&gt;(); } public boolean isCodecCreated() { return mCodec!=null; } public boolean createCodec(CodecListener listener, byte[] spsBuffer, byte[] ppsBuffer, int width, int height) { this.listener = listener; try { mCodec = MediaCodec.createDecoderByType(Constants.MIME_TYPE); MediaFormat mediaFormat = createVideoFormat(spsBuffer, ppsBuffer, width, height); mCodec.configure(mediaFormat, null, null, 0); mCodec.start(); Log.d(TAG, &quot;decoderThread mediaFormat in:&quot; + mediaFormat); decoderThread = new DecoderThread(); decoderThread.start(); return true; } catch (Exception e) { e.printStackTrace(); Log.e(TAG, &quot;MediaCodec create error:&quot; + e.getMessage()); return false; } } private MediaFormat createVideoFormat(byte[] spsBuffer, byte[] ppsBuffer, int width, int height) { MediaFormat mediaFormat; mediaFormat = MediaFormat.createVideoFormat(MIME_TYPE, width, height); mediaFormat.setByteBuffer(CSD0, ByteBuffer.wrap(spsBuffer)); mediaFormat.setByteBuffer(CSD1, ByteBuffer.wrap(ppsBuffer)); mediaFormat.setInteger(MediaFormat.KEY_COLOR_FORMAT, MediaCodecInfo.CodecCapabilities.COLOR_FormatYUV420Flexible); return mediaFormat; } private long lastInQueueTime = 0; // è¾“å…¥H.264å¸§æ•°æ® è¿™é‡Œä¼šç›‘æ§æ’é˜Ÿæƒ…å†µ public void addData(byte[] dataBuffer) { final long timeDiff = System.currentTimeMillis() - lastInQueueTime; if (timeDiff &gt; 1) { lastInQueueTime = System.currentTimeMillis(); int queueSize = data.size(); // ConcurrentLinkedQueueæŸ¥è¯¢é•¿åº¦æ—¶ä¼šéå†ä¸€æ¬¡ åœ¨æ•°æ®é‡å·¨å¤§çš„æƒ…å†µä¸‹å°½é‡å°‘ç”¨è¿™ä¸ªæ–¹æ³• if (queueSize &gt; 30) { data.clear(); LogInFile.getLogger().e(&quot;frame queue å¸§æ•°æ®é˜Ÿåˆ—è¶…å‡ºä¸Šé™ï¼Œè‡ªåŠ¨æ¸…é™¤æ•°æ® &quot; + queueSize); } data.add(dataBuffer.clone()); Log.e(TAG, &quot;frame queue æ·»åŠ ä¸€å¸§æ•°æ®&quot;); } else { LogInFile.getLogger().e(&quot;frame queue æ·»åŠ é€Ÿåº¦å¤ªå¿«,è·³è¿‡æ­¤å¸§. timeDiff=&quot; + timeDiff); } } public void destroyCodec() { if (mCodec != null) { try { mCount = 0; if(data!=null) { data.clear(); data = null; } if(decoderThread!=null) { decoderThread.stopThread(); decoderThread = null; } mCodec.release(); mCodec = null; } catch (Exception e) { e.printStackTrace(); Log.d(TAG, &quot;destroyCodec exception:&quot; + e.toString()); } } } private class DecoderThread extends Thread { private final int INPUT_BUFFER_FULL_COUNT_MAX = 50; private boolean isRunning; private int inputBufferFullCount = 0; // è¾“å…¥ç¼“å†²åŒºæ»¡äº†å¤šå°‘æ¬¡ public void stopThread() { isRunning = false; } @Override public void run() { setName(&quot;CodecDecoder_DecoderThread-&quot; + getId()); isRunning = true; while (isRunning) { try { if (data != null &amp;&amp; !data.isEmpty()) { int inputBufferIndex = mCodec.dequeueInputBuffer(0); if (inputBufferIndex &gt;= 0) { byte[] buf = data.poll(); ByteBuffer inputBuffer = mCodec.getInputBuffer(inputBufferIndex); if (null != inputBuffer) { inputBuffer.clear(); inputBuffer.put(buf, 0, buf.length); mCodec.queueInputBuffer(inputBufferIndex, 0, buf.length, mCount * TIME_INTERNAL, 0); mCount++; } inputBufferFullCount = 0; // è¿˜æœ‰ç¼“å†²åŒºå¯ä»¥ç”¨çš„æ—¶å€™é‡ç½®è®¡æ•° } else { inputBufferFullCount++; LogInFile.getLogger().e(TAG, &quot;decoderThread inputBuffer full. inputBufferFullCount=&quot; + inputBufferFullCount); if (inputBufferFullCount &gt; INPUT_BUFFER_FULL_COUNT_MAX) { mCount = 0; mCodec.flush(); // åœ¨è¿™é‡Œæ¸…é™¤æ‰€æœ‰ç¼“å†²åŒº LogInFile.getLogger().e(TAG, &quot;mCodec.flush()...&quot;); } } } // Get output buffer index MediaCodec.BufferInfo bufferInfo = new MediaCodec.BufferInfo(); int outputBufferIndex = mCodec.dequeueOutputBuffer(bufferInfo, 0); while (outputBufferIndex &gt;= 0) { final int index = outputBufferIndex; Log.d(TAG, &quot;releaseOutputBuffer &quot; + Thread.currentThread().toString()); final ByteBuffer outputBuffer = byteBufferClone(mCodec.getOutputBuffer(index)); Image image = mCodec.getOutputImage(index); if (null != image) { // è·å–NV21æ ¼å¼çš„æ•°æ® final byte[] nv21 = ImageUtil.getDataFromImage(image, FaceDetectUtil.COLOR_FormatNV21); final int imageWid = image.getWidth(); final int imageHei = image.getHeight(); // è¿™é‡Œé€‰æ‹©åˆ›å»ºæ–°çš„çº¿ç¨‹å»å‘é€æ•°æ® - è¿™æ˜¯å¯ä¼˜åŒ–çš„åœ°æ–¹ new Thread(new Runnable() { @Override public void run() { listener.onDataDecoded(outputBuffer, mCodec.getOutputFormat().getInteger(MediaFormat.KEY_COLOR_FORMAT), nv21, imageWid, imageHei); } }).start(); } else { listener.onDataDecoded(outputBuffer, mCodec.getOutputFormat().getInteger(MediaFormat.KEY_COLOR_FORMAT), new byte[]{0}, 0, 0); } try { mCodec.releaseOutputBuffer(index, false); } catch (IllegalStateException ex) { android.util.Log.e(TAG, &quot;releaseOutputBuffer ERROR&quot;, ex); } outputBufferIndex = mCodec.dequeueOutputBuffer(bufferInfo, 0); } } catch (Exception e) { e.printStackTrace(); Log.e(TAG, &quot;decoderThread exception:&quot; + e.getMessage()); } try { Thread.sleep(DECODER_TIME_INTERNAL); } catch (InterruptedException e) { e.printStackTrace(); } } } } // deep clone byteBuffer private static ByteBuffer byteBufferClone(ByteBuffer buffer) { if (buffer.remaining() == 0) return ByteBuffer.wrap(new byte[]{0}); ByteBuffer clone = ByteBuffer.allocate(buffer.remaining()); if (buffer.hasArray()) { System.arraycopy(buffer.array(), buffer.arrayOffset() + buffer.position(), clone.array(), 0, buffer.remaining()); } else { clone.put(buffer.duplicate()); clone.flip(); } return clone; }} ä»£ç ç¤ºä¾‹ - å·¥å…·å‡½æ•°ä¸€äº›å·¥å…·å‡½æ•°ã€‚æ¯”å¦‚ä»imageä¸­å–å‡ºNV21æ ¼å¼çš„æ•°æ®ã€‚12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091private byte[] getDataFromImage(Image image) { return getDataFromImage(image, COLOR_FormatNV21);}/** * å°†Imageæ ¹æ®colorFormatç±»å‹çš„byteæ•°æ® */private byte[] getDataFromImage(Image image, int colorFormat) { if (colorFormat != COLOR_FormatI420 &amp;&amp; colorFormat != COLOR_FormatNV21) { throw new IllegalArgumentException(&quot;only support COLOR_FormatI420 &quot; + &quot;and COLOR_FormatNV21&quot;); } if (!isImageFormatSupported(image)) { throw new RuntimeException(&quot;can't convert Image to byte array, format &quot; + image.getFormat()); } Rect crop = image.getCropRect(); int format = image.getFormat(); int width = crop.width(); int height = crop.height(); Image.Plane[] planes = image.getPlanes(); byte[] data = new byte[width * height * ImageFormat.getBitsPerPixel(format) / 8]; byte[] rowData = new byte[planes[0].getRowStride()]; int channelOffset = 0; int outputStride = 1; for (int i = 0; i &lt; planes.length; i++) { switch (i) { case 0: channelOffset = 0; outputStride = 1; break; case 1: if (colorFormat == COLOR_FormatI420) { channelOffset = width * height; outputStride = 1; } else if (colorFormat == COLOR_FormatNV21) { channelOffset = width * height + 1; outputStride = 2; } break; case 2: if (colorFormat == COLOR_FormatI420) { channelOffset = (int) (width * height * 1.25); outputStride = 1; } else if (colorFormat == COLOR_FormatNV21) { channelOffset = width * height; outputStride = 2; } break; } ByteBuffer buffer = planes[i].getBuffer(); int rowStride = planes[i].getRowStride(); int pixelStride = planes[i].getPixelStride(); int shift = (i == 0) ? 0 : 1; int w = width &gt;&gt; shift; int h = height &gt;&gt; shift; buffer.position(rowStride * (crop.top &gt;&gt; shift) + pixelStride * (crop.left &gt;&gt; shift)); for (int row = 0; row &lt; h; row++) { int length; if (pixelStride == 1 &amp;&amp; outputStride == 1) { length = w; buffer.get(data, channelOffset, length); channelOffset += length; } else { length = (w - 1) * pixelStride + 1; buffer.get(rowData, 0, length); for (int col = 0; col &lt; w; col++) { data[channelOffset] = rowData[col * pixelStride]; channelOffset += outputStride; } } if (row &lt; h - 1) { buffer.position(buffer.position() + rowStride - length); } } } return data;}/** * æ˜¯å¦æ˜¯æ”¯æŒçš„æ•°æ®ç±»å‹ */private static boolean isImageFormatSupported(Image image) { int format = image.getFormat(); switch (format) { case ImageFormat.YUV_420_888: case ImageFormat.NV21: case ImageFormat.YV12: return true; } return false;}â€œcsd-0â€å’Œâ€csd-1â€æ˜¯ä»€ä¹ˆï¼Œå¯¹äºH264è§†é¢‘çš„è¯ï¼Œå®ƒå¯¹åº”çš„æ˜¯spså’Œppsï¼Œå¯¹äºAACéŸ³é¢‘çš„è¯ï¼Œå¯¹åº”çš„æ˜¯ADTSï¼ŒåšéŸ³è§†é¢‘å¼€å‘çš„äººåº”è¯¥éƒ½çŸ¥é“ï¼Œå®ƒä¸€èˆ¬å­˜åœ¨äºç¼–ç å™¨ç”Ÿæˆçš„IDRå¸§ä¹‹ä¸­ã€‚ å¾—åˆ°çš„mediaFormat1mediaFormat in:{height=720, width=1280, csd-1=java.nio.ByteArrayBuffer[position=0,limit=7,capacity=7], mime=video/avc, csd-0=java.nio.ByteArrayBuffer[position=0,limit=13,capacity=13], color-format=2135033992} å­˜å‚¨å›¾ç‰‡çš„æ–¹æ³•Imageç±»åœ¨Android API21åŠä»¥ååŠŸèƒ½ååˆ†å¼ºå¤§ã€‚ 1234567891011121314151617181920212223242526private static void dumpFile(String fileName, byte[] data) { FileOutputStream outStream; try { outStream = new FileOutputStream(fileName); } catch (IOException ioe) { throw new RuntimeException(&quot;Unable to create output file &quot; + fileName, ioe); } try { outStream.write(data); outStream.close(); } catch (IOException ioe) { throw new RuntimeException(&quot;failed writing data to file &quot; + fileName, ioe); }}private void compressToJpeg(String fileName, Image image) { FileOutputStream outStream; try { outStream = new FileOutputStream(fileName); } catch (IOException ioe) { throw new RuntimeException(&quot;Unable to create output file &quot; + fileName, ioe); } Rect rect = image.getCropRect(); YuvImage yuvImage = new YuvImage(getDataFromImage(image, COLOR_FormatNV21), ImageFormat.NV21, rect.width(), rect.height(), null); yuvImage.compressToJpeg(rect, 100, outStream);} NV21è½¬bitmapçš„æ–¹æ³•ç›´æ¥å­˜å…¥æ–‡ä»¶12345// in try catchFileOutputStream fos = new FileOutputStream(Environment.getExternalStorageDirectory() + &quot;/imagename.jpg&quot;);YuvImage yuvImage = new YuvImage(nv21bytearray, ImageFormat.NV21, width, height, null);yuvImage.compressToJpeg(new Rect(0, 0, width, height), 100, fos);fos.close(); è·å¾—Bitmapå¯¹è±¡çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è€—æ—¶è€—å†…å­˜NV21 -&gt; yuvImage -&gt; jpeg -&gt; bitmap1234567// in try catchYuvImage yuvImage = new YuvImage(nv21bytearray, ImageFormat.NV21, width, height, null);ByteArrayOutputStream os = new ByteArrayOutputStream();yuvImage.compressToJpeg(new Rect(0, 0, width, height), 100, os);byte[] jpegByteArray = os.toByteArray();Bitmap bitmap = BitmapFactory.decodeByteArray(jpegByteArray, 0, jpegByteArray.length);os.close(); å‚è€ƒ https://stackoverflow.com/questions/32276522/convert-nv21-byte-array-into-bitmap-readable-format codecé€‰æ‹©YUV420æ ¼å¼è¾“å‡ºOutputBufferçš„é—®é¢˜å‡è®¾codecé€‰æ‹©çš„æ ¼å¼æ˜¯COLOR_FormatYUV420Flexible1mediaFormat.setInteger(MediaFormat.KEY_COLOR_FORMAT, MediaCodecInfo.CodecCapabilities.COLOR_FormatYUV420Flexible);è§£ç åï¼Œå¾—åˆ°çš„æ ¼å¼æ˜¯COLOR_QCOM_FormatYUV420SemiPlanar32m // 0x7FA30C041mCodec.getOutputFormat().getInteger(MediaFormat.KEY_COLOR_FORMAT)è§£ç å‡ºæ¥çš„ByteBuffer oBuffer = mCodec.getOutputBuffer(index);åŒ…å«å…ƒç´ ä¸ªæ•°ä¸º1413120ï¼›è®°ä¸ºnv21Codecè€Œé€šè¿‡mCodec.getOutputImage(index)å¾—åˆ°çš„imageå¯¹è±¡è·å–åˆ°çš„nv21æ•°ç»„å…ƒç´ ä¸ªæ•°ä¸º1382400ï¼›è®°ä¸ºnv21ï¼Œè¿™äº›æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•°æ® å¯¹æ¯”è¿™2ä¸ªæ•°ç»„æˆ‘ä»¬å‘ç°ï¼Œå‰é¢çš„yéƒ¨åˆ†æ˜¯ç›¸åŒçš„ã€‚nv21å‰921600ä¸ªå…ƒç´ æ˜¯yæ•°æ®ï¼Œå460800ä¸ªå…ƒç´ æ˜¯uvæ•°æ®ã€‚nv21Codecå‰921600ä¸ªå…ƒç´ æ˜¯yæ•°æ®ï¼Œä¹‹åçš„20480ä¸ªå­—èŠ‚éƒ½æ˜¯0ï¼Œå†æ¥ä¸‹æ¥çš„460800ä¸ªå…ƒç´ æ˜¯uvæ•°æ®ã€‚æœ€åçš„10240ä¸ªå­—èŠ‚æ˜¯0 nv21å’Œnv21Codecçš„uvéƒ¨åˆ†å­˜å‚¨é¡ºåºæ˜¯ç›¸åçš„ã€‚ å‚è€ƒèµ„æ–™ Android: MediaCodecè§†é¢‘æ–‡ä»¶ç¡¬ä»¶è§£ç ,é«˜æ•ˆç‡å¾—åˆ°YUVæ ¼å¼å¸§,å¿«é€Ÿä¿å­˜JPEGå›¾ç‰‡(ä¸ä½¿ç”¨OpenGL)(é™„Demo) Android: Imageç±»æµ…æ(ç»“åˆYUV_420_888) Android MediaCodec stuff é›·éœ„éª…(leixiaohua1020)çš„ä¸“æ  [æ€»ç»“]FFMPEGè§†éŸ³é¢‘ç¼–è§£ç é›¶åŸºç¡€å­¦ä¹ æ–¹æ³• - é›·éœ„éª… Bilibili/ijkplayer - Github AndroidéŸ³è§†é¢‘ç›¸å…³æ–‡ç« è¯·å‚è€ƒ https://rustfisher.com/tags/Android-Media/","link":"/2017/12/20/Android/Android-MediaCodec_use_demo/"},{"title":"PyQt QFileDialog æ–‡ä»¶é€‰æ‹©å¼¹çª—","text":"å¼¹å‡ºæ–‡ä»¶é€‰æ‹©æ¡†ã€‚å¯ä»¥è‡ªå®šä¹‰é€‰æ‹©æ¡†çš„æ ‡é¢˜ï¼Œé»˜è®¤ä½ç½®ï¼Œç›®æ ‡æ–‡ä»¶åç¼€ é€‰æ‹©æ¡†å¼¹å‡ºåï¼Œä¼šé˜»å¡UIçº¿ç¨‹ã€‚ PyQt5æ–‡ä»¶é€‰æ‹©æ¡†çš„ä¾‹å­è¿™é‡Œåªé€‰æ‹©ä¸€ä¸ªbatæ–‡ä»¶ã€‚å¦‚æœé»˜è®¤ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™æŸ¥æ‰¾å½“å‰ç›®å½•1234567891011def _click_tu_choose_file_path_btn1(self): default_path = 'C:\\MY' if not os.path.exists(default_path): default_path = os.getcwd() dlg = QFileDialog(None, &quot;choose_bat_file&quot;, default_path, 'All Files(*.bat)') dlg.setFileMode(QFileDialog.AnyFile) if dlg.exec_(): selected_name = dlg.selectedFiles()[0] if selected_name: self.ma.tu_filePathTv1.setText(self.tr(selected_name))","link":"/2017/11/23/PyQt_note/PyQt-QFileDialog_use/"},{"title":"Python logging åŸºæœ¬ç”¨æ³•","text":"æœ¬æ–‡è®°å½•loggingæ¨¡å—çš„ç”¨æ³• åˆ›å»ºæ–‡ä»¶logger.py 123456789101112131415import loggingLOG_FILE = 'app_history.log'logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(filename)s[line:%(lineno)d] %(levelname)s %(message)s', # datefmt='%Y_%m_%d_%H:%M:%S', filename=LOG_FILE, filemode='a')console = logging.StreamHandler()console.setLevel(logging.INFO)formatter = logging.Formatter('%(name)-12s: %(levelname)-8s %(message)s')console.setFormatter(formatter)logging.getLogger(LOG_FILE).addHandler(console) è°ƒç”¨1logger.logging.info(&quot;%-13s connected: %r&quot; % (ip_address, connected)) %(asctime)s è¡¨ç¤ºè¿™ä¸ªä½ç½®ä¸Šæ˜¯å­—ç¬¦ä¸²å½¢å¼çš„å½“å‰æ—¶é—´datefmt='%Y_%m_%d_%H:%M:%S' æŒ‡å®šäº†æ—¶é—´æ ¼å¼ï¼›æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸æŒ‡å®šæ—¶é—´æ ¼å¼ æŸ¥çœ‹å†™å‡ºçš„logæ–‡ä»¶12017-11-23 13:39:35,295 - xxx.py[line:122] INFO [MainWindow] --------- App Starts ---------","link":"/2017/11/21/Python/Python-logging-use/"},{"title":"PyQt5 å®‰è£…å•†ä¸šç‰ˆ","text":"å¯¹äºWindows7ä¸Šçš„Python2ï¼Œéœ€è¦å¦‚ä¸‹å·¥å…·ï¼š visual studio sip Qt(SDK) å¦‚æœç”µè„‘ä¸Šå·²ç»è£…æœ‰äº†PyQt4ï¼Œå»ºè®®å†è£…ä¸€ä»½Pythonã€‚ä¸åŸæ¥çš„åˆ†å¼€ã€‚ win7å®‰è£…ç¤¾åŒºç‰ˆVisual Studioä½¿ç”¨Visual Studioæ˜¯ä¸ºäº†å®ƒçš„ç¼–è¯‘å·¥å…·å’Œç›¸å…³åº“ã€‚å®‰è£…æ—¶é€‰ä¸ŠWindows SDKã€‚ å¯¹äºVS2017æ¥è¯´ï¼Œä½¿ç”¨çš„æ˜¯è¿™ä¸ªå·¥å…· â€œD:\\Microsoft Visual Studio\\2017\\Community\\Common7\\Tools\\VsDevCmd.batâ€å¼€å§‹-æ‰€æœ‰ç¨‹åº-Visual Studio 2017-Visual Studio Tools vså®‰è£…è·¯å¾„ D:\\Microsoft Visual Studioç¯å¢ƒå˜é‡12D:\\Microsoft Visual Studio\\2017\\Community\\VC\\Tools\\MSVC\\14.11.25503\\bin\\Hostx64\\x64;D:\\Microsoft Visual Studio\\2017\\Community\\VC\\Tools\\MSVC\\14.11.25503\\lib; Python2.7å®‰è£…sipwin7 64ä½ç³»ç»Ÿï¼Œä½†Python2.7æ˜¯32ä½ ä¸‹è½½sipæºç åŒ…ï¼ˆä¾‹å¦‚sip-4.19.3ï¼‰ï¼Œè§£å‹åˆ°ä»»æ„ä½ç½®ã€‚è¿›å…¥sipæºç åŒ…ï¼Œæ‰§è¡Œ1python configure.pyè¿™é‡ŒPython2.7å®‰è£…åœ¨D:\\python27ï¼›äºæ˜¯sipä½ç½®åœ¨D:\\python27\\Lib\\site-packages\\sip-4.19.3æ‰“å¼€vsçš„å‘½ä»¤è¡Œï¼Œè¿›å…¥sipåœ¨Pythonä¸­çš„ç›®å½•ï¼Œæ‰§è¡Œ12nmakenmake install win7å®‰è£…Qt5åˆ°Qtå®˜ç½‘ä¸‹è½½å®‰è£…åŒ…ã€‚ä¸ºäº†ç…§é¡¾32ä½çš„Python2.7ï¼Œè¿™é‡Œé€‰æ‹©Qt 5.6.3 for Windows 32-bit (VS 2015, 869 MB) æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­1D:\\Qt\\Qt5\\5.6.3\\msvc2015\\bin;D:\\Qt\\Qt5\\Tools\\QtCreator\\bin win7ç¼–è¯‘å®‰è£…å•†ä¸šç‰ˆPyQt5Python2.7 123python configure.py --disable QtNfcnmakenmake install å‚è€ƒPyQt5çš„README12345COMMERCIAL VERSIONIf you have the Commercial version of PyQt5 then you should also have alicense file that you downloaded separately. The license file must be copiedto the &quot;sip&quot; directory before starting to build PyQt5.æˆ‘ä»¬æŠŠä¹°æ¥çš„licenseæ–‡ä»¶å¤åˆ¶åˆ°sipç›®å½•ä¸‹ã€‚ åœ¨E:\\ws\\doc\\PyQtCommercial\\PyQt5_commercial-5.9ä¸­ï¼ŒæŠŠä»˜è´¹åå¾—åˆ°çš„pyqt-commercial.sipå¤åˆ¶åˆ°sipç›®å½•ä¸‹ ä½¿ç”¨vs2017çš„å‘½ä»¤è¡Œå·¥å…·ï¼ python configure.pyå‡ºç°é”™è¯¯1Error: Use the --qmake argument to explicitly specify a working Qt qmake.ç½‘ä¸Šè¯´æ˜¯å› ä¸ºæ²¡æœ‰é…ç½®å¥½Qt SDKçš„åŸå› å¯å‚è€ƒ PyQt setup for Qt 4.7.4è§£å†³é”™è¯¯åï¼Œä¼šæç¤ºæ˜¯å¦æ¥å—licenseã€‚æ ¹æ®æç¤ºè¾“å…¥yesã€‚ æ‰§è¡Œpython configure.py --disable QtNfc1234Querying qmake about your Qt installation...Determining the details of your Qt installation...This is the commercial version of PyQt 5.9 (licensed under the PyQt CommercialLicense) for Python 2.7.13 on win32. nmakeæŠ¥é”™ cannot open file â€œmsvcprt.libâ€1fatal error LNK1104: cannot open file â€œmsvcprt.libâ€ æŠŠlibè·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ D:\\Microsoft Visual Studio\\2017\\Community\\VC\\Tools\\MSVC\\14.11.25503\\lib; nmakeæŠ¥é”™ QtNfc.dll : fatal error LNK1169: one or more multiply defined symbols found123456789release\\QtNfc.dll : fatal error LNK1169: æ‰¾åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå¤šé‡å®šä¹‰çš„ç¬¦å·NMAKE : fatal error U1077: â€œ&quot;D:\\Microsoft Visual Studio\\2017\\Community\\VC\\Tools\\MSVC\\14.11.25503\\bin\\HostX86\\x86\\link.EXE&quot;â€: è¿”å›ä»£ç â€œ0x491â€Stop.NMAKE : fatal error U1077: â€œ&quot;D:\\Microsoft Visual Studio\\2017\\Community\\VC\\Tools\\MSVC\\14.11.25503\\bin\\HostX86\\x86\\nmake.exe&quot;â€: è¿”å›ä»£ç â€œ0x2â€Stop.NMAKE : fatal error U1077: â€œcdâ€: è¿”å›ä»£ç â€œ0x2â€Stop. ç½‘ä¸Šæœ‰ç›¸å…³çš„å»ºè®®ï¼ŒæŠŠQtNfcâ€œå–æ¶ˆâ€æ‰ï¼Œå…¶å®å°±æ˜¯ä¸ç¼–è¯‘QtNfcã€‚ E:\\ws\\doc\\PyQtCommercial\\PyQt5_commercial-5.9&gt;python configure.py --disable QtNfc http://python.6.x6.nabble.com/error-building-QtNfc-td5185657.html nmake éœ€è¦ä¸€æ®µæ—¶é—´ã€‚ç”µè„‘æ¯”è¾ƒå·®çš„è¯ï¼Œå¤§æ¦‚è¦1ä¸ªå°æ—¶ã€‚nmake install è€—æ—¶çº¦5åˆ†é’Ÿ è¯•è¿è¡ŒPyQt5å¯¼å…¥PyQt5æ¨¡å—è¯•ä¸€è¯•123from PyQt5.QtCore import QTranslatorfrom PyQt5.QtGui import *from PyQt5.QtWidgets import * å¯¹äºPython2.7 PyQt5ï¼Œä½¿ç”¨pyinstalleræ¥æ‰“åŒ…æˆexeæ–‡ä»¶1pyinstaller ui_main.pyå¾—åˆ°ç›¸åº”çš„æ–‡ä»¶ç›®å½• è¿è¡Œexeå¼¹çª—æŠ¥é”™Qt platform plugin12this application failed to start because it could not find or load the Qt platform plugin &quot;windows&quot; in &quot;&quot;Reinstalling the application may fix this problem. æŠ¥é”™åŸå› æ˜¯æ‰¾ä¸åˆ° Qt platform pluginåœ¨Qt5ï¼Œåœ¨å®‰è£…ç›®å½•ä¸‹å¯æ‰¾åˆ° D:\\Qt\\Qt5\\Tools\\QtCreator\\bin\\plugins\\platformså¯¹äºPython3ï¼Œå®‰è£…äº†GPLçš„PyQt5ï¼Œå¯ä»¥æ‰¾åˆ° D:\\python35\\Lib\\site-packages\\PyQt5\\Qt\\plugins\\platforms å¤„ç†æ–¹æ³•ï¼šä¸æ‰“åŒ…æˆä¸€ä¸ªå•ä¸€çš„exeæ–‡ä»¶ï¼Œä½¿ç”¨pyinstaller ui_main.pyç”Ÿæˆæ–‡ä»¶ç›®å½•åœ¨distä¸­ï¼Œä¸exeæ–‡ä»¶åŒçº§çš„ç›®å½•PyQt5/qt/pluginsä¸­ï¼Œæœ‰platformsç›®å½•æŠŠplatformsæ–‡ä»¶å¤¹å¤åˆ¶åˆ°ä¸exeæ–‡ä»¶åŒçº§çš„ä½ç½®å³å¯ å‚è€ƒHow to install PyQt5 on Windows for Python 2? ç¼–è¯‘å®‰è£…PyQt5çš„è¿‡ç¨‹ å®‰è£…sipçš„å»ºè®®","link":"/2017/10/25/PyQt_note/PyQt-Install_licensed_PyQt/"},{"title":"findçš„ä½¿ç”¨","text":"æ¯”å¦‚åˆ é™¤ï½ç»“å°¾çš„æ–‡ä»¶1find . -name &quot;*~&quot; -type f -print -exec rm -rf {} \\; åˆ é™¤æ–‡ä»¶åæœ‰ç‰¹å®šå­—ç¬¦çš„æ–‡ä»¶1find . -name &quot;*abcd*&quot; -exec rm -f {} \\; ä¿®æ”¹æ‰§è¡Œå‘½ä»¤å’Œæ–‡ä»¶ç±»å‹ï¼Œå®‰è£…ç›®å½•ä¸‹æ‰€æœ‰apkæ–‡ä»¶1find . -name &quot;*.apk&quot; -type f -print -exec adb install {} \\; æ‰¾åˆ°æ‰€æœ‰çš„jsonæ–‡ä»¶å¹¶ä¸”åˆ é™¤1find . -name &quot;*.json&quot; -exec rm {} \\; åˆ é™¤æŒ‡å®šç›®å½•ï¼Œæ¯”å¦‚åˆ é™¤æ‰€æœ‰çš„gitç›®å½•1find . -type d -iname &quot;.git&quot; -exec rm -rf {} \\; æ‰¾åˆ°å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„apkå¹¶å®‰è£…1find . -name &quot;*.apk&quot; -exec adb install {} \\;","link":"/2017/10/10/Linux/find-use/"},{"title":"PyQt é€‚é…ä¸åŒå±å¹•åˆ†è¾¨ç‡","text":"åœ¨å®½é«˜ä¸º1366*768ä¸‹è®¾è®¡å¼€å‘çš„ç•Œé¢ï¼Œåˆ°äº†2860*1620å±å¹•ä¸‹ä¼šæ˜¾ç¤ºä¸æ­£å¸¸ã€‚å› ä¸ºåƒç´ å¯†åº¦ä¸åŒï¼Œ2860*1620å±å¹•æ˜¾ç¤ºå‡ºæ¥çš„æ§ä»¶å¾ˆå°ã€‚ é€‚é…æ–¹æ³• - æ ¹æ®å½“å‰å±å¹•è°ƒæ•´æ§ä»¶å¤§å°å’Œä½ç½®åˆå§‹åŒ–æ—¶è·å–åˆ°å½“å‰å±å¹•çš„å®½é«˜åƒç´ å€¼ã€‚ä¸åŸåƒç´ å€¼ç›¸æ¯”æ±‚å‡ºæ¯”ä¾‹self.ratio_widï¼Œself.ratio_heightã€‚ æ‰¾å‡ºæ‰€æœ‰çš„QWidget self.findChildren(QWidget)ï¼Œéå†æ¥æ”¹å˜å¤§å°å’Œä½ç½®ã€‚ 123456789101112131415161718192021222324252627282930313233343536from PyQt4.QtGui import QMainWindow, QApplication, QWidgetclass ReMainWindow(QMainWindow): def __init__(self, parent=None): # ........... self.app = QApplication.instance() # Calculate the ratio. Design screen is [1366, 768] screen_resolution = self.app.desktop().screenGeometry() self.hw_ratio = 768 / 1366 # height / width self.ratio_wid = screen_resolution.width() / 1366 if self.ratio_wid &lt; 1: self.ratio_wid = 1 self.ratio_height = screen_resolution.height() / 768 if self.ratio_height &lt; 1: self.ratio_height = 1 def _init_ui_size(self): &quot;&quot;&quot; Travel all the widgets and resize according to the ratio &quot;&quot;&quot; self._resize_with_ratio(self) for q_widget in self.findChildren(QWidget): # print q_widget.objectName() self._resize_with_ratio(q_widget) self._move_with_ratio(q_widget) # Don't deal with the text browser # for q_widget in self.findChildren(QAbstractScrollArea): # print q_widget.objectName() # self._resize_with_ratio(q_widget) # self._move_with_ratio(q_widget) def _resize_with_ratio(self, input_ui): input_ui.resize(input_ui.width() * self.ratio_wid, input_ui.height() * self.ratio_height) def _move_with_ratio(self, input_ui): input_ui.move(input_ui.x() * self.ratio_wid, input_ui.y() * self.ratio_height) å®è·µå‘ç°ï¼Œä¸éœ€è¦å¯¹QTextBrowseræ‰€å±çš„QAbstractScrollAreaå¤„ç†ã€‚","link":"/2017/09/26/PyQt_note/PyQt-Adjust_screen_resolution/"},{"title":"PyQt è¯­è¨€å›½é™…åŒ–","text":"PyQt4 è¯­è¨€å›½é™…åŒ–ä½¿ç”¨pylupdate4å°†ç•Œé¢çš„pyæ–‡ä»¶è½¬æˆtsæ–‡ä»¶ã€‚ è¿›å…¥pyæ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œæ‰§è¡Œè½¬æ¢å‘½ä»¤ã€‚1/d/python27/Lib/site-packages/PyQt4/pylupdate4 ui_main.py -ts zh_CN.ts å¾—åˆ°zh_CN.tsæ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯xmlæ–‡ä»¶ã€‚å½“ç•Œé¢çš„pyæ–‡ä»¶ä¿®æ”¹æ—¶ï¼Œè¿è¡Œpylupdate4ç”Ÿæˆtsä¸ä¼šç ´ååŸtsçš„ç¿»è¯‘ã€‚ ç”¨Qtè¯­è¨€å®¶ï¼ˆLinguistï¼‰æ‰“å¼€zh_CN.tsæ–‡ä»¶ã€‚å¯ä»¥å¯¹ç›¸åº”çš„å­—ç¬¦ä¸²è¿›è¡Œç¿»è¯‘ã€‚ç‚¹å‡»â€œå‘å¸ƒâ€å¯è·å¾—zh_CN.qmæ–‡ä»¶ã€‚è¿™å°±æ˜¯qtçš„è¯­è¨€èµ„æºæ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ åˆ›å»ºappæ—¶ï¼Œå…ˆåŠ è½½è¯­è¨€èµ„æºæ–‡ä»¶zh_CN.qm123456789101112if __name__ == '__main__': configs.init_configs() # ç¡®å®šè¯­è¨€é…ç½® app = QApplication(sys.argv) trans = QTranslator() # Setup locale, we need .qm files if configs.g_locale_type == configs.LOCALE_ZH_CH: trans.load(&quot;res/locale/zh_CN&quot;) # No need suffix .qm app.installTranslator(trans) main_d = FAMainWindow() main_d.show() sys.exit(app.exec_()) Appè¿è¡Œä¸­åˆ‡æ¢è¯­è¨€åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å½“å‰æ˜¾ç¤ºçš„è¯­è¨€ã€‚ä¸éœ€è¦é‡æ–°å¯åŠ¨ç¨‹åºå³å¯å®Œæˆåˆ‡æ¢ã€‚ å‡†å¤‡è¯­è¨€èµ„æºæ–‡ä»¶ä»¥è‹±æ–‡å’Œç®€ä½“ä¸­æ–‡ä¸ºä¾‹ï¼Œæƒ³è¦åˆ‡æ¢è¯­è¨€ï¼Œéœ€è¦è¿™2ç§è¯­è¨€åŒ…12$ /d/python27/Lib/site-packages/PyQt4/pylupdate4 ui_main.py -ts zh_CN.ts$ /d/python27/Lib/site-packages/PyQt4/pylupdate4 ui_main.py -ts en.tså€ŸåŠ©Qtè¯­è¨€å®¶å‘å¸ƒå¾—åˆ°en.qmå’Œzh_CN.qmè¿™2ä¸ªæ–‡ä»¶ï¼Œæ”¾åœ¨res/localeç›®å½•é‡Œ åœ¨UIä¸Šè®¾ç½®è§¦å‘åˆ‡æ¢è¯­è¨€ç•Œé¢ä¸Šéœ€è¦æŒ‰é’®æˆ–èœå•æ çš„actionï¼›éœ€è¦æŒæœ‰QTranslatorï¼› 12345678910111213141516171819202122232425262728 self.trans = QTranslator() # åˆå§‹åŒ–æ—¶è·å– QTranslator self._init_trans() # æ·»åŠ äº†actionæ¥è§¦å‘åˆ‡æ¢åŠ¨ä½œ self.connect(self.ma.actionEnglish, SIGNAL(&quot;triggered()&quot;), self._trigger_english) self.ma.action_ZhCN.triggered.connect(self._trigger_zh_cn)def _init_trans(self): ctx.read_locale_config() # è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œç”¨æ¥è¯»å–jsonæ–‡ä»¶ä¸­çš„é…ç½® if ctx.g_locale_type == ctx.LOCALE_ZH_CH: self._trigger_zh_cn() elif ctx.g_locale_type == ctx.LOCALE_EN: self._trigger_english()def _trigger_english(self): print &quot;[MainWindow] Change to English&quot; self.trans.load(&quot;res/locale/en&quot;) _app = QApplication.instance() # è·å–appå®ä¾‹ _app.installTranslator(self.trans) self.ma.retranslateUi(self) ctx.change_to_en() # å°†æ–°çš„é…ç½®æ›´æ–°å…¥jsonæ–‡ä»¶ä¸­def _trigger_zh_cn(self): print &quot;[MainWindow] Change to zh_CN&quot; self.trans.load(&quot;res/locale/zh_CN&quot;) _app = QApplication.instance() _app.installTranslator(self.trans) self.ma.retranslateUi(self) ctx.change_to_zh_cn()","link":"/2017/09/20/PyQt_note/PyQt-Locale/"},{"title":"PyQt æ‹–å…¥","text":"PyQtæ”¯æŒæ‹–å…¥åŠŸèƒ½ã€‚æ¯”å¦‚æ‹–å…¥æ–‡ä»¶æˆ–è€…ä¸€æ®µæ–‡æœ¬ã€‚ æ‹–å…¥æ–‡æœ¬å®šä¹‰äº†ä¸€ä¸ªlabelç»§æ‰¿è‡ªQLabelï¼Œåˆå§‹åŒ–æ—¶è®¾ç½®å…è®¸æ‹–å…¥ã€‚ å‚è§pyqt5-drag-and-drop1234567891011121314151617from PyQt5 import QtCorefrom PyQt5.QtWidgets import QMainWindow, QApplication, QListWidget, QAbstractItemViewclass CustomLabel(QLabel): def __init__(self, title, parent): super().__init__(title, parent) self.setAcceptDrops(True) def dragEnterEvent(self, e): if e.mimeData().hasFormat('text/plain'): e.accept() else: e.ignore() def dropEvent(self, e): self.setText(e.mimeData().text())ç›´æ¥è°ƒç”¨è¿™ä¸ªç±»ï¼Œå°†å®ƒæ·»åŠ åˆ°ç•Œé¢ä¸Šå»ã€‚ æ‹–å…¥æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶è·¯å¾„è¿™é‡Œç»§æ‰¿äº†QLabelã€‚Ui_MainWindowæ˜¯ç”¨designerç”»å‡ºæ¥çš„ç•Œé¢ã€‚ 12345678910111213141516171819202122232425262728293031from PyQt5 import QtCorefrom PyQt5.QtWidgets import QMainWindow, QApplication, QListWidget, QAbstractItemViewclass LabMainWindow(QMainWindow): def __init__(self): super(LabMainWindow, self).__init__() self.ma = Ui_MainWindow() self.ma.setupUi(self) self.drag_in_widget = DragInWidget(&quot;Drag in&quot;, self) def _init_ui(self): self.drag_in_widget.move(0, 0)class DragInWidget(QLabel): def __init__(self, title, parent): super().__init__(title, parent) self.setAcceptDrops(True) def dragEnterEvent(self, e): if e.mimeData().hasUrls(): e.accept() else: e.ignore() def dropEvent(self, e): for url in e.mimeData().urls(): path = url.toLocalFile() if os.path.isfile(path): print(path) QtWidgets.QFrameç›‘å¬æ‹–å…¥äº‹ä»¶ç›‘å¬åˆ°æœ‰æ•ˆæ‹–åŠ¨äº‹ä»¶åï¼Œåˆ©ç”¨QtCore.pyqtSignalæŠŠä¿¡æ¯ä¼ é€’å‡ºå» 1234567891011121314151617181920212223from PyQt5 import QtCorefrom PyQt5.QtWidgets import QMainWindow, QApplication, QListWidget, QAbstractItemViewclass DragInWidget(QtWidgets.QFrame): &quot;&quot;&quot; Drag files to this widget &quot;&quot;&quot; s_content = QtCore.pyqtSignal(str) # emit file path def __init__(self, parent): super(DragInWidget, self).__init__(parent) self.setAcceptDrops(True) def dragEnterEvent(self, e): if e.mimeData().hasUrls(): e.accept() else: e.ignore() def dropEvent(self, e): for url in e.mimeData().urls(): path = url.toLocalFile() if os.path.isfile(path): self.s_content.emit(path) print(path) è¿™ä¸ªFrameå¯ä»¥è¦†ç›–åœ¨å…¶ä»–æ§ä»¶ä¸Šé¢æ—¶ï¼Œä¼šæ‹¦æˆªæ“ä½œ QListWidgetæ‹–å…¥äº‹ä»¶å‘QListWidgetæ‹–å…¥æ–‡ä»¶ï¼Œè·å–æ–‡ä»¶è·¯å¾„ 123456789101112131415161718192021222324from PyQt5 import QtCorefrom PyQt5.QtWidgets import QMainWindow, QApplication, QListWidget, QAbstractItemViewclass DragInWidget(QListWidget): &quot;&quot;&quot; Drag files to this widget &quot;&quot;&quot; s_content = QtCore.pyqtSignal(str) # emit file path def __init__(self, parent): super(DragInWidget, self).__init__(parent) self.setAcceptDrops(True) self.setDragDropMode(QAbstractItemView.InternalMove) def dragEnterEvent(self, e): if e.mimeData().hasUrls(): e.accept() else: e.ignore() def dropEvent(self, e): for url in e.mimeData().urls(): path = url.toLocalFile() if os.path.isfile(path): self.s_content.emit(path) print(path)","link":"/2017/09/19/PyQt_note/PyQt-Drag_and_drop/"},{"title":"PyQt æ‰“åŒ…","text":"py2exePyQt4 ä¸­æ‰“åŒ…æˆEXEæ–‡ä»¶å°†æŸä¸ªGUIç¨‹åºæ‰“åŒ…æˆEXEæ–‡ä»¶ã€‚ Python2.7ï¼Œåœ¨PyCharmä¸­ç›´æ¥æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ã€‚ 123456789101112131415161718192021222324252627# -*- coding: utf-8 -*-from distutils.core import setupimport py2exeimport sysimport main_window_re# this allows to run it with a simple double click.sys.argv.append('py2exe')py2exe_options = { &quot;includes&quot;: [&quot;sip&quot;], &quot;dll_excludes&quot;: [&quot;MSVCP90.dll&quot;, ], &quot;compressed&quot;: 1, &quot;optimize&quot;: 2, &quot;ascii&quot;: 0, &quot;bundle_files&quot;: 1,}setup( name='Reliability_test', version=main_window_re.VERSION_NAME, windows=['main_window_re.py', ], zipfile=None, options={'py2exe': py2exe_options}) å°è¯•è¿‡3.6å’Œ3.5ç‰ˆæœ¬ï¼Œpy2exeéƒ½ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚ pyinstallerhttps://github.com/pyinstaller/pyinstaller/wiki/FAQ ç”±äºç”µè„‘ä¸Šå®‰è£…äº†å¤šä¸ªç‰ˆæœ¬çš„Pythonï¼Œç¯å¢ƒå˜é‡åˆ¶å®šäº†Python2ã€‚è¿™é‡Œä½¿ç”¨3.5ç‰ˆæœ¬çš„pyinstalleræ¥æ‰“åŒ…ã€‚æ³¨æ„--pathsæŒ‡å®šäº†è·¯å¾„ã€‚ç¯å¢ƒå˜é‡ä¸­å¹¶æ²¡æœ‰è®¾ç½®è¿™ä¸ªè·¯å¾„ã€‚æˆ‘ä»¬æŒ‡å®šå»æ‰¾PyQt5çš„ä¾èµ–dllã€‚ 123-p DIR, --paths DIR A path to search for imports (like using PYTHONPATH). Multiple paths are allowed, separated by ';', or use this option multiple times è·¯å¾„æœ€å¥½æ˜¯åŠ ä¸Šå¼•å·ï¼Œæ¯”å¦‚è¿™é‡ŒæŒ‡å®šQt5å’ŒPyQt5çš„è·¯å¾„1pyinstaller -p &quot;D:\\Qt\\Qt5\\5.6.3\\msvc2015\\bin&quot; -p &quot;D:\\Python27_qt5\\Lib\\site-packages\\PyQt5&quot; main_lab.py 1234567891011$ /d/python35/Scripts/pyinstaller --paths /d/python35/Lib/site-packages/PyQt5/Qt/bin --onefile main_lab.py106 INFO: PyInstaller: 3.2.1106 INFO: Python: 3.5.4rc1106 INFO: Platform: Windows-7-6.1.7601-SP1108 INFO: wrote E:\\ws\\eslab\\lab\\main_lab.spec109 INFO: UPX is not available.110 INFO: Extending PYTHONPATH with paths['E:\\\\ws\\\\eslab\\\\lab', 'D:\\\\python35\\\\Lib\\\\site-packages\\\\PyQt5\\\\Qt\\\\bin', 'E:\\\\ws\\\\eslab\\\\lab']...... ç”Ÿæˆå•ä¸ªçª—å£EXEæ–‡ä»¶ã€‚1$ /d/python35/Scripts/pyinstaller --paths /d/python35/Lib/site-packages/PyQt5/Qt/bin -F -w main_lab.py ç”Ÿæˆexeæ–‡ä»¶åï¼ŒæŠ¥äº†ä¸€ä¸ªæ‰¾ä¸åˆ°labæ¨¡å—çš„é”™è¯¯ã€‚è¿™ä¸ªæ¨¡å—åˆšå¥½å°±æ˜¯æˆ‘ä»¬ä¸»ç•Œé¢æ‰€åœ¨çš„æ¨¡å—ã€‚å°†å¼•ç”¨çš„æ¨¡å—ålabåˆ æ‰ã€‚é‡æ–°ç”Ÿæˆexeæ–‡ä»¶ã€‚12345from lab.file_utils import FileUtilsfrom lab.mainwindow import Ui_MainWindow####################################from file_utils import FileUtilsfrom mainwindow import Ui_MainWindow è¿è¡Œexeæ‰¾ä¸åˆ°æ¨¡å—æŠ¥é”™ä½¿ç”¨é»˜è®¤æ–¹å¼æ‰“åŒ…ï¼Œå¾—åˆ°exeä¸æ–‡ä»¶ç›®å½•1pyinstaller main_lab.pyå°†distä¸­çš„ç›®å½•å¤åˆ¶åˆ°å¦ä¸€å°ç”µè„‘ï¼Œç‚¹å‡»è¿è¡Œexeæ–‡ä»¶ï¼›æç¤ºæ‰¾ä¸åˆ°æ¨¡å—åœ¨ä¸»uiæ–‡ä»¶ä¸­ï¼Œæ·»åŠ è·¯å¾„1234import sysimport ossys.path.append(os.getcwd()) # Prepare path æ‰¾ä¸åˆ°æ¨¡å—ï¼Œä¸€èˆ¬ä¼šæŠ¥ ImportError: No module named 'xxx' é”™è¯¯æ­¤æ—¶ä¸€èˆ¬æ˜¯æ‰¾ä¸åˆ°æˆ‘ä»¬è‡ªå·±å†™çš„æ¨¡å—ã€‚12from my_package.ui_main import Ui_MainWindow # æ˜¾ç¤ºæŒ‡å®šäº†my_package æ‰“åŒ…å¾—åˆ°çš„exeä¼šæ‰¾ä¸åˆ°è¿™ä¸ªåŒ…from my_widget import DragInWidget # ä¸æ˜¾ç¤ºæŒ‡å®špackage å¦åˆ™æ‰“åŒ…å¾—åˆ°çš„exeä¼šæ‰¾ä¸åˆ°åŒ…è€Œæ— æ³•è¿è¡Œ","link":"/2017/09/18/PyQt_note/PyQt-Pack_app/"},{"title":"Python è·å–å½“å‰è·¯å¾„çš„æ–¹æ³•","text":"æœ¬æ–‡é“¾æ¥ Python2.7 ä¸­è·å–è·¯å¾„çš„å„ç§æ–¹æ³•sys.pathæ¨¡å—æœç´¢è·¯å¾„çš„å­—ç¬¦ä¸²åˆ—è¡¨ã€‚ç”±ç¯å¢ƒå˜é‡PYTHONPATHåˆå§‹åŒ–å¾—åˆ°ã€‚sys.path[0]æ˜¯è°ƒç”¨Pythonè§£é‡Šå™¨çš„å½“å‰è„šæœ¬æ‰€åœ¨çš„ç›®å½•ã€‚ sys.argvä¸€ä¸ªä¼ ç»™Pythonè„šæœ¬çš„æŒ‡ä»¤å‚æ•°åˆ—è¡¨ã€‚sys.argv[0]æ˜¯è„šæœ¬çš„åå­—ï¼ˆç”±ç³»ç»Ÿå†³å®šæ˜¯å¦æ˜¯å…¨åï¼‰å‡è®¾æ˜¾ç¤ºè°ƒç”¨pythonæŒ‡ä»¤ï¼Œå¦‚python demo.pyï¼Œä¼šå¾—åˆ°ç»å¯¹è·¯å¾„ï¼›è‹¥ç›´æ¥æ‰§è¡Œè„šæœ¬ï¼Œå¦‚./demo.pyï¼Œä¼šå¾—åˆ°ç›¸å¯¹è·¯å¾„ã€‚ os.getcwd()è·å–å½“å‰å·¥ä½œè·¯å¾„ã€‚åœ¨è¿™é‡Œæ˜¯ç»å¯¹è·¯å¾„ã€‚https://docs.python.org/2/library/os.html#os.getcwd __file__è·å¾—æ¨¡å—æ‰€åœ¨çš„è·¯å¾„ï¼Œå¯èƒ½å¾—åˆ°ç›¸å¯¹è·¯å¾„ã€‚å¦‚æœæ˜¾ç¤ºæ‰§è¡ŒPythonï¼Œä¼šå¾—åˆ°ç»å¯¹è·¯å¾„ã€‚è‹¥æŒ‰ç›¸å¯¹è·¯å¾„æ¥ç›´æ¥æ‰§è¡Œè„šæœ¬./pyws/path_demo.pyï¼Œä¼šå¾—åˆ°ç›¸å¯¹è·¯å¾„ã€‚ä¸ºäº†è·å–ç»å¯¹è·¯å¾„ï¼Œå¯è°ƒç”¨os.path.abspath() os.path ä¸­çš„ä¸€äº›æ–¹æ³•os.path.split(path)å°†è·¯å¾„åç§°åˆ†æˆå¤´å’Œå°¾ä¸€å¯¹ã€‚å°¾éƒ¨æ°¸è¿œä¸ä¼šå¸¦æœ‰æ–œæ ã€‚å¦‚æœè¾“å…¥çš„è·¯å¾„ä»¥æ–œæ ç»“å°¾ï¼Œé‚£ä¹ˆå¾—åˆ°çš„ç©ºçš„å°¾éƒ¨ã€‚å¦‚æœè¾“å…¥è·¯å¾„æ²¡æœ‰æ–œæ ï¼Œé‚£ä¹ˆå¤´éƒ¨ä½ä¸ºç©ºã€‚å¦‚æœè¾“å…¥è·¯å¾„ä¸ºç©ºï¼Œé‚£ä¹ˆå¾—åˆ°çš„å¤´å’Œå°¾éƒ½æ˜¯ç©ºã€‚https://docs.python.org/2/library/os.path.html#os.path.split os.path.realpath(path)è¿”å›ç‰¹å®šæ–‡ä»¶åçš„ç»å¯¹è·¯å¾„ã€‚https://docs.python.org/2/library/os.path.html#os.path.realpath ä»£ç ç¤ºä¾‹ç¯å¢ƒ Win7, Python2.7ä»¥/e/pyws/path_demo.pyä¸ºä¾‹12345678910111213#!/usr/bin/env pythonimport osimport sysif __name__ == '__main__': print &quot;sys.path[0] =&quot;, sys.path[0] print &quot;sys.argv[0] =&quot;, sys.argv[0] print &quot;__file__ =&quot;, __file__ print &quot;os.path.abspath(__file__) =&quot;, os.path.abspath(__file__) print &quot;os.path.realpath(__file__) = &quot;, os.path.realpath(__file__) print &quot;os.path.dirname(os.path.realpath(__file__)) =&quot;, os.path.dirname(os.path.realpath(__file__)) print &quot;os.path.split(os.path.realpath(__file__)) =&quot;, os.path.split(os.path.realpath(__file__)) print &quot;os.getcwd() =&quot;, os.getcwd() åœ¨/dä¸­è¿è¡Œï¼Œè¾“å‡ºä¸º123456789$ python /e/pyws/path_demo.pysys.path[0] = E:\\pywssys.argv[0] = E:/pyws/path_demo.py__file__ = E:/pyws/path_demo.pyos.path.abspath(__file__) = E:\\pyws\\path_demo.pyos.path.realpath(__file__) = E:\\pyws\\path_demo.pyos.path.dirname(os.path.realpath(__file__)) = E:\\pywsos.path.split(os.path.realpath(__file__)) = ('E:\\\\pyws', 'path_demo.py')os.getcwd() = D:\\ åœ¨eç›˜ä¸­ç”¨å‘½ä»¤è¡Œç›´æ¥æ‰§è¡Œè„šæœ¬123456789$ ./pyws/path_demo.pysys.path[0] = E:\\pywssys.argv[0] = ./pyws/path_demo.py__file__ = ./pyws/path_demo.pyos.path.abspath(__file__) = E:\\pyws\\path_demo.pyos.path.realpath(__file__) = E:\\pyws\\path_demo.pyos.path.dirname(os.path.realpath(__file__)) = E:\\pywsos.path.split(os.path.realpath(__file__)) = ('E:\\\\pyws', 'path_demo.py')os.getcwd() = E:\\","link":"/2017/07/31/Python/Python-get-path/"},{"title":"PyQt çº¿ç¨‹ç±» QThread","text":"PyQtä¸­çš„çº¿ç¨‹ç±» QtCore.QThreadï¼Œä½¿ç”¨æ—¶ç»§æ‰¿QThreadç±» å¯åŠ¨ç•Œé¢çš„çº¿ç¨‹æš‚ç§°ä¸ºUIçº¿ç¨‹ã€‚ç•Œé¢æ‰§è¡Œå‘½ä»¤æ—¶éƒ½åœ¨è‡ªå·±çš„UIçº¿ç¨‹ä¸­ã€‚å¦‚æœåœ¨UIçº¿ç¨‹ä¸­æ‰§è¡Œç½‘ç»œè¿æ¥å’Œæ•°æ®åº“æ“ä½œç­‰è€—æ—¶çš„æ“ä½œï¼Œç•Œé¢ä¼šè¢«å¡ä½ï¼ŒWindowsä¸‹æœ‰å¯èƒ½ä¼šå‡ºç°â€œæ— å“åº”â€çš„è­¦å‘Šã€‚é˜»å¡UIçº¿ç¨‹ä¼šé™ä½ç”¨æˆ·ä½“éªŒå’Œåº”ç”¨ç¨³å®šæ€§ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠè€—æ—¶æ“ä½œæ”¾åœ¨çº¿ç¨‹ä¸­å»æ‰§è¡Œã€‚ QThreadä»£è¡¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å¤å†™runå‡½æ•°æ¥æ‰§è¡Œæˆ‘ä»¬è¦çš„æ“ä½œã€‚QThreadå¯ä»¥ä½¿ç”¨QtCore.pyqtSignalæ¥ä¸ç•Œé¢äº¤äº’å’Œä¼ è¾“æ•°æ®ã€‚ PyQt4 QThread ä»£ç ç¤ºä¾‹ Python2.7 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667# -*- coding: utf-8 -*-import sysfrom PyQt4 import QtCorefrom PyQt4.QtCore import QCoreApplicationfrom PyQt4.QtGui import QWidget, QPushButton, QApplication, QTextBrowserclass TimeThread(QtCore.QThread): signal_time = QtCore.pyqtSignal(str, int) # ä¿¡å· def __init__(self, parent=None): super(TimeThread, self).__init__(parent) self.working = True self.num = 0 def start_timer(self): self.num = 0 self.start() def run(self): while self.working: print &quot;Working&quot;, self.thread() self.signal_time.emit(&quot;Running time:&quot;, self.num) # å‘é€ä¿¡å· self.num += 1 self.sleep(1)class TimeDialog(QWidget): def __init__(self): super(TimeDialog, self).__init__() self.timer_tv = QTextBrowser(self) self.init_ui() self.timer_t = TimeThread() self.timer_t.signal_time.connect(self.update_timer_tv) def init_ui(self): self.resize(300, 200) self.setWindowTitle('TimeDialog') self.timer_tv.setText(&quot;Wait&quot;) self.timer_tv.setGeometry(QtCore.QRect(10, 145, 198, 26)) self.timer_tv.move(0, 15) btn1 = QPushButton('Quit', self) btn1.setToolTip('Click to quit') btn1.resize(btn1.sizeHint()) btn1.move(200, 150) btn1.clicked.connect(QCoreApplication.instance().quit) start_btn = QPushButton('Start', self) start_btn.setToolTip(&quot;Click to start&quot;) start_btn.move(50, 150) self.connect(start_btn, QtCore.SIGNAL(&quot;clicked()&quot;), self.click_start_btn) def click_start_btn(self): self.timer_t.start_timer() def update_timer_tv(self, text, number): self.timer_tv.setText(self.tr(text + &quot; &quot; + str(number)))if __name__ == '__main__': app = QApplication(sys.argv) time_dialog = TimeDialog() time_dialog.show() sys.exit(app.exec_()) QThreadä¸­ä½¿ç”¨çš„ä¿¡å·signal_time = QtCore.pyqtSignal(str, int) æŒ‡å®šäº†å‚æ•°strå’Œintå‘é€ä¿¡å·self.signal_time.emit(&quot;Running time:&quot;, self.num) å¤–éƒ¨æ¥æ”¶ä¿¡å·self.timer_t.signal_time.connect(self.update_timer_tv)ä¿¡å·è¿æ¥åˆ°æ–¹æ³•update_timer_tv(self, text, number)ï¼Œæ³¨æ„ä¿¡å·ä¸æ–¹æ³•çš„å‚æ•°è¦ä¸€ä¸€å¯¹åº” ä½¿ç”¨ä¸­æˆ‘ä»¬å¯ä»¥å®šä¹‰å¤šç§ä¸åŒçš„ä¿¡å·QtCore.pyqtSignal å¯åŠ¨çº¿ç¨‹ï¼Œè°ƒç”¨start()","link":"/2017/07/11/PyQt_note/PyQt-QThread/"},{"title":"Python è°ƒç”¨adbå‘½ä»¤","text":"ä½¿ç”¨Pythoné€šè¿‡subprocessè°ƒç”¨adbå‘½ä»¤ã€‚ subprocessåŒ…ä¸»è¦åŠŸèƒ½æ˜¯æ‰§è¡Œå¤–éƒ¨å‘½ä»¤ï¼ˆç›¸å¯¹Pythonè€Œè¨€ï¼‰ã€‚å’Œshellç±»ä¼¼ã€‚ æ¢è¨€ä¹‹é™¤äº†adbå‘½ä»¤å¤–ï¼Œåˆ©ç”¨subprocesså¯ä»¥æ‰§è¡Œå…¶ä»–çš„å‘½ä»¤ï¼Œæ¯”å¦‚lsï¼Œcdç­‰ç­‰ã€‚ subprocess å¯å‚è€ƒï¼š https://docs.python.org/2/library/subprocess.html åœ¨ç”µè„‘ä¸Šè£…å¥½adbå·¥å…·ï¼Œé…ç½®å¥½adbçš„ç¯å¢ƒå˜é‡ï¼Œå…ˆç¡®ä¿shellä¸­å¯ä»¥è°ƒç”¨adbå‘½ä»¤ã€‚ ä»£ç ç¤ºä¾‹ Python2.7 ç±» Adbï¼Œå°è£…äº†ä¸€äº›adbçš„æ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546import osimport subprocessclass Adb(object): &quot;&quot;&quot; Provides some adb methods &quot;&quot;&quot; @staticmethod def adb_devices(): &quot;&quot;&quot; Do adb devices :return The first connected device ID &quot;&quot;&quot; cmd = &quot;adb devices&quot; c_line = subprocess.Popen(cmd, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE).communicate()[0] if c_line.find(&quot;List of devices attached&quot;) &lt; 0: # adb is not working return None return c_line.split(&quot;\\t&quot;)[0].split(&quot;\\r\\n&quot;)[-1] # This line may have different format @staticmethod def pull_sd_dcim(device, target_dir='E:/files'): &quot;&quot;&quot; Pull DCIM files from device &quot;&quot;&quot; print &quot;Pulling files&quot; des_path = os.path.join(target_dir, device) if not os.path.exists(des_path): os.makedirs(des_path) print des_path cmd = &quot;adb pull /sdcard/DCIM/ &quot; + des_path result = subprocess.Popen(cmd, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE).communicate() print result print &quot;Finish!&quot; return des_path @staticmethod def some_adb_cmd(): p = subprocess.Popen('adb shell cd sdcard&amp;&amp;ls&amp;&amp;cd ../sys&amp;&amp;ls', stdout=subprocess.PIPE, stderr=subprocess.PIPE) return_code = p.poll() while return_code is None: line = p.stdout.readline() return_code = p.poll() line = line.strip() if line: print line print &quot;Done&quot; some_adb_cmdæ–¹æ³•æ‰§è¡Œä¸€è¿ä¸²çš„å‘½ä»¤ã€‚å„ä¸ªå‘½ä»¤ä¹‹é—´ç”¨&amp;&amp;è¿æ¥ã€‚æ¥ç€æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œå°†æ‰§è¡Œç»“æœæ‰“å°å‡ºæ¥ã€‚ subprocess è¯´æ˜creationflags=CREATE_NEW_CONSOLEåœ¨æ‰§è¡ŒæŒ‡ä»¤æ—¶å¼¹å‡ºä¸€ä¸ªæ–°çš„cmdçª—å£ å¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„batè„šæœ¬ 12345678910from _subprocess import CREATE_NEW_CONSOLEfrom subprocess import Popen def _click_new_cmd_window_btn(self): self.log.info(&quot;click_new_cmd_window_btn&quot;) Popen('cmd', creationflags=CREATE_NEW_CONSOLE) def _click_exe_bat_btn1(self): self.log.info(&quot;run bat&quot;) Popen('C:\\MYDIR\\_debug.bat', creationflags=CREATE_NEW_CONSOLE)","link":"/2017/07/05/Python/Python-adb-use/"},{"title":"Python æŸ¥çœ‹ç›®å½•ä¸­çš„æ–‡ä»¶","text":"ä¸€äº›å…³äºæ–‡ä»¶çš„æ“ä½œä¾‹å¦‚ï¼Œå®ç°æŸ¥çœ‹ç›®å½•å†…å®¹çš„åŠŸèƒ½ã€‚ç±»ä¼¼Linuxä¸‹çš„treeå‘½ä»¤ã€‚ç»Ÿè®¡ç›®å½•ä¸‹æŒ‡å®šåç¼€æ–‡ä»¶çš„è¡Œæ•°ã€‚ åŠŸèƒ½æ˜¯å°†ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶è·¯å¾„å­˜å…¥listä¸­ã€‚å¯ä»¥åŠ å…¥åç¼€åˆ¤æ–­åŠŸèƒ½ï¼Œæœç´¢æŒ‡å®šçš„åç¼€åæ–‡ä»¶ã€‚ä¸»è¦åˆ©ç”¨é€’å½’çš„æ–¹æ³•æ¥æ£€ç´¢æ–‡ä»¶ã€‚ ä»¿é€  tree åŠŸèƒ½ç¤ºä¾‹ä»£ç  Python2.7 åˆ—å‡ºç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶é€’å½’æ³•123456789101112131415161718192021import osdef tree_dir(path, c_path='', is_root=True): &quot;&quot;&quot; Get file list under path. Like 'tree' :param path Root dir :param c_path Child dir :param is_root Current is root dir &quot;&quot;&quot; res = [] if not os.path.exists(path): return res for f in os.listdir(path): if os.path.isfile(os.path.join(path, f)): if is_root: res.append(f) else: res.append(os.path.join(c_path, f)) else: res.extend(tree_dir(os.path.join(path, f), f, is_root=False)) return res ä¸‹é¢æ˜¯åŠ å…¥åç¼€åˆ¤æ–­çš„æ–¹æ³•ã€‚åœ¨æ‰¾åˆ°æ–‡ä»¶åï¼Œåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦ç¬¦åˆåç¼€è¦æ±‚ã€‚ä¸ç¬¦åˆè¦æ±‚çš„æ–‡ä»¶å°±è·³è¿‡ã€‚1234567891011121314151617181920212223def tree_dir_sur(path, c_path='', is_root=True, suffix=''): &quot;&quot;&quot; Get file list under path. Like 'tree' :param path Root dir :param c_path Child dir :param is_root Current is root dir :param suffix Suffix of file &quot;&quot;&quot; res = [] if not os.path.exists(path) or not os.path.isdir(path): return res for f in os.listdir(path): if os.path.isfile(os.path.join(path, f)) and str(f).endswith(suffix): if is_root: res.append(f) else: res.append(os.path.join(c_path, f)) else: res.extend(tree_dir_sur(os.path.join(path, f), f, is_root=False, suffix=suffix)) return resif __name__ == &quot;__main__&quot;: for p in tree_dir_sur(os.path.join('E:\\ws', 'rnote', 'Python_note'), suffix='md'): print p ç»Ÿè®¡ç›®å½•ä¸‹æŒ‡å®šåç¼€æ–‡ä»¶çš„è¡Œæ•°ä»…é€‚ç”¨osä¸­çš„æ–¹æ³•ï¼Œä»…æ£€ç´¢ç›®å½•ä¸­å›ºå®šä½ç½®çš„æ–‡ä»¶ 123456789101112131415161718192021222324252627282930313233343536373839# -*- coding: utf-8 -*-import osdef count_by_categories(path): &quot;&quot;&quot; Find all target files and count the lines &quot;&quot;&quot; if not os.path.exists(path): return c_l_dict = dict() # e.g. {category: lines} category_list = [cate for cate in os.listdir(path) if os.path.isdir(os.path.join(path, cate)) and not cate.startswith('.')] for category_dir in category_list: line_count = _sum_total_line(os.path.join(path, category_dir), '.md') if line_count &gt; 0: c_l_dict[category_dir] = line_count return c_l_dictdef _sum_total_line(path, endswith='.md'): &quot;&quot;&quot; Get the total lines of target files &quot;&quot;&quot; if not os.path.exists(path) or not os.path.isdir(path): return 0 total_lines = 0 for f in os.listdir(path): if f.endswith(endswith): with open(os.path.join(path, f)) as cur_f: total_lines += len(cur_f.readlines()) return total_linesif __name__ == '__main__': note_dir = 'E:/ws/rnote' ca_l_dict = count_by_categories(note_dir) all_lines = 0 for k in ca_l_dict.keys(): all_lines += ca_l_dict[k] print 'all lines:', str(all_lines) print ca_l_dict ä»¥ç¬”è®°æ–‡ä»¶å¤¹ä¸ºä¾‹ï¼Œåˆ†åˆ«ç»Ÿè®¡åˆ†ç±»ç›®å½•ä¸‹æ–‡ä»¶çš„æ€»è¡Œæ•°ï¼Œæµ‹è¯•è¾“å‡º12all lines: 25433{'flash_compile_git_note': 334, 'Linux_note': 387, 'Algorithm_note': 3637, 'Comprehensive': 216, 'advice': 137, 'Java_note': 3013, 'Android_note': 11552, 'DesignPattern': 2646, 'Python_note': 787, 'kotlin': 184, 'cpp_note': 279, 'PyQt_note': 439, 'reading': 686, 'backend': 1136}","link":"/2017/07/01/Python/Python-scan-file/"},{"title":"Android AsyncTask ä½¿ç”¨ä¸åˆ†æ","text":"æœ¬æ–‡ç®€å•ä»‹ç»Androidä¸­çš„AsyncTaskï¼Œå¹¶ä»æºç è§’åº¦åˆ†æå®ƒçš„æµç¨‹å’Œç‰¹ç‚¹ã€‚ AsyncTaskæœ‰åŠ©äºä½¿ç”¨UIçº¿ç¨‹ã€‚è¿™ä¸ªç±»èƒ½è®©ä½ ä¸ä¸»åŠ¨ä½¿ç”¨å¤šçº¿ç¨‹æˆ–Handlerï¼Œåœ¨UIçº¿ç¨‹è¿›è¡Œåå°æ“ä½œå¹¶å‘å¸ƒç»“æœã€‚æ˜¯ä¸€ä¸ªåœ¨ä¸ç”¨å¤šçº¿ç¨‹å’ŒHandlerçš„æƒ…å†µä¸‹çš„å¸®åŠ©ç±»ã€‚AsyncTaské€‚ç”¨äºçŸ­æ—¶é—´çš„æ“ä½œï¼ˆæœ€å¤šå‡ ç§’ï¼‰ã€‚å¦‚éœ€é•¿æ—¶é—´çš„çº¿ç¨‹æ“ä½œï¼Œå»ºè®®ä½¿ç”¨å¤šçº¿ç¨‹åŒ…java.util.concurrentä¸­çš„APIï¼Œæ¯”å¦‚Executorï¼ŒThreadPoolExecutor å’Œ FutureTask AsyncTaskä»»åŠ¡çš„æ„æˆï¼š 3ç§æ³›å‹ï¼šParamsï¼Œ Progress å’Œ Result 4ä¸ªæ­¥éª¤ï¼šonPreExecute, doInBackground, onProgressUpdate å’Œ onPostExecute Googleæ–‡æ¡£ ç”¨æ³•ç®€ä»‹è™šæ„ä¸€ä¸ªè®¡ç®—ä»»åŠ¡1234567891011121314151617181920212223242526272829303132333435363738394041424344 /** * è™šæ‹Ÿçš„è®¡ç®—ä»»åŠ¡ */ private class CalculationTask extends AsyncTask&lt;Float, Integer, Float&gt; { protected Float doInBackground(Float... inputs) { Log.d(TAG, &quot;doInBackground thread ID = &quot; + Thread.currentThread().getId()); long step = 0; float result = 0; for (float f : inputs) { // å‡è®¾è¿™é‡Œæœ‰ä¸€äº›è€—æ—¶çš„æ“ä½œ result += f; } while (step &lt; 5) { result += step; step++; publishProgress((int) step); } return result; } protected void onProgressUpdate(Integer... progress) { Log.d(TAG, &quot;onProgressUpdate thread ID = &quot; + Thread.currentThread().getId()); Log.d(TAG, &quot;onProgressUpdate: &quot; + progress[0]); } protected void onPostExecute(Float result) { Log.d(TAG, &quot;onPostExecute thread ID = &quot; + Thread.currentThread().getId()); Log.d(TAG, &quot;ä»»åŠ¡æ‰§è¡Œå®Œæ¯•&quot;); } } // æ‰§è¡Œä»»åŠ¡ new CalculationTask().execute(1.2f, 2.3f, 6.3f);/*logcatMain thread ID = 1doInBackground thread ID = 8089onProgressUpdate thread ID = 1onProgressUpdate: 1...onProgressUpdate thread ID = 1onProgressUpdate: 5onPostExecute thread ID = 1ä»»åŠ¡æ‰§è¡Œå®Œæ¯•*/ AsyncTask ä½¿ç”¨çš„çš„æ³›å‹AsyncTaskä½¿ç”¨çš„3ç§æ³›å‹ Params é€å»æ‰§è¡Œçš„ç±»å‹ Progress åå°è®¡ç®—çš„è¿›åº¦ç±»å‹ Result åå°è®¡ç®—çš„ç»“æœ ä¸ç”¨çš„æ³›å‹å¯ä»¥ç”¨Voidè¡¨ç¤ºã€‚ä¾‹å¦‚1private class MyTask extends AsyncTask&lt;Void, Void, Void&gt; { ... } å¼‚æ­¥ä»»åŠ¡çš„4ä¸ªæ­¥éª¤å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œæ—¶ç»è¿‡4ä¸ªæ­¥éª¤ onPreExecute() UIçº¿ç¨‹åœ¨ä»»åŠ¡å¼€å§‹å‰è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚æ­¤æ–¹æ³•å¸¸ç”¨æ¥è®¾ç½®ä»»åŠ¡ï¼Œæ¯”å¦‚åœ¨å±å¹•ä¸Šæ˜¾ç¤ºä¸€ä¸ªè¿›åº¦æ¡ã€‚ doInBackground(Params...) onPreExecute()æ‰§è¡Œå®Œæ¯•åç«‹å³åœ¨åå°çº¿ç¨‹ä¸­æ‰§è¡Œã€‚è¿™ä¸€æ­¥ç”¨æ¥æ‰§è¡Œè€—æ—¶çš„åå°è®¡ç®—ã€‚è¿™ä¸ªæ–¹æ³•æ¥å—å¼‚æ­¥ä»»åŠ¡çš„å‚æ•°ï¼Œè¿”å›æœ€åçš„ä»»åŠ¡ç»“æœã€‚è¿™ä¸€æ­¥å¯ä»¥è°ƒç”¨publishProgress(Progress...)é€šçŸ¥å‡ºå»ä¸€ä¸ªæˆ–å¤šä¸ªè¿›åº¦ã€‚è¿™äº›è¿›åº¦å€¼ä¼šè¢«onProgressUpdate(Progress...)åœ¨UIçº¿ç¨‹æ”¶åˆ°ã€‚ onProgressUpdate(Progress...) è°ƒç”¨publishProgress(Progress...)åä¼šåœ¨UIçº¿ç¨‹ä¸­æ‰§è¡Œã€‚ç”¨æ¥æ˜¾ç¤ºæ‰§è¡Œä¸­ä»»åŠ¡çš„UIã€‚ onPostExecute(Result) åå°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ—¶è¢«è°ƒç”¨ã€‚æœ€ç»ˆç»“æœä¼šè¢«ä¼ å…¥è¿™ä¸ªæ–¹æ³•ã€‚ å–æ¶ˆä»»åŠ¡è°ƒç”¨cancel(boolean)å¯éšæ—¶å–æ¶ˆä»»åŠ¡ã€‚å–æ¶ˆä»»åŠ¡åisCancelled()ä¼šè¿”å›trueã€‚è°ƒç”¨è¿™ä¸ªæ–¹æ³•åï¼Œåå°ä»»åŠ¡doInBackground(Object[])æ‰§è¡Œå®Œæ¯•åä¼šè°ƒç”¨onCancelled(Object)è€Œä¸å†æ˜¯onPostExecute(Object)ã€‚ä¸ºä¿è¯ä»»åŠ¡èƒ½è¢«åŠæ—¶åœ°å–æ¶ˆï¼Œåœ¨doInBackground(Object[])ä¸­åº”è¯¥ç»å¸¸æ£€æŸ¥isCancelled()è¿”å›å€¼ çº¿ç¨‹è§„åˆ™ Threading rulesä¸€äº›çº¿ç¨‹è§„åˆ™ å¼‚æ­¥ä»»åŠ¡å¿…é¡»ä»UIçº¿ç¨‹å¯åŠ¨ å¿…é¡»åœ¨UIçº¿ç¨‹å®ä¾‹åŒ–AsyncTaskç±» å¿…é¡»åœ¨UIçº¿ç¨‹è°ƒç”¨execute(Params...) ä¸è¦æ‰‹åŠ¨è°ƒç”¨onPreExecute(), onPostExecute(Result), doInBackground(Params...), onProgressUpdate(Progress...) åŒä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å®ä¾‹åªèƒ½è¢«æ‰§è¡Œä¸€æ¬¡ã€‚é‡å¤æ‰§è¡ŒåŒä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å®ä¾‹ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆIllegalStateExceptionï¼‰ã€‚ æºç ç®€æéœ€è¦è§£å†³çš„é—®é¢˜ï¼šAsyncTaskæ˜¯å¦‚ä½•è°ƒç”¨åå°çº¿ç¨‹å®Œæˆä»»åŠ¡çš„ï¼Ÿçº¿ç¨‹æ˜¯å¦‚ä½•è°ƒåº¦çš„ï¼Ÿ AsyncTaskä½¿ç”¨Executorï¼Œåˆ©ç”¨WorkerRunnableå’ŒFutureTaskæ¥æ‰§è¡Œåå°ä»»åŠ¡123456private final WorkerRunnable&lt;Params, Result&gt; mWorker; // å®ç°äº† Callableprivate final FutureTask&lt;Result&gt; mFuture;private static abstract class WorkerRunnable&lt;Params, Result&gt; implements Callable&lt;Result&gt; { Params[] mParams;} ä½¿ç”¨Handleræ¥è¿›è¡Œçº¿ç¨‹è°ƒåº¦ã€‚å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªç±»InternalHandlerã€‚ ä»execute(Params... params)æ–¹æ³•åˆ‡å…¥å…ˆçœ‹æ–¹æ³•execute(Params... params)ï¼Œä½¿ç”¨é»˜è®¤æ‰§è¡Œå™¨ï¼Œå¹¶ä¼ å…¥å‚æ•°è°ƒç”¨xecuteOnExecutor(Executor exec, Params... params)1234@MainThread // æŒ‡å®šåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œpublic final AsyncTask&lt;Params, Progress, Result&gt; execute(Params... params) { return executeOnExecutor(sDefaultExecutor, params);} å…ˆåˆ¤æ–­å½“å‰çŠ¶æ€ï¼Œå¦‚æœçŠ¶æ€ä¸æ˜¯Status.PENDINGï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚å¦åˆ™è¿›å…¥Status.RUNNINGçŠ¶æ€ï¼Œæ‰§è¡ŒonPreExecute()ï¼Œå†ç”±æ‰§è¡Œå™¨å¯åŠ¨ä»»åŠ¡ã€‚1234567891011121314151617181920@MainThreadpublic final AsyncTask&lt;Params, Progress, Result&gt; executeOnExecutor(Executor exec, Params... params) { if (mStatus != Status.PENDING) { switch (mStatus) { case RUNNING: throw new IllegalStateException(&quot;Cannot execute task:&quot; + &quot; the task is already running.&quot;); case FINISHED: // åŒä¸€ä¸ªä»»åŠ¡å®ä¾‹åªèƒ½å¤Ÿæ‰§è¡Œä¸€æ¬¡ throw new IllegalStateException(&quot;Cannot execute task:&quot; + &quot; the task has already been executed &quot; + &quot;(a task can be executed only once)&quot;); } } mStatus = Status.RUNNING; onPreExecute(); mWorker.mParams = params; exec.execute(mFuture); // å¼€å§‹è¿›å…¥åå°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ return this;} mWorkerå¸¦ç€ä¼ è¿›æ¥çš„å‚æ•°ï¼ŒmFutureå®ä¾‹åŒ–æ—¶å·²ç»å°†mWorkeræ³¨å…¥ã€‚å‚çœ‹æ„é€ å‡½æ•°1234567891011121314151617181920212223242526272829public AsyncTask() { mWorker = new WorkerRunnable&lt;Params, Result&gt;() { public Result call() throws Exception { mTaskInvoked.set(true); Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND); // åœ¨åå°çº¿ç¨‹è¿›è¡Œè‡ªå®šä¹‰çš„æ“ä½œ è¿™é‡Œé¢å¯ä»¥è°ƒç”¨publishProgressæ–¹æ³• Result result = doInBackground(mParams); Binder.flushPendingCommands(); return postResult(result); // å‘é€æœ€ç»ˆç»“æœ } }; mFuture = new FutureTask&lt;Result&gt;(mWorker) { // ä¾èµ– mWorker @Override protected void done() { try { postResultIfNotInvoked(get()); } catch (InterruptedException e) { android.util.Log.w(LOG_TAG, e); } catch (ExecutionException e) { throw new RuntimeException(&quot;An error occurred while executing doInBackground()&quot;, e.getCause()); } catch (CancellationException e) { postResultIfNotInvoked(null); } } };} publishProgressæ–¹æ³•é€šè¿‡ä¸»çº¿ç¨‹çš„Handlerå‘å¤–é€šçŸ¥è¿›åº¦1234567@WorkerThreadprotected final void publishProgress(Progress... values) { if (!isCancelled()) { getHandler().obtainMessage(MESSAGE_POST_PROGRESS, new AsyncTaskResult&lt;Progress&gt;(this, values)).sendToTarget(); }} åå°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ŒpostResultå‘é€æœ€ç»ˆç»“æœ12345678910111213141516private Result postResult(Result result) { @SuppressWarnings(&quot;unchecked&quot;) Message message = getHandler().obtainMessage(MESSAGE_POST_RESULT, new AsyncTaskResult&lt;Result&gt;(this, result)); message.sendToTarget(); // ä¼šèµ°åˆ°finishæ–¹æ³• return result;}private void finish(Result result) { if (isCancelled()) { onCancelled(result); // å¦‚æœä»»åŠ¡å·²ç»è¢«å–æ¶ˆäº† } else { onPostExecute(result); // é€šçŸ¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯• } mStatus = Status.FINISHED;} å…³äºé»˜è®¤æ‰§è¡Œå™¨ sDefaultExecutor å’Œçº¿ç¨‹æ± æºç ä¸­æ„å»ºäº†ä¸€ä¸ªçº¿ç¨‹æ± å’Œä¸€ä¸ªè‡ªå®šä¹‰çš„æ‰§è¡Œå™¨SerialExecutorã€‚é å®ƒä»¬æ¥æ‰§è¡Œåå°ä»»åŠ¡ã€‚ å‚è€ƒæºä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859public abstract class AsyncTask&lt;Params, Progress, Result&gt; { private static final int CPU_COUNT = Runtime.getRuntime().availableProcessors(); // æ ¸å¿ƒçº¿ç¨‹è‡³å°‘2ä¸ªï¼Œæœ€å¤š4ä¸ª private static final int CORE_POOL_SIZE = Math.max(2, Math.min(CPU_COUNT - 1, 4)); private static final int MAXIMUM_POOL_SIZE = CPU_COUNT * 2 + 1; private static final int KEEP_ALIVE_SECONDS = 30; public static final Executor SERIAL_EXECUTOR = new SerialExecutor(); private static volatile Executor sDefaultExecutor = SERIAL_EXECUTOR; private static final ThreadFactory sThreadFactory = new ThreadFactory() { private final AtomicInteger mCount = new AtomicInteger(1); public Thread newThread(Runnable r) { return new Thread(r, &quot;AsyncTask #&quot; + mCount.getAndIncrement()); } }; private static final BlockingQueue&lt;Runnable&gt; sPoolWorkQueue = new LinkedBlockingQueue&lt;Runnable&gt;(128); public static final Executor THREAD_POOL_EXECUTOR; // å®é™…æ‰§è¡Œè€… static { ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor( CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, KEEP_ALIVE_SECONDS, TimeUnit.SECONDS, sPoolWorkQueue, sThreadFactory); threadPoolExecutor.allowCoreThreadTimeOut(true); THREAD_POOL_EXECUTOR = threadPoolExecutor; } // é»˜è®¤æ‰§è¡Œå™¨çš„ç±» private static class SerialExecutor implements Executor { final ArrayDeque&lt;Runnable&gt; mTasks = new ArrayDeque&lt;Runnable&gt;(); Runnable mActive; public synchronized void execute(final Runnable r) { mTasks.offer(new Runnable() { public void run() { try { r.run(); } finally { scheduleNext(); } } }); if (mActive == null) { scheduleNext(); } } protected synchronized void scheduleNext() { if ((mActive = mTasks.poll()) != null) { THREAD_POOL_EXECUTOR.execute(mActive); } } }}","link":"/2017/06/22/Android/Android-AsyncTask_use_and_RTFSC/"},{"title":"Android IntentService åˆ†æå’Œç”¨æ³•","text":"IntentServiceçš„åˆ†æå’Œç”¨æ³•ï¼Œå®ç”¨æ€§ä»‹ç»ã€‚ IntentService ç®€ä»‹ IntentServiceç»§æ‰¿è‡ªServiceï¼Œå¯ç”¨startServiceå¯åŠ¨ï¼Œä¹Ÿéœ€è¦åœ¨AndroidManifest.xmlä¸­æ³¨å†Œ IntentServiceåœ¨ä¸€ä¸ªå•ç‹¬çš„workerçº¿ç¨‹ä¸­å¤„ç†ä»»åŠ¡ ä»»åŠ¡å®Œæˆåï¼Œä¼šè‡ªåŠ¨åœæ­¢ å¯å¤šæ¬¡å¯åŠ¨åŒä¸€ä¸ªIntentServiceï¼Œå®ƒä»¬ä¼šè‡ªä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ’é˜Ÿå¤„ç† IntentService ä¸ Serviceè€—æ—¶ä»»åŠ¡å¯ä»¥ä¸ç”¨åœ¨Serviceä¸­æ‰‹åŠ¨å¼€å¯çº¿ç¨‹ã€‚å½“æ“ä½œå®Œæˆæ—¶ï¼Œæˆ‘ä»¬ä¸ç”¨æ‰‹åŠ¨åœæ­¢IntentServiceï¼Œå®ƒä¼šè‡ªåŠ¨åˆ¤å®šåœæ­¢ã€‚ IntentService è‡ªåŠ¨åœæ­¢å‚è€ƒIntentServiceæºç ï¼š12345678910111213141516171819202122232425262728293031private volatile ServiceHandler mServiceHandler;private final class ServiceHandler extends Handler { public ServiceHandler(Looper looper) { super(looper); } @Override public void handleMessage(Message msg) { onHandleIntent((Intent)msg.obj); stopSelf(msg.arg1); // ä¼ å…¥startID }}@Overridepublic void onCreate() { super.onCreate(); HandlerThread thread = new HandlerThread(&quot;IntentService[&quot; + mName + &quot;]&quot;); thread.start(); mServiceLooper = thread.getLooper(); mServiceHandler = new ServiceHandler(mServiceLooper);}@Overridepublic void onStart(@Nullable Intent intent, int startId) { Message msg = mServiceHandler.obtainMessage(); msg.arg1 = startId; // è¿™ä¸ªæ˜¯åœæ­¢æœåŠ¡çš„ä¾æ® msg.obj = intent; mServiceHandler.sendMessage(msg);}åˆ©ç”¨ServiceHandleræ¥æ§åˆ¶ç”Ÿå‘½å‘¨æœŸã€‚onCreateæ–¹æ³•ä¸­å¼€å¯äº†ä¸€ä¸ªHandlerThreadæ¥å¤„ç†è¯·æ±‚ã€‚åœ¨onStartä¸­è·å–åˆ°startIdã€‚åœ¨ServiceHandlerä¸­æ¯æ¬¡å¤„ç†å®Œä¸€ä¸ªå‘½ä»¤éƒ½ä¼šè°ƒç”¨stopSelf(int startId)æ–¹æ³•æ¥åœæ­¢æœåŠ¡ã€‚IntentServiceç›´åˆ°å‘½ä»¤é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤è¢«æ‰§è¡Œå®Œåæ‰ä¼šåœæ­¢æœåŠ¡ã€‚ ç”¨æ³•ç¤ºä¾‹æ–°å»ºä¸€ä¸ªæ¨¡æ‹Ÿè®¡ç®—çš„åå°æœåŠ¡CalIntentServiceç»§æ‰¿IntentService1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556/** * æ¨¡æ‹Ÿè®¡ç®—çš„åå°æœåŠ¡ * Created by Rust on 2017/6/9. */public class CalIntentService extends IntentService { private static final String TAG = &quot;rustApp&quot;; private int mStartId = 0; /** * ä¸€å®šè¦ä¸€ä¸ªæ— å‚æ„é€ å™¨ */ public CalIntentService() { this(&quot;cal_intent_service_name&quot;); } /** * Creates an IntentService. Invoked by your subclass's constructor. * * @param name Used to name the worker thread, important only for debugging. */ public CalIntentService(String name) { super(name); } @Override public void onStart(@Nullable Intent intent, int startId) { super.onStart(intent, startId); mStartId = startId; Log.d(TAG, &quot;[CalIntentService] onStart, startId=&quot; + mStartId); // å¤å†™è¿™ä¸ªæ–¹æ³•æ¥çœ‹startId } @Override public void onDestroy() { super.onDestroy(); // è§‚å¯Ÿç”Ÿå‘½å‘¨æœŸ Log.d(TAG, &quot;[CalIntentService] onDestroy. StartId=&quot; + mStartId); } @Override protected void onHandleIntent(@Nullable Intent intent) { if (null != intent) { String name = intent.getStringExtra(&quot;name&quot;); String msg = intent.getStringExtra(&quot;msg&quot;); Log.d(TAG, &quot;[CalIntentService] æ”¶åˆ° name:&quot; + name + &quot;, msg:&quot; + msg + &quot;, at &quot; + Thread.currentThread().toString()); } try { Thread.sleep(1000); // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ } catch (InterruptedException e) { e.printStackTrace(); } Log.d(TAG, &quot;[CalIntentService] è®¡ç®—ç»“æŸ. mStartId=&quot; + mStartId); }} AndroidManifestä¸­æ³¨å†Œè¿™ä¸ªæœåŠ¡ã€‚ç›®å‰åªå…è®¸æœ¬Appä½¿ç”¨123&lt;service android:name=&quot;com.rustfisher.service.CalIntentService&quot; android:exported=&quot;false&quot; /&gt; Activityä¸­å¯åŠ¨è¿™ä¸ªæœåŠ¡123456789btn2.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { Intent calIntent = new Intent(getApplicationContext(), CalIntentService.class); calIntent.putExtra(&quot;name&quot;, &quot;Rust&quot;); calIntent.putExtra(&quot;msg&quot;, &quot;Click event: &quot; + mClickCount++); startService(calIntent); }}); åœ¨æ‰‹æœºä¸Šè¿è¡Œï¼Œå¿«é€Ÿç‚¹å‡»å‡ æ¬¡æŒ‰é’®ï¼Œå¯åŠ¨IntentServiceï¼Œlogcatè¾“å‡º12345678910111213[CalIntentService] onStart, startId=1[CalIntentService] æ”¶åˆ° name:Rust, msg:Click event: 0, at Thread[IntentService[cal_intent_service_name],5,main][CalIntentService] onStart, startId=2[CalIntentService] onStart, startId=3[CalIntentService] onStart, startId=4[CalIntentService] è®¡ç®—ç»“æŸ. æœ€æ–°StartId=4[CalIntentService] æ”¶åˆ° name:Rust, msg:Click event: 1, at Thread[IntentService[cal_intent_service_name],5,main][CalIntentService] è®¡ç®—ç»“æŸ. æœ€æ–°StartId=4[CalIntentService] æ”¶åˆ° name:Rust, msg:Click event: 2, at Thread[IntentService[cal_intent_service_name],5,main][CalIntentService] è®¡ç®—ç»“æŸ. æœ€æ–°StartId=4[CalIntentService] æ”¶åˆ° name:Rust, msg:Click event: 3, at Thread[IntentService[cal_intent_service_name],5,main][CalIntentService] è®¡ç®—ç»“æŸ. æœ€æ–°StartId=4[CalIntentService] onDestroy. StartId=4 å¯ä»¥çœ‹å‡ºï¼Œå…ˆæ‰§è¡ŒonStartï¼Œç„¶åæ’é˜Ÿæ‰§è¡ŒonHandleIntentã€‚ä»»åŠ¡å…¨éƒ¨ç»“æŸåè‡ªè¡Œåœæ­¢ã€‚","link":"/2017/06/09/Android/Android-IntentService-intro1/"},{"title":"Android Handlerï¼ŒLooper ä¸ MessageQueue ä½¿ç”¨ä¸åˆ†æ","text":"Handler ç®€ä»‹ä¸€ä¸ªHandlerå…è®¸å‘é€å’Œå¤„ç†Messageï¼Œé€šè¿‡å…³è”çº¿ç¨‹çš„ MessageQueue æ‰§è¡Œ Runnable å¯¹è±¡ã€‚æ¯ä¸ªHandlerå®ä¾‹éƒ½å’Œä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹åŠå…¶æ¶ˆæ¯é˜Ÿåˆ—ç»‘å®šã€‚å¯ä»¥å°†ä¸€ä¸ªä»»åŠ¡åˆ‡æ¢åˆ°Handleræ‰€åœ¨çš„çº¿ç¨‹ä¸­å»æ‰§è¡Œã€‚ä¸€ä¸ªç”¨æ³•å°±æ˜¯å­çº¿ç¨‹é€šè¿‡Handleræ›´æ–°UIã€‚ Handlerä¸»è¦æœ‰2ç§ç”¨æ³•ï¼š åšå‡ºè®¡åˆ’ï¼Œåœ¨æœªæ¥æŸä¸ªæ—¶é—´ç‚¹æ‰§è¡Œæ¶ˆæ¯å’ŒRunnable çº¿ç¨‹è°ƒåº¦ï¼Œåœ¨å…¶ä»–çº¿ç¨‹è§„åˆ’å¹¶æ‰§è¡Œä»»åŠ¡ è¦ä½¿ç”¨å¥½Handlerï¼Œéœ€è¦äº†è§£ä¸å…¶ç›¸å…³çš„ MessageQueueï¼Œ Messageå’ŒLooperï¼›ä¸èƒ½å­¤ç«‹çš„çœ‹Handlerã€‚Handlerå°±åƒä¸€ä¸ªæ“ä½œè€…ï¼ˆæˆ–è€…åƒä¸€ä¸ªå¯¹å¼€å‘è€…å¼€æ”¾çš„çª—å£ï¼‰ï¼Œåˆ©ç”¨MessageQueueå’ŒLooperæ¥å®ç°ä»»åŠ¡è°ƒåº¦å’Œå¤„ç†ã€‚ HandleræŒæœ‰ Looper çš„å®ä¾‹ï¼Œç›´æ¥æŒæœ‰looperçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ å±æ€§ä¸æ„é€ å™¨Handlerç±»ä¸­æŒæœ‰çš„å®ä¾‹ï¼ŒæŒæœ‰looperï¼ŒmessageQueueç­‰ç­‰ã€‚123final Looper mLooper; // HandleræŒæœ‰Looperå®ä¾‹final MessageQueue mQueue; // HandleræŒæœ‰æ¶ˆæ¯é˜Ÿåˆ—final Callback mCallback; åœ¨Handlerçš„æ„é€ å™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Handlerè·å–äº†Looperçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚12345678910111213public Handler(Callback callback, boolean async) { // å¤„ç†å¼‚å¸¸ mLooper = Looper.myLooper(); // å¤„ç†ç‰¹æ®Šæƒ…å†µ... mQueue = mLooper.mQueue; // è·å–çš„æ˜¯Looperçš„æ¶ˆæ¯é˜Ÿåˆ—}public Handler(Looper looper, Callback callback, boolean async) { mLooper = looper; mQueue = looper.mQueue; // è·å–çš„æ˜¯Looperçš„æ¶ˆæ¯é˜Ÿåˆ— mCallback = callback; mAsynchronous = async;} Handlerçš„ä½¿ç”¨æ–¹æ³•Handlerå‘é€å’Œå¤„ç†æ¶ˆæ¯çš„å‡ ä¸ªæ–¹æ³• void handleMessage( Message msg):å¤„ç†æ¶ˆæ¯çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é€šå¸¸è¢«é‡å†™ã€‚ final boolean hasMessage(int what):æ£€æŸ¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ˜¯å¦åŒ…å«æœ‰whatå±æ€§ä¸ºæŒ‡å®šå€¼çš„æ¶ˆæ¯ final boolean hasMessage(int what ,Object object) :æ£€æŸ¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ˜¯å¦åŒ…å«æœ‰whatå¥½objectå±æ€§æŒ‡å®šå€¼çš„æ¶ˆæ¯ sendEmptyMessage(int what):å‘é€ç©ºæ¶ˆæ¯ final Boolean send EmptyMessageDelayed(int what ,long delayMillis):æŒ‡å®šå¤šå°‘æ¯«ç§’å‘é€ç©ºæ¶ˆæ¯ final boolean sendMessage(Message msg):ç«‹å³å‘é€æ¶ˆæ¯ final boolean sendMessageDelayed(Message msg,long delayMillis):å¤šå°‘ç§’ä¹‹åå‘é€æ¶ˆæ¯ Handler.sendEmptyMessage(int what) æµç¨‹è§£æè·å–ä¸€ä¸ªMessageå®ä¾‹ï¼Œå¹¶ç«‹å³å°†Messageå®ä¾‹æ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­å»ã€‚ç®€è¦æµç¨‹å¦‚ä¸‹ï¼š123456789101112131415161718// ç«‹åˆ»å‘é€ä¸€ä¸ªemptyæ¶ˆæ¯sendEmptyMessage(int what) // å‘é€å»¶è¿Ÿä¸º0çš„emptyæ¶ˆæ¯ è¿™ä¸ªæ–¹æ³•é‡Œé€šè¿‡Message.obtain()è·å–ä¸€ä¸ªMessageå®ä¾‹sendEmptyMessageDelayed(what, 0) // è®¡ç®—æ¶ˆæ¯çš„è®¡åˆ’æ‰§è¡Œæ—¶é—´ï¼Œè¿›å…¥ä¸‹ä¸€é˜¶æ®µsendMessageDelayed(Message msg, long delayMillis)// åœ¨è¿™é‡Œåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºnull è‹¥ä¸ºnullåˆ™ç›´æ¥è¿”å›falsesendMessageAtTime(Message msg, long uptimeMillis)// å°†æ¶ˆæ¯æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­enqueueMessage(MessageQueue queue, Message msg, long uptimeMillis)// æ¥ä¸‹æ¥æ˜¯MessageQueueæ·»åŠ æ¶ˆæ¯// MessageQueue.javaboolean enqueueMessage(Message msg, long when)å¯ä»¥çœ‹åˆ°ï¼Œæœ€åæ˜¯æŠŠmessageæ·»åŠ åˆ°äº†messageQueueä¸­ã€‚ Handler å–æ¶ˆä»»åŠ¡è¦å–æ¶ˆä»»åŠ¡æ—¶ï¼Œè°ƒç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•removeCallbacksAndMessages(Object token)123public final void removeCallbacksAndMessages(Object token) { mQueue.removeCallbacksAndMessages(this, token);}é€šè¿‡è°ƒç”¨Message.recycleUnchecked()æ–¹æ³•ï¼Œå–æ¶ˆæ‰ä¸æ­¤Handlerç›¸å…³è”çš„Messageã€‚ ç›¸å…³çš„æ¶ˆæ¯é˜Ÿåˆ—ä¼šæ‰§è¡Œå–æ¶ˆæŒ‡ä»¤1void removeCallbacksAndMessages(Handler h, Object object) æ¶ˆæ¯é©±åŠ¨ä¸HandlerAndroidæ˜¯æ¶ˆæ¯é©±åŠ¨çš„ï¼Œå®ç°æ¶ˆæ¯é©±åŠ¨æœ‰å‡ ä¸ªè¦ç´  æ¶ˆæ¯çš„è¡¨ç¤ºï¼šMessage æ¶ˆæ¯é˜Ÿåˆ—ï¼šMessageQueue æ¶ˆæ¯å¾ªç¯ï¼Œç”¨äºå¾ªç¯å–å‡ºæ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼šLooper æ¶ˆæ¯å¤„ç†ï¼Œæ¶ˆæ¯å¾ªç¯ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯åè¦å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼šHandler åˆå§‹åŒ–æ¶ˆæ¯é˜Ÿåˆ—åœ¨Looperæ„é€ å™¨ä¸­å³åˆ›å»ºäº†ä¸€ä¸ªMessageQueueï¼ŒLooperæŒæœ‰æ¶ˆæ¯é˜Ÿåˆ—çš„å®ä¾‹ã€‚ å‘é€æ¶ˆæ¯é€šè¿‡Looper.prepareåˆå§‹åŒ–å¥½æ¶ˆæ¯é˜Ÿåˆ—åå°±å¯ä»¥è°ƒç”¨Looper.loopè¿›å…¥æ¶ˆæ¯å¾ªç¯äº†ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥å‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼Œæ¶ˆæ¯å¾ªç¯å°±ä¼šå–å‡ºæ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œåœ¨çœ‹æ¶ˆæ¯å¤„ç†ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸‹æ¶ˆæ¯æ˜¯æ€ä¹ˆè¢«æ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„ã€‚ æ¶ˆæ¯å¾ªç¯Javaå±‚çš„æ¶ˆæ¯éƒ½ä¿å­˜åœ¨äº†Javaå±‚MessageQueueçš„æˆå‘˜mMessagesä¸­ï¼ŒNativeå±‚çš„æ¶ˆæ¯éƒ½ä¿å­˜åœ¨äº†Native Looperçš„mMessageEnvelopesä¸­ï¼Œè¿™å°±å¯ä»¥è¯´æœ‰ä¸¤ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œä¸”éƒ½æ˜¯æŒ‰æ—¶é—´æ’åˆ—çš„ã€‚ Message å’Œ MessageQueue ç®€ä»‹ä¸Handlerå·¥ä½œçš„å‡ ä¸ªç»„ä»¶Looperã€MessageQueueå„è‡ªçš„ä½œç”¨ï¼š 1.Handlerï¼šå®ƒæŠŠæ¶ˆæ¯å‘é€ç»™Looperç®¡ç†çš„MessageQueue,å¹¶è´Ÿè´£å¤„ç†Looperåˆ†ç»™å®ƒçš„æ¶ˆæ¯ 2.MessageQueueï¼šç®¡ç†Messageï¼Œç”±Looperç®¡ç† 3.Looperï¼šæ¯ä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ªLooperï¼Œæ¯”å¦‚UIçº¿ç¨‹ä¸­ï¼Œç³»ç»Ÿä¼šé»˜è®¤çš„åˆå§‹åŒ–ä¸€ä¸ªLooperå¯¹è±¡ï¼Œå®ƒè´Ÿè´£ç®¡ç†MessageQueueï¼Œä¸æ–­çš„ä»MessageQueueä¸­å–æ¶ˆæ¯ï¼Œå¹¶å°†ç›¸å¯¹åº”çš„æ¶ˆæ¯åˆ†ç»™Handlerå¤„ç†ã€‚ MessageMessage å±äºè¢«ä¼ é€’ï¼Œè¢«ä½¿ç”¨çš„è§’è‰²ã€‚Message æ˜¯åŒ…å«æè¿°å’Œä»»æ„æ•°æ®å¯¹è±¡çš„â€œæ¶ˆæ¯â€ï¼Œèƒ½è¢«å‘é€ç»™Handlerã€‚MessageåŒ…å«2ä¸ªintå±æ€§å’Œä¸€ä¸ªé¢å¤–çš„å¯¹è±¡ã€‚è™½ç„¶æ„é€ å™¨æ˜¯å…¬å¼€çš„ï¼Œä½†è·å–å®ä¾‹æœ€å¥½çš„åŠæ³•æ˜¯è°ƒç”¨Message.obtain()æˆ–Handler.obtainMessage()ã€‚è¿™æ ·å¯ä»¥ä»ä»–ä»¬çš„å¯å›æ”¶å¯¹è±¡æ± ä¸­è·å–åˆ°æ¶ˆæ¯å®ä¾‹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ¯ä¸ªMessageå®ä¾‹æŒæœ‰ä¸€ä¸ªHandlerã€‚ Messageéƒ¨åˆ†å±æ€§å€¼1234567/*package*/ Handler target; // æŒ‡å®šçš„Handler/*package*/ Runnable callback;// å¯ä»¥ç»„æˆé“¾è¡¨// sometimes we store linked lists of these things/*package*/ Message next;ä»è¿™é‡Œä¹Ÿä¸éš¾çœ‹å‡ºï¼Œæ¯ä¸ªMessageéƒ½æŒæœ‰Handlerå®ä¾‹ã€‚å¦‚æœHandleræŒæœ‰Activityçš„å¼•ç”¨ï¼ŒActivity onDestroyåMessageå´ä»ç„¶åœ¨é˜Ÿåˆ—ä¸­ï¼Œå› ä¸ºHandlerä¸Activityçš„å¼ºå…³è”ï¼Œä¼šé€ æˆActivityæ— æ³•è¢«GCå›æ”¶ï¼Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚å› æ­¤åœ¨Activity onDestroy æ—¶ï¼Œä¸Activityå…³è”çš„Handleråº”æ¸…é™¤å®ƒçš„é˜Ÿåˆ—ç”±Activityäº§ç”Ÿçš„ä»»åŠ¡ï¼Œé¿å…å†…å­˜æ³„éœ²ã€‚ é‡ç½®è‡ªèº«çš„æ–¹æ³•ï¼Œå°†å±æ€§å…¨éƒ¨é‡ç½®12public void recycle()void recycleUnchecked() è·å–Messageå®ä¾‹çš„å¸¸ç”¨æ–¹æ³•ï¼Œå¾—åˆ°çš„å®ä¾‹ä¸ä¼ å…¥çš„Handlerç»‘å®š1234567891011/** * Same as {@link #obtain()}, but sets the value for the &lt;em&gt;target&lt;/em&gt; member on the Message returned. * @param h Handler to assign to the returned Message object's &lt;em&gt;target&lt;/em&gt; member. * @return A Message object from the global pool. */public static Message obtain(Handler h) { Message m = obtain(); m.target = h; return m;} å°†æ¶ˆæ¯å‘é€ç»™Handler1234567/** * Sends this Message to the Handler specified by {@link #getTarget}. * Throws a null pointer exception if this field has not been set. */public void sendToTarget() { target.sendMessage(this); // target å°±æ˜¯ä¸æ¶ˆæ¯ç»‘å®šçš„Handler}è°ƒç”¨è¿™ä¸ªæ–¹æ³•åï¼ŒHandlerä¼šå°†æ¶ˆæ¯æ·»åŠ è¿›å®ƒçš„æ¶ˆæ¯é˜Ÿåˆ—MessageQueueä¸­ã€‚ MessageQueueæŒæœ‰ä¸€åˆ—å¯ä»¥è¢«Looperåˆ†å‘çš„Messageã€‚ä¸€èˆ¬æ¥è¯´ç”±Handlerå°†Messageæ·»åŠ åˆ°MessageQueueä¸­ã€‚è·å–å½“å‰çº¿ç¨‹çš„MessageQueueæ–¹æ³•æ˜¯Looper.myQueue()ã€‚é€šè¿‡Looper.getMainLooper()è·å–åˆ°ä¸»çº¿ç¨‹çš„looperã€‚ Looper ç®€ä»‹Looperä¸MessageQueueç´§å¯†å…³è”ã€‚åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œçš„æ¶ˆæ¯å¾ªç¯ã€‚çº¿ç¨‹é»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰ä¸ä¹‹ç®¡ç†çš„æ¶ˆæ¯å¾ªç¯çš„ã€‚è¦åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯å¾ªç¯ï¼Œåœ¨çº¿ç¨‹ä¸­è°ƒç”¨prepareï¼Œç„¶åè°ƒç”¨loopã€‚å³å¼€å§‹å¤„ç†æ¶ˆæ¯ï¼Œç›´åˆ°å¾ªç¯åœæ­¢ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹é€šè¿‡Handleræ¥ä¸æ¶ˆæ¯å¾ªç¯äº’åŠ¨ã€‚ Handlerä¸Looperåœ¨çº¿ç¨‹ä¸­äº¤äº’çš„å…¸å‹ä¾‹å­1234567891011121314class LooperThread extends Thread { public Handler mHandler; public void run() { Looper.prepare(); // ä¸ºå½“å‰çº¿ç¨‹å‡†å¤‡ä¸€ä¸ªLooper // åˆ›å»ºHandlerå®ä¾‹ï¼ŒHandlerä¼šè·å–å½“å‰çº¿ç¨‹çš„Looper // å¦‚æœå®ä¾‹åŒ–Handleræ—¶å½“å‰çº¿ç¨‹æ²¡æœ‰Looperï¼Œä¼šæŠ¥å¼‚å¸¸ RuntimeException mHandler = new Handler() { public void handleMessage(Message msg) { // process incoming messages here } }; Looper.loop(); // Looperå¼€å§‹è¿è¡Œ }} è°ƒç”¨äº†Looper.loop()ä¹‹åï¼Œlooperå¼€å§‹è¿è¡Œã€‚å½“looperçš„messageQueueä¸­æ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œç›¸å…³çš„çº¿ç¨‹å¤„äºä»€ä¹ˆçŠ¶æ€å‘¢ï¼ŸæŸ¥çœ‹looperçš„æºç ï¼Œçœ‹åˆ°loopæ–¹æ³•é‡Œé¢æœ‰ä¸€ä¸ªæ­»å¾ªç¯ã€‚queue.next()æ–¹æ³•æ˜¯å¯èƒ½ä¼šé˜»å¡çº¿ç¨‹çš„ã€‚å¦‚æœä»queueä¸­è·å–åˆ°nullï¼Œåˆ™è¡¨æ˜æ­¤æ¶ˆæ¯é˜Ÿåˆ—æ­£åœ¨é€€å‡ºã€‚æ­¤æ—¶looperçš„æ­»å¾ªç¯ä¹Ÿä¼šè¢«è¿”å›ã€‚123456for (;;) { Message msg = queue.next(); // might block if (msg == null) { // No message indicates that the message queue is quitting. return; }è°ƒç”¨looperçš„quitæ–¹æ³•ï¼Œå®é™…ä¸Šè°ƒç”¨äº†mQueue.quit(false)ã€‚æ¶ˆæ¯é˜Ÿåˆ—é€€å‡ºåï¼Œlooperçš„loopæ­»å¾ªç¯ä¹Ÿè¢«é€€å‡ºäº†ã€‚ è¿›å…¥MessageQueueçš„nextæ–¹æ³•å»çœ‹ï¼Œå‘ç°é‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ªæ­»å¾ªç¯ã€‚æ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œè¿™ä¸ªæ­»å¾ªç¯ä¼šé˜»å¡åœ¨nativePollOnceè¿™ä¸ªæ–¹æ³•ã€‚123456Message next() { // ... for (;;) { // ... nativePollOnce(ptr, nextPollTimeoutMillis); // å¤„ç†messageå¯¹è±¡ æˆ‘ä»¬çŸ¥é“Threadæœ‰Newï¼ˆæ–°å»ºï¼Œæœªè¿è¡Œï¼‰ï¼ŒRUNNABLEï¼ˆæ­£å¸¸è¿è¡Œï¼‰ï¼ŒBLOCKEDï¼ŒWAITINGï¼ˆçº¿ç¨‹æ‹¥æœ‰äº†æŸä¸ªé”ä¹‹å, è°ƒç”¨äº†ä»–çš„waitæ–¹æ³•, ç­‰å¾…å…¶ä»–çº¿ç¨‹/é”æ‹¥æœ‰è€…è°ƒç”¨ notify / notifyAllï¼‰ï¼ŒTIMED_WAITINGï¼ŒTERMINATEDï¼ˆå·²ç»æ‰§è¡Œå®Œæ¯•ï¼‰è¿™å‡ ç§çŠ¶æ€ã€‚æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯ï¼Œåœ¨nativePollOnceæ–¹æ³•ä¸­â€œç­‰å¾…â€ã€‚ç›¸å…³çº¿ç¨‹åˆ™å¤„äºRUNNABLEçŠ¶æ€ã€‚ å‚è€ƒï¼šhttps://stackoverflow.com/questions/38818642/android-what-is-message-queue-native-poll-once-in-android Looperä¸­çš„å±æ€§LooperæŒæœ‰MessageQueueï¼›å”¯ä¸€çš„ä¸»çº¿ç¨‹Looper sMainLooperï¼›Looperå½“å‰çº¿ç¨‹ mThreadï¼›å­˜å‚¨Looperçš„sThreadLocal123456// sThreadLocal.get() will return null unless you've called prepare().static final ThreadLocal&lt;Looper&gt; sThreadLocal = new ThreadLocal&lt;Looper&gt;();private static Looper sMainLooper; // guarded by Looper.classfinal MessageQueue mQueue; // Handlerä¼šè·å–è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å®ä¾‹ï¼ˆå‚è€ƒHandleræ„é€ å™¨ï¼‰final Thread mThread; // Looperå½“å‰çº¿ç¨‹ ThreadLocalå¹¶ä¸æ˜¯çº¿ç¨‹ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¯ä»¥åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­å­˜å‚¨æ•°æ®ã€‚ Looper æ–¹æ³•å‡†å¤‡æ–¹æ³•ï¼Œå°†å½“å‰çº¿ç¨‹åˆå§‹åŒ–ä¸ºLooperã€‚é€€å‡ºæ—¶è¦è°ƒç”¨quit12345678910public static void prepare() { prepare(true);}private static void prepare(boolean quitAllowed) { if (sThreadLocal.get() != null) { throw new RuntimeException(&quot;Only one Looper may be created per thread&quot;); } sThreadLocal.set(new Looper(quitAllowed)); // Looperå®ä¾‹å­˜å…¥äº†sThreadLocal} prepareæ–¹æ³•æ–°å»º Looper å¹¶å­˜å…¥ sThreadLocal sThreadLocal.set(new Looper(quitAllowed))ThreadLocal&lt;T&gt;ç±»12345678910111213141516171819public void set(T value) { Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) map.set(this, value); else createMap(t, value);}public T get() { Thread t = Thread.currentThread(); ThreadLocalMap map = getMap(t); if (map != null) { ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) return (T)e.value; } return setInitialValue();} å½“è¦è·å–Looperå¯¹è±¡æ—¶ï¼Œä»sThreadLocalè·å–1234// è·å–ä¸å½“å‰çº¿ç¨‹å…³è”çš„Looperï¼Œè¿”å›å¯ä»¥ä¸ºnullpublic static @Nullable Looper myLooper() { return sThreadLocal.get();} åœ¨å½“å‰çº¿ç¨‹è¿è¡Œä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ã€‚ç»“æŸåè¦è°ƒç”¨é€€å‡ºæ–¹æ³•quit()1public static void loop() å‡†å¤‡ä¸»çº¿ç¨‹Looperã€‚Androidç¯å¢ƒä¼šåˆ›å»ºä¸»çº¿ç¨‹Looperï¼Œå¼€å‘è€…ä¸åº”è¯¥è‡ªå·±è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚UIçº¿ç¨‹ï¼Œå®ƒå°±æ˜¯ActivityThreadï¼ŒActivityThreadè¢«åˆ›å»ºæ—¶å°±ä¼šåˆå§‹åŒ–Looperï¼Œè¿™ä¹Ÿæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­é»˜è®¤å¯ä»¥ä½¿ç”¨Handlerçš„åŸå› ã€‚123456789public static void prepareMainLooper() { prepare(false); // è¿™é‡Œè¡¨ç¤ºäº†ä¸»çº¿ç¨‹Looperä¸èƒ½ç”±å¼€å‘è€…æ¥é€€å‡º synchronized (Looper.class) { if (sMainLooper != null) { throw new IllegalStateException(&quot;The main Looper has already been prepared.&quot;); } sMainLooper = myLooper(); }} è·å–ä¸»çº¿ç¨‹çš„Looperã€‚æˆ‘ä»¬å¼€å‘è€…æƒ³æ“ä½œä¸»çº¿ç¨‹æ—¶ï¼Œå¯è°ƒç”¨æ­¤æ–¹æ³•1public static Looper getMainLooper() åŒä¸€ä¸ªThreadçš„ä¸åŒHandlerä¸UIçº¿ç¨‹å¯¹åº”çš„MainLooperï¼Œå¯ä»¥å…³è”å¤šä¸ªHandlerã€‚å¤šä¸ªHandlerä¹‹é—´çš„è®¡åˆ’ä»»åŠ¡ä¸ä¼šäº’ç›¸å½±å“ã€‚æ¯”å¦‚æœ‰2ä¸ªå…³è”äº†UIçº¿ç¨‹çš„handlerã€‚123456789101112131415Handler mMainHandler1;Handler mMainHandler2;private void initUtils() { mMainHandler1 = new Handler(Looper.getMainLooper()); mMainHandler2 = new Handler(Looper.getMainLooper()); Log.d(TAG, &quot;mMainHandler1 post ä»»åŠ¡&quot;); mMainHandler1.postDelayed(new Runnable() { @Override public void run() { Log.d(TAG, &quot;mMainHandler1çš„æ¼”ç¤ºä»»åŠ¡å·²æ‰§è¡Œ&quot;); } }, 1500); mMainHandler2.removeCallbacksAndMessages(null);}mMainHandler2å–æ¶ˆå®ƒçš„ä»»åŠ¡å¹¶ä¸ä¼šå½±å“mMainHandler1ã€‚","link":"/2017/06/07/Android/Android-Handler_src_note/"},{"title":"Python æ“ä½œ MySQL","text":"æœ¬æ–‡é“¾æ¥Python æ“ä½œ MySQL å¼€å‘ç¯å¢ƒä¸é…ç½® win_x64 Ubuntu14.04 Python3.x pipå®‰è£…pymysqlæ¨¡å—ç›´æ¥ä½¿ç”¨pipå®‰è£… pip install pymysqlwin64ä¸Šç›´æ¥åœ¨cmdä¸­æ‰§è¡Œ è¿æ¥æœ¬åœ°æ•°æ®åº“ä½¿ç”¨æ¨¡å—pymysqlè¿æ¥æ•°æ®åº“æœ¬åœ°æ•°æ®åº“ç›¸å…³é…ç½®è¯·å‚é˜…ï¼š https://rustfisher.com/2019/02/26/Database/MySQL-install_and_config_Mac/ https://rustfisher.com/2017/02/25/Database/MySQL-install_and_config_Windows/ 123456789101112131415161718#!/usr/bin/python# coding=utf-8import pymysql# è¿æ¥æœ¬åœ°æ•°æ®åº“conn = pymysql.connect(host='localhost', port=3306, user='root', passwd='yourpwd', db='samp_db1', charset='utf8')cursor = conn.cursor()cursor.execute('select * from bigstu')for row in cursor.fetchall(): print(row)# æŸ¥cursor.execute('select id, name from bigstu where age &gt; 22')for res in cursor.fetchall(): print(str(res[0]) + &quot;, &quot; + res[1])cursor.close()print('-- end --') è¾“å‡ºï¼š1234567(1, 'å¼ ä¸‰', 'ç”·', 24, datetime.date(2017, 3, 29), '13666665555')(6, 'å°åˆš', 'ç”·', 23, datetime.date(2017, 3, 11), '778899888')(8, 'å°éœ', 'å¥³', 20, datetime.date(2017, 3, 13), '13712345678')(12, 'å°æ™º', 'ç”·', 21, datetime.date(2017, 3, 7), '13787654321')1, å¼ ä¸‰6, å°åˆš-- end -- å¯ä»¥ç›´æ¥æ‰§è¡Œsqlè¯­å¥ã€‚è·å¾—çš„ç»“æœæ˜¯å…ƒç»„ã€‚ sqlç›¸ä¼¼æ¡ä»¶æŸ¥è¯¢ 1SELECT * FROM anindex.subject_basic_table where season_id having '2018'; å¢æ’å…¥æ•°æ®æ’å…¥ä¸€æ¡æ•°æ®ï¼Œæ¥ä¸Šé¢çš„ä»£ç  1234insertSql = &quot;insert into bigstu (name, sex, age, mobile) values ('%s','%s',%d,'%s') &quot;xiuji = ('ç§€å‰', 'ç”·', 15, '13400001111')cursor.execute(insertSql % xiuji)conn.commit() # åˆ«å¿˜äº†æäº¤ æ·»åŠ åˆ—åœ¨mobileåé¢æ·»åŠ ä¸€åˆ—cash12addCo = &quot;alter table bigstu add cash int after mobile&quot;cursor.execute(addCo) å¦‚æœè¦è®¾ç½®é»˜è®¤å€¼12addCo = &quot;alter table bigstu add cash int default 0 after mobile&quot;cursor.execute(addCo) åˆ åˆ é™¤æ•°æ®åˆ é™¤ name=ç§€å‰ çš„æ•°æ®12deleteSql = &quot;delete from bigstu where name = '%s'&quot;cursor.execute(deleteSql % 'ç§€å‰') åˆ é™¤åˆ—åˆ é™¤cashåˆ—12dropCo = &quot;alter table bigstu drop cash&quot;cursor.execute(dropCo) æ”¹ä¿®æ”¹æ•°æ®æ›´æ–°ç¬¦åˆæ¡ä»¶çš„æ•°æ® 1234updateSql = &quot;update bigstu set sex = '%s' where name = '%s'&quot;updateXiuji = ('ç§€å‰', 'ç§€å‰') # ç§€å‰çš„æ€§åˆ«æ˜¯ç§€å‰cursor.execute(updateSql % updateXiuji)conn.commit() äº‹ç‰©å¤„ç†ç»™æŸä¸ªè®°å½•çš„cashå¢åŠ 1234567891011table = &quot;bigstu&quot;addCash = &quot;update &quot; + table + &quot; set cash = cash + '%d' where name = '%s'&quot;lucky = (1000, &quot;ç§€å‰&quot;)try: cursor.execute(addCash % lucky)except Exception as e: conn.rollback() print(&quot;åŠ é’±å¤±è´¥äº†&quot;)else: conn.commit() ç›´æ¥æ‰§è¡ŒSQLè¯­å¥ï¼Œååˆ†æ–¹ä¾¿ ä»£ç ç‰‡æ®µç»™æ•°æ®åº“æ·»åŠ åˆ—ä»jsonä¸­è¯»å–éœ€è¦æ·»åŠ çš„åˆ—åï¼Œè·å–å½“å‰2ä¸ªè¡¨ä¸­æ‰€æœ‰çš„åˆ—åæ•´ç†å¾—å‡ºéœ€è¦æ’å…¥çš„åˆ—åï¼Œç„¶åå°†åˆ—æ’å…¥åˆ°ç›¸åº”çš„è¡¨ä¸­ 1234567891011121314151617181920212223242526272829303132333435363738import pymysqlimport jsonimport osimport secureUtilsmapping_keys = json.load(open(&quot;key_mapping_db.json&quot;, &quot;r&quot;))db_keys = [] # jsonä¸­æ‰€æœ‰çš„keyfor k in mapping_keys.values(): db_keys.append(k)conn = pymysql.connect(host='localhost', port=3306, user='root', passwd='*****', db='db_name', charset='utf8')cursor = conn.cursor()table_main = &quot;table_main&quot;main_table_keys = [] # ä¸»è¡¨çš„åˆ—åcursor.execute(&quot;show columns from &quot; + table_main)for row in cursor.fetchall(): main_table_keys.append(row[0])staff_table_keys = []cursor.execute(&quot;show columns from table_second&quot;)for row in cursor.fetchall(): staff_table_keys.append(row[0])need_to_insert_keys = []for k in db_keys: if k not in staff_table_keys and k not in main_table_keys and k not in need_to_insert_keys: need_to_insert_keys.append(k)print(&quot;need to insert &quot; + str(len(need_to_insert_keys)))print(need_to_insert_keys)for kn in need_to_insert_keys: print(&quot;add key to db &quot; + kn) cursor.execute(&quot;alter table staff_table add &quot; + kn +&quot; text&quot;)conn.close() å°†å­—æ®µå­—ç¬¦æ”¹å˜è¿™é‡Œå°†main_table_keysä¸­çš„æ‰€æœ‰å­—æ®µæ”¹ä¸ºutf812345# change column character set to utf8for co in main_table_keys: change_sql = &quot;alter table &quot; + table_main + &quot; modify &quot; + co + &quot; text character set utf8&quot; print(change_sql) cursor.execute(change_sql)","link":"/2017/05/25/Python/Python-mysql_use/"},{"title":"Python3 Dictionaryä¸JSON","text":"JSONä¸Dictionaryç®€ä»‹ Python3 PyCharm CE JSONç®€ä»‹JSON(JavaScript Object Notation)æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚å®ƒæ˜¯ä¸€ç§æ–‡æœ¬æ ¼å¼ã€‚å®ƒçš„ç»“æ„ä¸»è¦ç”±é”®å€¼å¯¹æ¥æ„æˆã€‚ä¸€ä¸ªé”®ï¼ˆkeyï¼‰å¯¹åº”ä¸€ä¸ªå€¼ï¼ˆvalueï¼‰ã€‚æœ€å¤–å›´ç”¨å¤§æ‹¬å·{ }åŒ…å›´èµ·æ¥ã€‚ä¾‹å¦‚1234{ &quot;firstName&quot;: &quot;Rust&quot;, &quot;lastName&quot;: &quot;Fisher&quot;} å¤§æ‹¬å·æ‹¬èµ·æ¥çš„å«åšå¯¹è±¡ç»“æ„ã€‚ JSONé‡Œä¹Ÿå¯ä»¥æ”¾æ•°ç»„ã€‚ç”¨ä¸­æ‹¬å·[ ]æ‹¬èµ·æ¥ã€‚å«åšæ•°ç»„ç»“æ„ã€‚12345678910111213{ &quot;desc&quot;:&quot;è¿™ä¸ªæ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­&quot;, &quot;userInfo&quot;:{ &quot;firstName&quot;:&quot;Rust&quot;, &quot;lastName&quot;:&quot;Fisher&quot; }, &quot;books&quot;:[ &quot;Pythonå…¥é—¨&quot;, &quot;Pythonè¿›é˜¶&quot;, &quot;æ•°æ®åˆ†æ&quot;, &quot;å¯è§†åŒ–&quot; ]} å¯¹è±¡ç»“æ„å’Œæ•°ç»„ç»“æ„å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œåªè¦æ»¡è¶³é”®å€¼å¯¹çš„è¦æ±‚å³å¯ã€‚ æœ€å¤–å±‚ä¹Ÿå¯ä»¥æ˜¯ä¸­æ‹¬å·æ‹¬èµ·æ¥çš„ï¼Œé‡Œé¢å­˜æ”¾ç€å¤šä¸ªå¯¹è±¡ã€‚123456789101112131415[ { &quot;firstName&quot;: &quot;Tom&quot;, &quot;lastName&quot;: &quot;Hanks&quot;, &quot;movies&quot;: [&quot;Cast Away&quot;] }, { &quot;userInfo&quot;: { &quot;firstName&quot;: &quot;Rust&quot;, &quot;lastName&quot;: &quot;Fisher&quot; }, &quot;books&quot;: [&quot;Pythonå…¥é—¨&quot;, &quot;Pythonè¿›é˜¶&quot;], &quot;desc&quot;: &quot;å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªkey-valueè¿›å»&quot; }] Pythonçš„Dictionaryï¼ˆå­—å…¸ï¼‰ç®€ä»‹Dictionaryï¼ˆä»¥ä¸‹ç®€ç§°ä¸ºdictæˆ–å­—å…¸ï¼‰æ˜¯ä¸€ç§é”®å€¼å¯¹æ•°æ®ç»“æ„ã€‚æœ‰ç‚¹åƒJavaé‡Œçš„Mapå’ŒSetã€‚ åˆå§‹åŒ–ä¸€ä¸ªdictå¯ä»¥ç›´æ¥ç”¨å¤§æ‹¬å·ã€‚é‡Œé¢å†™ä¸Škeyå’Œvalueã€‚12345678910def use_dict(): user_info = {'firstName': 'Rust', 'lastName': 'Fisher'} books = ['Pythonå…¥é—¨'] books.append('Pythonè¿›é˜¶') result = {'userInfo': user_info, 'books': books} result['desc'] = 'å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªkey-valueè¿›å»' print(result)# è¿è¡Œç»“æœ# {'userInfo': {'firstName': 'Rust', 'lastName': 'Fisher'}, 'books': ['Pythonå…¥é—¨', 'Pythonè¿›é˜¶'], 'desc': 'å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªkey-valueè¿›å»'}å¯ä»¥çœ‹åˆ°ï¼Œdictå’ŒJSONæœ‰äº›ç±»ä¼¼ã€‚éƒ½æ˜¯é”®å€¼å¯¹ï¼Œéƒ½æœ‰æ•°ç»„ç»“æ„ã€‚ä»Pythonè¯­æ³•ä¸Šæ¥çœ‹ï¼Œdictæ“ä½œèµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚æ‰¾åˆ°ç¡®å®šçš„keyåï¼Œå¯ä»¥ç›´æ¥èµ‹å€¼ã€‚ Dictionary è½¬ä¸ºJSONPythonä¸­çš„dictæ˜¯ä¸€ç§é”®å€¼å¯¹çš„æ•°æ®ç»“æ„ã€‚JSONæ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼Œå®ƒæ˜¯ä¸€ç§æ–‡æœ¬æ ¼å¼ã€‚å®ƒä»¬éƒ½æ˜¯ä»¥é”®å€¼å¯¹ä¸ºåŸºç¡€ã€‚é‚£ä¹ˆå®ƒä»¬åº”è¯¥èƒ½ç›¸äº’è½¬æ¢ã€‚ å°†dictè½¬ä¸ºJSONï¼Œè¿™é‡Œåˆ©ç”¨jsonåŒ…é‡Œæä¾›çš„dumpsæ–¹æ³•ã€‚ dumpsæ–¹æ³•å°†ä¼ å…¥çš„dictè½¬æ¢æˆJSONæ ¼å¼çš„æ–‡æœ¬ã€‚ å¼•å…¥jsonåŒ…1import json æˆ‘ä»¬å†™å‡ºäº†ç¬¬ä¸€ä¸ªdictè½¬JSONçš„æ–¹æ³•1234def to_json1(input_dict): print('input:', input_dict) jsonTxt = json.dumps(input_dict) print(jsonTxt) è¾“å‡ºï¼š12input: {'userInfo': {'firstName': 'Rust', 'lastName': 'Fisher'}, 'books': ['Pythonå…¥é—¨', 'Pythonè¿›é˜¶'], 'desc': 'å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªkey-valueè¿›å»'}{&quot;userInfo&quot;: {&quot;firstName&quot;: &quot;Rust&quot;, &quot;lastName&quot;: &quot;Fisher&quot;}, &quot;books&quot;: [&quot;Python\\u5165\\u95e8&quot;, &quot;Python\\u8fdb\\u9636&quot;], &quot;desc&quot;: &quot;\\u53ef\\u4ee5\\u76f4\\u63a5\\u6dfb\\u52a0\\u4e00\\u4e2akey-value\\u8fdb\\u53bb&quot;} ä¸­æ–‡å­—ç¬¦éƒ½å˜æˆäº†å­—æ¯å’Œæ•°å­—ç¬¦å·ã€‚è¿™æœ‰ç‚¹å‡ºä¹æˆ‘ä»¬æ„æ–™ã€‚ æ¶‰åŠåˆ°ä¸­æ–‡å­—ç¬¦çš„æ—¶å€™ï¼Œéœ€è¦dumpsæ–¹æ³•é‡ŒæŒ‡å®šensure_ascii=False 1234def to_json2(input_dict): print('input:', input_dict) jsonTxt = json.dumps(input_dict, ensure_ascii=False) print(jsonTxt) è¾“å‡º:12input: {'userInfo': {'firstName': 'Rust', 'lastName': 'Fisher'}, 'books': ['Pythonå…¥é—¨', 'Pythonè¿›é˜¶'], 'desc': 'å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªkey-valueè¿›å»'}{&quot;userInfo&quot;: {&quot;firstName&quot;: &quot;Rust&quot;, &quot;lastName&quot;: &quot;Fisher&quot;}, &quot;books&quot;: [&quot;Pythonå…¥é—¨&quot;, &quot;Pythonè¿›é˜¶&quot;], &quot;desc&quot;: &quot;å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªkey-valueè¿›å»&quot;}è¿™æ ·ä¸­æ–‡å­—ç¬¦å°±okäº†ã€‚ listè½¬ä¸ºJSONlistä¸­å­˜å‚¨ç€å¤šä¸ªdictã€‚å¯ä»¥ç›´æ¥æŠŠlistè½¬ä¸ºJSONã€‚ æ¥ä¸Šé¢çš„ä»£ç  1234567def list_json_demo(): tom_hanks = {'firstName': 'Tom', 'lastName': 'Hanks', 'movies': ['Cast Away']} info = use_dict() list = [tom_hanks, info] jsonTxt = json.dumps(list, ensure_ascii=False) print(jsonTxt) return jsonTxt è¾“å‡ºçš„JSONéƒ¨åˆ†ï¼š1[{&quot;firstName&quot;: &quot;Tom&quot;, &quot;lastName&quot;: &quot;Hanks&quot;, &quot;movies&quot;: [&quot;Cast Away&quot;]}, {&quot;userInfo&quot;: {&quot;firstName&quot;: &quot;Rust&quot;, &quot;lastName&quot;: &quot;Fisher&quot;}, &quot;books&quot;: [&quot;Pythonå…¥é—¨&quot;, &quot;Pythonè¿›é˜¶&quot;], &quot;desc&quot;: &quot;å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªkey-valueè¿›å»&quot;}] è¯»å–JSONæ–‡æœ¬ç”¨json.loadsæ–¹æ³•å°†è¾“å…¥çš„JSONæ–‡æœ¬è½¬ä¸ºå¯¹è±¡ã€‚ 123def json_to_dict1(jsonTxt): obj1 = json.loads(jsonTxt) print(obj1) å¾—åˆ°çš„å¯¹è±¡å¯èƒ½æ˜¯æ•°ç»„æˆ–è€…æ˜¯dictã€‚ è¯»å–JSONæ–‡ä»¶å…ˆæ‰“å¼€æ–‡ä»¶ï¼Œç”¨json.loadæ–¹æ³•ï¼Œè¯»å–JSONå†…å®¹123with open(json_file_path) as json_file: json_content = json.load(json_file) # è¯»å–å‡ºæ¥çš„æ˜¯dict # ...","link":"/2017/05/05/Python/Python-dictionary-JSON-file/"},{"title":"pip ç›¸å…³","text":"Ubuntu 14.04 pip ä½¿ç”¨å›½å†…é•œåƒæºä½¿ç”¨pip install çš„æ—¶å€™æ€»æ˜¯å‡ºç°read timeout ä¹‹ç±»çš„é”™è¯¯ ä½¿ç”¨å›½å†…é•œåƒ https://pypi.tuna.tsinghua.edu.cn/simpleä¾‹å¦‚æˆ‘è¦å®‰è£… scrapy1pip install -i https://pypi.tuna.tsinghua.edu.cn/simple scrapy æ·»åŠ æºçš„é…ç½® Linuxä¸‹ï¼Œä¿®æ”¹ ~/.pip/pip.conf (æ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ª)ï¼Œ ä¿®æ”¹ index-urlè‡³tunaï¼Œå†…å®¹å¦‚ä¸‹ï¼š12[global]index-url = https://pypi.tuna.tsinghua.edu.cn/simple windowsä¸‹ï¼Œç›´æ¥åœ¨userç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªpipç›®å½•ï¼Œå¦‚ï¼šC:\\Users\\xx\\pipï¼Œæ–°å»ºæ–‡ä»¶pip.iniï¼Œå†…å®¹å¦‚ä¸‹12[global]index-url = https://pypi.tuna.tsinghua.edu.cn/simple pip install å‡ºé”™1234567891011121314151617181920212223$ pip install pycairoCollecting pycairo Downloading https://files.pythonhosted.org/packages/e8/9d/c8be300fc6b1298559d37a071c3833b0b251e0fff334d2e4c408d5789162/pycairo-1.19.1.tar.gz (205kB) 100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 215kB 644kB/s Installing collected packages: pycairo Running setup.py install for pycairo ... error Complete output from command /Users/rustfisher/Desktop/intGo/studySR/venv/bin/python -u -c &quot;import setuptools, tokenize;__file__='/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-jhvl5plj/pycairo/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\\r\\n', '\\n');f.close();exec(compile(code, __file__, 'exec'))&quot; install --record /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-record-dqg8zbp0/install-record.txt --single-version-externally-managed --compile --install-headers /Users/rustfisher/Desktop/intGo/studySR/venv/include/site/python3.7/pycairo: running install running build running build_py creating build creating build/lib.macosx-10.9-x86_64-3.7 creating build/lib.macosx-10.9-x86_64-3.7/cairo copying cairo/__init__.py -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo copying cairo/__init__.pyi -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo copying cairo/py.typed -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo running build_ext [Errno 20] Not a directory: 'pkg-config' ----------------------------------------Command &quot;/Users/rustfisher/Desktop/intGo/studySR/venv/bin/python -u -c &quot;import setuptools, tokenize;__file__='/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-jhvl5plj/pycairo/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\\r\\n', '\\n');f.close();exec(compile(code, __file__, 'exec'))&quot; install --record /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-record-dqg8zbp0/install-record.txt --single-version-externally-managed --compile --install-headers /Users/rustfisher/Desktop/intGo/studySR/venv/include/site/python3.7/pycairo&quot; failed with error code 1 in /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-jhvl5plj/pycairo/You are using pip version 10.0.1, however version 20.2.2 is available.You should consider upgrading via the 'pip install --upgrade pip' command. ç”¨brewå®‰è£…pkg-config12345 $ brew install pkg-config==&gt; Downloading https://mirrors.ustc.edu.cn/homebrew-bottles/bottles/pkg-config-0.29.2_3.mojave.bottle.tar.g######################################################################## 100.0%==&gt; Pouring pkg-config-0.29.2_3.mojave.bottle.tar.gzğŸº /usr/local/Cellar/pkg-config/0.29.2_3: 11 files, 623.6KB ç„¶åå†è¿è¡Œpip install pycairoã€‚å‡ºç°é”™è¯¯ Collecting pycairo Using cached pycairo-1.19.1.tar.gz (205 kB)Using legacy setup.py install for pycairo, since package â€˜wheelâ€™ is not installed.Installing collected packages: pycairo Running setup.py install for pycairo â€¦ error ERROR: Command errored out with exit status 1: command: /Library/Frameworks/Python.framework/Versions/3.7/bin/python3.7 -u -c â€˜import sys, setuptools, tokenize; sys.argv[0] = â€˜â€œâ€˜â€œâ€˜/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-_fvz20yx/pycairo/setup.pyâ€™â€â€˜â€œâ€˜; file=â€™â€â€˜â€œâ€˜/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-_fvz20yx/pycairo/setup.pyâ€™â€â€˜â€œâ€˜;f=getattr(tokenize, â€˜â€œâ€˜â€œâ€˜openâ€™â€â€˜â€œâ€˜, open)(file);code=f.read().replace(â€˜â€œâ€˜â€œâ€˜\\r\\nâ€™â€â€˜â€œâ€˜, â€˜â€œâ€˜â€œâ€˜\\nâ€™â€â€˜â€œâ€˜);f.close();exec(compile(code, file, â€˜â€œâ€˜â€œâ€˜execâ€™â€â€˜â€œâ€˜))â€™ install â€“record /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-record-0xkj4in4/install-record.txt â€“single-version-externally-managed â€“compile â€“install-headers /Library/Frameworks/Python.framework/Versions/3.7/include/python3.7m/pycairo cwd: /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-_fvz20yx/pycairo/ Complete output (15 lines): running install running build running build_py creating build creating build/lib.macosx-10.9-x86_64-3.7 creating build/lib.macosx-10.9-x86_64-3.7/cairo copying cairo/init.py -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo copying cairo/init.pyi -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo copying cairo/py.typed -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo running build_ext Package cairo was not found in the pkg-config search path. Perhaps you should add the directory containing `cairo.pcâ€™ to the PKG_CONFIG_PATH environment variable No package â€˜cairoâ€™ found Command &apos;[&apos;pkg-config&apos;, &apos;--print-errors&apos;, &apos;--exists&apos;, &apos;cairo &gt;= 1.13.1&apos;]&apos; returned non-zero exit status 1. ---------------------------------------- ERROR: Command errored out with exit status 1: /Library/Frameworks/Python.framework/Versions/3.7/bin/python3.7 -u -c â€˜import sys, setuptools, tokenize; sys.argv[0] = â€˜â€œâ€˜â€œâ€˜/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-_fvz20yx/pycairo/setup.pyâ€™â€â€˜â€œâ€˜; file=â€™â€â€˜â€œâ€˜/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-_fvz20yx/pycairo/setup.pyâ€™â€â€˜â€œâ€˜;f=getattr(tokenize, â€˜â€œâ€˜â€œâ€˜openâ€™â€â€˜â€œâ€˜, open)(file);code=f.read().replace(â€˜â€œâ€˜â€œâ€˜\\r\\nâ€™â€â€˜â€œâ€˜, â€˜â€œâ€˜â€œâ€˜\\nâ€™â€â€˜â€œâ€˜);f.close();exec(compile(code, file, â€˜â€œâ€˜â€œâ€˜execâ€™â€â€˜â€œâ€˜))â€™ install â€“record /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-record-0xkj4in4/install-record.txt â€“single-version-externally-managed â€“compile â€“install-headers /Library/Frameworks/Python.framework/Versions/3.7/include/python3.7m/pycairo Check the logs for full command output. æ‰§è¡Œbrew install cairo pkg-config freetype harfbuzzï¼ŒæŠŠè¿™å‡ ä¸ªåŒ…å®‰è£…ä¸€ä¸‹ã€‚ç„¶åå†pip install pycairoï¼Œå®‰è£…æˆåŠŸã€‚","link":"/2017/04/29/Python/Python-pip-solution/"},{"title":"é€‚é…å™¨æ¨¡å¼ Adapter Pattern - Javaå®ç°","text":"å®šä¹‰å°†ä¸€ä¸ªç±»çš„æ¥å£å˜æ¢æˆå®¢æˆ·ç«¯é”æœŸå¾…çš„å¦ä¸€ç§æ¥å£ï¼Œä»è€Œä½¿åŸæœ¬å› æ¥å£ä¸åŒ¹é…è€Œæ— æ³•å·¥ä½œåœ¨ä¸€èµ·çš„ä¸¤ä¸ªç±»èƒ½å¤Ÿåœ¨ä¸€èµ·å·¥ä½œã€‚ä¹Ÿå«ä½œå˜å‹å™¨æ¨¡å¼ï¼Œäº¦ç§°åŒ…è£…æ¨¡å¼ï¼Œä½†åŒ…è£…æ¨¡å¼ä¸æ­¢ä¸€ä¸ªã€‚ç®€å•è€Œè¨€ï¼Œé€‚é…å™¨æ¨¡å¼å°±æ˜¯æŠŠä¸€ä¸ªæ¥å£æˆ–ç±»è½¬æ¢æˆå…¶ä»–çš„æ¥å£æˆ–ç±»ã€‚ åº”ç”¨ä¼˜ç‚¹ï¼š å¯ä»¥è®©æ²¡æœ‰ä»»ä½•å…³ç³»çš„ç±»åœ¨ä¸€èµ·è¿è¡Œ å¢åŠ äº†ç±»çš„é€æ˜æ€§ æé«˜äº†ç±»çš„å¤ç”¨åº¦ çµæ´»åº¦å¥½ æ³¨æ„äº‹é¡¹ï¼šåœ¨è¯¦ç»†é˜¶æ®µä¸è¦è€ƒè™‘é€‚é…å™¨æ¨¡å¼ï¼Œå®ƒä¸»è¦æ˜¯ç”¨æ¥è§£å†³æ­£åœ¨æœå½¹çš„é¡¹ç›®é—®é¢˜ ä»£ç ç¤ºä¾‹å‘å·²è¿è¡Œçš„ç³»ç»Ÿæ·»åŠ æ–°å¢çš„ç”¨æˆ·ç±»å‹æ–‡ä»¶ç›®å½•å¦‚ä¸‹123456789101112adapter/â”œâ”€â”€ sadapter // æ–°å¢çš„é€‚é…å™¨ä»£ç â”‚ â”œâ”€â”€ SecondUserAdapter.javaâ”‚ â”œâ”€â”€ SecondUserAddress.javaâ”‚ â””â”€â”€ SecondUser.javaâ”œâ”€â”€ stable // å·²ç»åœ¨è¿è¡Œçš„ä»£ç ï¼Œä¸å¯å˜â”‚ â”œâ”€â”€ FirstUser.javaâ”‚ â””â”€â”€ IFirstUser.javaâ”œâ”€â”€ TestAdapter.java // æµ‹è¯•ä»£ç â””â”€â”€ updated // ç¬¬ä¸‰æ–¹æä¾›çš„æ¥å£ï¼Œä¸å¯å˜ â”œâ”€â”€ ISecondUserAddress.java â””â”€â”€ ISecondUser.java é¦–å…ˆçœ‹å·²ç»åœ¨è¿è¡Œçš„éƒ¨åˆ† ï¼ˆstableï¼‰12345678910111213141516public interface IFirstUser { void printInfo();}public class FirstUser implements IFirstUser { private String username; public FirstUser(String username) { this.username = username; } @Override public void printInfo() { System.out.println(this.username); }} å†çœ‹æŒ‰éœ€æ±‚æ·»åŠ çš„éƒ¨åˆ† ï¼ˆupdatedï¼‰123456public interface ISecondUser { void printUsername();}public interface ISecondUserAddress { void printAddress();} ä¸ºæ­¤æ–°å»ºçš„é€‚é…å™¨ ï¼ˆsadapterï¼‰åˆ†åˆ«æ–°å»º2ä¸ªç±»æ¥å®ç°æ¥å£123456789101112131415161718192021222324252627public class SecondUser implements ISecondUser { private String username; public SecondUser(String name) { this.username = name; } @Override public void printUsername() { System.out.print(username + &quot; &quot;); }}public class SecondUserAddress implements ISecondUserAddress { private String addr; public SecondUserAddress(String address) { this.addr = address; } @Override public void printAddress() { System.out.print(this.addr); }} é€‚é…å™¨æŒæœ‰è¿™ä¸¤ä¸ªæ¥å£çš„å¼•ç”¨ï¼Œå¹¶å®ç°åŸæœ‰çš„æ¥å£12345678910111213141516public class SecondUserAdapter implements IFirstUser { private ISecondUser iSecondUser; private ISecondUserAddress iSecondUserAddress; public SecondUserAdapter(ISecondUser iSecondUser, ISecondUserAddress iSecondUserAddress) { this.iSecondUser = iSecondUser; this.iSecondUserAddress = iSecondUserAddress; } @Override public void printInfo() { iSecondUser.printUsername(); iSecondUserAddress.printAddress(); }} é€‚é…å™¨æ„å»ºå®Œæ¯•ï¼Œæµ‹è¯•ä»£ç 12345IFirstUser user1 = new FirstUser(&quot;User1&quot;);user1.printInfo();SecondUserAdapter userAdapter = new SecondUserAdapter(new SecondUser(&quot;SUser2&quot;),new SecondUserAddress(&quot;5 street&quot;));userAdapter.printInfo();output12User1SUser2 5 streetæœ€å¸å¼•äººçš„åœ°æ–¹å°±æ˜¯é€‚é…å™¨å®ç°äº†åŸæœ‰çš„æ¥å£ã€‚éœ€æ±‚å˜åŒ–æ—¶ï¼Œå¯å°½é‡å°‘çš„æ”¹åŠ¨å·²æœ‰ä»£ç ã€‚ å‚è€ƒï¼šã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¦…ã€‹ ç§¦å°æ³¢","link":"/2017/03/26/DesignPattern/Adapter-Pattern/"},{"title":"Android NDK è¯»å†™æ–‡ä»¶","text":"å¼€å‘ç¯å¢ƒä¸å·¥å…·ï¼š win7_x64ï¼ŒAndroid Studio 2.2.3, Cygwin ä½¿ç”¨NDKï¼Œå°±è¿›å…¥äº†Linuxçš„ä¸–ç•Œã€‚ç†è§£äº†è¿™ä¸€ç‚¹ï¼Œå¾ˆå¤šäº‹æƒ…å°±å¥½åŠäº†ã€‚éœ€è¦ç†Ÿæ‚‰Cè¯­è¨€æ“ä½œæ–‡ä»¶çš„æ–¹å¼ã€‚ å‡†å¤‡äº‹é¡¹ç”³è¯·æƒé™ç”³è¯·SDå¡çš„è¯»å†™æƒé™12&lt;uses-permission android:name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; /&gt;&lt;uses-permission android:name=&quot;android.permission.READ_EXTERNAL_STORAGE&quot; /&gt; 6.0å¼€å§‹éœ€è¦åŠ¨æ€ç”³è¯·æƒé™ã€‚ ä½¿ç”¨Linuxä¸­çš„æ–‡ä»¶ç»å¯¹è·¯å¾„æ‰‹æœºsdå¡ä¸­å­˜æ”¾ç€æ–‡ä»¶ã€‚ç›®å½•ä¸º /sdcard/hello.txtå’Œ/sdcard/egdir/csv/eg_data.csvã€‚ è¯»å†™ç¤ºä¾‹æ–‡ä»¶ç›®å½•1234jni/|-- Android.mk|-- com_rustfisher_ndkalgo_RWFile.h`-- RWFile.c Javaæ–‡ä»¶RWFile.java é‡Œé¢å†™äº†å¤šä¸ªnativeæ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627public class RWFile { static { System.loadLibrary(&quot;NDKMan&quot;); } public String readIn() { return nativeRead(); } public String writeToFile(String msg) { return nativeWrite(msg); } public String readSDFile(String fileName) { return nativeReadSDFile(fileName); } private native String nativeRead(); /** * @param fileName e.g. FolderName/textFile.txt */ private native String nativeReadSDFile(String fileName); private native String nativeWrite(String msg);} RWFile.cç¼–è¯‘å‡º.hæ–‡ä»¶åï¼Œé‡Œé¢çš„æ–¹æ³•åã€‚å¯ä»¥çœ‹å‡ºç¼–è¯‘åçš„æ–¹æ³•åå’ŒåŸæ¥çš„nativeæ–¹æ³•æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚1234void join(char *s1, char *s2,char *result) // æ‹¼æ¥charçš„å‡½æ•°Java_com_rustfisher_ndkalgo_RWFile_nativeRead // è¯»å–å›ºå®šæ–‡ä»¶çš„å†…å®¹Java_com_rustfisher_ndkalgo_RWFile_nativeReadSDFile // æ ¹æ®æ–‡ä»¶åè¯»å–æ–‡ä»¶å†…å®¹Java_com_rustfisher_ndkalgo_RWFile_nativeWrite // å°†å†…å®¹å†™å…¥æ–‡ä»¶ Cæ–‡ä»¶Cæ–‡ä»¶æ˜¯æˆ‘ä»¬å…·ä½“å®ç°åŠŸèƒ½çš„åœ°æ–¹ã€‚RWFile.cä»£ç å¦‚ä¸‹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &quot;com_rustfisher_ndkalgo_RWFile.h&quot;const char *sdcardDir = &quot;/sdcard/&quot;;void join(char *s1, char *s2,char *result) { result = (char *) malloc(strlen(s1)+strlen(s2)+1);// +1 for the zero-terminator if (result == NULL) { return; } strcpy(result, s1); strcat(result, s2);}JNIEXPORT jstring JNICALL Java_com_rustfisher_ndkalgo_RWFile_nativeRead(JNIEnv *env, jobject jObj) { FILE* file = fopen(&quot;/sdcard/hello.txt&quot;,&quot;r+&quot;); char myStr[128]; if (file != NULL) { char* readInPtr = fgets(myStr, 128, file); fclose(file); if (NULL != readInPtr) { return (*env)-&gt;NewStringUTF(env, myStr); } return (*env)-&gt;NewStringUTF(env, &quot;JNI read file fail!&quot;); } return (*env)-&gt;NewStringUTF(env, &quot;JNI read file fail!&quot;);}JNIEXPORT jstring JNICALL Java_com_rustfisher_ndkalgo_RWFile_nativeReadSDFile(JNIEnv *env, jobject jObj, jstring fileName) { char *fileNamePtr = (*env)-&gt;GetStringUTFChars(env, fileName, 0); char * result; join(sdcardDir,fileNamePtr,result); FILE* file = fopen(result,&quot;r+&quot;); if (file != NULL) { char myStr[128]; char* readInPtr = fgets(myStr, 128, file); fclose(file); if (NULL != readInPtr) { return (*env)-&gt;NewStringUTF(env, myStr); } return (*env)-&gt;NewStringUTF(env, &quot;JNI read fail - NULL == readInPtr&quot;); } return (*env)-&gt;NewStringUTF(env, &quot;JNI read file fail! - file is NULL &quot;);}JNIEXPORT jstring JNICALL Java_com_rustfisher_ndkalgo_RWFile_nativeWrite(JNIEnv *env, jobject jObj, jstring msg) { FILE* file = fopen(&quot;/sdcard/hello.txt&quot;,&quot;w+&quot;); const char *nativeMsg = (*env)-&gt;GetStringUTFChars(env, msg, 0); if (file != NULL) { fputs(nativeMsg, file); fflush(file); fclose(file); } return (*env)-&gt;NewStringUTF(env, &quot;Write finished.&quot;);} éœ€å…³æ³¨çš„å‡½æ•°è¦ç‰¹åˆ«å…³å¿ƒå‡½æ•°çš„è¿”å›å€¼ï¼Œè¿”å›å€¼å¾€å¾€ä»£è¡¨ç€è°ƒç”¨çš„ç»“æœã€‚ æ‰“å¼€æ–‡ä»¶ fopenFILE * fopen(const char * path,const char * mode);modeæ¨¡å¼é€‰æ‹©ï¼Œä¾‹å¦‚&quot;r&quot; r(read): è¯» w(write): å†™ a(append): è¿½åŠ  t(text): æ–‡æœ¬æ–‡ä»¶ï¼Œå¯çœç•¥ä¸å†™ b(banary): äºŒè¿›åˆ¶æ–‡ä»¶ +: è¯»å’Œå†™ å‡¡ç”¨â€œrâ€æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œè¯¥æ–‡ä»¶å¿…é¡»å·²ç»å­˜åœ¨ï¼Œä¸”åªèƒ½ä»è¯¥æ–‡ä»¶è¯»å‡ºã€‚ ç”¨â€œwâ€æ‰“å¼€çš„æ–‡ä»¶åªèƒ½å‘è¯¥æ–‡ä»¶å†™å…¥ã€‚è‹¥æ‰“å¼€çš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä»¥æŒ‡å®šçš„æ–‡ä»¶åå»ºç«‹è¯¥æ–‡ä»¶ï¼Œè‹¥æ‰“å¼€çš„æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™å°†è¯¥æ–‡ä»¶åˆ å»ï¼Œé‡å»ºä¸€ä¸ªæ–°æ–‡ä»¶ã€‚è¿™ä¸ªæ–¹æ³•ä¿è¯ç›®æ ‡æ–‡ä»¶é‡Œå†™å…¥çš„åªæœ‰æˆ‘ä»¬è¦çš„æ•°æ®ã€‚ è‹¥è¦å‘ä¸€ä¸ªå·²å­˜åœ¨çš„æ–‡ä»¶è¿½åŠ æ–°çš„ä¿¡æ¯ï¼Œåªèƒ½ç”¨â€œaâ€æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚ä½†æ­¤æ—¶è¯¥æ–‡ä»¶å¿…é¡»æ˜¯å­˜åœ¨çš„ï¼Œå¦åˆ™å°†ä¼šå‡ºé”™ã€‚ åœ¨æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå¦‚æœå‡ºé”™ï¼Œfopenå°†è¿”å›ä¸€ä¸ªç©ºæŒ‡é’ˆå€¼NULLã€‚åœ¨ç¨‹åºä¸­å¯ä»¥ç”¨è¿™ä¸€ä¿¡æ¯æ¥åˆ¤åˆ«æ˜¯å¦å®Œæˆæ‰“å¼€æ–‡ä»¶çš„å·¥ä½œï¼Œå¹¶ä½œç›¸åº”çš„å¤„ç†ã€‚ å¦‚æœæˆåŠŸçš„æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶, fopen()å‡½æ•°è¿”å›æ–‡ä»¶æŒ‡é’ˆ, å¦åˆ™è¿”å›ç©ºæŒ‡é’ˆ ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ® fgetschar *fgets(char *s, int n, FILE *stream);ä»æ–‡ä»¶æŒ‡é’ˆstreamä¸­è¯»å–n-1ä¸ªå­—ç¬¦ï¼Œå­˜åˆ°ä»¥sä¸ºèµ·å§‹åœ°å€çš„ç©ºé—´é‡Œï¼Œç›´åˆ°è¯»å®Œä¸€è¡Œï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›sçš„æŒ‡é’ˆï¼Œå¦åˆ™è¿”å›NULLã€‚ NDKä¸­ç”Ÿæˆjstringçš„å‡½æ•° (*env)-&gt;NewStringUTF(env, char *);(*env)-&gt;NewStringUTF(env, char *);å¦‚æœä¼ å…¥çš„char*æ˜¯ä¸€ä¸ªç©ºå€¼ï¼Œåœ¨ä¸€äº›å¹³å°ä¸Šä¼šæŠ¥é”™ã€‚æ¯”å¦‚çº¢ç±³æ‰‹æœºä¼šç›´æ¥å´©æºƒï¼Œè€Œé­…æ—æ‰‹æœºèƒ½å¾—åˆ°ä¸€ä¸ªç©ºçš„Stringã€‚","link":"/2017/03/16/Android/NDK-read_write_file/"},{"title":"MySQL å¢åˆ æŸ¥æ”¹","text":"ç¯å¢ƒï¼š win7_x64ï¼Œ Navicat for MySQL æœ¬æ–‡é“¾æ¥ æ“ä½œæ•°æ®åº“å‰é¢å·²ç»å°†MySQLæœåŠ¡è·‘èµ·æ¥äº†ã€‚ Macå®‰è£…MySQL Windowså®‰è£…MySQL ç°åœ¨æˆ‘ä»¬ä»¥rootèº«ä»½è¿›è¡ŒMySQLæ“ä½œè¿›å…¥MySQL1C:\\Users\\Administrator&gt;mysql -uroot -p æ–°å»ºæ•°æ®åº“12mysql&gt; create database samp_db1 character set gbk;Query OK, 1 row affected (0.00 sec) æ•°æ®åº“å­—ç¬¦ç¼–ç æŒ‡å®šä¸º gbk é€‰æ‹©è¦æ“ä½œçš„æ•°æ®åº“å·²ç»ç™»å½•åå¯ä»¥ç›´æ¥é€‰æ‹©æ•°æ®åº“ 12mysql&gt; use samp_db1;Database changed åˆ›å»ºæ•°æ®è¡¨ä»¥å»ºç«‹person_tæ•°æ®è¡¨ä¸ºä¾‹12345678mysql&gt; create table person_t ( -&gt; id int unsigned not null auto_increment primary key, -&gt; name char(14) not null, -&gt; sex char(4) not null, -&gt; age tinyint unsigned not null, -&gt; tell char(13) null default &quot;-&quot; -&gt; );Query OK, 0 rows affected (0.22 sec)æ‰“å¼€Navicat for MySQLï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ–°å»ºçš„è¡¨ è¾“å…¥è¿™ä¹ˆé•¿çš„æ–‡æœ¬å¾ˆå®¹æ˜“å‡ºé”™ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å…ˆå†™å¥½SQLè¯­å¥ï¼Œå†å¯¼è¿›æ¥ æ–°å»ºæ–‡ä»¶create_student_table.sqlï¼Œè¾“å…¥SQLè¯­å¥ 1234567create table student (id int unsigned not null auto_increment primary key,name char(14) not null,sex char(4) not null,age tinyint unsigned not null,tell char(13) null default &quot;-&quot;); ç›´æ¥æ‰§è¡ŒSQLæ–‡ä»¶ï¼Œæ“ä½œsamp_db1æ•°æ®åº“123C:\\Users\\Administrator&gt;mysql -D samp_db1 -u root -p &lt; H:\\create_student_table.sqlEnter password: **** æ“ä½œæ•°æ®åº“é€‰å®šè¦æ“ä½œçš„æ•°æ®åº“use samp_db1; å¢ - æ’å…¥æ•°æ®insert [into] è¡¨å [(åˆ—å1, åˆ—å2, åˆ—å3, â€¦)] values (å€¼1, å€¼2, å€¼3, â€¦); 12mysql&gt; insert into student values(null,&quot;å¼ ä¸‰&quot;,&quot;ç”·&quot;,23,&quot;13666665555&quot;);mysql&gt; insert into student (name,sex,age) values(&quot;æå››&quot;,&quot;å¥³&quot;,20); æŸ¥ - æŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®select åˆ—åç§° from è¡¨åç§° [æŸ¥è¯¢æ¡ä»¶]; å¤šæ’å…¥äº†ä¸€äº›æ•°æ®å 1234567891011mysql&gt; select name, age from student;+-------+-----+| name | age |+-------+-----+| å¼ ä¸‰ | 23 || æå›› | 20 || Tom | 13 || Jerry | 12 || ç‹äº” | 32 |+-------+-----+5 rows in set (0.00 sec) ä½¿ç”¨é€šé…ç¬¦*æ¥æŸ¥è¯¢1234567891011mysql&gt; select * from student;+----+-------+-----+-----+-------------+| id | name | sex | age | tell |+----+-------+-----+-----+-------------+| 1 | å¼ ä¸‰ | ç”· | 23 | 13666665555 || 2 | æå›› | å¥³ | 20 | - || 3 | Tom | ç”· | 13 | 13111115555 || 4 | Jerry | ç”· | 12 | 2333333 || 5 | ç‹äº” | ç”· | 32 | 666666666 |+----+-------+-----+-----+-------------+5 rows in set (0.00 sec) ç‰¹å®šæ¡ä»¶æŸ¥è¯¢where å…³é”®è¯ç”¨äºæŒ‡å®šæŸ¥è¯¢æ¡ä»¶, ç”¨æ³•å½¢å¼ä¸º: select åˆ—åç§° from è¡¨åç§° where æ¡ä»¶; 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374// æŸ¥è¯¢æ‰€æœ‰æ€§åˆ«ä¸ºå¥³çš„è®°å½•mysql&gt; select * from student where sex=&quot;å¥³&quot;;+----+------+-----+-----+------+| id | name | sex | age | tell |+----+------+-----+-----+------+| 2 | æå›› | å¥³ | 20 | - |+----+------+-----+-----+------+1 row in set (0.04 sec)// ageå¤§äº20çš„è®°å½•mysql&gt; select * from student where age&gt;20;+----+------+-----+-----+-------------+| id | name | sex | age | tell |+----+------+-----+-----+-------------+| 1 | å¼ ä¸‰ | ç”· | 23 | 13666665555 || 5 | ç‹äº” | ç”· | 32 | 666666666 |+----+------+-----+-----+-------------+2 rows in set (0.00 sec)// ageå°äºç­‰äº20çš„è®°å½•mysql&gt; select * from student where age&lt;=20;+----+-------+-----+-----+-------------+| id | name | sex | age | tell |+----+-------+-----+-----+-------------+| 2 | æå›› | å¥³ | 20 | - || 3 | Tom | ç”· | 13 | 13111115555 || 4 | Jerry | ç”· | 12 | 2333333 |+----+-------+-----+-----+-------------+3 rows in set (0.00 sec)// ageå°äºç­‰äº20å¹¶ä¸”idå¤§äºç­‰äº3çš„è®°å½•mysql&gt; select * from student where age&lt;=20 and id &gt;=3;+----+-------+-----+-----+-------------+| id | name | sex | age | tell |+----+-------+-----+-----+-------------+| 3 | Tom | ç”· | 13 | 13111115555 || 4 | Jerry | ç”· | 12 | 2333333 |+----+-------+-----+-----+-------------+2 rows in set (0.03 sec)// æŒ‰åå­—ç‰¹å¾æŸ¥è¯¢mysql&gt; select * from student where name like &quot;%ä¸‰%&quot;;+----+------+-----+-----+-------------+| id | name | sex | age | tell |+----+------+-----+-----+-------------+| 1 | å¼ ä¸‰ | ç”· | 23 | 13666665555 |+----+------+-----+-----+-------------+1 row in set (0.00 sec)mysql&gt; select * from student where name like &quot;%o%&quot;;+----+------+-----+-----+-------------+| id | name | sex | age | tell |+----+------+-----+-----+-------------+| 3 | Tom | ç”· | 13 | 13111115555 |+----+------+-----+-----+-------------+1 row in set (0.00 sec)// tell ä»¥5ç»“å°¾çš„è®°å½•mysql&gt; select * from student where tell like &quot;%5&quot;;+----+------+-----+-----+-------------+| id | name | sex | age | tell |+----+------+-----+-----+-------------+| 1 | å¼ ä¸‰ | ç”· | 23 | 13666665555 || 3 | Tom | ç”· | 13 | 13111115555 |+----+------+-----+-----+-------------+2 rows in set (0.00 sec)mysql&gt; select * from student where tell like &quot;131%&quot;;+----+------+-----+-----+-------------+| id | name | sex | age | tell |+----+------+-----+-----+-------------+| 3 | Tom | ç”· | 13 | 13111115555 |+----+------+-----+-----+-------------+1 row in set (0.00 sec) æŒ‰æ¡ä»¶æŸ¥è¯¢éå¸¸çš„çµæ´»ï¼Œè¿ç”¨å¾—å½“ä¼šèŠ‚çœè¿è¡Œæ—¶é—´ æ”¹ - ä¿®æ”¹è¡¨ä¸­çš„æ•°æ®åŸºæœ¬çš„ä½¿ç”¨å½¢å¼ä¸º: update è¡¨åç§° set åˆ—åç§°=æ–°å€¼ where æ›´æ–°æ¡ä»¶; æˆ‘ä»¬ç»ˆäºæ‹¿åˆ°äº†æå››çš„è”ç³»æ–¹å¼ï¼Œå°†æ•°æ®åº“ä¸­çš„tellæ›´æ–° 1234567891011mysql&gt; update student set tell=&quot;13900001111&quot; where name=&quot;æå››&quot;;Query OK, 1 row affected (0.05 sec)Rows matched: 1 Changed: 1 Warnings: 0mysql&gt; select * from student where name=&quot;æå››&quot;;+----+------+-----+-----+-------------+| id | name | sex | age | tell |+----+------+-----+-----+-------------+| 2 | æå›› | å¥³ | 20 | 13900001111 |+----+------+-----+-----+-------------+1 row in set (0.00 sec) è¿‡äº†ä¸€å¹´ï¼Œå¤§å®¶éƒ½é•¿äº†ä¸€å²ï¼Œä¿®æ”¹è¡¨ä¸­çš„ageå€¼ 123456789101112131415mysql&gt; update student set age=age+1;Query OK, 5 rows affected (0.05 sec)Rows matched: 5 Changed: 5 Warnings: 0mysql&gt; select * from student;+----+-------+-----+-----+-------------+| id | name | sex | age | tell |+----+-------+-----+-----+-------------+| 1 | å¼ ä¸‰ | ç”· | 24 | 13666665555 || 2 | æå›› | å¥³ | 21 | 13900001111 || 3 | Tom | ç”· | 14 | 13111115555 || 4 | Jerry | ç”· | 13 | 2333333 || 5 | ç‹äº” | ç”· | 33 | 666666666 |+----+-------+-----+-----+-------------+5 rows in set (0.00 sec) ä¿®æ”¹å¤šä¸ªä¿¡æ¯ï¼ŒJerryæœ‰äº†ä¸­æ–‡åâ€œèµµå…­â€ï¼Œæ¢äº†tell 123456789101112131415mysql&gt; update student set name=&quot;èµµå…­&quot;,tell=&quot;10001-1001&quot; where name=&quot;Jerry&quot;;Query OK, 1 row affected (0.05 sec)Rows matched: 1 Changed: 1 Warnings: 0mysql&gt; select * from student;+----+------+-----+-----+-------------+| id | name | sex | age | tell |+----+------+-----+-----+-------------+| 1 | å¼ ä¸‰ | ç”· | 24 | 13666665555 || 2 | æå›› | å¥³ | 21 | 13900001111 || 3 | Tom | ç”· | 14 | 13111115555 || 4 | èµµå…­ | ç”· | 13 | 10001-1001 || 5 | ç‹äº” | ç”· | 33 | 666666666 |+----+------+-----+-----+-------------+5 rows in set (0.00 sec) åˆ  - åˆ é™¤è¡¨ä¸­çš„æ•°æ®åŸºæœ¬ç”¨æ³•ä¸º: delete from è¡¨åç§° where åˆ é™¤æ¡ä»¶; å¹´é¾„å¤ªå°ä¸èƒ½å…¥å­¦ 123456789101112mysql&gt; delete from student where age &lt; 18;Query OK, 2 rows affected (0.04 sec)mysql&gt; select * from student;+----+------+-----+-----+-------------+| id | name | sex | age | tell |+----+------+-----+-----+-------------+| 1 | å¼ ä¸‰ | ç”· | 24 | 13666665555 || 2 | æå›› | å¥³ | 21 | 13900001111 || 5 | ç‹äº” | ç”· | 33 | 666666666 |+----+------+-----+-----+-------------+3 rows in set (0.00 sec) ä¿®æ”¹ç°æœ‰çš„è¡¨alter table è¯­å¥ç”¨äºä¿®æ”¹ç°æœ‰è¡¨ æ·»åŠ åˆ—alter table è¡¨å add åˆ—å åˆ—æ•°æ®ç±»å‹ [after æ’å…¥ä½ç½®]; åœ¨è¡¨çš„æœ€åæ·»åŠ addressåˆ—mysql&gt; alter table student add address char(70); åœ¨åä¸º age çš„åˆ—åæ’å…¥åˆ— birthdaymysql&gt; alter table student add birthday date after age; æ­¤æ—¶çš„è¡¨12345678mysql&gt; select * from student;+----+------+-----+-----+----------+-------------+---------+| id | name | sex | age | birthday | tell | address |+----+------+-----+-----+----------+-------------+---------+| 1 | å¼ ä¸‰ | ç”· | 24 | NULL | 13666665555 | NULL || 2 | æå›› | å¥³ | 21 | NULL | 13900001111 | NULL || 5 | ç‹äº” | ç”· | 33 | NULL | 666666666 | NULL |+----+------+-----+-----+----------+-------------+---------+ åˆ—çš„åå­—ä¸èƒ½æ˜¯mysqlçš„å…³é”®å­—ï¼Œæ¯”å¦‚ä¸èƒ½æ˜¯index ä¿®æ”¹åˆ—åŸºæœ¬å½¢å¼: alter table è¡¨å change åˆ—åç§° åˆ—æ–°åç§° æ–°æ•°æ®ç±»å‹; å°†tellåˆ—åä¿®æ”¹ä¸ºmobilealter table student change tell mobile char(13) default &quot;-&quot;; ä¿®æ”¹nameåˆ—çš„ç±»å‹ä¸ºchar(11) not null 123mysql&gt; alter table student change name name char(11) not null;Query OK, 3 rows affected (0.54 sec)Records: 3 Duplicates: 0 Warnings: 0 åˆ é™¤åˆ—alter table è¡¨å drop åˆ—åç§°; åˆ é™¤addressåˆ— alter table student drop address; é‡å‘½åè¡¨alter table è¡¨å rename æ–°è¡¨å; é‡å‘½åè¡¨student -&gt; bigstu alter table student rename bigstu; åˆ é™¤æ•´å¼ è¡¨drop table è¡¨å;åˆ æ‰å‰é¢æˆ‘ä»¬åˆ›å»ºçš„person_t12mysql&gt; drop table person_t;Query OK, 0 rows affected (0.12 sec) åˆ é™¤æ•´ä¸ªæ•°æ®åº“drop database æ•°æ®åº“å; æ–°å»ºä¸€ä¸ªæ•°æ®åº“samp_4_deleteï¼Œå†åˆ é™¤å®ƒ12345mysql&gt; create database samp_4_delete;Query OK, 1 row affected (0.00 sec)mysql&gt; drop database samp_4_delete;Query OK, 0 rows affected (0.01 sec) å¤åˆ¶schemaæ²¡æœ‰ç‰¹å®šçš„å¤åˆ¶å‘½ä»¤ã€‚æ€è·¯æ˜¯æ–°å»ºä¸€ä¸ªç›®æ ‡schemaï¼Œç„¶åæŠŠåŸæ•°æ®åº“ä¸­çš„è¡¨å…¨éƒ¨å¤åˆ¶åˆ°æ–°å»ºçš„åº“ä¸­å»ã€‚ å‚è€ƒï¼š https://stackoverflow.com/questions/67093/how-do-i-quickly-rename-a-mysql-database-change-schema-name","link":"/2017/02/25/Database/MySQL-use_add_del_check_update/"},{"title":"MySQL Windows å®‰è£…ä¸ç®€å•é…ç½®","text":"è®°å½•ä¸€äº›æ“ä½œã€‚ win7_x64 ä¸‹å®‰è£…é…ç½®MySQLä¸‹è½½ä¸‹è½½äº†ç»¿è‰²å…å®‰è£…ç‰ˆæœ¬ï¼Œç›®å½•ä¸ºE:\\mysql-5.7.17-winx64 é…ç½®æ–°å»ºdataç›®å½• E:\\mysql-5.7.17-winx64\\data æŠŠE:\\mysql-5.7.17-winx64\\binæ·»åŠ åˆ°ç¯å¢ƒå˜é‡ é…ç½®æ–‡ä»¶my.iniæ–°å»ºé…ç½®æ–‡ä»¶my.iniæ”¾åœ¨E:\\mysql-5.7.17-winx64ï¼Œå†…å®¹å¦‚ä¸‹ï¼š12345[mysqld]basedir=E:/mysql-5.7.17-winx64datadir=E:/mysql-5.7.17-winx64/datatmpdir=E:/mysql-5.7.17-winx64/dataport = 3306 åˆå§‹åŒ–æ‰“å¼€CMDï¼Œè¿›å…¥ç›®å½•E:\\mysql-5.7.17-winx64\\bin&gt;ï¼Œæ‰§è¡Œåˆå§‹åŒ–å‘½ä»¤ï¼Œå¦‚ä¸‹ 1234E:\\mysql-5.7.17-winx64\\bin&gt;mysqld --initialize --user=mysql --console// *******2017-02-25T07:35:47.155727Z 1 [Note] A temporary password is generated for root@localhost: s/KKIaag+3iS è·å¾—äº†ä¸€ä¸ªéšæœºå¯†ç s/KKIaag+3iS æ‰“å¼€å¦ä¸€ä¸ªCMDï¼Œæ‰§è¡ŒC:\\Users\\Administrator&gt;mysqld --consoleï¼Œç›®çš„æ˜¯è®©MySQLè·‘èµ·æ¥ å›åˆ°åˆšæ‰çš„CMDï¼Œè¿˜åœ¨E:\\mysql-5.7.17-winx64\\bin&gt;ç™»å½•root mysql -uroot -p ï¼Œç”¨çš„æ˜¯ä¸Šé¢ç”Ÿæˆçš„å¯†ç  123456789101112131415E:\\mysql-5.7.17-winx64\\bin&gt;mysql -uroot -pEnter password: ************Welcome to the MySQL monitor. Commands end with ; or \\g.Your MySQL connection id is 3Server version: 5.7.17Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.mysql&gt; åœ¨MySQLçš„å‘½ä»¤è¡Œé‡Œä¿®æ”¹rootçš„å¯†ç ï¼Œè®°å¾—æ‰“åˆ†å· 12345mysql&gt; set password = password('youPwd');Query OK, 0 rows affected, 1 warning (0.00 sec)mysql&gt; exitBye é€€å‡ºç”¨æ–°å¯†ç é‡æ–°ç™»å½•ã€‚å¯ä»¥å‘ç°å¯†ç å·²ç»ä¿®æ”¹æˆåŠŸã€‚åœ¨è¿™æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¦ä¸€ä¸ªCMDä¸€ç›´åœ¨è¿è¡ŒMySQLã€‚ 122017-02-25T07:37:41.643275Z 0 [Note] mysqld: ready for connections.Version: '5.7.17' socket: '' port: 3306 MySQL Community Server (GPL) å¯åŠ¨ä¸åœæ­¢æœåŠ¡å¯åŠ¨æœåŠ¡æ€æ‰CMDé‡Œé¢çš„MySQLè¿›ç¨‹ã€‚å®‰è£…å¹¶å¼€å¯æœåŠ¡ã€‚ 1234567E:\\mysql-5.7.17-winx64\\bin&gt;mysqld install MySQL --defaults-file=&quot;E:\\mysql-5.7.17-winx64\\my.ini&quot;Service successfully installed.E:\\mysql-5.7.17-winx64\\bin&gt;net start mysqlMySQL æœåŠ¡æ­£åœ¨å¯åŠ¨ .MySQL æœåŠ¡å·²ç»å¯åŠ¨æˆåŠŸã€‚ åœæ­¢æœåŠ¡123C:\\Users\\Administrator&gt;net stop MySQLMySQL æœåŠ¡æ­£åœ¨åœæ­¢.MySQL æœåŠ¡å·²æˆåŠŸåœæ­¢ã€‚ æŸ¥çœ‹æ‰€æœ‰WindowsæœåŠ¡åœ¨CMDä¸­ä½¿ç”¨netå‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰æœåŠ¡ 12345678C:\\Users\\Administrator&gt;net startå·²ç»å¯åŠ¨ä»¥ä¸‹ Windows æœåŠ¡:// ****IPsec Policy AgentMySQLNetwork Connections// **** åˆ é™¤æœåŠ¡sc delete æœåŠ¡å 1234567C:\\Users\\Administrator&gt;sc delete mysql[SC] DeleteService æˆåŠŸC:\\Users\\Administrator&gt;net start mysqlæœåŠ¡åæ— æ•ˆã€‚è¯·é”®å…¥ NET HELPMSG 2185 ä»¥è·å¾—æ›´å¤šçš„å¸®åŠ©ã€‚ åˆ é™¤æœåŠ¡åï¼Œé‡æ–°åˆå§‹åŒ–å¹¶å»ºç«‹æœåŠ¡å‰é¢å·²ç»åˆ é™¤æœåŠ¡ï¼Œæ­¤æ—¶ç›´æ¥å»ºç«‹æœåŠ¡å¹¶å¯åŠ¨ä¼šæŠ¥é”™12345678C:\\Users\\Administrator&gt;mysqld install MySQL --defaults-file=&quot;E:\\mysql-5.7.17-winx64\\my.ini&quot;Service successfully installed.C:\\Users\\Administrator&gt;net start mysqlå‘ç”Ÿç³»ç»Ÿé”™è¯¯ 2ã€‚ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶ã€‚ æ­¤æ—¶è¦æŠŠmysqlè¿™ä¸ªæœåŠ¡åˆ é™¤sc delete mysql ç„¶åæŠŠdataç›®å½•å†…çš„æ–‡ä»¶å…¨éƒ¨åˆ é™¤ï¼Œå›åˆ°binç›®å½•é‡æ–°åˆå§‹åŒ–ä¸€æ¬¡ã€‚åˆè·å¾—äº†ä¸€ä¸ªéšæœºå¯†ç ã€‚å†æ–°å»ºæœåŠ¡å¹¶å¯åŠ¨å³å¯ã€‚ 123456789101112E:\\mysql-5.7.17-winx64\\bin&gt;mysqld --initialize --user=mysql --console// **********2017-02-25T08:11:51.156501Z 1 [Note] A temporary password is generated for root@localhost: gp/L/3#ayeo/E:\\mysql-5.7.17-winx64\\bin&gt;mysqld install MySQL --defaults-file=&quot;E:\\mysql-5.7.17-winx64\\my.ini&quot;Service successfully installed.E:\\mysql-5.7.17-winx64\\bin&gt;net start mysqlMySQL æœåŠ¡æ­£åœ¨å¯åŠ¨ .MySQL æœåŠ¡å·²ç»å¯åŠ¨æˆåŠŸã€‚ MySQLçš„æœåŠ¡æ­£åœ¨è¿è¡Œï¼Œæ­¤æ—¶å°†éšæœºå¯†ç ä¿®æ”¹æˆè‡ªå·±çš„å¯†ç youPwd 123456E:\\mysql-5.7.17-winx64\\bin&gt;mysql -uroot -pEnter password: ************Welcome to the MySQL monitor. Commands end with ; or \\g.// ******mysql&gt; set password = password('youPwd');Query OK, 0 rows affected, 1 warning (0.00 sec)","link":"/2017/02/25/Database/MySQL-install_and_config_Windows/"},{"title":"Gradle æ„å»ºå¤šç§ç‰ˆæœ¬","text":"æœ¬ç« ç›®çš„ Build types æ„å»ºç±»å‹ Product flavors Build variants æ„å»ºä¸åŒç§ç±» Signing configurations å¼€å‘APPæ—¶ï¼Œä¼šæœ‰ç”Ÿæˆä¸åŒç‰ˆæœ¬çš„éœ€æ±‚ã€‚æ¯”å¦‚æµ‹è¯•ç‰ˆæœ¬å’Œå‘å¸ƒç‰ˆæœ¬ã€‚ä¸åŒç‰ˆæœ¬ä¹‹é—´é€šå¸¸æœ‰ä¸åŒçš„è®¾ç½®ã€‚ Build typeså®šä¹‰APPæˆ–è€…æ¨¡å—è¯¥è¢«å¦‚ä½•æ„å»ºã€‚ å¯ä»¥ç”¨buildTypesæ¥å®šä¹‰æ„å»ºç±»å‹ã€‚ä¾‹å¦‚ï¼š123456buildTypes { release { minifyEnabled false proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro' }} é»˜è®¤çš„build.gradleæ–‡ä»¶ä¼šåŒ…å«ä¸€ä¸ªreleaseæ„å»ºç±»å‹ åˆ›å»ºæ„å»ºç±»å‹æ¯”å¦‚åˆ›å»ºä¸€ä¸ªstagingæ„å»ºç±»å‹12345678910buildTypes { // staging æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰åå­— // ç”Ÿæˆsigned Appæ—¶å¯ä»¥é€‰æ‹©è¿™ä¸ªç±»å‹ staging.initWith(buildTypes.debug) staging { applicationIdSuffix &quot;.staging&quot; versionNameSuffix &quot;-staging&quot; buildConfigField(&quot;String&quot;, &quot;BASE_URL&quot;, &quot;\\&quot;http://www.staging.com\\&quot;&quot;) }}è¿™é‡Œå®šä¹‰äº†applicationIdSuffixï¼Œè®©stagingç‰ˆæœ¬çš„applicationIdå’Œreleaseç‰ˆæœ¬çš„ä¸åŒã€‚ initWith()åˆ›å»ºä¸€ä¸ªæ–°çš„æ„å»ºç±»å‹å¹¶å¤åˆ¶ç°æœ‰çš„æ„å»ºç±»å‹ã€‚ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥å¤å†™å·²æœ‰çš„æ„å»ºç±»å‹ã€‚ èµ„æºç›®å½•åˆ›å»ºäº†æ–°çš„æ„å»ºç±»å‹åï¼Œå¯ä»¥å»ºç«‹æ–°çš„èµ„æºæ–‡ä»¶ã€‚ä¾‹å¦‚æˆ‘ä»¬å·²ç»æœ‰äº†stagingæ„å»ºç±»å‹ 12345678srcâ”œâ”€â”€ androidTestâ”œâ”€â”€ debugâ”œâ”€â”€ greenReleaseâ”œâ”€â”€ mainâ”œâ”€â”€ redDebugâ”œâ”€â”€ staging// å¯ä»¥æ–°å»ºèµ„æºç›®å½•â””â”€â”€ test ä¸åŒèµ„æºç›®å½•é‡Œçš„æ–‡ä»¶å¯ä»¥ç”¨ç›¸åŒçš„æ–‡ä»¶åã€‚ mainç›®å½•é‡Œçš„strings.xml123&lt;resources&gt; &lt;string name=&quot;app_name&quot;&gt;GDemo&lt;/string&gt;&lt;/resources&gt; 1234&lt;resources&gt; &lt;!-- staging strings.xml --&gt; &lt;string name=&quot;app_name&quot;&gt;GStaging&lt;/string&gt;&lt;/resources&gt; ç”Ÿæˆä¸åŒç‰ˆæœ¬çš„appæ—¶ï¼Œä¼šè‡ªåŠ¨å»æ‰¾ç›¸åº”çš„èµ„æºæ–‡ä»¶ ä¾èµ–åŒ…ç®¡ç†æ¯ä¸€ç§æ„å»ºç±»å‹å¯ä»¥æœ‰è‡ªå·±çš„ä¾èµ–ã€‚Gradleè‡ªåŠ¨ä¸ºæ¯ä¸ªç±»å‹åˆ›å»ºä¾èµ–é…ç½®ã€‚ä¸‹é¢å°±æ˜¯å•ç‹¬ä¸ºdebugç‰ˆæœ¬æ·»åŠ loggingæ¨¡å—çš„ä¾èµ– 12345678910dependencies { compile fileTree(dir: 'libs', include: ['*.jar']) androidTestCompile('com.android.support.test.espresso:espresso-core:2.2.2', { exclude group: 'com.android.support', module: 'support-annotations' }) compile 'com.android.support:appcompat-v7:25.1.1' testCompile 'junit:junit:4.12' debugCompile 'de.mindpipe.android:android-logging-log4j:1.0.3'} Product flavors äº§å“ç‰¹å¾product flavorsç”¨äºåˆ›å»ºåŒä¸€ä¸ªAPPçš„ä¸åŒç‰ˆæœ¬ã€‚æœ€ç›´æ¥çš„ä¾‹å­å°±æ˜¯å…è´¹å’Œä»˜è´¹ç‰ˆAPPã€‚ å½“æˆ‘ä»¬è¦å‘å¸ƒAPPæ—¶ï¼Œå¯ä»¥é€‰æ‹©releaseæˆ–è€…stagingï¼ˆä¸Šé¢çš„ä¾‹å­ï¼‰ç‰ˆã€‚ä½†æ˜¯å¯¹åŒä¸€ä¸ªæ„å»ºç±»å‹ï¼Œæ¯”å¦‚å¯¹äºreleaseç‰ˆï¼Œæˆ‘ä»¬å¯ä»¥ç”¨Product flavorsæ‰“åŒ…å‡ºæœ‰å„è‡ªç‰¹å¾çš„APPã€‚æ¯”å¦‚ï¼š 1234567891011// å¤šæ¸ é“æ‰“åŒ…å¯ä»¥ç”¨åœ¨è¿™é‡Œé…ç½®// ä¸€æ—¦é…ç½®äº†productFlavorsï¼Œç”Ÿæˆapkæ—¶ä¼šé»˜è®¤é€‰å…¶ä¸­ä¸€ä¸ªé€‰é¡¹productFlavors { red { versionName &quot;1.0-red&quot; } green { applicationId &quot;com.rustfisher.gradletest.green&quot; // ä½¿ç”¨å¦ä¸€ä¸ªç­¾å versionNameSuffix &quot;-green&quot;// ç‰ˆæœ¬åæ·»åŠ åç¼€ }} èµ„æºæ–‡ä»¶æ–°å»ºäº†productFlavorsç±»å‹åï¼Œæˆ‘ä»¬å¯ä»¥æ–°å»ºç›¸åº”çš„èµ„æºç›®å½•ã€‚ 12345678srcâ”œâ”€â”€ androidTestâ”œâ”€â”€ debugâ”œâ”€â”€ greenRelease // releaseç‰ˆæœ¬ é‡‡ç”¨greenâ”œâ”€â”€ mainâ”œâ”€â”€ redDebug // debugç‰ˆæœ¬ é‡‡ç”¨redâ”œâ”€â”€ stagingâ””â”€â”€ test å¤šç§ç‰¹ç§çš„å˜é‡ Multiflavor variantsåœ¨Product flavorsä¸­å¯ä»¥è¿›è¡Œç»„åˆï¼Œä¾‹å¦‚ 123456789101112131415161718192021222324android { flavorDimensions(&quot;color&quot;, &quot;price&quot;) // æ–°å»ºäº†2ç§ç±»å‹ // å¤šæ¸ é“æ‰“åŒ…å¯ä»¥ç”¨åœ¨è¿™é‡Œé…ç½® // ä¸€æ—¦é…ç½®äº†productFlavorsï¼Œdebugæ—¶ä¼šé»˜è®¤é€‰ä¸€ä¸ªé€‰é¡¹ productFlavors { red { versionName &quot;1.0-red&quot; dimension &quot;color&quot; } green { applicationId &quot;com.rustfisher.gradletest.green&quot; // ä½¿ç”¨å¦ä¸€ä¸ªç­¾å versionNameSuffix &quot;-green&quot; dimension &quot;color&quot; } freeApp { dimension &quot;price&quot; } paidApp { dimension &quot;price&quot; } }} é‚£ä¹ˆåœ¨æ‰“åŒ…apkæ—¶ï¼Œå¯ä»¥æœ‰å¦‚ä¸‹4ç§ç‰ˆæœ¬ 1234green-freeApp green-paidApp red-freeApp red-paidApp ä¸€æ—¦æ·»åŠ flavorDimensionsï¼Œå°±å¿…é¡»ä¸ºæ¯ä¸€ä¸ªflavoråˆ¶å®šdimensionã€‚å°±åƒä¸Šé¢çš„colorå’Œpriceå¿…é¡»å‡ºç°åœ¨ä¸‹é¢4ç§productFlavorsä¹‹ä¸­ã€‚å¦åˆ™ä¼šæŠ¥é”™ã€‚ Build VariantsAndroid Studioå·¦ä¸‹è§’å¯ä»¥æ‰“å¼€Build Variantsçª—å£ã€‚é€‰æ‹©æ¨¡å—å’ŒBuild Variantsã€‚å‰é¢é…ç½®çš„æ„å»ºç±»å‹éƒ½ä¼šåœ¨è¿™ä¸ªåˆ—è¡¨ä¸­å‡ºç°ã€‚ Tasks ä»»åŠ¡Android plugin for Gradle ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªé…ç½®çš„æ„å»ºç±»å‹åˆ›å»ºä»»åŠ¡ã€‚æ–°å»ºé¡¹ç›®æ—¶ï¼Œä¼šæœ‰é»˜è®¤çš„assembleDebug å’Œ assembleReleaseã€‚ç»è¿‡ä¸Šé¢çš„é…ç½®ä»¥åï¼Œä¼šæœ‰äº§ç”Ÿç›¸å¯¹åº”çš„ä»»åŠ¡12345678910111213assembleassembleAndroidTestassembleDebugassembleFreeAppassembleGreenassembleGreenFreeAppassembleGreenPaidAppassemblePaidAppassembleRedassembleRedFreeAppassembleRedPaidAppassembleReleaseassembleStaging Resource and manifest mergingAndroidçš„Gradleæ’ä»¶ä¼šåœ¨æ‰“åŒ…appå‰å°†ä¸»è¦èµ„æºå’Œæ„å»ºç±»å‹èµ„æºåˆåœ¨ä¸€èµ·ã€‚å¦å¤–ï¼Œlibå·¥ç¨‹ä¹Ÿå¯ä»¥æä¾›é¢å¤–å¯è¢«åˆå¹¶çš„èµ„æºæ–‡ä»¶ã€‚manifestæ–‡ä»¶ä¹Ÿå¯è¢«åˆå¹¶ã€‚æ¯”å¦‚åœ¨debugç‰ˆæœ¬ä¸­ç”³è¯·æ­£å¼ç‰ˆä¸­ä¸éœ€è¦çš„æƒé™ã€‚ å®šä¹‰æ„å»ºå˜é‡ç»™productFlavorsä¸­çš„ç±»å‹æ·»åŠ èµ„æº 1234567891011121314productFlavors { red { versionName &quot;1.0-red&quot; dimension &quot;color&quot; resValue(&quot;color&quot;, &quot;flavor_color&quot;, &quot;#ff0000&quot;) } green { applicationId &quot;com.rustfisher.gradletest.green&quot; // ä½¿ç”¨å¦ä¸€ä¸ªç­¾å versionNameSuffix &quot;-green&quot; resValue(&quot;color&quot;, &quot;flavor_color&quot;, &quot;#00ff00&quot;) dimension &quot;color&quot; }// ...} ä¸Šé¢çš„flavor_colorå¯ä»¥åœ¨ä»£ç ä¸­é€šè¿‡Ræ–‡ä»¶æ‰¾åˆ°R.color.flavor_color å‚è€ƒï¼šGradle for Android Kevin Pelgrims","link":"/2017/01/19/Android/Gradle_for_android_Creating_Build_Variants/"},{"title":"Gradle åŸºç¡€è‡ªå®šä¹‰æ„å»º","text":"win7 Android Studio 2.1.3 åŸºç¡€è‡ªå®šä¹‰æ„å»º Basic Build Customization æœ¬ç« ç›®çš„ ç†è§£Gradleæ–‡ä»¶ build taskså…¥é—¨ è‡ªå®šä¹‰æ„å»º ç†è§£Gradleæ–‡ä»¶åœ¨Android Studioä¸­æ–°å»ºä¸€ä¸ªé¡¹ç›®åï¼Œä¼šè‡ªåŠ¨åˆ›å»º3ä¸ªGradleæ–‡ä»¶ã€‚ 12345MyAppâ”œâ”€â”€ build.gradleâ”œâ”€â”€ settings.gradleâ””â”€â”€ app â””â”€â”€ build.gradle æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰è‡ªå·±çš„ä½œç”¨ settings.gradleæ–‡ä»¶æ–°å»ºå·¥ç¨‹çš„settingsæ–‡ä»¶ç±»ä¼¼ä¸‹é¢è¿™æ · 1include ':app' Gradleä¸ºæ¯ä¸ªsettingsæ–‡ä»¶åˆ›å»ºSettingså¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶ä¸­çš„æ–¹æ³•ã€‚ The top-level build file æœ€å¤–å±‚çš„æ„å»ºæ–‡ä»¶èƒ½å¯¹å·¥ç¨‹ä¸­æ‰€æœ‰æ¨¡å—è¿›è¡Œé…ç½®ã€‚å¦‚ä¸‹ 12345678910111213141516171819202122buildscript { repositories { jcenter() } dependencies { classpath 'com.android.tools.build:gradle:2.1.3' // NOTE: Do not place your application dependencies here; they belong // in the individual module build.gradle files }}allprojects { repositories { jcenter() maven { url &quot;https://jitpack.io&quot; } }}task clean(type: Delete) { delete rootProject.buildDir} buildscriptä»£ç å—æ˜¯å…·ä½“é…ç½®çš„åœ°æ–¹ï¼Œå¼•ç”¨JCenterä»“åº“ã€‚æœ¬ä¾‹ä¸­ï¼Œä¸€ä¸ªä»“åº“ä»£è¡¨ç€ä¾èµ–åº“ï¼Œæ¢å¥è¯è¯´æ˜¯appå¯ä»¥ä»ä¸­ä¸‹è½½ä½¿ç”¨åº“æ–‡ä»¶ã€‚JCenteræ˜¯ä¸€ä¸ªæœ‰åçš„ Maven ä»“åº“ã€‚ dependenciesä»£ç å—ç”¨æ¥é…ç½®ä¾èµ–ã€‚ä¸Šé¢æ³¨é‡Šè¯´æ˜äº†ï¼Œä¸è¦åœ¨æ­¤æ·»åŠ ä¾èµ–ï¼Œè€Œåº”è¯¥åˆ°ç‹¬ç«‹çš„æ¨¡å—ä¸­å»é…ç½®ä¾èµ–ã€‚ allprojectsèƒ½å¯¹æ‰€æœ‰æ¨¡å—è¿›è¡Œé…ç½®ã€‚ æ¨¡å—ä¸­çš„buildæ–‡ä»¶æ¨¡å—ä¸­çš„ç‹¬ç«‹é…ç½®æ–‡ä»¶ï¼Œä¼šè¦†ç›–æ‰top-levelçš„build.gradleæ–‡ä»¶ 1234567891011121314151617181920212223242526apply plugin: 'com.android.application'android { compileSdkVersion 25 buildToolsVersion &quot;25.0.2&quot; defaultConfig { applicationId &quot;com.xxx.rust.newproj&quot; minSdkVersion 18 targetSdkVersion 25 versionCode 1 versionName &quot;1.0&quot; } buildTypes { release { minifyEnabled false proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro' } }}dependencies { compile fileTree(dir: 'libs', include: ['*.jar']) testCompile 'junit:junit:4.12' compile 'com.android.support:appcompat-v7:25.1.0'} ä¸‹é¢æ¥çœ‹3ä¸ªä¸»è¦çš„ä»£ç å—ã€‚ pluginç¬¬ä¸€è¡Œåº”ç”¨äº†Android åº”ç”¨æ’ä»¶ã€‚Androidæ’ä»¶ç”±Googleå›¢é˜Ÿå¼€å‘ç»´æŠ¤ã€‚è¯¥æ’ä»¶æä¾›æ„å»ºï¼Œæµ‹è¯•ï¼Œæ‰“åŒ…åº”ç”¨å’Œæ¨¡å—éœ€è¦çš„æ‰€æœ‰çš„taskã€‚ androidæœ€å¤§çš„ä¸€ä¸ªåŒºåŸŸã€‚defaultConfigåŒºåŸŸå¯¹appæ ¸å¿ƒè¿›è¡Œé…ç½®ï¼Œä¼šé…ç½®è¦†ç›–AndroidManifest.xmlä¸­çš„é…ç½®ã€‚ applicationIdå¤å†™æ‰manifestæ–‡ä»¶ä¸­çš„åŒ…åã€‚ä½†applicationIdå’ŒåŒ…åæœ‰åŒºåˆ«ã€‚manifestä¸­çš„åŒ…åï¼Œåœ¨æºä»£ç å’ŒRæ–‡ä»¶ä¸­ä½¿ç”¨ã€‚æ‰€ä»¥package nameåœ¨android studioä¸­ç†è§£ä¸ºä¸€ä¸ªæŸ¥è¯¢ç±»çš„è·¯å¾„æ¯”è¾ƒåˆç†ã€‚applicationIdåœ¨Androidç³»ç»Ÿä¸­æ˜¯ä½œä¸ºåº”ç”¨çš„å”¯ä¸€æ ‡è¯†ï¼Œå³åœ¨ä¸€ä¸ªAndroidè®¾å¤‡ä¸­æ‰€æœ‰çš„åº”ç”¨ç¨‹åºçš„applicationIdéƒ½æ˜¯å”¯ä¸€çš„ã€‚ dependenciesæ˜¯Gradleæ ‡å‡†é…ç½®çš„ä¸€éƒ¨åˆ†ã€‚Androidä¸­ç”¨æ¥é…ç½®ä½¿ç”¨åˆ°çš„åº“ã€‚ å®šåˆ¶åŒ–æ„å»º Customizing the buildBuildConfig and resourcesè‡ªä»SDK17ä»¥æ¥ï¼Œæ„å»ºå·¥å…·ä¼šç”Ÿæˆä¸€ä¸ªBuildConfigç±»ï¼ŒåŒ…å«ç€é™æ€å˜é‡DEBUGå’Œä¸€äº›ä¿¡æ¯ã€‚å¦‚æœä½ æƒ³åœ¨åŒºåˆ†debugå’Œæ­£å¼ç‰ˆï¼Œæ¯”å¦‚æ‰“logï¼Œè¿™ä¸ªBuildConfigç±»å¾ˆæœ‰ç”¨ã€‚å¯ä»¥é€šè¿‡Gradleæ¥æ‰©å±•è¿™ä¸ªç±»ï¼Œè®©å®ƒæ‹¥æœ‰æ›´å¤šçš„é™æ€å˜é‡ã€‚ ä»¥NewProjå·¥ç¨‹ä¸ºä¾‹ï¼Œapp\\build.gradle 123456789101112131415161718192021222324252627android { compileSdkVersion 25 buildToolsVersion &quot;25.0.2&quot; defaultConfig { applicationId &quot;com.xxx.rust.newproj&quot; minSdkVersion 18 targetSdkVersion 25 versionCode 1 versionName &quot;1.0&quot; } buildTypes { debug { buildConfigField(&quot;String&quot;, &quot;BASE_URL&quot;, &quot;\\&quot;http://www.baidu.com\\&quot;&quot;) buildConfigField(&quot;String&quot;, &quot;A_CONTENT&quot;, &quot;\\&quot;debug content\\&quot;&quot;) resValue(&quot;string&quot;, &quot;str_version&quot;, &quot;debug_ver&quot;) } release { buildConfigField(&quot;String&quot;, &quot;BASE_URL&quot;, &quot;\\&quot;http://www.qq.com\\&quot;&quot;) buildConfigField(&quot;String&quot;, &quot;A_CONTENT&quot;, &quot;\\&quot;release content\\&quot;&quot;) resValue(&quot;string&quot;, &quot;str_version&quot;, &quot;release_ver&quot;) minifyEnabled false proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro' } }} ä¸Šé¢çš„buildConfigFieldå’ŒresValueåœ¨ç¼–è¯‘åï¼Œèƒ½åœ¨æºä»£ç ä¸­ä½¿ç”¨æ³¨æ„ä¸Šé¢é‚£ä¸ªè½¬ä¹‰çš„åˆ†å·ä¸å¯å°‘ï¼›æ³¨æ„é‡Œé¢çš„å¤§å°å†™ï¼Œè¿™é‡Œä¼ å…¥çš„å‚æ•°å°±åƒæ˜¯ç›´æ¥å¡«å…¥çš„ä»£ç ä¸€æ · ä¸‹é¢æ˜¯ç¼–è¯‘åç”Ÿæˆçš„BuildConfigæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°buildConfigFieldçš„ä¸œè¥¿å·²ç»åœ¨é‡Œé¢äº† 1234567891011public final class BuildConfig { public static final boolean DEBUG = Boolean.parseBoolean(&quot;true&quot;); public static final String APPLICATION_ID = &quot;com.xxx.rust.newproj&quot;; public static final String BUILD_TYPE = &quot;debug&quot;; public static final String FLAVOR = &quot;&quot;; public static final int VERSION_CODE = 1; public static final String VERSION_NAME = &quot;1.0&quot;; // Fields from build type: debug public static final String A_CONTENT = &quot;debug content&quot;; public static final String BASE_URL = &quot;http://www.baidu.com&quot;;} resValueä¼šè¢«æ·»åŠ åˆ°èµ„æºæ–‡ä»¶ä¸­ 1mTv2.setText(R.string.str_version); é€šè¿‡ build.gradle å¢åŠ è·å– applicationId çš„æ–¹å¼æ¨¡å—build.gradleä¸­æ·»åŠ å±æ€§applicationIdï¼Œä¼šè¢«ç¼–è¯‘åˆ°BuildConfigä¸­12345project.afterEvaluate { project.android.applicationVariants.all { variant -&gt; def applicationId = [variant.mergedFlavor.applicationId, variant.buildType.applicationIdSuffix].findAll().join() }} åœ¨ä»£ç ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨1String appID = BuildConfig.APPLICATION_ID; è·å–æ—¶é—´çš„æ–¹æ³•æ¨¡å—build.gradleä¸­æ·»åŠ æ–¹æ³•getTime()ï¼Œå¹¶åœ¨buildTypesä¸­æ·»åŠ åŸŸã€‚123456789101112131415161718// è·å–å½“å‰æ—¶é—´static def getTime() { String timeNow = new Date().format('YYYYMMdd-HHmmss') return timeNow}android { // ... buildTypes { debug { buildConfigField &quot;String&quot;, &quot;BUILD_TIME&quot;, &quot;\\&quot;&quot; + getTime() + &quot;\\&quot;&quot; } release { buildConfigField &quot;String&quot;, &quot;BUILD_TIME&quot;, &quot;\\&quot;&quot; + getTime() + &quot;\\&quot;&quot; // ... } }} BuildConfig.javaä¸­å¾—åˆ°è¿™ä¸ªåŸŸã€‚12// Fields from build type: debugpublic static final String BUILD_TIME = &quot;20180912-100335&quot;; ä¿®æ”¹release apkæ–‡ä»¶åçš„æ–¹æ³•gradleç‰ˆæœ¬3.1.4ã€‚ä½¿ç”¨äº†ä¸Šé¢çš„æ–¹æ³•getTime()ã€‚ 1234567891011android { // ... // ä¿®æ”¹releaseçš„apkåå­— applicationVariants.all { variant -&gt; variant.outputs.all { if (variant.buildType.name == 'release') { outputFileName = &quot;xxx_release_${defaultConfig.versionName}_${getTime()}.apk&quot; } } }} ä»¥å‰çš„æ–¹æ³•å¯èƒ½ä¼šé‡åˆ°é—®é¢˜ï¼šCannot set the value of read-only property 'outputFile' for ApkVariantOutputImpl_Decoratedã€‚å‚è€ƒï¼šhttps://stackoverflow.com/questions/44239235/android-gradle-3-0-0-alpha2-plugin-cannot-set-the-value-of-read-only-property å·¥ç¨‹èŒƒå›´çš„è®¾ç½®å¦‚æœä¸€ä¸ªå·¥ç¨‹ä¸­æœ‰å¤šä¸ªæ¨¡å—ï¼Œå¯ä»¥å¯¹æ•´ä¸ªå·¥ç¨‹åº”ç”¨è®¾ç½®ï¼Œè€Œä¸ç”¨å»ä¿®æ”¹æ¯ä¸€ä¸ªæ¨¡å—ã€‚ NewProj\\build.gradle12345678910allprojects { repositories { jcenter() }}ext { compileSDKVersion = 25 local = 'Hello from the top-level build'} æ¯ä¸€ä¸ªbuild.gradleæ–‡ä»¶éƒ½èƒ½å®šä¹‰é¢å¤–çš„å±æ€§ï¼Œåœ¨extä»£ç å—ä¸­ã€‚ åœ¨ä¸€ä¸ªæ¨¡å—çš„libmodule\\build.gradleæ–‡ä»¶ä¸­ï¼Œå¯ä»¥å¼•ç”¨rootProjectçš„extå±æ€§ 12345android { compileSdkVersion rootProject.ext.compileSDKVersion buildToolsVersion &quot;25.0.2&quot; // ....} å·¥ç¨‹å±æ€§ Project propertieså®šä¹‰propertiesçš„åœ°æ–¹ extä»£ç å— gradle.propertiesæ–‡ä»¶ å‘½ä»¤è¡Œ -P å‚æ•° å·¥ç¨‹build.gradleæ–‡ä»¶123456789101112131415161718192021ext { compileSDKVersion = 25 local = 'Hello from the top-level build'}/** * Print properties info */task aPrintSomeInfo { println(local) println('project dir: ' + projectDir) println(projectPropertiesFileText)}task aPrintAllProperites() { println('\\nthis is aPrintAllProperites task\\n') Iterator pIt = properties.iterator() while (pIt.hasNext()) { println(pIt.next()) }} gradle.propertiesæ–‡ä»¶ä¸­å¢åŠ 1projectPropertiesFileText = Hello there from gradle.properties åœ¨asçš„Gradleæ ä¸ŠåŒå‡»æ‰§è¡ŒaPrintSomeInfoï¼Œä¼šè¿å¸¦ä¸‹ä¸€ä¸ªtaskä¹Ÿæ‰§è¡Œ 123456789101113:08:10: Executing external task 'aPrintSomeInfo'...Hello from the top-level buildproject dir: G:\\openSourceProject\\NewProjHello there from gradle.propertiesthis is aPrintAllProperites task......BUILD SUCCESSFULTotal time: 1.025 secs13:08:11: External task execution finished 'aPrintSomeInfo'. å‚è€ƒï¼šGradle for Android Kevin Pelgrims","link":"/2017/01/19/Android/Gradle_for_android_Basic_Build_Customization/"},{"title":"Gradle for Android å¼€å§‹","text":"Gradle for Androidå¼€å§‹Googleåœ¨Gradleä¸­çš„ç›®æ ‡ï¼šèƒ½å¤ç”¨ä»£ç ï¼Œåˆ›å»ºæ„å»ºå˜é‡ï¼Œèƒ½é…ç½®å’Œå®šåˆ¶æ„å»ºè¿‡ç¨‹ã€‚ GradleåŸºç¡€Gradleæ„å»ºè„šæœ¬å¹¶ä¸æ˜¯ç”¨XMLæ¥å†™çš„ï¼Œè€Œæ˜¯åŸºäºGroovyçš„ä¸€ç§ï¼ˆdomain-specifc languageï¼‰DSLè¯­è¨€ã€‚è¿™æ˜¯ä¸€ç§è¿è¡Œåœ¨JVMä¸Šçš„åŠ¨æ€è¯­è¨€ã€‚ å¦‚æœè¦æ„å»ºæ–°çš„ä»»åŠ¡å’Œæ’ä»¶ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£è¿™é—¨è¯­è¨€ã€‚ Projects and tasksè¿™æ˜¯Gradleç§æœ€é‡è¦çš„ä¸¤ä¸ªæ¦‚å¿µã€‚æ¯ä¸ªæ„å»ºï¼ˆbuildï¼‰è‡³å°‘åŒ…å«ä¸€ä¸ªprojectï¼Œæ¯ä¸€ä¸ªprojectåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªtaskã€‚æ¯ä¸ªbuild.gradleä»£è¡¨ä¸€ä¸ªprojectã€‚taskè¢«å®šä¹‰åœ¨è¿™ä¸ªæ„å»ºè„šæœ¬ä¸­ã€‚ä¸€ä¸ªtaskå¯¹è±¡åŒ…å«ä¸€åˆ—éœ€è¦è¢«æ‰§è¡Œçš„Actionå¯¹è±¡ã€‚ä¸€ä¸ªActionå¯¹è±¡å°±æ˜¯ä¸€å—è¢«æ‰§è¡Œçš„ä»£ç ï¼Œå°±åƒJavaä¸­çš„æ–¹æ³•ã€‚ å½“åˆå§‹åŒ–æ„å»ºè¿›ç¨‹æ—¶ï¼ŒGradleæ”¶é›†buildæ–‡ä»¶ä¸­çš„projectå’Œtaskå¯¹è±¡ã€‚ æ„å»ºçš„ç”Ÿå‘½å‘¨æœŸï¼ˆThe build lifecycleï¼‰ä¸ºç®€åŒ–æ„å»ºè¿‡ç¨‹ï¼Œæ„å»ºå·¥å…·åˆ›é€ äº†ä¸€ç§å·¥ä½œæµçš„åŠ¨æ€æ¨¡å‹DAGï¼ˆDirected Acyclic Graphï¼‰ã€‚è¿™æ„å‘³ç€æ‰€æœ‰çš„ä»»åŠ¡ä¼šä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ‰§è¡Œï¼Œä¸ä¼šå‡ºç°å¾ªç¯çš„æƒ…å†µã€‚ä¸€ä¸ªä»»åŠ¡ä¸€æ—¦è¢«æ‰§è¡Œå°±ä¸ä¼šå†è¢«è°ƒç”¨ã€‚æ²¡æœ‰ä¾èµ–çš„ä»»åŠ¡æ°¸è¿œæ˜¯æœ€ä¼˜å…ˆæ‰§è¡Œçš„ã€‚åœ¨é…ç½®è¿‡ç¨‹ä¸­ç”Ÿæˆä¾èµ–å…³ç³»ã€‚ ä¸€ä¸ªGradleæ„å»ºè¿‡ç¨‹æœ‰3ä¸ªæ­¥éª¤ï¼š åˆå§‹åŒ–ï¼šå·¥ç¨‹å®ä¾‹è¢«åˆ›å»ºæ—¶åˆå§‹åŒ–ã€‚å¦‚æœæœ‰å¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—æœ‰è‡ªå·±çš„build.gradleæ–‡ä»¶ï¼Œå¤šä¸ªprojectè¢«åˆ›å»ºã€‚ é…ç½®ï¼šè¿™ä¸€æ­¥æ‰§è¡Œbuildè„šæœ¬ï¼Œåˆ›å»ºå¹¶é…ç½®æ¯ä¸ªprojectçš„taskã€‚ æ‰§è¡Œï¼šGradleå†³å®šæ‰§è¡Œé‚£äº›ä»»åŠ¡ã€‚æ ¹æ®å½“å‰ç›®å½•å’Œä¼ å…¥å‚æ•°æ‰§è¡Œtaskã€‚ buildé…ç½®æ–‡ä»¶build.gradleæ–‡ä»¶ã€‚é…ç½®buildçš„åœ°æ–¹ã€‚ 12345678buildscript { repositories { jcenter() } dependencies { classpath 'com.android.tools.build:gradle:2.2.2' }} repositorieså—ä¸­ï¼ŒæŒ‡å®šJCenterä½œä¸ºä¾èµ–ä»“åº“ã€‚è¿™ä¸ªè„šæœ¬è·å–äº†Androidæ„å»ºå·¥å…·ã€‚è¿™ä¸ªAndroidæ’ä»¶æä¾›äº†æ„å»ºå’Œæµ‹è¯•åº”ç”¨æ‰€éœ€çš„åŠŸèƒ½ã€‚ æ’ä»¶è¢«ç”¨æ¥æ‰©å±•Gradleæ„å»ºè„šæœ¬çš„åŠŸèƒ½ã€‚åœ¨projectä¸­ä½¿ç”¨æ’ä»¶ï¼Œå°±å¯ä»¥å®šä¹‰å±æ€§å’Œä»»åŠ¡ã€‚ Gradle Wrapperåˆæ­¥Gradleæ˜¯ä¸€ä¸ªå¼€å‘ä¸­çš„å·¥å…·ã€‚ä½¿ç”¨Gradle Wrapperå¯ä»¥é¿å…ä¸€äº›é—®é¢˜ï¼Œç¡®ä¿èƒ½æ„å»ºé¡ºåˆ©ã€‚Gradleåœ¨Windowsç³»ç»Ÿä¸Šæä¾›äº†batchæ–‡ä»¶ï¼Œåœ¨å…¶ä»–ç³»ç»Ÿä¸Šæä¾›äº†shellè„šæœ¬ã€‚è¯•å›¾è¿è¡Œè„šæœ¬æ—¶ï¼Œä¼šè‡ªåŠ¨æ£€æŸ¥å¹¶ä¸‹è½½Gradleã€‚ä½†åœ¨æˆ‘ä»¬çš„ç½‘ç»œæ¯”è¾ƒä»¤äººç€æ€¥ã€‚å¯ä»¥å°è¯•åœ¨ç½‘ç»œä¸Šæ‰¾èµ„æºã€‚ æ¯”å¦‚æˆ‘ä¸‹è½½äº†ä¸€ä¸ªgradle-2.14.1-all.zipï¼Œå°†å…¶æ”¾åˆ°Androidå·¥ç¨‹çš„gradle/wrapperä¸‹ 12345gradle`-- wrapper |-- gradle-2.14.1-all.zip |-- gradle-wrapper.jar `-- gradle-wrapper.properties ç„¶åä¿®æ”¹gradle-wrapper.propertiesæ–‡ä»¶ï¼ŒæŠŠUrlä¿®æ”¹æˆdistributionUrl=gradle-2.14.1-all.zip åœ¨Android Studioæä¾›çš„Terminalä¸­è¿è¡Œgrawdlewï¼Œå…ˆunzippingï¼Œç„¶åå¼€å§‹ä¸‹è½½ä¾èµ–æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶åœ¨windowsä¸­é»˜è®¤å­˜æ”¾åˆ°C:\\Users\\UserName\\.gradle\\wrapper\\dists\\gradle-2.14.1-allï¼Œè¿˜æ˜¯å¾ˆå ç©ºé—´çš„ã€‚æ­¤æ—¶ä½ å¯ä»¥åœ¨é¡¹ç›®ä¸‹çš„å‘½ä»¤è¡Œä¸­ä½¿ç”¨grawdlewå‘½ä»¤ã€‚æ¯”å¦‚æŸ¥çœ‹ç‰ˆæœ¬ã€‚ 12345678910111213G:\\rust_proj\\NDKProj&gt;gradlew -v------------------------------------------------------------Gradle 2.14.1------------------------------------------------------------Build time: 2016-07-18 06:38:37 UTCRevision: d9e2113d9fb05a5caabba61798bdb8dfdca83719Groovy: 2.4.4Ant: Apache Ant(TM) version 1.9.6 compiled on June 29 2015JVM: 1.8.0_77 (Oracle Corporation 25.77-b03)OS: Windows 7 6.1 amd64 å¦‚æœåœ¨å¦ä¸€ä¸ªAndroidé¡¹ç›®ä¸‹åŒæ ·å¤åˆ¶äº†gradle-2.14.1-all.zipï¼Œå¹¶ä¸”å°è¯•è¿è¡Œgradlewï¼ŒCç›˜é‡Œç›¸åº”ç›®å½•ä¸‹åˆä¼šå¤šä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚ è·å–Gradle Wrapperæ‰“å¼€Windows CMDï¼Œè¿›å…¥å‰é¢é…ç½®å¥½çš„Androidå·¥ç¨‹ç›®å½•ï¼ŒåŒæ ·å¯ä»¥è¿è¡Œgradlewã€‚ æ­¤æ—¶æˆ‘ä»¬çš„Cç›˜é‡Œå·²ç»æœ‰gradle-2.14.1-all.zipäº†ã€‚æ‰¾åˆ°gradle.batçš„è·¯å¾„ï¼Œå°†å…¶æ·»åŠ åˆ°ç”µè„‘PATHä¸­ã€‚è¿™é‡Œæ·»åŠ åˆ°ç”¨æˆ·çš„ç¯å¢ƒå˜é‡ä¸­ã€‚ åœ¨Gç›˜æ–°å»ºä¸€ä¸ªç›®å½•gradleTestï¼Œç„¶ååˆ›å»ºä¸€ä¸ªbuild.gradleæ–‡ä»¶ï¼›å…¶ä¸­å¡«å†™å¦‚ä¸‹ä»£ç  123task wrapper(type: Wrapper) { gradleVersion = '2.4'} è¿›å…¥åˆšæ‰çš„ç›®å½•ï¼Œåœ¨CMDä¸­ç›´æ¥è¿è¡Œgradle 123456789G:\\gradleTest&gt;gradle:helpWelcome to Gradle 2.14.1.To run a build, run gradle &lt;task&gt; ...To see a list of available tasks, run gradle tasksTo see a list of command-line options, run gradle --helpTo see more detail about a task, run gradle help --task &lt;task&gt;BUILD SUCCESSFULTotal time: 1.714 secs æ­¤æ—¶ç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ª.gradleç›®å½• å¦‚æœå½“å‰ç›®å½•ä¸‹æ²¡æœ‰build.gradleæ–‡ä»¶ï¼Œgradleä¹Ÿä¼šæ‰§è¡Œå¹¶ç”Ÿæˆ.gradleç›®å½•ã€‚ æˆ‘ä»¬æ¥è§‚å¯ŸAndroidé¡¹ç›®é‡ŒGradle Wrapperçš„æƒ…å†µ123456NDKProj/â”œâ”€â”€ gradlewâ”œâ”€â”€ gradlew.batâ””â”€â”€ gradle/wrapper/ â”œâ”€â”€ gradle-wrapper.jar â””â”€â”€ gradle-wrapper.propertiesGradle WrapperåŒ…å«3ä¸ªéƒ¨åˆ†ï¼š MSå¯æ‰§è¡Œçš„gradlew.batå’ŒLinuxï¼Œ Mac OS Xå¯æ‰§è¡Œçš„gradlew è„šæœ¬éœ€è¦çš„Jaræ–‡ä»¶ ä¸€ä¸ªpropertiesæ–‡ä»¶ åœ¨å‰é¢æˆ‘ä»¬å·²ç»æŠŠpropertiesæ–‡ä»¶ä¿®æ”¹æˆäº†è¿™æ ·ï¼š123456#Mon Aug 29 19:26:36 CST 2016distributionBase=GRADLE_USER_HOMEdistributionPath=wrapper/distszipStoreBase=GRADLE_USER_HOMEzipStorePath=wrapper/distsdistributionUrl=gradle-2.14.1-all.zip åŸdistributionUrlå¦‚ä¸‹ï¼š1distributionUrl=https\\://services.gradle.org/distributions/gradle-2.14.1-all.zip è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸åŒçš„URLå’ŒGradleã€‚æˆ‘ä»¬å‰é¢å·²ç»è¿™ä¹ˆåšäº†ã€‚ è¿è¡ŒåŸºæœ¬çš„æ„å»ºä»»åŠ¡ï¼ˆtaskï¼‰è¿›å…¥Androidå·¥ç¨‹ç›®å½•ä¸‹ï¼Œç”¨å‘½ä»¤è¡Œæ‰§è¡Œgradlewgradlew tasksä¼šæ‰“å°å‡ºä»»åŠ¡åˆ—è¡¨ï¼›gradlew tasks --allæ‰“å°å‡ºæ‰€æœ‰çš„ä»»åŠ¡ gradlew assembleDebugç¼–è¯‘å½“å‰é¡¹ç›®ï¼Œåˆ›å»ºä¸€ä¸ªdebugç‰ˆæœ¬çš„apk gradlew cleanæ¸…ç†å½“å‰é¡¹ç›®çš„output gradlew checkè¿è¡Œæ‰€æœ‰çš„æ£€æŸ¥ï¼Œé€šå¸¸æ˜¯åœ¨çœŸæœºæˆ–è€…æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œæµ‹è¯• gradlew buildè§¦å‘assemble å’Œ check è¿™äº›åŠŸèƒ½åœ¨Android Studioä¸Šéƒ½æœ‰ç›¸åº”æŒ‰é”® å‚è€ƒï¼šGradle for Android Kevin Pelgrims","link":"/2017/01/19/Android/Gradle_for_android_Start/"},{"title":"PyQt QMainWindow ç®€å•ä½¿ç”¨","text":"QMainWindowç»§æ‰¿è‡ªQWidgetQMainWindowç›¸å½“äºç¨‹åºçš„ä¸»ç•Œé¢ï¼Œå†…ç½®äº†menuå’ŒtoolBarã€‚ä½¿ç”¨ Qt Designer å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ·»åŠ menué€‰é¡¹ã€‚ å¯¹äºè¾ƒå¤§å‹çš„ç•Œé¢ï¼Œç”¨Qt Designeræ¯”è¾ƒæ–¹ä¾¿ã€‚.uiæ–‡ä»¶å°±åƒAndroidä¸­ä½¿ç”¨xmlä¸€æ ·ã€‚ç”»å‡ºçš„uiæ–‡ä»¶å¯ä»¥ç”¨PyQtä¸­çš„PyUICè½¬æ¢æˆpyæ–‡ä»¶ã€‚è½¬æ¢åçš„pyæ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªclassã€‚æ–°å»ºä¸€ä¸ªç»§æ‰¿è‡ªQMainWindowçš„ç±»ï¼Œæ¥è°ƒç”¨ç”Ÿæˆçš„è¿™ä¸ªç±»ã€‚ ä¸»çª—å£å…³é—­æ—¶ï¼Œä¼šè°ƒç”¨closeEvent(self, *args, **kwargs)ï¼Œå¯å¤å†™è¿™ä¸ªæ–¹æ³•ï¼ŒåŠ ä¸Šä¸€äº›å…³é—­æ—¶çš„æ“ä½œã€‚æ¯”å¦‚ç»ˆæ­¢å­çº¿ç¨‹ï¼Œå…³é—­æ•°æ®åº“æ¥å£ï¼Œé‡Šæ”¾èµ„æºç­‰ç­‰æ“ä½œã€‚ PyQt5 æ‰‹å†™ QMainWindow ç¤ºä¾‹Win7 PyCharm Python3.5.1 PyQt5 æ‰‹å†™ä¸€ä¸ªmain windowï¼Œä¸»è¦ä½¿ç”¨äº†èœå•æ ã€æ–‡æœ¬ç¼–è¾‘æ¡†ã€å·¥å…·æ å’ŒçŠ¶æ€æ 12345|-- main.py|-- res| `-- sword.png`-- ui `-- app_main_window.py main.pyä¸»æ–‡ä»¶12345678910import sysfrom PyQt5.QtWidgets import QApplicationfrom ui.app_main_window import AppMainWindowif __name__ == '__main__': app = QApplication(sys.argv) window = AppMainWindow() window.show() sys.exit(app.exec_()) app_main_window.pyçª—å£å®ç°æ–‡ä»¶12345678910111213141516171819202122232425262728293031323334353637383940414243from PyQt5.QtCore import QCoreApplicationfrom PyQt5.QtGui import QIconfrom PyQt5.QtWidgets import QActionfrom PyQt5.QtWidgets import QMainWindowfrom PyQt5.QtWidgets import QTextEditclass AppMainWindow(QMainWindow): &quot;&quot;&quot; èœå•æ ã€æ–‡æœ¬ç¼–è¾‘æ¡†ã€å·¥å…·æ å’ŒçŠ¶æ€æ  &quot;&quot;&quot; def __init__(self): super().__init__() self.init_ui() def init_ui(self): # èœå•æ  self.statusBar().showMessage('Main window is ready') self.setGeometry(500, 500, 450, 220) self.setMinimumSize(150, 120) self.setWindowTitle('MainWindow') # æ–‡æœ¬ç¼–è¾‘æ¡† text_edit = QTextEdit() self.setCentralWidget(text_edit) # å¡«å……å‰©ä¸‹çš„ä½ç½® # å®šä¹‰é€€å‡ºåŠ¨ä½œ exit_action = QAction(QIcon('res/sword.png'), 'Exit', self) exit_action.setShortcut('Ctrl+Q') exit_action.setStatusTip('Exit App') # é¼ æ ‡æŒ‡å‘é€‰é¡¹æ—¶åœ¨çª—å£çŠ¶æ€æ å‡ºç°çš„æç¤º # exit_action.triggered.connect(QCoreApplication.instance().quit) exit_action.triggered.connect(self.close) # å…³é—­app # å®šä¹‰èœå•æ ï¼Œæ·»åŠ ä¸€ä¸ªé€‰é¡¹ menu_bar = self.menuBar() file_menu = menu_bar.addMenu('&amp;File') file_menu.addAction(exit_action) # å®šä¹‰å·¥å…·æ ï¼Œæ·»åŠ ä¸€ä¸ªé€€å‡ºåŠ¨ä½œ toolbar = self.addToolBar('&amp;Exit') toolbar.addAction(exit_action) æœ‰çš„æ—¶å€™PyCharmç»™çš„ä»£ç æç¤ºä¸å®Œå…¨ã€‚ç½‘ä¸Šè¯´PyCharmé…åˆvimæ’ä»¶æ¥ä½¿ç”¨èƒ½å¸¦æ¥å¾ˆå¥½çš„ä½“éªŒã€‚ç”Ÿæˆçš„ç•Œé¢ä¸­ï¼Œå·¥å…·æ å¯ä»¥è‡ªç”±çš„æ‹–åŠ¨ï¼Œå¯ä»¥æ”¾åœ¨ä¸Šä¸‹å·¦å³4ä¸ªåœ°æ–¹ã€‚ åŒæ ·çš„ä»£ç ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç§»æ¤åˆ°PyQt4ä¸­ã€‚ ä½¿ç”¨designerç”»å‡ºæ¥çš„ç•Œé¢Ubuntu ä½¿ç”¨designerç»˜åˆ¶å¥½ç•Œé¢åï¼Œè®²uiæ–‡ä»¶è½¬æ¢æˆpyä»£ç ã€‚1234567891011121314151617181920import sysfrom PyQt5.QtWidgets import QMainWindow, QApplicationfrom ui_main_window import Ui_UAppMainWindowclass RustMainWindow(QMainWindow): &quot;&quot;&quot;ä¸»ç•Œé¢ç±»&quot;&quot;&quot; def __init__(self): super(RustMainWindow, self).__init__() self.ma = Ui_UAppMainWindow() # designerç”»çš„ç•Œé¢ self.ma.setupUi(self)if __name__ == &quot;__main__&quot;: app = QApplication(sys.argv) main_window = RustMainWindow() main_window.show() sys.exit(app.exec_()) å¤å†™__init__åˆå§‹åŒ–æ–¹æ³•æ—¶éœ€è¦è°ƒç”¨çˆ¶ç±»æ–¹æ³• PyQt4æ‰‹å†™çª—å£ä»£ç å’Œä¸Šé¢é‚£ä¸ªåŠŸèƒ½ç±»ä¼¼ã€‚ 12345678910111213141516171819202122232425262728293031323334353637import sysfrom PyQt4.QtGui import QMainWindow, QTextEdit, QAction, QIcon, QApplicationclass AppMainWindow(QMainWindow): def __init__(self): super(AppMainWindow, self).__init__() self.init_ui() def init_ui(self): self.statusBar().showMessage('Main window is ready') self.setGeometry(500, 500, 450, 220) self.setMinimumSize(150, 120) self.setWindowTitle('MainWindow') text_edit = QTextEdit() self.setCentralWidget(text_edit) exit_action = QAction(QIcon('res/ic_s1.png'), 'Exit', self) exit_action.setShortcut('Ctrl+Q') exit_action.setStatusTip('Exit App') exit_action.triggered.connect(self.close) menu_bar = self.menuBar() file_menu = menu_bar.addMenu('&amp;File') file_menu.addAction(exit_action) toolbar = self.addToolBar('&amp;Exit') toolbar.addAction(exit_action)if __name__ == '__main__': app = QApplication(sys.argv) window = AppMainWindow() window.show() sys.exit(app.exec_()) å¯ä»¥çœ‹å‡ºï¼ŒPyQt4 å’Œ 5 çš„ä»£ç åŸºæœ¬ä¸Šæ˜¯é€šç”¨çš„ã€‚å¤å†™__init__çš„æ–¹æ³•ä¸åŒã€‚","link":"/2016/12/28/PyQt_note/PyQt-QMainWindow_simple_practice/"},{"title":"PyQt åˆ›å»ºè‡ªå®šä¹‰QWidget","text":"PyQt5.QtWidgets ç¤ºä¾‹Win7 PyCharm Python3.5.1 PyQt5 ä¸»è¦æ–‡ä»¶ï¼š12345|-- main.py|-- res| `-- fish.jpg`-- ui `-- app_widget.py main.py12345678910111213import sysfrom PyQt5.QtWidgets import QApplicationfrom ui.app_widget import AppQWidgetif __name__ == '__main__': app = QApplication(sys.argv) w = AppQWidget() w.show() sys.exit(app.exec_()) app_main_window.pyè‡ªå®šä¹‰äº†ä¸€ä¸ªå±…ä¸­æ˜¾ç¤ºçš„çª—å£ï¼Œå…³é—­æ—¶å¼¹ç¡®è®¤æ¡† 12345678910111213141516171819202122232425262728293031323334353637383940414243from PyQt5.QtCore import QCoreApplicationfrom PyQt5.QtGui import QIconfrom PyQt5.QtWidgets import QWidget, QPushButton, QDesktopWidget, QMessageBoxclass AppQWidget(QWidget): &quot;&quot;&quot; A custom QWidget by Rust Fisher &quot;&quot;&quot; def __init__(self): super().__init__() self.init_ui() def init_ui(self): # self.setGeometry(300, 300, 400, 200) # ç›¸å½“äºmoveå’Œresize self.resize(300, 200) self.move_to_center() self.setWindowTitle('Demo1') self.setWindowIcon(QIcon('res/fish.jpg')) btn1 = QPushButton('Quit', self) btn1.setToolTip('Click to quit') btn1.resize(btn1.sizeHint()) btn1.move(200, 150) btn1.clicked.connect(QCoreApplication.instance().quit) # cannot locate function connect def closeEvent(self, event): reply = QMessageBox.question(self, 'Message', 'Are you sure to quit now?', QMessageBox.Yes | QMessageBox.No, QMessageBox.No) if reply == QMessageBox.Yes: event.accept() else: event.ignore() def move_to_center(self): qr = self.frameGeometry() cp = QDesktopWidget().availableGeometry().center() # got center info here qr.moveCenter(cp) self.move(qr.topLeft()) # åº”ç”¨çª—å£çš„å·¦ä¸Šæ–¹çš„ç‚¹åˆ°qrçŸ©å½¢çš„å·¦ä¸Šæ–¹çš„ç‚¹ï¼Œå› æ­¤å±…ä¸­æ˜¾ç¤ºåœ¨æˆ‘ä»¬çš„å±å¹•ä¸Š Tipså¤šæ§ä»¶å¯ä»¥å­˜åœ¨listä¸­å­˜åœ¨ä¸€èµ·ï¼Œéœ€è¦å¯¹æ•´ä½“æ“ä½œæ—¶ç›´æ¥éå†åˆ—è¡¨ 123456789101112131415161718192021222324252627282930 # åŒç»„çš„æ§ä»¶å¯ä»¥å­˜åœ¨åŒä¸€ä¸ªlistä¸­ self.cb_list = [ self.ma.i2cCB, self.ma.mipiCB, self.ma.eepromCB, self.ma.tem_sensorCB, self.ma.lensCB, self.ma.vcmCB, self.ma.mirrorCB, self.ma.mirrorCaliCB, ] self.test_count_et_list = [ self.ma.i2cCountEt, self.ma.mipiCountEt, self.ma.eepromCountEt, self.ma.tem_sensorCountEt, self.ma.lensCountEt, self.ma.vcmCountEt, self.ma.mirrorCountEt, self.ma.mirrorCaliCountEt, ]# éœ€è¦æ“ä½œæŸç»„æ§ä»¶æ—¶ ç›´æ¥éå†åˆ—è¡¨def _click_test_item_cb(self): &quot;&quot;&quot; Update [choose all checkbox] by all test item state &quot;&quot;&quot; choose_all = True for cb in self.cb_list: choose_all = choose_all &amp; cb.isChecked() self.ma.selecteAllCB.setChecked(choose_all) QApplicationä¸QWidgetQApplicationæ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œåœ¨QWidgetä¸­å¯ä»¥é€šè¿‡QApplication.instance()è·å–åˆ°å¯¹è±¡ å®é™…ä¸Šåœ¨å®ä¾‹åŒ–QApplicationå‰å°±ä½¿ç”¨QtGui.QWidget()æ˜¯ä¼šæŠ¥é”™çš„12&gt;&gt;&gt; QtGui.QWidget()QWidget: Must construct a QApplication before a QPaintDeviceå‚è€ƒ How QApplication() and QWidget() objects are connected in PySide/PyQt? åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„QMainWindowä¸­ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è·å–åˆ°QApplicationçš„å®ä¾‹ã€‚1234567class RustMainWindow(QMainWindow): &quot;&quot;&quot; This is the main class &quot;&quot;&quot; def _trigger_english(self): print &quot;Change to English&quot;, QApplication.instance()# Change to English &lt;PyQt4.QtGui.QApplication object at 0x02ABE3A0&gt; æ³¨æ„widgetæŒæœ‰å¤–éƒ¨å¯¹è±¡å¼•ç”¨çš„é—®é¢˜å¦‚æœåœ¨ç¨‹åºå¯åŠ¨çš„åœ°æ–¹å°†å¼•ç”¨äº¤ç»™widgetï¼Œé€€å‡ºæ—¶ä¼šé€ æˆåº”ç”¨æ— æ³•å…³é—­çš„é—®é¢˜ï¼ˆç±»ä¼¼å†…å­˜æ³„æ¼ï¼‰ã€‚123456if __name__ == '__main__': app = QApplication(sys.argv) # è¿™é‡ŒæŠŠappäº¤ç»™äº†MainWindowï¼ŒMainWindowå…³é—­æ—¶æ˜¯æ— æ³•æ­£å¸¸é€€å‡ºåº”ç”¨çš„ main_d = RustMainWindow(app) # ä¸å»ºè®®è¿™ä¹ˆåš main_d.show() sys.exit(app.exec_())","link":"/2016/12/28/PyQt_note/PyQt5-Custom_QWidget/"},{"title":"PyCharm å®‰è£…å’Œé…ç½®","text":"å®‰è£…å’Œé…ç½®PyCharmä¿®æ”¹é»˜è®¤é…ç½®ï¼Œä¿®æ”¹configå’Œsystemçš„è·¯å¾„ï¼Œé¿å…å æ®Cç›˜å¤ªå¤šçš„ç©ºé—´å°†PyQtä¸­çš„å·¥å…·PyUICå®‰è£…åˆ°PyCharmä¸­ï¼Œä½¿ç”¨æ›´ä¾¿æ·ï¼ˆWindowså’ŒUbuntuå¹³å°ï¼‰ win7 Python3.5.1 PyQt5-5.6 PyCharmç‰ˆæœ¬ï¼š JetBrains PyCharm Community Edition 2016.3.1(64) å®‰è£…è·¯å¾„ï¼š E:\\IntelliJ IDEA Community Edition 2016.1.1 PyCharmé»˜è®¤é…ç½®å’ŒAndroid Studioç±»ä¼¼ï¼Œå¯ä»¥è‡ªå®šä¹‰IDEçš„é…ç½® åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨å‰ï¼Œæ‰¾åˆ°bin\\idea.propertiesï¼Œä¿®æ”¹ä¸€ä¸‹è·¯å¾„ 123idea.config.path=E:/IntelliJIDEAPath/configidea.system.path=E:/IntelliJIDEAPath/system å¯åŠ¨åï¼Œå¯ä»¥å‘ç°configå’Œsysteméƒ½åœ¨E:/IntelliJIDEAPathä¸‹æ­¤ä¸¾æ˜¯ä¸ºäº†é¿å…Cç›˜æŒ¤çˆ† PyCharmå·¥ç¨‹é…ç½®æ‰“å¼€Settings1234Build, Execution, Deployment Console Python Console Python interpreter é€‰æ‹© Python 3.5.1 å‡è®¾æœ‰ä¸€ä¸ªå·¥ç¨‹gui_appï¼ŒåŒæ ·è¦æ£€æŸ¥ä¸€ä¸‹è®¾ç½®123Project: gui_app Project interpreter é€‰æ‹©3.5.1 åé¢ä¼šæ˜¾ç¤ºè·¯å¾„ å®‰è£…æ‰©å±•å·¥å…·æ‰“å¼€Settings &gt; Tools &gt; External Tools é€‰æ‹©æ–°å»º+ï¼Œæˆ–è€…ç¼–è¾‘ å®‰è£…QtDesignerName: QtDesigner12345Tool Settings Program: E:\\Python351\\Lib\\site-packages\\PyQt5\\designer.exe ## é€‰æ‹©å®‰è£…å¥½çš„PyQt5\\designer.exe Working directory: $FileDir$ å®‰è£…PyUICå°†designerç”Ÿæˆçš„uiæ–‡ä»¶è½¬ä¸ºpyæ–‡ä»¶çš„å·¥å…·ï¼›è¿™æ˜¯Pythonè‡ªå¸¦çš„å·¥å…· Name: PyUIC123456Tool Settings Program: E:\\Python351\\python.exe ## é€‰æ‹©å®‰è£…å¥½çš„python.exe Parameters: -m PyQt5.uic.pyuic $FileName$ -o $FileNameWithoutExtension$.py Working directory: $FileDir$ Ubuntuä¸‹PyCharmé…ç½®å°†designerç”Ÿæˆçš„uiæ–‡ä»¶è½¬ä¸ºpyæ–‡ä»¶çš„å·¥å…·éœ€è¦sudo apt-get install pyqt5-dev-toolsé…ç½®å·¥å…·[Tool Settings]123Program: pyuic5Parameters: -o $FileNameWithoutExtension$.py $FileNameWithoutExtension$.uiWorking directory: $FileDir$","link":"/2016/12/28/PyQt_note/PyCharm-Install_and_config/"},{"title":"Python3.5 PyQt5 å®‰è£…","text":"åœ¨Windowså’ŒUbuntuä¸‹å®‰è£…PyQt5éœ€è¦å…ˆå®‰è£…å¹¶é…ç½®å¥½Pythonï¼ŒWindowsä¸‹éœ€è¦é…ç½®ç¯å¢ƒå˜é‡ã€‚PyQtéœ€è¦å¯¹åº”ä¸ŠPythonç‰ˆæœ¬ã€‚ Windowsç¯å¢ƒç”¨pip3å®‰è£…PyQt5å…ˆç¡®è®¤Pythonç›¸å…³ç¯å¢ƒå˜é‡å·²ç»é…ç½®å¥½ï¼Œæ¯”å¦‚ï¼š1D:\\python36;D:\\python36\\Scripts;D:\\python36\\libs;ç„¶åè¿è¡Œpip3ï¼Œå‚è€ƒ PyQt5 Download1pip3 install PyQt5ä»ç½‘ä¸Šä¸‹è½½ç›¸å…³æ–‡ä»¶å¹¶å®‰è£…ï¼Œç­‰å¾…è¿‡ç¨‹æ¯”è¾ƒé•¿ã€‚ PyQt5-5.6-gpl exe å®‰è£…æ–¹å¼Win7 Python3.5.1 PyQt5-5.6-gpl-Py3.5-Qt5.6.0-x64-2.exe ï¼ˆæœ€æ–°ç‰ˆæœ¬å·²ç»ä¸å†æä¾›exeç‰ˆæœ¬ï¼‰ å…ˆå®‰è£…Python3.5.1åˆ° E:\\Python351å†å»å®˜ç½‘ä¸‹è½½PyQt5ï¼Œç¿»å¢™åä¸‹è½½é€Ÿåº¦æ›´å¿«ã€‚åŒå‡»å®‰è£…ï¼ŒPyQt5ä¼šè‡ªåŠ¨æ‰¾åˆ°Python35çš„ç›®å½•ã€‚æœ¬ä¾‹ä¸­PyQt5å®‰è£…åˆ° E:\\Python351\\Lib\\site-packages\\PyQt5 ç°åœ¨å°±å¯ä»¥ä½¿ç”¨PyQt5äº†ã€‚ &gt;&gt;&gt; from PyQt5.QtWidgets import * åœ¨å‘½ä»¤è¡Œæ˜¾ç¤ºä¸€ä¸ªlabelè¯•ä¸€ä¸‹ 123456&gt;&gt;&gt; import sys&gt;&gt;&gt; from PyQt5 import QtWidgets&gt;&gt;&gt; app = QtWidgets.QApplication(sys.argv)&gt;&gt;&gt; label = QtWidgets.QLabel('Label')&gt;&gt;&gt; label.resize(150,100)&gt;&gt;&gt; label.show() Ubuntu 16.04Python3.5ç›´æ¥å®‰è£…1234sudo apt-get install python3-devsudo apt-get install python3-pyqt5sudo apt-get install qt5-default qttools5-dev-toolsdesigner # å¯åŠ¨designer å®‰è£…pyuic51sudo apt-get install pyqt5-dev-tools","link":"/2016/12/28/PyQt_note/Python-PyQt5_Python351_install/"},{"title":"Python3 è¯»å†™csvæ–‡ä»¶ä¸­çš„æ•°å­—","text":"ç¯å¢ƒä¸å·¥å…· Python3 PyCharm CE csvç®€ä»‹ä»€ä¹ˆæ˜¯csvï¼Ÿcsvæ˜¯é€—å·åˆ†éš”çš„ä¸€ç§æ–‡ä»¶æ ¼å¼ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªcsvæ ¼å¼çš„æ–‡æœ¬ã€‚123å§“å,å¹´é¾„,æ ‡ç­¾Rust Fisher,18,PythonTom Hanks,29,Java è¿™æ ·çš„.csvæ–‡ä»¶å¯ä»¥ç”¨Excelæˆ–è€…WPSæ‰“å¼€ï¼Œä¼šç»™å‡ºè¡¨æ ¼çš„å½¢å¼ã€‚ è¦æ³¨æ„çš„æ˜¯ï¼Œcsvæ˜¯æ–‡æœ¬æ ¼å¼ï¼Œå¹¶ä¸æ˜¯Excelçš„æ ¼å¼ã€‚æˆ‘ä»¬ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆä¾‹å¦‚xcodeï¼Œè®°äº‹æœ¬ï¼‰æ˜¯å¯ä»¥ç›´æ¥ç¼–è¾‘å®ƒçš„ã€‚ è¯»å†™csvæ–‡ä»¶è¯»æ–‡ä»¶æ—¶å…ˆäº§ç”Ÿstrçš„åˆ—è¡¨ï¼ŒæŠŠæœ€åçš„æ¢è¡Œç¬¦åˆ æ‰ï¼›ç„¶åä¸€ä¸ªä¸ªstrè½¬æ¢æˆint123456789101112131415161718## è¯»å†™csvæ–‡ä»¶csv_file = 'datas.csv'csv = open(csv_file,'w')for i in range(1,20): csv.write(str(i) + ',') if i % 10 == 0: csv.write('\\n')csv.close()result = []with open(csv_file,'r') as f: for line in f: linelist = line.split(',') linelist.pop()# delete: \\n for index, item in enumerate(linelist): result.append(int(item))print('\\nResult is \\n' , result) è¾“å‡ºï¼š12Result is [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19] æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨è‹¥ç›®æ ‡ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºä¸€ä¸ªç›®å½•123456import osjson_dir = &quot;../dir_json/2017-04/&quot;if not os.path.exists(json_dir): print(&quot;json dir not found&quot;) os.makedirs(json_dir) print(&quot;Create dir &quot; + json_dir) å†™æ–‡ä»¶æ—¶æŒ‡å®šæ ¼å¼å‚è€ƒä¸‹é¢çš„ä»£ç ï¼Œæ‰“å¼€æ–‡ä»¶æ—¶æŒ‡å®šutf8ï¼Œè½¬æ¢æˆjsonæ—¶æŒ‡å®šensure_ascii=False123import jsonjson_file = open(json_dir + id + '.json', 'w', encoding='utf8')json_file.write(json.dumps(data_dict, ensure_ascii=False))é¿å…å†™æˆçš„jsonæ–‡ä»¶ä¹±ç  å‡½æ•° enumerate(iterable, start=0)è¿”å›ä¸€ä¸ªenumerateå¯¹è±¡ã€‚iterableå¿…é¡»æ˜¯ä¸€ä¸ªå¥å­ï¼Œè¿­ä»£å™¨æˆ–è€…æ”¯æŒè¿­ä»£çš„å¯¹è±¡ã€‚ enumerateç¤ºä¾‹1ï¼š12345678&gt;&gt;&gt; data = [1,2,3]&gt;&gt;&gt; for i, item in enumerate(data): print(i,item)0 11 22 3ç¤ºä¾‹2ï¼š12345678&gt;&gt;&gt; line = 'one'&gt;&gt;&gt; for i, item in enumerate(line,4): print(i,item)4 o5 n6 eå‚è€ƒï¼š https://docs.python.org/3/library/functions.html?highlight=enumerate#enumerate class int(x=0)class int(x, base=10)è¿”å›ä¸€ä¸ªIntegerå¯¹è±¡ã€‚å¯¹äºæµ®ç‚¹æ•°ï¼Œä¼šæˆªå–æˆæ•´æ•°ã€‚1234567891011&gt;&gt;&gt; print(int('-100'),int('0'),int('3'))-100 0 3&gt;&gt;&gt; int(7788)7788&gt;&gt;&gt; int(7.98)7&gt;&gt;&gt; int('2.33')Traceback (most recent call last): File &quot;&lt;pyshell#27&gt;&quot;, line 1, in &lt;module&gt; int('2.33')ValueError: invalid literal for int() with base 10: '2.33' è¯»å–binaryæ–‡ä»¶é€ä¸ªbyteè¯»å–ï¼Œæ³¨æ„ç”¨b''æ¥åˆ¤æ–­æ˜¯å¦è¯»åˆ°æ–‡ä»¶å°¾éƒ¨1234567891011@staticmethoddef convert_bin_to_csv(bin_file_path, csv_file_path): if not os.path.exists(bin_file_path): print(&quot;Binary file is not exist! &quot; + bin_file_path) return with open(bin_file_path, &quot;rb&quot;) as bin_f: cur_byte = bin_f.read(1) while cur_byte != b'': # Do stuff with byte. print(int.from_bytes(cur_byte, byteorder='big', signed=True)) cur_byte = bin_f.read(1) è¯»å–åˆ°çš„byteå¯ä»¥è½¬æ¢ä¸ºintï¼Œå‚è€ƒæ–‡æ¡£ è¿™é‡Œ cur_byte ç±»ä¼¼äº b'\\x08'1print(int.from_bytes(cur_byte, byteorder='big', signed=True)) ä»binä¸­è¯»å–æ•°æ®å¹¶å­˜å…¥CSVæ–‡ä»¶ä¸­å…ˆä»binä¸­è¯»å–byteï¼Œè§„å®šå¥½å‡ ä¸ªå­—èŠ‚å‡‘æˆ1ä¸ªæ•°å­—ã€‚æŒ‰æ¯è¡Œä¸€ä¸ªæ•°å­—çš„æ ¼å¼å†™å…¥CSVæ–‡ä»¶ã€‚ 123456789101112@staticmethoddef convert_bin_to_csv(bin_file_path, csv_file_path, byte_count=1, byte_order='big', digit_signed=True): if not os.path.exists(bin_file_path): print(&quot;Binary file is not exist! &quot; + bin_file_path) return with open(csv_file_path, &quot;w&quot;) as csv_f: with open(bin_file_path, &quot;rb&quot;) as bin_f: cur_byte = bin_f.read(byte_count) while cur_byte != b'': csv_f.write(str(int.from_bytes(cur_byte, byteorder=byte_order, signed=digit_signed)) + &quot;,\\n&quot;) cur_byte = bin_f.read(byte_count) binå­˜å‚¨çš„æ•°æ®æ ¼å¼ä¸€å®šè¦å•†é‡å¥½ã€‚","link":"/2016/12/27/Python/Python-rw_in_csv/"},{"title":"Android NDK ç¤ºä¾‹-è¿”å›å­—ç¬¦ä¸²ï¼Œæ•°ç»„ï¼ŒJavaå¯¹è±¡ï¼›å…¼å®¹æ€§é—®é¢˜","text":"Android Studio 2.2.3 åˆ›å»ºå·¥ç¨‹ NDKProj å·¥ç¨‹å‡†å¤‡åœ¨SmartAlgorithm.javaä¸­åŠ è½½äº†åº“æ–‡ä»¶123456java`-- com `-- rustfisher `-- ndkproj |-- MainActivity.java `-- SmartAlgorithm.javaJNIç›®å½•ï¼Œéœ€è¦mkæ–‡ä»¶ï¼Œå¤´æ–‡ä»¶å’Œæºæ–‡ä»¶ã€‚è¿™é‡Œå¤´æ–‡ä»¶å’Œæºæ–‡ä»¶æ•…æ„ä¸ç»Ÿä¸€æ–‡ä»¶åï¼Œä¹Ÿå¯å®ç°æ•ˆæœã€‚ä½†è¿˜æ˜¯å»ºè®®ç”¨åŒæ ·çš„æ–‡ä»¶åï¼Œæ–¹ä¾¿å®šä½ã€‚12345jni/|-- Android.mk|-- Application.mk|-- com_rustfisher_ndkproj_SmartAlgorithm.h`-- com_rustfisher_ndkproj_SmartAlgorithm_if_not_the_same.cpp NDKè¿”å›å€¼åŠ è½½SmartAlgorithmï¼›è¿™ä¸ªæ˜¯ç»Ÿä¸€æ ‡ç¤ºã€‚LOCAL_MODULE ä¸ APP_MODULES å‡ä¸ºæ­¤æ ‡ç¤ºã€‚NDKä¸­çš„æ–¹æ³•è¦å£°æ˜ä¸ºnativeã€‚1234567891011package com.rustfisher.ndkproj;public class SmartAlgorithm { static { System.loadLibrary(&quot;SmartAlgorithm&quot;); } public native String getMsg(); public native int add(int a,int b);}æ³¨æ„ï¼ŒJavaæ–‡ä»¶ç”Ÿæˆå¤´æ–‡ä»¶åï¼ŒJavaæ–‡ä»¶çš„è·¯å¾„ä¸èƒ½è½»æ˜“æ”¹åŠ¨ã€‚ ç¼–å†™Android.mkæ–‡ä»¶ï¼›ABI é€‰æ‹©allï¼Œç¼–è¯‘å‡ºæ”¯æŒå¤šä¸ªå¹³å°çš„soæ–‡ä»¶ã€‚å¡«å…¥æºæ–‡ä»¶çš„æ–‡ä»¶åã€‚123456LOCAL_PATH:= $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE := SmartAlgorithmTARGET_ARCH_ABI := allLOCAL_SRC_FILES := com_rustfisher_ndkproj_SmartAlgorithm_if_not_the_same.cppinclude $(BUILD_SHARED_LIBRARY) ç¼–å†™Application.mkæ–‡ä»¶ï¼ˆç½‘ä¸Šcopyæ¥çš„ï¼‰ã€‚åŒæ ·ABI é€‰æ‹©allã€‚1234567APP_PLATFORM := android-16APP_MODULES := SmartAlgorithmAPP_ABI := allAPP_STL := stlport_staticAPP_CPPFLAGS += -fexceptions# for using c++ features,you need to enable these in your MakefileAPP_CPP_FEATURES += exceptions rtti ä¿®æ”¹å·¥ç¨‹build.gradleæ–‡ä»¶ï¼Œæ·»åŠ jniçš„é…ç½®ã€‚123456sourceSets { main { jni.srcDirs = [] jniLibs.srcDirs = ['src/main/libs']// æŒ‡å®šsoåº“çš„ä½ç½® }} ç¼–è¯‘å‡ºå¤´æ–‡ä»¶ï¼Œå¾—åˆ° com_rustfisher_ndkproj_SmartAlgorithm.h 12Administrator@rust-PC /cygdrive/g/rust_proj/NDKProj/app/src/main/javajavah com.rustfisher.ndkproj.SmartAlgorithm å°†å¤´æ–‡ä»¶æ”¾åˆ°jniç›®å½•ä¸‹ï¼Œä¸æºæ–‡ä»¶ä¸€èµ·ã€‚ ç”Ÿæˆçš„å¤´æ–‡ä»¶ä¸è¦æ‰‹åŠ¨å»ä¿®æ”¹ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚1234567891011121314151617181920212223242526272829/* DO NOT EDIT THIS FILE - it is machine generated */#include &lt;jni.h&gt;/* Header for class com_rustfisher_ndkproj_SmartAlgorithm */#ifndef _Included_com_rustfisher_ndkproj_SmartAlgorithm#define _Included_com_rustfisher_ndkproj_SmartAlgorithm#ifdef __cplusplusextern &quot;C&quot; {#endif/* * Class: com_rustfisher_ndkproj_SmartAlgorithm * Method: getMsg* Signature: ()Ljava/lang/String;*/JNIEXPORT jstring JNICALL Java_com_rustfisher_ndkproj_SmartAlgorithm_getMsg (JNIEnv *, jobject);/* * Class: com_rustfisher_ndkproj_SmartAlgorithm * Method: add* Signature: (II)I*/JNIEXPORT jint JNICALL Java_com_rustfisher_ndkproj_SmartAlgorithm_add (JNIEnv *, jobject, jint, jint);#ifdef __cplusplus}#endif#endif ç¼–å†™æºæ–‡ä»¶ï¼Œå®ç°å¤´æ–‡ä»¶ä¸­çš„æ–¹æ³•ã€‚ä¸€ä¸ªæ˜¯è¿”å›å­—ç¬¦ä¸²ï¼Œä¸€ä¸ªæ˜¯åŠ æ³•ã€‚1234567891011121314151617181920#include &lt;jni.h&gt;#include &lt;string.h&gt;#include &lt;android/log.h&gt;#include &quot;com_rustfisher_ndkproj_SmartAlgorithm.h&quot;/* Already define in com_rustfisher_ndkproj_SmartAlgorithm.h, no need to extern C here.extern &quot;C&quot; { JNIEXPORT jstring JNICALL Java_com_rustfisher_ndkproj_SmartAlgorithm_getMsg(JNIEnv *env, jobject obj); JNIEXPORT jint JNICALL Java_com_rustfisher_ndkproj_SmartAlgorithm_add(JNIEnv *env, jobject obj, jint a, jint b);};*/JNIEXPORT jstring JNICALL Java_com_rustfisher_ndkproj_SmartAlgorithm_getMsg(JNIEnv *env, jobject obj) { return env-&gt;NewStringUTF(&quot;Hello from the JNI.&quot;);}JNIEXPORT jint JNICALL Java_com_rustfisher_ndkproj_SmartAlgorithm_add(JNIEnv *env, jobject obj, jint a, jint b) { return a + b;}//* ç„¶ååœ¨å‘½ä»¤è¡Œ ndk-buildã€‚è¿™é‡Œæ˜¯win7ä¸‹çš„Cygwinã€‚123456Administrator@rust-PC /cygdrive/g/rust_proj/NDKProj/app/src/main/jni$ ndk-build.cmd[all] Compile++ : SmartAlgorithm &lt;= com_rustfisher_ndkproj_SmartAlgorithm_if_not_the_same.cpp[all] SharedLibrary : libSmartAlgorithm.so[all] Install : libSmartAlgorithm.so =&gt; libs/arm64-v8a/libSmartAlgorithm.so# ...... åé¢è¿˜æœ‰å¾ˆå¤š åœ¨libsç›®å½•ä¸‹å‡ºç°äº†å¯¹åº”çš„soåº“12345678910111213141516171819Administrator@rust-PC /cygdrive/g/rust_proj/NDKProj/app/src/main/libs$ tree.|-- arm64-v8a| `-- libSmartAlgorithm.so|-- armeabi| `-- libSmartAlgorithm.so|-- armeabi-v7a| `-- libSmartAlgorithm.so|-- mips| `-- libSmartAlgorithm.so|-- mips64| `-- libSmartAlgorithm.so|-- x86| `-- libSmartAlgorithm.so`-- x86_64 `-- libSmartAlgorithm.so7 directories, 7 files åœ¨MainActivityä¸­è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚è¿è¡Œapkåˆ°æœºå™¨ä¸Šï¼ŒæŸ¥çœ‹logã€‚å‘ç°è°ƒç”¨æˆåŠŸã€‚ 12com.rustfisher.ndkproj D/MainActivity: onCreate: Hello from the JNI.com.rustfisher.ndkproj D/MainActivity: onCreate: 3 å¤„ç†æ•°ç»„çš„æ–¹æ³•1.ä¸è¦ç›´æ¥æ“ä½œè¾“å…¥çš„æ•°ç»„ï¼›2.æ³¨æ„é‡Šæ”¾æœ¬åœ°å¼•ç”¨ï¼Œé˜²æ­¢æº¢å‡ºã€‚ 1public native short[] getConvertedArray(short[] data, int dataLen); 12345678910111213141516JNIEXPORT jshortArray JNICALL Java_com_rustfisher_ndkproj_SmartAlgorithm_getConvertedArray(JNIEnv *env, jobject obj, jshortArray input, jint len) { jshort* inputPtr; inputPtr = env-&gt;GetShortArrayElements(input,0);// ç›´æ¥æ“ä½œæŒ‡é’ˆä¼šæ”¹å˜Android Dalvikä¸­çš„å€¼ jshort* resPtr; jshortArray result; result = env-&gt;NewShortArray(len);// åˆ›å»ºæ–°çš„æ•°ç»„ resPtr = env-&gt;GetShortArrayElements(result,0);// æŒ‡é’ˆ for(jint i = 0;i &lt; len;i++) { resPtr[i] = inputPtr[i] * 2; } env-&gt;ReleaseShortArrayElements(input, inputPtr, 0);// é‡Šæ”¾æœ¬åœ°å¼•ç”¨ env-&gt;SetShortArrayRegion(result,0,len,resPtr); // å­˜å…¥æ•°æ® env-&gt;ReleaseShortArrayElements(result, resPtr, 0); // é‡Šæ”¾æœ¬åœ°å¼•ç”¨ return result;// è¿”å›ç»“æœ} JNIå±‚ unsigned char ä¸ jbyte æ•°ç»„è½¬æ¢æœ¬ä¾‹è¯´æ˜çš„æ˜¯unsigned char ä¸ jbyteä¹‹é—´äº’ç›¸è½¬æ¢æ³¨æ„æ–¹æ³•ï¼š(*env)-&gt;SetByteArrayRegion(env, jbyte_arr, 0, len, uc_ptr);javaä»£ç 12345678910public byte[] getByteArrayFromJNI() { return nativeGetByteArray();}public byte[] byteArrayTravelJNI(byte[] input) { return nativeSendByteArray(input, input.length);}private native byte[] nativeGetByteArray(); // ä»JNIä¸­è·å–byteæ•°ç»„// è¾“å…¥byteæ•°ç»„ï¼Œåœ¨JNIä¸­è½¬æ¢åå†è·å–å›æ¥private native byte[] nativeSendByteArray(byte[] input, int len); JNI Cä»£ç 12345678910111213141516171819202122232425262728293031323334// return byte array from unsigned char array. jbytes: 1 2 0 7f 80 81 ff 0 1JNIEXPORT jbyteArray JNICALL Java_com_rustfisher_ndkalgo_NDKUtils_nativeGetByteArray(JNIEnv *env, jobject jObj){ unsigned char uc_arr[] = {1, -2, 0, 127, 128, 129, 255, 256, 257}; int uc_arr_len = sizeof(uc_arr) / sizeof(uc_arr[0]); jbyte byte_array[uc_arr_len]; int i = 0; for(;i &lt; uc_arr_len; i++) { byte_array[i] = uc_arr[i]; } jbyteArray jbyte_arr = (*env)-&gt;NewByteArray(env, uc_arr_len); (*env)-&gt;SetByteArrayRegion(env, jbyte_arr, 0, uc_arr_len, byte_array); return jbyte_arr;}// jbyte -&gt; unsigned char -&gt; jbyteJNIEXPORT jbyteArray JNICALL Java_com_rustfisher_ndkalgo_NDKUtils_nativeSendByteArray (JNIEnv *env, jobject jObj, jbyteArray input_byte_arr, jint input_len){ int len = (int)input_len; jbyte *jbyte_ptr = (*env)-&gt;GetByteArrayElements(env, input_byte_arr, 0); unsigned char *uc_ptr = (unsigned char *)jbyte_ptr; jbyteArray jbyte_arr = (*env)-&gt;NewByteArray(env, len); jbyte byte_array[input_len]; int i = 0; for(;i &lt; input_len; i++) { byte_array[i] = uc_ptr[i]; } (*env)-&gt;SetByteArrayRegion(env, jbyte_arr, 0, len, byte_array); (*env)-&gt;ReleaseByteArrayElements(env, input_byte_arr, jbyte_ptr, 0); return jbyte_arr;} å…³äºSetByteArrayRegionè¿™ä¸ªæ–¹æ³•æ–¹æ³•è¯´æ˜ï¼švoid SetXxxArrayRegion(JNIEnv *env, jarray array, jint start, jint length, Xxx elems[])å°†Cæ•°ç»„çš„å…ƒç´ å¤åˆ¶åˆ°Javaæ•°ç»„ä¸­ã€‚æ³¨æ„æœ€åä¸€ä¸ªå‚æ•°è¦å’Œå‰é¢çš„å¯¹åº”ä¸Šã€‚ void ReleaseXxxArrayElements(JNIEnv *env, jarray array, Xxx elems[], jint mode)é€šçŸ¥è™šæ‹Ÿæœºé€šè¿‡GetXxxArrayElementsè·å¾—çš„ä¸€ä¸ªæŒ‡é’ˆå·²ç»ä¸å†éœ€è¦äº†ã€‚Modeæ˜¯0ï¼Œæ›´æ–°æ•°ç»„å…ƒç´ åé‡Šæ”¾elemsç¼“å­˜ã€‚ åœ¨è¿™é‡Œé‡åˆ°è¿‡ä¸€ä¸ªbugï¼ŒåŒæ ·çš„ä»£ç åœ¨armeabiä¸Šæ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯åˆ°äº†v7aæˆ–v8aå¹³å°ä¸Šå°±é—ªé€€ã€‚ä½¿ç”¨SetXxxArrayRegionè¿™ä¸ªæ–¹æ³•æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ä¸€å®šè¦å’Œæ–¹æ³•åä¸­çš„Xxxå¯¹åº”ä¸Šè¯¦ç»†å¯ä»¥å‚è€ƒCore Javaä¸­çš„Java Nativeå’ŒAndroid Developä¸Šå…³äºabiçš„è§£é‡Š æµ‹è¯•è°ƒç”¨12345678NDKUtils ndkUtils = new NDKUtils();byte[] res = ndkUtils.getByteArrayFromJNI(); // ä»JNIä¸­è·å–byteæ•°ç»„logBytes(res);Log.d(TAG, &quot;-------------------------------------------------------------&quot;);byte[] inputBytes = new byte[]{1, 2, 127, (byte) 128, (byte) 255, -120};byte[] tRes = ndkUtils.byteArrayTravelJNI(inputBytes); // è®©byteæ•°ç»„åœ¨JNIä¸­æ—…æ¸¸ä¸€åœˆlogBytes(inputBytes);logBytes(tRes); è¾“å‡º1234bytes: 1 2 0 7f 80 81 ff 0 1 -------------------------------------------------------------bytes: 1 2 7f 80 ff 88 bytes: 1 2 7f 80 ff 88 ç›´æ¥æ“ä½œè¾“å…¥çš„æ•°ç»„ä»¥intæ•°ç»„ä¸ºä¾‹è¾“å…¥ä¸€ä¸ªæ•°ç»„åï¼Œè·å–æ•°ç»„ç„¶åç›´æ¥æ”¹å˜æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œæœ€åé‡Šæ”¾æ‰æœ¬åœ°å¼•ç”¨ 123456JNIEXPORT void JNICALL Java_com_rustfisher_ndkalgo_NDKUtils_nativeModifyArray (JNIEnv *env, jobject jObj, jintArray input_arr, jint input_len) { int * input_ptr = (*env)-&gt;GetIntArrayElements(env, input_arr, 0); input_ptr[input_len - 1] = input_ptr[input_len - 1] - 1; (*env)-&gt;ReleaseIntArrayElements(env, input_arr, input_ptr, 0); } 12345NDKUtils moUtil = new NDKUtils();int[] origin = new int[]{1, 2, 3, 4, 5, 6, 7};Log.d(TAG, &quot;origin before: &quot; + Arrays.toString(origin));moUtil.modifyArray(origin);Log.d(TAG, &quot;origin after: &quot; + Arrays.toString(origin)); è§‚å¯Ÿè¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œè¾“å…¥çš„æ•°ç»„ç›´æ¥è¢«æ”¹å˜äº†12origin before: [1, 2, 3, 4, 5, 6, 7]origin after: [1, 2, 3, 4, 5, 6, 6] æˆ–è€…12345678910JNIEXPORT void JNICALL Java_com_rustfisher_face_1detect_1lib_CalHelper_cvtNV21 (JNIEnv *env, jclass jcls, jbyteArray input_arr,jint in_arr_len, jbyteArray target_arr, jint nv21_size, jint y_size, jint yuv_gap) { jbyte *in_ptr = env-&gt;GetByteArrayElements(input_arr, false); jbyte *target_ptr = env-&gt;GetByteArrayElements(target_arr, false); for(int i = y_size; i &lt; nv21_size; i+=2){ target_ptr[i] = in_ptr[i + yuv_gap + 1]; target_ptr[i + 1] = in_ptr[i + yuv_gap]; } } è¿”å›Javaå¯¹è±¡NDKä¸­å¯ä»¥åˆ›å»ºJavaå¯¹è±¡å¹¶è¿”å›ã€‚ä¾‹å¦‚æˆ‘ä»¬æ–°å»ºä¸€ä¸ªJavaUserç±»ã€‚12345678910111213141516171819202122public class JavaUser { private int age; private String name; public JavaUser(int age, String name) { this.age = age; this.name = name; } public int getAge() { return age; } public String getName() { return name; } @Override public String toString() { return name + &quot;, &quot; + age; }} nativeæ–¹æ³•è¿”å›ä¸€ä¸ªJavaUserå¯¹è±¡12345678910111213public class NDKUtils { static { System.loadLibrary(&quot;NDKMan&quot;); } public JavaUser createUser(int age, String name) { return nativeGetUser(age, name); } private native JavaUser nativeGetUser(int age, String name);} cæ–‡ä»¶å®ç°ä»£ç ã€‚æ³¨æ„å‚æ•°ç­¾åçš„å†™æ³•ï¼Œè¦å‚ç…§æ ‡å‡†ã€‚1234567JNIEXPORT jobject JNICALL Java_com_rustfisher_ndkalgo_NDKUtils_nativeGetUser (JNIEnv *env, jobject jObj, jint age, jstring name){ jclass userClass = (*env)-&gt;FindClass(env, &quot;com/rustfisher/ndkalgo/JavaUser&quot;); jmethodID userConstruct = (*env)-&gt;GetMethodID(env, userClass, &quot;&lt;init&gt;&quot;, &quot;(ILjava/lang/String;)V&quot;); return (*env)-&gt;NewObject(env, userClass, userConstruct, age, name);} è°ƒç”¨nativeæ–¹æ³•ç”Ÿæˆå¯¹è±¡12345private void testJavaUserNDK() { NDKUtils ndkUtils = new NDKUtils(); JavaUser tom = ndkUtils.createUser(20, &quot;Tom&quot;); Log.d(TAG, tom.toString());} NDKå…¼å®¹æ€§é—®é¢˜Vivo x6plus å…¼å®¹æ€§é—®é¢˜ã€‚Vivo x6plus æ‰“å¼€Parrotç•Œé¢å³å´©æºƒã€‚ä½†æ˜¯Parrotå®˜æ–¹APPèƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ã€‚æˆ‘è‡ªå·±çš„soåº“ä¸Parrotçš„soåº“ä¸å…¼å®¹ï¼Œå‡ºç° 1234567java.lang.UnsatisfiedLinkError:dalvik.system.PathClassLoader[DexPathList[[zip file &quot;/data/app/com.xx.xx.xxx-1/base.apk&quot;],nativeLibraryDirectories=[/data/app/com.xx.xx.xxx-1/lib/arm64, /vendor/lib64, /system/lib64]]] couldn't find &quot;libjson.so&quot; at java.lang.Runtime.loadLibrary(Runtime.java:366) at java.lang.System.loadLibrary(System.java:988) at com.parrot.arsdk.ARSDK.loadSDKLibs(ARSDK.java:20) at com.parrot.sdk.activity.DronesListActivity.&lt;clinit&gt;(DronesListActivity.java:44) at java.lang.reflect.Constructor.newInstance(Native Method) åˆ†æå¤„ç†å…¼å®¹æ€§é—®é¢˜å°†Parrotå®˜æ–¹apkè§£åŒ…åï¼Œæ‰¾åˆ°soåº“æ–‡ä»¶ã€‚å‘ç°åªæœ‰x86ã€mipsã€armeabi_v7aã€armeabi è¿™4ä¸ªã€‚è€Œæˆ‘åŠ è½½äº†æœ‰æ›´å¤šçš„åº“ã€‚ å°†æˆ‘è‡ªå·±çš„soæ–‡ä»¶åˆ é™¤è‡³åªå‰©ä¸‹Parroté‚£4ä¸ªå³å¯ã€‚ Android.mkTARGET_ARCH_ABI := x86 mips armeabi armeabi-v7a åŒåsoæ–‡ä»¶å¼•èµ·UnsatisfiedLinkErrorä¸»å·¥ç¨‹appä¸­å¸¦æœ‰Cå·¥ç¨‹ä¸soæ–‡ä»¶ã€‚ç°éœ€è¦å°†æ‰€æœ‰çš„Cå·¥ç¨‹ç§»åˆ°æ–°çš„æ¨¡å—mylibä¸­ã€‚ æ–°å»ºæ¨¡å—mylibï¼Œå°†Cå·¥ç¨‹å¤åˆ¶è¿›æ¥ã€‚gradleä¸­é…ç½®jniï¼Œå› ä¸ºä¿®æ”¹äº†æ–‡ä»¶è·¯å¾„ï¼Œé‡æ–°ç”Ÿæˆå¤´æ–‡ä»¶å¹¶ä¿®æ”¹cppæ–‡ä»¶ã€‚åœ¨æ¨¡å—ä¸­è¿›è¡Œndk-buildï¼Œè·å¾—soåº“ã€‚ å®‰è£…è¿è¡Œappï¼Œå‡ºç°UnsatisfiedLinkErrorï¼š12java.lang.UnsatisfiedLinkError: No implementation found for void com.xx.jni.MyJNI.init(java.lang.String) (tried Java_com_xx_jni_MyJNI_init and Java_com_xx_jni_MyJNI_init__Ljava_lang_String_2)åˆ†æåŸå› ï¼Œappèƒ½å¤Ÿæ­£å¸¸åŠ è½½åº“æ–‡ä»¶ï¼Œä½†æœªæ‰¾åˆ°å®ç°æ–¹æ³•ã€‚appä½¿ç”¨çš„soåº“ï¼Œç©¶ç«Ÿæ˜¯ä¸æ˜¯æˆ‘ä»¬æŒ‡å®šçš„é‚£ä¸ªã€‚ å°è¯•è¿›è¡Œä¿®å¤ï¼ŒåŸappå·¥ç¨‹çš„Android.mkä¸­1LOCAL_MODULE := mainç§»åŠ¨åˆ°æ¨¡å—åï¼Œæ–°çš„Android.mkä¿®æ”¹ä¸º1LOCAL_MODULE := mynewmainåº“æ”¹äº†åå­—åï¼Œä¿®æ”¹Javaä»£ç 123static { System.loadLibrary(&quot;mynewmain&quot;);}é‡è£…appå³å¯æ­£å¸¸ä½¿ç”¨ã€‚ ç»è¿‡åˆ†æä¸å°è¯•ï¼Œåˆ é™¤åŸappå·¥ç¨‹ä¸­æ‰€æœ‰çš„soæ–‡ä»¶ï¼Œå†æ¬¡é‡è£…appå³å¯æ­£å¸¸è¿è¡Œã€‚ä¸éœ€è¦ä¿®æ”¹soåº“çš„åå­—ã€‚ é”™è¯¯åŸå› çŒœæƒ³ï¼šappä¸»å·¥ç¨‹ä¸æ¨¡å—mylibä¸­æœ‰åŒåçš„soæ–‡ä»¶ï¼Œå®‰è£…appæ—¶ä¼šä¼˜å…ˆä½¿ç”¨appä¸»å·¥ç¨‹ä¸­çš„soåº“ã€‚ jstringè½¬ä¸ºcharçš„æ–¹æ³• jstring -&gt; charjstringè½¬ä¸ºcharçš„æ–¹æ³•12345678910111213141516char *jstringToChar(JNIEnv *env, jstring jstr) { char *rtn = NULL; jclass clsstring = env-&gt;FindClass(&quot;java/lang/String&quot;); jstring strencode = env-&gt;NewStringUTF(&quot;GB2312&quot;); jmethodID mid = env-&gt;GetMethodID(clsstring, &quot;getBytes&quot;, &quot;(Ljava/lang/String;)[B&quot;); jbyteArray barr = (jbyteArray) env-&gt;CallObjectMethod(jstr, mid, strencode); jsize alen = env-&gt;GetArrayLength(barr); jbyte *ba = env-&gt;GetByteArrayElements(barr, JNI_FALSE); if (alen &gt; 0) { rtn = (char *) malloc(alen + 1); memcpy(rtn, ba, alen); rtn[alen] = 0; } env-&gt;ReleaseByteArrayElements(barr, ba, 0); return rtn;} å‚è€ƒ JNIä¸­string ã€ char* å’Œ jstring ä¸¤ç§è½¬æ¢ - CSDN xlxxcc","link":"/2016/08/02/Android/NDK-use_sample_1/"},{"title":"Android NDK åˆæ­¥","text":"å¼€å‘ç¯å¢ƒï¼š win7 64ï¼ŒAndroid Studio 2.1 éœ€è¦å·¥å…·ï¼šNDKï¼ŒCygwin ä½¿ç”¨adbæŸ¥çœ‹æ‰‹æœºCPUæ¶æ„ä¿¡æ¯å°†æ‰‹æœºé€šè¿‡USBè¿æ¥åˆ°ç”µè„‘ï¼Œadb shellè¿›å…¥æ‰‹æœºæ ¹ç›®å½•ï¼Œæ‰§è¡Œcat /proc/cpuinfo12345678910111213141516171819shell@hnCHE-H:/ $ cat /proc/cpuinfocat /proc/cpuinfoProcessor : AArch64 Processor rev 3 (aarch64)processor : 0processor : 1processor : 2processor : 3processor : 4processor : 5processor : 6processor : 7Features : fp asimd evtstrm aes pmull sha1 sha2 crc32CPU implementer : 0x41CPU architecture: AArch64CPU variant : 0x0CPU part : 0xd03CPU revision : 3Hardware : hi6210sftå¯ä»¥çœ‹åˆ°æ‰‹æœºå¤„ç†å™¨çš„ä¿¡æ¯ ä½¿ç”¨ SDK Manager é…ç½®å®‰è£… NDKæ·»åŠ ç³»ç»Ÿç¯å¢ƒå˜é‡ G:\\SDK\\ndk-bundle;G:\\SDK\\platform-tools ä¸‹è½½å¹¶å®‰è£…Cygwinï¼šhttps://cygwin.com/install.html Cygwin å®‰è£…NDKéœ€è¦çš„å·¥å…·åŒ…ï¼ˆå¦‚æœç¬¬ä¸€æ¬¡å®‰è£…æ—¶æ²¡æœ‰é€‰æ‹©å·¥å…·åŒ…ï¼Œå¯ä»¥å†æ¬¡å¯åŠ¨å®‰è£…ï¼‰ï¼šmake, gcc, gdb, mingw64-x86_64-gcc, binutils é…ç½®G:\\soft\\Cygwin\\home\\Administrator\\.bashrcï¼Œæ·»åŠ ä¸‹é¢çš„æŒ‡ä»¤ï¼Œä½¿ç”¨è‹±æ–‡ç•Œé¢ã€‚12export LANG='en_US'export LC_ALL='en_US.GBK'é…ç½®texté€‰é¡¹ï¼Œåœ¨optioné‡Œçš„textå¯è®¾ç½®ã€‚å¯ä»¥åœ¨G:\\soft\\Cygwin\\home\\Administrator\\.minttyrcä¸­çœ‹åˆ°ã€‚ 12Locale=zh_CNCharset=GBK è®¾ç½®å®Œå­—ä½“åå¯ä»¥é¿å…ä¸­æ–‡ä¹±ç ã€‚ é…ç½® G:\\soft\\Cygwin\\home\\Administrator\\.bash_profile 12NDK=/cygdrive/G/SDK/ndk-bundle/ndk-build.cmdexport NDK åœ¨Cygwinä¸­æŸ¥æ‰¾NDKä½ç½®ï¼Œå¯ä»¥çœ‹åˆ°åœ¨SDKç›®å½•é‡Œé¢ 123Administrator@rust-PC /cygdrive/g/soft/Cygwin/home/Administrator$ echo $NDK/cygdrive/G/SDK/ndk-bundle/ndk-build.cmd æ“ä½œç¤ºä¾‹NDKå·¥ç¨‹JDK10å·²ç»ä¸æä¾›javahè¿™ä¸ªå·¥å…·äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨asæ”¯æŒc++çš„åŠŸèƒ½ï¼›è¯¦æƒ…è§ä¸‹æ–‡ ç”Ÿæˆä¸€æ¬¡è¯•è¯•ã€‚ä»githubä¸Šè·å–android-ndk-android-mkï¼Œè¿›å…¥hello-jniå·¥ç¨‹ã€‚ 123Administrator@rust-PC /cygdrive/g/rust_proj/android-ndk-android-mk/hello-jni$ ndk-build.cmd# è¾“å‡ºå¾ˆå¤šä¿¡æ¯ ç¼–è¯‘æˆåŠŸåï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªlibsç›®å½•ï¼Œç¼–è¯‘ç”Ÿæˆçš„.soæ–‡ä»¶æ”¾åœ¨é‡Œé¢ã€‚ 1234567Administrator@rust-PC /cygdrive/g/rust_proj/NDKTest/app/src/main$ ndk-build.cmd[armeabi] Install : librust_ndk.so =&gt; libs/armeabi/librust_ndk.so# è¿›å…¥javaç›®å½•ï¼Œç¼–è¯‘.hæ–‡ä»¶Administrator@rust-PC /cygdrive/g/rust_proj/NDKTest/app/src/main/java$ javah com.rustfisher.ndktest.HelloJNI# ä¼šç”Ÿæˆä¸€ä¸ª.hæ–‡ä»¶ å°†å®ƒå¤åˆ¶åˆ°jniæ–‡ä»¶å¤¹ä¸‹ï¼›è¿™ä¸ªå°±æ˜¯JNIå±‚çš„ä»£ç ã€‚ Ubuntuä¸‹javahæŠ¥é”™ã€‚éœ€è¦æ·»åŠ å‚æ•° 1javah -cp /home/rust/Android/Sdk/platforms/android-25/android.jar:. com.example.LibUtil ä½¿ç”¨C/C++å®ç°JNIé‡åˆ°é”™è¯¯ï¼š Error:Execution failed for task â€˜:app:compileDebugNdkâ€™. Error: NDK integration is deprecated in the current plugin. Consider trying the new experimental plugin. For details, see http://tools.android.com/tech-docs/new-build-system/gradle-experimental. Set â€œandroid.useDeprecatedNdk=trueâ€ in gradle.properties to continue using the current NDK integration. è§£å†³åŠæ³•ï¼šåœ¨app\\build.gradleæ–‡ä»¶ä¸­æ·»åŠ 1234sourceSets.main { jniLibs.srcDir 'src/main/libs' jni.srcDirs = [] //disable automatic ndk-build call} æ–‡ä»¶æœ‰3ç§ï¼šæ¥å£æ–‡ä»¶.hï¼› å®ç°æ–‡ä»¶.cï¼Œæ³¨æ„ä¸å‰é¢çš„.hæ–‡ä»¶åŒåï¼› .hä¸.cç”Ÿæˆçš„åº“æ–‡ä»¶.so æ“ä½œæ­¥éª¤å°ç»“From Java to C/C++Step 1 å®šä¹‰Javaæ¥å£æ–‡ä»¶ï¼Œé‡Œé¢å®šä¹‰å¥½nativeæ–¹æ³•ã€‚Step 2 javahç”Ÿæˆ.hæ¥å£æ–‡ä»¶ ã€‚Step 3 å¤åˆ¶.hæ–‡ä»¶çš„æ–‡ä»¶åï¼Œç¼–å†™C/C++æ–‡ä»¶ã€‚æ³¨æ„è¦å®ç°.hä¸­çš„æ¥å£ã€‚ NDKé‡åˆ°çš„é—®é¢˜ä¸æ³¨æ„äº‹é¡¹æ–‡ä»¶å…³è”é—®é¢˜å†™cppæºæ–‡ä»¶çš„æ—¶å€™ï¼Œå¿˜è®°includeå¤´æ–‡ä»¶ã€‚äº§ç”Ÿjava.lang.UnsatisfiedLinkError: No implementation found for ä¹‹ç±»çš„é”™è¯¯stackoverflowä¸Šæœ‰å…³äºAndroid NDK C++ JNI (no implementation found for nativeâ€¦)çš„é—®é¢˜ã€‚ NDKæœ¬åœ°å¯¹è±¡æ•°é‡æº¢å‡ºé—®é¢˜ Local ref table overflowNDKæœ¬åœ°åªå…è®¸æŒæœ‰512ä¸ªæœ¬åœ°å¯¹è±¡ï¼Œreturnåä¼šé”€æ¯è¿™äº›å¯¹è±¡ã€‚å¿…é¡»æ³¨æ„ï¼Œåœ¨å¾ªç¯ä¸­åˆ›å»ºçš„æœ¬åœ°å¯¹è±¡è¦åœ¨ä½¿ç”¨åé”€æ¯æ‰ã€‚ 1env-&gt;DeleteLocalRef(local_ref);// local_ref æ˜¯æœ¬åœ°åˆ›å»ºçš„å¯¹è±¡ è°ƒç”¨Javaæ–¹æ³•æ—¶ï¼Œæ³¨æ„æŒ‡å®šè¿”å›å€¼env-&gt;CallBooleanMethod(resArrayList,arrayList_add, javaObject); ArrayListçš„addæ–¹æ³•è¿”å›Boolean å‚è€ƒï¼šhttps://www3.ntu.edu.sg/home/ehchua/programming/java/JavaNativeInterface.html C++è°ƒç”¨Cæ–¹æ³•C++æ–‡ä»¶ä¸­ï¼Œéœ€è¦è°ƒç”¨Cé‡Œé¢çš„æ–¹æ³•ã€‚å¦‚æœæœªç»ä»»ä½•å¤„ç†ï¼Œä¼šå‡ºç°æ— å¼•ç”¨é”™è¯¯1error: undefined reference to '...... å› æ­¤åœ¨C++æ–‡ä»¶ä¸­æ¶‰åŠåˆ°Cæ–¹æ³•ï¼Œéœ€è¦å£°æ˜ã€‚ä¾‹å¦‚12345678#ifdef __cplusplusextern &quot;C&quot; {#include &quot;c_file_header.h&quot;#ifdef __cplusplus}#endif#endif// ___ ç»“æŸå£°æ˜ javahç”Ÿæˆçš„JNIå¤´æ–‡ä»¶ä¸­ä¹Ÿæœ‰externï¼Œå¯ä½œä¸ºå‚è€ƒ NDKä¸­ä½¿ç”¨logcaté…ç½®ï¼šCygwinï¼Œ NDK 14.1â€¦å¯ä»¥åœ¨NDKä¸­ä½¿ç”¨logcatï¼Œæ–¹ä¾¿è°ƒè¯•éœ€è¦åœ¨mkæ–‡ä»¶ä¸­æ·»åŠ 1LOCAL_LDLIBS := -L$(SYSROOT)/usr/lib -llog ä»£ç ä¸­æ·»åŠ å¤´æ–‡ä»¶ï¼Œå³å¯è°ƒç”¨logcatçš„æ–¹æ³•1234#include &lt;android/log.h&gt;#define LOG_TAG &quot;rustApp&quot;__android_log_write(ANDROID_LOG_VERBOSE, LOG_TAG, &quot;My Log&quot;); æ­¤æ—¶ç¼–è¯‘å‡ºç°äº†é”™è¯¯ï¼š1234G:/SDK/ndk-bundle/build//../toolchains/x86_64-4.9/prebuilt/windows-x86_64/lib/gcc/x86_64-linux-android/4.9.x/../../../../x86_64-linux-android/bin\\ld: warning: skipping incompatible G:/SDK/ndk-bundle/build//../platforms/android-21/arch-x86_64/usr/lib/libc.a while searching for cG:/SDK/ndk-bundle/build//../toolchains/x86_64-4.9/prebuilt/windows-x86_64/lib/gcc/x86_64-linux-android/4.9.x/../../../../x86_64-linux-android/bin\\ld: error: treating warnings as errorsclang++.exe: error: linker command failed with exit code 1 (use -v to see invocation)make: *** [G:/openSourceProject/NDKAlgo/app/src/main/obj/local/x86_64/libNDKMan.so] Error 1 å‡ºç°äº†error: treating warnings as errorså¤„ç†æ–¹æ³•ï¼Œåœ¨mkæ–‡ä»¶ä¸­æ·»åŠ LOCAL_DISABLE_FATAL_LINKER_WARNINGS=trueå†æ¬¡ç¼–è¯‘å³å¯ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®å®šä¹‰ç®€åŒ–æ‰“logçš„å†™æ³•123456789#define LOG_TAG &quot;rustApp&quot;#define LOGV(...) __android_log_write(ANDROID_LOG_VERBOSE, LOG_TAG, __VA_ARGS__)#define LOGD(...) __android_log_print(ANDROID_LOG_DEBUG , LOG_TAG, __VA_ARGS__) #define LOGI(...) __android_log_print(ANDROID_LOG_INFO , LOG_TAG, __VA_ARGS__) #define LOGW(...) __android_log_print(ANDROID_LOG_WARN , LOG_TAG, __VA_ARGS__) #define LOGE(...) __android_log_print(ANDROID_LOG_ERROR , LOG_TAG, __VA_ARGS__) // è°ƒç”¨LOGV(&quot;This is my log&quot;); Android Studio 3 ä¸ºlibrary moduleæ·»åŠ C++æ”¯æŒasåœ¨æ–°å»ºprojectçš„æ—¶å€™å¯ä»¥é€‰æ‹©æ”¯æŒC++ï¼Œå¯ä»¥æ–°å»ºä¸€ä¸ªæ”¯æŒC++çš„é¡¹ç›®æ¥å‚è€ƒã€‚å¯ä»¥ä¸ç”¨è‡ªå·±javahæ¥ç”Ÿæˆå¤´æ–‡ä»¶ã€‚ åœ¨å·¥ç¨‹ä¸­æ–°å»ºandroid libraryï¼Œå°†CMakeLists.txtæ·»åŠ åˆ°æ¨¡å—ä¸­ã€‚è¿™é‡Œæ¨¡å—åæ˜¯native-lib12345678910111213141516171819202122232425cmake_minimum_required(VERSION 3.4.1)add_library( # Sets the name of the library. native-lib # Sets the library as a shared library. SHARED # Provides a relative path to your source file(s). src/main/cpp/native-lib.cpp src/main/cpp/imagetool.cpp)find_library( # Sets the name of the path variable. log-lib # Specifies the name of the NDK library that # you want CMake to locate. log )target_link_libraries( # Specifies the target library. native-lib # Links the target library to the log library # included in the NDK. ${log-lib} ) ä¿®æ”¹æ¨¡å—çš„build.gradle123456789101112131415161718192021222324252627282930android { compileSdkVersion 26 defaultConfig { minSdkVersion 19 targetSdkVersion 26 versionCode 1 versionName &quot;1.0&quot; testInstrumentationRunner &quot;android.support.test.runner.AndroidJUnitRunner&quot; // æ·»åŠ  externalNativeBuild { cmake { cppFlags &quot;&quot; } } } buildTypes { release { minifyEnabled false proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro' } } // æ·»åŠ  externalNativeBuild { cmake { path &quot;CMakeLists.txt&quot; } }} æ–°å»ºJavaæ–‡ä»¶å’ŒC++æ–‡ä»¶ï¼Œå¤§è‡´ç›®å½•å¦‚ä¸‹1234567891011main|-- AndroidManifest.xml|-- cpp| |-- imagetool.cpp // cppæ–‡ä»¶| `-- native-lib.cpp|-- java| `-- com| `-- example| `-- myclib| `-- ImageDetect.java // Javaæ–‡ä»¶`-- res ImageDetect.java123456789101112public class ImageDetect { static { System.loadLibrary(&quot;native-lib&quot;); } public static native void inputPath(String path); public static native String stringFromJNI(); public static native int getOne();} native-lib.cpp12345678910111213141516171819202122#include &lt;jni.h&gt;#include &lt;string&gt;extern &quot;C&quot; {JNIEXPORT jstringJNICALLJava_com_example_myclib_ImageDetect_stringFromJNI( JNIEnv *env, jobject /* this */) { std::string hello = &quot;In myclib Hello from C++&quot;; return env-&gt;NewStringUTF(hello.c_str());}JNIEXPORT jintJNICALLJava_com_example_myclib_ImageDetect_getOne( JNIEnv *env, jobject /* this */) { return 9257;}} imagetool.cpp12345678910111213#include &lt;jni.h&gt;#include &lt;string&gt;extern &quot;C&quot;JNIEXPORT voidJNICALLJava_com_example_myclib_ImageDetect_inputPath( JNIEnv *env, jobject /* this */jobj, jstring inputPath) { // just test return;} ç¼–è¯‘è¿è¡Œå³å¯ã€‚","link":"/2016/06/14/Android/NDK-use_sample_2/"},{"title":"ç›‘å¬è€…æ¨¡å¼ - åœ¨Javaä¸Androidä¸­çš„ä½¿ç”¨","text":"ç›‘å¬è€…æ¨¡å¼ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰èƒ½é™ä½å¯¹è±¡ä¹‹é—´è€¦åˆç¨‹åº¦ã€‚ä¸ºä¸¤ä¸ªç›¸äº’ä¾èµ–è°ƒç”¨çš„ç±»è¿›è¡Œè§£è€¦ã€‚ä¾¿äºè¿›è¡Œæ¨¡å—åŒ–å¼€å‘å·¥ä½œã€‚ä¸åŒæ¨¡å—çš„å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºè‡ªèº«çš„ä»£ç ã€‚ç›‘å¬è€…ç”¨æ¥ç›‘å¬è‡ªå·²æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œå½“æ”¶åˆ°è‡ªå·²æ„Ÿå…´è¶£çš„äº‹ä»¶æ—¶æ‰§è¡Œè‡ªå®šä¹‰çš„æ“ä½œã€‚åœ¨æŸäº›æ•°æ®å˜åŒ–æ—¶ï¼Œå…¶ä»–çš„ç±»åšå‡ºä¸€äº›å“åº”ã€‚å¤„ç†æ•°æ®ï¼ˆæˆ–è€…åˆ†å‘äº‹ä»¶ï¼‰çš„ç±»ä¸»åŠ¨æŠ•é€æ¶ˆæ¯ï¼Œæ„Ÿå…´è¶£çš„ç±»ä¸»åŠ¨â€œè®¢é˜…â€æ¶ˆæ¯ã€‚ ç›‘å¬è€…æ¨¡å¼åœ¨Androidä¸­æœ‰å¤§é‡çš„è¿ç”¨ï¼Œç›¸ä¿¡å¤§å®¶éƒ½ä¸ä¼šæ„Ÿåˆ°é™Œç”Ÿã€‚åœ¨Androidå¼€å‘ä¸­ï¼ŒButtonæ§ä»¶çš„ç‚¹å‡»äº‹ä»¶å°±æ˜¯ç›‘å¬è€…æ¨¡å¼æœ€å¸¸è§çš„ä¾‹å­ã€‚å½“Buttonè¢«ç‚¹å‡»ï¼Œæ‰§è¡Œäº† OnClickListener.onClickã€‚Activityä¸­ç»™è¿™ä¸ªButtonè®¾ç½®äº†è‡ªå·±å®ç°çš„OnClickListenerï¼Œå¹¶å¤å†™äº†onClickæ–¹æ³•ï¼Œå°±èƒ½æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œäº†ã€‚ Javaä»£ç å®ä¾‹ä¸‹é¢æ¥ç”¨Javaæ¥å®ç°ç›‘å¬è€…æ¨¡å¼ã€‚è¿™ä¸ªä¾‹å­æ˜¯ç»™â€œè®¡ç®—ç±»â€æŒç»­åœ°ä¼ å…¥æ•°æ®ï¼Œå¤„ç†å¥½æ•°æ®åï¼Œå‘å‡ºç»“æœã€‚æ„Ÿå…´è¶£çš„ç±»æ¥æ”¶ç»“æœã€‚2ä¸ªæ–‡ä»¶ï¼šAlgoCalculator.javaï¼›MainUser.java AlgoCalculator.javaæ˜¯è®¡ç®—éƒ¨åˆ†ï¼Œæ¥æ”¶æ•°æ®å¹¶è¿›è¡Œè®¡ç®—ã€‚å¹¶å°†ç»“æœä¼ é€’å‡ºå»ã€‚ MainUser.javaæ˜¯è°ƒç”¨æ–¹ï¼Œå°†åŸºæœ¬æ•°æ®ä¼ å…¥AlgoCalculatorå¹¶ç›‘å¬ç»“æœã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344package com.algo;import java.util.LinkedList;import java.util.List;public class AlgoCalculator { private List&lt;short[]&gt; mDataBuffer = new LinkedList&lt;&gt;(); public AlgoCalculator() { } // å®šä¹‰ä¸€ä¸ªListeneræ¥å£ï¼›å¯å°†ä¸€ä¸ªbooleanå€¼ä¼ é€’å‡ºå» public interface ResultChangeListener { void onChange(boolean found); } private ResultChangeListener resultChangeListener; // è°ƒç”¨æ–¹èƒ½å¤Ÿè®¾ç½®å¹¶å®ç°è¿™ä¸ªæ¥å£ public void setResultChangedListener(ResultChangeListener resultChangedListener) { this.resultChangeListener = resultChangedListener; } // ä¼ è¾“æ•°æ® public void setDataStream(short[] data) { checkData(data);// å¤„ç†æ•°æ®æ–¹æ³• } // å¤„ç†æ•°æ®ï¼Œå¹¶é€å‡ºç»“æœ private void checkData(short[] data) { if (data.length == 0) { return; } long sum = 0; for (short b : data) { sum += b; } if (sum &gt; 40) { resultChangeListener.onChange(true); // æ•°æ®å¤„ç†ç»“æœ } else { resultChangeListener.onChange(false); } }} ä¸»ç¨‹åºï¼›è°ƒç”¨æ–¹ä¼ å…¥æ•°æ®ï¼Œè·å–ç»“æœ123456789101112131415161718192021222324import com.algo.AlgoCalculator;public class MainUser { public static void main(String[] args) { AlgoCalculator algoCalculator = new AlgoCalculator(); // åˆå§‹åŒ– // è®¾ç½®ç›‘å¬å™¨ï¼Œå¹¶åœ¨é‡Œé¢å¢åŠ è¦æ‰§è¡Œçš„åŠ¨ä½œ algoCalculator.setResultChangedListener(new AlgoCalculator.ResultChangeListener() { @Override public void onChange(boolean found) { System.out.println(&quot;result: &quot; + found); } }); short[] data1 = {1, 2, 3,}; short[] data2 = {10, 20, 30}; short[] data3 = {6, 7, 8}; short[] data4 = {1, 1, 1}; // ä¼ å…¥æ•°æ® algoCalculator.setDataStream(data1); // output false algoCalculator.setDataStream(data2); // output true algoCalculator.setDataStream(data3); // output false algoCalculator.setDataStream(data4); // output false }}åœ¨å¦å¤–çš„ç±»é‡Œï¼Œèƒ½å¤Ÿå¾ˆæ–¹ä¾¿åœ°è°ƒç”¨AlgoCalculatorçš„è®¡ç®—èƒ½åŠ›å¹¶è·å–è®¡ç®—ç»“æœã€‚åœ¨è¿™é‡Œï¼Œæ¯ä¼ å…¥ä¸€æ¬¡æ•°æ®ï¼Œå°±èƒ½è·å–ä¸€ä¸ªç»“æœã€‚å¦‚æœæ¯ç§’é’Ÿä¼ å…¥ä¸€æ¬¡æ•°æ®ï¼Œæ¯ç§’é’Ÿå°±èƒ½è·å–ä¸€ä¸ªç»“æœã€‚æˆ‘ä»¬å¯ä»¥æŠŠå¤æ‚çš„ç®—æ³•å°è£…èµ·æ¥ï¼Œå®¢æˆ·ç«¯åªéœ€è¦ä¼ å…¥æ•°æ®ï¼Œå³å¯è·å¾—ï¼ˆç›‘å¬åˆ°ï¼‰ç»“æœã€‚ å¾ˆå¤šåœºæ™¯ä¸­éƒ½ä½¿ç”¨äº†ç›‘å¬è€…æ¨¡å¼ã€‚å¼€å‘è€…ä¹Ÿå¯èƒ½åœ¨ä¸çŸ¥ä¸è§‰ä¸­å°±è¿ç”¨äº†è¿™ä¸ªæ¨¡å¼ã€‚ Androidä¸­ä½¿ç”¨ç›‘å¬å™¨æœ€å¸¸è§çš„ä¾‹å­æ˜¯ç»™Buttonè®¾ç½®ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ã€‚ç±»ä¼¼ä¸Šä¸ªä¾‹å­ï¼Œè®¾è®¡ä¸€ä¸ªæ¥å£å½“åšç›‘å¬å™¨ã€‚Androidä¸­å›è°ƒæ—¶å¯ä»¥åˆ©ç”¨handlerï¼Œæ§åˆ¶è°ƒç”¨çš„çº¿ç¨‹ã€‚123456789101112131415private Handler mMainHandler;mMainHandler = new Handler(Looper.getMainLooper());// åœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œprivate void notifySthChange(final int state) { mMainHandler.post(new Runnable() { @Override public void run() { ArrayList&lt;SListener&gt; list = new ArrayList&lt;&gt;(mListeners); for (SListener l : list) { l.OnSthChanged(state); } } });}åœ¨å›è°ƒä¸­å¯ä»¥ç›´æ¥æ›´æ–°UIã€‚","link":"/2016/05/16/DesignPattern/Listener_pattern_practice_in_Java_Android/"},{"title":"aboutView å¼€å‘è®°å½•","text":"å·¥ç¨‹åœ°å€ https://github.com/RustFisher/aboutView è™šæ‹Ÿé”®ç›˜ - VKeyboardVKeyboard - Virtual keyboard å®šä¹‰æŒ‰é”®ç±»å®šä¹‰Keyç±»ï¼Œä»£è¡¨æŒ‰é”®ã€‚å±æ€§æœ‰asciiç ï¼Œæ˜¯å¦ä½¿ç”¨TextViewï¼Œæ˜¯å¦ä½¿ç”¨ImageViewï¼ŒæŒ‰é”®ç±»åˆ«ï¼ˆåŠŸèƒ½é”®ï¼Œæ™®é€šé”®ï¼‰ç­‰ã€‚ 123456public static class Key { private int keyType; // æŒ‰é”®ç§ç±» æ˜¯æ™®é€šæŒ‰é”®æˆ–è€…æ˜¯åŠŸèƒ½æŒ‰é”® private int uiType = UI_TEXT_VIEW; // UIä½¿ç”¨çš„Viewç±»å‹ private String keyText; // æ˜¾ç¤ºçš„æ–‡å­— // ....} UIæ§åˆ¶å™¨å®ç°å®ç°ä¸€ä¸ªè™šæ‹Ÿé”®ç›˜ã€‚é‡‡ç”¨ç»™LinearLayoutæ·»åŠ å­viewçš„æ–¹å¼ã€‚åšä¸€ä¸ªUIæ§åˆ¶å™¨ï¼ˆWidgetï¼‰ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªLinearLayoutä½œä¸ºæ ¹viewã€‚æ ¹æ®è®¾ç½®çš„é”®ç›˜å®½åº¦åŠ¨æ€è°ƒæ•´æ¯ä¸ªæŒ‰é”®çš„å¤§å°ã€‚ è¿™ç§æ–¹å¼ä¸å¤ªé€‚åˆç»„ä»¶åŒ–ã€‚ åˆ›å»ºç»„ä»¶çš„æ–¹å¼å°†ã€ŒæŒ‰é”®ã€è£…é…åˆ°é”®ç›˜ä¸Šã€‚é‡‡ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œå°†Viewæ·»åŠ åˆ°ViewGroupä¸­ã€‚ VKeyä»£è¡¨æŒ‰é”®ï¼ŒVKeyboardBodyä»£è¡¨é”®ç›˜ï¼ŒVRowä»£è¡¨é”®ç›˜ä¸Šçš„ä¸€è¡Œï¼ŒVKeyboardListeneræ˜¯ç›‘å¬å™¨ã€‚VKeyboardç»§æ‰¿Framelayoutï¼Œåˆ›å»ºé€‚é…å™¨VKeyboard.Adapterï¼Œå°†ã€ŒæŒ‰é”®ã€è£…é…åˆ°é”®ç›˜ä¸Šã€‚ VKey - æŒ‰é”®ä»£è¡¨æŒ‰é”®ã€‚è£…è½½ç€keyCodeï¼ŒèƒŒæ™¯èµ„æºç­‰ç­‰å±æ€§å€¼ã€‚ VKeyboardBody - é”®ç›˜ä»£è¡¨é”®ç›˜çš„æ˜¾ç¤ºæ ·å¼ã€‚æ¯”å¦‚UIçš„paddingå€¼å’Œmarginå€¼ã€‚ VRow - è¡Œä¸€è¡ŒæŒ‰é”®ã€‚å®é™…ä¸Šæ˜¯ä¸€ä¸ªLinearLayoutçš„å±æ€§å€¼åˆé›†ã€‚ VKeyboardListener - ç›‘å¬å™¨äº‹ä»¶ç›‘å¬å™¨ã€‚ä¾‹å¦‚ç‚¹å‡»äº‹ä»¶ç­‰ç­‰ã€‚ VKeyboard - é”®ç›˜UIç±»å®é™…ä¸Šç»§æ‰¿äº†FrameLayoutã€‚é€šè¿‡VKeyboard.Adapterè·å–åˆ°é”®ç›˜çš„æŒ‰é”®é…ç½®ä¿¡æ¯ã€‚åˆ›å»ºå¯¹åº”çš„å­Viewï¼Œå¹¶æ·»åŠ åˆ°FrameLayoutä¸­ã€‚ VKeyboardæ„é€ å‡½æ•°æ„é€ å‡½æ•°ä¸­æœ‰AttributeSetã€‚attrsé‡Œé¢æœ‰idï¼Œlayout_widthï¼Œlayout_heightç­‰ç­‰ä¿¡æ¯ã€‚ æƒ³åœ¨Viewçš„æ„é€ å™¨ä¸­è·å–åˆ°å®šä¹‰ä¸­xmlä¸­çš„å±æ€§ï¼Œéœ€è¦ä»AttributeSetä¸­è·å–ã€‚å¯èƒ½ä¼šè·å–åˆ°-1æˆ–-2ï¼Œåˆ†åˆ«ä»£è¡¨MATCH_PARENTå’ŒWRAP_CONTENTã€‚å› æ­¤è¦åˆ¤æ–­è·å–åˆ°çš„æ•°å­—æ˜¯å¦å¤§äº0ï¼Œå¦‚æœå¤§äº0åˆ™è¡¨æ˜æ˜¯ä¸€ä¸ªæŒ‡å®šçš„å®½åº¦ï¼Œç›´æ¥è®°ä¸‹è¿™ä¸ªå®½åº¦å€¼ã€‚è·å–åˆ°xmlä¸­æŒ‡å®šçš„å®½åº¦åï¼Œå†è®¡ç®—å­viewçš„å®½åº¦ã€‚12345678910111213141516public VKeyboard(@NonNull Context context, @Nullable AttributeSet attrs, int defStyleAttr) { super(context, attrs, defStyleAttr); int[] attrsArray = new int[]{ android.R.attr.id, // 0 android.R.attr.background, // 1 android.R.attr.layout_width, // 2 android.R.attr.layout_height // 3 }; final TypedArray a = context.obtainStyledAttributes(attrs, attrsArray); int layoutWidth = a.getLayoutDimension(2, ViewGroup.LayoutParams.MATCH_PARENT); if (layoutWidth &gt; 0) { keyboardWidthPx = layoutWidth; } a.recycle(); initKeyboardUI(context);} å‚è€ƒ https://stackoverflow.com/questions/8037101/how-to-get-attributeset-properties12345678910111213141516public MapView(Context context, AttributeSet attrs) { // ... int[] attrsArray = new int[] { android.R.attr.id, // 0 android.R.attr.background, // 1 android.R.attr.layout_width, // 2 android.R.attr.layout_height // 3 }; TypedArray ta = context.obtainStyledAttributes(attrs, attrsArray); int id = ta.getResourceId(0 /* index of attribute in attrsArray */, View.NO_ID); Drawable background = ta.getDrawable(1); int layout_width = ta. getLayoutDimension(2, ViewGroup.LayoutParams.MATCH_PARENT); int layout_height = ta. getLayoutDimension(3, ViewGroup.LayoutParams.MATCH_PARENT); ta.recycle();} ç»™Keyboardæ·»åŠ æŒ‰é”®ï¼ˆkeyï¼‰ã€‚åœ¨activity onCreateçš„æ—¶å€™ï¼ŒKeyboardå·²ç»æ‰§è¡Œäº†æ„é€ å‡½æ•°ã€‚ä¹‹åæˆ‘ä»¬é€šè¿‡setAdapterçš„æ–¹å¼ç»™å®ƒæ·»åŠ keyã€‚","link":"/2015/12/25/Dev-note/dev-note-aboutView/"},{"title":"awkå‘½ä»¤çš„ä½¿ç”¨","text":"Ubuntu14.04 ç›®çš„ï¼šæƒ³ç”¨awkæ¥ç»Ÿè®¡æŸä¸ªæ–‡æœ¬ä¸­å•è¯å‡ºç°çš„æ¬¡æ•°ï¼Œå¹¶ä»¥ä¸€å®šçš„æ ¼å¼è¾“å‡ºç»“æ„é€šå¸¸ï¼Œawké€è¡Œå¤„ç†æ–‡æœ¬ã€‚awkæ¯æ¥æ”¶æ–‡ä»¶çš„ä¸€è¡Œï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„å‘½ä»¤æ¥å¤„ç†ã€‚ ç”¨legalæ–‡ä»¶æ¥åšç¤ºä¾‹12345678$ cat /etc/legalThe programs included with the Ubuntu system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted byapplicable law. æœç´¢ç»Ÿè®¡å•è¯â€œlawâ€çš„ä¸ªæ•°12$ awk -F : '/law/{count++} END{print &quot;the count is &quot;,count}' /etc/legalthe count is 1 ç»Ÿè®¡å•è¯â€œtheâ€çš„ä¸ªæ•°12$ awk -F : '/the/{count++} END{print &quot;the count is &quot;,count}' /etc/legalthe count is 3 æ‰¾åˆ°æŒ‡å®šå•è¯ï¼Œè‡ªå®šä¹‰å˜é‡countè‡ªå¢ï¼Œæœ€åè¾“å‡ºè¯­å¥å’Œcountå€¼ å‘½ä»¤sortï¼ŒæŠŠå„è¡ŒæŒ‰é¦–å­—æ¯æ’åˆ—é¡ºåºé‡æ–°æ’åˆ—èµ·æ¥ sort -nrï¼Œæ¯è¡Œéƒ½ä»¥æ•°å­—å¼€å¤´ï¼ŒæŒ‰æ•°å­—ä»è¾¾åˆ°å°ï¼Œæ’åˆ—å„è¡Œ uniq -cï¼Œç»Ÿè®¡å„è¡Œå‡ºç°çš„æ¬¡æ•°ï¼Œå¹¶æŠŠæ¬¡æ•°æ‰“å°åœ¨æ¯è¡Œå‰ç«¯ awkå‚æ•° NF - æµè§ˆè®°å½•çš„åŸŸçš„ä¸ªæ•° ç»¼åˆèµ·æ¥ï¼Œå‘½ä»¤å°±æ˜¯12awk -F' ' '{for(i=1;i&lt;=NF;i=i+1){print $i}}' /etc/legal |sort|uniq -c|sort -nr|awk -F' ' '{printf(&quot;%s %s\\n&quot;,$2,$1)}'ç»Ÿè®¡/etc/legalä¸­å•è¯å‡ºç°æ¬¡æ•°ï¼Œå¹¶ä»¥â€œå•è¯ æ¬¡æ•°â€æ ¼å¼è¾“å‡ºç»“æœ","link":"/2015/12/16/Linux/awk-use/"},{"title":"grep æœç´¢å­—ç¬¦ä¸²","text":"grep æœç´¢ï¼Œæ€æ ·æ’é™¤æŸäº›ç›®å½•ï¼Ÿä½¿ç”¨ --exclude-dir é€‰é¡¹ã€‚ è¯­æ³•:1--exclude-dir=DIR Exclude directories matching the pattern DIR from recursive searches. å•ä¸ªç›®å½•ç¤ºä¾‹-Ræ˜¯è¡¨ç¤ºå¯ç”¨æ­£åˆ™1grep -E &quot;http&quot; ./ -R --exclude-dir=.git å¤šä¸ªç›®å½•ç¤ºä¾‹1grep -E &quot;http&quot; . -R --exclude-dir={.git,res,bin} å¤šä¸ªæ–‡ä»¶ç¤ºä¾‹æ’é™¤æ‰©å±•åä¸º java å’Œ js çš„æ–‡ä»¶1grep -E &quot;http&quot; . -R --exclude=*.{java,js} æ’é™¤æ‰©å±•åä¸º javaï¼Œmd~ å’Œ js çš„æ–‡ä»¶123~/wd/rustNote/Linux_note$ grep -E DIR -R --exclude=*.{java,js,md~}grep_note.md: --exclude-dir=DIRgrep_note.md: Exclude directories matching the pattern DIR from recursive searches. æ’é™¤æ‰©å±•åä¸ºjavaï¼Œ js å’Œ md~ çš„æ–‡ä»¶ æ’é™¤ä¸€äº›æ–‡ä»¶ï¼Œå¹¶ä¸”æ˜¾ç¤ºè¡Œå·-n1grep -n -E &quot;org/webrtc/&quot; . -R --exclude=*.{java,ninja,TOC,so,o,jar} å¦‚ä½•åœ¨ Linux ç³»ç»Ÿå’Œç±» Unix çš„æ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨å¸¦æ­£åˆ™è¡¨è¾¾å¼çš„ grep å‘½ä»¤å‘¢ï¼ŸLinux ç³»ç»Ÿè‡ªå¸¦äº†æ”¯æŒæ‹“å±•æ­£åˆ™è¡¨è¾¾å¼çš„ GNU ç‰ˆæœ¬ grep å·¥å…·ã€‚æ‰€æœ‰çš„ Linux ç³»ç»Ÿä¸­é»˜è®¤å®‰è£…çš„éƒ½æ˜¯ GNU ç‰ˆ grep ã€‚grep å‘½ä»¤è¢«ç”¨æ¥æ£€ç´¢ä¸€å°æœåŠ¡å™¨æˆ–å·¥ä½œç«™ä¸Šä»»ä½•ä½ç½®çš„æ–‡æœ¬ä¿¡æ¯ã€‚ å¿«é€Ÿäº†è§£æ­£åˆ™è¡¨è¾¾å¼å¦‚ä½•åŒ¹é…ä½ è¦æŸ¥æ‰¾çš„å†…å®¹ï¼Ÿæ­£åˆ™è¡¨è¾¾å¼åªä¸è¿‡æ˜¯æ¯ä¸ªè¾“å…¥è¡ŒåŒ¹é…çš„æ¨¡å¼ã€‚æ¨¡å¼æ˜¯ä¸€ä¸ªå­—ç¬¦åºåˆ—ã€‚ä¸‹é¢éƒ½æ˜¯èŒƒä¾‹ï¼š ä¾‹å¦‚ï¼š^w1â€ã€â€œw1|w2â€ã€â€œ[^ ]ã€‚ åœ¨ /etc/passswd ä¸­æ£€ç´¢ vivek ï¼š grep vivek /etc/passwd è¾“å‡ºç»“æœæ¡ˆä¾‹ï¼š123vivek:x:1000:1000:Vivek Gite,,,:/home/vivek:/bin/bashvivekgite:x:1001:1001::/home/vivekgite:/bin/shgitevivek:x:1002:1002::/home/gitevivek:/bin/shåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½æœç´¢ â€˜vivekâ€™ (å³ä¸åŒºåˆ†å¤§å°)ï¼šgrep -i -w vivek /etc/passwdä¸åŒºåˆ†å¤§å°å†™åœ°æ£€ç´¢ â€˜vivekâ€™ å’Œ â€˜rajâ€™ ï¼š grep -E -i -w 'vivek|raj' /etc/passwdåœ¨æœ€åä¸€ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨äº†æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å¼ã€‚ å›ºå®šæ£€ç´¢å†…å®¹çš„ä½ç½®ï¼šä½ å¯ä»¥ä½¿ç”¨ ^ å’Œ $ ç¬¦å·å¼ºåˆ¶ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åˆ†åˆ«åŒ¹é…ä¸€è¡Œçš„å¼€å§‹æˆ–ç»“æŸçš„ä½ç½®ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºä»¥ â€˜vivekâ€™ å¼€å¤´çš„æ–‡æœ¬ï¼š grep ^vivek /etc/passwdè¾“å‡ºç»“æœç¤ºä¾‹ï¼š12vivek:x:1000:1000:Vivek Gite,,,:/home/vivek:/bin/bashvivekgite:x:1001:1001::/home/vivekgite:/bin/sh ä»¥#!å¼€å¤´çš„è¡Œ123rust@rust-pc:~/note/Linux_note$ grep '^#!' *organize_so_names.sh:#! /bin/shsort_ranking_solution.md:#! /bin/sh ä½ å¯ä»¥åªæ˜¾ç¤ºä»¥ vivek å¼€å¤´çš„æ–‡æœ¬è¡Œã€‚ä¸¾ä¾‹è¯´å°±æ˜¯ä¸æ˜¾ç¤º vivekgite , vivekg è¿™æ ·å•è¯å¼€å¤´çš„ã€‚grep -w ^vivek /etc/passwd æ£€ç´¢ä»¥ â€˜fooâ€™ ç»“å°¾çš„æ–‡æœ¬æ ¼å¼ï¼šgrep 'foo$' FILENAME ä½ è¿˜å¯ä»¥ç”¨ä¸‹é¢è¿™æ ·çš„æ–¹å¼æœç´¢ç©ºç™½è¡Œï¼šgrep '^$' FILENAME å¦‚ä½•åŒ¹é…å…·ä½“å­—ç¬¦ï¼ŸåŒ¹é… â€˜Vivekâ€™ æˆ– â€˜vivekâ€™ ï¼šgrep '[vV]ivek' FILENAME æˆ–è€…å¯ä»¥è¿™æ ·ï¼šgrep '[vV][iI][Vv][Ee][kK]' FILENAME ä½ å¯ä»¥åŒ¹é…æ•°å­—ï¼ˆä¾‹å¦‚åŒ¹é… vivek1 æˆ– Vivek2 ï¼‰ï¼šgrep -w '[vV]ivek[0-9]' FILENAME ä½ å¯ä»¥åŒ¹é…ä¸¤ä½æ•°ï¼ˆä¾‹å¦‚åŒ¹é… foo11 ï¼Œ foo12 ï¼‰ï¼šgrep 'foo[0-9][0-9]' FILENAME ä¸ä»…ä»…æ˜¯æ•°å­—ï¼Œä½ å¯ä»¥åŒ¹é…å­—æ¯ï¼šgrep '[A-Za-z]' FILENAME æ˜¾ç¤ºæ‰€æœ‰åŒ…å« â€œwâ€ æˆ– â€œnâ€ å­—æ¯çš„æ–‡æœ¬è¡Œï¼šgrep [wn] FILENAME åœ¨æ‹¬å·å†…çš„è¡¨è¾¾å¼ä¸­ï¼Œåœ¨â€œ [: â€å’Œâ€œ :] â€ä¸­æ‰€é™„çš„å­—ç¬¦ç±»çš„åç§°ï¼šä»£è¡¨å±äºè¯¥ç±»çš„æ‰€æœ‰å­—ç¬¦çš„åˆ—è¡¨ã€‚æ ‡å‡†å­—ç¬¦ç±»åç§°ï¼š [:alnum:] â€“ å­—æ¯æ•°å­—å­—ç¬¦ [:alpha:] â€“ å­—æ¯é¡ºåº [:blank:] â€“ ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦ [:digit:] â€“ æ•°å­—ï¼š â€˜0 1 2 3 4 5 6 7 8 9â€™ [:lower:] â€“ å°å†™å­—æ¯ï¼šâ€˜a b c d e f â€™ [:space:] â€“ ç‰¹æ®Šå­—ç¬¦ï¼šåˆ¶è¡¨ç¬¦ï¼Œæ¢è¡Œç¬¦ï¼Œå‚ç›´åˆ¶è¡¨ç¬¦ã€æ¢é¡µï¼Œå›è½¦ï¼Œå’Œç©ºé—´ [:upper:] â€“ å¤§å†™å­—æ¯ï¼šâ€˜A B C D E F G H I J K L M N O P Q R S T U V W X Y Zâ€™ åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼ŒåŒ¹é…æ‰€æœ‰å¤§å†™å­—æ¯ï¼šgrep '[:upper:]' FILENAME å¦‚ä½•ä½¿ç”¨é€šé…ç¬¦ï¼Ÿä½ å¯ä»¥ç”¨ â€œ.â€ æ¥ä»£æ›¿å•ä¸ªå­—ç¬¦ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒæŸ¥è¯¢äº†æ‰€æœ‰ä»¥å­—æ¯ â€œbâ€ å¼€å¤´ã€å­—æ¯ â€œtâ€ ç»“å°¾çš„ä¸‰ä¸ªå­—ç¬¦çš„å•è¯ã€‚grep '\\&lt;b.t\\&gt;' FILENAMEåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ\\&lt; åœ¨å•è¯çš„å¼€å§‹ä½ç½®åŒ¹é…ç©ºæ ¼å­—ç¬¦ä¸²\\&gt; åœ¨å•è¯çš„ç»“å°¾åŒ¹é…ç©ºæ ¼å­—ç¬¦ä¸²æ£€ç´¢å¹¶è¾“å‡ºæ‰€æœ‰ä¸¤ä¸ªå­—æ¯çš„ç»“æœï¼šgrep '^..$' FILENAMEæ£€ç´¢å¹¶æ˜¾ç¤ºæ‰€æœ‰ä»¥ â€˜.â€™ å’Œæ•°å­—å¼€å¤´çš„ç»“æœï¼šgrep '^\\.[0-9]' FILENAMEè½¬ä¹‰å­—ç¬¦â€™.â€™æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾ IP åœ°å€ 192.168.1.254 å°†ä¸èƒ½è·å¾—é¢„æœŸçš„ç»“æœï¼šgrep '192.168.1.254' /etc/hostså…¶ä¸­ä¸‰ä¸ªç‚¹éƒ½éœ€è¦è¢«è½¬ä¹‰ï¼šgrep '192\\.168\\.1\\.254' /etc/hosts ä»¥ä¸‹ç¤ºä¾‹å°†åªåŒ¹é…ä¸€ä¸ªåœ°å€ï¼šegrep '[[:digit:]]{1,3}\\.[[:digit:]]{1,3}\\.[[:digit:]]{1,3}\\.[[:digit:]]{1,3}' FILENAME ä»¥ä¸‹å°†ä¸åˆ†å¤§å°å†™åœ°åŒ¹é…å•è¯ Linux æˆ– Unix ï¼šegrep -i '^(linux|unix)' FILENAME æ·±å…¥æ¢ç´¢ grep é«˜çº§æŸ¥æ‰¾æ¨¡å¼å¦‚ä½•æ£€ç´¢ä¸€ä¸ªå…·æœ‰ä»¥ â€˜-â€˜ å¼€å¤´çš„çš„æ¨¡å¼ï¼Ÿä½¿ç”¨ -e é€‰é¡¹æœç´¢æ‰€æœ‰åŒ¹é… â€˜â€“testâ€“â€˜ çš„ç»“æœã€‚grep ä¼šå°è¯•æŠŠ â€˜â€“testâ€“â€˜ ä½œä¸ºä¸€ä¸ªé€‰é¡¹è§£æï¼šgrep -e '--test--' FILENAME å¦‚ä½•åœ¨grepä¸­ä½¿ç”¨ OR çš„é€»è¾‘è¿ç®— ï¼Ÿgrep -E 'word1|word2' FILENAME æˆ–è€… egrep 'word1|word2' FILENAMEæˆ–è€…å¯ä»¥è¿™æ ·åšgrep 'word1\\|word2' FILENAME å¦‚ä½•åœ¨grepä¸­ä½¿ç”¨ AND çš„é€»è¾‘è¿ç®— ï¼ŸæŒ‰ç…§ä¸‹é¢çš„è¯­æ³•æ˜¾ç¤ºæ‰€æœ‰åŒ…å«äº†å•è¯ â€˜word1â€² å’Œ â€˜word2â€² çš„ç»“æœï¼šgrep 'word1' FILENAME | grep 'word2' æˆ–è€…å¯ä»¥è¿™æ ·ï¼šgrep 'foo.*bar\\|word3.*word4' FILENAME å¦‚ä½•æµ‹è¯•åºåˆ—ï¼Ÿä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¯­æ³•æµ‹è¯•ä¸€ä¸ªå­—ç¬¦åœ¨åºåˆ—ä¸­çš„é‡å¤çš„æ¬¡æ•°ï¼š {N} {N,} {min,max} åŒ¹é…åŒ…å«ä¸¤ä¸ªå­—æ¯ v çš„å­—ç¬¦ä¸²ç»“æœï¼šegrep &quot;v{2}&quot; FILENAME ä¸‹é¢çš„ä¾‹å­ä¸­å°†æ£€ç´¢æ–‡ä»¶å†…åŒ…å« â€œcolâ€ å’Œ â€œcoolâ€ çš„å­—ç¬¦ä¸²ç»“æœï¼šegrep 'co{1,2}l' FILENAME æœç´¢patternæˆ–patern123rust@rust-pc:~/note/Linux_note$ egrep 'pat{1,2}ern' *grep_note.md:Exclude directories matching the pattern DIR from recursive searches.grep_note.md:grep_note.md: Exclude directories matching the pattern DIR from recursive searches.ä¸‹é¢çš„ä¾‹å­ä¸­å°†åŒ¹é…è‡³å°‘å«æœ‰3ä¸ªå­—æ¯ c çš„ç»“æœï¼šegrep 'c{3,}' FILENAME ä¸‹é¢çš„ç¤ºä¾‹å°†åŒ¹é… â€œ91-1234567890â€³ æ ¼å¼çš„æ‰‹æœºå·ç ï¼ˆå³ â€œä¸¤ä½æ•°å­—-åä½æ•°å­—â€ï¼‰grep &quot;[[:digit:]]\\{2\\}[ -]\\?[[:digit:]]\\{10\\}&quot; FILENAME å¦‚ä½•ä½¿ grep çš„è¾“å‡ºç»“æœé«˜äº®æ ‡æ³¨ï¼Ÿä½¿ç”¨ä¸‹é¢ä¾‹å­çš„è¯­æ³•ï¼šgrep --color regex FILENAME å¦‚ä½•ä½¿ grep çš„è¾“å‡ºåªæ˜¾ç¤ºåŒ¹é…çš„éƒ¨åˆ†è€Œä¸æ˜¯æ•´è¡Œï¼Ÿä½¿ç”¨ä¸‹é¢ä¾‹å­çš„è¯­æ³•ï¼šgrep -o regex FILENAME ç»Ÿè®¡è¡Œæ•°1grep &quot;&quot; -r . | wc -l","link":"/2015/11/29/Linux/grep_note/"},{"title":"Android å¹¿æ’­æœºåˆ¶ï¼ˆBroadcastï¼‰ä»‹ç»ä¸ä½¿ç”¨","text":"Androidåº”ç”¨å¯ä»¥é€šè¿‡å¹¿æ’­ä»ç³»ç»Ÿæˆ–å…¶ä»–Appæ¥æ”¶æˆ–å‘é€æ¶ˆæ¯ã€‚ç±»ä¼¼äºè®¢é˜…-å‘å¸ƒè®¾è®¡æ¨¡å¼ã€‚å½“æŸäº›äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå¯ä»¥å‘å‡ºå¹¿æ’­ã€‚ç³»ç»Ÿåœ¨æŸäº›çŠ¶æ€æ”¹å˜æ—¶ä¼šå‘å‡ºå¹¿æ’­ï¼Œä¾‹å¦‚å¼€æœºã€å……ç”µã€‚Appä¹Ÿå¯å‘é€è‡ªå®šä¹‰å¹¿æ’­ã€‚å¹¿æ’­å¯ç”¨äºåº”ç”¨é—´çš„é€šè®¯ï¼Œæ˜¯IPCçš„ä¸€ç§æ–¹å¼ã€‚ å¹¿æ’­çš„ç§ç±»å¹¿æ’­çš„ç§ç±»ä¹Ÿå¯ä»¥çœ‹æˆæ˜¯å¹¿æ’­çš„å±æ€§ã€‚ æ ‡å‡†å¹¿æ’­ï¼ˆNormal Broadcastsï¼‰å®Œå…¨å¼‚æ­¥çš„å¹¿æ’­ã€‚å¹¿æ’­å‘å‡ºåï¼Œæ‰€æœ‰çš„å¹¿æ’­æ¥æ”¶å™¨å‡ ä¹åŒæ—¶æ¥æ”¶åˆ°è¿™æ¡å¹¿æ’­ã€‚ä¸åŒçš„Appå¯ä»¥æ³¨å†Œå¹¶æ¥åˆ°æ ‡å‡†å¹¿æ’­ã€‚ä¾‹å¦‚ç³»ç»Ÿå¹¿æ’­ã€‚ æœ‰åºå¹¿æ’­ï¼ˆOrdered Broadcastsï¼‰åŒæ­¥å¹¿æ’­ã€‚åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªå¹¿æ’­æ¥æ”¶å™¨èƒ½æ¥æ”¶åˆ°è¿™æ¡å¹¿æ’­ã€‚è¿™ä¸ªæ¥æ”¶å™¨å¤„ç†å®Œåï¼Œå¹¿æ’­æ‰ä¼šç»§ç»­ä¼ é€’ã€‚æœ‰åºå¹¿æ’­æ˜¯å…¨å±€çš„å¹¿æ’­ã€‚ æœ¬åœ°å¹¿æ’­ï¼ˆLocal Broaddcastsï¼‰åªåœ¨æœ¬Appå‘é€å’Œæ¥æ”¶çš„å¹¿æ’­ã€‚æ³¨å†Œä¸ºæœ¬åœ°å¹¿æ’­çš„æ¥æ”¶å™¨æ— æ³•æ”¶åˆ°æ ‡å‡†å¹¿æ’­ã€‚ å¸¦æƒé™çš„å¹¿æ’­å‘é€å¹¿æ’­æ—¶å¯ä»¥å¸¦ä¸Šç›¸å…³æƒé™ï¼Œç”³è¯·äº†æƒé™çš„Appæˆ–å¹¿æ’­æ¥æ”¶å™¨æ‰èƒ½æ”¶åˆ°ç›¸åº”çš„å¸¦æƒé™çš„å¹¿æ’­ã€‚å¦‚æœåœ¨manifestä¸­ç”³è¯·äº†ç›¸åº”æƒé™ï¼Œæ¥æ”¶å™¨å¯ä»¥ä¸ç”¨å†ç”³è¯·ä¸€æ¬¡æƒé™å³å¯æ¥åˆ°ç›¸åº”å¹¿æ’­ã€‚ æ¥æ”¶å¹¿æ’­åˆ›å»ºå¹¿æ’­æ¥æ”¶å™¨ï¼Œè°ƒç”¨onReceive()æ–¹æ³•ï¼Œéœ€è¦ä¸€ä¸ªç»§æ‰¿BroadcastReceiverçš„ç±»ã€‚ æ³¨å†Œå¹¿æ’­ä»£ç ä¸­æ³¨å†Œç§°ä¸ºåŠ¨æ€æ³¨å†Œã€‚åœ¨AndroidManifest.xmlä¸­æ³¨å†Œç§°ä¸ºé™æ€æ³¨å†Œã€‚åŠ¨æ€æ³¨å†Œçš„åˆšæ³¢æ¥æ”¶å™¨ä¸€å®šè¦å–æ¶ˆæ³¨å†Œã€‚åœ¨onDestroy()æ–¹æ³•ä¸­è°ƒç”¨unregisterReceiver()æ–¹æ³•æ¥å–æ¶ˆæ³¨å†Œã€‚ ä¸è¦åœ¨onReceive()æ–¹æ³•ä¸­æ·»åŠ è¿‡å¤šçš„é€»è¾‘æ“ä½œæˆ–è€—æ—¶çš„æ“ä½œã€‚å› ä¸ºåœ¨å¹¿æ’­æ¥æ”¶å™¨ä¸­ä¸å…è®¸å¼€å¯çº¿ç¨‹ï¼Œå½“onReceive()æ–¹æ³•è¿è¡Œè¾ƒé•¿æ—¶é—´è€Œæ²¡ç»“æŸæ—¶ï¼Œç¨‹åºä¼šæŠ¥é”™ã€‚å› æ­¤å¹¿æ’­æ¥æ”¶å™¨ä¸€èˆ¬ç”¨æ¥æ‰“å¼€å…¶ä»–ç»„ä»¶ï¼Œæ¯”å¦‚åˆ›å»ºä¸€æ¡çŠ¶æ€æ é€šçŸ¥æˆ–å¯åŠ¨ä¸€ä¸ªæœåŠ¡ã€‚ æ–°å»ºä¸€ä¸ªMyExampleReceiverç»§æ‰¿è‡ªBroadcastReceiverã€‚1234567public class MyExampleReceiver extends BroadcastReceiver { @Override public void onReceive(Context context, Intent intent) { Toast.makeText(context,&quot;Got it&quot;,Toast.LENGTH_SHORT).show(); //abortBroadcast(); }}abortBroadcast()å¯ä»¥æˆªæ–­æœ‰åºå¹¿æ’­ åœ¨AndroidManifest.xmlä¸­æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨ï¼›nameé‡Œå¡«æ¥æ”¶å™¨çš„åå­—ã€‚å¯ä»¥è®¾ç½®å¹¿æ’­æ¥æ”¶å™¨ä¼˜å…ˆçº§ï¼š1234567&lt;intent-filter android:priority=&quot;100&quot;&gt;&lt;receiver android:name=&quot;.MyExampleReceiver&quot;&gt; &lt;intent-filter&gt; &lt;action android:name=&quot;com.rust.broadcasttest.MY_BROADCAST&quot;/&gt; &lt;/intent-filter&gt;&lt;/receiver&gt; è®©æ¥æ”¶å™¨æ¥æ”¶åˆ°ä¸€æ¡â€œcom.rust.broadcasttest.MY_BROADCASTâ€å¹¿æ’­ã€‚å‘é€è‡ªå®šä¹‰å¹¿æ’­ï¼ˆæ ‡å‡†å¹¿æ’­ï¼‰æ—¶ï¼Œè¦ä¼ é€è¿™ä¸ªå€¼ã€‚ä¾‹å¦‚ï¼š12Intent intent = new Intent(&quot;com.rust.broadcasttest.MY_BROADCAST&quot;);sendBroadcast(intent); å‘é€æœ‰åºå¹¿æ’­ï¼Œåº”å½“è°ƒç”¨sendOrderedBroadcast()ï¼›12Intent intent = new Intent(&quot;com.rust.broadcasttest.MY_BROADCAST&quot;);sendOrderedBroadcast(intentï¼Œnull); å‘é€å¹¿æ’­Appæœ‰3ç§å‘é€å¹¿æ’­çš„æ–¹å¼ã€‚å‘é€å¹¿æ’­éœ€è¦ä½¿ç”¨Intentç±»ã€‚ sendOrderedBroadcast(Intent, String)å‘é€æœ‰åºå¹¿æ’­ã€‚æ¯æ¬¡åªæœ‰1ä¸ªå¹¿æ’­æ¥æ”¶å™¨èƒ½æ¥åˆ°å¹¿æ’­ã€‚æ¥æ”¶å™¨æ¥åˆ°æœ‰åºå¹¿æ’­åï¼Œå¯ä»¥å®Œå…¨åœ°æˆªæ–­å¹¿æ’­ï¼Œæˆ–è€…ä¼ é€’ä¸€äº›ä¿¡æ¯ç»™ä¸‹ä¸€ä¸ªæ¥æ”¶å™¨ã€‚æœ‰åºå¹¿æ’­çš„é¡ºåºå¯å—android:priorityæ ‡ç­¾å½±å“ã€‚åŒç­‰çº§çš„æ¥æ”¶å™¨æ”¶åˆ°å¹¿æ’­çš„é¡ºåºæ˜¯éšæœºçš„ã€‚ sendBroadcast(Intent)ä»¥ä¸€ä¸ªæœªå®šä¹‰çš„é¡ºåºå‘æ‰€æœ‰æ¥æ”¶å™¨å‘é€å¹¿æ’­ã€‚ä¹Ÿç§°ä½œæ™®é€šå¹¿æ’­ã€‚è¿™ç§æ–¹å¼æ›´é«˜æ•ˆï¼Œä½†æ˜¯æ¥æ”¶å™¨ä¸èƒ½ç»™ä¸‹ä¸€ä¸ªæ¥æ”¶å™¨ä¼ é€’æ¶ˆæ¯ã€‚è¿™ç±»å¹¿æ’­ä¹Ÿæ— æ³•æˆªæ–­ã€‚ LocalBroadcastManager.sendBroadcastå¹¿æ’­åªèƒ½åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨è¿›è¡Œä¼ é€’ï¼Œå¹¶ä¸”å¹¿æ’­æ¥æ”¶å™¨ä¹Ÿåªèƒ½æ¥æ”¶åˆ°æ¥è‡ªæœ¬åº”ç”¨ç¨‹åºå‘å‡ºçš„å¹¿æ’­ã€‚è¿™ä¸ªæ–¹æ³•æ¯”å…¨å±€å¹¿æ’­æ›´é«˜æ•ˆï¼ˆä¸éœ€è¦Interprocess communicationï¼ŒIPCï¼‰ï¼Œè€Œä¸”ä¸éœ€è¦æ‹…å¿ƒå…¶å®ƒAppä¼šæ”¶åˆ°ä½ çš„å¹¿æ’­ä»¥åŠå…¶ä»–å®‰å…¨é—®é¢˜ã€‚ å¹¿æ’­ä¸æƒé™å‘é€å¸¦ç€æƒé™çš„å¹¿æ’­å½“ä½ è°ƒç”¨sendBroadcast(Intent, String)æˆ–sendOrderedBroadcast(Intent, String, BroadcastReceiver, Handler, int, String, Bundle)æ—¶ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªæƒé™ã€‚æ¥æ”¶å™¨åœ¨manifestä¸­ç”³è¯·äº†ç›¸åº”æƒé™æ—¶æ‰èƒ½æ”¶åˆ°è¿™ä¸ªå¹¿æ’­ã€‚ ä¾‹å¦‚å‘é€ä¸€ä¸ªå¸¦ç€æƒé™çš„å¹¿æ’­12sendBroadcast(new Intent(&quot;com.example.NOTIFY&quot;), Manifest.permission.SEND_SMS); æ¥æ”¶å¹¿æ’­çš„appå¿…é¡»æ³¨å†Œç›¸åº”çš„æƒé™1&lt;uses-permission android:name=&quot;android.permission.SEND_SMS&quot;/&gt; å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰permissionã€‚åœ¨manifestä¸­ä½¿ç”¨permissionæ ‡ç­¾1&lt;permission android:name=&quot;custom_permission&quot; /&gt;æ·»åŠ åç¼–è¯‘ä¸€ä¸‹ã€‚å³å¯è°ƒç”¨Manifest.permission.custom_permission æ¥æ”¶å¸¦æƒé™çš„å¹¿æ’­è‹¥æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨æ—¶ç”³æ˜äº†æƒé™ï¼Œé‚£ä¹ˆåªä¼šæ¥æ”¶åˆ°å¸¦ç€ç›¸åº”æƒé™çš„å¹¿æ’­ã€‚ åœ¨é…ç½®æ–‡ä»¶ä¸­å£°æ˜æƒé™ï¼Œç¨‹åºæ‰èƒ½è®¿é—®ä¸€äº›å…³é”®ä¿¡æ¯ã€‚ä¾‹å¦‚å…è®¸æŸ¥è¯¢ç³»ç»Ÿç½‘ç»œçŠ¶æ€ã€‚1234&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot;/&gt;&lt;!-- æœºå™¨å¼€æœºå¹¿æ’­ --&gt;&lt;uses-permission android:name=&quot;android.permission.BOOT_COMPLETED&quot;&gt;å¦‚æœæ²¡æœ‰ç”³è¯·æƒé™ï¼Œç¨‹åºå¯èƒ½ä¼šæ„å¤–å…³é—­ã€‚ ç¤ºä¾‹ - ä½¿ç”¨æ ‡å‡†å¹¿æ’­ï¼Œæœ¬åœ°å¹¿æ’­ï¼Œå¸¦æƒé™çš„å¹¿æ’­ï¼Œæœ‰åºå¹¿æ’­å‘é€å’Œæ¥æ”¶å¹¿æ’­ã€‚åˆ†ä¸ºå‘é€å’Œæ¥æ”¶æ–¹2ä¸ªAppã€‚ ä½¿ç”¨å¸¦æƒé™çš„å¹¿æ’­ã€‚ç³»ç»Ÿæƒé™ä¸è‡ªå®šä¹‰æƒé™ã€‚ä½¿ç”¨æƒé™éœ€è¦åœ¨AndroidManifest.xmlä¸­å£°æ˜ã€‚å¦‚æœæ˜¯è‡ªå®šä¹‰æƒé™ï¼Œéœ€è¦å…ˆæ·»åŠ è‡ªå®šä¹‰æƒé™ã€‚123&lt;!-- è‡ªå®šä¹‰çš„æƒé™ ç»™å¹¿æ’­ç”¨ --&gt;&lt;permission android:name=&quot;com.rust.permission_rust_1&quot; /&gt;&lt;uses-permission android:name=&quot;com.rust.permission_rust_1&quot; /&gt; å‘é€å¹¿æ’­æ—¶å¸¦ä¸Šæƒé™å£°æ˜ã€‚æ¥æ”¶æ–¹ï¼ˆä¸è®ºæ˜¯å¦å·±æ–¹Appï¼‰éœ€è¦åœ¨AndroidManifest.xmlä¸­ç”³è¯·æƒé™ã€‚æ³¨å†Œæ¥æ”¶å™¨æ—¶ä¹Ÿéœ€è¦å£°æ˜æƒé™ã€‚ å‘é€ä¸å¸¦æƒé™çš„æœ‰åºå¹¿æ’­12345private void sendStandardOrderBroadcast() { Intent intent = new Intent(MSG_PHONE); sendOrderedBroadcast(intent, null); Log.d(TAG, &quot;[App1] å‘é€ä¸å¸¦æƒé™çš„æœ‰åºå¹¿æ’­, &quot; + intent.getAction());} å‘é€æ–¹App1ä»£ç 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123private static final String TAG = &quot;rustApp&quot;;public static final String MSG_PHONE = &quot;msg_phone&quot;;public static final String PERMISSION_RUST_1 = &quot;com.rust.permission_rust_1&quot;; // æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨ registerReceiver(mStandardReceiver1, makeIF()); registerReceiver(mStandardReceiver2, makeIF()); registerReceiver(mStandardReceiver3, makeIF()); registerReceiver(mStandardReceiverWithPermission, makeIF(), Manifest.permission.permission_rust_1, null); // å¸¦ä¸Šæƒé™ LocalBroadcastManager.getInstance(getApplicationContext()) .registerReceiver(mLocalReceiver1, makeIF()); LocalBroadcastManager.getInstance(getApplicationContext()) .registerReceiver(mLocalReceiver2, makeIF()); LocalBroadcastManager.getInstance(getApplicationContext()) .registerReceiver(mLocalReceiver3, makeIF()); // è§£é™¤æ¥æ”¶å™¨ unregisterReceiver(mStandardReceiver1); unregisterReceiver(mStandardReceiver2); unregisterReceiver(mStandardReceiver3); unregisterReceiver(mStandardReceiverWithPermission); LocalBroadcastManager.getInstance(getApplicationContext()) .unregisterReceiver(mLocalReceiver1); LocalBroadcastManager.getInstance(getApplicationContext()) .unregisterReceiver(mLocalReceiver2); LocalBroadcastManager.getInstance(getApplicationContext()) .unregisterReceiver(mLocalReceiver3);// å‘é€æ ‡å‡†å¹¿æ’­private void sendStandardBroadcast() { Intent intent = new Intent(MSG_PHONE); sendBroadcast(intent); Log.d(TAG, &quot;[App1] Dispatcher å‘é€æ ‡å‡†å¹¿æ’­&quot;);}// å‘é€å¸¦æƒé™çš„æ ‡å‡†å¹¿æ’­private void sendStandardBroadcastWithPermission() { Intent intent = new Intent(MSG_PHONE); sendBroadcast(intent, PERMISSION_RUST_1); Log.d(TAG, &quot;[App1] Dispatcher å‘é€å¸¦æƒé™çš„æ ‡å‡†å¹¿æ’­&quot;);}// å‘é€æœ¬åœ°å¹¿æ’­private void sendAppLocalBroadcast() { Intent intent = new Intent(MSG_PHONE); LocalBroadcastManager.getInstance(getApplicationContext()).sendBroadcast(intent); Log.d(TAG, &quot;[App1] Dispatcher å‘é€æœ¬åœ°å¹¿æ’­&quot;);}private IntentFilter makeIF() { IntentFilter intentFilter = new IntentFilter(MSG_PHONE); intentFilter.addAction(Intent.ACTION_TIME_TICK); intentFilter.addAction(Intent.ACTION_TIME_CHANGED); return intentFilter;}// æ ‡å‡†æ¥æ”¶å™¨ ç”¨contextæ¥æ³¨å†Œprivate BroadcastReceiver mStandardReceiver1 = new BroadcastReceiver() { @Override public void onReceive(Context context, Intent intent) { Log.d(TAG, &quot;[App1] æ ‡å‡†æ¥æ”¶å™¨1 æ”¶åˆ°: &quot; + intent.getAction()); }};// æ ‡å‡†æ¥æ”¶å™¨ ç”¨contextæ¥æ³¨å†Œprivate BroadcastReceiver mStandardReceiver2 = new BroadcastReceiver() { @Override public void onReceive(Context context, Intent intent) { Log.d(TAG, &quot;[App1] æ ‡å‡†æ¥æ”¶å™¨2 æ”¶åˆ°: &quot; + intent.getAction()); if (intent.getAction().endsWith(MSG_PHONE)) { abortBroadcast(); // æˆªæ–­æœ‰åºå¹¿æ’­ Log.d(TAG, &quot;[App1] æ ‡å‡†æ¥æ”¶å™¨2æˆªæ–­æœ‰åºå¹¿æ’­ &quot; + intent.getAction()); } }};// æ ‡å‡†æ¥æ”¶å™¨ ç”¨contextæ¥æ³¨å†Œprivate BroadcastReceiver mStandardReceiver3 = new BroadcastReceiver() { @Override public void onReceive(Context context, Intent intent) { Log.d(TAG, &quot;[App1] æ ‡å‡†æ¥æ”¶å™¨3 æ”¶åˆ°: &quot; + intent.getAction()); }};// æ³¨å†Œçš„æ—¶å€™ç»™å®ƒå¸¦æƒé™ æ ‡å‡†æ¥æ”¶å™¨private BroadcastReceiver mStandardReceiverWithPermission = new BroadcastReceiver() { @Override public void onReceive(Context context, Intent intent) { Log.d(TAG, &quot;[App1] å¸¦æƒé™çš„æ ‡å‡†æ¥æ”¶å™¨æ”¶åˆ°: &quot; + intent.getAction()); }};/** * ç”¨LocalBroadcastManageræ¥æ³¨å†Œæˆä¸ºæœ¬åœ°æ¥æ”¶å™¨ * æ”¶ä¸åˆ°æ ‡å‡†å¹¿æ’­ - ä¸è®ºæ˜¯æœ¬appå‘å‡ºçš„è¿˜æ˜¯åˆ«çš„åœ°æ–¹å‘å‡ºæ¥çš„ */private BroadcastReceiver mLocalReceiver1 = new BroadcastReceiver() { @Override public void onReceive(Context context, Intent intent) { Log.d(TAG, &quot;[App1] æœ¬åœ°æ¥æ”¶å™¨1 æ”¶åˆ°: &quot; + intent.getAction()); }};private BroadcastReceiver mLocalReceiver2 = new BroadcastReceiver() { @Override public void onReceive(Context context, Intent intent) { Log.d(TAG, &quot;[App1] æœ¬åœ°æ¥æ”¶å™¨2 æ”¶åˆ°: &quot; + intent.getAction()); }};private BroadcastReceiver mLocalReceiver3 = new BroadcastReceiver() { @Override public void onReceive(Context context, Intent intent) { Log.d(TAG, &quot;[App1] æœ¬åœ°æ¥æ”¶å™¨3 æ”¶åˆ°: &quot; + intent.getAction()); }}; æ¥æ”¶æ–¹App2ä»£ç 123&lt;!-- è‡ªå®šä¹‰çš„æƒé™ ç»™å¹¿æ’­ç”¨ --&gt;&lt;permission android:name=&quot;com.rust.permission_rust_1&quot; /&gt;&lt;uses-permission android:name=&quot;com.rust.permission_rust_1&quot; /&gt; 123456789101112131415161718192021222324252627282930public static final String MSG_PHONE = &quot;msg_phone&quot;; registerReceiver(mDefaultReceiver, makeIF()); LocalBroadcastManager.getInstance(getApplicationContext()) .registerReceiver(mLocalReceiver, makeIF()); unregisterReceiver(mDefaultReceiver); LocalBroadcastManager.getInstance(getApplicationContext()) .unregisterReceiver(mLocalReceiver); private BroadcastReceiver mDefaultReceiver = new BroadcastReceiver() { @Override public void onReceive(Context context, Intent intent) { Log.d(TAG, &quot;[App2] standard receive: &quot; + intent.getAction()); } }; private BroadcastReceiver mLocalReceiver = new BroadcastReceiver() { @Override public void onReceive(Context context, Intent intent) { Log.d(TAG, &quot;[App2] local receive: &quot; + intent.getAction()); } }; private IntentFilter makeIF() { IntentFilter intentFilter = new IntentFilter(MSG_PHONE); intentFilter.addAction(Intent.ACTION_TIME_TICK); intentFilter.addAction(Intent.ACTION_TIME_CHANGED); return intentFilter; } ä½¿ç”¨LocalBroadcastManagerå‘å‡ºçš„æœ¬åœ°å¹¿æ’­ï¼Œå¦ä¸€ä¸ªAppæ˜¯æ¥æ”¶ä¸åˆ°çš„ã€‚è¦æ”¶åˆ°æœ¬åœ°å¹¿æ’­ï¼ŒåŒæ ·éœ€è¦LocalBroadcastManageræ¥æ³¨å†Œæ¥æ”¶å™¨ã€‚ å¯ä»¥æŠŠæœ¬åœ°å¹¿æ’­çœ‹æˆæ˜¯ä¸€ä¸ªå±€éƒ¨çš„ï¼ŒAppå†…çš„å¹¿æ’­ä½“ç³»ã€‚ å®éªŒä¸­æˆ‘ä»¬æ³¨æ„åˆ°ï¼ŒIntent.ACTION_TIME_TICKå¹¿æ’­æ˜¯å¯ä»¥æˆªæ–­çš„ã€‚","link":"/2015/10/29/Android/Android-Broadcast_intro_use/"},{"title":"Android AIDL äº†è§£ä¸ä½¿ç”¨","text":"AIDLç®€ä»‹AIDLï¼ˆAndroid Interface Definition Language, Android æ¥å£å®šä¹‰è¯­è¨€ï¼‰ç”¨äºå®šä¹‰C/Sä½“ç³»ç»“æ„ä¸­Serverç«¯å¯ä»¥æä¾›çš„æœåŠ¡è°ƒç”¨æ¥å£ï¼Œæ¡†æ¶å±‚æä¾›çš„Javaç³»ç»ŸæœåŠ¡æ¥å£å¤§å¤šç”±AIDLè¯­è¨€å®šä¹‰ã€‚Androidæä¾›äº†AIDLå·¥å…·ï¼Œå¯å°†AIDLæ–‡ä»¶ç¼–è¯‘æˆJavaæ–‡ä»¶ã€‚æé«˜æœåŠ¡å¼€å‘çš„æ•ˆç‡ ç¨‹åºå‘˜å¯ä»¥åˆ©ç”¨AIDLè‡ªå®šä¹‰ç¼–ç¨‹æ¥å£ï¼Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å®ç°è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰ã€‚åœ¨Androidå¹³å°ä¸Šï¼Œä¸€ä¸ªè¿›ç¨‹é€šå¸¸ä¸èƒ½è®¿é—®å¦å¤–ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤ï¼ŒAndroidå¹³å°å°†è¿™äº›è·¨è¿›ç¨‹è®¿é—®çš„å¯¹è±¡åˆ†è§£æˆæ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¯†åˆ«çš„ç®€å•å¯¹è±¡ã€‚å¹¶ä¸ºè·¨åº”ç”¨è®¿é—®è€Œç‰¹æ®Šç¼–æ’å’Œæ•´ç†è¿™äº›å¯¹è±¡ã€‚ç”¨äºç¼–æ’å’Œæ•´ç†è¿™äº›å¯¹è±¡çš„ä»£ç ç¼–å†™èµ·æ¥ååˆ†å†—é•¿ï¼Œæ‰€ä»¥Androidçš„AIDLæä¾›äº†ç›¸å…³å·¥å…·æ¥è‡ªåŠ¨ç”Ÿæˆè¿™äº›ä»£ç ã€‚ å¼€å‘äººå‘˜åªéœ€è¦åœ¨AIDLæ–‡ä»¶ä¸­å®šä¹‰Serverç«¯å¯ä»¥æä¾›çš„æœåŠ¡æ–¹æ³•ï¼ŒAIDLå·¥å…·ä¾¿å¯å°†å…¶è½¬åŒ–ä¸ºJavaæ–‡ä»¶ã€‚è½¬åŒ–åçš„Javaæ–‡ä»¶åŒ…å«C/Sä½“ç³»ç»“æ„çš„ä»¥ä¸‹å†…å®¹ï¼š æœåŠ¡æ¥å£ ï¼ˆIPowerManagerï¼‰ æœåŠ¡åœ¨Clientç«¯çš„ä»£ç†ï¼ˆProxyï¼‰ æœåŠ¡å­˜æ ¹ï¼ˆStubï¼‰ Binderç±»å‹ä¸IIterfaceç±»å‹çš„è½¬æ¢æ¥å£ï¼ˆasInterface å’Œ asBinder æ–¹æ³•ï¼‰ æœåŠ¡æ–¹æ³•è¯·æ±‚ç  AIDLæ„ä¹‰AIDLå·¥å…·å»ºç«‹äº†åŸºäºBinderçš„C/Sä½“ç³»ç»“æ„çš„é€šç”¨ç»„ä»¶ï¼›å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºå¼€å‘æœåŠ¡çš„åŠŸèƒ½ï¼Œè€Œä¸éœ€ç†ä¼šå…·ä½“çš„é€šä¿¡ç»“æ„ï¼Œæé«˜æ•ˆç‡ã€‚ åº”ç”¨ç¤ºä¾‹æ ¹æ®ä¸Šæ–‡æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªapkï¼Œä¸€ä¸ªä½œä¸ºæœåŠ¡æä¾›æ–¹ï¼Œä¸€ä¸ªä½œä¸ºAIDLæœåŠ¡è°ƒç”¨æ–¹ã€‚ AIDLæœåŠ¡æä¾›æ–¹ä»£ç é¦–å…ˆæ˜¯AIDLæœåŠ¡æä¾›æ–¹ä¸»è¦æ–‡ä»¶ç›®å½•123456789101112131415161718main/aidl/`-- com `-- rustfisher `-- ndkproj `-- ITomInterface.aidl // AIDLä»£ç main/java`-- com `-- rustfisher |-- tom | `-- TomService.java // å¯¹åº”çš„Servicebuild/generated/source/aidl/`-- debug `-- com `-- rustfisher `-- ndkproj `-- ITomInterface.java // å·¥ç¨‹ç¼–è¯‘åAIDLç”Ÿæˆçš„Javaæ–‡ä»¶ æä¾›ç»™è°ƒç”¨æ–¹ æ–°å»ºAIDLæ–‡ä»¶å¹¶å†™å¥½æ¥å£è¿›å…¥æœåŠ¡æ–¹çš„å·¥ç¨‹ï¼Œå³é”®æ–°å»ºAIDLæ–‡ä»¶ITomInterface.aidlã€‚æ–‡ä»¶ä¼šé»˜è®¤ç”Ÿæˆåœ¨main/aidl/com/rustfisher/ndkprojä¸‹12345678910// ITomInterface.aidlpackage com.rustfisher.ndkproj;// æ–‡ä»¶ååº”è¯¥å’Œæ¥å£åç›¸åŒ// ç¼–å†™å¥½AIDLæ–‡ä»¶åå¯ä»¥å…ˆç¼–è¯‘ä¸€æ¬¡interface ITomInterface { void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat, double aDouble, String aString); String helloAIDL(String name); // æ­¤æ¬¡ä½¿ç”¨çš„æ–¹æ³•} ç¼–å†™æœåŠ¡æ–¹çš„æ¥å£å®ç°ä»£ç åœ¨com.rustfisher.tomåŒ…å†…åˆ›å»ºTomService.javaæ–‡ä»¶ï¼›å»ºç«‹å†…éƒ¨ç±»TomServiceImplå®ç°æ¥å£çš„åŠŸèƒ½12345678910111213141516171819202122232425import com.rustfisher.ndkproj.ITomInterface;public class TomService extends Service { private static final String TAG = &quot;rustApp&quot;; public class TomServiceImpl extends ITomInterface.Stub { @Override public void basicTypes(int anInt, long aLong, boolean aBoolean, float aFloat, double aDouble, String aString) throws RemoteException { } @Override public String helloAIDL(String name) throws RemoteException { Log.d(TAG, name + &quot; requires helloAIDL()&quot;); return &quot;Hello &quot; + name + &quot;, nice to meet you!&quot;; } } @Nullable @Override public IBinder onBind(Intent intent) { return new TomServiceImpl(); // ç»‘å®šæœåŠ¡åˆ™è¿”å› TomServiceImpl å®ä¾‹ }} æœåŠ¡æ–¹åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­é…ç½®å®ç°äº†TomServiceç±»åï¼Œå¯¹æ­¤AIDLæœåŠ¡è¿›è¡Œé…ç½®ï¼›åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­é…ç½®12345&lt;service android:name=&quot;com.rustfisher.tom.TomService&quot;&gt; &lt;intent-filter&gt; &lt;action android:name=&quot;com.rustfisher.ndkproj.ITomInterface&quot; /&gt; &lt;/intent-filter&gt;&lt;/service&gt;actioné‡Œé¢å†™ä¸ŠAIDLæ–‡ä»¶ å®‰è£…è¿è¡Œæ­¤apkåˆ°æ‰‹æœºä¸Šè®©æœåŠ¡æ–¹è¿è¡Œèµ·æ¥ AIDLè°ƒç”¨æ–¹ä»£ç ï¼ˆå®¢æˆ·ç«¯ï¼‰å»ºç«‹ï¼ˆæˆ–è¿›å…¥ï¼‰AIDLè°ƒç”¨æ–¹çš„å·¥ç¨‹ï¼Œè¿™é‡Œæ˜¯aidlcallerå·¥ç¨‹ã€‚ ä¸»è¦æ–‡ä»¶ç›®å½•12345678java/`-- com |-- rust | `-- aidlcaller | `-- MainActivity.java // æ¼”ç¤ºç”¨çš„ `-- rustfisher `-- ndkproj // è¿™ä¸ªè·¯å¾„å°½é‡ä¿æŒä¸æœåŠ¡æä¾›æ–¹é‚£é‡Œçš„ä¸€è‡´ `-- ITomInterface.java // ä»æœåŠ¡æ–¹é‚£é‡Œcopyæ¥çš„ æœ‰å¦‚ä¸‹3ä¸ªæ­¥éª¤ï¼š 1.å°†AIDLæœåŠ¡ç«¯ç”Ÿæˆçš„Javaæ–‡ä»¶å¤åˆ¶åˆ°è°ƒç”¨æ–¹å·¥ç¨‹é‡Œï¼Œå°½é‡ä¿æŒè¿™ä¸ªJavaæ–‡ä»¶çš„è·¯å¾„ä¸æœåŠ¡ç«¯çš„ä¸€è‡´ï¼Œä¾¿äºè¯†åˆ« 2.å†™ä»£ç ç»‘å®šæœåŠ¡ï¼Œè·å–AIDLæœåŠ¡å¯¹è±¡ 3.é€šè¿‡AIDLæœåŠ¡å¯¹è±¡å®ŒæˆAIDLæ¥å£è°ƒç”¨ ç¼–å†™è°ƒç”¨æ–¹MainActivity.javaä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253import com.rustfisher.ndkproj.ITomInterface;public class MainActivity extends AppCompatActivity { private static final String TAG = &quot;rustApp&quot;; ITomInterface mTomService; // AIDL æœåŠ¡ TextView mTv1; private ServiceConnection serviceConnection = new ServiceConnection() { @Override public void onServiceConnected(ComponentName name, IBinder service) { mTomService = ITomInterface.Stub.asInterface(service);// è·å–æœåŠ¡å¯¹è±¡ mTv1.setClickable(true); // éœ€è¦ç­‰æœåŠ¡ç»‘å®šå¥½ å†å…è®¸ç‚¹å‡» Log.d(TAG, &quot;[aidlcaller] onServiceConnected&quot;); } @Override public void onServiceDisconnected(ComponentName name) { Log.d(TAG, &quot;onServiceDisconnected &quot; + name); } }; @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.activity_main); initAIDLService(); initUI(); } private void initUI() { mTv1 = (TextView) findViewById(R.id.tv1); mTv1.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { try { String hello = mTomService.helloAIDL(&quot;Jerry&quot;); Log.d(TAG, hello); } catch (Exception e) { Log.e(TAG, &quot;mTomService initAIDLService: Fail &quot;, e); e.printStackTrace(); } } }); } private void initAIDLService() { // è¿™ä¸ªæ˜¯æœåŠ¡æä¾›æ–¹çš„AndroidManifest action Intent intent = new Intent(&quot;com.rustfisher.ndkproj.ITomInterface&quot;); intent.setPackage(&quot;com.rustfisher.ndkproj&quot;); // æœåŠ¡æä¾›è€…çš„åŒ…å bindService(intent, serviceConnection, Context.BIND_AUTO_CREATE); }} æµ‹è¯•å’Œæ•ˆæœç‚¹å‡»è°ƒç”¨ç«¯çš„Viewï¼Œæ‰“å‡ºlog Hello Jerry, nice to meet you!æœåŠ¡ç«¯apkæ‰“å°logï¼šJerry requires helloAIDL() å¦‚æœè°ƒç”¨å¤±è´¥åˆ™æŠ›å‡º android.os.DeadObjectException å½“æœåŠ¡æä¾›æ–¹Appæ²¡æœ‰åœ¨è¿è¡Œæ—¶ï¼Œè°ƒç”¨æ–¹å»è¯·æ±‚æœåŠ¡ä¼šå¤±è´¥ã€‚ æœåŠ¡ç«¯æ›´æ–°åï¼Œå¦‚æœaidlæ–‡ä»¶æ²¡æ”¹åŠ¨ï¼Œä¸éœ€è¦æ›´æ–°ç”Ÿæˆçš„Javaæ–‡ä»¶å¦‚æœæœåŠ¡ç«¯apkè¢«å¸è½½ï¼Œè°ƒç”¨ç«¯ä½¿ç”¨æ­¤æœåŠ¡æ—¶ä¼šå‡ºé”™ å‚è€ƒèµ„æ–™Android Binder æœºåˆ¶ä»‹ç»","link":"/2015/10/26/Android/Android-AIDL_intro_and_use/"},{"title":"Android NDK ä½¿ç”¨.a","text":"Android NDK ä½¿ç”¨.aä¸€ä¸ªç¼–è¯‘æ—¶ä½¿ç”¨.aæ–‡ä»¶çš„ä¾‹å­ã€‚æµç¨‹æ˜¯å‡†å¤‡å¥½åº“æ–‡ä»¶ä»¥åŠå¯¹åº”çš„å¤´æ–‡ä»¶ï¼Œç¼–å†™makefileï¼Œç¼–è¯‘ã€‚ å‡†å¤‡åº“æ–‡ä»¶ä¸å¤´æ–‡ä»¶å…ˆå‡†å¤‡å¤´æ–‡ä»¶å’Œ.aæ–‡ä»¶ã€‚è¿™é‡Œä»¥ncnnç›®å½•ä¸ºä¾‹ã€‚ 12345678|-- Android.mk|-- Application.mk|-- ncnn| |-- include| | |-- benchmark.h| | |-- ....h # å¯¹åº”çš„å¤´æ–‡ä»¶| |-- lib| | `-- libncnn.a ç¼–å†™makefileåœ¨Android.mkä¸­å£°æ˜åº“æ–‡ä»¶ã€‚è¿™é‡Œæ˜¯å¼•å…¥opencvçš„åº“ã€‚ 12345678910111213141516171819202122LOCAL_PATH := $(call my-dir)include $(CLEAR_VARS)LOCAL_MODULE := ncnnLOCAL_SRC_FILES := ncnn/lib/libncnn.ainclude $(PREBUILT_STATIC_LIBRARY)LOCAL_STATIC_LIBRARIES := ncnnOPENCVROOT:=$(LOCAL_PATH)/../../../../../../OpenCV-android-sdkOPENCV_CAMERA_MODULES:=offOPENCV_INSTALL_MODULES:=on#OPENCV_LIB_TYPE:=SHAREDOPENCV_LIB_TYPE:=STATICinclude ${OPENCVROOT}/sdk/native/jni/OpenCV.mk# v20 with sseLOCAL_SRC_FILES := v20/fdssttracker.cpp v20/fhog.cpp v20/runtracker.cpp \\ jni_eman.cpp \\ ncnn/ssdmobilenet.cpp jni_encnn.cpp# åé¢æ˜¯æ¨¡å—çš„é…ç½® è¿™é‡Œè¦æ³¨æ„ï¼Œå¤´æ–‡ä»¶å’Œ.aæ–‡ä»¶å¿…é¡»æ˜¯å¯¹åº”çš„ã€‚å¦åˆ™ç¼–è¯‘æ—¶ä¼šæŠ¥é”™error: undefined reference to 1234567E:/projects/myProj/myProject/f1/src/main/jni/ncnn/lib/libncnn.a(net.cpp.o):net.cpp:function ncnn::Net::load_model(__STDIO_FILE_STRUCT*): error: undefined reference to 'stderr'E:/projects/myProj/myProject/f1/src/main/jni/ncnn/lib/libncnn.a(net.cpp.o):net.cpp:function ncnn::Net::load_model(char const*): `error: undefined reference to`'stderr'E:/projects/myProj/myProject/f1/src/main/jni/ncnn/lib/libncnn.a(net.cpp.o):net.cpp:function ncnn::Net::load_model(unsigned char const*): error: undefined reference to 'stderr'E:/projects/myProj/myProject/f1/src/main/jni/ncnn/lib/libncnn.a(net.cpp.o):net.cpp:function ncnn::Net::find_blob_index_by_name(char const*) const: error: undefined reference to 'stderr'clang++.exe: error: linker command failed with exit code 1 (use -v to see invocation)make: *** [E:/projects/myProj/myProject/f1/src/main/obj/local/armeabi-v7a/libf1.so] Error 1","link":"/2015/10/26/Android/NDK-compile_import_a_file/"}],"tags":[{"name":"Android-2020","slug":"Android-2020","link":"/tags/Android-2020/"},{"name":"AIDL","slug":"AIDL","link":"/tags/AIDL/"},{"name":"Thread","slug":"Thread","link":"/tags/Thread/"},{"name":"Android_View","slug":"Android-View","link":"/tags/Android-View/"},{"name":"Android_Media","slug":"Android-Media","link":"/tags/Android-Media/"},{"name":"Binder","slug":"Binder","link":"/tags/Binder/"},{"name":"Android_Broadcast","slug":"Android-Broadcast","link":"/tags/Android-Broadcast/"},{"name":"Androidæºç ","slug":"Androidæºç ","link":"/tags/Android%E6%BA%90%E7%A0%81/"},{"name":"Handler","slug":"Handler","link":"/tags/Handler/"},{"name":"Android_service","slug":"Android-service","link":"/tags/Android-service/"},{"name":"Media","slug":"Media","link":"/tags/Media/"},{"name":"MediaPlayer","slug":"MediaPlayer","link":"/tags/MediaPlayer/"},{"name":"Network","slug":"Network","link":"/tags/Network/"},{"name":"network","slug":"network","link":"/tags/network/"},{"name":"OkHttp","slug":"OkHttp","link":"/tags/OkHttp/"},{"name":"mmap","slug":"mmap","link":"/tags/mmap/"},{"name":"gradle","slug":"gradle","link":"/tags/gradle/"},{"name":"NDK","slug":"NDK","link":"/tags/NDK/"},{"name":"Cocos Creator","slug":"Cocos-Creator","link":"/tags/Cocos-Creator/"},{"name":"MySQL","slug":"MySQL","link":"/tags/MySQL/"},{"name":"mac","slug":"mac","link":"/tags/mac/"},{"name":"å®‰è£…mysql","slug":"å®‰è£…mysql","link":"/tags/%E5%AE%89%E8%A3%85mysql/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","link":"/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"å¼€å‘è®°å½•","slug":"å¼€å‘è®°å½•","link":"/tags/%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/"},{"name":"Linux","slug":"Linux","link":"/tags/Linux/"},{"name":"Tools","slug":"Tools","link":"/tags/Tools/"},{"name":"Shell","slug":"Shell","link":"/tags/Shell/"},{"name":"for","slug":"for","link":"/tags/for/"},{"name":"MongoDB","slug":"MongoDB","link":"/tags/MongoDB/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","link":"/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"NestJS","slug":"NestJS","link":"/tags/NestJS/"},{"name":"åç«¯","slug":"åç«¯","link":"/tags/%E5%90%8E%E7%AB%AF/"},{"name":"å…¬ä¼—å·","slug":"å…¬ä¼—å·","link":"/tags/%E5%85%AC%E4%BC%97%E5%8F%B7/"},{"name":"WebSocket","slug":"WebSocket","link":"/tags/WebSocket/"},{"name":"http","slug":"http","link":"/tags/http/"},{"name":"ç½‘ç»œ","slug":"ç½‘ç»œ","link":"/tags/%E7%BD%91%E7%BB%9C/"},{"name":"å°ç¨‹åº","slug":"å°ç¨‹åº","link":"/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/"},{"name":"css","slug":"css","link":"/tags/css/"},{"name":"è¿è¥çš„PythonæŒ‡å—","slug":"è¿è¥çš„PythonæŒ‡å—","link":"/tags/%E8%BF%90%E8%90%A5%E7%9A%84Python%E6%8C%87%E5%8D%97/"},{"name":"openpyxl","slug":"openpyxl","link":"/tags/openpyxl/"},{"name":"Excel","slug":"Excel","link":"/tags/Excel/"},{"name":"pyecharts","slug":"pyecharts","link":"/tags/pyecharts/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","link":"/tags/%E7%88%AC%E8%99%AB/"},{"name":"æ€»ç»“","slug":"æ€»ç»“","link":"/tags/%E6%80%BB%E7%BB%93/"},{"name":"Android","slug":"Android","link":"/tags/Android/"},{"name":"WebRTC","slug":"WebRTC","link":"/tags/WebRTC/"},{"name":"åä¸ºäº‘ç¤¾åŒº","slug":"åä¸ºäº‘ç¤¾åŒº","link":"/tags/%E5%8D%8E%E4%B8%BA%E4%BA%91%E7%A4%BE%E5%8C%BA/"},{"name":"hexoä¸»é¢˜","slug":"hexoä¸»é¢˜","link":"/tags/hexo%E4%B8%BB%E9%A2%98/"},{"name":"web","slug":"web","link":"/tags/web/"},{"name":"echarts","slug":"echarts","link":"/tags/echarts/"},{"name":"python","slug":"python","link":"/tags/python/"},{"name":"Python","slug":"Python","link":"/tags/Python/"},{"name":"Matplotlib","slug":"Matplotlib","link":"/tags/Matplotlib/"},{"name":"plt","slug":"plt","link":"/tags/plt/"},{"name":"plot","slug":"plot","link":"/tags/plot/"}],"categories":[{"name":"Android_tutorial_2020","slug":"Android-tutorial-2020","link":"/categories/Android-tutorial-2020/"},{"name":"Android_note","slug":"Android-note","link":"/categories/Android-note/"},{"name":"CocosCreator","slug":"CocosCreator","link":"/categories/CocosCreator/"},{"name":"Database","slug":"Database","link":"/categories/Database/"},{"name":"Design_pattern","slug":"Design-pattern","link":"/categories/Design-pattern/"},{"name":"miniprogram","slug":"miniprogram","link":"/categories/miniprogram/"},{"name":"Web_note","slug":"Web-note","link":"/categories/Web-note/"},{"name":"Kotlin","slug":"Kotlin","link":"/categories/Kotlin/"},{"name":"Flutter_note","slug":"Flutter-note","link":"/categories/Flutter-note/"},{"name":"Linux_note","slug":"Linux-note","link":"/categories/Linux-note/"},{"name":"MongoDB","slug":"MongoDB","link":"/categories/MongoDB/"},{"name":"NestJS","slug":"NestJS","link":"/categories/NestJS/"},{"name":"HTTP","slug":"HTTP","link":"/categories/HTTP/"},{"name":"PyQt","slug":"PyQt","link":"/categories/PyQt/"},{"name":"TypeScript","slug":"TypeScript","link":"/categories/TypeScript/"},{"name":"Python","slug":"Python","link":"/categories/Python/"},{"name":"æ€»ç»“","slug":"æ€»ç»“","link":"/categories/%E6%80%BB%E7%BB%93/"},{"name":"WebRTC","slug":"WebRTC","link":"/categories/WebRTC/"},{"name":"unclassified","slug":"unclassified","link":"/categories/unclassified/"}],"pages":[{"title":"RustFisher","text":"è½¯ä»¶å·¥ç¨‹å¸ˆã€‚ä»äº‹Android Appå¼€å‘å·¥ä½œã€‚ä¸»è¦å¼€å‘è¯­è¨€æ˜¯Javaã€‚ä¹Ÿåœ¨å­¦ä¹ Kotlinã€‚ä¼šç”¨Pythonå†™è„šæœ¬ï¼Œåˆ†ææ•°æ®ã€‚ç†Ÿæ‚‰Linuxçš„ä¸€äº›æ“ä½œã€‚ æœ€è¿‘åœ¨å®Œå–„Android 2020ã€‚Androidæ–¹é¢çš„å†…å®¹ï¼Œä¼šæ”¾åˆ° https://an.rustfisher.com éœ€è¦ç”¨ä»€ä¹ˆï¼Œå°±å»å­¦ä»€ä¹ˆã€‚ è”ç³» é‚®ç®± rustfisher@foxmail.com Github https://github.com/RustFisher","link":"/about/index.html"},{"title":"Categories","text":"","link":"/categories/index.html"},{"title":"Tags","text":"","link":"/tags/index.html"},{"title":"","text":"Awesome-pyecharts var chart_2db4c0f0b55642b9a92be47416c6ea60 = echarts.init( document.getElementById('2db4c0f0b55642b9a92be47416c6ea60'), 'white', {renderer: 'canvas'}); var option_2db4c0f0b55642b9a92be47416c6ea60 = { \"animation\": true, \"animationThreshold\": 2000, \"animationDuration\": 1000, \"animationEasing\": \"cubicOut\", \"animationDelay\": 0, \"animationDurationUpdate\": 300, \"animationEasingUpdate\": \"cubicOut\", \"animationDelayUpdate\": 0, \"color\": [ \"#c23531\", \"#2f4554\", \"#61a0a8\", \"#d48265\", \"#749f83\", \"#ca8622\", \"#bda29a\", \"#6e7074\", \"#546570\", \"#c4ccd3\", \"#f05b72\", \"#ef5b9c\", \"#f47920\", \"#905a3d\", \"#fab27b\", \"#2a5caa\", \"#444693\", \"#726930\", \"#b2d235\", \"#6d8346\", \"#ac6767\", \"#1d953f\", \"#6950a1\", \"#918597\" ], \"series\": [ { \"type\": \"funnel\", \"name\": \"\\u6f0f\\u65971\", \"data\": [ { \"name\": \"e1\", \"value\": 10000 }, { \"name\": \"e2\", \"value\": 4695 }, { \"name\": \"e3\", \"value\": 2584 }, { \"name\": \"e4\", \"value\": 1295 }, { \"name\": \"e5\", \"value\": 954 }, { \"name\": \"e6\", \"value\": 452 } ], \"sort\": \"descending\", \"gap\": 0, \"label\": { \"show\": true, \"position\": \"top\", \"margin\": 8 } } ], \"legend\": [ { \"data\": [ \"e4\", \"e1\", \"e3\", \"e2\", \"e5\", \"e6\" ], \"selected\": { \"e1\": true, \"e2\": true, \"e3\": true, \"e4\": true, \"e5\": true, \"e6\": true }, \"show\": true, \"padding\": 5, \"itemGap\": 10, \"itemWidth\": 25, \"itemHeight\": 14 } ], \"tooltip\": { \"show\": true, \"trigger\": \"item\", \"triggerOn\": \"mousemove|click\", \"axisPointer\": { \"type\": \"line\" }, \"showContent\": true, \"alwaysShowContent\": false, \"showDelay\": 0, \"hideDelay\": 100, \"textStyle\": { \"fontSize\": 14 }, \"borderWidth\": 0, \"padding\": 5 }, \"title\": [ { \"text\": \"\\u6f0f\\u6597\\u56fe1\", \"subtext\": \"\\u9ed8\\u8ba4\\u6837\\u5f0f\", \"padding\": 5, \"itemGap\": 10 } ] }; chart_2db4c0f0b55642b9a92be47416c6ea60.setOption(option_2db4c0f0b55642b9a92be47416c6ea60);","link":"/art/py/op-funnel/funnel_chart_1.html"},{"title":"","text":"Awesome-pyecharts var chart_27de115518aa451f93c8773b843bc825 = echarts.init( document.getElementById('27de115518aa451f93c8773b843bc825'), 'white', {renderer: 'canvas'}); var option_27de115518aa451f93c8773b843bc825 = { \"animation\": true, \"animationThreshold\": 2000, \"animationDuration\": 1000, \"animationEasing\": \"cubicOut\", \"animationDelay\": 0, \"animationDurationUpdate\": 300, \"animationEasingUpdate\": \"cubicOut\", \"animationDelayUpdate\": 0, \"color\": [ \"#c23531\", \"#2f4554\", \"#61a0a8\", \"#d48265\", \"#749f83\", \"#ca8622\", \"#bda29a\", \"#6e7074\", \"#546570\", \"#c4ccd3\", \"#f05b72\", \"#ef5b9c\", \"#f47920\", \"#905a3d\", \"#fab27b\", \"#2a5caa\", \"#444693\", \"#726930\", \"#b2d235\", \"#6d8346\", \"#ac6767\", \"#1d953f\", \"#6950a1\", \"#918597\" ], \"series\": [ { \"type\": \"funnel\", \"name\": \"\\u6f0f\\u65971\", \"data\": [ { \"name\": \"e1\", \"value\": 10000 }, { \"name\": \"e2\", \"value\": 4695 }, { \"name\": \"e3\", \"value\": 2584 }, { \"name\": \"e4\", \"value\": 1295 }, { \"name\": \"e5\", \"value\": 954 }, { \"name\": \"e6\", \"value\": 452 } ], \"sort\": \"descending\", \"gap\": 2, \"label\": { \"show\": true, \"position\": \"inside\", \"margin\": 8, \"formatter\": \"{b} \\u6570\\u91cf: {c}\" }, \"tooltip\": { \"show\": true, \"trigger\": \"item\", \"triggerOn\": \"mousemove|click\", \"axisPointer\": { \"type\": \"line\" }, \"showContent\": true, \"alwaysShowContent\": false, \"showDelay\": 0, \"hideDelay\": 100, \"formatter\": \"{a} {b} \\u6570\\u91cf: {c}\", \"textStyle\": { \"fontSize\": 14 }, \"borderWidth\": 0, \"padding\": 5 } } ], \"legend\": [ { \"data\": [ \"e4\", \"e1\", \"e3\", \"e2\", \"e5\", \"e6\" ], \"selected\": { \"e1\": true, \"e2\": true, \"e3\": true, \"e4\": true, \"e5\": true, \"e6\": true }, \"show\": true, \"padding\": 5, \"itemGap\": 10, \"itemWidth\": 25, \"itemHeight\": 14 } ], \"tooltip\": { \"show\": true, \"trigger\": \"item\", \"triggerOn\": \"mousemove|click\", \"axisPointer\": { \"type\": \"line\" }, \"showContent\": true, \"alwaysShowContent\": false, \"showDelay\": 0, \"hideDelay\": 100, \"textStyle\": { \"fontSize\": 14 }, \"borderWidth\": 0, \"padding\": 5 }, \"title\": [ { \"text\": \"\\u6f0f\\u6597\\u56fe1\", \"subtext\": \"\\u6539\\u53d8\\u4e86label\", \"padding\": 5, \"itemGap\": 10 } ] }; chart_27de115518aa451f93c8773b843bc825.setOption(option_27de115518aa451f93c8773b843bc825);","link":"/art/py/op-funnel/funnel_chart_2.html"},{"title":"","text":"Awesome-pyecharts var chart_ec8d0b5a5e6e476db93b96c76a92d53f = echarts.init( document.getElementById('ec8d0b5a5e6e476db93b96c76a92d53f'), 'white', {renderer: 'canvas'}); var option_ec8d0b5a5e6e476db93b96c76a92d53f = { \"animation\": true, \"animationThreshold\": 2000, \"animationDuration\": 1000, \"animationEasing\": \"cubicOut\", \"animationDelay\": 0, \"animationDurationUpdate\": 300, \"animationEasingUpdate\": \"cubicOut\", \"animationDelayUpdate\": 0, \"color\": [ \"#c23531\", \"#2f4554\", \"#61a0a8\", \"#d48265\", \"#749f83\", \"#ca8622\", \"#bda29a\", \"#6e7074\", \"#546570\", \"#c4ccd3\", \"#f05b72\", \"#ef5b9c\", \"#f47920\", \"#905a3d\", \"#fab27b\", \"#2a5caa\", \"#444693\", \"#726930\", \"#b2d235\", \"#6d8346\", \"#ac6767\", \"#1d953f\", \"#6950a1\", \"#918597\" ], \"series\": [ { \"type\": \"funnel\", \"name\": \"\\u6f0f\\u65971\", \"data\": [ { \"name\": \"e1\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 100.00%\", \"value\": 10000 }, { \"name\": \"e2\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 46.95%\\n\\u76f8\\u5bf9\\u8f6c\\u5316\\u7387: 46.95%\", \"value\": 4695 }, { \"name\": \"e3\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 25.84%\\n\\u76f8\\u5bf9\\u8f6c\\u5316\\u7387: 55.04%\", \"value\": 2584 }, { \"name\": \"e4\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 12.95%\\n\\u76f8\\u5bf9\\u8f6c\\u5316\\u7387: 50.12%\", \"value\": 1295 }, { \"name\": \"e5\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 9.54%\\n\\u76f8\\u5bf9\\u8f6c\\u5316\\u7387: 73.67%\", \"value\": 954 }, { \"name\": \"e6\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 4.52%\\n\\u76f8\\u5bf9\\u8f6c\\u5316\\u7387: 47.38%\", \"value\": 452 } ], \"sort\": \"descending\", \"gap\": 2, \"label\": { \"show\": true, \"position\": \"inside\", \"margin\": 8, \"formatter\": \"{b}\\n\\u6570\\u91cf: {c}\" }, \"tooltip\": { \"show\": true, \"trigger\": \"item\", \"triggerOn\": \"mousemove|click\", \"axisPointer\": { \"type\": \"line\" }, \"showContent\": true, \"alwaysShowContent\": false, \"showDelay\": 0, \"hideDelay\": 100, \"formatter\": \"{a} {b} \\u6570\\u91cf: {c}\", \"textStyle\": { \"fontSize\": 14 }, \"borderWidth\": 0, \"padding\": 5 } } ], \"legend\": [ { \"data\": [ \"e2\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 46.95%\\n\\u76f8\\u5bf9\\u8f6c\\u5316\\u7387: 46.95%\", \"e1\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 100.00%\", \"e3\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 25.84%\\n\\u76f8\\u5bf9\\u8f6c\\u5316\\u7387: 55.04%\", \"e5\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 9.54%\\n\\u76f8\\u5bf9\\u8f6c\\u5316\\u7387: 73.67%\", \"e4\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 12.95%\\n\\u76f8\\u5bf9\\u8f6c\\u5316\\u7387: 50.12%\", \"e6\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 4.52%\\n\\u76f8\\u5bf9\\u8f6c\\u5316\\u7387: 47.38%\" ], \"selected\": { \"e1\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 100.00%\": true, \"e2\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 46.95%\\n\\u76f8\\u5bf9\\u8f6c\\u5316\\u7387: 46.95%\": true, \"e3\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 25.84%\\n\\u76f8\\u5bf9\\u8f6c\\u5316\\u7387: 55.04%\": true, \"e4\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 12.95%\\n\\u76f8\\u5bf9\\u8f6c\\u5316\\u7387: 50.12%\": true, \"e5\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 9.54%\\n\\u76f8\\u5bf9\\u8f6c\\u5316\\u7387: 73.67%\": true, \"e6\\n\\u603b\\u4f53\\u8f6c\\u5316\\u7387: 4.52%\\n\\u76f8\\u5bf9\\u8f6c\\u5316\\u7387: 47.38%\": true }, \"show\": true, \"padding\": 5, \"itemGap\": 10, \"itemWidth\": 25, \"itemHeight\": 14 } ], \"tooltip\": { \"show\": true, \"trigger\": \"item\", \"triggerOn\": \"mousemove|click\", \"axisPointer\": { \"type\": \"line\" }, \"showContent\": true, \"alwaysShowContent\": false, \"showDelay\": 0, \"hideDelay\": 100, \"textStyle\": { \"fontSize\": 14 }, \"borderWidth\": 0, \"padding\": 5 }, \"title\": [ { \"text\": \"\\u6f0f\\u6597\\u56fe1\", \"subtext\": \"\\u4fee\\u6539\\u4e86\\u5404\\u9879\\u7684\\u6807\\u9898\", \"padding\": 5, \"itemGap\": 10 } ] }; chart_ec8d0b5a5e6e476db93b96c76a92d53f.setOption(option_ec8d0b5a5e6e476db93b96c76a92d53f);","link":"/art/py/op-funnel/funnel_chart_3.html"}]}