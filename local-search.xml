<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ã€Šå·¨äººçš„æ–¹æ³•ã€‹è¯»ä¹¦ç¬”è®°</title>
    <link href="/2023/04/11/reading/SocialScience/TRIBE-OF-MENTORS-note/"/>
    <url>/2023/04/11/reading/SocialScience/TRIBE-OF-MENTORS-note/</url>
    
    <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>ä½œè€…ï¼šè’‚å§†Â·è´¹é‡Œæ–¯</p><p>é€šè¿‡ä¸€äº›ç®€çŸ­çš„å¯¹è¯ï¼Œä¼ å¥‡çš„åˆ›ä¸šå®¶ã€æŠ•èµ„äººã€è‰ºæœ¯å®¶ã€ä½œå®¶ã€ç§‘å­¦å®¶ã€ç”µå½±äººã€è¿åŠ¨å‘˜ã€æ•™è‚²å®¶ï¼Œä¸ä½ åˆ†äº«ä»–ä»¬æ·±åˆ»çš„å¤±è´¥ã€å€¼å¾—çš„æŠ•èµ„ã€è’è¯çš„ä¹ æƒ¯ã€å¸¸å½“ä½œç¤¼ç‰©é€ç»™ä»–äººçš„ä¹¦ã€å¬è¿‡æœ€ç³Ÿçš„å»ºè®®ã€å¿™ç¢Œçš„æ—¶å€™å¦‚ä½•æ”¾æ¾ã€å¦‚ä½•é‡æ‹¾ä¸“æ³¨åŠ›â€¦â€¦</p><h2 id="ç¬”è®°"><a href="#ç¬”è®°" class="headerlink" title="ç¬”è®°"></a>ç¬”è®°</h2><h3 id="å¤§è„‘åƒèº«ä½“ä¸€æ ·æœ‰éŸ§æ€§"><a href="#å¤§è„‘åƒèº«ä½“ä¸€æ ·æœ‰éŸ§æ€§" class="headerlink" title="å¤§è„‘åƒèº«ä½“ä¸€æ ·æœ‰éŸ§æ€§"></a>å¤§è„‘åƒèº«ä½“ä¸€æ ·æœ‰éŸ§æ€§</h3><p>ç—›è‹¦èƒ½ä»¤äººæ¸…é†’ï¼Œç—›è‹¦çš„æ—¶å€™ä½ æ— æ³•å†å¦è®¤å½“ä¸‹çš„çœŸç›¸ï¼Œä½ å°†è¢«è¿«åšå‡ºä»¤ä½ ä¸é€‚çš„æ”¹å˜ã€‚</p><p>æŠŠä½ çš„æ±‚çŸ¥æ¬²èšç„¦åœ¨å½“å‰çš„â€œçƒ­é—¨â€äº‹ç‰©ä¸Šã€‚å¦‚æœä½ çš„æ±‚çŸ¥æ¬²æŠŠä½ å¸¦åˆ°ç¤¾ä¼šæœ€ç»ˆæƒ³è¦åˆ°è¾¾çš„åœ°æ–¹ï¼Œä½ å°†è·å¾—ä¸°åšçš„æŠ¥é…¬ã€‚åšä»»ä½•ä½ æƒ³åšçš„äº‹ï¼Œä½†ä¸è¦é‚£ä¹ˆç„¦è™‘ã€ç—›è‹¦ã€æƒ…ç»ªåŒ–ã€‚æ‰€æœ‰äº‹æƒ…éƒ½æ˜¯éœ€è¦æ—¶é—´çš„ã€‚</p><p>å¿½ç•¥ä¸å…¬å¹³ï¼Œä¸–ä¸Šæ²¡æœ‰å…¬å¹³å¯è¨€ã€‚å°½ä½ æ‰€èƒ½å‘æŒ¥è‡ªå·±çš„æ‰èƒ½ã€‚</p><h3 id="ä½œå®¶åº”ä¸“æ³¨äºè‡ªå·±çš„å†…å¿ƒï¼Œä¸è¦æ€»æ€è€ƒè¯»è€…æƒ³è¯»ä»€ä¹ˆ"><a href="#ä½œå®¶åº”ä¸“æ³¨äºè‡ªå·±çš„å†…å¿ƒï¼Œä¸è¦æ€»æ€è€ƒè¯»è€…æƒ³è¯»ä»€ä¹ˆ" class="headerlink" title="ä½œå®¶åº”ä¸“æ³¨äºè‡ªå·±çš„å†…å¿ƒï¼Œä¸è¦æ€»æ€è€ƒè¯»è€…æƒ³è¯»ä»€ä¹ˆ"></a>ä½œå®¶åº”ä¸“æ³¨äºè‡ªå·±çš„å†…å¿ƒï¼Œä¸è¦æ€»æ€è€ƒè¯»è€…æƒ³è¯»ä»€ä¹ˆ</h3><p>å¦‚æœæœ‰æˆªæ­¢æ—¥æœŸï¼Œæˆ‘å°±ä¼šåœ¨é‚£ä¹‹å‰å®Œæˆå·¥ä½œï¼Œä½†å¦‚æœæ²¡æœ‰ï¼Œæˆ‘çš„æ•ˆç‡å°±ä¼šéå¸¸ä½ã€‚æˆ‘è¿˜å‘ç°ï¼Œè‡ªå·±ä¼šä¸€ç›´å¤„äºå·¥ä½œçŠ¶æ€ã€‚æˆ‘å¾ˆå°‘èƒ½é•¿æ—¶é—´å…¨ç¥è´¯æ³¨åœ°å·¥ä½œï¼Œä¹Ÿå¾ˆå°‘èƒ½æ— å¿§æ— è™‘åœ°ä¼‘æ¯ã€‚</p><p>æ™šä¸Šå·¥ä½œä¼šæ‰¼æ€ç¤¾äº¤ç”Ÿæ´»ï¼Œå› ä¸ºå¤§å¤šæ•°ç¤¾äº¤ç”Ÿæ´»éƒ½å‘ç”Ÿåœ¨å‘¨æœ«ä»¥åŠå·¥ä½œæ—¥çš„æ™šä¸Š7ç‚¹è‡³11ç‚¹ä¹‹é—´ã€‚å¦‚æœåœ¨è¿™æ®µæ—¶é—´å·¥ä½œï¼Œä½ å°±ä¼šçªç„¶æˆä¸ºé‚£ä¸ªåˆ«äººæ°¸è¿œéƒ½çº¦ä¸åˆ°çš„æœ‹å‹ï¼Œè¿™ç§åšæ³•æ˜¯æå…¶çŸ­è§†çš„ï¼Œä¹Ÿæ˜¯ä¸æ˜æ™ºçš„ã€‚</p><p>å½“æˆ‘è®¾è®¡å·¥ä½œä¸Šçš„æ¥å—æ¸…å•æ—¶ï¼Œæˆ‘ä¼šä½¿ç”¨ä¸€ç§æ–¹æ³•ï¼Œæˆ‘ç§°å…¶ä¸ºâ€œå¢“å¿—é“­æµ‹è¯•â€ã€‚å¦‚æœç¢°åˆ°ä»€ä¹ˆæœºä¼šï¼Œæˆ‘ä¼šé—®è‡ªå·±ï¼Œå¦‚æœæˆ‘çš„å¢“å¿—é“­å†™ä¸Šç›¸å…³å†…å®¹ï¼Œæˆ‘æ˜¯å¦ä¼šæ„Ÿåˆ°é«˜å…´ã€‚ç­”æ¡ˆå¦‚æœæ˜æ˜¾æ˜¯å¦å®šçš„ï¼Œå°±æ„å‘³ç€è¿™ä¸ªæœºä¼šå¯¹æˆ‘è€Œè¨€å¹¶éååˆ†é‡è¦ã€‚</p><p>ç—…æ¦»æµ‹è¯•ä¼šä¿ƒä½¿æˆ‘é—®è‡ªå·±ä¸¤ä¸ªé—®é¢˜ï¼šâ€œå½“æˆ‘ä¸´ç»ˆæ—¶ï¼Œæˆ‘å¯èƒ½ä¼šæƒ³è¿™ä¸ªäººå—ï¼Ÿâ€é€šè¿‡è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘å¯ä»¥ç¡®ä¿æŠŠæ—¶é—´èŠ±åœ¨åˆé€‚çš„äººèº«ä¸Šã€‚</p><blockquote><p>ç±»ä¼¼çš„æ€è€ƒæ–¹æ³•è¿˜æœ‰â€œé—æ„¿æ¸…å•â€</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>reading</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è¯»ä¹¦ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç½‘ç«™èµ„æºè¿ç§»è¯´æ˜</title>
    <link href="/2023/01/18/unclassified/web-res-move-2023/"/>
    <url>/2023/01/18/unclassified/web-res-move-2023/</url>
    
    <content type="html"><![CDATA[<h1 id="ç½‘ç«™è¿ç§»è¯´æ˜"><a href="#ç½‘ç«™è¿ç§»è¯´æ˜" class="headerlink" title="ç½‘ç«™è¿ç§»è¯´æ˜"></a>ç½‘ç«™è¿ç§»è¯´æ˜</h1><p>åšå®¢ç«™ blog.rustfisher.com å’Œæ•™ç¨‹ç«™ an.rustfisher.com çš„ç½‘ç«™èµ„æºå·²ç»ä¸Šä¼ åˆ°githubã€‚</p><ul><li><a href="https://github.com/RustFisher/rustfisher.github.io">rustfisher.github.io - github</a></li><li><a href="https://github.com/AnRFDev/AnRFDev.github.io">AnRFDev.github.io - github</a></li></ul><p>å¹¶æ‰˜ç®¡åœ¨cloudflare</p><ul><li><a href="an.rustfisher.com">an.rustfisher.com</a> -&gt; anrfdev-github-io.pages.dev</li><li><a href="blog.rustfisher.com">blog.rustfisher.com</a> -&gt; rustfisher-github-io.pages.dev</li></ul><p>è‹¥è®¿é—®é€Ÿåº¦è¿‡æ…¢ï¼Œå¯è€ƒè™‘ä½¿ç”¨ğŸªœ</p>]]></content>
    
    
    <categories>
      
      <category>unclassified</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>2021å¹´11æœˆæ€»ç»“</title>
    <link href="/2021/11/30/Summary/2021-11/"/>
    <url>/2021/11/30/Summary/2021-11/</url>
    
    <content type="html"><![CDATA[<h2 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h2><h3 id="æ–‡ç« "><a href="#æ–‡ç« " class="headerlink" title="æ–‡ç« "></a>æ–‡ç« </h3><ul><li><a href="https://an.rustfisher.com/android/jetpack/compose/compose-sample-proj1/">Jetpack Composeå¼•å…¥ç¤ºä¾‹å·¥ç¨‹ | AnRFDev</a></li><li><a href="https://an.rustfisher.com/android/jetpack/compose/use-compose-in-proj/">ç°æœ‰å·¥ç¨‹ä½¿ç”¨Compose | AnRFDev</a></li><li><a href="https://an.rustfisher.com/android/ui/widget/seekbar/seekbar-custom-thumb-animation/">Android SeekBar è‡ªå®šä¹‰thumbï¼Œthumbæ—‹è½¬åŠ¨ç”»æ•ˆæœ | AnRFDev</a></li></ul><h3 id="è§†é¢‘"><a href="#è§†é¢‘" class="headerlink" title="è§†é¢‘"></a>è§†é¢‘</h3><ul><li><a href="https://www.bilibili.com/video/BV1oY411W7oa">ã€Androidå¼€å‘åŸºç¡€ã€‘03-æ”¹é€ åˆå§‹å·¥ç¨‹ - bilibili</a><ul><li><a href="https://www.zhihu.com/zvideo/1447344528176455680">çŸ¥ä¹è§†é¢‘</a></li></ul></li></ul><h2 id="WebRTC"><a href="#WebRTC" class="headerlink" title="WebRTC"></a>WebRTC</h2><ul><li><a href="https://an.rustfisher.com/webrtc/intro/concept-intro/">WebRTCæ¦‚å¿µç®€ä»‹ | AnRFDev</a></li><li><a href="https://an.rustfisher.com/webrtc/web-samples/getUserMedia-open-camera/">WebRTCæ‰“å¼€æœ¬åœ°æ‘„åƒå¤´ | AnRFDev</a></li><li><a href="https://an.rustfisher.com/webrtc/web-samples/canvas1/">WebRTCä»æ‘„åƒå¤´è·å–å›¾ç‰‡ä¼ å…¥canvas | AnRFDev</a></li><li><a href="https://an.rustfisher.com/webrtc/web-samples/css-filters/">WebRTCä¸CSSæ»¤é•œï¼ˆfilterï¼‰ | AnRFDev</a></li></ul><h2 id="ç¤¾åŒº"><a href="#ç¤¾åŒº" class="headerlink" title="ç¤¾åŒº"></a>ç¤¾åŒº</h2><h3 id="åä¸ºäº‘ç¤¾åŒº"><a href="#åä¸ºäº‘ç¤¾åŒº" class="headerlink" title="åä¸ºäº‘ç¤¾åŒº"></a>åä¸ºäº‘ç¤¾åŒº</h3><ul><li><a href="https://bbs.huaweicloud.com/blogs/308726">å¦‚ä½•å¿«é€Ÿå¾—åˆ°ä¸€ä¸ªåœ¨çº¿é—®å·åº”ç”¨ï¼Ÿï½œã€ç©è½¬åº”ç”¨é­”æ–¹ã€‘</a></li><li><a href="https://bbs.huaweicloud.com/blogs/308935">åä¸ºäº‘è¯­éŸ³äº¤äº’å®æˆ˜ï½œã€æˆ‘ä»¬éƒ½æ˜¯åä¸ºäº‘ä¸“å®¶ã€‘</a></li><li><a href="https://bbs.huaweicloud.com/blogs/312616">ã€äº‘é©»å…±åˆ›ã€‘åŒºå—é“¾æŠ€æœ¯æ˜¯å¦‚ä½•å½±å“å„ä¸ªäº§ä¸šçš„ï¼Ÿ</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ€»ç»“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WebRTC</tag>
      
      <tag>æ€»ç»“</tag>
      
      <tag>Android</tag>
      
      <tag>åä¸ºäº‘ç¤¾åŒº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>WebRTCæ¦‚å¿µä»‹ç»</title>
    <link href="/2021/11/09/WebRTC/webRTC-concept-intro/"/>
    <url>/2021/11/09/WebRTC/webRTC-concept-intro/</url>
    
    <content type="html"><![CDATA[<p><img src="guide-1.png" alt="æœ¬æ–‡å¤§çº²"></p><h2 id="WebRTC"><a href="#WebRTC" class="headerlink" title="WebRTC"></a>WebRTC</h2><p>WebRTCï¼ˆWeb Real-Time Communicationï¼‰ã€‚Real-Time Communicationï¼Œå®æ—¶é€šè®¯ã€‚</p><p>WebRTCèƒ½è®©webåº”ç”¨å’Œç«™ç‚¹ä¹‹é—´é€‰æ‹©æ€§åœ°åˆ†äº«éŸ³è§†é¢‘æµã€‚åœ¨ä¸å®‰è£…å…¶å®ƒåº”ç”¨å’Œæ’ä»¶çš„æƒ…å†µä¸‹ï¼Œå®Œæˆç‚¹å¯¹ç‚¹é€šä¿¡ã€‚<br>WebRTCèƒŒåçš„æŠ€æœ¯è¢«å®ç°ä¸ºä¸€ä¸ªå¼€æ”¾çš„Webæ ‡å‡†ï¼Œå¹¶åœ¨æ‰€æœ‰ä¸»è¦æµè§ˆå™¨ä¸­å‡ä»¥å¸¸è§„JavaScript APIçš„å½¢å¼æä¾›ã€‚å¯¹äºå®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚Androidå’ŒiOSï¼‰ï¼Œå¯ä»¥ä½¿ç”¨æä¾›ç›¸åŒåŠŸèƒ½çš„åº“ã€‚ WebRTCæ˜¯ä¸ª<a href="https://github.com/webrtc">å¼€æºé¡¹ç›®</a>ï¼Œå¾—åˆ°Googleï¼ŒAppleï¼ŒMicrosoftå’ŒMozillaç­‰ç­‰å…¬å¸çš„æ”¯æŒã€‚2011å¹´6æœˆ1æ—¥å¼€æºå¹¶åœ¨Googleã€Mozillaã€Operaæ”¯æŒä¸‹è¢«çº³å…¥ä¸‡ç»´ç½‘è”ç›Ÿçš„W3Cæ¨èæ ‡å‡†ã€‚</p><p>WebRTCåŒ…æ‹¬ä¸€ç³»åˆ—APIå’Œç›¸äº’å…³è”çš„åè®®æ¥å®ç°é€šä¿¡ã€‚</p><h2 id="ç›¸å…³æŠ€æœ¯"><a href="#ç›¸å…³æŠ€æœ¯" class="headerlink" title="ç›¸å…³æŠ€æœ¯"></a>ç›¸å…³æŠ€æœ¯</h2><h3 id="VoIP"><a href="#VoIP" class="headerlink" title="VoIP"></a>VoIP</h3><p>Voice over Internet Protocolï¼Œåœ¨ç½‘ç»œä¸Šä¼ è¾“å£°éŸ³æ¶ˆæ¯çš„æŠ€æœ¯ã€‚<br>ä¾‹å¦‚ç½‘ç»œéŸ³é¢‘é€šè¯ã€‚æˆ–è€…å«åšIPç”µè¯ï¼Œå®½å¸¦ç”µè¯ã€‚ä½¿ç”¨VoIPæŠ€æœ¯çš„ä¸€å¤§åŸå› æ˜¯è´¹ç”¨ä½ã€‚</p><h2 id="ç›¸å…³åè®®"><a href="#ç›¸å…³åè®®" class="headerlink" title="ç›¸å…³åè®®"></a>ç›¸å…³åè®®</h2><h3 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a>NAT</h3><p>Network address translationï¼Œç½‘ç»œåœ°å€è½¬æ¢ã€‚<br>NATèƒ½ç»™ä½ çš„è®¾å¤‡ä¸€ä¸ªå…¬å…±IPåœ°å€ã€‚ä¸€ä¸ªè·¯ç”±å™¨ï¼ˆrouterï¼‰æœ‰ä¸€ä¸ªå…¬å…±IPåœ°å€ï¼Œæ¯ä¸ªè¿æ¥åˆ°è·¯ç”±çš„è®¾å¤‡æœ‰ä¸€ä¸ªç§æœ‰çš„IPåœ°å€ã€‚<br>è®¾å¤‡å‘é€è¯·æ±‚æ—¶ï¼Œä¼šä»ä¸€ä¸ªç‰¹å®šç«¯å£ï¼Œé€šè¿‡ç§æœ‰IPå‘é€åˆ°è·¯ç”±çš„å…¬å…±IPã€‚è¿™æ ·æ¯ä¸ªè®¾å¤‡åœ¨ç½‘ä¸Šä¸éœ€è¦éƒ½æœ‰ä¸€ä¸ªå…¬å…±IPåœ°å€ï¼Œä½†ä¹Ÿèƒ½è¢«å…¶å®ƒè®¾å¤‡å‘ç°ã€‚</p><p>å‚è€ƒ <a href="https://datatracker.ietf.org/doc/html/rfc2663">IP Network Address Translator (NAT) Terminology and Considerations</a></p><h3 id="ICE"><a href="#ICE" class="headerlink" title="ICE"></a>ICE</h3><p>Interactive Connectivity Establishmentï¼Œäº’åŠ¨å¼è¿æ¥å»ºç«‹ï¼ˆäº¤äº’å¼è¿é€šæ€§å»ºç«‹ï¼‰ã€‚<br>ICEæ˜¯ä¸€å¥—èƒ½è®©webæµè§ˆå™¨ä¹‹é—´äº’ç›¸è¿æ¥çš„æ¡†æ¶ã€‚é€šå¸¸æ¥è¯´ï¼ŒèŠ‚ç‚¹Aåˆ°Bæ˜¯å¾ˆéš¾ç›´æ¥ç›¸è¿çš„ã€‚é˜²ç«å¢™ä¼šé˜»æ­¢è¿æ¥ï¼Œè®¾å¤‡æ²¡æœ‰å…¬å…±IPåœ°å€ï¼Œè·¯ç”±ä¸å…è®¸ç›´æ¥è¿æ¥å…¶ä»–èŠ‚ç‚¹ã€‚<br>ICEä½¿ç”¨STUNæˆ–è€…TURNæœåŠ¡ï¼ˆæˆ–è€…åŒæ—¶ä½¿ç”¨ä¸¤è€…ï¼‰æ¥å»ºç«‹è¿æ¥ã€‚</p><p>å‚è€ƒ <a href="https://www.ietf.org/rfc/rfc8445.txt">ICE | rfc8445</a></p><h3 id="STUN"><a href="#STUN" class="headerlink" title="STUN"></a>STUN</h3><p>Session Traversal Utilities for NAT (STUN) ï¼ŒNATä¼šè¯ä¼ è¾“å·¥å…·ã€‚<br>STUNåè®®èƒ½å‘ç°å®¢æˆ·ç«¯ï¼ˆèŠ‚ç‚¹ï¼‰çš„å…¬å…±åœ°å€ã€‚å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚ç»™ç½‘ä¸Šçš„STUNæœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨è¿”å›å®¢æˆ·ç«¯çš„å…¬å…±åœ°å€ã€‚ä¸ç®¡å®¢æˆ·ç«¯åœ¨è·¯ç”±å™¨çš„NATåèƒ½å¦å¯è¾¾ã€‚<br>STUNä¸ºè¯·æ±‚è€…æä¾›äº†å¯å…¬å¼€è®¿é—®çš„IPåœ°å€ï¼Œå®ƒå°±ä¸å†å‚ä¸å¯¹è¯äº†ã€‚</p><p><img src="webrtc-stun.png" alt="STUN"></p><p>æœ‰äº›è·¯ç”±å™¨ä¼šé™åˆ¶è®¾å¤‡ä¸å¤–é¢å…¶å®ƒè®¾å¤‡çš„è¿æ¥ã€‚è¿™æ„å‘³ç€å³ä½¿STUNæœåŠ¡å™¨çŸ¥é“äº†è·¯ç”±çš„å…¬å…±IPåœ°å€ï¼Œä¹Ÿæ²¡æ³•å»ºç«‹è¿æ¥ã€‚<br>è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦ä½¿ç”¨<strong>TURN</strong>ã€‚</p><h3 id="TURN"><a href="#TURN" class="headerlink" title="TURN"></a>TURN</h3><p>Traversal Using Relays around NATï¼Œä½¿ç”¨ä¸­ç»§ç»•è¿‡NATä¼ è¾“ã€‚<br>ä¸€äº›è·¯ç”±å™¨ä½¿ç”¨ä¸€ç§å«â€œSymmetric NATâ€ï¼ˆå¯¹ç§°å‹NATï¼‰çš„é™åˆ¶ã€‚è¿™æ„å‘³ç€è·¯ç”±å™¨ä»…å…è®¸ä¹‹å‰è¿æ¥è¿‡çš„èŠ‚ç‚¹ï¼ˆpeerï¼‰æ¥å»ºç«‹è¿æ¥ã€‚</p><p><strong>STUN</strong>æä¾›äº†ä¸€ä¸ªèƒ½è®©åº”ç”¨ï¼ˆç»ˆç«¯ï¼ŒèŠ‚ç‚¹ï¼‰ç©¿è¿‡NATçš„æ–¹æ³•ã€‚STUNå…è®¸å®¢æˆ·ç«¯è·å¾—ä¸€ä¸ªä¼ è¾“åœ°å€ï¼ˆä¸€ä¸ªIPå’Œç«¯å£ï¼‰æ¥è·å–å…¶å®ƒèŠ‚ç‚¹çš„æ•°æ®ã€‚<br>ç„¶è€ŒSTUNè·å–åˆ°çš„åœ°å€ä¸ä¸€å®šèƒ½è¢«æ‰€æœ‰èŠ‚ç‚¹ä½¿ç”¨ã€‚è¿™äº›åœ°å€æ˜¯å¦å¯ç”¨å–å†³äºç½‘ç»œæ‹“æ‰‘çš„æƒ…å†µã€‚æ‰€ä»¥ï¼Œå•ç‹¬STUNæ— æ³•æä¾›å®Œæ•´çš„ç©¿è¶ŠNATçš„æ–¹æ¡ˆã€‚</p><p>TURNåè®®å…è®¸ä¸¤ä¸ªå¤„äºNATç¯å¢ƒçš„ä¸»æœºåˆ©ç”¨ä¸­ç»§è¿›è¡Œé€šè®¯ã€‚å®¢æˆ·ç«¯èƒ½å¤Ÿåœ¨TURNæœåŠ¡å™¨ä¸Šåˆ†é…èµ„æºï¼Œä¸å…¶å®ƒå®¢æˆ·ç«¯ï¼ˆpeerï¼‰è¿›è¡Œé€šè®¯ã€‚<br>å®¢æˆ·ç«¯å…³è”ä¸€ä¸ªTURNæœåŠ¡å™¨çš„åœ°å€ï¼ˆrelayed server addressï¼‰æ¥ä½œä¸ºä¸­ç»§ã€‚<br>å®¢æˆ·ç«¯å‘é€æŠ¥æ–‡ç»™TURNæœåŠ¡ï¼ŒTURNæœåŠ¡ä½¿ç”¨relayed server addressä½œä¸ºæºåœ°å€å‘å…¶ä»–å®¢æˆ·ç«¯ä¸­ç»§è½¬å‘æŠ¥æ–‡ã€‚<br>ç©¿è¶ŠNATï¼Œè¿™ä¸ªè¿‡ç¨‹å°±åƒæ˜¯â€œæ‰“æ´â€ã€‚ä¹Ÿæœ‰äººç§°TURNæœåŠ¡å™¨ä¸ºâ€œæ‰“æ´æœåŠ¡å™¨â€ã€‚</p><p><img src="webrtc-turn.png" alt="TURN"></p><p>è¿™ä¹ˆçœ‹ï¼ŒTURNæœåŠ¡å™¨éœ€è¦æœ‰å¤§çš„å¸¦å®½ã€‚å› æ­¤ï¼ŒICEä¼šä¼˜å…ˆè€ƒè™‘ç›´æ¥é€šè®¯ï¼Œæ— æ³•ç›´æ¥é€šè®¯æƒ…å†µä¸‹ä¼šä½¿ç”¨TURNã€‚</p><p>å‚è€ƒ <a href="https://www.ietf.org/rfc/rfc8656.txt">TURN rfc8656</a></p><h3 id="SDP"><a href="#SDP" class="headerlink" title="SDP"></a>SDP</h3><p>Session Description Protocolï¼Œä¼šè¯æè¿°åè®®ã€‚</p><p>æè¿°å¤šåª’ä½“è¿æ¥å†…å®¹çš„åè®®ã€‚ä¾‹å¦‚åˆ†è¾¨ç‡ï¼Œæ ¼å¼ï¼Œç¼–ç ï¼ŒåŠ å¯†ç®—æ³•ç­‰ç­‰ã€‚</p><p>å®é™…ä¸Šï¼ŒSDPä¸æ˜¯ä¸ªçœŸæ­£çš„åè®®ã€‚å®ƒä¹Ÿæ˜¯ç”¨æ¥æè¿°è®¾å¤‡ä¹‹é—´è¿æ¥ä¸ä¼ è¾“å¤šåª’ä½“çš„æ•°æ®æ ¼å¼ã€‚</p><p>å‚è€ƒ <a href="https://www.rfc-editor.org/rfc/rfc8866.html">SDP: Session Description Protocol | rfc8866</a></p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://webrtc.org/getting-started/media-devices">åª’ä½“è®¾å¤‡å…¥é—¨ ï½œ webrtc.org</a></li><li><a href="https://media.prod.mdn.mozit.cloud/attachments/2016/01/27/12363/9d667775214ae0422fae606050f60c1e/WebRTC%20-%20Signaling%20Diagram.svg">2ä¸ªèŠ‚ç‚¹å»ºç«‹è¿æ¥æ—¶çš„æ²Ÿé€šè¿‡ç¨‹ ï½œ MDN</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Protocols">WebRTC åè®®ä»‹ç» ï½œ developer.mozilla.org</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebRTC_API/Signaling_and_video_calling">ä¿¡ä»¤ä¸è§†é¢‘é€šè¯ ï½œ developer.mozilla.org</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>WebRTC</category>
      
    </categories>
    
    
    <tags>
      
      <tag>WebRTC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PythonæŠ“å–åšå®¢è®°å½•ï¼Œè·å–æ ‡é¢˜ä¸url</title>
    <link href="/2021/10/13/Python/scrapy-hw-blog-record/"/>
    <url>/2021/10/13/Python/scrapy-hw-blog-record/</url>
    
    <content type="html"><![CDATA[<p>åœ¨åšå®¢ç½‘ç«™å‘å¸ƒäº†ä¸€äº›åšå®¢ã€‚æ€»å…±æœ‰å››åå¤šç¯‡ã€‚ç°åœ¨æŸ¥çœ‹è¿™äº›åšå®¢éœ€è¦ç¿»é¡µï¼Œä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚<br>æƒ³è¦å¼„å‡ºä¸€ä¸ªåˆ—è¡¨ï¼ŒæŠŠæ ‡é¢˜å’Œé“¾æ¥å±•ç¤ºå‡ºæ¥ã€‚å¦‚æœæ‰‹åŠ¨å»å¤åˆ¶ç²˜è´´ï¼Œè€—æ—¶è€—åŠ›ï¼Œä¹Ÿä¸å¤Ÿè‡ªåŠ¨åŒ–ã€‚<br>æœ‰æ²¡æœ‰ä»€ä¹ˆè‡ªåŠ¨åŒ–çš„æ–¹æ³•å‘¢ï¼Ÿæƒ³åˆ°ä»¥å‰ç”¨pythonåšè¿‡æŠ“å–çš„åŠŸèƒ½ã€‚</p><p>å¼€å‘ç¯å¢ƒï¼š</p><ul><li>Python3.7</li><li>PyCharm 2018.3.7 (Community Edition)</li><li>macOS 11.4</li></ul><h2 id="å®‰è£…scrapy"><a href="#å®‰è£…scrapy" class="headerlink" title="å®‰è£…scrapy"></a>å®‰è£…scrapy</h2><p>æˆ‘ä»¬ä¸»è¦ä½¿ç”¨çš„æ¡†æ¶æ˜¯scrapyï¼Œå®˜ç½‘ <a href="https://scrapy.org/">https://scrapy.org/</a> </p><p>å¦‚æœéœ€è¦æ¢ç”¨æ¸…åçš„pipæºï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install -i https://pypi.tuna.tsinghua.edu.cn/simple pip -U<br>pip config <span class="hljs-built_in">set</span> global.index-url https://pypi.tuna.tsinghua.edu.cn/simple<br></code></pre></td></tr></table></figure></p><p>æ ¹æ®<a href="https://docs.scrapy.org/en/latest/intro/install.html">å®˜ç½‘æ–‡æ¡£</a>è¿›è¡Œå®‰è£…<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip3 install Scrapy<br></code></pre></td></tr></table></figure></p><h2 id="åˆ†æç›®æ ‡ç½‘é¡µ"><a href="#åˆ†æç›®æ ‡ç½‘é¡µ" class="headerlink" title="åˆ†æç›®æ ‡ç½‘é¡µ"></a>åˆ†æç›®æ ‡ç½‘é¡µ</h2><p>ç›®æ ‡ç½‘é¡µçš„éƒ¨åˆ†htmlå¦‚ä¸‹<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;blog-menu blog-menu-noImg&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;blog-menu-header blog_no_attachment&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;portal_usercenter_2_usernew_blog_title_cus_i_0&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/blogs/301790&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;common-blog-title&quot;</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;Kotlinåç¨‹å–æ¶ˆä¸è¶…æ—¶&quot;</span> <span class="hljs-attr">target</span>=<span class="hljs-string">&quot;_blank&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-left: 0px; color: rgb(51, 51, 51);&quot;</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;blog-title-wrap&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;overflow-wrap: break-word;&quot;</span>&gt;</span><br>            Kotlinåç¨‹å–æ¶ˆä¸è¶…æ—¶<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure><br>éœ€è¦æå–çš„æ˜¯æ ‡é¢˜ï¼ˆtitleï¼‰å’Œç½‘å€ï¼ˆurlï¼‰ã€‚</p><h3 id="shellå·¥å…·"><a href="#shellå·¥å…·" class="headerlink" title="shellå·¥å…·"></a>shellå·¥å…·</h3><p>ä½¿ç”¨<code>scrapy shell</code>å·¥å…·æ¥åˆ†æä¸€ä¸‹ç›®æ ‡ç½‘é¡µ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">scrapy shell <span class="hljs-string">&#x27;https://bbs.huaweicloud.com/community/usersnew/id_1606985929124732/page_1&#x27;</span><br></code></pre></td></tr></table></figure><br>windowsä¸‹çš„urléœ€è¦ç”¨åŒå¼•å·</p><p>å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„è¿è¡Œç»“æœ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">2021-10-13 09:46:47 [asyncio] DEBUG: Using selector: KqueueSelector<br>[s] Available Scrapy objects:<br>[s]   scrapy     scrapy module (contains scrapy.Request, scrapy.Selector, etc)<br>[s]   crawler    &lt;scrapy.crawler.Crawler object at 0x7fd889766990&gt;<br>[s]   item       &#123;&#125;<br>[s]   request    &lt;GET https://bbs.huaweicloud.com/community/usersnew/id_1606985929124732/page_1&gt;<br>[s]   response   &lt;200 https://bbs.huaweicloud.com/community/usersnew/id_1606985929124732/page_1&gt;<br>[s]   settings   &lt;scrapy.settings.Settings object at 0x7fd88987bb50&gt;<br>[s]   spider     &lt;DefaultSpider <span class="hljs-string">&#x27;default&#x27;</span> at 0x7fd889c7b710&gt;<br>[s] Useful shortcuts:<br>[s]   fetch(url[, redirect=True]) Fetch URL and update <span class="hljs-built_in">local</span> objects (by default, redirects are followed)<br>[s]   fetch(req)                  Fetch a scrapy.Request and update <span class="hljs-built_in">local</span> objects <br>[s]   shelp()           Shell <span class="hljs-built_in">help</span> (<span class="hljs-built_in">print</span> this <span class="hljs-built_in">help</span>)<br>[s]   view(response)    View response <span class="hljs-keyword">in</span> a browser<br>2021-10-13 09:46:48 [asyncio] DEBUG: Using selector: KqueueSelector<br></code></pre></td></tr></table></figure></p><p>å°è¯•ç”¨scrapyçš„<code>css()</code>æ–¹æ³•æ¥æå–å…ƒç´ ï¼Œæ“ä½œå®ƒçš„<code>response</code>å˜é‡</p><p>ä¾‹å¦‚æå–<code>div.blog-menu</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">In [2]: response.css(<span class="hljs-string">&#x27;div.blog-menu&#x27;</span>)<br>Out[2]: <br>[&lt;Selector xpath=<span class="hljs-string">&quot;descendant-or-self::div[@class and contains(concat(&#x27; &#x27;, normalize-space(@class), &#x27; &#x27;), &#x27; blog-menu &#x27;)]&quot;</span> data=<span class="hljs-string">&#x27;&lt;div class=&quot;blog-menu blog-menu-noImg&quot;&gt;&lt;&#x27;</span>&gt;,<br>...<br></code></pre></td></tr></table></figure><br>å¯ä»¥å¾—åˆ°é¡µé¢ä¸Šæ‰€æœ‰æ»¡è¶³è¦æ±‚çš„å…ƒç´ ã€‚æ‹¿åˆ°çš„å…ƒç´ æ˜¯<strong>Selector</strong>ï¼Œå¯ä»¥å†è¿›è¡Œä¸‹ä¸€æ­¥çš„æ“ä½œã€‚</p><p>ç”¨forå¾ªç¯è¯»å–æå–åˆ°çš„å…ƒç´ ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šï¼Œå»æŠ“å–ä¸­æ–‡æ ‡é¢˜<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">In [6]: <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> response.css(<span class="hljs-string">&#x27;div.blog-menu&#x27;</span>):<br>   ...:     <span class="hljs-built_in">print</span>(item.css(<span class="hljs-string">&#x27;a.common-blog-title::attr(title)&#x27;</span>).extract()[0])<br>   ...: <br>Kotlinåç¨‹å–æ¶ˆä¸è¶…æ—¶<br>Android Kotlinåç¨‹å…¥é—¨<br>Kotlinåç¨‹åŸºç¡€<br>Kotlinåç¨‹å…¥é—¨<br>Android View post æ–¹æ³•<br>Android Activity ä¼ é€’Parcelableå¯¹è±¡<br>Android Handlerï¼ŒLooperä¸MessageQueueä½¿ç”¨ä¸åˆ†æ<br>Androidçº¿ç¨‹æ± ä½¿ç”¨ä»‹ç»<br>Javaçº¿ç¨‹ä»‹ç»<br>ä½¿ç”¨EChartsç»˜åˆ¶ç½‘å€å¾„å‘æ ‘çŠ¶å›¾<br></code></pre></td></tr></table></figure></p><p><code>a.common-blog-title::attr(title)</code>è¡¨ç¤ºçš„æ˜¯æˆ‘ä»¬è¦æŸ¥æ‰¾<code>&lt;a&gt;</code>é‡Œé¢çš„å†…å®¹ï¼ŒæŒ‡å®šclassä¸º<code>common-blog-title</code>ï¼Œå¹¶ä¸”æŸ¥æ‰¾<code>title</code>å±æ€§ã€‚<br><code>css().extract()</code>å°†ç»“æœåˆ—è¡¨æå–å‡ºæ¥ã€‚æœ€åå¾—åˆ°æˆ‘ä»¬å…³å¿ƒçš„ä¿¡æ¯ã€‚</p><p>è·å–<code>url</code>åŒç†ï¼ŒæŠŠæå–éƒ¨åˆ†ä¿®æ”¹ä¸º<code>::attr(href)</code></p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>å‰é¢ç”¨shellå·¥å…·è¿›è¡Œåˆ†æï¼Œæˆ‘ä»¬äº†è§£æå–ç›®æ ‡ä¿¡æ¯çš„æ–¹æ³•ã€‚æ¥ä¸‹æ¥å†™Pythonä»£ç ã€‚</p><p>åœ¨åˆé€‚çš„åœ°æ–¹æ–°å»ºä¸€ä¸ªscrapyå·¥ç¨‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">scrapy startproject blog<br></code></pre></td></tr></table></figure><br>å¯ä»¥å¾—åˆ°ä¸€ç³»åˆ—æ–‡ä»¶<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">blog<br>    spiders<br>        .gitignore<br>        __init__.py<br>    __init__.py<br>    items.py<br>    middlewares.py<br>    pipelines.py<br>    settings.py<br></code></pre></td></tr></table></figure></p><p>åœ¨<code>spiders</code>ç›®å½•é‡Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶<code>Hw.py</code>ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬çš„â€œèœ˜è››â€ã€‚å®Œæ•´ä»£ç å¦‚ä¸‹ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><br><span class="hljs-keyword">import</span> scrapy<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cmp</span>(<span class="hljs-params">item</span>):<br>    <span class="hljs-keyword">return</span> item[<span class="hljs-string">&#x27;page&#x27;</span>]<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HwBlog</span>(scrapy.Spider):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    åœ¨æœ€å¤–å±‚çš„blogç›®å½•è¿›è¡Œæ“ä½œ</span><br><span class="hljs-string">    scrapy crawl hw</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    name = <span class="hljs-string">&quot;hw&quot;</span>  <span class="hljs-comment"># scrapy crawl hw</span><br>    res_list = []<br>    req_count = <span class="hljs-number">0</span><br>    total_url = <span class="hljs-number">5</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">start_requests</span>(<span class="hljs-params">self</span>):<br>        self.res_list = []<br>        urls = []<br>        base_url = <span class="hljs-string">&#x27;https://bbs.huaweicloud.com/community/usersnew/id_1606985929124732/page_&#x27;</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, self.total_url + <span class="hljs-number">1</span>):<br>            urls.append(base_url + <span class="hljs-built_in">str</span>(i))<br><br>        <span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> urls:<br>            <span class="hljs-keyword">yield</span> scrapy.Request(url=url, callback=self.parse)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse</span>(<span class="hljs-params">self, response</span>):<br>        self.req_count = self.req_count + <span class="hljs-number">1</span><br>        page = response.url.split(<span class="hljs-string">&quot;_&quot;</span>)[-<span class="hljs-number">1</span>]<br><br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> response.css(<span class="hljs-string">&#x27;div.blog-menu&#x27;</span>):<br>            title_se = item.css(<span class="hljs-string">&quot;a.common-blog-title&quot;</span>)<br>            blog_url = <span class="hljs-string">&#x27;https://bbs.huaweicloud.com&#x27;</span> + (title_se.css(<span class="hljs-string">&quot;::attr(href)&quot;</span>).extract()[<span class="hljs-number">0</span>])<br>            blog_title = title_se.css(<span class="hljs-string">&quot;::attr(title)&quot;</span>).extract()[<span class="hljs-number">0</span>]<br>            self.res_list.append(&#123;<span class="hljs-string">&quot;title&quot;</span>: blog_title, <span class="hljs-string">&quot;url&quot;</span>: blog_url, <span class="hljs-string">&quot;page&quot;</span>: page&#125;)<br><br>        json_res = json.dumps(self.res_list, ensure_ascii=<span class="hljs-literal">False</span>)<br>        <span class="hljs-built_in">print</span>(json_res)<br><br>        res_file_path = <span class="hljs-string">&#x27;raw/hw.json&#x27;</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(res_file_path, <span class="hljs-string">&#x27;w+&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            f.write(json_res)<br><br>        <span class="hljs-keyword">if</span> self.req_count &lt; self.total_url:<br>            <span class="hljs-keyword">return</span><br>        res_md = <span class="hljs-string">&#x27;raw/hw.md&#x27;</span><br>        self.res_list.sort(key=cmp)  <span class="hljs-comment"># ç”¨é¡µç æ¥æ’åº</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(res_md, <span class="hljs-string">&#x27;w+&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            f.writelines(<span class="hljs-string">&#x27;## åä¸ºäº‘ç¤¾åŒº&#x27;</span>)<br>            f.write(<span class="hljs-string">&#x27;\nåšå®¢æ•°é‡:&#x27;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(self.res_list)) + <span class="hljs-string">&#x27;\n&#x27;</span>)<br>            <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> self.res_list:<br>                f.write(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>                f.write(<span class="hljs-string">&#x27;- [&#x27;</span> + d[<span class="hljs-string">&#x27;title&#x27;</span>] + <span class="hljs-string">&#x27;](&#x27;</span> + d[<span class="hljs-string">&#x27;url&#x27;</span>] + <span class="hljs-string">&#x27;)&#x27;</span>)<br></code></pre></td></tr></table></figure></p><p>è¦å¯åŠ¨çš„è¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">scrapy crawl hw</span><br></code></pre></td></tr></table></figure></p><p>æ¥ä¸‹æ¥ç®€å•çœ‹ä¸€ä¸‹ä»£ç </p><h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><p><code>name</code>æ˜¯èœ˜è››çš„åå­—ã€‚æˆ‘ä»¬å¯åŠ¨çš„æ—¶å€™ä¼šç”¨åˆ°å®ƒã€‚è¿™ä¸ªåå­—ç”±æˆ‘ä»¬è‡ªå·±å®šä¹‰ã€‚</p><p><code>res_list</code>æ˜¯æš‚å­˜ç»“æœçš„åˆ—è¡¨ã€‚æŠŠè·å–åˆ°çš„ç»“æœæš‚æ—¶å­˜æ”¾åœ¨é‡Œé¢ã€‚</p><p><code>total_url</code>è¡¨ç¤ºä¸€å…±è¦çˆ¬å‡ ä¸ªé¡µé¢</p><p><code>req_count</code>è¡¨ç¤ºè¯·æ±‚æ¬¡æ•°</p><h3 id="start-requests-self"><a href="#start-requests-self" class="headerlink" title="start_requests(self)"></a><code>start_requests(self)</code></h3><p>åœ¨è¿™ä¸ªæ–¹æ³•é‡Œè¿›è¡Œä¸€äº›é…ç½®å·¥ä½œã€‚æ¯”å¦‚é…ç½®ç›®æ ‡urlã€‚<br>æˆ‘ä»¬æ˜¯é¢„å…ˆçŸ¥é“æœ‰5ä¸ªé¡µé¢ï¼Œæ‰€ä»¥é…ç½®äº†5ä¸ªurlã€‚</p><p>ç”¨<code>scrapy.Request(url=url, callback=self.parse)</code>æ„å»ºè¯·æ±‚</p><p><code>parse</code>æ˜¯å›è°ƒå‡½æ•°ï¼Œè¯·æ±‚æˆåŠŸåèµ°è¿™ä¸ªæ–¹æ³•ã€‚</p><h3 id="parse-self-response"><a href="#parse-self-response" class="headerlink" title="parse(self, response)"></a><code>parse(self, response)</code></h3><p>è¯·æ±‚æˆåŠŸåï¼Œç»“æœä¿å­˜åœ¨<code>response</code>ä¸­ã€‚å‰é¢ç”¨shellè¿›è¡Œçš„æ“ä½œï¼Œå¯ä»¥ç›´æ¥å†™æˆpythonä»£ç ã€‚</p><p>å½“è¯·æ±‚æ¬¡æ•°è¾¾åˆ°ç›®æ ‡åï¼Œå¼€å§‹å†™æ–‡ä»¶ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>è¿™æ˜¯Python scrapyçš„ä¸€æ¬¡ç®€å•åº”ç”¨ã€‚</p><p>å®‰è£…scrapyï¼Œåˆ†æç›®æ ‡ç½‘é¡µã€‚æŠŠè·å–åˆ°çš„æ•°æ®æ•´ç†åå†™æˆmarkdownæ–‡ä»¶ã€‚</p><p>è§†é¢‘åœ¨<a href="https://www.bilibili.com/video/BV1qL411G7WB/">è¿™é‡Œ</a></p><iframe src="//player.bilibili.com/player.html?bvid=BV1qL411G7WB&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" width="100%" height="400px"> </iframe>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>çˆ¬è™«</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2021å¹´9æœˆæ€»ç»“</title>
    <link href="/2021/09/30/Summary/2021-9/"/>
    <url>/2021/09/30/Summary/2021-9/</url>
    
    <content type="html"><![CDATA[<h2 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h2><p>ç»™<a href="https://an.rustfisher.com">Androidç«™</a>æ·»åŠ æ›´å¤šè‰²å½©ã€‚ä½¿ç”¨Mkdocsçš„åŠŸèƒ½ï¼Œå¢åŠ æŠ˜å åŠŸèƒ½å’ŒæŒ‰é’®ã€‚</p><p>å¢åŠ äº†ä¸€ä¸ª<a href="https://an.rustfisher.com/about/recent-post/">ã€Œæœ€è¿‘æ›´æ–°ã€çš„ç•Œé¢</a>ã€‚åœ¨mdé‡Œå†™htmlã€‚æ‰‹åŠ¨æ±‡æ€»ä¸€ä¸‹æœ€è¿‘çš„æ›´æ–°ä¿¡æ¯ã€‚</p><p>åšäº†ä¸€ä¸ªå¯¼èˆªé¡µé¢ <a href="https://an.rustfisher.com/an-tree.htmlã€‚">https://an.rustfisher.com/an-tree.htmlã€‚</a><br>å¼€å‘è®°å½•åœ¨è¿™é‡Œ -&gt; <a href="https://rustfisher.com/2021/09/02/Web/note-echarts-py-url/">ä½¿ç”¨EChartsç»˜åˆ¶ç½‘å€å¾„å‘æ ‘çŠ¶å›¾</a>ã€‚</p><h2 id="Kotlin"><a href="#Kotlin" class="headerlink" title="Kotlin"></a>Kotlin</h2><p>å…¥é—¨äº†åç¨‹ã€‚äº†è§£äº†åç¨‹çš„åŸºæœ¬æ¦‚å¿µã€‚</p><h2 id="ç½‘ç«™ä¿®æ”¹"><a href="#ç½‘ç«™ä¿®æ”¹" class="headerlink" title="ç½‘ç«™ä¿®æ”¹"></a>ç½‘ç«™ä¿®æ”¹</h2><p>åˆ©ç”¨mkdocsçš„æ’ä»¶ï¼Œå¢åŠ ä¸€äº›åŠŸèƒ½ã€‚</p><h3 id="å¢åŠ å¼•ç”¨"><a href="#å¢åŠ å¼•ç”¨" class="headerlink" title="å¢åŠ å¼•ç”¨"></a>å¢åŠ å¼•ç”¨</h3><p>ä¸€ä¸ªmarkdownæ–‡ä»¶ï¼Œå¯ä»¥å¼•ç”¨å…¶å®ƒæ–‡ä»¶çš„å†…å®¹ã€‚ç”¨çš„æ¡†æ¶æ˜¯mkdocsï¼Œéœ€è¦åŠ å…¥æ’ä»¶ã€‚åœ¨<code>mkdocs.yml</code>æ–‡ä»¶é‡ŒåŠ å…¥<code>plugins</code>å£°æ˜</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">plugins:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">search</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">macros</span><br><br><span class="hljs-attr">copyright:</span> <span class="hljs-string">Copyright</span> <span class="hljs-string">&amp;copy;</span> <span class="hljs-number">2020</span> <span class="hljs-bullet">-</span> <span class="hljs-number">2021 </span><span class="hljs-string">RustFisher</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„å®ƒä¸<code>copyright</code>åŒçº§ã€‚</p><p>ä½†æ˜¯è¿˜éœ€è¦åœ¨ç”µè„‘æœ¬åœ°å®‰è£…ä¸€ä¸‹è¿™ä¸ª<code>macros</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip3 install mkdocs-macros-plugin<br></code></pre></td></tr></table></figure></p><p>mdå¼•ç”¨å…¶ä»–æ–‡ä»¶çš„è¯­æ³•æ˜¯<br><figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs django"><span class="hljs-template-tag">&#123;% <span class="hljs-name"><span class="hljs-name">include</span></span> &#x27;snippet.md&#x27; %&#125;</span><br></code></pre></td></tr></table></figure></p><p>å¦‚æœè¦æŒ‡å®šè¢«å¼•ç”¨æ–‡ä»¶çš„è·¯å¾„<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-bullet">-</span> <span class="hljs-attr">macros:</span><br>    <span class="hljs-attr">include_dir:</span> <span class="hljs-string">include-md</span><br></code></pre></td></tr></table></figure><br>æ³¨æ„<code>include_dir</code>å¿…é¡»å†ç¼©è¿›8ä¸ªç©ºæ ¼</p><p>å‚è€ƒ:</p><ul><li><a href="https://www.mkdocs.org/user-guide/configuration/#configuration-inheritance">https://www.mkdocs.org/user-guide/configuration/#configuration-inheritance</a></li><li><a href="https://mkdocs-macros-plugin.readthedocs.io/en/latest/#installation">https://mkdocs-macros-plugin.readthedocs.io/en/latest/#installation</a><ul><li><a href="https://mkdocs-macros-plugin.readthedocs.io/en/latest/advanced/#including-snippets-in-pages">https://mkdocs-macros-plugin.readthedocs.io/en/latest/advanced/#including-snippets-in-pages</a></li></ul></li></ul><h2 id="æ€»è§ˆ"><a href="#æ€»è§ˆ" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h2><p>åŒä¸€ç¯‡æ–‡ä¼šå…ˆå‘åœ¨<a href="https://an.rustfisher.com/">ğŸ”— Androidæ•™ç¨‹ç«™</a>ï¼Œå¹¶åŒæ­¥å‘å¸ƒåˆ°å„ä¸ªç¤¾åŒºï¼Œæ›´æ–°å†…å®¹æ±‡æ€»:</p><ul><li><strong>Androidåç¨‹åŸºç¡€</strong><ul><li><a href="https://an.rustfisher.com/android/coroutines/intro1/">ğŸ”— Androidæ•™ç¨‹ç«™</a></li><li><a href="https://bbs.huaweicloud.com/blogs/301425"><image src="/img/avatar/huawei.png" style="width:18px; height:18px"></image> åä¸ºäº‘ç¤¾åŒº</a></li><li><a href="https://juejin.cn/post/7012167390926635038/">ğŸ”— æ˜é‡‘ç¤¾åŒº</a></li><li><a href="https://www.cnblogs.com/rustfisher/p/15339044.html">ğŸ”— åšå®¢å›­</a></li></ul></li><li><strong>Kotlinåç¨‹å–æ¶ˆä¸è¶…æ—¶</strong><ul><li><a href="https://an.rustfisher.com/kotlin/coroutines/cancel-timeout/">ğŸ”— Androidæ•™ç¨‹ç«™</a></li><li><a href="https://bbs.huaweicloud.com/blogs/301790"><image src="/img/avatar/huawei.png" style="width:18px; height:18px"></image> åä¸ºäº‘ç¤¾åŒº</a></li></ul></li><li><strong>Kotlinåç¨‹åŸºç¡€</strong><ul><li><a href="https://an.rustfisher.com/kotlin/coroutines/basic/b2/">ğŸ”— Androidæ•™ç¨‹ç«™</a></li><li><a href="https://bbs.huaweicloud.com/blogs/301126"><image src="/img/avatar/huawei.png" style="width:18px; height:18px"></image> åä¸ºäº‘ç¤¾åŒº</a></li><li><a href="https://juejin.cn/post/7011144404538753032/">ğŸ”— æ˜é‡‘ç¤¾åŒº</a></li><li><a href="https://www.cnblogs.com/rustfisher/p/15336721.html">ğŸ”— åšå®¢å›­</a></li></ul></li><li><strong>Kotlinåç¨‹å…¥é—¨</strong><ul><li><a href="https://an.rustfisher.com/kotlin/coroutines/basic/first/">ğŸ”— Androidæ•™ç¨‹ç«™</a></li><li><a href="https://bbs.huaweicloud.com/blogs/301044"><image src="/img/avatar/huawei.png" style="width:18px; height:18px"></image> åä¸ºäº‘ç¤¾åŒº</a></li><li><a href="https://juejin.cn/post/7010778538043260964/">ğŸ”— æ˜é‡‘ç¤¾åŒº</a></li><li><a href="https://www.cnblogs.com/rustfisher/p/15330285.html">ğŸ”— åšå®¢å›­</a></li><li><a href="https://ld246.com/article/1632492657279">ğŸ”— é“¾æ»´</a></li></ul></li><li><strong>Android View post æ–¹æ³•è§£æ</strong><ul><li><a href="https://an.rustfisher.com/android/ui/view/rtfsc/post/">ğŸ”— Androidæ•™ç¨‹ç«™</a></li><li><a href="https://bbs.huaweicloud.com/blogs/300835"><image src="/img/avatar/huawei.png" style="width:18px; height:18px"></image> åä¸ºäº‘ç¤¾åŒº</a></li><li><a href="https://juejin.cn/post/7009652473937788964/">ğŸ”— æ˜é‡‘ç¤¾åŒº</a></li><li><a href="https://ld246.com/article/1632062734581">ğŸ”— é“¾æ»´</a></li><li><a href="https://www.cnblogs.com/rustfisher/p/15322722.html">ğŸ”— åšå®¢å›­</a></li></ul></li><li><strong>Android Activity ä¼ é€’Parcelableå¯¹è±¡</strong><ul><li><a href="https://an.rustfisher.com/android/activity/launch-send-parcelable/">ğŸ”— Androidæ•™ç¨‹ç«™</a></li><li><a href="https://bbs.huaweicloud.com/blogs/300757"><image src="/img/avatar/huawei.png" style="width:18px; height:18px"></image> åä¸ºäº‘ç¤¾åŒº</a></li><li><a href="https://segmentfault.com/a/1190000040709459">ğŸ”— segmentfault</a></li></ul></li><li><strong>Handlerï¼ŒLooperä¸MessageQueueä½¿ç”¨ä¸åˆ†æ</strong><ul><li><a href="https://an.rustfisher.com/android/handler/Handler_src_note/">ğŸ”— Androidæ•™ç¨‹ç«™</a></li><li><a href="https://bbs.huaweicloud.com/blogs/300369">ğŸ”— åä¸ºäº‘ç¤¾åŒº</a></li></ul></li><li><strong>Androidä½¿ç”¨çº¿ç¨‹æ± ä»‹ç»</strong><ul><li><a href="https://an.rustfisher.com/android/concurrent/thread-pool-use-intro/">ğŸ”— Androidæ•™ç¨‹ç«™</a></li><li><a href="https://bbs.huaweicloud.com/blogs/300152"><image src="/img/avatar/huawei.png" style="width:18px; height:18px"></image> åä¸ºäº‘ç¤¾åŒº</a></li><li><a href="https://juejin.cn/post/7006574333153771557/">ğŸ”— æ˜é‡‘ç¤¾åŒº</a></li><li><a href="https://www.cnblogs.com/rustfisher/p/15263394.html">ğŸ”— åšå®¢å›­</a></li><li><a href="https://ld246.com/article/1631345469189">ğŸ”— é“¾æ»´</a></li></ul></li><li><strong>Androidå¤šçº¿ç¨‹ç»¼è¿°</strong><ul><li><a href="https://an.rustfisher.com/android/thread/android-thread-survey/">ğŸ”— Androidæ•™ç¨‹ç«™</a></li></ul></li><li><strong>Javaå¤šçº¿ç¨‹ä»‹ç»</strong><ul><li><a href="https://an.rustfisher.com/java/thread/thread-class-intro">ğŸ”— Androidæ•™ç¨‹ç«™</a></li><li><a href="https://bbs.huaweicloud.com/blogs/298451"><image src="/img/avatar/huawei.png" style="width:18px; height:18px"></image> åä¸ºäº‘ç¤¾åŒº</a></li><li><a href="https://juejin.cn/post/7005038299249115173/">ğŸ”— æ˜é‡‘ç¤¾åŒº</a></li><li><a href="https://www.cnblogs.com/rustfisher/p/15237641.html">ğŸ”— åšå®¢å›­</a></li><li><a href="https://ld246.com/article/1631001736567">ğŸ”— é“¾æ»´</a></li></ul></li><li><a href="https://an.rustfisher.com/about/recent-post">Androidåˆé›†çš„æœ€è¿‘æ›´æ–°</a></li></ul><h2 id="å±•æœ›"><a href="#å±•æœ›" class="headerlink" title="å±•æœ›"></a>å±•æœ›</h2><p>æ¯ä¸ªæœˆå¤šå†™ä¸€ç‚¹ã€‚åŠ å¼ºå¯¹ç½‘ç»œé€šä¿¡çš„å­¦ä¹ ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ€»ç»“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ€»ç»“</tag>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨EChartsç»˜åˆ¶ç½‘å€å¾„å‘æ ‘çŠ¶å›¾</title>
    <link href="/2021/09/02/Web/note-echarts-py-url/"/>
    <url>/2021/09/02/Web/note-echarts-py-url/</url>
    
    <content type="html"><![CDATA[<p><a href="https://an.rustfisher.com">an.rustfisher.com</a>æœ‰å¾ˆå¤šå†…å®¹ï¼Œå¾ˆå¤šé¡µé¢ã€‚å¦‚æœç”¨ä¸€ä¸ªæ ‘çŠ¶å›¾æŠŠæ‰€æœ‰é¡µé¢å±•ç¤ºå‡ºæ¥ä¼šæ˜¯ä»€ä¹ˆæ•ˆæœï¼Ÿ<br>ç¬¬ä¸€æ—¶é—´æƒ³åˆ°äº†<a href="https://echarts.apache.org/zh/index.html">ECharts</a>ã€‚</p><p><a href="https://an.rustfisher.com/an-tree.html">æœ€åæ•ˆæœï¼š https://an.rustfisher.com/an-tree.html</a></p><h2 id="æ•°æ®å¤„ç†"><a href="#æ•°æ®å¤„ç†" class="headerlink" title="æ•°æ®å¤„ç†"></a>æ•°æ®å¤„ç†</h2><p>æ•°æ®æ¥æºäºé…ç½®æ–‡ä»¶ã€‚æˆ‘ä»¬åªéœ€è¦æŠŠå†…å®¹è¯»å‡ºæ¥ï¼Œæ•´ç†æˆEChartséœ€è¦çš„æ ¼å¼å¹¶ä¿å­˜ä¸ºæ–‡ä»¶ã€‚</p><h3 id="yml"><a href="#yml" class="headerlink" title="yml"></a>yml</h3><p>Androidç«™ç”¨çš„æ¡†æ¶æ˜¯Mkdocsï¼Œç½‘å€éƒ½è®¾ç½®åœ¨<strong>mkdocs.yml</strong>é‡Œã€‚å…³é”®é…ç½®å¦‚ä¸‹</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">nav:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-attr">Android basic:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">å¼€å§‹:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">æ–°å»ºå·¥ç¨‹:</span> <span class="hljs-string">android/startProject/start_new_project.md</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">ä½¿ç”¨Kotlin:</span> <span class="hljs-string">android/startProject/as-use-kotlin.md</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">Activity:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">Activityç»¼è¿°:</span> <span class="hljs-string">android/activity/overview.md</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦æŠŠè¿™äº›æ•°æ®è¯»å‡ºæ¥ï¼Œå¼„æˆEChartså¯ä»¥ç”¨çš„æ ¼å¼ã€‚</p><p>æ‰“å¼€PyCharmï¼Œç”¨pythonæ¥å¤„ç†æ•°æ®ã€‚</p><h3 id="pythonå¤„ç†æ•°æ®"><a href="#pythonå¤„ç†æ•°æ®" class="headerlink" title="pythonå¤„ç†æ•°æ®"></a>pythonå¤„ç†æ•°æ®</h3><p>æˆ‘ä»¬ä½¿ç”¨3.7ç‰ˆæœ¬pythonã€‚è¦è¯»å–ymlçš„å†…å®¹ï¼Œä¸æƒ³ç”¨è¯»æ–‡æœ¬çš„æ–¹å¼ä¸€è¡Œè¡Œæ¥è¯»ï¼Œè¿˜å¾—è‡ªå·±è§£æã€‚<br>pythonä¸­æœ‰ä¸ªåº“<a href="https://pypi.org/project/PyYAML/"><code>PyYAML</code></a>ä¸“é—¨ç”¨äºè¯»å–ymlæ ¼å¼çš„æ•°æ®ã€‚</p><p>åœ¨PyCharmsé‡Œè£…ä¸Šè¿™ä¸ªåŒ…ã€‚ç”¨å®ƒæ¥è¯»å–ymlé‡Œçš„æ•°æ®ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> yaml<br><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(md_file, encoding=<span class="hljs-string">&#x27;utf8&#x27;</span>) <span class="hljs-keyword">as</span> a_yaml_file:<br>        <span class="hljs-comment"># è§£æyaml</span><br>        yaml_data = yaml.load(a_yaml_file, Loader=yaml.FullLoader)<br>        nav = yaml_data[<span class="hljs-string">&#x27;nav&#x27;</span>]<br></code></pre></td></tr></table></figure></p><p>EChartséœ€è¦çš„æ ¼å¼æ˜¯<code>name</code>å’Œ<code>children</code>ã€‚åŒæ—¶å¯ä»¥æ·»åŠ åˆ«çš„å­—æ®µã€‚<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Androidæ•™ç¨‹&quot;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;children&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>      <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Android basic&quot;</span><span class="hljs-punctuation">,</span><br>      <span class="hljs-attr">&quot;children&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></p><p>è¯»å–åˆ°çš„æ•°æ®å±‚çº§æ¯”è¾ƒå¤šï¼Œç”¨é€’å½’æ–¹æ³•æ¥å¤„ç†å®ƒä»¬ã€‚æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½éå†ä¸€éï¼Œæ•´ç†æˆéœ€è¦çš„æ ¼å¼ã€‚</p><p>é€’å½’çš„æ—¶å€™ï¼Œé‡åˆ°æ•°ç»„ï¼Œåˆ™ç»§ç»­é€’å½’ï¼›é‡åˆ°å­—ç¬¦ä¸²ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥æ‹¼æ¥ç½‘å€äº†ã€‚</p><p>å®Œæ•´è„šæœ¬å¦‚ä¸‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> yaml<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">gen_url_map</span>(<span class="hljs-params">main_site, md_file</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(md_file, encoding=<span class="hljs-string">&#x27;utf8&#x27;</span>) <span class="hljs-keyword">as</span> a_yaml_file:<br>        <span class="hljs-comment"># è§£æyaml</span><br>        yaml_data = yaml.load(a_yaml_file, Loader=yaml.FullLoader)<br><br>        nav = yaml_data[<span class="hljs-string">&#x27;nav&#x27;</span>]<br><br>        sorted_data = &#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Androidæ•™ç¨‹&quot;</span>, <span class="hljs-string">&quot;children&quot;</span>: [], <span class="hljs-string">&quot;collapsed&quot;</span>: <span class="hljs-literal">False</span>&#125;<br><br>        <span class="hljs-keyword">for</span> big_dict <span class="hljs-keyword">in</span> nav:<br>            load_url(main_site, big_dict, sorted_data)<br><br>        url_file = <span class="hljs-string">&#x27;android-url-map.json&#x27;</span><br>        <span class="hljs-keyword">if</span> os.path.exists(url_file):<br>            os.remove(url_file)<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(url_file, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> s:<br>            s.write(<span class="hljs-built_in">str</span>(json.dumps(sorted_data, ensure_ascii=<span class="hljs-literal">False</span>)))<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">load_url</span>(<span class="hljs-params">main_site, input_dict, res_data</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    é€’å½’å¤„ç†æ•°æ®</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">for</span> k1 <span class="hljs-keyword">in</span> input_dict:<br>        v1 = input_dict[k1]<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(v1, <span class="hljs-built_in">list</span>):<br>            item1 = &#123;<span class="hljs-string">&quot;name&quot;</span>: k1, <span class="hljs-string">&quot;children&quot;</span>: []&#125;<br>            res_data[<span class="hljs-string">&#x27;children&#x27;</span>].append(item1)<br>            <span class="hljs-keyword">for</span> v1_child <span class="hljs-keyword">in</span> v1:<br>                load_url(main_site, v1_child, item1)<br>        <span class="hljs-keyword">elif</span> <span class="hljs-built_in">isinstance</span>(v1, <span class="hljs-built_in">str</span>):<br>            <span class="hljs-comment"># æ­¤æ—¶å·²ç»æ˜¯urläº†</span><br>            final_item = &#123;<span class="hljs-string">&quot;name&quot;</span>: k1, <span class="hljs-string">&quot;url&quot;</span>: main_site + v1[<span class="hljs-number">0</span>:-<span class="hljs-number">3</span>]&#125;<br>            res_data[<span class="hljs-string">&#x27;children&#x27;</span>].append(final_item)<br>            <span class="hljs-keyword">return</span> final_item<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç”Ÿæˆandroidç«™çš„sitemap&quot;</span>)<br>    gen_url_map(<span class="hljs-string">&#x27;https://www.an.rustfisher.com/&#x27;</span>,<br>                <span class="hljs-string">&#x27;/Users/rustfisher/mkdocs.yml&#x27;</span>)<br><br></code></pre></td></tr></table></figure></p><p>æœ€åå†™ä¸€ä¸ª<strong>android-url-map.json</strong>æ–‡ä»¶ã€‚</p><h2 id="åˆ¶ä½œç½‘é¡µ"><a href="#åˆ¶ä½œç½‘é¡µ" class="headerlink" title="åˆ¶ä½œç½‘é¡µ"></a>åˆ¶ä½œç½‘é¡µ</h2><p>ç»è¿‡è§‚å¯Ÿï¼Œæˆ‘ä»¬é€‰ç”¨å¾„å‘æ ‘çŠ¶å›¾ï¼ˆtree-radialï¼‰ã€‚<br>æŸ¥çœ‹EChartsçš„å¾„å‘æ ‘çŠ¶å›¾<a href="https://echarts.apache.org/examples/zh/editor.html?c=tree-radial">ä½¿ç”¨ç¤ºä¾‹</a>ï¼Œä¸‹è½½ä¸€ä¸ªç¤ºä¾‹htmlï¼Œåœ¨å®ƒçš„åŸºç¡€ä¸Šä¿®æ”¹ã€‚</p><p>æ·»åŠ ä¸Š<code>jquery</code>çš„å¼•ç”¨ã€‚<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://cdn.bootcss.com/jquery/3.4.1/jquery.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>ä¿®æ”¹è¦è¯»å–çš„jsonæ–‡ä»¶å<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">$.<span class="hljs-title function_">getJSON</span>(<span class="hljs-string">&#x27;./android-url-map.json&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) &#123; <span class="hljs-comment">/* ... */</span> &#125;<br></code></pre></td></tr></table></figure></p><p>æŠŠå‰é¢å¾—åˆ°çš„jsonæ–‡ä»¶å’Œè¿™ä¸ªhtmlæ–‡ä»¶æ”¾åœ¨åŒä¸€å±‚çº§ï¼Œä¸Šä¼ æœåŠ¡å™¨ã€‚</p><p>æ‰“å¼€ï¼š <a href="https://an.rustfisher.com/an-tree.html">https://an.rustfisher.com/an-tree.html</a> å¯ä»¥çœ‹åˆ°æ•ˆæœã€‚</p><h3 id="æ‰©å¤§æ˜¾ç¤ºèŒƒå›´"><a href="#æ‰©å¤§æ˜¾ç¤ºèŒƒå›´" class="headerlink" title="æ‰©å¤§æ˜¾ç¤ºèŒƒå›´"></a>æ‰©å¤§æ˜¾ç¤ºèŒƒå›´</h3><p>è¿™ä¸ªæ—¶å€™çš„ç½‘é¡µä½“éªŒä¸æ˜¯å¾ˆå¥½ï¼Œé¡µé¢ä¸å¤Ÿå¤§ï¼Œå›¾è¡¨è¶…å‡ºä¸Šä¸‹èŒƒå›´äº†ã€‚å¯ä»¥ç»™å®ƒæ·»ä¸ªç«–ç›´çš„æ»šåŠ¨æ¡<code>overflow-y: scroll</code>ã€‚<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;height: 100%; width: 100%; overflow-y: scroll;&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>ä¿®æ”¹ä¸€ä¸‹ç½‘é¡µçš„<code>body</code>ã€‚å¤–å±‚çš„<code>container</code>å 100%å®½é«˜ï¼Œé‡Œé¢çš„<code>chartContainer</code>ç»™ä¸€ä¸ª<code>min-height: 1600px</code>ã€‚<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;height: 100%; margin: 0; width: 100%;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;container&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;height: 100%; width: 100%;&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;chartContainer&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 100%; min-height: 1600px&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>scripté‡ŒåŠ ä¸Šå¯¹<code>resize</code>çš„ç›‘å¬<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">$(<span class="hljs-variable language_">window</span>).<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;resize&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span> (myChart != <span class="hljs-literal">null</span> &amp;&amp; myChart != <span class="hljs-literal">undefined</span>) &#123;<br>        myChart.<span class="hljs-title function_">resize</span>();<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure></p><p>è¿™æ—¶å†çœ‹æµè§ˆå™¨çš„æ•ˆæœï¼Œå›¾è¡¨æœ‰äº†æ›´å¤šçš„ç©ºé—´æ˜¾ç¤ºã€‚</p><p>å‚è€ƒ</p><ul><li><a href="https://stackoverflow.com/questions/33454946/echarts-and-bootstrap-responsive-width">https://stackoverflow.com/questions/33454946/echarts-and-bootstrap-responsive-width</a></li><li><a href="https://stackoverflow.com/questions/12575251/why-is-my-page-not-scrollable">https://stackoverflow.com/questions/12575251/why-is-my-page-not-scrollable</a></li></ul><h3 id="ç‚¹å‡»æ‰“å¼€é¡µé¢"><a href="#ç‚¹å‡»æ‰“å¼€é¡µé¢" class="headerlink" title="ç‚¹å‡»æ‰“å¼€é¡µé¢"></a>ç‚¹å‡»æ‰“å¼€é¡µé¢</h3><p>é»˜è®¤ç‚¹å‡»æ•ˆæœæ˜¯æŠ˜å å’Œå±•å¼€ã€‚å¯¹äºæœ€æœ«å°¾çš„å¶å­èŠ‚ç‚¹ï¼ŒåŠ ä¸€ä¸ªç‚¹å‡»äº‹ä»¶è®©å®ƒæ‰“å¼€ç›¸åº”çš„ç•Œé¢ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js">myChart.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">params</span>) &#123;<br>    <span class="hljs-keyword">if</span> (params.<span class="hljs-property">data</span> &amp;&amp; params.<span class="hljs-property">data</span>.<span class="hljs-property">url</span>) &#123;<br>        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(params.<span class="hljs-property">data</span>.<span class="hljs-property">url</span>);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p><img src="/img/radial-tree-cover.png" alt=""></p><p><a href="https://an.rustfisher.com/an-tree.html">æœ€åæ•ˆæœï¼š https://an.rustfisher.com/an-tree.html</a></p>]]></content>
    
    
    <categories>
      
      <category>Web_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>web</tag>
      
      <tag>echarts</tag>
      
      <tag>python</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2021å¹´8æœˆæ€»ç»“</title>
    <link href="/2021/08/31/Summary/2021-8/"/>
    <url>/2021/08/31/Summary/2021-8/</url>
    
    <content type="html"><![CDATA[<p>é™¤äº†ç»§ç»­å­¦ä¹ Androidå¼€å‘ï¼Œä¹Ÿåœ¨å…¶å®ƒæ–¹é¢åšäº†ä¸€äº›æ‹“å±•å°è¯•ã€‚çœ‹äº†ä¸€äº›å…¶å®ƒçš„æŠ€æœ¯ã€‚</p><h2 id="æŠ€æœ¯æ–‡ç« "><a href="#æŠ€æœ¯æ–‡ç« " class="headerlink" title="æŠ€æœ¯æ–‡ç« "></a>æŠ€æœ¯æ–‡ç« </h2><p>è¿™ä¸ªæœˆä¸»è¦ä»¥Androidä¸ºä¸»ã€‚å‚åŠ äº†<a href="https://bbs.huaweicloud.com/community/usersnew/id_1606985929124732">åä¸ºäº‘ç¤¾åŒº</a>çš„äº‘é©»å…±åˆ›æ´»åŠ¨ã€‚</p><ul><li><a href="https://rustfisher.com/2021/08/03/NestJS/mp-wx-http-status-code/">çŠ¶æ€ç é€ æˆå¾®ä¿¡å…¬ä¼—å·â€œè¯¥å…¬ä¼—å·æä¾›çš„æœåŠ¡å‡ºç°æ•…éšœâ€</a></li><li><a href="https://bbs.huaweicloud.com/blogs/296652">ã€äº‘é©»å…±åˆ›ã€‘Knativeåº”ç”¨å¼€å‘æŒ‡å—</a></li><li><a href="https://bbs.huaweicloud.com/blogs/297488">ã€äº‘é©»å…±åˆ›ã€‘åŸºäºè½¬ç§»çš„è¯­ä¹‰Parseråˆ†äº«</a></li></ul><h3 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h3><p>ç»§ç»­å®Œå–„<a href="https://an.rustfisher.com">Androidç«™</a>ã€‚<br>è¿™ä¸ªæœˆçš„Androidæ–¹é¢åšå®¢/æ•™ç¨‹æ–‡ç« ä¸»è¦æ¶‰åŠ<a href="https://an.rustfisher.com/android/ui/view/animation/view-animation-intro/">åŠ¨ç”»</a>ã€<a href="https://an.rustfisher.com/android/jetpack/workManager/use1/">WorkManager</a>å’Œå¹¿æ’­ç­‰åŸºç¡€çŸ¥è¯†ã€‚</p><ul><li><a href="https://an.rustfisher.com/android/jetpack/workManager/use1/">WorkManagerä½¿ç”¨å…¥é—¨</a></li><li><a href="https://an.rustfisher.com/android/jetpack/workManager/use2/">WorkManagerå·¥ä½œçº¦æŸï¼Œå»¶è¿Ÿä¸æŸ¥è¯¢å·¥ä½œ</a></li><li><a href="https://an.rustfisher.com/android/jetpack/workManager/periodic1/">Android WorkManagerå®šæ—¶ä»»åŠ¡</a></li><li><a href="https://an.rustfisher.com/android/ui/view/animation/animation-drawable-use/">ä½¿ç”¨AnimationDrawable</a></li><li><a href="https://an.rustfisher.com/android/ui/view/animation/tween-use1/">è¡¥é—´åŠ¨ç”»</a></li><li><a href="https://an.rustfisher.com/android/ui/view/animation/object-animator-intro/">ObjectAnimator æ›´æ”¹è§†å›¾ä½ç½®</a></li><li><a href="https://an.rustfisher.com/android/broadcast/intro_use/">å¹¿æ’­æœºåˆ¶Broadcastä»‹ç»ä¸ä½¿ç”¨</a></li><li><a href="https://an.rustfisher.com/android/service/start/foreground-service/">å¯åŠ¨å‰å°æœåŠ¡</a></li><li><a href="https://an.rustfisher.com/android/ui/view/view-summary/">Viewç»¼è¿°</a></li></ul><h2 id="å±•æœ›"><a href="#å±•æœ›" class="headerlink" title="å±•æœ›"></a>å±•æœ›</h2><p>ç»§ç»­å®Œå–„Androidå†…å®¹ã€‚å°è¯•æ›´å¤šçš„æ–°æŠ€æœ¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ€»ç»“</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ€»ç»“</tag>
      
      <tag>Android</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çŠ¶æ€ç é€ æˆå¾®ä¿¡å…¬ä¼—å·â€œè¯¥å…¬ä¼—å·æä¾›çš„æœåŠ¡å‡ºç°æ•…éšœâ€</title>
    <link href="/2021/08/03/NestJS/mp-wx-http-status-code/"/>
    <url>/2021/08/03/NestJS/mp-wx-http-status-code/</url>
    
    <content type="html"><![CDATA[<h2 id="bugæè¿°"><a href="#bugæè¿°" class="headerlink" title="bugæè¿°"></a>bugæè¿°</h2><p>æˆ‘ä»¬ä½¿ç”¨NestJSå†™åå°ä»£ç ï¼Œç»™å¾®ä¿¡å…¬ä¼—å·æä¾›æœåŠ¡ã€‚<br>ç”¨æˆ·ç»™å…¬ä¼—å·å‘æ¶ˆæ¯æ—¶ï¼Œå…¬ä¼—å·ä¼šæ˜¾ç¤ºâ€œè¯¥å…¬ä¼—å·æä¾›çš„æœåŠ¡å‡ºç°æ•…éšœâ€ã€‚<br>è™½ç„¶åå°ä»£ç å¯ä»¥æ­£å¸¸å¤„ç†ä¸šåŠ¡ï¼Œä½†è¿™ä¸ªæç¤ºéå¸¸å½±å“ç”¨æˆ·ä½“éªŒã€‚</p><h2 id="æ£€æŸ¥"><a href="#æ£€æŸ¥" class="headerlink" title="æ£€æŸ¥"></a>æ£€æŸ¥</h2><p>æ ¹æ®<a href="https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Passive_user_reply_message.html">å¾®ä¿¡å…¬ä¼—å·æ–‡æ¡£</a>ç»™çš„æç¤ºï¼Œå‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯æ²¡æœ‰ç»™å¾®ä¿¡æœåŠ¡å™¨è¿”å›æ­£ç¡®çš„ä¿¡æ¯ã€‚</p><p>å¾®ä¿¡æœåŠ¡å™¨éœ€è¦çš„æ˜¯<code>success</code>æˆ–è€…ç©ºçš„å­—ç¬¦ä¸²ã€‚ä¸èƒ½æ˜¯jsonæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚<br>æœäº†ä¸€ä¸‹å…¶ä»–æ–‡ç« ï¼Œæœ‰çš„è¯´xmlé‡Œä¹Ÿä¸èƒ½å¸¦æœ‰ç©ºæ ¼ï¼›æœ‰çš„è¯´å…¬ä¼—å·ç»‘å®šäº†ç¬¬ä¸‰æ–¹å¹³å°ï¼Œè¦å»è§£ç»‘ã€‚<br>ä½†è¿™äº›å’Œæˆ‘ä»¬çš„æƒ…å†µä¸ä¸€è‡´ã€‚</p><p>ç»™å…¬ä¼—å·çš„æ¥å£æ˜¯é»˜è®¤è¿”å›<code>success</code>çš„ã€‚</p><p>æŸ¥çœ‹è¿è¡Œlogï¼Œå‘ç°ç”¨æˆ·å‘é€1æ¡æ¶ˆæ¯ç»™å…¬ä¼—å·ï¼Œæˆ‘ä»¬çš„æœåŠ¡ç«¯ä¼šæ”¶åˆ°4æ¡ä¸€æ¨¡ä¸€æ ·çš„æ¶ˆæ¯ã€‚<br>è¿™4æ¡æ¶ˆæ¯çš„MsgIdæ˜¯ä¸€æ ·çš„ã€‚ç½‘ä¸Šä¹Ÿæœ‰äººæä¾›äº†é˜²æ­¢é‡å¤æ¶ˆæ¯çš„åŠæ³•ã€‚</p><p>äºæ˜¯å°è¯•ä»¥ä¸‹æ–¹æ³•</p><ol><li>ç»´æŠ¤ä¸€ä¸ªmapï¼Œkeyæ˜¯MsgIdã€‚</li><li>æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œå¦‚æœå‘ç°æ˜¯é‡å¤çš„MsgIdï¼Œåˆ™ç«‹åˆ»è¿”å›<code>success</code>ï¼ˆæˆ–è€…ç©ºå­—ç¬¦ä¸²ï¼‰ã€‚</li></ol><p>ä½†æ˜¯é—®é¢˜ä¾æ—§æ²¡æœ‰è§£å†³ã€‚</p><p>å¾®ä¿¡æœåŠ¡å™¨è®¤ä¸ºå®ƒæ²¡æœ‰æ‹¿åˆ°æ­£ç¡®çš„è¿”å›å€¼ï¼Œäºæ˜¯èµ°äº†é‡è¯•çš„æµç¨‹ã€‚<br>æˆ‘ä»¬ubuntuæœåŠ¡å™¨ä¸Šä½¿ç”¨äº†nginxï¼Œäºæ˜¯æˆ‘ä»¬æŸ¥çœ‹nginxçš„log<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs log">81.69.1.1 - - [03/Aug/2021:09:41:25 +0800] &quot;POST /mywxserve/?signature=sign1111&amp;timestamp=1627954885&amp;nonce=1832145745&amp;openid=qqq HTTP/1.1&quot; 201 0 &quot;-&quot; &quot;Mozilla/4.0&quot;<br>81.69.1.1 - - [03/Aug/2021:09:41:26 +0800] &quot;POST /mywxserve/?signature=sign1111&amp;timestamp=1627954885&amp;nonce=1832145745&amp;openid=qqq HTTP/1.1&quot; 201 7 &quot;-&quot; &quot;Mozilla/4.0&quot;<br>81.69.1.1 - - [03/Aug/2021:09:41:26 +0800] &quot;POST /mywxserve/?signature=sign1111&amp;timestamp=1627954885&amp;nonce=1832145745&amp;openid=qqq HTTP/1.1&quot; 201 7 &quot;-&quot; &quot;Mozilla/4.0&quot;<br>42.192.1.1 - - [03/Aug/2021:09:41:26 +0800] &quot;POST /mywxserve/?signature=sign1111&amp;timestamp=1627954885&amp;nonce=1832145745&amp;openid=qqq HTTP/1.1&quot; 201 7 &quot;-&quot; &quot;Mozilla/4.0&quot;<br></code></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°æœ‰2ä¸ªipåœ°å€ï¼Œå‘æ¥äº†3+1æ¬¡è¯·æ±‚ã€‚çœ‹åˆ°nginxè¿”å›çš„çŠ¶æ€ç éƒ½æ˜¯201ã€‚<br>(ipåœ°å€å’Œä¿¡æ¯æ¨¡ç³Šå¤„ç†)</p><p>çŠ¶æ€ç 201è¡¨ç¤ºâ€œå·²åˆ›å»ºâ€ã€‚NestJSé»˜è®¤çŠ¶æ€ç æ˜¯200ï¼Œä½†æ˜¯<a href="https://docs.nestjs.com/controllers#status-code">é»˜è®¤POSTçš„çŠ¶æ€ç </a>æ˜¯201ã€‚</p><h2 id="ä¿®å¤"><a href="#ä¿®å¤" class="headerlink" title="ä¿®å¤"></a>ä¿®å¤</h2><p>æˆ‘ä»¬å¼ºåˆ¶è®©nestjsè¿”å›çŠ¶æ€ç 200<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-meta">@HttpCode</span>(<span class="hljs-number">200</span>)<br><span class="hljs-meta">@Post</span>()<br><span class="hljs-keyword">async</span> <span class="hljs-title function_">onWxEvent</span>(<span class="hljs-meta">@Body</span>(<span class="hljs-string">&#x27;xml&#x27;</span>) <span class="hljs-attr">xmlData</span>: <span class="hljs-title class_">IWxMessageXmlData</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; &#123;&#125;<br></code></pre></td></tr></table></figure></p><p>å†å°è¯•ä¸€ä¸‹ï¼Œçœ‹åˆ°nginxçš„logï¼Œè¿”å›çŠ¶æ€ç æ˜¯200äº†ã€‚å…¬ä¼—å·ä¹Ÿæ­£å¸¸äº†ã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs log">81.69.1.1 - - [03/Aug/2021:09:53:27 +0800] &quot;POST /mywxserve/?signature=rustfisher&amp;timestamp=1627955607&amp;nonce=1829147547&amp;openid=xxx0 HTTP/1.1&quot; 200 0 &quot;-&quot; &quot;Mozilla/4.0&quot;<br></code></pre></td></tr></table></figure></p><p>ç”±æ­¤å¯è§ï¼Œæ¥æ”¶å¾®ä¿¡å…¬ä¼—å·æ¶ˆæ¯çš„æ—¶å€™ï¼Œé™¤äº†è¦è¿”å›ç©ºå­—ç¬¦ä¸²æˆ–è€…<code>success</code>æ–‡æœ¬ï¼›è¿”å›çŠ¶æ€ç å¿…é¡»æ˜¯200ã€‚<br>ç”¨å…¶ä»–çš„åå°æ¡†æ¶å¯èƒ½ä¸ä¼šé‡åˆ°çŠ¶æ€ç é—®é¢˜ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li>wxåŸºç¡€æ¶ˆæ¯èƒ½åŠ›-è¢«åŠ¨å›å¤ç”¨æˆ·æ¶ˆæ¯ <a href="https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Passive_user_reply_message.html">https://developers.weixin.qq.com/doc/offiaccount/Message_Management/Passive_user_reply_message.html</a></li><li>NestJS controller <a href="https://docs.nestjs.com/controllers#status-code">https://docs.nestjs.com/controllers#status-code</a> </li><li>NestJSæ–‡ç« é›†åˆ <a href="https://rustfisher.com/categories/NestJS/">https://rustfisher.com/categories/NestJS/</a></li><li>httpçŠ¶æ€ç  <a href="https://rustfisher.com/2021/06/25/Network/http-code/">https://rustfisher.com/2021/06/25/Network/http-code/</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>NestJS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NestJS</tag>
      
      <tag>åç«¯</tag>
      
      <tag>å…¬ä¼—å·</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NestJS WebSocket å¼€å§‹ä½¿ç”¨</title>
    <link href="/2021/07/22/NestJS/nestjs-websocket-start/"/>
    <url>/2021/07/22/NestJS/nestjs-websocket-start/</url>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨NestJsæä¾›WebSocketæœåŠ¡ã€‚<br>æœ¬æ–‡ä¼šåœ¨æ–°å»ºé¡¹ç›®çš„åŸºç¡€ä¸Šå¢åŠ 2ä¸ªç±»</p><ul><li>Gateway å®ç°ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹</li><li>WebSocketAdapter WebSocketé€‚é…å™¨</li></ul><h2 id="æ–°å»ºé¡¹ç›®"><a href="#æ–°å»ºé¡¹ç›®" class="headerlink" title="æ–°å»ºé¡¹ç›®"></a>æ–°å»ºé¡¹ç›®</h2><p>æ–°å»ºä¸€ä¸ªé¡¹ç›®æ¥æ¼”ç¤ºï¼Œç”¨npmæ¥ç®¡ç†é¡¹ç›®ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nest new websocket-start<br></code></pre></td></tr></table></figure></p><p>å¾—åˆ°ä¸€ä¸ªæœ‰åŸºç¡€åŠŸèƒ½çš„å·¥ç¨‹ã€‚</p><p>è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œå®‰è£…2ä¸ªåº“<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm i --save @nestjs/websockets @nestjs/platform-socket.io<br></code></pre></td></tr></table></figure></p><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><p>ä½¿ç”¨ç«¯å£3001<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">await</span> app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3001</span>);<br></code></pre></td></tr></table></figure><br><code>npm run start</code>å¯åŠ¨æˆ‘ä»¬çš„å·¥ç¨‹ã€‚ç”¨postmanæµ‹ä¸€ä¸‹ï¼ŒåŠŸèƒ½okã€‚</p><h3 id="gatewayä»‹ç»"><a href="#gatewayä»‹ç»" class="headerlink" title="gatewayä»‹ç»"></a><strong>gateway</strong>ä»‹ç»</h3><p>Nesté‡Œçš„gateway(ç½‘å…³)åªæ˜¯ä¸€ä¸ªç”¨ <code>@WebSocketGateway()</code> è£…é¥°å™¨æ³¨é‡Šçš„ç±»ã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼Œç½‘å…³ä¸å¹³å°æ— å…³ï¼Œåœ¨åˆ›å»ºé€‚é…å™¨åå®ƒä»¬ä¸ä»»ä½• WebSockets åº“éƒ½å…¼å®¹ã€‚</p><h4 id="æ–°å»ºGateway"><a href="#æ–°å»ºGateway" class="headerlink" title="æ–°å»ºGateway"></a>æ–°å»ºGateway</h4><p>æ–°å»º<strong>ws.gateway.ts</strong>æ–‡ä»¶ã€‚åœ¨è£…é¥°å™¨<code>@WebSocketGateway()</code>é‡Œç«¯å£æŒ‡å®šä¸º3002ã€‚<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ConnectedSocket</span>, <span class="hljs-title class_">MessageBody</span>, <span class="hljs-title class_">SubscribeMessage</span>, <span class="hljs-title class_">WebSocketGateway</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;@nestjs/websockets&quot;</span>;<br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">WebSocket</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;ws&#x27;</span>;<br><br><span class="hljs-meta">@WebSocketGateway</span>(<span class="hljs-number">3002</span>)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WsStartGateway</span> &#123;<br><br>  <span class="hljs-meta">@SubscribeMessage</span>(<span class="hljs-string">&#x27;hello&#x27;</span>)<br>  <span class="hljs-title function_">hello</span>(<span class="hljs-meta">@MessageBody</span>() <span class="hljs-attr">data</span>: <span class="hljs-built_in">any</span>): <span class="hljs-built_in">any</span> &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-string">&quot;event&quot;</span>: <span class="hljs-string">&quot;hello&quot;</span>,<br>      <span class="hljs-string">&quot;data&quot;</span>: data,<br>      <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&#x27;rustfisher.com&#x27;</span><br>    &#125;;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br>é‡Œé¢æœ‰ä¸€ä¸ª<code>hello</code>æ–¹æ³•ï¼Œè®¢é˜…çš„æ¶ˆæ¯æ˜¯<code>&#39;hello&#39;</code>ã€‚</p><p>æŠŠå®ƒæ”¾è¿›<code>AppModule</code>çš„<code>providers</code>é‡Œã€‚<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-attr">providers</span>: [<span class="hljs-title class_">WsStartGateway</span>],<br></code></pre></td></tr></table></figure></p><p>å¦‚æœwebsocktå’Œhttpç”¨äº†åŒä¸€ä¸ªæ¥å£(æœ¬ä¾‹æ˜¯3001)ï¼Œå¯åŠ¨æ—¶ä¼šæŠ¥é”™<br><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">Error: </span>listen EADDRINUSE: address already in use :::3001<br></code></pre></td></tr></table></figure><br>å› æ­¤æˆ‘ä»¬è¿™é‡Œç»™wsåˆ†é…å¦ä¸€ä¸ªç«¯å£å·ã€‚</p><h4 id="è·å–WebSocketå¯¹è±¡"><a href="#è·å–WebSocketå¯¹è±¡" class="headerlink" title="è·å–WebSocketå¯¹è±¡"></a>è·å–WebSocketå¯¹è±¡</h4><p>åœ¨<code>WsStartGateway</code>é‡Œæ–°å¢åŠ ä¸€ä¸ªæ¶ˆæ¯è®¢é˜…æ–¹æ³•ã€‚<br>æ–¹æ³•é‡Œæ¥å—<code>@ConnectedSocket() client: WebSocket</code>ï¼Œè¿™ä¸ªclientå°±æ˜¯ä¸å®¢æˆ·ç«¯çš„è¿æ¥å¯¹è±¡ã€‚<br>æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥ç»™å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-meta">@SubscribeMessage</span>(<span class="hljs-string">&#x27;hello2&#x27;</span>)<br><span class="hljs-title function_">hello2</span>(<span class="hljs-meta">@MessageBody</span>() <span class="hljs-attr">data</span>: <span class="hljs-built_in">any</span>, <span class="hljs-meta">@ConnectedSocket</span>() <span class="hljs-attr">client</span>: <span class="hljs-title class_">WebSocket</span>): <span class="hljs-built_in">any</span> &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;æ”¶åˆ°æ¶ˆæ¯ client:&#x27;</span>, client);<br>  client.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(&#123; <span class="hljs-attr">event</span>: <span class="hljs-string">&#x27;tmp&#x27;</span>, <span class="hljs-attr">data</span>: <span class="hljs-string">&#x27;è¿™é‡Œæ˜¯ä¸ªä¸´æ—¶ä¿¡æ¯&#x27;</span> &#125;));<br>  <span class="hljs-keyword">return</span> &#123; <span class="hljs-attr">event</span>: <span class="hljs-string">&#x27;hello2&#x27;</span>, <span class="hljs-attr">data</span>: data &#125;;<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="è‡ªå®šä¹‰WebSocketAdapter"><a href="#è‡ªå®šä¹‰WebSocketAdapter" class="headerlink" title="è‡ªå®šä¹‰WebSocketAdapter"></a>è‡ªå®šä¹‰WebSocketAdapter</h3><p>å‰é¢æˆ‘ä»¬å»ºç«‹å¥½äº†Gatewayï¼Œè¿˜éœ€è¦ä¸€ä¸ªé€‚é…å™¨ã€‚<br>æ–°å»ºæ–‡ä»¶<strong>ws.adapter.ts</strong>ï¼Œç»§æ‰¿<code>WebSocketAdapter</code><br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">WebSocket</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;ws&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">WebSocketAdapter</span>, <span class="hljs-title class_">INestApplicationContext</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/common&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">MessageMappingProperties</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/websockets&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">Observable</span>, fromEvent, <span class="hljs-variable constant_">EMPTY</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rxjs&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; mergeMap, filter &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;rxjs/operators&#x27;</span>;<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WsAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebSocketAdapter</span> &#123;<br><br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">private</span> app: INestApplicationContext</span>) &#123; &#125;<br><br>    <span class="hljs-title function_">create</span>(<span class="hljs-attr">port</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">options</span>: <span class="hljs-built_in">any</span> = &#123;&#125;): <span class="hljs-built_in">any</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;ws create&#x27;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>.<span class="hljs-title class_">Server</span>(&#123; port, ...options &#125;);<br>    &#125;<br><br>    <span class="hljs-title function_">bindClientConnect</span>(<span class="hljs-params">server, callback: <span class="hljs-built_in">Function</span></span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;ws bindClientConnect, server:\n&#x27;</span>, server);<br>        server.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;connection&#x27;</span>, callback);<br>    &#125;<br><br>    <span class="hljs-title function_">bindMessageHandlers</span>(<span class="hljs-params"></span><br><span class="hljs-params">        client: WebSocket,</span><br><span class="hljs-params">        handlers: MessageMappingProperties[],</span><br><span class="hljs-params">        process: (data: <span class="hljs-built_in">any</span>) =&gt; Observable&lt;<span class="hljs-built_in">any</span>&gt;,</span><br><span class="hljs-params">    </span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;[waAdapter]æœ‰æ–°çš„è¿æ¥è¿›æ¥&#x27;</span>)<br>        <span class="hljs-title function_">fromEvent</span>(client, <span class="hljs-string">&#x27;message&#x27;</span>)<br>            .<span class="hljs-title function_">pipe</span>(<br>                <span class="hljs-title function_">mergeMap</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">bindMessageHandler</span>(client, data, handlers, process)),<br>                <span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> result),<br>            )<br>            .<span class="hljs-title function_">subscribe</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> client.<span class="hljs-title function_">send</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response)));<br>    &#125;<br><br>    <span class="hljs-title function_">bindMessageHandler</span>(<br>        <span class="hljs-attr">client</span>: <span class="hljs-title class_">WebSocket</span>,<br>        buffer,<br>        <span class="hljs-attr">handlers</span>: <span class="hljs-title class_">MessageMappingProperties</span>[],<br>        <span class="hljs-attr">process</span>: <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">any</span></span>) =&gt;</span> <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-built_in">any</span>&gt;,<br>    ): <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-built_in">any</span>&gt; &#123;<br>        <span class="hljs-keyword">let</span> message = <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            message = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(buffer.<span class="hljs-property">data</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (error) &#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;wsè§£æjsonå‡ºé”™&#x27;</span>, error);<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">EMPTY</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">const</span> messageHandler = handlers.<span class="hljs-title function_">find</span>(<br>            <span class="hljs-function"><span class="hljs-params">handler</span> =&gt;</span> handler.<span class="hljs-property">message</span> === message.<span class="hljs-property">event</span>,<br>        );<br>        <span class="hljs-keyword">if</span> (!messageHandler) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">EMPTY</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">process</span>(messageHandler.<span class="hljs-title function_">callback</span>(message.<span class="hljs-property">data</span>));<br>    &#125;<br><br>    <span class="hljs-title function_">close</span>(<span class="hljs-params">server</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;ws server close&#x27;</span>);<br>        server.<span class="hljs-title function_">close</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br>åœ¨<code>bindMessageHandler</code>æ–¹æ³•ä¸­ï¼Œä¼šå°†ä¼ æ¥çš„jsonæ¶ˆæ¯è§£æï¼Œç„¶åå‘é€åˆ°å¯¹åº”çš„å¤„ç†å™¨ä¸­ã€‚<br>è¿™é‡Œå°±æ˜¯å‘ç»™gatewayè¿›è¡Œå¤„ç†ã€‚<br>åˆ¤æ–­ä¾æ®æ˜¯<code>message.event</code>ï¼Œå°±æ˜¯<code>event</code>å­—æ®µã€‚</p><p>åœ¨<strong>main.ts</strong>é‡Œä½¿ç”¨è¿™ä¸ªé€‚é…å™¨ã€‚<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">NestFactory</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/core&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">AppModule</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./app.module&#x27;</span>;<br><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">WsAdapter</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./ws/ws.adapter&#x27;</span>;<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-keyword">const</span> app = <span class="hljs-keyword">await</span> <span class="hljs-title class_">NestFactory</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">AppModule</span>);<br>  app.<span class="hljs-title function_">useWebSocketAdapter</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WsAdapter</span>(app)); <span class="hljs-comment">// ä½¿ç”¨æˆ‘ä»¬çš„é€‚é…å™¨</span><br>  <span class="hljs-keyword">await</span> app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3001</span>);<br>&#125;<br><span class="hljs-title function_">bootstrap</span>();<br></code></pre></td></tr></table></figure></p><p><code>npm run start</code>è¿è¡Œé¡¹ç›®ï¼Œå‡†å¤‡è¿›ä¸€æ­¥æµ‹è¯•ã€‚</p><h2 id="ç”¨Postmanæ¥æµ‹è¯•WebSocket"><a href="#ç”¨Postmanæ¥æµ‹è¯•WebSocket" class="headerlink" title="ç”¨Postmanæ¥æµ‹è¯•WebSocket"></a>ç”¨Postmanæ¥æµ‹è¯•WebSocket</h2><p>Postman8.8.0æä¾›äº†betaç‰ˆçš„WebSocketæµ‹è¯•åŠŸèƒ½ã€‚<br><code>New -&gt; WebSocket Request beta</code>æ–°å»ºä¸€ä¸ªWebSocketæµ‹è¯•ã€‚å½“å‰ç‰ˆæœ¬è¿˜ä¸æ”¯æŒä¿å­˜wsçš„æµ‹è¯•ä¾‹å­ã€‚<br>è¾“å…¥ç›®æ ‡url <code>ws://localhost:3002</code>ï¼Œç‚¹å‡»è¿æ¥ Connect æŒ‰é’®ã€‚</p><p><img src="p1.png" alt=""></p><p>å‘é€æµ‹è¯•æ¶ˆæ¯ã€‚åœ¨æ¶ˆæ¯æ¡†é‡Œå¡«å…¥ä»¥ä¸‹jsonæ•°æ®ã€‚<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;event&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hello&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æµ‹è¯•æ•°æ®&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></p><p><img src="p2.png" alt=""></p><p>å‘é€çš„æ•°æ®ç»è¿‡<code>WsAdapter</code>åˆ†å‘ç»™<code>WsStartGateway</code>ï¼Œå¤„ç†åè¿”å›æ•°æ®ã€‚</p><p>å‘é€hello2æµ‹è¯•æ•°æ®<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;event&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hello2&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;data&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;æµ‹è¯•æ•°æ®&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></p><p><img src="p3.png" alt=""></p><p>å¯ä»¥çœ‹åˆ°æœåŠ¡è¿”å›äº†2æ¡æ•°æ®ã€‚</p><p>å‘é€ä¸€ä¸ªé”™è¯¯æ ¼å¼çš„æ•°æ®<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;event&quot;</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;hello2</span><br></code></pre></td></tr></table></figure></p><p>æœåŠ¡ç«¯æ¥æ”¶åˆ°äº†æ•°æ®ï¼Œä½†æ˜¯è§£æå¤±è´¥<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wsè§£æjsonå‡ºé”™ SyntaxError: Unexpected end of JSON input<br></code></pre></td></tr></table></figure></p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>è¦ä½¿ç”¨WebSocketåŠŸèƒ½ï¼Œéœ€è¦å¢åŠ </p><ul><li>Gateway å®ç°ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹</li><li>WebSocketAdapter WebSocketé€‚é…å™¨</li></ul><p>wsçš„ç«¯å£å»ºè®®æ˜¯å’Œhttpçš„ç«¯å£åˆ†å¼€ã€‚</p><p>å‚è€ƒ</p><ul><li>NestJS WebSockets <a href="https://docs.nestjs.com/websockets/gateways">https://docs.nestjs.com/websockets/gateways</a></li><li>NestJS åˆé›† <a href="https://rustfisher.com/categories/NestJS/">https://rustfisher.com/categories/NestJS/</a></li><li>ç¤ºä¾‹å·¥ç¨‹ <a href="https://gitee.com/rustfisher/nest-sample">https://gitee.com/rustfisher/nest-sample</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>NestJS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NestJS</tag>
      
      <tag>åç«¯</tag>
      
      <tag>WebSocket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonå›¾è¡¨åº“Matplotlib ç»„æˆéƒ¨åˆ†ä»‹ç»</title>
    <link href="/2021/07/20/Python/operation/matplotlib-intro-parts/"/>
    <url>/2021/07/20/Python/operation/matplotlib-intro-parts/</url>
    
    <content type="html"><![CDATA[<p>å›¾è¡¨æœ‰å¾ˆå¤šä¸ªç»„æˆéƒ¨åˆ†ï¼Œä¾‹å¦‚æ ‡é¢˜ã€x/yè½´åç§°ã€å¤§åˆ»åº¦å°åˆ»åº¦ã€çº¿æ¡ã€æ•°æ®ç‚¹ã€æ³¨é‡Šè¯´æ˜ç­‰ç­‰ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹å®˜æ–¹ç»™çš„å›¾ï¼Œå›¾ä¸­æ ‡å‡ºäº†å„ä¸ªéƒ¨åˆ†çš„è‹±æ–‡åç§°</p><p><img src="anatomy.webp" alt=""></p><p>Matplotlibæä¾›äº†å¾ˆå¤šapiï¼Œå¼€å‘è€…å¯æ ¹æ®éœ€æ±‚å®šåˆ¶å›¾è¡¨çš„æ ·å¼ã€‚<br><a href="https://rustfisher.com/2021/07/16/Python/operation/matplotlib-intro1/">å‰é¢</a>æˆ‘ä»¬è®¾ç½®äº†æ ‡é¢˜å’Œx/yè½´çš„åç§°ï¼Œæœ¬æ–‡ä»‹ç»æ›´å¤šè®¾ç½®å…¶ä»–éƒ¨åˆ†çš„æ–¹æ³•ã€‚</p><h2 id="ç»˜å›¾"><a href="#ç»˜å›¾" class="headerlink" title="ç»˜å›¾"></a>ç»˜å›¾</h2><p>å…ˆç»˜åˆ¶ä¸€ä¸ªäº‹ä¾‹å›¾ã€‚ç„¶åä»¥æ­¤ä¸ºåŸºç¡€è¿›è¡Œå®šåˆ¶ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">demo2</span>():<br>    x_list = []<br>    y_list = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">365</span>):<br>        x_list.append(i)<br>        y_list.append(math.sin(i * <span class="hljs-number">0.1</span>))<br>    ax = plt.gca()<br>    ax.set_title(<span class="hljs-string">&#x27;rustfisher.com mapplotlib example&#x27;</span>)<br>    ax.set_xlabel(<span class="hljs-string">&#x27;x&#x27;</span>)<br>    ax.set_ylabel(<span class="hljs-string">&#x27;y = sin(x)&#x27;</span>)<br>    ax.grid()<br>    plt.plot(x_list, y_list)<br>    plt.show()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;rustfisher å›¾è¡¨è®²è§£&#x27;</span>)<br>    demo2()<br></code></pre></td></tr></table></figure><br>è¿è¡Œå¾—åˆ°<br><img src="figure-ax.png" alt=""></p><p>çº¢è‰²æ¡†æ¡†é‡Œçš„æ˜¯figureï¼›ç»¿è‰²æ¡†æ¡†é‡Œçš„å«åšaxã€‚<br>ä»£ç ä¸­<code>ax = plt.gca()</code>è·å–åˆ°çš„å°±æ˜¯ç»¿è‰²æ¡†æ¡†é‡Œçš„éƒ¨åˆ†ï¼ˆå¯¹è±¡ï¼‰ã€‚</p><h2 id="Figure-å¤§å›¾"><a href="#Figure-å¤§å›¾" class="headerlink" title="Figure å¤§å›¾"></a>Figure å¤§å›¾</h2><p>Figureä»£è¡¨æ•´å¼ å›¾ï¼Œæš‚æ—¶ç§°ä¸ºâ€œå…¨å›¾â€æˆ–è€…â€œå¤§å›¾â€ã€‚ä¸€å¼ å›¾é‡Œå¯ä»¥æœ‰å¤šä¸ªå­å›¾è¡¨ã€‚æœ€å°‘å¿…é¡»è¦æœ‰ä¸€ä¸ªå›¾è¡¨ã€‚åƒä¸Šé¢é‚£æ ·ã€‚</p><h2 id="Axes-æ•°æ®å›¾"><a href="#Axes-æ•°æ®å›¾" class="headerlink" title="Axes æ•°æ®å›¾"></a>Axes æ•°æ®å›¾</h2><p>ä¸€å¼ å¼ çš„å›¾ï¼Œå›¾é‡Œæ˜¾ç¤ºç€æ•°æ®ï¼Œæš‚ç§°ä¸ºâ€œæ•°æ®å›¾â€ã€‚ä¸€ä¸ªå¤§å›¾é‡Œå¯ä»¥æœ‰å¤šä¸ªæ•°æ®å›¾ã€‚ä½†å•ä¸ªæ•°æ®å›¾å¯¹è±¡åªèƒ½åœ¨1ä¸ªå¤§å›¾é‡Œã€‚</p><h3 id="å¤šå¼ æ•°æ®å›¾-subplots"><a href="#å¤šå¼ æ•°æ®å›¾-subplots" class="headerlink" title="å¤šå¼ æ•°æ®å›¾ subplots"></a>å¤šå¼ æ•°æ®å›¾ subplots</h3><p>ä¾‹å¦‚åŒæ—¶å­˜åœ¨2ä¸ªæ•°æ®å›¾</p><p><img src="subplot1-2.png" alt=""></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_subplot</span>():<br>    x_list = []<br>    y_list = []<br>    y2_list = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">365</span>):<br>        x_list.append(i)<br>        y_list.append(math.sin(i * <span class="hljs-number">0.1</span>))<br>        y2_list.append(math.cos(i * <span class="hljs-number">0.1</span>))<br>    fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">2</span>)<br>    ax1.set_title(<span class="hljs-string">&#x27;rustfisher.com 1&#x27;</span>)<br>    ax2.set_title(<span class="hljs-string">&#x27;rustfisher.com 2&#x27;</span>)<br>    ax1.set_xlabel(<span class="hljs-string">&#x27;x&#x27;</span>)<br>    ax1.set_ylabel(<span class="hljs-string">&#x27;y = sin(x)&#x27;</span>)<br>    ax2.set_xlabel(<span class="hljs-string">&#x27;x&#x27;</span>)<br>    ax2.set_ylabel(<span class="hljs-string">&#x27;y = cos(x)&#x27;</span>)<br>    ax1.plot(x_list, y_list)<br>    ax2.plot(x_list, y2_list)<br>    plt.show()<br></code></pre></td></tr></table></figure><p>è°ƒç”¨<code>subplots()</code>æ¥å£ï¼Œä¼ å…¥æ•°å­—æŒ‡å®šè¦å¤šå°‘å¼ æ•°æ®å›¾ã€‚<br>è¿”å›çš„å¤šå¼ å›¾è¦ç”¨æ‹¬å·æ‹¬èµ·æ¥ã€‚æ¯ä¸ªæ•°æ®å›¾å¯ä»¥ç»˜åˆ¶(<code>plot</code>)ä¸åŒçš„æ•°æ®ã€‚<br>æ ‡é¢˜ç”¨<code>set_title()</code>æ¥è®¾ç½®ã€‚</p><p>å¯ä»¥çœ‹åˆ°ä¸Šä¸‹ä¸¤å¼ å›¾å¤ªæŒ¤äº†ï¼Œæœ‰é‡å éƒ¨åˆ†ã€‚å¯ä»¥åœ¨<code>plt.show()</code>ä¹‹å‰åŠ ä¸€ä¸ª<code>fig.tight_layout()</code>è®©å®ƒä»¬æ‹‰å¼€ä¸€ç‚¹è·ç¦»ã€‚</p><p><img src="subplot1-2-tight.png" alt=""></p><h3 id="åæ ‡è½´"><a href="#åæ ‡è½´" class="headerlink" title="åæ ‡è½´"></a>åæ ‡è½´</h3><p>å¯¹äº2ç»´æ•°æ®å›¾ï¼Œå®ƒæœ‰2ä¸ªåæ ‡ï¼Œæ¨ªåæ ‡å’Œçºµåæ ‡ã€‚æœ‰ä¸€äº›æ¥å£å¯ä»¥è®¾ç½®å‚æ•°ã€‚<br>ä¾‹å¦‚æ§åˆ¶åæ ‡è½´çš„åå­—<code>set_xlabel()</code> <code>set_ylabel</code>ï¼›</p><h4 id="æ˜¾ç¤ºæ•°æ®èŒƒå›´"><a href="#æ˜¾ç¤ºæ•°æ®èŒƒå›´" class="headerlink" title="æ˜¾ç¤ºæ•°æ®èŒƒå›´"></a>æ˜¾ç¤ºæ•°æ®èŒƒå›´</h4><p><code>set_xlim</code>æ–¹æ³•å¯ä»¥æ§åˆ¶xè½´æ•°æ®æ˜¾ç¤ºèŒƒå›´ã€‚åŒç†yè½´ç”¨<code>set_ylim</code>æ¥æ§åˆ¶ã€‚<br>å¯¹äºæ˜¾ç¤ºèŒƒå›´ï¼Œ<code>set_xlim</code>æ–¹æ³•ä¸»è¦å‚æ•°ä¸º<code>left</code>å’Œ<code>right</code>ï¼›æˆ–è€…ç”¨<code>xmin</code> <code>xmax</code>ã€‚è¿™ä¸¤å¥—ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚<br><code>set_ylim</code>ä¸»è¦å‚æ•°æ˜¯<code>top</code> <code>bottom</code>ï¼›æˆ–è€…<code>ymin</code> <code>ymax</code>ã€‚è¿™ä¸¤å¥—ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚</p><p>å¢åŠ æ˜¾ç¤ºèŒƒå›´æ§åˆ¶çš„ä»£ç <br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">demo3</span>():<br>    x_list = []<br>    y_list = []<br>    y2_list = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">365</span>):<br>        x_list.append(i)<br>        y_list.append(math.sin(i * <span class="hljs-number">0.1</span>))<br>        y2_list.append(math.cos(i * <span class="hljs-number">0.1</span>))<br>    fig, (ax1, ax2) = plt.subplots(<span class="hljs-number">2</span>)<br>    ax1.set_title(<span class="hljs-string">&#x27;rustfisher.com 1&#x27;</span>)<br>    ax1.set_xlabel(<span class="hljs-string">&#x27;x&#x27;</span>)<br>    ax1.set_ylabel(<span class="hljs-string">&#x27;y = sin(x)&#x27;</span>)<br>    ax2.set_title(<span class="hljs-string">&#x27;rustfisher.com 2&#x27;</span>)<br>    ax2.set_xlabel(<span class="hljs-string">&#x27;x&#x27;</span>)<br>    ax2.set_ylabel(<span class="hljs-string">&#x27;y = cos(x)&#x27;</span>)<br><br>    ax1.set_xlim(left=<span class="hljs-number">50</span>, right=<span class="hljs-number">200.6</span>)  <span class="hljs-comment"># æ§åˆ¶xè½´æ˜¾ç¤ºèŒƒå›´</span><br>    ax1.set_ylim(top=<span class="hljs-number">1</span>, bottom=<span class="hljs-number">0.3</span>)  <span class="hljs-comment"># æ§åˆ¶yè½´æ˜¾ç¤ºèŒƒå›´</span><br><br>    ax2.set_xlim(xmin=<span class="hljs-number">1</span>, xmax=<span class="hljs-number">156.6</span>)  <span class="hljs-comment"># æ§åˆ¶xè½´æ˜¾ç¤ºèŒƒå›´</span><br>    ax2.set_ylim(ymin=-<span class="hljs-number">0.3</span>, ymax=<span class="hljs-number">0.3</span>)  <span class="hljs-comment"># æ§åˆ¶yè½´æ˜¾ç¤ºèŒƒå›´</span><br><br>    ax1.plot(x_list, y_list)<br>    ax2.plot(x_list, y2_list)<br>    fig.tight_layout()<br>    plt.show()<br></code></pre></td></tr></table></figure></p><p>è¿è¡Œç»“æœ</p><p><img src="xylim.png" alt=""></p><h4 id="åˆ»åº¦"><a href="#åˆ»åº¦" class="headerlink" title="åˆ»åº¦"></a>åˆ»åº¦</h4><p>tickæ„æ€æ˜¯æ ‡è®°ã€‚åœ¨åæ ‡è½´ä¸Šçš„æ˜¯åˆ»åº¦ã€‚Major tickæš‚ç§°ä¸ºå¤§åˆ»åº¦ï¼Œminor tickæš‚ç§°ä¸ºå°åˆ»åº¦ã€‚<br>ä½¿ç”¨<code>set_xticks</code>æ–¹æ³•æ§åˆ¶åˆ»åº¦æ˜¾ç¤ºã€‚ä¼ å…¥çš„åˆ—è¡¨æ˜¯æˆ‘ä»¬å¸Œæœ›æ˜¾ç¤ºçš„åˆ»åº¦ã€‚<br><code>minor</code>å‚æ•°é»˜è®¤ä¸ºFalseï¼Œä¸æ˜¾ç¤ºå°åˆ»åº¦ã€‚</p><p>å…³é”®ä»£ç å¦‚ä¸‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">ax1.set_xticks([<span class="hljs-number">50</span>, <span class="hljs-number">60</span>, <span class="hljs-number">70</span>, <span class="hljs-number">150</span>])<br>ax1.set_yticks([<span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.7</span>, <span class="hljs-number">0.9</span>])<br>ax1.grid()  <span class="hljs-comment"># æ˜¾ç¤ºæ ¼å­</span><br><br>ax2.set_xticks([<span class="hljs-number">1</span>, <span class="hljs-number">60</span>, <span class="hljs-number">70</span>, <span class="hljs-number">150</span>], minor=<span class="hljs-literal">True</span>)<br>ax2.set_yticks([-<span class="hljs-number">0.1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0.3</span>], minor=<span class="hljs-literal">True</span>)<br>ax2.grid()<br></code></pre></td></tr></table></figure></p><p><img src="xy-ticks.png" alt=""></p><p>å¯è§å½“<code>minor=True</code>ï¼Œä¼ å…¥çš„åˆ»åº¦åˆ—è¡¨æœ‰å¯èƒ½ä¸æ˜¾ç¤ºã€‚</p><p>ä¹Ÿå¯ä»¥æ§åˆ¶å¤§åˆ»åº¦ä¸Šçš„æ–‡å­—æ—‹è½¬<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">plt.setp(ax1.xaxis.get_majorticklabels(), rotation=-<span class="hljs-number">45</span>)<br>plt.setp(ax2.xaxis.get_majorticklabels(), rotation=-<span class="hljs-number">60</span>)<br></code></pre></td></tr></table></figure></p><p><img src="majortick-rotate.png" alt=""></p><h4 id="è¾¹çº¿-spine"><a href="#è¾¹çº¿-spine" class="headerlink" title="è¾¹çº¿ spine"></a>è¾¹çº¿ spine</h4><p>spineæ˜¯è„ŠæŸ±çš„æ„æ€ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆç§°ä¸ºè¾¹çº¿ã€‚æœ‰ä¸Šä¸‹å·¦å³4æ¡è¾¹çº¿ã€‚åç§°æ˜¯<code>top</code> <code>bottom</code> <code>left</code> <code>right</code><br>å¯ä»¥ç›´æ¥ä»å›¾è¡¨å¯¹è±¡è·å–å®ƒçš„è¾¹çº¿ï¼Œæ¯”å¦‚å³è¾¹çº¿<code>ax1.spines.right</code>ã€‚</p><p>ä¸€äº›ç®€å•çš„æ“ä½œï¼Œä¾‹å¦‚</p><ul><li><code>set_visible</code> æ˜¾ç¤ºå’Œéšè—</li><li><code>set_ticks_position</code> åˆ»åº¦æ˜¾ç¤ºçš„ä½ç½®</li><li><code>set_bounds</code> è¾¹çº¿æ˜¾ç¤ºèŒƒå›´</li><li><code>set_linewidth</code> çº¿çš„å®½åº¦</li></ul><p>éšè—å³è¾¹çº¿å’Œä¸Šè¾¹çº¿<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">ax1.spines.right.set_visible(<span class="hljs-literal">False</span>)<br>ax1.spines.top.set_visible(<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure></p><p>è®©åˆ»åº¦æ˜¾ç¤ºåœ¨å³è¾¹å’Œä¸Šæ–¹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">ax2.yaxis.set_ticks_position(<span class="hljs-string">&#x27;right&#x27;</span>)<br>ax2.xaxis.set_ticks_position(<span class="hljs-string">&#x27;top&#x27;</span>)<br></code></pre></td></tr></table></figure></p><p>è®¾ç½®è¾¹çº¿æ˜¾ç¤ºèŒƒå›´<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">ax3.spines.left.set_bounds(-<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>)<br>ax3.spines.top.set_bounds(<span class="hljs-number">340</span>, <span class="hljs-number">400</span>)<br></code></pre></td></tr></table></figure></p><p>è®¾ç½®çº¿çš„å®½åº¦<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">ax3.spines.bottom.set_linewidth(<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure></p><p>å®Œæ•´ä»£ç å¦‚ä¸‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_spine</span>():<br>    x_list = []<br>    y_list = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">365</span>):<br>        x_list.append(i)<br>        y_list.append(math.sin(i * <span class="hljs-number">0.1</span>))<br><br>    fig, (ax1, ax2, ax3) = plt.subplots(<span class="hljs-number">3</span>)<br>    ax_list = [ax1, ax2, ax3]<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>):<br>        cur_ax = ax_list[i]<br>        cur_ax.set_title(<span class="hljs-string">&#x27;rustfisher.com &#x27;</span> + <span class="hljs-built_in">str</span>(i))<br>        cur_ax.plot(x_list, y_list)<br>        cur_ax.set_xlabel(<span class="hljs-string">&#x27;x&#x27;</span>)<br>        cur_ax.set_ylabel(<span class="hljs-string">&#x27;y = sin(x)&#x27;</span>)<br><br>    ax1.spines.right.set_visible(<span class="hljs-literal">False</span>)<br>    ax1.spines.top.set_visible(<span class="hljs-literal">False</span>)<br><br>    ax2.spines.bottom.set_visible(<span class="hljs-literal">False</span>)<br>    ax2.spines.left.set_visible(<span class="hljs-literal">False</span>)<br>    ax2.yaxis.set_ticks_position(<span class="hljs-string">&#x27;right&#x27;</span>)<br>    ax2.xaxis.set_ticks_position(<span class="hljs-string">&#x27;top&#x27;</span>)<br><br>    ax3.spines.left.set_bounds(-<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>)<br>    ax3.spines.top.set_bounds(<span class="hljs-number">340</span>, <span class="hljs-number">400</span>)<br>    ax3.spines.bottom.set_linewidth(<span class="hljs-number">2</span>)<br><br>    fig.tight_layout()<br>    plt.show()<br></code></pre></td></tr></table></figure></p><p>è¿è¡Œæˆªå›¾</p><p><img src="spines.png" alt=""></p><h3 id="æ•°æ®ç‚¹"><a href="#æ•°æ®ç‚¹" class="headerlink" title="æ•°æ®ç‚¹"></a>æ•°æ®ç‚¹</h3><p>æ§åˆ¶æ•°æ®ç‚¹çš„æ ·å¼ã€‚ä¸‹é¢æˆ‘ä»¬åœ¨ä¸€å¼ å›¾è¡¨é‡Œç»˜åˆ¶å¤šæ¡æ•°æ®çº¿ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_line</span>():<br>    x_list = []<br>    y_list = []<br>    y2_list = []<br>    y3_list = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">20</span>):<br>        x_list.append(i)<br>        y_list.append(math.sin(i) * <span class="hljs-number">2</span> - <span class="hljs-number">4</span>)<br>        y2_list.append(math.sin(i) * <span class="hljs-number">2</span>)<br>        y3_list.append(math.cos(i) * <span class="hljs-number">1.3</span> + <span class="hljs-number">3</span>)<br><br>    plt.plot(x_list, y_list, color=<span class="hljs-string">&#x27;blue&#x27;</span>, linestyle=<span class="hljs-string">&#x27;-.&#x27;</span>, linewidth=<span class="hljs-number">2</span>, markersize=<span class="hljs-number">4</span>)<br>    plt.plot(x_list, y2_list, <span class="hljs-string">&#x27;go&#x27;</span>, linewidth=<span class="hljs-number">1</span>)<br>    plt.plot(x_list, y3_list, <span class="hljs-string">&#x27;r+&#x27;</span>)<br>    plt.show()<br></code></pre></td></tr></table></figure><p><code>plot()</code>æ–¹æ³•ä¸­ï¼Œæ”¯æŒå¤šç§é€‰é¡¹ã€‚</p><p><code>linestyle</code>æ”¯æŒçš„é€‰é¡¹<br>â€˜-â€˜, â€˜â€“â€™, â€˜-.â€™, â€˜:â€™, â€˜Noneâ€™, â€˜ â€˜, â€˜â€™, â€˜solidâ€™, â€˜dashedâ€™, â€˜dashdotâ€™, â€˜dottedâ€™</p><p><img src="line.png" alt=""></p><h3 id="æ³¨é‡Š-legend"><a href="#æ³¨é‡Š-legend" class="headerlink" title="æ³¨é‡Š legend"></a>æ³¨é‡Š legend</h3><p>æ·»åŠ æ³¨é‡Šï¼Œè°ƒç”¨<code>lengend()</code>æ–¹æ³•ã€‚</p><p>åœ¨å‰é¢ä»£ç åŸºç¡€ä¸Šæ·»åŠ <br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">plt.plot(x_list, y_list, color=<span class="hljs-string">&#x27;blue&#x27;</span>, linestyle=<span class="hljs-string">&#x27;-.&#x27;</span>, linewidth=<span class="hljs-number">2</span>, markersize=<span class="hljs-number">4</span>)<br>plt.plot(x_list, y2_list, <span class="hljs-string">&#x27;go&#x27;</span>, linewidth=<span class="hljs-number">1</span>)<br>plt.plot(x_list, y3_list, <span class="hljs-string">&#x27;r+&#x27;</span>)<br>plt.legend([<span class="hljs-string">&#x27;math.sin(i) * 2 - 4&#x27;</span>, <span class="hljs-string">&#x27;math.sin(i) * 2&#x27;</span>, <span class="hljs-string">&#x27;math.cos(i) * 1.3 + 3&#x27;</span>])<br></code></pre></td></tr></table></figure></p><p><img src="legend1.png" alt=""></p><p>æ§åˆ¶æ³¨é‡Šæ˜¾ç¤ºçš„åœ°æ–¹ï¼Œæ·»åŠ <code>bbox_to_anchor</code>å’Œ<code>bbox_transform</code>å±æ€§<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">plt.legend([<span class="hljs-string">&#x27;math.sin(i) * 2 - 4&#x27;</span>, <span class="hljs-string">&#x27;math.sin(i) * 2&#x27;</span>, <span class="hljs-string">&#x27;math.cos(i) * 1.3 + 3&#x27;</span>], bbox_to_anchor=(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>),<br>               bbox_transform=plt.gcf().transFigure)<br></code></pre></td></tr></table></figure></p><p><img src="legend2.png" alt=""></p><h3 id="ä¸­æ–‡ä¹±ç é—®é¢˜"><a href="#ä¸­æ–‡ä¹±ç é—®é¢˜" class="headerlink" title="ä¸­æ–‡ä¹±ç é—®é¢˜"></a>ä¸­æ–‡ä¹±ç é—®é¢˜</h3><p>åœ¨è®¾ç½®æ ‡é¢˜ç”¨åˆ°ä¸­æ–‡çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°ä¹±ç ã€‚<br>å¯ä»¥è®¾ç½®<code>rcParams</code>çš„å­—ä½“ï¼Œè§£å†³ä¹±ç é—®é¢˜ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">plt.rcParams[<span class="hljs-string">&#x27;font.sans-serif&#x27;</span>] = [<span class="hljs-string">&#x27;Arial Unicode MS&#x27;</span>]<br></code></pre></td></tr></table></figure></p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬æŠŠå›¾è¡¨ä¸­å„ä¸ªéƒ¨åˆ†éƒ½ç®€è¦ä»‹ç»äº†ä¸€ä¸‹ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>æœ¬ä¾‹ç¯å¢ƒ</p><ul><li>macOS</li><li>PyCharm CE</li><li>Python3</li></ul><p>å‚è€ƒèµ„æ–™</p><ul><li>ã€è¿è¥çš„PythonæŒ‡å—ã€‘ç»˜åˆ¶å›¾è¡¨Matplotlibå¿«é€Ÿå…¥é—¨<ul><li><a href="https://rustfisher.com/2021/07/16/Python/operation/matplotlib-intro1">https://rustfisher.com/2021/07/16/Python/operation/matplotlib-intro1</a></li></ul></li><li>Pythonç¬”è®° <a href="https://rustfisher.com/categories/Python/">https://rustfisher.com/categories/Python/</a></li><li>matplotlib <a href="https://matplotlib.org/">https://matplotlib.org/</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Matplotlib</tag>
      
      <tag>plt</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€è¿è¥çš„PythonæŒ‡å—ã€‘ç»˜åˆ¶å›¾è¡¨Matplotlibå¿«é€Ÿå…¥é—¨</title>
    <link href="/2021/07/16/Python/operation/matplotlib-intro1/"/>
    <url>/2021/07/16/Python/operation/matplotlib-intro1/</url>
    
    <content type="html"><![CDATA[<p>ç»˜åˆ¶å›¾è¡¨æ˜¯è¿è¥å·¥ä½œä¸­å¸¸è§çš„éœ€æ±‚ã€‚å‰é¢æˆ‘ä»¬è¯•ç€ç”¨<a href="https://rustfisher.com/2019/11/19/Python/Python-op-excel_openpyxl_bar_column_chart/">Pythonæ“ä½œExcelæ¥ç»˜åˆ¶å›¾è¡¨</a>ï¼Œå…¶å®è°ƒç”¨çš„æ˜¯Excelé‡Œçš„å›¾è¡¨åŠŸèƒ½ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ©ç”¨<code>Matplotlib</code>æ¥ç»˜åˆ¶å›¾è¡¨ã€‚</p><blockquote><p>Matplotlib æ˜¯ä¸€ä¸ªç»¼åˆæ€§çš„åº“ã€‚å®ƒæ˜¯ Python çš„å¯è§†åŒ–å·¥å…·ï¼Œå¯åˆ›å»ºé™æ€ã€å¸¦åŠ¨ç”»å’Œå¯äº¤äº’çš„å›¾è¡¨<br>Matplotlib å®˜ç½‘ <a href="https://matplotlib.org/">https://matplotlib.org/</a><br>å®˜æ–¹ä½¿ç”¨æ‰‹å†Œ <a href="https://matplotlib.org/stable/users/index.html">https://matplotlib.org/stable/users/index.html</a></p></blockquote><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å®˜æ–¹ç»™å‡ºçš„å®‰è£…æ–¹æ³•æ˜¯ä½¿ç”¨pip<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -m pip install -U pip<br>python -m pip install -U matplotlib<br></code></pre></td></tr></table></figure></p><p>æˆ‘ä»¬ä½¿ç”¨PyCharmï¼Œä¹Ÿå¯ä»¥å…ˆæ‰“<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br></code></pre></td></tr></table></figure><br>å…¶ä¸­<code>matplotlib</code>ä¸‹é¢æœ‰çº¢çº¿ï¼Œè·Ÿç€PyCharmçš„æç¤ºï¼ŒæŠŠç¼ºå¤±çš„åŒ…è£…ä¸Šå°±å¥½ã€‚</p><h2 id="ç®€å•ä¾‹å­-ç»˜åˆ¶æŠ˜çº¿å›¾"><a href="#ç®€å•ä¾‹å­-ç»˜åˆ¶æŠ˜çº¿å›¾" class="headerlink" title="ç®€å•ä¾‹å­-ç»˜åˆ¶æŠ˜çº¿å›¾"></a>ç®€å•ä¾‹å­-ç»˜åˆ¶æŠ˜çº¿å›¾</h2><p>æ¥ä¸‹æ¥ä½¿ç”¨<code>matplotlib</code>ç»˜åˆ¶ä¸€ä¸ªç®€å•çš„æŠ˜çº¿å›¾ï¼Œå…ˆæŠŠè¿™ä¸ªåº“ç”¨èµ·æ¥ã€‚</p><h3 id="å‡†å¤‡æ•°æ®"><a href="#å‡†å¤‡æ•°æ®" class="headerlink" title="å‡†å¤‡æ•°æ®"></a>å‡†å¤‡æ•°æ®</h3><p>æˆ‘ä»¬ç”¨<code>math.sin</code>æ¥æ¨¡æ‹Ÿã€‚xä»0åˆ°100ï¼Œy=sin(x)ã€‚ä¸€ä¸ªç®€å•çš„sinå‡½æ•°ã€‚</p><h3 id="ç»˜åˆ¶"><a href="#ç»˜åˆ¶" class="headerlink" title="ç»˜åˆ¶"></a>ç»˜åˆ¶</h3><p>å‡†å¤‡æ•°æ®ï¼Œç„¶åç»˜åˆ¶å‡ºå›¾è¡¨ã€‚å®Œæ•´ä»£ç å¦‚ä¸‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">demo1</span>():<br>    x_list = []<br>    y_list = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>):<br>        x_list.append(i)<br>        y_list.append(math.sin(i * <span class="hljs-number">0.1</span>))<br>    plt.plot(x_list, y_list)<br>    plt.show()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;rustfisher ç»˜åˆ¶æŠ˜çº¿å›¾äº‹ä¾‹1&#x27;</span>)<br>    demo1()<br></code></pre></td></tr></table></figure></p><p>Macçš„PyCharmè¿è¡Œä¸‹èƒ½å¾—åˆ°è¿™æ ·çš„å›¾<br><img src="intro1.png" alt=""></p><p>ä»£ç ä¸­</p><ul><li><code>plt.plot(x_list, y_list)</code>æŒ‡å®šxï¼Œyå€¼ï¼Œéƒ½æ˜¯åˆ—è¡¨ã€‚è¿™2ä¸ªåˆ—è¡¨çš„é•¿åº¦è¦ç›¸ç­‰ã€‚</li><li><code>plt.show()</code>æ˜¯ç›´æ¥ç»˜åˆ¶å›¾è¡¨ã€‚</li></ul><p>å¯ä»¥çœ‹åˆ°å›¾ä¸­ç¼ºå°‘å¾ˆå¤šå…ƒç´ ã€‚å›¾çš„æ ‡é¢˜æ²¡æœ‰æŒ‡å®šï¼Œxè½´å’Œyè½´éƒ½æ²¡æœ‰è¯´æ˜ã€‚</p><h3 id="å¢åŠ ä¸€äº›ç»†èŠ‚"><a href="#å¢åŠ ä¸€äº›ç»†èŠ‚" class="headerlink" title="å¢åŠ ä¸€äº›ç»†èŠ‚"></a>å¢åŠ ä¸€äº›ç»†èŠ‚</h3><p>ä¸ºæ“ä½œå›¾è¡¨ï¼Œæˆ‘ä»¬éœ€æ‹¿åˆ°å›¾è¡¨å¯¹è±¡<code>ax = plt.gca()</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">ax = plt.gca()<br>ax.set_title(<span class="hljs-string">&#x27;rustfisher.com mapplotlib example&#x27;</span>)<br>ax.set_xlabel(<span class="hljs-string">&#x27;x&#x27;</span>)<br>ax.set_ylabel(<span class="hljs-string">&#x27;y = sin(x)&#x27;</span>)<br>ax.grid()<br></code></pre></td></tr></table></figure></p><ul><li><code>set_title</code> è®¾ç½®å›¾è¡¨æ ‡é¢˜</li><li><code>set_xlabel</code> è®¾ç½®xè½´åç§°</li><li><code>set_ylabel</code> è®¾ç½®yè½´åç§°</li><li><code>grid()</code> æ˜¾ç¤ºæ ¼å­</li></ul><p>ä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">demo1</span>():<br>    x_list = []<br>    y_list = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">100</span>):<br>        x_list.append(i)<br>        y_list.append(math.sin(i * <span class="hljs-number">0.1</span>))<br>    ax = plt.gca()<br>    ax.set_title(<span class="hljs-string">&#x27;rustfisher.com mapplotlib example&#x27;</span>)<br>    ax.set_xlabel(<span class="hljs-string">&#x27;x&#x27;</span>)<br>    ax.set_ylabel(<span class="hljs-string">&#x27;y = sin(x)&#x27;</span>)<br>    ax.grid()<br>    plt.plot(x_list, y_list)<br>    plt.show()<br></code></pre></td></tr></table></figure></p><p>è¿è¡Œç»“æœ<br><img src="2.png" alt=""></p><h3 id="æ“ä½œè¯´æ˜"><a href="#æ“ä½œè¯´æ˜" class="headerlink" title="æ“ä½œè¯´æ˜"></a>æ“ä½œè¯´æ˜</h3><p>ä»å‰é¢å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹é¢æœ‰ä¸€æ’æŒ‰é’®ã€‚è¿™äº›æŒ‰é’®æä¾›äº†ä¸€äº›æ“ä½œå›¾è¡¨çš„åŠŸèƒ½ã€‚<br>ä»å·¦åˆ°å³æˆ‘ä»¬æ’ä¸ªåº1ï¼Œ2ï¼Œ3ï¼Œ4..</p><p><img src="btns.png" alt=""></p><ol><li>è®©å›¾è¡¨æ¢å¤åˆ°åˆå§‹çŠ¶æ€</li><li>ä¸Šä¸€ä¸ªå›¾è¡¨çŠ¶æ€</li><li>ä¸‹ä¸€ä¸ªå›¾è¡¨çŠ¶æ€</li><li>ç§»åŠ¨å›¾è¡¨</li><li>ç¼©æ”¾å›¾è¡¨</li><li>è°ƒæ•´å›¾è¡¨æ˜¾ç¤ºçš„ä½ç½®<ol><li>ç‚¹å‡»ç¼©æ”¾æŒ‰é’®åï¼Œé¼ æ ‡æŒ‰ä½å·¦é”®å»æ¡†é€‰ä¸€ä¸ªåŒºåŸŸï¼Œæ¾å¼€å·¦é”®åå°±æ˜¯æ”¾å¤§é‚£ä¸ªåŒºåŸŸã€‚</li><li>æŒ‰ä½å³é”®å†æ¡†é€‰ï¼Œåˆ™æ˜¯ç¼©å°æ˜¾ç¤ºåŒºåŸŸã€‚</li></ol></li><li>ä¿å­˜å›¾ç‰‡</li></ol><h3 id="ç›´æ¥ä¿å­˜"><a href="#ç›´æ¥ä¿å­˜" class="headerlink" title="ç›´æ¥ä¿å­˜"></a>ç›´æ¥ä¿å­˜</h3><p>å¦‚æœæˆ‘ä»¬æƒ³ç›´æ¥ä¿å­˜å¾—åˆ°çš„å›¾ç‰‡ï¼Œå¯ä»¥ä¸è°ƒç”¨<code>show</code>æ–¹æ³•ã€‚è€Œæ˜¯è°ƒç”¨<code>savefig()</code>æ–¹æ³•ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># plt.show()</span><br>plt.savefig(<span class="hljs-string">&#x27;out.png&#x27;</span>)<br></code></pre></td></tr></table></figure><p>å‚è€ƒ</p><ul><li>Pythonæ“ä½œExcelæ¥ç»˜åˆ¶å›¾è¡¨ <a href="https://rustfisher.com/2019/11/19/Python/Python-op-excel_openpyxl_bar_column_chart/">https://rustfisher.com/2019/11/19/Python/Python-op-excel_openpyxl_bar_column_chart/</a></li><li>Pythonç»˜åˆ¶æ¼æ–—å›¾ <a href="https://rustfisher.com/2021/06/28/Python/Python-op-draw-funnel-1/">https://rustfisher.com/2021/06/28/Python/Python-op-draw-funnel-1/</a></li><li>Pythonåˆé›† <a href="https://rustfisher.com/categories/Python/">https://rustfisher.com/categories/Python/</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è¿è¥çš„PythonæŒ‡å—</tag>
      
      <tag>Matplotlib</tag>
      
      <tag>plot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NestJS é™æ€æ–‡ä»¶</title>
    <link href="/2021/07/10/NestJS/nestjs-static-file/"/>
    <url>/2021/07/10/NestJS/nestjs-static-file/</url>
    
    <content type="html"><![CDATA[<p>ä¸ºäº†æä¾›é™æ€èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>@nestjs/serve-static</code>åŒ…é‡Œçš„<code>ServeStaticModule</code>ã€‚<br>æœåŠ¡å™¨ä¸Šçš„é™æ€èµ„æºï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯æ–‡ä»¶ï¼Œæ¯”å¦‚å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ã€æ–‡æœ¬æ–‡ä»¶æˆ–è€…äºŒè¿›åˆ¶æ–‡ä»¶ç­‰ç­‰ã€‚</p><p>æˆ–è€…æ˜¯ä¸€äº›å•é¡µé¢åº”ç”¨ç¨‹åº(Single Page Application, SPA)ã€‚ä»æœåŠ¡å™¨ä¸Šè¯·æ±‚å¾—åˆ°ç½‘é¡µï¼Œç„¶åç½‘é¡µå†æ‰§è¡Œè‡ªå·±çš„ä¸šåŠ¡ã€‚</p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…<code>@nestjs/serve-static</code>åŒ…ã€‚<br>åœ¨å·¥ç¨‹è·¯å¾„ä¸‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ npm install --save @nestjs/serve-static<br></code></pre></td></tr></table></figure></p><p>å®‰è£…å®Œæˆåï¼Œå·¥ç¨‹çš„<strong>package.json</strong>é‡Œä¼šå¤šå‡º<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;dependencies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>  <span class="hljs-attr">&quot;@nestjs/serve-static&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;^2.1.4&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>åœ¨root <code>AppModule</code>ä¸­ï¼Œå¼•å…¥<code>ServeStaticModule</code>æ¨¡å—ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> &#123; <span class="hljs-title class_">ServeStaticModule</span> &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;@nestjs/serve-static&#x27;</span>;<br><br><span class="hljs-meta">@Module</span>(&#123;<br>  <span class="hljs-attr">imports</span>: [<br>  <span class="hljs-title class_">ServeStaticModule</span>.<span class="hljs-title function_">forRoot</span>(&#123;<br>    <span class="hljs-attr">rootPath</span>: <span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">&#x27;..&#x27;</span>, <span class="hljs-string">&#x27;rustfisherData&#x27;</span>),<br>    <span class="hljs-attr">exclude</span>: [<span class="hljs-string">&#x27;/api*&#x27;</span>],<br>  &#125;),],<br>&#125;)<br><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppModule</span> &#123; &#125;<br></code></pre></td></tr></table></figure><p><code>imports</code>é‡Œæ·»åŠ äº†<code>ServeStaticModule</code>æ¨¡å—ã€‚éœ€è¦ç”¨åˆ°<code>ServeStaticModule.forRoot</code>æ–¹æ³•ã€‚</p><ul><li><code>rootPath</code> æŒ‡å®šäº†é™æ€æ–‡ä»¶çš„æ ¹ç›®å½•</li><li><code>exclude</code> è¡¨æ˜æ’é™¤åœ¨å¤–çš„æ–‡ä»¶å’Œç›®å½•</li></ul><h3 id="è·¯å¾„è¯´æ˜"><a href="#è·¯å¾„è¯´æ˜" class="headerlink" title="è·¯å¾„è¯´æ˜"></a>è·¯å¾„è¯´æ˜</h3><p>æˆ‘ä»¬å…³å¿ƒçš„æ˜¯ï¼ŒæœåŠ¡å™¨ä¸Šå“ªä¸ªç›®å½•å¯ä»¥è®©å®¢æˆ·ç«¯è®¿é—®ï¼Œå“ªä¸ªç›®å½•æ˜¯ä¸å¼€æ”¾çš„ã€‚</p><p><code>__dirname</code> è·å–åˆ°çš„æ˜¯å½“å‰ç›®å½•çš„è·¯å¾„ã€‚<br>ä½¿ç”¨<code>join()</code>æ–¹æ³•ï¼Œæ‹¼æ¥å‡ºä¸€ä¸ªæ–°çš„è·¯å¾„ã€‚</p><p>å·¥ç¨‹ç¼–è¯‘å‡ºæ¥çš„æ–‡ä»¶æ”¾åœ¨<code>dist</code>ç›®å½•ä¸­ã€‚<code>app.module.js</code>æ–‡ä»¶ä¹Ÿåœ¨é‡Œé¢ã€‚<br>æ­¤æ—¶<code>__dirname</code>è¡¨ç¤ºçš„æ˜¯<code>dist</code>ç›®å½•çš„è·¯å¾„ã€‚<br>é‚£ä¹ˆ<code>join(__dirname, &#39;..&#39;, &#39;rustfisherData&#39;)</code>å¾—åˆ°çš„è·¯å¾„å°±æ˜¯ä¸<code>dist</code>ç›®å½•åŒçº§çš„<code>rustfisherData</code>ã€‚</p><p>å‡è®¾æˆ‘ä»¬æœåŠ¡å™¨ä¸Šè¿è¡Œç›®å½•æ˜¯<code>/home/rustfisher/server/rf-server-nest/dist</code><br>é‚£ä¹ˆé™æ€æ–‡ä»¶å­˜æ”¾çš„ç›®å½•å°±æ˜¯<code>/home/rustfisher/server/rf-server-nest/rustfisherData</code></p><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p><code>ServeStaticModule</code>æä¾›äº†ä¸°å¯Œçš„è‡ªå®šä¹‰æ§åˆ¶ã€‚å¼€å‘è€…å¯ä»¥è‡ªå®šä¹‰å®ƒçš„è¡Œä¸ºã€‚<br>æ¯”å¦‚åƒå‰é¢é‚£æ ·è®¾ç½®é™æ€æ–‡ä»¶æ ¹ç›®å½•<code>rootPath</code>ï¼›è®¾ç½®æ’é™¤çš„è·¯å¾„<code>exclude</code>ã€‚</p><p>GitHubä¸Šæœ‰<a href="https://github.com/nestjs/serve-static/blob/master/lib/interfaces/serve-static-options.interface.ts">è¯¦ç»†é…ç½®</a></p><blockquote><p><strong>æ³¨æ„</strong><br>è®¿é—®ç›®å½•æ—¶ï¼Œé»˜è®¤ä¼šæ‰¾<code>index.html</code>æ–‡ä»¶å‘é€å›å»ã€‚åæ–‡ä¼šæœ‰æ›´å¤šè¯´æ˜ã€‚</p></blockquote><h2 id="å®¢æˆ·ç«¯è®¿é—®"><a href="#å®¢æˆ·ç«¯è®¿é—®" class="headerlink" title="å®¢æˆ·ç«¯è®¿é—®"></a>å®¢æˆ·ç«¯è®¿é—®</h2><p>å‡è®¾æœåŠ¡éƒ¨ç½²å¥½äº†ï¼ˆå¹¶ä¸æ˜¯çœŸå®é¡¹ç›®ï¼‰ï¼Œç½‘å€æ˜¯ <a href="https://rustfisher.com">https://rustfisher.com</a> ã€‚éƒ¨ç½²å¥½æœåŠ¡åï¼Œæˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ã€‚</p><p>æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®urlï¼š <a href="https://rustfisher.com/some/path/to/img/11.jpg">https://rustfisher.com/some/path/to/img/11.jpg</a><br>å¯ä»¥åœ¨ç½‘é¡µä¸Šçœ‹åˆ°å›¾ç‰‡ï¼ˆå¹¶ä¸æ˜¯çœŸå®é¡¹ç›®ï¼‰ã€‚</p><p>å¦‚æœè®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„è·¯å¾„ï¼ˆæ–‡ä»¶ï¼‰ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªé»˜è®¤çš„<code>index.html</code>ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Œåˆ™ä¼šæŠ¥ä¸€ä¸ªENOENTé”™è¯¯ä¿¡æ¯<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle">[Nest] <span class="hljs-number">32378</span>   - <span class="hljs-number">07</span><span class="hljs-regexp">/10/</span><span class="hljs-number">2021</span>, <span class="hljs-number">8</span>:<span class="hljs-number">15</span>:<span class="hljs-number">00</span> PM   [ExceptionsHandler] ENOENT: no such <span class="hljs-keyword">file</span> or directory, <br>stat <span class="hljs-string">&#x27;/home/rustfisher/server/rf-server-nest/rustfisherData/index.html&#x27;</span> +<span class="hljs-number">234539</span>ms<br></code></pre></td></tr></table></figure></p><p>ä¸æƒ³è®©å®ƒæŠ¥è¿™ä¸ªé”™ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å¼„ä¸€ä¸ª<code>index.html</code>æ–‡ä»¶æ”¾åˆ°å¯¹åº”è·¯å¾„ä¸Šã€‚<br>è¿™æ ·åšçš„è¯ï¼Œè®¿é—®ç›®å½•æˆ–è€…ä¸å­˜åœ¨çš„æ–‡ä»¶ä¼šé»˜è®¤è¿”å›<code>index.html</code>æ–‡ä»¶ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æä¾›è®¿é—®é™æ€æ–‡ä»¶çš„åŠŸèƒ½æ¯”è¾ƒå¸¸è§ã€‚å®¢æˆ·ç«¯ä½¿ç”¨ä¸€ä¸ªurlï¼Œå°±èƒ½è®¿é—®æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ã€‚<br>ç°åœ¨å¾ˆå¸¸è§çš„åšæ³•æ˜¯æŠŠæ–‡ä»¶æ”¾åœ¨CDNä¸Šï¼Œå‡è½»æœåŠ¡å™¨çš„ioå‹åŠ›å’Œç½‘ç»œå‹åŠ›ã€‚<br>åœ¨LinuxæœåŠ¡å™¨ä¸Šï¼Œnginxå’ŒåŒç±»çš„æœåŠ¡ä¹Ÿèƒ½è½»æ¾å®ç°ç±»ä¼¼çš„æä¾›é™æ€æ–‡ä»¶çš„åŠŸèƒ½ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>NestJS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NestJS</tag>
      
      <tag>åç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MongoDBå®‰è£…å’Œéƒ¨ç½²</title>
    <link href="/2021/07/09/MongoDB/mongodb-install-deploy/"/>
    <url>/2021/07/09/MongoDB/mongodb-install-deploy/</url>
    
    <content type="html"><![CDATA[<p>MongoDBçš„ç‰ˆæœ¬å¯ä»¥åœ¨å®˜ç½‘ <a href="https://docs.mongodb.com/manual/installation/">https://docs.mongodb.com/manual/installation/</a> ä¸ŠæŸ¥è¯¢ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ç¤¾åŒºç‰ˆã€‚</p><h2 id="mac"><a href="#mac" class="headerlink" title="mac"></a>mac</h2><p>ç›®å‰ç”¨macæ¥å¼€å‘ï¼Œéœ€è¦åœ¨æœ¬åœ°å®‰è£…è¿è¡Œä¸€ä¸ªmongdbï¼Œä¾¿äºæµ‹è¯•è°ƒè¯•ã€‚</p><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>macä¸Šå®‰è£…mongodbã€‚åœ¨ç»ˆç«¯ä¸­ç”¨brewæ¥å®‰è£…é€Ÿåº¦æœ‰ç‚¹å¤ªæ…¢äº†ã€‚</p><p>æˆ‘ä»¬å» <a href="https://www.mongodb.com/try/download/enterprise">https://www.mongodb.com/try/download/enterprise</a> ä¸‹è½½ä¸€ä¸ªmacä½¿ç”¨çš„ç‰ˆæœ¬ã€‚<br>åœ¨ç½‘é¡µå³ä¾§é€‰æ‹©mongodbç‰ˆæœ¬ï¼ˆè¿™é‡Œé€‰çš„æ˜¯4.4.4ï¼‰ï¼ŒPlatformé€‰æ‹©macOSï¼Œå‹ç¼©æ ¼å¼é€‰tgzå³å¯ã€‚<br>ç‚¹å‡»Downloadéœ€è¦å¡«ä¸€äº›èµ„æ–™ã€‚å¡«å¥½åç¡®è®¤Submitå³å¯ã€‚ä¸‹è½½åè§£å‹æ–‡ä»¶ï¼Œå¾—åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs stylus">mongodb-macos-x86_64-enterprise-<span class="hljs-number">4.4</span>.<span class="hljs-number">6</span><br>â”œâ”€â”€ LICENSE-Enterprise<span class="hljs-selector-class">.txt</span><br>â”œâ”€â”€ MPL-<span class="hljs-number">2</span><br>â”œâ”€â”€ README<br>â”œâ”€â”€ THIRD-PARTY-NOTICES<br>â”œâ”€â”€ bin<br>â”‚Â Â  â”œâ”€â”€ install_compass<br>â”‚Â Â  â”œâ”€â”€ mongo<br>â”‚Â Â  â”œâ”€â”€ mongocryptd<br>â”‚Â Â  â”œâ”€â”€ mongod<br>â”‚Â Â  â”œâ”€â”€ mongodecrypt<br>â”‚Â Â  â”œâ”€â”€ mongokerberos<br>â”‚Â Â  â”œâ”€â”€ mongoldap<br>â”‚Â Â  â””â”€â”€ mongos<br>â””â”€â”€ snmp<br>    â”œâ”€â”€ MONGOD-MIB<span class="hljs-selector-class">.txt</span><br>    â”œâ”€â”€ MONGODBINC-MIB<span class="hljs-selector-class">.txt</span><br>    â”œâ”€â”€ README-snmp<span class="hljs-selector-class">.txt</span><br>    â”œâ”€â”€ mongod<span class="hljs-selector-class">.conf</span><span class="hljs-selector-class">.master</span><br>    â””â”€â”€ mongod<span class="hljs-selector-class">.conf</span>.subagent<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†è¿™ä¸ªç›®å½•å¤åˆ¶åˆ°<code>/usr/local/mongo</code>ä¸­ï¼Œéœ€è¦ç”¨åˆ°ç®¡ç†å‘˜æƒé™ã€‚</p><p>ä¿®æ”¹<code>~/.bash_profile</code>ï¼Œæ·»åŠ å¦‚ä¸‹å‘½ä»¤ã€‚å³mongoçš„ç›®å½•æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># mongo db</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:/usr/local/mongo/bin<br></code></pre></td></tr></table></figure></p><p>æ­¤æ—¶å¯ä»¥é‡å¯å‘½ä»¤è¡Œï¼ˆç»ˆç«¯ï¼‰ã€‚</p><p>æ£€æŸ¥ç‰ˆæœ¬<code>mongod --version</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">~ $ mongod --version<br>db version v4.4.4<br>Build Info: &#123;<br>    <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;4.4.4&quot;</span>,<br>    <span class="hljs-string">&quot;gitVersion&quot;</span>: <span class="hljs-string">&quot;8db30a63db1a9d84bdcad0c83369623f708e0397&quot;</span>,<br>    <span class="hljs-string">&quot;modules&quot;</span>: [],<br>    <span class="hljs-string">&quot;allocator&quot;</span>: <span class="hljs-string">&quot;system&quot;</span>,<br>    <span class="hljs-string">&quot;environment&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;distarch&quot;</span>: <span class="hljs-string">&quot;x86_64&quot;</span>,<br>        <span class="hljs-string">&quot;target_arch&quot;</span>: <span class="hljs-string">&quot;x86_64&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br>èƒ½çœ‹åˆ°ç‰ˆæœ¬è¯´æ˜mongodbå®‰è£…å®Œæˆã€‚</p><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><p>Macä¸Šå¯åŠ¨ã€‚æˆ‘ä»¬å¯ä»¥æŒ‡å®šæ•°æ®åº“è·¯å¾„<code>--dbpath</code>å’Œlogä½ç½®<code>--logpath</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo mongod --dbpath /Users/rustfisher/.mongodb/data --logpath /Users/rustfisher/.mongodb/log/mongodb1.<span class="hljs-built_in">log</span><br></code></pre></td></tr></table></figure></p><p>å¦‚æœä¸ç”¨<code>sudo</code>ï¼Œå¯èƒ½ä¼šæŠ¥é”™<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ERROR: child process failed, exited with 14<br></code></pre></td></tr></table></figure></p><p>åå°å¯åŠ¨ï¼Œéœ€è¦åŠ ä¸Š<code>--fork</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo mongod --dbpath /Users/rustfisher/.mongodb/data --logpath /Users/rustfisher/.mongodb/log/mongodb1.<span class="hljs-built_in">log</span> --port 1993 --fork<br>about to fork child process, waiting until server is ready <span class="hljs-keyword">for</span> connections.<br>forked process: 7580<br>child process started successfully, parent exiting<br></code></pre></td></tr></table></figure></p><p>æŸ¥è¯¢mongoè¿›ç¨‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ps aux | grep mong<br>rustfisher        7608   0.0  0.0  4268424    732 s003  S+    7:45ä¸‹åˆ   0:00.00 grep mong<br>root              7580   0.0  0.2  5548488  27868   ??  S     7:44ä¸‹åˆ   0:01.02 mongod --dbpath /Users/rustfisher/.mongodb/data --logpath /Users/rustfisher/.mongodb/log/mongodb1.<span class="hljs-built_in">log</span> --fork<br></code></pre></td></tr></table></figure></p><h2 id="Ubuntu"><a href="#Ubuntu" class="headerlink" title="Ubuntu"></a>Ubuntu</h2><p>æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸€èˆ¬æ˜¯Linuxã€‚æ¥ä¸‹æ¥åœ¨Ubuntuä¸Šå®‰è£…è¿è¡Œmongodbã€‚</p><h3 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>Ubuntuä¸Šå®‰è£…mongodbæ¯”è¾ƒç®€å•ï¼Œç”¨<code>apt-get</code>å‘½ä»¤ã€‚</p><p>å…ˆupadateä¸€æ¬¡<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get update<br></code></pre></td></tr></table></figure></p><p>ç„¶åè£…ä¸Š4.4.4ç‰ˆæœ¬çš„mongodb<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install -y mongodb-org=4.4.4 mongodb-org-server=4.4.4 mongodb-org-shell=4.4.4 mongodb-org-mongos=4.4.4 mongodb-org-tools=4.4.4<br></code></pre></td></tr></table></figure></p><p>ç­‰å®ƒè£…å®Œåï¼Œçœ‹ä¸€ä¸‹ç‰ˆæœ¬å·<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">~$ mongod --version<br>db version v4.4.4<br>Build Info: &#123;<br>    <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;4.4.4&quot;</span>,<br>    <span class="hljs-string">&quot;gitVersion&quot;</span>: <span class="hljs-string">&quot;8db30a63db1a9d84bdcad0c83369623f708e0397&quot;</span>,<br>    <span class="hljs-string">&quot;openSSLVersion&quot;</span>: <span class="hljs-string">&quot;OpenSSL 1.0.2g  1 Mar 2016&quot;</span>,<br>    <span class="hljs-string">&quot;modules&quot;</span>: [],<br>    <span class="hljs-string">&quot;allocator&quot;</span>: <span class="hljs-string">&quot;tcmalloc&quot;</span>,<br>    <span class="hljs-string">&quot;environment&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;distmod&quot;</span>: <span class="hljs-string">&quot;ubuntu1604&quot;</span>,<br>        <span class="hljs-string">&quot;distarch&quot;</span>: <span class="hljs-string">&quot;x86_64&quot;</span>,<br>        <span class="hljs-string">&quot;target_arch&quot;</span>: <span class="hljs-string">&quot;x86_64&quot;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br>å¯ä»¥å‘ç°ï¼Œè¿™é‡Œçš„gitVersionå’Œå‰é¢ç”¨macè£…çš„æ˜¯ä¸€æ ·çš„ã€‚<br>ä¸€äº›å…³äºLinuxçš„æ“ä½œç¬”è®°ï¼Œå¯ä»¥è®¿é—® <a href="https://rustfisher.com/tags/Linux/">https://rustfisher.com/tags/Linux/</a></p><h3 id="è¿è¡Œ"><a href="#è¿è¡Œ" class="headerlink" title="è¿è¡Œ"></a>è¿è¡Œ</h3><p>Ubuntuæ“ä½œmongodbçš„<a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/">å®˜æ–¹æ–‡æ¡£</a></p><p>é»˜è®¤çš„é…ç½®æ–‡ä»¶ä¸º <code>/etc/mongod.conf</code></p><p>æŠŠç«¯å£æ”¹ä¸º1993ï¼ŒæœåŠ¡å™¨å¦‚æœå¯ç”¨äº†é˜²ç«å¢™ï¼Œè®°å¾—å…è®¸1993ç«¯å£<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo ufw allow 1993<br></code></pre></td></tr></table></figure><br>æˆ–è€…åœ¨äº‘æœåŠ¡å™¨æ§åˆ¶å°é‚£é‡Œæ£€æŸ¥ä¸€äº›ï¼Œæ˜¯å¦å¼€æ”¾äº†ç«¯å£</p><p>æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯<code>systemctl</code></p><p>å¯åŠ¨mongodb<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl start mongod<br></code></pre></td></tr></table></figure></p><p>æŸ¥çœ‹çŠ¶æ€<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl status mongod<br></code></pre></td></tr></table></figure></p><p>é‡å¯<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo systemctl restart mongod<br></code></pre></td></tr></table></figure></p><h2 id="MongoDB-Compasss"><a href="#MongoDB-Compasss" class="headerlink" title="MongoDB Compasss"></a>MongoDB Compasss</h2><p>å‰é¢æˆ‘ä»¬å·²ç»å®‰è£…å¥½äº†mongodbï¼Œå¹¶ä¸”è¿è¡Œèµ·æ¥äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ‰¾ä¸€ä¸ªæœ‰å›¾å½¢åŒ–ç•Œé¢çš„è½¯ä»¶æ¥è®¿é—®æ•°æ®åº“ã€‚</p><p>MongoDB Compassèƒ½è®©ç”¨æˆ·æ¸…æ™°åœ°çœ‹åˆ°æ–‡æ¡£ç»“æ„ï¼Œæ‰§è¡ŒæŸ¥è¯¢ï¼Œä¿®æ”¹ç­‰ç­‰æ“ä½œã€‚</p><p>åœ¨è¿™é‡Œå¯ä»¥ä¸‹è½½MongoDB Compasss <a href="https://www.mongodb.com/try/download/compass">https://www.mongodb.com/try/download/compass</a><br>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨macä¸‹çš„1.25.0ç‰ˆæœ¬ã€‚</p><p>è¿æ¥åˆ°æœ¬åœ°çš„æ•°æ®åº“ï¼Œåœ¨Compassä¸­é€‰æ‹©æ–°å»ºè¿æ¥<br><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">mongodb://127.0.0.1:1993/rustfisher-db?readPreference=<span class="hljs-keyword">primary</span><span class="hljs-variable">&amp;appname</span>=MongoDB%20Compass<span class="hljs-variable">&amp;ssl</span>=false<br></code></pre></td></tr></table></figure><br>å‰é¢æˆ‘ä»¬å¯åŠ¨mongodbæ˜¯åœ¨1993ç«¯å£ï¼Œè¿æ¥çš„æ—¶å€™è¦æ³¨æ„ç«¯å£å·ã€‚</p><p><code>127.0.0.1</code>æ˜¯æˆ‘ä»¬æœ¬åœ°çš„ipï¼Œå¦‚æœè¦è¿æ¥åˆ°æœåŠ¡å™¨çš„mongodbï¼Œä¸€èˆ¬å¯ä»¥ç›´æ¥ç”¨æœåŠ¡å™¨ipæ¥è¿æ¥ã€‚</p><p>ä¾‹å¦‚æœåŠ¡å™¨å…¬ç½‘ipæ˜¯<code>1.2.3.4</code>ï¼Œç«¯å£æ˜¯<code>1993</code><br><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">mongodb://1.2.3.4:1993/rustfisher-db?readPreference=<span class="hljs-keyword">primary</span><span class="hljs-variable">&amp;appname</span>=MongoDB%20Compass<span class="hljs-variable">&amp;ssl</span>=false<br></code></pre></td></tr></table></figure></p><p>è¿ä¸Šmongodbåï¼Œå°±å¯ä»¥è‡ªç”±åœ°è¿›è¡Œæ“ä½œäº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>MongoDB</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MongoDB</tag>
      
      <tag>æ•°æ®åº“</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€è¿è¥çš„PythonæŒ‡å—ã€‘ç»˜åˆ¶æ¼æ–—å›¾</title>
    <link href="/2021/06/28/Python/Python-op-draw-funnel-1/"/>
    <url>/2021/06/28/Python/Python-op-draw-funnel-1/</url>
    
    <content type="html"><![CDATA[<p>å†™ç»™è¿è¥æœ‹å‹çš„PythonæŒ‡å—ã€‚</p><p>æ¼æ–—å›¾å¯å¯¹ä¸šåŠ¡çš„å„ä¸ªå…³é”®ç¯èŠ‚è¿›è¡Œæè¿°ï¼Œè¡¡é‡å„ä¸ªç¯èŠ‚çš„ä¸šåŠ¡è¡¨ç°ã€‚å¯ä»¥éå¸¸ç›´è§‚åœ°çœ‹åˆ°å„ä¸ªä¸šåŠ¡åœ°è½¬åŒ–ç¨‹åº¦ã€‚</p><p>æœ¬æ–‡ä»‹ç»ä½¿ç”¨Pythonä»Excelä¸­è¯»å–æ•°æ®ï¼Œä½¿ç”¨pyechartsç»˜åˆ¶æ¼æ–—å›¾ã€‚</p><h2 id="æ“ä½œæ­¥éª¤è¯´æ˜"><a href="#æ“ä½œæ­¥éª¤è¯´æ˜" class="headerlink" title="æ“ä½œæ­¥éª¤è¯´æ˜"></a>æ“ä½œæ­¥éª¤è¯´æ˜</h2><p>ä¸‹é¢æ˜¯æ“ä½œçš„å…·ä½“æ­¥éª¤ã€‚</p><h3 id="1-å¼€å‘ç¯å¢ƒ"><a href="#1-å¼€å‘ç¯å¢ƒ" class="headerlink" title="1.å¼€å‘ç¯å¢ƒ"></a>1.å¼€å‘ç¯å¢ƒ</h3><p>ç¤ºä¾‹ä½¿ç”¨çš„IDEæ˜¯PyCharmç¤¾åŒºç‰ˆï¼Œå¼€å‘è¯­è¨€æ˜¯Python3.xã€‚</p><p>åœ¨å·¥ç¨‹ä¸­ï¼Œæ–°å»ºPythonæ–‡ä»¶<code>demo_data_funnel.py</code>ã€‚ç„¶ååœ¨åŒçº§çš„ä½ç½®æ–°å»ºä¸€ä¸ª<code>res</code>æ–‡ä»¶å¤¹ï¼Œåé¢ç”¨æ¥å­˜æ”¾æ–‡ä»¶ã€‚</p><h3 id="2-å‡†å¤‡æ•°æ®"><a href="#2-å‡†å¤‡æ•°æ®" class="headerlink" title="2.å‡†å¤‡æ•°æ®"></a>2.å‡†å¤‡æ•°æ®</h3><p>åˆ›å»ºä¸€ä¸ªExcelæ–‡ä»¶<code>äº‹ä»¶demo.xlsx</code>ã€‚å°†è¡¨åæ”¹ä¸º<code>data3</code>ã€‚è¿™ä¸ªåå­—åœ¨ä»£ç ä¸­ä¼šç”¨åˆ°ã€‚</p><p>å†™å…¥ä¸¤åˆ—æ•°æ®<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">äº‹ä»¶</span><span class="hljs-string">æ¬¡æ•°</span><br><span class="hljs-string">e1</span><span class="hljs-number">10000</span><br><span class="hljs-string">e2</span><span class="hljs-number">4695</span><br><span class="hljs-string">e3</span><span class="hljs-number">2584</span><br><span class="hljs-string">e4</span><span class="hljs-number">1295</span><br><span class="hljs-string">e5</span><span class="hljs-number">954</span><br></code></pre></td></tr></table></figure><br>å¾—åˆ°å¦‚ä¸‹çš„è¡¨æ ¼ï¼š<br><img src="excel.png" alt=""></p><p>ä¸<code>demo_data_funnel.py</code>åŒçº§çš„åœ°æ–¹æ–°å»ºäº†<code>res</code>æ–‡ä»¶å¤¹ï¼ŒæŠŠExcelæ–‡ä»¶æ”¾è¿›å»ã€‚</p><p><img src="proj.png" alt="Excelæ–‡ä»¶æ”¾çš„ä½ç½®ç¤ºæ„å›¾"></p><blockquote><p>è¿™é‡Œæˆ‘ä»¬æš‚æ—¶ç”¨æµ‹è¯•æ•°æ®çœ‹æ•ˆæœã€‚åé¢å†å¡«å…¥ä½ çš„çœŸå®æ•°æ®ã€‚</p></blockquote><h3 id="3-ç¼–å†™è„šæœ¬"><a href="#3-ç¼–å†™è„šæœ¬" class="headerlink" title="3.ç¼–å†™è„šæœ¬"></a>3.ç¼–å†™è„šæœ¬</h3><p>ç°åœ¨å¼€å§‹å†™Pythonä»£ç ã€‚<br><code>demo_data_funnel.py</code>å®Œæ•´çš„ä»£ç å¦‚ä¸‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> openpyxl <span class="hljs-keyword">import</span> load_workbook<br><span class="hljs-keyword">from</span> pyecharts.charts <span class="hljs-keyword">import</span> Funnel<br><span class="hljs-keyword">import</span> pyecharts.options <span class="hljs-keyword">as</span> opts<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_in_data</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;è·å–åŸå§‹æ•°æ® &gt;&gt;&gt;&#x27;</span>)<br>    wb = load_workbook(file_path)<br>    st = wb[<span class="hljs-string">&#x27;data3&#x27;</span>]<br>    data_list = []<br>    <span class="hljs-keyword">for</span> row_index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, st.max_row + <span class="hljs-number">1</span>):<br>        event_name = st.cell(row=row_index, column=<span class="hljs-number">1</span>).value<br>        event_value = st.cell(row=row_index, column=<span class="hljs-number">2</span>).value<br>        data_list.append([event_name, event_value])<br>    <span class="hljs-built_in">print</span>(data_list)<br>    <span class="hljs-keyword">return</span> data_list<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_funnel_default</span>(<span class="hljs-params">input_data</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç»˜åˆ¶æ¼æ–—å›¾ &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base&#x27;</span>)<br>    (<br>        Funnel(init_opts=opts.InitOpts(width=<span class="hljs-string">&quot;800px&quot;</span>, height=<span class="hljs-string">&quot;400px&quot;</span>))<br>            .add(series_name=<span class="hljs-string">&#x27;æ¼æ–—1&#x27;</span>, data_pair=input_data, )<br>            .set_global_opts(title_opts=opts.TitleOpts(title=<span class="hljs-string">&quot;æ¼æ–—å›¾1&quot;</span>, subtitle=<span class="hljs-string">&quot;é»˜è®¤æ ·å¼&quot;</span>))<br>            .render(<span class="hljs-string">&quot;funnel_chart_1.html&quot;</span>)<br>    )<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_funnel_2</span>(<span class="hljs-params">input_data</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç»˜åˆ¶æ¼æ–—å›¾1 &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base&#x27;</span>)<br>    (<br>        Funnel(init_opts=opts.InitOpts(width=<span class="hljs-string">&quot;1000px&quot;</span>, height=<span class="hljs-string">&quot;600px&quot;</span>))<br>            .add(series_name=<span class="hljs-string">&#x27;æ¼æ–—1&#x27;</span>, data_pair=input_data,<br>                 label_opts=opts.LabelOpts(position=<span class="hljs-string">&quot;inside&quot;</span>, formatter=<span class="hljs-string">&#x27;&#123;b&#125; æ•°é‡: &#123;c&#125;&#x27;</span>),<br>                 gap=<span class="hljs-number">2</span>,<br>                 tooltip_opts=opts.TooltipOpts(trigger=<span class="hljs-string">&quot;item&quot;</span>, formatter=<span class="hljs-string">&quot;&#123;a&#125; &lt;br/&gt;&#123;b&#125; æ•°é‡: &#123;c&#125;&quot;</span>),<br>                 )<br>            .set_global_opts(title_opts=opts.TitleOpts(title=<span class="hljs-string">&quot;æ¼æ–—å›¾1&quot;</span>, subtitle=<span class="hljs-string">&quot;æ”¹å˜äº†label&quot;</span>))<br>            .render(<span class="hljs-string">&quot;funnel_chart_2.html&quot;</span>)<br>    )<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_funnel_3</span>(<span class="hljs-params">input_data</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç»˜åˆ¶æ¼æ–—å›¾2 &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base&#x27;</span>)<br>    data = input_data.copy()  <span class="hljs-comment"># å¤åˆ¶ä¸€ä»½å‡ºæ¥å¤„ç†æ ‡é¢˜</span><br>    base_value = data[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(data)):<br>        event_name = data[x][<span class="hljs-number">0</span>]<br>        value = data[x][<span class="hljs-number">1</span>]  <span class="hljs-comment"># æ‹¿åˆ°æ•°å€¼</span><br>        ratio = value / base_value<br>        event_name += <span class="hljs-string">&#x27;\næ€»ä½“è½¬åŒ–ç‡: &#123;:.2f&#125;%&#x27;</span>.<span class="hljs-built_in">format</span>(ratio * <span class="hljs-number">100</span>)<br>        <span class="hljs-keyword">if</span> x &gt; <span class="hljs-number">0</span>:<br>            event_name += <span class="hljs-string">&#x27;\nç›¸å¯¹è½¬åŒ–ç‡: &#123;:.2f&#125;%&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">100</span> * value / data[x - <span class="hljs-number">1</span>][<span class="hljs-number">1</span>])<br>        data[x][<span class="hljs-number">0</span>] = event_name<br>        <span class="hljs-built_in">print</span>(event_name)<br><br>    (<br>        Funnel(init_opts=opts.InitOpts(width=<span class="hljs-string">&quot;1000px&quot;</span>, height=<span class="hljs-string">&quot;800px&quot;</span>))<br>            .add(series_name=<span class="hljs-string">&#x27;æ¼æ–—1&#x27;</span>, data_pair=data,<br>                 label_opts=opts.LabelOpts(position=<span class="hljs-string">&quot;inside&quot;</span>, formatter=<span class="hljs-string">&#x27;&#123;b&#125;\næ•°é‡: &#123;c&#125;&#x27;</span>),<br>                 gap=<span class="hljs-number">2</span>,<br>                 tooltip_opts=opts.TooltipOpts(trigger=<span class="hljs-string">&quot;item&quot;</span>, formatter=<span class="hljs-string">&quot;&#123;a&#125; &lt;br/&gt;&#123;b&#125; æ•°é‡: &#123;c&#125;&quot;</span>),<br>                 )<br>            .set_global_opts(title_opts=opts.TitleOpts(title=<span class="hljs-string">&quot;æ¼æ–—å›¾1&quot;</span>, subtitle=<span class="hljs-string">&quot;ä¿®æ”¹äº†å„é¡¹çš„æ ‡é¢˜&quot;</span>))<br>            .render(<span class="hljs-string">&quot;funnel_chart_3.html&quot;</span>)<br>    )<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    src_data = read_in_data(<span class="hljs-string">&#x27;res/äº‹ä»¶demo.xlsx&#x27;</span>)<br>    draw_funnel_default(src_data)<br>    draw_funnel_2(src_data)<br>    draw_funnel_3(src_data)<br></code></pre></td></tr></table></figure><br>æŠŠä¸Šé¢çš„ä»£ç å¤åˆ¶è¿›ä½ çš„è„šæœ¬é‡Œã€‚<br>å¯èƒ½ä¼šéœ€è¦è£…ä¸Š<code>pyecharts</code>å’Œ<code>openpyxl</code>ã€‚ç”¨PyCharmçš„æ—¶å€™ï¼Œå¯ä»¥ç‚¹åˆ°æŠ¥çº¢çº¿çš„åœ°æ–¹ï¼Œæ ¹æ®å®ƒçš„æç¤ºï¼ŒæŠŠè¿™2ä¸ªåº“è£…ä¸Šã€‚</p><p>è¿è¡Œä»£ç ï¼Œä¼šå¾—åˆ°3ä¸ªhtmlæ–‡ä»¶</p><p><img src="proj-html.png" alt="è¾“å‡ºçš„htmlæ–‡ä»¶"></p><p>ç”¨æµè§ˆå™¨æ‰“å¼€è¿™3ä¸ªhtmlå°±å¯ä»¥çœ‹åˆ°æ•ˆæœäº†ã€‚</p><p>æŠŠä½ çš„æ•°æ®å¡«åˆ°é‚£ä¸ªExcelé‡Œï¼Œä¿å­˜ã€‚ç„¶åè¿è¡Œä»£ç å³å¯ã€‚</p><p>æ¯”å¦‚è¯´æŠŠExcelé‡Œçš„äº‹ä»¶æ”¹ä¸€ä¸‹</p><p><img src="excel-data2.png" alt="ä¿®æ”¹åçš„æ•°æ®"></p><p>è¿è¡Œä»£ç ï¼Œå¯ä»¥å¾—åˆ°æ–°çš„ç»“æœ</p><p><img src="demo2-f1.png" alt=""></p><p>ä»¥ä¸Šæ˜¯ç®€åŒ–æµç¨‹ï¼Œè¿è¥æœ‹å‹ç…§ç€åšï¼Œä¸€èˆ¬éƒ½å¯ä»¥çœ‹åˆ°è¿è¡Œç»“æœã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€äº›ç»†èŠ‚ã€‚</p><h2 id="è¯»å–æ•°æ®"><a href="#è¯»å–æ•°æ®" class="headerlink" title="è¯»å–æ•°æ®"></a>è¯»å–æ•°æ®</h2><p>æˆ‘ä»¬å…ˆå‡†å¤‡ä¸€äº›æµ‹è¯•æ•°æ®ã€‚æ–°å»ºä¸€ä¸ªxlsxæ–‡ä»¶ï¼Œå¡«å…¥æµ‹è¯•æ•°æ®ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="excel.png" alt=""></p><p>æˆ‘ä»¬æŠŠæ•°æ®æ”¾åœ¨äº†<code>data3</code>é‡Œã€‚Aåˆ—æ˜¯äº‹ä»¶åç§°ï¼ŒBåˆ—æ˜¯æ¬¡æ•°ã€‚åç§°è¿™é‡Œå¯ä»¥éšæ„æ›¿æ¢ï¼Œå¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿›è¡Œä¿®æ”¹ã€‚<br>äº‹ä»¶æµç¨‹æŒ‰ç…§å…ˆåé¡ºåºï¼Œä»ä¸Šåˆ°ä¸‹æ’åˆ—å¥½ã€‚</p><p>é¦–å…ˆéœ€è¦æŠŠæ•°æ®ä»excelä¸­è¯»å–å‡ºæ¥ã€‚æˆ‘ä»¬ç”¨openpyxlæ¥æ“ä½œã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> openpyxl <span class="hljs-keyword">import</span> load_workbook<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_in_data</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;è·å–åŸå§‹æ•°æ® &gt;&gt;&gt;&#x27;</span>)<br>    wb = load_workbook(file_path)<br>    st = wb[<span class="hljs-string">&#x27;data3&#x27;</span>]<br>    data_list = []<br>    <span class="hljs-keyword">for</span> row_index <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>, st.max_row + <span class="hljs-number">1</span>):<br>        event_name = st.cell(row=row_index, column=<span class="hljs-number">1</span>).value<br>        event_value = st.cell(row=row_index, column=<span class="hljs-number">2</span>).value<br>        data_list.append([event_name, event_value])<br>    <span class="hljs-built_in">print</span>(data_list)<br>    <span class="hljs-keyword">return</span> data_list<br></code></pre></td></tr></table></figure><br>å°†äº‹ä»¶åå’Œæ•°æ®è£…åˆ°ä¸€ä¸ªå°çš„åˆ—è¡¨é‡Œ<code>[event_name, event_value]</code>ã€‚<br>æ‰€æœ‰çš„äº‹ä»¶æ”¾è¿›ä¸€ä¸ªå¤§çš„åˆ—è¡¨ï¼Œå¹¶è¿”å›ã€‚</p><p>å½“ç„¶ï¼Œä»åˆ«çš„é€”å¾„æ‹¿åˆ°æ•°æ®ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><h2 id="ç»˜åˆ¶æ¼æ–—å›¾"><a href="#ç»˜åˆ¶æ¼æ–—å›¾" class="headerlink" title="ç»˜åˆ¶æ¼æ–—å›¾"></a>ç»˜åˆ¶æ¼æ–—å›¾</h2><p>æˆ‘ä»¬ç”¨<a href="https://pyecharts.org/">pyecharts</a>æ¥ç»˜åˆ¶æ¼æ–—å›¾ã€‚</p><blockquote><p><a href="https://github.com/ecomfe/echarts">Echarts</a> æ˜¯ä¸€ä¸ªç”±ç™¾åº¦å¼€æºçš„æ•°æ®å¯è§†åŒ–ï¼Œå‡­å€Ÿç€è‰¯å¥½çš„äº¤äº’æ€§ï¼Œç²¾å·§çš„å›¾è¡¨è®¾è®¡ï¼Œå¾—åˆ°äº†ä¼—å¤šå¼€å‘è€…çš„è®¤å¯ã€‚è€Œ Python æ˜¯ä¸€é—¨å¯Œæœ‰è¡¨è¾¾åŠ›çš„è¯­è¨€ï¼Œå¾ˆé€‚åˆç”¨äºæ•°æ®å¤„ç†ã€‚å½“æ•°æ®åˆ†æé‡ä¸Šæ•°æ®å¯è§†åŒ–æ—¶ï¼Œpyecharts è¯ç”Ÿäº†ã€‚</p></blockquote><p>pyechartsä¼šè¾“å‡ºhtmlæ–‡ä»¶ã€‚</p><h3 id="é»˜è®¤æ ·å¼"><a href="#é»˜è®¤æ ·å¼" class="headerlink" title="é»˜è®¤æ ·å¼"></a>é»˜è®¤æ ·å¼</h3><p>æ‹¿åˆ°æ•°æ®åï¼Œæˆ‘ä»¬æŠŠæ•°æ®ä¼ ç»™<strong>Funnel</strong>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pyecharts.charts <span class="hljs-keyword">import</span> Funnel<br><span class="hljs-keyword">import</span> pyecharts.options <span class="hljs-keyword">as</span> opts<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_funnel_default</span>(<span class="hljs-params">input_data</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç»˜åˆ¶æ¼æ–—å›¾ &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base&#x27;</span>)<br>    (<br>        Funnel(init_opts=opts.InitOpts(width=<span class="hljs-string">&quot;800px&quot;</span>, height=<span class="hljs-string">&quot;400px&quot;</span>))<br>            .add(series_name=<span class="hljs-string">&#x27;æ¼æ–—1&#x27;</span>, data_pair=input_data, )<br>            .set_global_opts(title_opts=opts.TitleOpts(title=<span class="hljs-string">&quot;æ¼æ–—å›¾1&quot;</span>, subtitle=<span class="hljs-string">&quot;é»˜è®¤æ ·å¼&quot;</span>))<br>            .render(<span class="hljs-string">&quot;funnel_chart_1.html&quot;</span>)<br>    )<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    src_data = read_in_data(<span class="hljs-string">&#x27;res/äº‹ä»¶demo.xlsx&#x27;</span>)<br>    draw_funnel_default(src_data)<br></code></pre></td></tr></table></figure><ul><li>åˆå§‹é…ç½®é‡Œè®¾å®šå®½é«˜ <code>InitOpts(width=&quot;800px&quot;, height=&quot;400px&quot;)</code></li><li><code>input_data</code>å°±æ˜¯æˆ‘ä»¬å‰é¢è·å–çš„æ•°æ®åˆ—è¡¨ï¼›å°†å®ƒä¼ ç»™<code>data_pair</code>ï¼Œå³<code>data_pair=input_data</code></li><li>è¾“å‡ºçš„ç½‘é¡µæ–‡ä»¶åä¸º<code>funnel_chart_1.html</code></li><li><code>set_global_opts()</code>æ–¹æ³•è®¾ç½®å…¨å±€é…ç½®<ul><li>æ ‡é¢˜è®¾ç½® <code>title=&quot;æ¼æ–—å›¾1&quot;</code></li><li>å‰¯æ ‡é¢˜è®¾ç½® <code>subtitle=&quot;é»˜è®¤æ ·å¼&quot;</code></li></ul></li></ul><p>è¾“å‡ºçš„htmlæ–‡ä»¶ï¼Œç”¨æµè§ˆå™¨æ‰“å¼€ï¼Œå¦‚å›¾ï¼š</p><p><img src="demo-default.png" alt=""></p><p>é¼ æ ‡æ”¾ä¸Šå»ä¼šæœ‰å°å¼¹æ¡†æç¤ºï¼ˆtooltipï¼‰</p><p><a href="/art/py/op-funnel/funnel_chart_1.html">ğŸ”— é»˜è®¤æ ·å¼ç½‘é¡µçš„é“¾æ¥</a></p><h3 id="ä¿®æ”¹label"><a href="#ä¿®æ”¹label" class="headerlink" title="ä¿®æ”¹label"></a>ä¿®æ”¹label</h3><p>pyechartså¼€æ”¾äº†å¾ˆå¤šé…ç½®ã€‚æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸€ä¸‹æ¯ä¸€é¡¹çš„æ ‡é¢˜ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_funnel_2</span>(<span class="hljs-params">input_data</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç»˜åˆ¶æ¼æ–—å›¾1 &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base&#x27;</span>)<br>    (<br>        Funnel(init_opts=opts.InitOpts(width=<span class="hljs-string">&quot;1000px&quot;</span>, height=<span class="hljs-string">&quot;600px&quot;</span>))<br>            .add(series_name=<span class="hljs-string">&#x27;æ¼æ–—1&#x27;</span>, data_pair=input_data,<br>                 label_opts=opts.LabelOpts(position=<span class="hljs-string">&quot;inside&quot;</span>, formatter=<span class="hljs-string">&#x27;&#123;b&#125; æ•°é‡: &#123;c&#125;&#x27;</span>),<br>                 gap=<span class="hljs-number">2</span>,<br>                 tooltip_opts=opts.TooltipOpts(trigger=<span class="hljs-string">&quot;item&quot;</span>, formatter=<span class="hljs-string">&quot;&#123;a&#125; &lt;br/&gt;&#123;b&#125; æ•°é‡: &#123;c&#125;&quot;</span>),<br>                 )<br>            .set_global_opts(title_opts=opts.TitleOpts(title=<span class="hljs-string">&quot;æ¼æ–—å›¾1&quot;</span>, subtitle=<span class="hljs-string">&quot;æ”¹å˜äº†label&quot;</span>))<br>            .render(<span class="hljs-string">&quot;funnel_chart_2.html&quot;</span>)<br>    )<br></code></pre></td></tr></table></figure></p><h4 id="formatter"><a href="#formatter" class="headerlink" title="formatter"></a>formatter</h4><ul><li><code>&#123;a&#125;</code>æ˜¯<code>series_name</code>ï¼Œåœ¨è¿™é‡Œæ˜¯å›¾è¡¨çš„åå­—</li><li><code>&#123;b&#125;</code>æ˜¯è¿™ä¸€é¡¹çš„æ ‡é¢˜</li><li><code>&#123;c&#125;</code>æ˜¯è¿™ä¸€é¡¹çš„æ•°é‡</li></ul><p><code>tooltip_opts</code>å’Œ<code>label_opts</code>éƒ½ä¼šç”¨åˆ°<code>formatter</code>ã€‚</p><p><img src="f2.png" alt=""></p><p><a href="/art/py/op-funnel/funnel_chart_2.html">ğŸ”—  æµè§ˆç½‘é¡µ</a></p><h3 id="è‡ªå·±è®¡ç®—è½¬åŒ–ç‡"><a href="#è‡ªå·±è®¡ç®—è½¬åŒ–ç‡" class="headerlink" title="è‡ªå·±è®¡ç®—è½¬åŒ–ç‡"></a>è‡ªå·±è®¡ç®—è½¬åŒ–ç‡</h3><p>ä¸ºäº†æ˜¾ç¤ºå‡ºç›¸å¯¹è½¬åŒ–ç‡å’Œæ€»ä½“è½¬åŒ–ç‡ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå·±è®¡ç®—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">draw_funnel_3</span>(<span class="hljs-params">input_data</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç»˜åˆ¶æ¼æ–—å›¾2 &gt;&gt;&gt; https://gallery.pyecharts.org/#/Funnel/funnel_base&#x27;</span>)<br>    data = input_data.copy()  <span class="hljs-comment"># å¤åˆ¶ä¸€ä»½å‡ºæ¥å¤„ç†æ ‡é¢˜</span><br>    base_value = data[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]<br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(data)):<br>        event_name = data[x][<span class="hljs-number">0</span>]<br>        value = data[x][<span class="hljs-number">1</span>]  <span class="hljs-comment"># æ‹¿åˆ°æ•°å€¼</span><br>        ratio = value / base_value<br>        event_name += <span class="hljs-string">&#x27;\næ€»ä½“è½¬åŒ–ç‡: &#123;:.2f&#125;%&#x27;</span>.<span class="hljs-built_in">format</span>(ratio * <span class="hljs-number">100</span>)<br>        <span class="hljs-keyword">if</span> x &gt; <span class="hljs-number">0</span>:<br>            event_name += <span class="hljs-string">&#x27;\nç›¸å¯¹è½¬åŒ–ç‡: &#123;:.2f&#125;%&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">100</span> * value / data[x - <span class="hljs-number">1</span>][<span class="hljs-number">1</span>])<br>        data[x][<span class="hljs-number">0</span>] = event_name<br>        <span class="hljs-built_in">print</span>(event_name)<br><br>    (<br>        Funnel(init_opts=opts.InitOpts(width=<span class="hljs-string">&quot;1000px&quot;</span>, height=<span class="hljs-string">&quot;800px&quot;</span>))<br>            .add(series_name=<span class="hljs-string">&#x27;æ¼æ–—1&#x27;</span>, data_pair=data,<br>                 label_opts=opts.LabelOpts(position=<span class="hljs-string">&quot;inside&quot;</span>, formatter=<span class="hljs-string">&#x27;&#123;b&#125;\næ•°é‡: &#123;c&#125;&#x27;</span>),<br>                 gap=<span class="hljs-number">2</span>,<br>                 tooltip_opts=opts.TooltipOpts(trigger=<span class="hljs-string">&quot;item&quot;</span>, formatter=<span class="hljs-string">&quot;&#123;a&#125; &lt;br/&gt;&#123;b&#125; æ•°é‡: &#123;c&#125;&quot;</span>),<br>                 )<br>            .set_global_opts(title_opts=opts.TitleOpts(title=<span class="hljs-string">&quot;æ¼æ–—å›¾1&quot;</span>, subtitle=<span class="hljs-string">&quot;ä¿®æ”¹äº†å„é¡¹çš„æ ‡é¢˜&quot;</span>))<br>            .render(<span class="hljs-string">&quot;funnel_chart_3.html&quot;</span>)<br>    )<br></code></pre></td></tr></table></figure><p>åœ¨forå¾ªç¯é‡Œè®¡ç®—è½¬åŒ–ç‡ï¼Œå¹¶æŠŠç»“æœå†™åˆ°äº‹ä»¶çš„åç§°é‡Œã€‚</p><p><img src="f3.png" alt=""></p><p><a href="/art/py/op-funnel/funnel_chart_3.html">ğŸ”—  æµè§ˆç½‘é¡µ</a></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è¿è¥çš„PythonæŒ‡å—</tag>
      
      <tag>openpyxl</tag>
      
      <tag>pyecharts</tag>
      
      <tag>Excel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HTTPçŠ¶æ€ç </title>
    <link href="/2021/06/25/Network/http-code/"/>
    <url>/2021/06/25/Network/http-code/</url>
    
    <content type="html"><![CDATA[<p>HTTPçŠ¶æ€ç è¢«åˆ†æˆäº†5å¤§ç±»ã€‚æœ¬æ–‡å¯¹æ¯ä¸€ç±»å¸¸è§çš„çŠ¶æ€ç è¿›è¡Œæ€»ç»“ã€‚</p><p>åˆ—å‡ºçš„æ˜¯<code>HTTP/1.1</code>è§„èŒƒæ¨èä½¿ç”¨çš„åŸå› çŸ­è¯­ã€‚</p><h2 id="100-199-ä¿¡æ¯æ€§çŠ¶æ€ç "><a href="#100-199-ä¿¡æ¯æ€§çŠ¶æ€ç " class="headerlink" title="100~199 ä¿¡æ¯æ€§çŠ¶æ€ç "></a>100~199 ä¿¡æ¯æ€§çŠ¶æ€ç </h2><table><thead><tr><th style="text-align:center">çŠ¶æ€ç </th><th style="text-align:center">åŸå› çŸ­è¯­</th><th style="text-align:left">æè¿°</th><th style="text-align:left">(å›¾æ–‡æ— å…³)</th></tr></thead><tbody><tr><td style="text-align:center">100</td><td style="text-align:center">Continue</td><td style="text-align:left">è¯´æ˜æ”¶åˆ°äº†è¯·æ±‚çš„åˆå§‹éƒ¨åˆ†ï¼Œè¯·å®¢æˆ·ç«¯ç»§ç»­ã€‚</td><td style="text-align:left"><img src="cat-100.png" alt=""></td></tr><tr><td style="text-align:center">101</td><td style="text-align:center">Switching Protocols</td><td style="text-align:left">è¯´æ˜æœåŠ¡å™¨æ­£åœ¨æ ¹æ®å®¢æˆ·ç«¯çš„æŒ‡å®šï¼Œå°†åè®®åˆ‡æ¢æˆUpdateé¦–éƒ¨æ‰€åˆ—çš„åè®®</td><td style="text-align:left">*</td></tr></tbody></table><h2 id="200-299-æˆåŠŸçŠ¶æ€ç "><a href="#200-299-æˆåŠŸçŠ¶æ€ç " class="headerlink" title="200~299 æˆåŠŸçŠ¶æ€ç "></a>200~299 æˆåŠŸçŠ¶æ€ç </h2><table><thead><tr><th style="text-align:center">çŠ¶æ€ç </th><th style="text-align:center">åŸå› çŸ­è¯­</th><th style="text-align:left">æè¿°</th><th style="text-align:left">(å›¾æ–‡æ— å…³)</th></tr></thead><tbody><tr><td style="text-align:center">200</td><td style="text-align:center">OK</td><td style="text-align:left">OK</td><td style="text-align:left"><img src="cat-200.png" alt=""></td></tr><tr><td style="text-align:center">201</td><td style="text-align:center">Created</td><td style="text-align:left"></td><td style="text-align:left">*</td></tr><tr><td style="text-align:center">202</td><td style="text-align:center">Accepted</td><td style="text-align:left"></td><td style="text-align:left">*</td></tr><tr><td style="text-align:center">203</td><td style="text-align:center">Non-Authoritative Information</td><td style="text-align:left"></td><td style="text-align:left">*</td></tr><tr><td style="text-align:center">204</td><td style="text-align:center">No Content</td><td style="text-align:left"></td><td style="text-align:left">*</td></tr><tr><td style="text-align:center">205</td><td style="text-align:center">Reset Content</td><td style="text-align:left"></td><td style="text-align:left">*</td></tr><tr><td style="text-align:center">206</td><td style="text-align:center">Partical Content</td><td style="text-align:left"></td><td style="text-align:left">*</td></tr></tbody></table><h2 id="300-399-é‡å®šå‘çŠ¶æ€ç "><a href="#300-399-é‡å®šå‘çŠ¶æ€ç " class="headerlink" title="300~399 é‡å®šå‘çŠ¶æ€ç "></a>300~399 é‡å®šå‘çŠ¶æ€ç </h2><table><thead><tr><th style="text-align:center">çŠ¶æ€ç </th><th style="text-align:center">åŸå› çŸ­è¯­</th><th style="text-align:left">æè¿°</th><th style="text-align:left">(å›¾æ–‡æ— å…³)</th></tr></thead><tbody><tr><td style="text-align:center">300</td><td style="text-align:center">Multiple Choices</td><td style="text-align:left">å®¢æˆ·ç«¯è¯·æ±‚ä¸€ä¸ªå®é™…æŒ‡å‘å¤šä¸ªèµ„æºçš„URLæ—¶ä¼šè¿”å›è¿™ä¸ªçŠ¶æ€ç ï¼Œæ¯”å¦‚æœåŠ¡å™¨ä¸Šæœ‰æŸä¸ªHTMLæ–‡æ¡£çš„è‹±è¯­å’Œæ³•è¯­ç‰ˆæœ¬ã€‚æœåŠ¡å™¨å¯ä»¥åœ¨locationé¦–éƒ¨åŒ…å«é¦–é€‰URLã€‚</td><td style="text-align:left"></td></tr><tr><td style="text-align:center">301</td><td style="text-align:center">Moved Permanently</td><td style="text-align:left">åœ¨è¯·æ±‚çš„URLå·²è¢«ç§»é™¤æ—¶ä½¿ç”¨ã€‚å“åº”çš„Locationé¦–éƒ¨ä¸­åº”è¯¥åŒ…å«èµ„æºç°åœ¨æ‰€å¤„çš„URLã€‚</td><td style="text-align:left"><img src="man-301.png" alt=""></td></tr><tr><td style="text-align:center">302</td><td style="text-align:center">Found</td><td style="text-align:left">ä¸301ç±»ä¼¼ï¼Œä½†å®¢æˆ·ç«¯åº”è¯¥ä½¿ç”¨Locationé¦–éƒ¨ç»™å‡ºçš„URLæ¥ä¸´æ—¶å®šä½èµ„æºã€‚</td><td style="text-align:left"><img src="man-302.png" alt=""></td></tr><tr><td style="text-align:center">304</td><td style="text-align:center">Not Modified</td><td style="text-align:left">æœ‰æ¡ä»¶çš„é¦–éƒ¨ã€‚å¦‚æœå®¢æˆ·ç«¯å‘èµ·äº†ä¸€ä¸ªæ¡ä»¶GETè¯·æ±‚ï¼Œè€Œæœ€è¿‘èµ„æºæœªè¢«ä¿®æ”¹ï¼Œå°±å¯ä»¥ç”¨è¿™ä¸ªçŠ¶æ€ç æ¥è¯´æ²¡èµ„æºæœªè¢«ä¿®æ”¹ã€‚å¸¦æœ‰è¿™ä¸ªçŠ¶æ€ç çš„å“åº”ä¸åº”è¯¥åŒ…å«å®ä½“çš„ä¸»ä½“éƒ¨åˆ†ã€‚</td><td style="text-align:left">*</td></tr></tbody></table><h2 id="400-499-å®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç "><a href="#400-499-å®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç " class="headerlink" title="400~499 å®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç "></a>400~499 å®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç </h2><table><thead><tr><th style="text-align:center">çŠ¶æ€ç </th><th style="text-align:center">åŸå› çŸ­è¯­</th><th style="text-align:left">æè¿°</th><th style="text-align:left">(å›¾æ–‡æ— å…³)</th></tr></thead><tbody><tr><td style="text-align:center">400</td><td style="text-align:center">Bad Request</td><td style="text-align:left">å‘ŠçŸ¥å®¢æˆ·ç«¯å‘é€äº†ä¸€ä¸ªé”™è¯¯çš„è¯·æ±‚ã€‚</td><td style="text-align:left"><img src="man-400.png" alt=""></td></tr><tr><td style="text-align:center">401</td><td style="text-align:center">Unauthorized</td><td style="text-align:left">æœªè®¤è¯ã€‚</td><td style="text-align:left"><img src="cat-401.png" alt=""></td></tr><tr><td style="text-align:center">403</td><td style="text-align:center">Forbidden</td><td style="text-align:left">è¯·æ±‚è¢«æœåŠ¡å™¨æ‹’ç»ã€‚</td><td style="text-align:left"><img src="cat-403.png" alt="">   <img src="man-403.png" alt=""></td></tr><tr><td style="text-align:center">404</td><td style="text-align:center">Not Found</td><td style="text-align:left">æœåŠ¡å™¨æ— æ³•æ‰¾åˆ°æ‰€è¯·æ±‚çš„URLã€‚</td><td style="text-align:left"><img src="cat-404.png" alt="">   <img src="man-404.png" alt=""></td></tr><tr><td style="text-align:center">405</td><td style="text-align:center">Method Not Allowed</td><td style="text-align:left">å‘èµ·çš„è¯·æ±‚ä¸­å¸¦æœ‰æ‰€è¯·æ±‚çš„URLä¸æ”¯æŒçš„æ–¹æ³•æ—¶ï¼Œä½¿ç”¨æ­¤çŠ¶æ€ç ã€‚åº”è¯¥åœ¨å“åº”ä¸­åŒ…å«Allowé¦–éƒ¨ï¼Œä»¥å‘ŠçŸ¥å®¢æˆ·ç«¯å¯¹æ‰€è¯·æ±‚çš„èµ„æºå¯ä»¥ä½¿ç”¨å“ªäº›æ–¹æ³•ã€‚</td><td style="text-align:left"></td></tr><tr><td style="text-align:center">406</td><td style="text-align:center">Not Acceptable</td><td style="text-align:left">æœåŠ¡å™¨æ²¡æœ‰ä¸å®¢æˆ·ç«¯å¯æ¥å—çš„URLç›¸åŒ¹é…çš„èµ„æºæ—¶ï¼Œä½¿ç”¨æ­¤ä»£ç ã€‚</td><td style="text-align:left"><img src="cat-406.png" alt="">   <img src="man-406.png" alt=""></td></tr><tr><td style="text-align:center">408</td><td style="text-align:center">Request Timeout</td><td style="text-align:left">å¦‚æœå®¢æˆ·ç«¯å®Œæˆè¯·æ±‚æ‰€èŠ±çš„æ—¶é—´å¤ªé•¿ï¼ŒæœåŠ¡å™¨å¯ä»¥å›é€æ­¤çŠ¶æ€ç ï¼Œå¹¶å…³é—­è¿æ¥ã€‚</td><td style="text-align:left"><img src="cat-408.png" alt=""></td></tr><tr><td style="text-align:center">410</td><td style="text-align:center">Gone</td><td style="text-align:left">ä¸404ç±»ä¼¼ï¼Œåªæ˜¯æœåŠ¡å™¨æ›¾ç»æœ‰è¿‡æ­¤èµ„æºã€‚</td><td style="text-align:left"></td></tr><tr><td style="text-align:center">411</td><td style="text-align:center">Length Required</td><td style="text-align:left">æœåŠ¡å™¨è¦æ±‚Content-Lengthé¦–éƒ¨ã€‚</td><td style="text-align:left"></td></tr><tr><td style="text-align:center">412</td><td style="text-align:center">Precondition Failed</td><td style="text-align:left">å®¢æˆ·ç«¯å‘èµ·äº†æ¡ä»¶è¯·æ±‚ï¼Œä¸”å…¶ä¸­ä¸€ä¸ªæ¡ä»¶å¤±è´¥äº†ã€‚</td><td style="text-align:left"></td></tr><tr><td style="text-align:center">415</td><td style="text-align:center">Unsupported Media Type</td><td style="text-align:left">æœåŠ¡å™¨æ— æ³•ç†è§£æˆ–æ— æ³•æ”¯æŒå®¢æˆ·ç«¯æ‰€å‘å®ä½“çš„å†…å®¹ç±»å‹ã€‚</td><td style="text-align:left"></td></tr><tr><td style="text-align:center">416</td><td style="text-align:center">Requested Range Not Satisfiable</td><td style="text-align:left">è¯·æ±‚æŠ¥æ–‡æ‰€è¯·æ±‚çš„æ˜¯æŒ‡å®šèµ„æºçš„æŸä¸ªèŒƒå›´ï¼Œè€Œæ­¤èŒƒå›´æ— æ•ˆæˆ–æ— æ³•æ»¡è¶³ã€‚</td><td style="text-align:left"><img src="cat-416.png" alt=""></td></tr></tbody></table><h2 id="500-599-æœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç "><a href="#500-599-æœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç " class="headerlink" title="500~599 æœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç "></a>500~599 æœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç </h2><table><thead><tr><th style="text-align:center">çŠ¶æ€ç </th><th style="text-align:center">åŸå› çŸ­è¯­</th><th style="text-align:left">æè¿°</th><th style="text-align:left">(å›¾æ–‡æ— å…³)</th></tr></thead><tbody><tr><td style="text-align:center">500</td><td style="text-align:center">Internal Server Error</td><td style="text-align:left">æœåŠ¡å™¨é‡åˆ°ä¸€ä¸ªå¦¨ç¢å®ƒä¸ºè¯·æ±‚æä¾›æœåŠ¡çš„é”™è¯¯</td><td style="text-align:left"><img src="cat-500.png" alt=""></td></tr><tr><td style="text-align:center">501</td><td style="text-align:center">Not Implement</td><td style="text-align:left">å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚è¶…è¿‡æœåŠ¡å™¨èƒ½åŠ›èŒƒå›´</td><td style="text-align:left"></td></tr><tr><td style="text-align:center">503</td><td style="text-align:center">Service Unavailable</td><td style="text-align:left">æœåŠ¡å™¨ç°åœ¨æ— æ³•ä¸ºè¯·æ±‚æä¾›æœåŠ¡ï¼Œä½†å°†æ¥å¯ä»¥</td><td style="text-align:left"></td></tr><tr><td style="text-align:center">504</td><td style="text-align:center">Gateway Timeout</td><td style="text-align:left">ä¸408ç±»ä¼¼ï¼Œåªæ˜¯è¿™é‡Œçš„å“åº”æ¥è‡ªä¸€ä¸ªç½‘å…³æˆ–ä»£ç†</td><td style="text-align:left"></td></tr><tr><td style="text-align:center">505</td><td style="text-align:center">HTTP Version Not Supported</td><td style="text-align:left">æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ä½¿ç”¨äº†å®ƒæ— æ³•æˆ–ä¸æ„¿æ”¯æŒçš„åè®®ç‰ˆæœ¬</td><td style="text-align:left">*</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>HTTP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>http</tag>
      
      <tag>ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>NestJS éƒ¨ç½²ä¸ç»´æŠ¤</title>
    <link href="/2021/06/20/NestJS/nest-devops/"/>
    <url>/2021/06/20/NestJS/nest-devops/</url>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬å¯ä»¥æŠŠnestjsçš„å·¥ç¨‹ä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼Œç„¶åç›´æ¥è¿›è¡Œnpmæ“ä½œã€‚<br>ä¹Ÿå¯ä»¥åœ¨æœ¬åœ°æ‰“åŒ…å‡ºnestjsçš„åŒ…ï¼Œå°†<code>dist</code>ç›®å½•ä¼ åˆ°æœåŠ¡å™¨ä¸Šã€‚</p><p>åœ¨è¿™é‡Œä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘ä»¬æè¿°çš„æ˜¯å°†å·¥ç¨‹ä¼ åˆ°æœåŠ¡å™¨åçš„æ“ä½œã€‚<br>ä¼ å·¥ç¨‹æ–‡ä»¶ï¼Œå¯ä»¥ç”¨github/giteeå½“ä½œä¸­é—´æ¡¥æ¢ï¼Œä¹Ÿå¯ä»¥ç”¨vscodeçš„æ’ä»¶ä¼ è¾“ï¼Œæˆ–è€…ä½¿ç”¨scpå‘½ä»¤ã€‚</p><p>åŒç†ï¼Œ<code>dist</code>ç›®å½•ä¹Ÿå¯ä»¥ä¼ åˆ°github/giteeä¸Šï¼ŒæœåŠ¡å™¨ç›´æ¥ä½¿ç”¨ç¼–è¯‘å¥½çš„æ–‡ä»¶ã€‚</p><h2 id="ç›´æ¥å¯åŠ¨"><a href="#ç›´æ¥å¯åŠ¨" class="headerlink" title="ç›´æ¥å¯åŠ¨"></a>ç›´æ¥å¯åŠ¨</h2><p>å¯åŠ¨å‰ï¼Œè¿›å…¥å·¥ç¨‹ç›®å½•ï¼Œå…ˆå®‰è£…ä¸€æ¬¡ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ npm install<br></code></pre></td></tr></table></figure></p><p>ç”¨<code>npm run</code>å‘½ä»¤å¯åŠ¨æœåŠ¡<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¼€å‘æ¨¡å¼</span><br>$ npm run start<br><br><span class="hljs-comment"># è§‚å¯Ÿæ¨¡å¼</span><br>$ npm run start:dev<br></code></pre></td></tr></table></figure></p><p>åœ¨æœåŠ¡å™¨ä¸Šï¼Œè¿è¡Œæ­£å¼ç¯å¢ƒï¼ˆç”Ÿäº§ç¯å¢ƒ productionï¼‰<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯åŠ¨ç”Ÿäº§ç¯å¢ƒå‰ å…ˆstart</span><br>$ npm run start<br><br><span class="hljs-comment"># ç”Ÿäº§ç¯å¢ƒ</span><br>$ npm run start:prod<br></code></pre></td></tr></table></figure><br>ä½¿ç”¨<code>npm run</code>è¿è¡Œçš„ç¨‹åºï¼Œå¯ä»¥<code>ctrl + c</code>åœæ­¢ã€‚</p><p>runèµ·æ¥åï¼Œç¼–è¯‘åçš„æ–‡ä»¶åœ¨<code>dist</code>ç›®å½•é‡Œã€‚</p><h2 id="ä½¿ç”¨pm2ç®¡ç†"><a href="#ä½¿ç”¨pm2ç®¡ç†" class="headerlink" title="ä½¿ç”¨pm2ç®¡ç†"></a>ä½¿ç”¨pm2ç®¡ç†</h2><p>pm2æ˜¯å¸¸ç”¨çš„nodeè¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå®ƒå¯ä»¥æä¾›node.jsåº”ç”¨ç®¡ç†ï¼Œå¦‚è‡ªåŠ¨é‡è½½ã€æ€§èƒ½ç›‘æ§ã€è´Ÿè½½å‡è¡¡ç­‰ã€‚</p><p>åœ¨æœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬ä½¿ç”¨npmå®‰è£…è¿™ä¸ªå·¥å…·<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install pm2<br></code></pre></td></tr></table></figure></p><p>å®‰è£…å®Œæ¯•åï¼ŒæŸ¥çœ‹ä¸€ä¸‹ç‰ˆæœ¬<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ pm2 -v<br>4.4.1<br></code></pre></td></tr></table></figure></p><h3 id="pm2å¯åŠ¨æœåŠ¡"><a href="#pm2å¯åŠ¨æœåŠ¡" class="headerlink" title="pm2å¯åŠ¨æœåŠ¡"></a>pm2å¯åŠ¨æœåŠ¡</h3><p>æˆ‘ä»¬çŸ¥é“ï¼Œnestjsç¼–è¯‘åçš„æ–‡ä»¶åœ¨<code>dist</code>ç›®å½•é‡Œï¼Œå…¥å£æ–‡ä»¶æ˜¯<code>dist/main.js</code></p><p>ç”¨pm2å¯åŠ¨æœåŠ¡ä¹‹å‰ï¼Œå…ˆæŠŠè¯¥è£…çš„åº“ç”¨npmè£…å¥½ã€‚è¿è¡Œ<code>npm run start:prod</code>ï¼Œç„¶å<code>ctrl + c</code>åœæ­¢ã€‚</p><p>æ¥ä¸‹æ¥ç”¨pm2å¯åŠ¨<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pm2 start dist/main.js --name=<span class="hljs-string">&quot;è¿™é‡Œæ˜¯è‡ªå®šä¹‰çš„åå­—&quot;</span><br></code></pre></td></tr></table></figure></p><h3 id="æŸ¥çœ‹æœåŠ¡"><a href="#æŸ¥çœ‹æœåŠ¡" class="headerlink" title="æŸ¥çœ‹æœåŠ¡"></a>æŸ¥çœ‹æœåŠ¡</h3><p>ä½¿ç”¨å‘½ä»¤<code>pm2 list</code>æŸ¥çœ‹æœåŠ¡</p><p>ä¾‹å¦‚åœ¨æŸä¸ªæœåŠ¡å™¨ä¸Š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ pm2 list <br>â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”<br>â”‚ <span class="hljs-built_in">id</span>  â”‚ name              â”‚ namespace   â”‚ version â”‚ mode    â”‚ pid      â”‚ <span class="hljs-built_in">uptime</span> â”‚ â†º    â”‚ status    â”‚ cpu      â”‚ mem      â”‚ user     â”‚ watching â”‚<br>â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<br>â”‚ 3   â”‚ rustfisher-debug  â”‚ default     â”‚ 1.0.0   â”‚ fork    â”‚ 12260    â”‚ 2M     â”‚ 0    â”‚ online    â”‚ 0%       â”‚ 39.7mb   â”‚ ubuntu   â”‚ disabled â”‚<br>â”‚ 2   â”‚ rustfisher-releaseâ”‚ default     â”‚ 1.0.0   â”‚ fork    â”‚ 12090    â”‚ 2M     â”‚ 46   â”‚ online    â”‚ 0%       â”‚ 44.6mb   â”‚ ubuntu   â”‚ disabled â”‚<br>â”‚ 0   â”‚ index             â”‚ default     â”‚ 1.0.0   â”‚ fork    â”‚ 0        â”‚ 0      â”‚ 68   â”‚ stopped   â”‚ 0%       â”‚ 0b       â”‚ ubuntu   â”‚ disabled â”‚<br>â”‚ 1   â”‚ index             â”‚ default     â”‚ 1.0.0   â”‚ fork    â”‚ 0        â”‚ 0      â”‚ 15   â”‚ stopped   â”‚ 0%       â”‚ 0b       â”‚ ubuntu   â”‚ disabled â”‚<br>â”‚ 4   â”‚ an.rustfisher     â”‚ default     â”‚ 0.0.1   â”‚ fork    â”‚ 32252    â”‚ 74m    â”‚ 0    â”‚ online    â”‚ 0%       â”‚ 51.5mb   â”‚ ubuntu   â”‚ disabled â”‚<br>â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜<br></code></pre></td></tr></table></figure></p><h3 id="åœæ­¢æœåŠ¡"><a href="#åœæ­¢æœåŠ¡" class="headerlink" title="åœæ­¢æœåŠ¡"></a>åœæ­¢æœåŠ¡</h3><p>æƒ³è¦åœæ­¢æŸä¸ªæœåŠ¡ï¼Œä½¿ç”¨<code>pm2 stop</code> + æœåŠ¡åï¼ˆnameï¼‰æˆ–è€…id</p><p>ä¾‹å¦‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pm2 stop rustfisher-debug<br></code></pre></td></tr></table></figure><br>æ‰§è¡Œå®Œæ¯•åï¼Œä¼šè‡ªåŠ¨è¿è¡Œä¸€æ¬¡<code>pm2 list</code></p><h3 id="é‡å¯æœåŠ¡"><a href="#é‡å¯æœåŠ¡" class="headerlink" title="é‡å¯æœåŠ¡"></a>é‡å¯æœåŠ¡</h3><p>ç”¨<code>pm2 restart</code> + æœåŠ¡åï¼ˆnameï¼‰æˆ–è€…id<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pm2 restart rustfisher-debug<br></code></pre></td></tr></table></figure><br>æˆ–è€…<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pm2 restart 3<br></code></pre></td></tr></table></figure></p><h3 id="æ—¥å¿—ç®¡ç†"><a href="#æ—¥å¿—ç®¡ç†" class="headerlink" title="æ—¥å¿—ç®¡ç†"></a>æ—¥å¿—ç®¡ç†</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œpm2çš„æ—¥å¿—å­˜æ”¾åœ¨<code>~/.pm2/log</code>é‡Œã€‚æ¯ä¸ªå¯åŠ¨çš„æœåŠ¡æœ‰å¯¹åº”çš„logæ–‡ä»¶ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨æŸä¸ªæœåŠ¡å™¨ä¸Š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">ls</span> .pm2/logs/<br>app-error.log  dr-debug-error.log  dr-release-error.log  index-error.log   www-error.log<br>app-out.log    dr-debug-out.log    dr-release-out.log    index-out.log     www-out.log<br></code></pre></td></tr></table></figure></p><h2 id="nohupåå°å¯åŠ¨"><a href="#nohupåå°å¯åŠ¨" class="headerlink" title="nohupåå°å¯åŠ¨"></a>nohupåå°å¯åŠ¨</h2><p>æˆ‘ä»¬ä¹Ÿå¯ç”¨nohupåå°å¯åŠ¨ã€‚</p><p>è¿›å…¥å·¥ç¨‹ç›®å½•ï¼Œè¿è¡Œ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">nohup</span> npm run start:prod &gt;&gt; nohup.log &amp;<br></code></pre></td></tr></table></figure></p><p>æŸ¥çœ‹è¿›ç¨‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ps -aux | grep node<br>ubuntu   11826  0.0  1.2 674064 10988 ?        Ssl  Mar16   0:00 /usr/local/bin/node /usr/local/lib/node_modules/npm/node_modules/update-notifier/check.js &#123;<span class="hljs-string">&quot;pkg&quot;</span>:&#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;npm&quot;</span>,<span class="hljs-string">&quot;version&quot;</span>:<span class="hljs-string">&quot;6.14.6&quot;</span>&#125;&#125;<br>ubuntu   16478  0.0  0.0   4512   788 pts/3    S    11:49   0:00 sh -c node dist/main<br>ubuntu   16479  0.4  5.1 578840 45228 pts/3    Sl   11:49   0:00 node dist/main<br>ubuntu   16959  0.0  0.1  13232   928 pts/3    S+   11:52   0:00 grep --color=auto node<br></code></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°æœ‰2ä¸ªç›¸å…³çš„è¿›ç¨‹16478å’Œ16479</p><p>æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µã€‚å‡è®¾æˆ‘ä»¬å·¥ç¨‹ç›‘å¬çš„æ˜¯8090ç«¯å£ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ netstat -anp | grep 8090<br>(Not all processes could be identified, non-owned process info<br> will not be shown, you would have to be root to see it all.)<br>tcp        0      0 127.0.0.1:52788         127.0.0.1:8090          TIME_WAIT   -               <br>tcp6       0      0 :::8090                 :::*                    LISTEN      16479/node      <br></code></pre></td></tr></table></figure></p><p>ç»“åˆä¸€çœ‹ï¼Œè¿›ç¨‹16479æ˜¯æˆ‘ä»¬åå°è¿è¡Œçš„æœåŠ¡æ²¡é”™äº†ã€‚</p><p>åœæ­¢åå°è¿›ç¨‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo <span class="hljs-built_in">kill</span> 16479<br></code></pre></td></tr></table></figure><br>killç„¶åå†æŸ¥è¯¢è¿›ç¨‹å’Œç«¯å£å ç”¨æƒ…å†µï¼Œå°±æ²¡æœ‰ç›¸å…³çš„è¿›ç¨‹äº†ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¯ä»¥ç”¨ä¸åŒçš„æ–¹å¼åå°å¯åŠ¨æœåŠ¡ã€‚<br>å¯åŠ¨ç”Ÿäº§ç¯å¢ƒä¹‹å‰ï¼Œè¦å…ˆåŒæ­¥å¹¶ç¼–è¯‘ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>NestJS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NestJS</tag>
      
      <tag>åç«¯</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Shell forå¾ªç¯è¯­å¥</title>
    <link href="/2021/06/19/Linux/for-use/"/>
    <url>/2021/06/19/Linux/for-use/</url>
    
    <content type="html"><![CDATA[<p>Shellé‡Œçš„forå¾ªç¯è¯­å¥å†™æ³•ã€‚æˆ‘ä»¬åˆ†åˆ«ç”¨å‘½ä»¤è¡Œå’Œshellè„šæœ¬æ¥è¿›è¡Œæ¼”ç¤ºã€‚</p><p>å¸¸è§çš„ä¸€ç§forç»“æ„å¦‚ä¸‹ã€‚foré‡Œé¢è¦è·Ÿç€<code>do</code>å’Œ<code>done</code>å…³é”®å­—ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">for i in &#123;1..3&#125;<br>do<br>    echo YES $i # è¿™é‡Œæ˜¯å¾ªç¯ä½“<br>done<br></code></pre></td></tr></table></figure><h2 id="æ•°å­—èŒƒå›´"><a href="#æ•°å­—èŒƒå›´" class="headerlink" title="æ•°å­—èŒƒå›´"></a>æ•°å­—èŒƒå›´</h2><p>æ•°å­—èŒƒå›´ï¼Œä¾‹å¦‚ä»1åˆ°3ï¼Œä»1åˆ°100ã€‚</p><h3 id="for-in"><a href="#for-in" class="headerlink" title="for in"></a>for in</h3><p>for in çš„å†™æ³•ï¼Œå®šä¹‰<code>i</code>ä¸ºå˜é‡ï¼Œä½¿ç”¨å¤§æ‹¬å·æ¥æŒ‡å®šèŒƒå›´ã€‚èŒƒå›´çš„æ•°å­—ä¹‹é—´æœ‰2ä¸ªç‚¹<code>..</code>ã€‚ä¾‹å¦‚<code>&#123;1..3&#125;</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;1..3&#125;;<span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> now is <span class="hljs-variable">$i</span>; <span class="hljs-keyword">done</span><br>now is 1<br>now is 2<br>now is 3<br></code></pre></td></tr></table></figure><br>ä¸Šé¢æ˜¯å‘½ä»¤è¡Œï¼Œä¸€è¡ŒæŠŠæ‰€æœ‰çš„æŒ‡ä»¤å†™å®Œã€‚ä¹Ÿå¯ä»¥å†åŠ ä¸€è¡Œä»£ç ï¼ŒåŒæ ·ç”¨åˆ†å·<code>;</code>æ¥åˆ†éš”ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> &#123;1..3&#125;;<span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> now is <span class="hljs-variable">$i</span>;<span class="hljs-built_in">echo</span> rustfisher.com; <span class="hljs-keyword">done</span><br>now is 1<br>rustfisher.com<br>now is 2<br>rustfisher.com<br>now is 3<br>rustfisher.com<br></code></pre></td></tr></table></figure></p><p>æˆ–è€…å†™æˆè„šæœ¬ã€‚å…¶å®å°±æ˜¯æ‹†æˆå‡ è¡Œã€‚<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span>  <br><br>for i in &#123;1..3&#125;<br>do<br>    echo now is $i<br>    echo rustfisher.com<br>done<br></code></pre></td></tr></table></figure></p><p>å‰é¢æˆ‘ä»¬ç”¨çš„æ˜¯å¤§æ‹¬å·æ¥æŒ‡å®šå¾ªç¯èŒƒå›´ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨<code>$(seq 1 3)</code>ã€‚<br>å¼€å¤´ä¾æ—§æ˜¯<code>for i in</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 1 3);<span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> now is <span class="hljs-variable">$i</span>;<span class="hljs-built_in">echo</span> rustfisher.com; <span class="hljs-keyword">done</span><br>now is 1<br>rustfisher.com<br>now is 2<br>rustfisher.com<br>now is 3<br>rustfisher.com<br></code></pre></td></tr></table></figure></p><p>å†™æˆè„šæœ¬å¦‚ä¸‹<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span>  <br><br>for i in $(seq 1 3)<br>do <br>    echo now is $i<br>    echo rustfisher.com<br>done<br></code></pre></td></tr></table></figure></p><p>å®é™…ä¸Šæˆ‘ä»¬ä½¿ç”¨äº†<code>seq</code>å‘½ä»¤ã€‚seqåé¢æ¥2ä¸ªæ•°å­—ï¼Œå¯ä»¥è¾“å‡ºè¿™ä¸ªèŒƒå›´å†…çš„æ•°å­—ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-built_in">seq</span> 1 5<br>1<br>2<br>3<br>4<br>5<br>~ $ <span class="hljs-built_in">seq</span> 5 1<br>5<br>4<br>3<br>2<br>1<br></code></pre></td></tr></table></figure></p><h3 id="for-i-1-i-lt-3-i"><a href="#for-i-1-i-lt-3-i" class="headerlink" title="for((i=1;i&lt;=3;i++))"></a>for((i=1;i&lt;=3;i++))</h3><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å†™æˆåƒJava/Cè¯­è¨€é‡Œçš„forå¾ªç¯é‚£æ ·ã€‚ä½†è¦æ³¨æ„è¿™é‡Œçš„foræœ‰2å±‚å°æ‹¬å·ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-keyword">for</span>((i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">3</span>;i++));<span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> -n now is [<span class="hljs-variable">$i</span>] ;<span class="hljs-built_in">echo</span> rustfisher.com; <span class="hljs-keyword">done</span><br>now is [1]rustfisher.com<br>now is [2]rustfisher.com<br>now is [3]rustfisher.com<br></code></pre></td></tr></table></figure></p><p>æ›´æ”¹ä¸€ä¸‹æ­¥è¿›å€¼ï¼Œæ”¹ä¸º<code>i+=2</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span>((i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">3</span>;i+=<span class="hljs-number">2</span>));<span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> -n now is [<span class="hljs-variable">$i</span>] ;<span class="hljs-built_in">echo</span> rustfisher.com; <span class="hljs-keyword">done</span><br>now is [1]rustfisher.com<br>now is [3]rustfisher.com<br></code></pre></td></tr></table></figure></p><p>æˆ–è€…åŠ ä¸Šä¸€äº›å°è¿ç®—ï¼Œç”¨<code>expr</code>åŠ ä¸Šæˆ‘ä»¬æƒ³è¦çš„è¿ç®—ã€‚æ³¨æ„<code>$i</code>ä¸<code>\*</code>å’Œ<code>3</code>ä¹‹é—´è¦æœ‰ç©ºæ ¼ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-keyword">for</span>((i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">3</span>;i+=<span class="hljs-number">2</span>));<span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> -n $(<span class="hljs-built_in">expr</span> <span class="hljs-variable">$i</span> \* 3) <span class="hljs-string">&#x27; &#x27;</span> ;<span class="hljs-built_in">echo</span> rustfisher.com; <span class="hljs-keyword">done</span><br>3  rustfisher.com<br>9  rustfisher.com<br></code></pre></td></tr></table></figure><br>åé¢åŠ çš„ç©ºæ ¼æ˜¯ä¸ºäº†éš”å¼€å¥½çœ‹ä¸€äº›ã€‚</p><p>åœ¨shellè„šæœ¬ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ä¼šå®šä¹‰å˜é‡ã€‚å˜é‡ä¹Ÿå¯ä»¥ä½œä¸ºforå¾ªç¯çš„èŒƒå›´ã€‚<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span>  <br><br>startNum=1<br>endNum=3<br><br>for i in $(seq $startNum $endNum)<br>do<br>    echo current is $i<br>done<br></code></pre></td></tr></table></figure><br>æˆ‘ä»¬å®šä¹‰2ä¸ªå˜é‡<code>startNum</code>ä¸<code>endNum</code>ã€‚è¦ä½¿ç”¨å®ƒä»¬çš„å€¼æ—¶ï¼Œéœ€è¦åŠ ä¸Š<code>$</code>ç¬¦å·ã€‚</p><h2 id="å­—ç¬¦å¾ªç¯"><a href="#å­—ç¬¦å¾ªç¯" class="headerlink" title="å­—ç¬¦å¾ªç¯"></a>å­—ç¬¦å¾ªç¯</h2><p>forå¾ªç¯å¯ä»¥ä¸ä¸€äº›æŒ‡ä»¤ç»“åˆèµ·æ¥ï¼Œè·å–æŒ‡ä»¤ä¸­çš„ç»“æœã€‚</p><h3 id="for-i-in-ls"><a href="#for-i-in-ls" class="headerlink" title="for i in ls"></a>for i in <code>ls</code></h3><p>å…ˆç”¨å‘½ä»¤è¡Œçœ‹ä¸€ä¸ªæ•ˆæœï¼Œforä¸lsç»“åˆä½¿ç”¨<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `<span class="hljs-built_in">ls</span>`; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span> ; <span class="hljs-keyword">done</span><br>for1.sh<br></code></pre></td></tr></table></figure><br>å½“å‰ç›®å½•é‡Œåªæœ‰1ä¸ªæ–‡ä»¶ã€‚</p><p>å¦‚æœæ˜¯<code>ls -a</code>å‘½ä»¤ï¼Œè¾“å‡ºä¼šæ›´å¤šã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `<span class="hljs-built_in">ls</span> -a`; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span> ; <span class="hljs-keyword">done</span><br>.<br>..<br>for1.sh<br></code></pre></td></tr></table></figure></p><p>æ¢ä¸€ä¸ªç›®å½•ï¼Œæˆ‘ä»¬å¯ä»¥è¾“å‡ºæ‰€æœ‰pngæ–‡ä»¶çš„æ–‡ä»¶å<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `<span class="hljs-built_in">ls</span> *.png`; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span> ; <span class="hljs-keyword">done</span><br>android-cover-2.png<br>fish.png<br>ic_book_blue.png<br>ic_tools_gear.png<br>ic_web.png<br>kotlin-android-1.png<br>python-logo.png<br>ts-blue-1.png<br></code></pre></td></tr></table></figure></p><h3 id="for-i-in-ll"><a href="#for-i-in-ll" class="headerlink" title="for i in ll"></a>for i in <code>ll</code></h3><p>æ¢æˆ<code>ll</code>å‘½ä»¤ï¼Œè¾“å‡ºæ›´åŠ ä¸°å¯Œ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `ll`; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span> ; <span class="hljs-keyword">done</span><br>total<br>8<br>-rw-r--r--<br>1<br>rustfisher<br>staff<br>183<br>6<br>19<br>21:25<br>for1.sh<br></code></pre></td></tr></table></figure></p><p>æˆ‘ä»¬çŸ¥é“<code>ll</code>å‘½ä»¤ä¼šè¾“å‡ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ä¿¡æ¯<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ ll<br>total 8<br>-rw-r--r--  1 rustfisher  staff  183  6 19 21:25 for1.sh<br></code></pre></td></tr></table></figure></p><p>ç»“åˆforå¾ªç¯å¯ä»¥çœ‹å‡ºï¼Œforå¾ªç¯æ˜¯è·å–äº†ç©ºæ ¼æˆ–æ¢è¡Œä¸ºé—´éš”çš„å­—ç¬¦ä¸²ã€‚</p><p>æ˜¾ç¤ºå„ä¸ªå­ç›®å½•é‡Œmdæ–‡ä»¶çš„ä¸ªæ•°<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `<span class="hljs-built_in">ls</span>`; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span>; find <span class="hljs-variable">$i</span> -name <span class="hljs-string">&quot;*.md&quot;</span> | <span class="hljs-built_in">wc</span> -l; <span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure></p><h3 id="å­—ç¬¦ä¸²å˜é‡"><a href="#å­—ç¬¦ä¸²å˜é‡" class="headerlink" title="å­—ç¬¦ä¸²å˜é‡"></a>å­—ç¬¦ä¸²å˜é‡</h3><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨è„šæœ¬ä¸­å°è¯•ä¸€äº›ï¼Œforå¾ªç¯é…åˆå­—ç¬¦ä¸²<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span>  <br><br>word=&quot;Welcome      to rustfisher.com&quot;<br>for i in $word<br>do<br>    echo $i<br>done<br></code></pre></td></tr></table></figure></p><p><code>word</code>ä¸­é—´æœ‰å¾ˆå¤šä¸ªç©ºæ ¼ï¼Œä½†è¾“å‡ºçš„ä¾æ—§æ˜¯è¿™3è¡Œã€‚<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vim">Welcome<br><span class="hljs-keyword">to</span><br>rustfisher.<span class="hljs-keyword">com</span><br></code></pre></td></tr></table></figure></p><p>è¿›ä¸€æ­¥æ‰©å±•ï¼Œå®šä¹‰3ä¸ªå˜é‡ï¼Œéƒ½ä½œä¸ºfor inçš„å‚æ•°<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">!/bin/bash</span>  <br><br>word1=&quot;Welcome        to rustfisher.com&quot;<br>word2=&quot;Hello world&quot;<br>word3=&quot;æˆ‘å¾ˆå¥½&quot;<br>for i in $word1 $word2 $word3<br>do<br>    echo $i<br>done<br></code></pre></td></tr></table></figure></p><p>è¾“å‡º<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vim">Welcome<br><span class="hljs-keyword">to</span><br>rustfisher.<span class="hljs-keyword">com</span><br>Hello<br>world<br>æˆ‘å¾ˆå¥½<br></code></pre></td></tr></table></figure></p><h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><p>ä¾‹å¦‚æŸ¥æ‰¾æŸä¸ªç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚</p><p>å½“å‰ç›®å½•ä¸­æœ‰ä¸€ä¸ªimgç›®å½•ï¼Œé‡Œé¢æœ‰ä¸€äº›å›¾ç‰‡ã€‚æˆ‘ä»¬åœ¨for in åé¢ç”¨<code>img/*</code>æ¥è¡¨ç¤ºæŸ¥æ‰¾è¿™ä¸ªç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> img/*; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span> ; <span class="hljs-keyword">done</span><br>img/android-2botsm.jpg<br>img/android-cover-2.png<br></code></pre></td></tr></table></figure></p><p>å¦‚æœåªæƒ³çœ‹pngæ–‡ä»¶ï¼Œè·¯å¾„å†™ä¸º<code>img/*.png</code>ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> img/*.png; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-variable">$i</span> ; <span class="hljs-keyword">done</span><br>img/android-cover-2.png<br></code></pre></td></tr></table></figure></p><p>ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œfor inç»“æ„ç”¨çš„ååˆ†é¢‘ç¹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Linux_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Shell</tag>
      
      <tag>for</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cocos Creator æ‹–åŠ¨å»æŒ‡å®šåŒºåŸŸ</title>
    <link href="/2020/12/30/CocosCreator/ccc-drag-to-target/"/>
    <url>/2020/12/30/CocosCreator/ccc-drag-to-target/</url>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬è¦å®ç°çš„æ•ˆæœæ˜¯ï¼ŒæŒ‰ä½å¹¶æ‹–åŠ¨ä¸€ä¸ªå°ç‰©ä½“ï¼Œç‰©ä½“è·Ÿéšæ‰‹æŒ‡ï¼ˆé¼ æ ‡ï¼‰ç§»åŠ¨ã€‚<br>æ‹–åˆ°æŒ‡å®šä½ç½®æ”¾ä¸‹ã€‚å¦‚æœæ²¡æœ‰åˆ°æŒ‡å®šä½ç½®ï¼Œåˆ™å›åˆ°ä¸Šä¸€ä¸ªä½ç½®ã€‚</p><p>æ–°å»ºè„šæœ¬<strong>DragToTarget.ts</strong>ï¼ŒæŒ‚åˆ°é¢„åˆ¶ä½“ä¸Šã€‚<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">const</span> &#123; ccclass, property &#125; = cc.<span class="hljs-property">_decorator</span>;<br><span class="hljs-meta">@ccclass</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DragToTarget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">cc.Component</span> &#123;<br><br>    <span class="hljs-meta">@property</span>(cc.<span class="hljs-property">Label</span>)<br>    <span class="hljs-attr">nameLabel</span>: cc.<span class="hljs-property">Label</span> = <span class="hljs-literal">null</span>;<br><br>    <span class="hljs-meta">@property</span>(cc.<span class="hljs-property">Node</span>)<br>    <span class="hljs-attr">targetOfDragList</span>: cc.<span class="hljs-property">Node</span>[] = [];<br><br>    _oldPos = <span class="hljs-literal">null</span>; <span class="hljs-comment">// ä¸Šä¸€ä¸ªä½ç½®</span><br><br>    <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_oldPos</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-property">position</span>;<br>    &#125;<br><br>    <span class="hljs-title function_">onEnable</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-title function_">on</span>(cc.<span class="hljs-property">Node</span>.<span class="hljs-property">EventType</span>.<span class="hljs-property">TOUCH_MOVE</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_onTouchMove</span>, <span class="hljs-variable language_">this</span>);<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-title function_">on</span>(cc.<span class="hljs-property">Node</span>.<span class="hljs-property">EventType</span>.<span class="hljs-property">TOUCH_END</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_onTouchEnd</span>, <span class="hljs-variable language_">this</span>);<br>    &#125;<br><br>    <span class="hljs-title function_">onDisable</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-title function_">off</span>(cc.<span class="hljs-property">Node</span>.<span class="hljs-property">EventType</span>.<span class="hljs-property">TOUCH_MOVE</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_onTouchMove</span>, <span class="hljs-variable language_">this</span>);<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-title function_">off</span>(cc.<span class="hljs-property">Node</span>.<span class="hljs-property">EventType</span>.<span class="hljs-property">TOUCH_END</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_onTouchEnd</span>, <span class="hljs-variable language_">this</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// update (dt) &#123;&#125;</span><br><br>    <span class="hljs-title function_">_onTouchMove</span>(<span class="hljs-params">touchEvent</span>) &#123;<br>        <span class="hljs-keyword">let</span> location = touchEvent.<span class="hljs-title function_">getLocation</span>();<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-property">position</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-property">parent</span>.<span class="hljs-title function_">convertToNodeSpaceAR</span>(location); <span class="hljs-comment">// ç¡®å®šä½ç½®</span><br>    &#125;<br><br>    <span class="hljs-title function_">_onTouchEnd</span>(<span class="hljs-params">touchEvent</span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">targetOfDragList</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span>; <span class="hljs-comment">// æ²¡æœ‰ç›®æ ‡ä½ç½®</span><br>        &#125;<br>        <span class="hljs-keyword">let</span> inTarget = <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> targetNode <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">targetOfDragList</span>) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_withinTarget</span>(targetNode, touchEvent)) &#123;<br>                inTarget = <span class="hljs-literal">true</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!inTarget) &#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-property">position</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_oldPos</span>; <span class="hljs-comment">// å›å»</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// åˆ¤æ–­è§¦æ‘¸äº‹ä»¶æ˜¯å¦åœ¨æ§½ä½é‡Œ</span><br>    <span class="hljs-title function_">_withinTarget</span>(<span class="hljs-params">targetNode: cc.Node, touchEvent</span>) &#123;<br>        <span class="hljs-keyword">let</span> rect = targetNode.<span class="hljs-title function_">getBoundingBox</span>();<br>        <span class="hljs-keyword">let</span> location = touchEvent.<span class="hljs-title function_">getLocation</span>();<br>        <span class="hljs-keyword">let</span> point = targetNode.<span class="hljs-property">parent</span>.<span class="hljs-title function_">convertToNodeSpaceAR</span>(location);<br>        <span class="hljs-keyword">return</span> rect.<span class="hljs-title function_">contains</span>(point);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br>æ€è·¯ä¸ä¹‹å‰çš„æ‹–åŠ¨ç±»ä¼¼ã€‚<br>åœ¨æœ€å<code>TOUCH_END</code>çš„æ—¶å€™ï¼Œåˆ¤æ–­è‡ªå·±æ˜¯å¦åœ¨ç›®æ ‡åŒºåŸŸå†…ã€‚<br>å¦‚æœä¸åœ¨åˆ™è¿”å›ä¸Šä¸€ä¸ªåæ ‡ã€‚</p><p>åœ¨åœºæ™¯ä¸­ä½¿ç”¨<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">import</span> <span class="hljs-title class_">DragToTarget</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./DragToTarget&quot;</span>;<br><br><span class="hljs-keyword">const</span> &#123; ccclass, property &#125; = cc.<span class="hljs-property">_decorator</span>;<br><br><span class="hljs-meta">@ccclass</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DragToControl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">cc.Component</span> &#123;<br><br>    <span class="hljs-meta">@property</span>(cc.<span class="hljs-property">Prefab</span>)<br>    <span class="hljs-attr">drag_to_item</span>: cc.<span class="hljs-property">Prefab</span> = <span class="hljs-literal">null</span>;<br><br>    <span class="hljs-meta">@property</span>(cc.<span class="hljs-property">Node</span>)<br>    <span class="hljs-attr">dragTargets</span>: cc.<span class="hljs-property">Node</span>[] = [];<br><br>    itemNum = <span class="hljs-number">1</span>;<br><br>    <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createItem</span>();<br>    &#125;<br><br>    <span class="hljs-comment">// update (dt) &#123;&#125;</span><br><br>    <span class="hljs-title function_">createItem</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">let</span> d = cc.<span class="hljs-title function_">instantiate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">drag_to_item</span>);<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-title function_">addChild</span>(d);<br>        <span class="hljs-keyword">let</span> dragTo = d.<span class="hljs-title function_">getComponent</span>(<span class="hljs-title class_">DragToTarget</span>);<br>        dragTo.<span class="hljs-property">targetOfDragList</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dragTargets</span>; <span class="hljs-comment">// è®¾ç½®ç›®çš„åœ°</span><br>        dragTo.<span class="hljs-property">nameLabel</span>.<span class="hljs-property">string</span> = <span class="hljs-string">&#x27;&#x27;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">itemNum</span>++;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p><img src="drag-to-target-20201230.gif" alt="è¿è¡Œæ•ˆæœ"></p>]]></content>
    
    
    <categories>
      
      <category>CocosCreator</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cocos Creator</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cocos Creator åæ ‡ä¸è½¬æ¢</title>
    <link href="/2020/12/29/CocosCreator/ccc-postion-and-cvt/"/>
    <url>/2020/12/29/CocosCreator/ccc-postion-and-cvt/</url>
    
    <content type="html"><![CDATA[<p>cccçš„<a href="https://docs.cocos.com/creator/manual/zh/content-workflow/transform.html">åæ ‡ç³»</a></p><p>cccæä¾›äº†apiï¼Œåœ¨ä¸–ç•Œåæ ‡å’Œæœ¬åœ°åæ ‡ä¹‹é—´å¯ä»¥ç›¸äº’è½¬æ¢ã€‚</p><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">let</span> postion = node.<span class="hljs-property">position</span>; <span class="hljs-comment">// postionæ˜¯åœ¨çˆ¶èŠ‚ç‚¹ä¸­çš„åæ ‡</span><br>cc.<span class="hljs-title function_">log</span>(name, <span class="hljs-string">&#x27;position (&#x27;</span>, postion.<span class="hljs-property">x</span>.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>), <span class="hljs-string">&#x27;,&#x27;</span>, postion.<span class="hljs-property">y</span>.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>), <span class="hljs-string">&#x27;)&#x27;</span>);<br><br><span class="hljs-keyword">let</span> worldPos = node.<span class="hljs-property">parent</span>.<span class="hljs-title function_">convertToWorldSpaceAR</span>(node.<span class="hljs-property">position</span>); <span class="hljs-comment">// ä¸–ç•Œåæ ‡</span><br>cc.<span class="hljs-title function_">log</span>(name, <span class="hljs-string">&#x27;ä¸–ç•Œåæ ‡(&#x27;</span>, worldPos.<span class="hljs-property">x</span>.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>), <span class="hljs-string">&#x27;,&#x27;</span>, worldPos.<span class="hljs-property">y</span>.<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>), <span class="hljs-string">&#x27;)&#x27;</span>);<br></code></pre></td></tr></table></figure><p><code>node.position</code>æ˜¯æœ¬åœ°åæ ‡ï¼Œä¹Ÿå°±æ˜¯åœ¨çˆ¶èŠ‚ç‚¹ä¸­çš„åæ ‡ã€‚<br>è®©<strong>çˆ¶èŠ‚ç‚¹</strong>è°ƒç”¨<code>convertToWorldSpaceAR</code>æ–¹æ³•ï¼ŒæŠŠèŠ‚ç‚¹çš„æœ¬åœ°åæ ‡è½¬æ¢ä¸ºä¸–ç•Œåæ ‡ã€‚</p><p><img src="ccc-pos.png" alt="è¿è¡Œæ•ˆæœå›¾"></p><ul><li><code>p</code>æ˜¯æœ¬åœ°åæ ‡</li><li><code>w</code>æ˜¯ä¸–ç•Œåæ ‡</li></ul><p>ä»£ç å‚è€ƒ<a href="https://github.com/RustFisher/CCCTry">CCCTry</a></p>]]></content>
    
    
    <categories>
      
      <category>CocosCreator</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cocos Creator</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Cocos Creator æ‹–åŠ¨æ•ˆæœ</title>
    <link href="/2020/12/28/CocosCreator/ccc-drag-anywhere/"/>
    <url>/2020/12/28/CocosCreator/ccc-drag-anywhere/</url>
    
    <content type="html"><![CDATA[<p>æˆ‘ä»¬è¦å®ç°çš„æ•ˆæœæ˜¯ï¼ŒæŒ‰ä½å¹¶æ‹–åŠ¨ä¸€ä¸ªå°ç‰©ä½“ï¼Œç‰©ä½“è·Ÿéšæ‰‹æŒ‡ï¼ˆé¼ æ ‡ï¼‰ç§»åŠ¨ã€‚</p><p>ä»£ç <strong>DragToAnywhere.ts</strong><br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-meta">@ccclass</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DragToAnywhere</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">cc.Component</span> &#123;<br><br>    <span class="hljs-meta">@property</span>(cc.<span class="hljs-property">Label</span>)<br>    <span class="hljs-attr">label</span>: cc.<span class="hljs-property">Label</span> = <span class="hljs-literal">null</span>;<br><br>    start () &#123;<br>        <br>    &#125;<br><br>    <span class="hljs-title function_">onEnable</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-title function_">on</span>(cc.<span class="hljs-property">Node</span>.<span class="hljs-property">EventType</span>.<span class="hljs-property">TOUCH_MOVE</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_onTouchMove</span>, <span class="hljs-variable language_">this</span>);<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-title function_">on</span>(cc.<span class="hljs-property">Node</span>.<span class="hljs-property">EventType</span>.<span class="hljs-property">TOUCH_END</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_onTouchEnd</span>, <span class="hljs-variable language_">this</span>);<br>    &#125;<br><br>    <span class="hljs-title function_">onDisable</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-title function_">off</span>(cc.<span class="hljs-property">Node</span>.<span class="hljs-property">EventType</span>.<span class="hljs-property">TOUCH_MOVE</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_onTouchMove</span>, <span class="hljs-variable language_">this</span>);<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-title function_">off</span>(cc.<span class="hljs-property">Node</span>.<span class="hljs-property">EventType</span>.<span class="hljs-property">TOUCH_END</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_onTouchEnd</span>, <span class="hljs-variable language_">this</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// update (dt) &#123;&#125;</span><br><br>    <span class="hljs-title function_">_onTouchMove</span>(<span class="hljs-params">touchEvent</span>) &#123;<br>        <span class="hljs-keyword">let</span> location = touchEvent.<span class="hljs-title function_">getLocation</span>();<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-property">position</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-property">parent</span>.<span class="hljs-title function_">convertToNodeSpaceAR</span>(location); <span class="hljs-comment">// ç¡®å®šä½ç½®</span><br>    &#125;<br><br>    <span class="hljs-title function_">_onTouchEnd</span>(<span class="hljs-params">touchEvent</span>) &#123;<br>        <span class="hljs-comment">// æ”¾ä¸‹</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>æŠŠ<strong>DragToAnywhere.ts</strong>æŒ‚åœ¨é¢„åˆ¶ä½“ä¸Šã€‚åœ¨åœºæ™¯ä¸­åˆ›å»ºé¢„åˆ¶ä½“å¯¹è±¡ã€‚<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">let</span> node1 = cc.<span class="hljs-title function_">instantiate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">drag_item</span>);<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-title function_">addChild</span>(node1);<br>node1.<span class="hljs-property">x</span> = <span class="hljs-number">100</span>;<br>node1.<span class="hljs-property">y</span> = <span class="hljs-number">100</span>;<br>node1.<span class="hljs-title function_">getComponent</span>(<span class="hljs-title class_">DragToAnywhere</span>).<span class="hljs-property">label</span>.<span class="hljs-property">string</span> = <span class="hljs-string">&#x27;æ°´æ˜Ÿ&#x27;</span>;<br></code></pre></td></tr></table></figure></p><p><img src="ccc-drag-anywhere-1.gif" alt="è¿è¡Œæ•ˆæœ"></p>]]></content>
    
    
    <categories>
      
      <category>CocosCreator</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cocos Creator</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TypeScript å•ä¾‹æ¨¡å¼</title>
    <link href="/2020/12/27/Ts/ts-singleton-pattern/"/>
    <url>/2020/12/27/Ts/ts-singleton-pattern/</url>
    
    <content type="html"><![CDATA[<p>tsä¸­çš„å•ä¾‹æ¨¡å¼</p><ul><li>æ„é€ å™¨è®¾ç½®ä¸ºç§æœ‰çš„</li><li>å»ºç«‹staticæ–¹æ³•ï¼Œè·å–å”¯ä¸€çš„å¯¹è±¡</li></ul><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataMgr</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">mgr</span>: <span class="hljs-title class_">DataMgr</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">// æ„é€ å™¨</span><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getMgr</span>(): <span class="hljs-title class_">DataMgr</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">mgr</span> == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">mgr</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataMgr</span>();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">mgr</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å†™æ³•ä¸Šä¸Javaçš„å•ä¾‹æ¨¡å¼ç±»ä¼¼</p>]]></content>
    
    
    <categories>
      
      <category>TypeScript</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Cocos Creator è§¦æ‘¸äº‹ä»¶ç©¿é€</title>
    <link href="/2020/12/26/CocosCreator/ccc-touch-event/"/>
    <url>/2020/12/26/CocosCreator/ccc-touch-event/</url>
    
    <content type="html"><![CDATA[<h2 id="è§¦æ‘¸äº‹ä»¶"><a href="#è§¦æ‘¸äº‹ä»¶" class="headerlink" title="è§¦æ‘¸äº‹ä»¶"></a>è§¦æ‘¸äº‹ä»¶</h2><p>å‡è®¾ç»™æ•´ä¸ªCanvasæ·»åŠ äº†äº‹ä»¶ç›‘å¬ã€‚ç”¨ç½‘é¡µæ¨¡æ‹Ÿæ—¶ï¼Œé¼ æ ‡ç§»åŠ¨ï¼Œç‚¹å‡»å­nodeéƒ½ä¼šç›‘å¬åˆ°ã€‚<br><figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs ts"><span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_cfgTouchField</span>();<br>&#125;<br><br><span class="hljs-title function_">_onTouchFieldDown</span>(<span class="hljs-params">e</span>) &#123;<br>    cc.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;table&#x27;</span>, <span class="hljs-string">&#x27;_onTouchFieldDown&#x27;</span>);<br>&#125;<br><br><span class="hljs-title function_">_onTouchFieldMove</span>(<span class="hljs-params">e</span>) &#123;<br>    cc.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;table&#x27;</span>, <span class="hljs-string">&#x27;_onTouchFieldMove&#x27;</span>);<br>&#125;<br><br><span class="hljs-title function_">_onTouchFieldEnd</span>(<span class="hljs-params">e</span>) &#123;<br>    cc.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;table&#x27;</span>, <span class="hljs-string">&#x27;_onTouchFieldEnd&#x27;</span>);<br>&#125;<br><br><span class="hljs-title function_">_cfgTouchField</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-title function_">on</span>(cc.<span class="hljs-property">Node</span>.<span class="hljs-property">EventType</span>.<span class="hljs-property">MOUSE_DOWN</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_onTouchFieldDown</span>, <span class="hljs-variable language_">this</span>);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-title function_">on</span>(cc.<span class="hljs-property">Node</span>.<span class="hljs-property">EventType</span>.<span class="hljs-property">MOUSE_MOVE</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_onTouchFieldMove</span>, <span class="hljs-variable language_">this</span>);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-title function_">on</span>(cc.<span class="hljs-property">Node</span>.<span class="hljs-property">EventType</span>.<span class="hljs-property">MOUSE_LEAVE</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_onTouchFieldEnd</span>, <span class="hljs-variable language_">this</span>);<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">node</span>.<span class="hljs-title function_">on</span>(cc.<span class="hljs-property">Node</span>.<span class="hljs-property">EventType</span>.<span class="hljs-property">MOUSE_UP</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_onTouchFieldEnd</span>, <span class="hljs-variable language_">this</span>);<br>&#125;<br></code></pre></td></tr></table></figure></p><p>ç½‘é¡µæ¨¡æ‹Ÿï¼Œé¼ æ ‡ä»ç©ºç™½åœ°æ–¹ç§»å…¥Toggleçš„èŒƒå›´æ—¶ï¼Œä¼šè§¦å‘ä¸€æ¬¡<code>cc.Node.EventType.MOUSE_LEAVE</code>ï¼›<br>ç„¶ååˆæ˜¯<code>cc.Node.EventType.MOUSE_MOVE</code></p>]]></content>
    
    
    <categories>
      
      <category>CocosCreator</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Cocos Creator</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Kotlinå¿«é€Ÿä¸Šæ‰‹</title>
    <link href="/2020/04/10/Kotlin/kotlin-breif-intro/"/>
    <url>/2020/04/10/Kotlin/kotlin-breif-intro/</url>
    
    <content type="html"><![CDATA[<p>å¿«é€Ÿä»‹ç»Kotlinçš„ç”¨æ³•ã€‚æœ‰äº›åœ°æ–¹ä¼šå’ŒJavaè¿›è¡Œç±»æ¯”ã€‚</p><h2 id="å˜é‡å£°æ˜"><a href="#å˜é‡å£°æ˜" class="headerlink" title="å˜é‡å£°æ˜"></a>å˜é‡å£°æ˜</h2><p>Kotlin ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„å…³é”®å­—ï¼ˆå³ val å’Œ varï¼‰æ¥å£°æ˜å˜é‡ã€‚</p><p>val ç”¨äºå€¼ä»ä¸æ›´æ”¹çš„å˜é‡ã€‚æ‚¨ä¸èƒ½ä¸ºä½¿ç”¨ val å£°æ˜çš„å˜é‡é‡æ–°èµ‹å€¼ã€‚<br>var ç”¨äºå€¼å¯ä»¥æ›´æ”¹çš„å˜é‡ã€‚<br>åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œcount æ˜¯ä¸€ä¸ª Int ç±»å‹çš„å˜é‡ï¼Œä¸ºå…¶èµ‹äºˆçš„åˆå§‹å€¼ä¸º 10ï¼š</p><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">var</span> count: <span class="hljs-built_in">Int</span> = <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><blockquote><p>Javaä¸­æˆ‘ä»¬ä¼šå†™æˆ<code>int count = 10;</code>ï¼Œç±»å‹å†™åœ¨å‰é¢ï¼Œç»“å°¾éœ€è¦åˆ†å·ã€‚</p></blockquote><p>Int æ˜¯ä¸€ç§è¡¨ç¤ºæ•´æ•°çš„ç±»å‹ï¼Œå®ƒæ˜¯å¯ä»¥åœ¨ Kotlin ä¸­è¡¨ç¤ºçš„ä¼—å¤šæ•°å€¼ç±»å‹ä¹‹ä¸€ã€‚ä¸å…¶ä»–è¯­è¨€ç±»ä¼¼ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ Byteã€Shortã€Longã€Float å’Œ Doubleï¼Œå…·ä½“å–å†³äºæ‚¨çš„æ•°å€¼æ•°æ®ã€‚</p><p>var å…³é”®å­—è¡¨ç¤ºæ‚¨å¯ä»¥æ ¹æ®éœ€è¦ä¸º count é‡æ–°èµ‹å€¼ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°† count çš„å€¼ä» 10 æ›´æ”¹ä¸º 15ï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">var</span> count: <span class="hljs-built_in">Int</span> = <span class="hljs-number">10</span><br>    count = <span class="hljs-number">15</span><br></code></pre></td></tr></table></figure></p><p>ä¸è¿‡ï¼Œæœ‰äº›å€¼ä¸åº”æ›´æ”¹ã€‚å‡è®¾æœ‰ä¸€ä¸ªåä¸º languageName çš„ Stringã€‚å¦‚æœæ‚¨è¦ç¡®ä¿ languageName çš„å€¼å§‹ç»ˆä¸ºâ€œKotlinâ€ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ val å…³é”®å­—æ¥å£°æ˜ languageNameï¼š</p><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">val</span> languageName: String = <span class="hljs-string">&quot;Kotlin&quot;</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡è¿™äº›å…³é”®å­—ï¼Œæ‚¨å¯ä»¥æ˜ç¡®æŒ‡å‡ºå“ªäº›å˜é‡çš„å€¼å¯ä»¥æ›´æ”¹ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦åŠ ä»¥åˆ©ç”¨ã€‚å¦‚æœå˜é‡å¼•ç”¨å¿…é¡»å¯é‡æ–°èµ‹å€¼ï¼Œåˆ™å°†å…¶å£°æ˜ä¸º varã€‚å¦åˆ™ï¼Œè¯·ä½¿ç”¨ valã€‚</p><h2 id="ç±»å‹æ¨æ–­"><a href="#ç±»å‹æ¨æ–­" class="headerlink" title="ç±»å‹æ¨æ–­"></a>ç±»å‹æ¨æ–­</h2><p>æ¥ç€å‰é¢çš„ç¤ºä¾‹æ¥è®²ï¼Œå½“æ‚¨ä¸º languageName èµ‹äºˆåˆå§‹å€¼æ—¶ï¼ŒKotlin ç¼–è¯‘å™¨å¯æ ¹æ®æ‰€èµ‹å€¼çš„ç±»å‹æ¥æ¨æ–­ç±»å‹ã€‚</p><p>ç”±äº â€œKotlinâ€ çš„å€¼çš„ç±»å‹ä¸º Stringï¼Œå› æ­¤ç¼–è¯‘å™¨æ¨æ–­ languageName ä¹Ÿä¸º Stringã€‚è¯·æ³¨æ„ï¼ŒKotlin æ˜¯ä¸€ç§é™æ€ç±»å‹çš„è¯­è¨€ã€‚è¿™æ„å‘³ç€ï¼Œç±»å‹åœ¨ç¼–è¯‘æ—¶è§£æä¸”ä»ä¸æ”¹å˜ã€‚</p><p>åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼ŒlanguageName æ¨æ–­ä¸º Stringï¼Œå› æ­¤æ‚¨æ— æ³•å¯¹å…¶è°ƒç”¨ä»»ä½•ä¸å±äº String ç±»çš„å‡½æ•°ï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">val</span> languageName = <span class="hljs-string">&quot;Kotlin&quot;</span><br>    <span class="hljs-keyword">val</span> upperCaseName = languageName.toUpperCase()<br><br>    <span class="hljs-comment">// Fails to compile</span><br>    languageName.inc()<br></code></pre></td></tr></table></figure></p><p>toUpperCase() æ˜¯ä¸€ä¸ªåªèƒ½å¯¹ String ç±»å‹çš„å˜é‡è°ƒç”¨çš„å‡½æ•°ã€‚ç”±äº Kotlin ç¼–è¯‘å™¨å·²å°† languageName æ¨æ–­ä¸º Stringï¼Œå› æ­¤æ‚¨å¯ä»¥å®‰å…¨åœ°è°ƒç”¨ toUpperCase()ã€‚ä¸è¿‡ï¼Œinc() æ˜¯ä¸€ä¸ª Int è¿ç®—ç¬¦å‡½æ•°ï¼Œå› æ­¤æ— æ³•å¯¹ String è°ƒç”¨å®ƒã€‚åˆ©ç”¨ Kotlin çš„ç±»å‹æ¨æ–­ï¼Œæ‚¨æ—¢èƒ½ç¡®ä¿ä»£ç ç®€æ´ï¼Œåˆèƒ½ç¡®ä¿ç±»å‹å®‰å…¨ã€‚</p><h2 id="Null-å®‰å…¨"><a href="#Null-å®‰å…¨" class="headerlink" title="Null å®‰å…¨"></a>Null å®‰å…¨</h2><p>åœ¨æŸäº›è¯­è¨€ä¸­ï¼Œå¯ä»¥å£°æ˜å¼•ç”¨ç±»å‹å˜é‡è€Œä¸æ˜ç¡®æä¾›åˆå§‹å€¼ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå˜é‡é€šå¸¸åŒ…å« null å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒKotlin å˜é‡ä¸èƒ½æŒæœ‰ null å€¼ã€‚è¿™æ„å‘³ç€ä»¥ä¸‹ä»£ç æ®µæ— æ•ˆï¼š</p><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-comment">// Fails to compile</span><br>    <span class="hljs-keyword">val</span> languageName: String = <span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure><p>è¦ä½¿å˜é‡æŒæœ‰ null å€¼ï¼Œå®ƒå¿…é¡»æ˜¯å¯ä¸º null ç±»å‹ã€‚æ‚¨å¯ä»¥åœ¨å˜é‡ç±»å‹åé¢åŠ ä¸Š ? åç¼€ï¼Œå°†å˜é‡æŒ‡å®šä¸ºå¯ä¸º nullï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs autoit">val languageName: <span class="hljs-built_in">String</span>? = <span class="hljs-literal">null</span><br></code></pre></td></tr></table></figure></p><p>æŒ‡å®š String? ç±»å‹åï¼Œæ‚¨å¯ä»¥ä¸º languageName èµ‹äºˆ String å€¼æˆ– nullã€‚</p><p>æ‚¨å¿…é¡»å°å¿ƒå¤„ç†å¯ä¸º null çš„å˜é‡ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°å¯æ€•çš„ NullPointerExceptionã€‚ä¾‹å¦‚ï¼Œåœ¨ Java ä¸­ï¼Œå¦‚æœæ‚¨å°è¯•å¯¹ null å€¼è°ƒç”¨æ–¹æ³•ï¼Œæ‚¨çš„ç¨‹åºä¼šå‘ç”Ÿå´©æºƒã€‚</p><h2 id="æ¡ä»¶è¯­å¥"><a href="#æ¡ä»¶è¯­å¥" class="headerlink" title="æ¡ä»¶è¯­å¥"></a>æ¡ä»¶è¯­å¥</h2><p>Kotlin æä¾›äº†å‡ ç§ç”¨æ¥å®ç°æ¡ä»¶é€»è¾‘çš„æœºåˆ¶ï¼Œå…¶ä¸­æœ€å¸¸è§çš„æ˜¯ if-else è¯­å¥ã€‚å¦‚æœ if å…³é”®å­—åé¢æ‹¬åœ¨åœ†æ‹¬å·å†…çš„è¡¨è¾¾å¼æ±‚å€¼ä¸º trueï¼Œåˆ™ä¼šæ‰§è¡Œè¯¥åˆ†æ”¯ä¸­çš„ä»£ç ï¼ˆå³ï¼Œç´§è·Ÿåœ¨åé¢çš„æ‹¬åœ¨å¤§æ‹¬å·å†…çš„ä»£ç ï¼‰ã€‚å¦åˆ™ï¼Œä¼šæ‰§è¡Œ else åˆ†æ”¯ä¸­çš„ä»£ç ã€‚<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">if</span> (count == <span class="hljs-number">42</span>) &#123;<br>        println(<span class="hljs-string">&quot;I have the answer.&quot;</span>)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        println(<span class="hljs-string">&quot;The answer eludes me.&quot;</span>)<br>    &#125;<br></code></pre></td></tr></table></figure></p><p>æ‚¨å¯ä»¥ä½¿ç”¨ else if è¡¨ç¤ºå¤šä¸ªæ¡ä»¶ã€‚è¿™æ ·ï¼Œæ‚¨å°±å¯ä»¥åœ¨å•ä¸ªæ¡ä»¶è¯­å¥ä¸­è¡¨ç¤ºæ›´ç²¾ç»†ä¸”æ›´å¤æ‚çš„é€»è¾‘ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">if</span> (count == <span class="hljs-number">42</span>) &#123;<br>        println(<span class="hljs-string">&quot;I have the answer.&quot;</span>)<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">35</span>) &#123;<br>        println(<span class="hljs-string">&quot;The answer is close.&quot;</span>)<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        println(<span class="hljs-string">&quot;The answer eludes me.&quot;</span>)<br>    &#125;<br></code></pre></td></tr></table></figure></p><p>æ¡ä»¶è¯­å¥å¯¹äºè¡¨ç¤ºæœ‰çŠ¶æ€çš„é€»è¾‘å¾ˆæœ‰ç”¨ï¼Œä½†æ‚¨å¯èƒ½ä¼šå‘ç°ï¼Œç¼–å†™è¿™äº›è¯­å¥æ—¶ä¼šé‡å¤ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå°±æ˜¯åœ¨æ¯ä¸ªåˆ†æ”¯ä¸­è¾“å‡ºä¸€ä¸ª Stringã€‚ä¸ºäº†é¿å…è¿™ç§é‡å¤ï¼ŒKotlin æä¾›äº†æ¡ä»¶è¡¨è¾¾å¼ã€‚æœ€åä¸€ä¸ªç¤ºä¾‹å¯ä»¥é‡æ–°ç¼–å†™å¦‚ä¸‹ï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">val</span> answerString: String = <span class="hljs-keyword">if</span> (count == <span class="hljs-number">42</span>) &#123;<br>        <span class="hljs-string">&quot;I have the answer.&quot;</span><br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">35</span>) &#123;<br>        <span class="hljs-string">&quot;The answer is close.&quot;</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-string">&quot;The answer eludes me.&quot;</span><br>    &#125;<br><br>    println(answerString)<br></code></pre></td></tr></table></figure></p><p>æ¯ä¸ªæ¡ä»¶åˆ†æ”¯éƒ½éšå¼åœ°è¿”å›å…¶æœ€åä¸€è¡Œä¸Šçš„è¡¨è¾¾å¼çš„ç»“æœï¼Œå› æ­¤æ‚¨æ— éœ€ä½¿ç”¨ return å…³é”®å­—ã€‚ç”±äºå…¨éƒ¨ä¸‰ä¸ªåˆ†æ”¯çš„ç»“æœéƒ½æ˜¯ String ç±»å‹ï¼Œå› æ­¤ if-else è¡¨è¾¾å¼çš„ç»“æœä¹Ÿæ˜¯ String ç±»å‹ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæ ¹æ® if-else è¡¨è¾¾å¼çš„ç»“æœä¸º answerString èµ‹äºˆäº†ä¸€ä¸ªåˆå§‹å€¼ã€‚å¯ä»¥åˆ©ç”¨ç±»å‹æ¨æ–­æ¥çœç•¥ answerString çš„æ˜¾å¼ç±»å‹å£°æ˜ï¼Œä½†ä¸ºäº†æ¸…æ¥šèµ·è§ï¼Œé€šå¸¸æœ€å¥½æ·»åŠ è¯¥å£°æ˜ã€‚</p><blockquote><p>æ³¨æ„ï¼šKotlin ä¸åŒ…å«ä¼ ç»Ÿçš„ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œè€Œæ˜¯å€¾å‘äºä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼ã€‚</p></blockquote><p>éšç€æ¡ä»¶è¯­å¥çš„å¤æ‚æ€§ä¸æ–­å¢åŠ ï¼Œæ‚¨å¯ä»¥è€ƒè™‘å°† if-else è¡¨è¾¾å¼æ›¿æ¢ä¸º when è¡¨è¾¾å¼ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">val</span> answerString = <span class="hljs-keyword">when</span> &#123;<br>        count == <span class="hljs-number">42</span> -&gt; <span class="hljs-string">&quot;I have the answer.&quot;</span><br>        count &gt; <span class="hljs-number">35</span> -&gt; <span class="hljs-string">&quot;The answer is close.&quot;</span><br>        <span class="hljs-keyword">else</span> -&gt; <span class="hljs-string">&quot;The answer eludes me.&quot;</span><br>    &#125;<br><br>    println(answerString)<br></code></pre></td></tr></table></figure></p><p>when è¡¨è¾¾å¼ä¸­çš„æ¯ä¸ªåˆ†æ”¯éƒ½ç”±ä¸€ä¸ªæ¡ä»¶ã€ä¸€ä¸ªç®­å¤´ (-&gt;) å’Œä¸€ä¸ªç»“æœæ¥è¡¨ç¤ºã€‚å¦‚æœç®­å¤´å·¦ä¾§çš„æ¡ä»¶æ±‚å€¼ä¸º trueï¼Œåˆ™ä¼šè¿”å›å³ä¾§çš„è¡¨è¾¾å¼ç»“æœã€‚è¯·æ³¨æ„ï¼Œæ‰§è¡Œå¹¶ä¸æ˜¯ä»ä¸€ä¸ªåˆ†æ”¯è·³è½¬åˆ°ä¸‹ä¸€ä¸ªåˆ†æ”¯ã€‚when è¡¨è¾¾å¼ç¤ºä¾‹ä¸­çš„ä»£ç åœ¨åŠŸèƒ½ä¸Šä¸ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­çš„ä»£ç ç­‰æ•ˆï¼Œä½†å¯ä»¥è¯´æ›´æ˜“è¯»ã€‚</p><p>Kotlin çš„æ¡ä»¶è¯­å¥å½°æ˜¾äº†å®ƒçš„ä¸€é¡¹æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼Œå³æ™ºèƒ½ç±»å‹è½¬æ¢ã€‚æ‚¨ä¸å¿…ä½¿ç”¨å®‰å…¨è°ƒç”¨è¿ç®—ç¬¦æˆ–é null æ–­è¨€è¿ç®—ç¬¦æ¥å¤„ç†å¯ä¸º null çš„å€¼ï¼Œè€Œæ˜¯å¯ä»¥ä½¿ç”¨æ¡ä»¶è¯­å¥æ¥æ£€æŸ¥å˜é‡æ˜¯å¦åŒ…å«å¯¹ null å€¼çš„å¼•ç”¨ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">val</span> languageName: String? = <span class="hljs-literal">null</span><br>    <span class="hljs-keyword">if</span> (languageName != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// No need to write languageName?.toUpperCase()</span><br>        println(languageName.toUpperCase())<br>    &#125;<br></code></pre></td></tr></table></figure><br>å¦‚æœä»£ç ä¸­å·²ç»è¿›è¡Œnullæ£€æŸ¥ï¼Œå°±ä¸ç”¨å†™<code>languageName?</code>é‡Œçš„é—®å·äº†ã€‚</p><p>åœ¨æ¡ä»¶åˆ†æ”¯ä¸­ï¼ŒlanguageName å¯èƒ½ä¼šè¢«è§†ä¸ºä¸å¯ä¸º nullã€‚Kotlin éå¸¸æ™ºèƒ½ï¼Œèƒ½å¤Ÿæ˜ç™½æ‰§è¡Œåˆ†æ”¯çš„æ¡ä»¶æ˜¯ languageName ä¸æŒæœ‰ null å€¼ï¼Œå› æ­¤æ‚¨ä¸å¿…åœ¨è¯¥åˆ†æ”¯ä¸­å°† languageName è§†ä¸ºå¯ä¸º nullã€‚</p><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p>æ‚¨å¯ä»¥å°†ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼å½’å…¥ä¸€ä¸ªå‡½æ•°ã€‚æ‚¨å¯ä»¥å°†ç›¸åº”çš„è¡¨è¾¾å¼å°è£…åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å¹¶è°ƒç”¨è¯¥å‡½æ•°ï¼Œè€Œä¸å¿…åœ¨æ¯æ¬¡éœ€è¦æŸä¸ªç»“æœæ—¶éƒ½é‡å¤åŒä¸€ç³»åˆ—çš„è¡¨è¾¾å¼ã€‚</p><p>è¦å£°æ˜å‡½æ•°ï¼Œè¯·ä½¿ç”¨ fun å…³é”®å­—ï¼Œåè·Ÿå‡½æ•°åç§°ã€‚æ¥ä¸‹æ¥ï¼Œå®šä¹‰å‡½æ•°æ¥å—çš„è¾“å…¥ç±»å‹ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œå¹¶å£°æ˜å®ƒè¿”å›çš„è¾“å‡ºç±»å‹ã€‚å‡½æ•°çš„ä¸»ä½“ç”¨äºå®šä¹‰åœ¨è°ƒç”¨å‡½æ•°æ—¶è°ƒç”¨çš„è¡¨è¾¾å¼ã€‚</p><p>ä»¥å‰é¢çš„ç¤ºä¾‹ä¸ºåŸºç¡€ï¼Œä¸‹é¢ç»™å‡ºäº†ä¸€ä¸ªå®Œæ•´çš„ Kotlin å‡½æ•°ï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateAnswerString</span><span class="hljs-params">()</span></span>: String &#123;<br>        <span class="hljs-keyword">val</span> answerString = <span class="hljs-keyword">if</span> (count == <span class="hljs-number">42</span>) &#123;<br>            <span class="hljs-string">&quot;I have the answer.&quot;</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-string">&quot;The answer eludes me&quot;</span><br>        &#125;<br>        <span class="hljs-keyword">return</span> answerString<br>    &#125;<br></code></pre></td></tr></table></figure></p><p>ä¸Šé¢ç¤ºä¾‹ä¸­çš„å‡½æ•°åä¸º generateAnswerStringã€‚å®ƒä¸æ¥å—ä»»ä½•è¾“å…¥ã€‚å®ƒä¼šè¾“å‡º String ç±»å‹çš„ç»“æœã€‚è¦è°ƒç”¨å‡½æ•°ï¼Œè¯·ä½¿ç”¨å‡½æ•°åç§°ï¼Œåè·Ÿè°ƒç”¨è¿ç®—ç¬¦ (())ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨ generateAnswerString() çš„ç»“æœå¯¹ answerString å˜é‡è¿›è¡Œäº†åˆå§‹åŒ–ã€‚<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">val</span> answerString = generateAnswerString()<br></code></pre></td></tr></table></figure></p><p>å‡½æ•°å¯ä»¥æ¥å—å‚æ•°è¾“å…¥ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateAnswerString</span><span class="hljs-params">(countThreshold: <span class="hljs-type">Int</span>)</span></span>: String &#123;<br>        <span class="hljs-keyword">val</span> answerString = <span class="hljs-keyword">if</span> (count &gt; countThreshold) &#123;<br>            <span class="hljs-string">&quot;I have the answer.&quot;</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-string">&quot;The answer eludes me.&quot;</span><br>        &#125;<br><br>        <span class="hljs-keyword">return</span> answerString<br>    &#125;<br></code></pre></td></tr></table></figure></p><p>åœ¨å£°æ˜å‡½æ•°æ—¶ï¼Œæ‚¨å¯ä»¥æŒ‡å®šä»»æ„æ•°é‡çš„å‚æ•°åŠå…¶ç±»å‹ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒgenerateAnswerString() æ¥å—ä¸€ä¸ªåä¸º countThreshold ä¸”ç±»å‹ä¸º Int çš„å‚æ•°ã€‚åœ¨å‡½æ•°ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å‚æ•°çš„åç§°æ¥å¼•ç”¨å‚æ•°ã€‚</p><p>è°ƒç”¨æ­¤å‡½æ•°æ—¶ï¼Œæ‚¨å¿…é¡»åœ¨å‡½æ•°è°ƒç”¨çš„åœ†æ‹¬å·å†…æ·»åŠ ä¸€ä¸ªå‚æ•°ï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">val</span> answerString = generateAnswerString(<span class="hljs-number">42</span>)<br></code></pre></td></tr></table></figure></p><h3 id="ç®€åŒ–å‡½æ•°å£°æ˜"><a href="#ç®€åŒ–å‡½æ•°å£°æ˜" class="headerlink" title="ç®€åŒ–å‡½æ•°å£°æ˜"></a>ç®€åŒ–å‡½æ•°å£°æ˜</h3><p>generateAnswerString() æ˜¯ä¸€ä¸ªç›¸å½“ç®€å•çš„å‡½æ•°ã€‚è¯¥å‡½æ•°å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œç„¶åç«‹å³è¿”å›ç»“æœã€‚ä»å‡½æ•°è¿”å›å•ä¸ªè¡¨è¾¾å¼çš„ç»“æœæ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡ç›´æ¥è¿”å›å‡½æ•°ä¸­åŒ…å«çš„ if-else è¡¨è¾¾å¼çš„ç»“æœæ¥è·³è¿‡å£°æ˜å±€éƒ¨å˜é‡ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateAnswerString</span><span class="hljs-params">(countThreshold: <span class="hljs-type">Int</span>)</span></span>: String &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (count &gt; countThreshold) &#123;<br>            <span class="hljs-string">&quot;I have the answer.&quot;</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-string">&quot;The answer eludes me.&quot;</span><br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure></p><p>æ‚¨è¿˜å¯ä»¥å°† return å…³é”®å­—æ›¿æ¢ä¸ºèµ‹å€¼è¿ç®—ç¬¦ï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateAnswerString</span><span class="hljs-params">(countThreshold: <span class="hljs-type">Int</span>)</span></span>: String = <span class="hljs-keyword">if</span> (count &gt; countThreshold) &#123;<br>            <span class="hljs-string">&quot;I have the answer&quot;</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-string">&quot;The answer eludes me&quot;</span><br>        &#125;<br></code></pre></td></tr></table></figure></p><h3 id="åŒ¿åå‡½æ•°"><a href="#åŒ¿åå‡½æ•°" class="headerlink" title="åŒ¿åå‡½æ•°"></a>åŒ¿åå‡½æ•°</h3><p>å¹¶éæ¯ä¸ªå‡½æ•°éƒ½éœ€è¦ä¸€ä¸ªåç§°ã€‚æŸäº›å‡½æ•°ç”±å…¶è¾“å…¥å’Œè¾“å‡ºæ›´ç›´æ¥åœ°è¿›è¡Œæ ‡è¯†ã€‚è¿™äº›å‡½æ•°ç§°ä¸ºâ€œåŒ¿åå‡½æ•°â€ã€‚æ‚¨å¯ä»¥ä¿ç•™å¯¹æŸä¸ªåŒ¿åå‡½æ•°çš„å¼•ç”¨ï¼Œä»¥ä¾¿æ—¥åä½¿ç”¨æ­¤å¼•ç”¨æ¥è°ƒç”¨è¯¥åŒ¿åå‡½æ•°ã€‚ä¸å…¶ä»–å¼•ç”¨ç±»å‹ä¸€æ ·ï¼Œæ‚¨ä¹Ÿå¯ä»¥åœ¨åº”ç”¨ä¸­ä¼ é€’å¼•ç”¨ã€‚<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">val</span> stringLengthFunc: (String) -&gt; <span class="hljs-built_in">Int</span> = &#123; input -&gt;<br>        input.length<br>    &#125;<br></code></pre></td></tr></table></figure><br>å°æ‹¬å·é‡Œè¡¨ç¤ºä¼ å…¥çš„ç±»å‹ï¼Œ<code>-&gt;</code>å³è¾¹æ˜¯è¿”å›ç±»å‹ã€‚<code>input</code>ä»£è¡¨è¾“å…¥çš„å˜é‡ã€‚</p><p>ä¸å‘½åå‡½æ•°ä¸€æ ·ï¼ŒåŒ¿åå‡½æ•°ä¹Ÿå¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„è¡¨è¾¾å¼ã€‚å‡½æ•°çš„è¿”å›å€¼æ˜¯æœ€ç»ˆè¡¨è¾¾å¼çš„ç»“æœã€‚</p><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>stringLengthFunc</code> åŒ…å«å¯¹ä¸€ä¸ªåŒ¿åå‡½æ•°çš„å¼•ç”¨ï¼Œè¯¥å‡½æ•°å°† String å½“ä½œè¾“å…¥ï¼Œå¹¶å°†è¾“å…¥ String çš„é•¿åº¦ä½œä¸º Int ç±»å‹çš„è¾“å‡ºè¿”å›ã€‚å› æ­¤ï¼Œè¯¥å‡½æ•°çš„ç±»å‹è¡¨ç¤ºä¸º <code>(String) -&gt; Int</code>ã€‚ä¸è¿‡ï¼Œæ­¤ä»£ç ä¸ä¼šè°ƒç”¨è¯¥å‡½æ•°ã€‚è¦æ£€ç´¢è¯¥å‡½æ•°çš„ç»“æœï¼Œæ‚¨å¿…é¡»åƒè°ƒç”¨å‘½åå‡½æ•°ä¸€æ ·è°ƒç”¨è¯¥å‡½æ•°ã€‚è°ƒç”¨ stringLengthFunc æ—¶ï¼Œæ‚¨å¿…é¡»æä¾› Stringï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">val</span> stringLengthFunc: (String) -&gt; <span class="hljs-built_in">Int</span> = &#123; input -&gt;<br>        input.length<br>    &#125;<br><br><span class="hljs-keyword">val</span> stringLength: <span class="hljs-built_in">Int</span> = stringLengthFunc(<span class="hljs-string">&quot;Android&quot;</span>)<br></code></pre></td></tr></table></figure></p><h3 id="é«˜é˜¶å‡½æ•°"><a href="#é«˜é˜¶å‡½æ•°" class="headerlink" title="é«˜é˜¶å‡½æ•°"></a>é«˜é˜¶å‡½æ•°</h3><p>ä¸€ä¸ªå‡½æ•°å¯ä»¥å°†å¦ä¸€ä¸ªå‡½æ•°å½“ä½œå‚æ•°ã€‚å°†å…¶ä»–å‡½æ•°ç”¨ä½œå‚æ•°çš„å‡½æ•°ç§°ä¸ºâ€œé«˜é˜¶å‡½æ•°â€ã€‚æ­¤æ¨¡å¼å¯¹ç»„ä»¶ä¹‹é—´çš„é€šä¿¡ï¼ˆå…¶æ–¹å¼ä¸åœ¨ Java ä¸­ä½¿ç”¨å›è°ƒæ¥å£ç›¸åŒï¼‰å¾ˆæœ‰ç”¨ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°çš„ç¤ºä¾‹ï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">stringMapper</span><span class="hljs-params">(str: <span class="hljs-type">String</span>, mapper: (<span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> &#123;<br>        <span class="hljs-comment">// Invoke function</span><br>        <span class="hljs-keyword">return</span> mapper(str)<br>    &#125;<br></code></pre></td></tr></table></figure><br><code>stringMapper()</code> å‡½æ•°æ¥å—ä¸€ä¸ª String ä»¥åŠä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ ¹æ®æ‚¨ä¼ é€’ç»™å®ƒçš„ String æ¥æ¨å¯¼ Int å€¼ã€‚</p><p>è¦è°ƒç”¨ <code>stringMapper()</code>ï¼Œæ‚¨å¯ä»¥ä¼ é€’ä¸€ä¸ª String å’Œä¸€ä¸ªæ»¡è¶³å…¶ä»–è¾“å…¥å‚æ•°çš„å‡½æ•°ï¼ˆå³ï¼Œå°† String å½“ä½œè¾“å…¥å¹¶è¾“å‡º Int çš„å‡½æ•°ï¼‰ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kt">stringMapper(<span class="hljs-string">&quot;Android&quot;</span>, &#123; input -&gt;<br>        input.length<br>    &#125;)<br></code></pre></td></tr></table></figure></p><p>å¦‚æœåŒ¿åå‡½æ•°æ˜¯åœ¨æŸä¸ªå‡½æ•°ä¸Šå®šä¹‰çš„æœ€åä¸€ä¸ªå‚æ•°ï¼Œåˆ™æ‚¨å¯ä»¥åœ¨ç”¨äºè°ƒç”¨è¯¥å‡½æ•°çš„åœ†æ‹¬å·ä¹‹å¤–ä¼ é€’å®ƒï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kt">stringMapper(<span class="hljs-string">&quot;Android&quot;</span>) &#123; input -&gt;<br>        input.length<br>    &#125;<br></code></pre></td></tr></table></figure></p><p>æ‚¨å¯ä»¥åœ¨æ•´ä¸ª Kotlin æ ‡å‡†åº“ä¸­æ‰¾åˆ°åŒ¿åå‡½æ•°ã€‚</p><p>Javaä¸­å¯èƒ½è¦å®šä¹‰æ¥å£æ¥å®ç°ç±»ä¼¼åŠŸèƒ½ã€‚Kotlinä¸­éœ€è¦çš„æ˜¯æ»¡è¶³è¦æ±‚çš„æ–¹æ³•å³å¯ã€‚</p><p>ç¤ºä¾‹ï¼Œåœ¨viewModelä¸­å®šä¹‰å¦‚ä¸‹3ä¸ªå‡½æ•°<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">val</span> stringLengthFunc: (String) -&gt; <span class="hljs-built_in">Int</span> = &#123; inputStr -&gt;<br>    inputStr.length<br>&#125;<br><br><span class="hljs-keyword">val</span> stringLengthDouble: (String) -&gt; <span class="hljs-built_in">Int</span> = &#123; inputStr -&gt;<br>    inputStr.length * <span class="hljs-number">2</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">stringMapper</span><span class="hljs-params">(str: <span class="hljs-type">String</span>, mapper: (<span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> &#123;<br>    <span class="hljs-comment">// è°ƒç”¨ä¼ å…¥çš„æ–¹æ³•</span><br>    <span class="hljs-keyword">return</span> mapper(str)<br>&#125;<br></code></pre></td></tr></table></figure><br>ä½¿ç”¨å‡½æ•°<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">val</span> inputStr = <span class="hljs-string">&quot;Rust Fisher&quot;</span><br><span class="hljs-keyword">var</span> res1: <span class="hljs-built_in">Int</span> = viewModel.stringMapper(inputStr, viewModel.stringLengthFunc)<br><span class="hljs-keyword">var</span> res2: <span class="hljs-built_in">Int</span> = viewModel.stringMapper(inputStr, viewModel.stringLengthDouble)<br></code></pre></td></tr></table></figure></p><h2 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a>ç±»</h2><p>åˆ°ç›®å‰ä¸ºæ­¢æåˆ°çš„æ‰€æœ‰ç±»å‹éƒ½å†…ç½®åœ¨ Kotlin ç¼–ç¨‹è¯­è¨€ä¸­ã€‚å¦‚æœæ‚¨æƒ³è¦æ·»åŠ è‡ªå·±çš„è‡ªå®šä¹‰ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ class å…³é”®å­—æ¥å®šä¹‰ç±»ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span><br></code></pre></td></tr></table></figure></p><p>åƒå‰é¢çš„ä¾‹å­<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">import</span> androidx.lifecycle.ViewModel<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">KotlinGuideViewModel</span> : <span class="hljs-type">ViewModel</span>() &#123;<br><br>    <span class="hljs-keyword">val</span> stringLengthFunc: (String) -&gt; <span class="hljs-built_in">Int</span> = &#123; inputStr -&gt;<br>        inputStr.length<br>    &#125;<br><br>    <span class="hljs-keyword">val</span> stringLengthDouble: (String) -&gt; <span class="hljs-built_in">Int</span> = &#123; inputStr -&gt;<br>        inputStr.length * <span class="hljs-number">2</span><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">stringMapper</span><span class="hljs-params">(str: <span class="hljs-type">String</span>, mapper: (<span class="hljs-type">String</span>) -&gt; <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> &#123;<br>        <span class="hljs-comment">// è°ƒç”¨ä¼ å…¥çš„æ–¹æ³•</span><br>        <span class="hljs-keyword">return</span> mapper(str)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h3><p>ç±»ä½¿ç”¨å±æ€§æ¥è¡¨ç¤ºçŠ¶æ€ã€‚å±æ€§æ˜¯ç±»çº§å˜é‡ï¼Œå¯ä»¥åŒ…å« getterã€setter å’Œåå¤‡å­—æ®µã€‚ç”±äºæ±½è½¦éœ€è¦è½®å­æ¥é©±åŠ¨ï¼Œå› æ­¤æ‚¨å¯ä»¥æ·»åŠ  Wheel å¯¹è±¡çš„åˆ—è¡¨ä½œä¸º Car çš„å±æ€§ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span> &#123;<br>        <span class="hljs-keyword">val</span> wheels = listOf&lt;Wheel&gt;()<br>    &#125;<br></code></pre></td></tr></table></figure><br>è¯·æ³¨æ„ï¼Œwheels æ˜¯ä¸€ä¸ª <code>public val</code>ï¼Œè¿™æ„å‘³ç€ï¼Œå¯ä»¥ä» Car ç±»å¤–éƒ¨è®¿é—® wheelsï¼Œå¹¶ä¸”ä¸èƒ½ä¸ºå…¶é‡æ–°èµ‹å€¼ã€‚<br>å¦‚æœè¦è·å– Car çš„å®ä¾‹ï¼Œæ‚¨å¿…é¡»å…ˆè°ƒç”¨å…¶æ„é€ å‡½æ•°ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ‚¨ä¾¿å¯ä»¥è®¿é—®å®ƒçš„ä»»ä½•å¯è®¿é—®å±æ€§ã€‚<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">val</span> car = Car() <span class="hljs-comment">// construct a Car</span><br>    <span class="hljs-keyword">val</span> wheels = car.wheels <span class="hljs-comment">// retrieve the wheels value from the Car</span><br></code></pre></td></tr></table></figure></p><p>å¦‚æœè¦è‡ªå®šä¹‰è½®å­ï¼Œæ‚¨å¯ä»¥å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰æ„é€ å‡½æ•°ï¼Œç”¨æ¥æŒ‡å®šå¦‚ä½•åˆå§‹åŒ–ç±»å±æ€§ï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span>(<span class="hljs-keyword">val</span> wheels: List&lt;Wheel&gt;)<br></code></pre></td></tr></table></figure></p><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œç±»æ„é€ å‡½æ•°å°† List<Wheel> å½“ä½œæ„é€ å‡½æ•°å‚æ•°ï¼Œå¹¶ä½¿ç”¨è¯¥å‚æ•°æ¥åˆå§‹åŒ–å…¶ wheels å±æ€§ã€‚</p><h3 id="ç±»å‡½æ•°å’Œå°è£…"><a href="#ç±»å‡½æ•°å’Œå°è£…" class="headerlink" title="ç±»å‡½æ•°å’Œå°è£…"></a>ç±»å‡½æ•°å’Œå°è£…</h3><p>ç±»ä½¿ç”¨å‡½æ•°å¯¹è¡Œä¸ºå»ºæ¨¡ã€‚å‡½æ•°å¯ä»¥ä¿®æ”¹çŠ¶æ€ï¼Œä»è€Œå¸®åŠ©æ‚¨åªå…¬å¼€å¸Œæœ›å…¬å¼€çš„æ•°æ®ã€‚è¿™ç§è®¿é—®æ§åˆ¶æœºåˆ¶å±äºä¸€ä¸ªæ›´å¤§çš„é¢å‘å¯¹è±¡çš„æ¦‚å¿µï¼ˆç§°ä¸ºâ€œå°è£…â€ï¼‰ã€‚</p><p>åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼ŒdoorLock å±æ€§å¯¹ Car ç±»å¤–éƒ¨çš„ä¸€åˆ‡éƒ½ä¸å…¬å¼€ã€‚è¦è§£é”æ±½è½¦ï¼Œæ‚¨å¿…é¡»è°ƒç”¨ unlockDoor() å‡½æ•°å¹¶ä¼ å…¥æœ‰æ•ˆçš„â€œé’¥åŒ™â€ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span>(<span class="hljs-keyword">val</span> wheels: List&lt;Wheel&gt;) &#123;<br><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> doorLock: DoorLock = ...<br><br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">unlockDoor</span><span class="hljs-params">(key: <span class="hljs-type">Key</span>)</span></span>: <span class="hljs-built_in">Boolean</span> &#123;<br>            <span class="hljs-comment">// Return true if key is valid for door lock, false otherwise</span><br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure></p><p>å¦‚æœæ‚¨æƒ³è¦è‡ªå®šä¹‰å±æ€§çš„å¼•ç”¨æ–¹å¼ï¼Œåˆ™å¯ä»¥æä¾›è‡ªå®šä¹‰çš„ getter å’Œ setterã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³è¦å…¬å¼€å±æ€§çš„ getter è€Œé™åˆ¶è®¿é—®å…¶ setterï¼Œåˆ™å¯ä»¥å°†è¯¥ setter æŒ‡å®šä¸º privateï¼š<br><figure class="highlight kt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs kt"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Car</span>(<span class="hljs-keyword">val</span> wheels: List&lt;Wheel&gt;) &#123;<br><br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> doorLock: DoorLock = ...<br><br>        <span class="hljs-keyword">val</span> gallonsOfFuelInTank: <span class="hljs-built_in">Int</span> = <span class="hljs-number">15</span><br>            <span class="hljs-keyword">private</span> <span class="hljs-keyword">set</span><br><br>        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">unlockDoor</span><span class="hljs-params">(key: <span class="hljs-type">Key</span>)</span></span>: <span class="hljs-built_in">Boolean</span> &#123;<br>            <span class="hljs-comment">// Return true if key is valid for door lock, false otherwise</span><br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure></p><p>é€šè¿‡ç»“åˆä½¿ç”¨å±æ€§å’Œå‡½æ•°ï¼Œæ‚¨å¯ä»¥åˆ›å»ºèƒ½å¤Ÿå¯¹æ‰€æœ‰ç±»å‹çš„å¯¹è±¡å»ºæ¨¡çš„ç±»ã€‚</p><h2 id="äº’æ“ä½œæ€§"><a href="#äº’æ“ä½œæ€§" class="headerlink" title="äº’æ“ä½œæ€§"></a>äº’æ“ä½œæ€§</h2><p>Kotlin æœ€é‡è¦çš„åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯å®ƒä¸ Java ä¹‹é—´æµç•…çš„äº’æ“ä½œæ€§ã€‚ç”±äº Kotlin ä»£ç å¯ç¼–è¯‘ä¸º JVM å­—èŠ‚ç ï¼Œå› æ­¤ Kotlin ä»£ç å¯ç›´æ¥è°ƒç”¨ Java ä»£ç ï¼Œåä¹‹äº¦ç„¶ã€‚è¿™æ„å‘³ç€ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä» Kotlin åˆ©ç”¨ç°æœ‰çš„ Java åº“ã€‚æ­¤å¤–ï¼Œç»å¤§å¤šæ•° Android API éƒ½æ˜¯ç”¨ Java ç¼–å†™çš„ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä» Kotlin è°ƒç”¨å®ƒä»¬ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Kotlin</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>å¾®ä¿¡å°ç¨‹åº å±…ä¸­å¸ƒå±€css</title>
    <link href="/2020/02/03/Miniprogram/wx-mini-css_center_tutorial/"/>
    <url>/2020/02/03/Miniprogram/wx-mini-css_center_tutorial/</url>
    
    <content type="html"><![CDATA[<p>å±…ä¸­æ”¾ç½®å…ƒç´ æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„éœ€æ±‚ã€‚<br>å¯ä»¥æ°´å¹³å±…ä¸­ï¼Œå‚ç›´å±…ä¸­ã€‚åŒæ—¶æ°´å¹³å’Œå‚ç›´å±…ä¸­ç­‰ç­‰ã€‚<br>åœ¨<a href="https://rustfisher.com/2019/12/20/Android_tutorial_2020/Android-tutorial_2020_RelativeLayout_overview/">Androidçš„RelativeLayout</a>ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>android:layout_centerInParent=&quot;true&quot;</code>ã€‚<br>åœ¨å°ç¨‹åºä¸­æˆ‘ä»¬è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><h2 id="å±…ä¸­ç¤ºä¾‹"><a href="#å±…ä¸­ç¤ºä¾‹" class="headerlink" title="å±…ä¸­ç¤ºä¾‹"></a>å±…ä¸­ç¤ºä¾‹</h2><p>ä¸‹é¢åˆ—ä¸¾å‡ ä¸ªå±…ä¸­çš„ä¾‹å­ã€‚</p><h3 id="æ°´å¹³å±…ä¸­"><a href="#æ°´å¹³å±…ä¸­" class="headerlink" title="æ°´å¹³å±…ä¸­"></a>æ°´å¹³å±…ä¸­</h3><p>wxmlä¸­æ”¾ç½®ä¸€ä¸ªviewã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;flex-center-in-row&quot;</span>&gt;</span><br>  Rust Fisher æ°´å¹³æ–¹å‘å±…ä¸­<br><span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>wxssä¸­çš„classã€‚ä½¿ç”¨äº†flexå¸ƒå±€ï¼Œè®¾ç½®<code>justify-content: center;</code>ã€‚<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.flex-center-in-row</span> &#123;<br>  <span class="hljs-attribute">background</span>: <span class="hljs-number">#eaeaea</span>;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">flex-direction</span>: row;<br>  <span class="hljs-attribute">justify-content</span>: center;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><p><img src="wx_mini_center_in_row.png" alt="æ°´å¹³å±…ä¸­æ•ˆæœå›¾"></p><h3 id="å‚ç›´å±…ä¸­"><a href="#å‚ç›´å±…ä¸­" class="headerlink" title="å‚ç›´å±…ä¸­"></a>å‚ç›´å±…ä¸­</h3><p>å‚ç›´æ–¹å‘å±…ä¸­ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;flex-center-in-column&quot;</span>&gt;</span><br>  Rust Fisher å‚ç›´æ–¹å‘å±…ä¸­<br><span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>ç¡®å®šå®ƒçš„é«˜åº¦ï¼Œè®¾ç½®<code>display: flex; align-items: center;</code>ã€‚<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.flex-center-in-column</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">align-items</span>: center;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><p><img src="wx_mini_center_in_col.png" alt="å‚ç›´å±…ä¸­æ•ˆæœå›¾"></p><h3 id="æ°´å¹³å¹¶ä¸”å‚ç›´å±…ä¸­"><a href="#æ°´å¹³å¹¶ä¸”å‚ç›´å±…ä¸­" class="headerlink" title="æ°´å¹³å¹¶ä¸”å‚ç›´å±…ä¸­"></a>æ°´å¹³å¹¶ä¸”å‚ç›´å±…ä¸­</h3><p>è¦å±…ä¸­ï¼Œéœ€è¦ç¡®å®šå®½å’Œé«˜ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;flex-center-in-cube&quot;</span>&gt;</span><br>  Rust Fisher æ–¹å—å†…å±…ä¸­<br><span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>éœ€è¦è®¾ç½®flexå¸ƒå±€ï¼Œ<code>justify-content: center; align-items: center;</code>ã€‚<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.flex-center-in-cube</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">60px</span>;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">justify-content</span>: center;<br>  <span class="hljs-attribute">align-items</span>: center;<br>&#125;<br></code></pre></td></tr></table></figure></p><p><img src="wx_mini_center_in_cube.png" alt="æ°´å¹³å¹¶ä¸”å‚ç›´å±…ä¸­æ•ˆæœå›¾"></p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ä»ä¸Šé¢çš„å‡ ä¸ªä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå®ƒä»¬éƒ½ç”¨äº†flexå¸ƒå±€ã€‚<br>å‚ç›´å±…ä¸­éœ€è¦è®¾ç½®<code>align-items: center;</code>ï¼›<br>æ°´å¹³å±…ä¸­éœ€è¦è®¾ç½®<code>justify-content: center;</code>ã€‚</p><p>å·¥ç¨‹æ”¾åœ¨ï¼š <a href="https://github.com/AnRFDev/tutorial-miniprogram">https://github.com/AnRFDev/tutorial-miniprogram</a></p><p>æ›´å¤šé˜…è¯»: <a href="https://rustfisher.com/2019/08/10/Dev-note/dev-note-miniapp-all/">å°ç¨‹åºå¼€å‘è®°å½•</a></p><p><img src="css-wid-height-cat.jpeg" alt="width height 100%"></p>]]></content>
    
    
    <categories>
      
      <category>miniprogram</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å°ç¨‹åº</tag>
      
      <tag>css</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android SurfaceView TextureView é¢„è§ˆCameraï¼Œè·å–NV21æ•°æ®</title>
    <link href="/2020/01/11/Android/Android-Camera_SurfaceView_TextureView_get_nv21/"/>
    <url>/2020/01/11/Android/Android-Camera_SurfaceView_TextureView_get_nv21/</url>
    
    <content type="html"><![CDATA[<ul><li>win7</li><li>Android Studio 3.0.1</li></ul><p>æœ¬æ–‡ç›®çš„ï¼šä½¿ç”¨ Camera API è¿›è¡Œè§†é¢‘çš„é‡‡é›†ï¼Œåˆ†åˆ«ä½¿ç”¨ SurfaceViewã€TextureView æ¥é¢„è§ˆ Camera æ•°æ®ï¼Œå–åˆ° NV21 çš„æ•°æ®å›è°ƒ</p><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p>ä½¿ç”¨ç›¸æœºæƒé™<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.CAMERA&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><br>cameraé¢„è§ˆå›è°ƒä¸­é»˜è®¤ä½¿ç”¨NV21æ ¼å¼ã€‚</p><p>æ£€æŸ¥æ‰‹æœºæ˜¯å¦æ”¯æŒæ‘„åƒå¤´ã€‚</p><p>UIå‡†å¤‡<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- å…¨å±æ˜¾ç¤º --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;FullScreenTheme&quot;</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;AppTheme&quot;</span>&gt;</span><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;windowNoTitle&quot;</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:windowFullscreen&quot;</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure><br>æ‰¿è½½é¢„è§ˆå›¾åƒ<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">FrameLayout</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/camera_preview&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure></p><h3 id="ä½¿ç”¨-SurfaceView-é¢„è§ˆ-Cameraï¼Œå–åˆ°NV21æ•°æ®"><a href="#ä½¿ç”¨-SurfaceView-é¢„è§ˆ-Cameraï¼Œå–åˆ°NV21æ•°æ®" class="headerlink" title="ä½¿ç”¨ SurfaceView é¢„è§ˆ Cameraï¼Œå–åˆ°NV21æ•°æ®"></a>ä½¿ç”¨ SurfaceView é¢„è§ˆ Cameraï¼Œå–åˆ°NV21æ•°æ®</h3><p>è‡ªå®šä¹‰<code>CameraPreview</code>ç»§æ‰¿<code>SurfaceView</code>ï¼Œå®ç°<code>SurfaceHolder.Callback</code>æ¥å£</p><p>è·å–NV21æ•°æ®ï¼Œ<code>Camera.setPreviewCallback()</code> è¦æ”¾åœ¨ <code>Camera.startPreview()</code> ä¹‹å‰ã€‚<br>ä½¿ç”¨<code>Camera.PreviewCallback</code>è·å–é¢„è§ˆæ•°æ®å›è°ƒã€‚é»˜è®¤æ˜¯NV21æ ¼å¼ã€‚</p><p><code>surfaceChanged</code>ä¸­ï¼Œcameraå¯åŠ¨é¢„è§ˆå‰å¯ä»¥è¿›è¡Œè®¾ç½®ï¼Œä¾‹å¦‚è®¾ç½®å°ºå¯¸ï¼Œè°ƒæ•´æ–¹å‘<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * cameraé¢„è§ˆè§†å›¾</span><br><span class="hljs-comment"> * Created by Rust on 2018/2/26.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CameraPreview</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SurfaceView</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SurfaceHolder</span>.Callback &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;rustApp&quot;</span>;<br>    <span class="hljs-keyword">private</span> SurfaceHolder mHolder;<br>    <span class="hljs-keyword">private</span> Camera mCamera;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">mFrameCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CameraPreview</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CameraPreview</span><span class="hljs-params">(Context context, Camera camera)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context);<br>        mCamera = camera;<br>        mHolder = getHolder();<br>        mHolder.addCallback(<span class="hljs-built_in">this</span>);<br>        mHolder.setType(SurfaceHolder.SURFACE_TYPE_PUSH_BUFFERS);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCamera</span><span class="hljs-params">(Camera c)</span> &#123;<br>        <span class="hljs-built_in">this</span>.mCamera = c;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">surfaceCreated</span><span class="hljs-params">(SurfaceHolder holder)</span> &#123;<br>        <span class="hljs-comment">// å¼€å¯é¢„è§ˆ</span><br>        <span class="hljs-keyword">try</span> &#123;<br>            mCamera.setPreviewDisplay(holder);<br>            mCamera.startPreview();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;Error setting camera preview: &quot;</span> + e.getMessage());<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">surfaceDestroyed</span><span class="hljs-params">(SurfaceHolder holder)</span> &#123;<br>        <span class="hljs-comment">// å¯åœ¨æ­¤é‡Šæ”¾camera</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">surfaceChanged</span><span class="hljs-params">(SurfaceHolder holder, <span class="hljs-type">int</span> format, <span class="hljs-type">int</span> w, <span class="hljs-type">int</span> h)</span> &#123;<br>        <span class="hljs-comment">// è‹¥éœ€è¦æ—‹è½¬ã€æ›´æ”¹å¤§å°æˆ–é‡æ–°è®¾ç½®ï¼Œè¯·ç¡®ä¿è¯å·²åœæ­¢é¢„è§ˆ</span><br>        <span class="hljs-keyword">if</span> (mHolder.getSurface() == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            mCamera.stopPreview();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-comment">// ignore: tried to stop a non-existent preview</span><br>        &#125;<br>        Camera.<span class="hljs-type">Parameters</span> <span class="hljs-variable">parameters</span> <span class="hljs-operator">=</span> mCamera.getParameters();<br>        <span class="hljs-comment">// ImageFormat.NV21 == 17</span><br>        Log.d(TAG, <span class="hljs-string">&quot;parameters.getPreviewFormat(): &quot;</span> + parameters.getPreviewFormat());<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.getResources().getConfiguration().orientation != Configuration.ORIENTATION_LANDSCAPE) &#123;<br>            mCamera.setDisplayOrientation(<span class="hljs-number">90</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            mCamera.setDisplayOrientation(<span class="hljs-number">0</span>);<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            mCamera.setPreviewDisplay(mHolder);<br>            mCamera.setPreviewCallback(mCameraPreviewCallback); <span class="hljs-comment">// å›è°ƒè¦æ”¾åœ¨ startPreview() ä¹‹å‰</span><br>            mCamera.startPreview();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;Error starting camera preview: &quot;</span> + e.getMessage());<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> Camera.<span class="hljs-type">PreviewCallback</span> <span class="hljs-variable">mCameraPreviewCallback</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Camera</span>.PreviewCallback() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPreviewFrame</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] data, Camera camera)</span> &#123;<br>            mFrameCount++;<br>            Log.d(TAG, <span class="hljs-string">&quot;onPreviewFrame: data.length=&quot;</span> + data.length + <span class="hljs-string">&quot;, frameCount=&quot;</span> + mFrameCount);<br>        &#125;<br>    &#125;;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>ä¸ºäº†é˜²æ­¢é˜»å¡UIçº¿ç¨‹ï¼Œåœ¨å­çº¿ç¨‹ä¸­æ‰“å¼€cameraã€‚cameraå¸¸æ”¾åœ¨try catchä¸­ä½¿ç”¨ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;rustApp&quot;</span>;<br><br>    <span class="hljs-keyword">private</span> Camera mCamera;<br>    <span class="hljs-keyword">private</span> CameraPreview mPreview;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitCameraThread</span>().start();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResume</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == mCamera) &#123;<br>            <span class="hljs-keyword">if</span> (safeCameraOpen()) &#123;<br>                mPreview.setCamera(mCamera); <span class="hljs-comment">// é‡æ–°è·å–cameraæ“ä½œæƒ</span><br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                Log.e(TAG, <span class="hljs-string">&quot;æ— æ³•æ“ä½œcamera&quot;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-built_in">super</span>.onResume();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPause</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onPause();<br>        releaseCamera();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">safeCameraOpen</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">qOpened</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            releaseCamera();<br>            mCamera = Camera.open();<br>            qOpened = (mCamera != <span class="hljs-literal">null</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            Log.e(TAG, <span class="hljs-string">&quot;failed to open Camera&quot;</span>);<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> qOpened;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseCamera</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (mCamera != <span class="hljs-literal">null</span>) &#123;<br>            mCamera.setPreviewCallback(<span class="hljs-literal">null</span>);<br>            mCamera.release();        <span class="hljs-comment">// release the camera for other applications</span><br>            mCamera = <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InitCameraThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-built_in">super</span>.run();<br>            <span class="hljs-keyword">if</span> (safeCameraOpen()) &#123;<br>                Log.d(TAG, <span class="hljs-string">&quot;å¼€å¯æ‘„åƒå¤´&quot;</span>);<br>                runOnUiThread(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                        mPreview = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CameraPreview</span>(MainActivity.<span class="hljs-built_in">this</span>, mCamera);<br>                        <span class="hljs-type">FrameLayout</span> <span class="hljs-variable">preview</span> <span class="hljs-operator">=</span> findViewById(R.id.camera_preview);<br>                        preview.addView(mPreview);<br>                    &#125;<br>                &#125;);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="ä½¿ç”¨-TextureView-é¢„è§ˆ-Cameraï¼Œå–åˆ°NV21æ•°æ®"><a href="#ä½¿ç”¨-TextureView-é¢„è§ˆ-Cameraï¼Œå–åˆ°NV21æ•°æ®" class="headerlink" title="ä½¿ç”¨ TextureView é¢„è§ˆ Cameraï¼Œå–åˆ°NV21æ•°æ®"></a>ä½¿ç”¨ TextureView é¢„è§ˆ Cameraï¼Œå–åˆ°NV21æ•°æ®</h3><p><code>TextureView</code>å¯ç”¨äºæ˜¾ç¤ºå†…å®¹æµã€‚å†…å®¹æµå¯ä»¥æ˜¯è§†é¢‘æˆ–è€…OpenGLçš„åœºæ™¯ã€‚å†…å®¹æµå¯æ¥è‡ªåº”ç”¨è¿›ç¨‹æˆ–æ˜¯è¿œç¨‹å…¶å®ƒè¿›ç¨‹ã€‚</p><p><code>Textureview</code>å¿…é¡»åœ¨ç¡¬ä»¶åŠ é€Ÿå¼€å¯çš„çª—å£ä¸­ä½¿ç”¨ã€‚è‹¥æ˜¯è½¯è§£ï¼Œ<code>TextureView</code>ä¸ä¼šæ˜¾ç¤ºä¸œè¥¿ã€‚</p><p>ä¸åŒäº<code>SurfaceView</code>ï¼Œ<code>TextureView</code>ä¸ä¼šå»ºç«‹ä¸€ä¸ªå•ç‹¬çš„çª—å£ï¼Œè€Œæ˜¯åƒä¸€ä¸ªå¸¸è§„çš„Viewä¸€æ ·ï¼ˆä¸ªäººè®¤ä¸ºè¿™æ˜¯ä¸ªä¼˜ç‚¹ï¼‰ã€‚<br>è¿™ä½¿å¾—<code>TextureView</code>å¯ä»¥è¢«ç§»åŠ¨ï¼Œè½¬æ¢æˆ–æ˜¯æ·»åŠ åŠ¨ç”»ã€‚æ¯”å¦‚ï¼Œå¯ä»¥è°ƒç”¨<code>myView.setAlpha(0.5f)</code>å°†å…¶è®¾ç½®æˆåŠé€æ˜ã€‚</p><p>ä½¿ç”¨<code>TextureView</code>å¾ˆç®€å•ï¼šè·å–åˆ°å®ƒçš„<code>SurfaceTexture</code>ï¼Œä½¿ç”¨<code>SurfaceTexture</code>å‘ˆç°å†…å®¹ã€‚</p><p><code>CameraPreview</code>ç»§æ‰¿äº†<code>TextureView</code>ï¼Œå¤–éƒ¨éœ€è¦ä¼ å…¥cameraå®ä¾‹ã€‚åœ¨<code>onSurfaceTextureAvailable</code>ä¸­ï¼Œé…ç½®cameraï¼Œæ¯”å¦‚è®¾ç½®å›¾åƒæ–¹å‘ã€‚<br>é€šè¿‡è®¾ç½®<code>Camera.PreviewCallback</code>æ¥å–å¾—é¢„è§ˆæ•°æ®ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> android.content.Context;<br><span class="hljs-keyword">import</span> android.content.res.Configuration;<br><span class="hljs-keyword">import</span> android.graphics.SurfaceTexture;<br><span class="hljs-keyword">import</span> android.hardware.Camera;<br><span class="hljs-keyword">import</span> android.util.Log;<br><span class="hljs-keyword">import</span> android.view.TextureView;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CameraPreview</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">TextureView</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TextureView</span>.SurfaceTextureListener &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;rustApp&quot;</span>;<br>    <span class="hljs-keyword">private</span> Camera mCamera;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CameraPreview</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CameraPreview</span><span class="hljs-params">(Context context, Camera camera)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context);<br>        mCamera = camera;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setCamera</span><span class="hljs-params">(Camera camera)</span> &#123;<br>        <span class="hljs-built_in">this</span>.mCamera = camera;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSurfaceTextureAvailable</span><span class="hljs-params">(SurfaceTexture surface, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;TextureView onSurfaceTextureAvailable&quot;</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.getResources().getConfiguration().orientation != Configuration.ORIENTATION_LANDSCAPE) &#123;<br>            mCamera.setDisplayOrientation(<span class="hljs-number">90</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            mCamera.setDisplayOrientation(<span class="hljs-number">0</span>);<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            mCamera.setPreviewCallback(mCameraPreviewCallback);<br>            mCamera.setPreviewTexture(surface); <span class="hljs-comment">// ä½¿ç”¨SurfaceTexture</span><br>            mCamera.startPreview();<br>        &#125; <span class="hljs-keyword">catch</span> (IOException ioe) &#123;<br>            <span class="hljs-comment">// Something bad happened</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSurfaceTextureSizeChanged</span><span class="hljs-params">(SurfaceTexture surface, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;TextureView onSurfaceTextureSizeChanged&quot;</span>); <span class="hljs-comment">// Ignored, Camera does all the work for us</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onSurfaceTextureDestroyed</span><span class="hljs-params">(SurfaceTexture surface)</span> &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;TextureView onSurfaceTextureDestroyed&quot;</span>);<br>        mCamera.stopPreview();<br>        mCamera.release();<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSurfaceTextureUpdated</span><span class="hljs-params">(SurfaceTexture surface)</span> &#123;<br>        <span class="hljs-comment">// Invoked every time there&#x27;s a new Camera preview frame</span><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> Camera.<span class="hljs-type">PreviewCallback</span> <span class="hljs-variable">mCameraPreviewCallback</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Camera</span>.PreviewCallback() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPreviewFrame</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] data, Camera camera)</span> &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;onPreviewFrame: data.length=&quot;</span> + data.length);<br>        &#125;<br>    &#125;;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>æ“ä½œç•Œé¢<code>TextureAct</code>ã€‚è·å–cameraæ“ä½œæƒï¼Œåˆå§‹åŒ–<code>CameraPreview</code>å¹¶æ·»åŠ åˆ°å¸ƒå±€ä¸­ã€‚ç¬¬ä¸€æ¬¡è·å–cameraæ—¶åœ¨å­çº¿ç¨‹ä¸­æ“ä½œã€‚</p><p>åœ¨<code>onPause</code>ä¸­é‡Šæ”¾cameraï¼Œ<code>onResume</code>ä¸­å°è¯•å–å›cameraæ§åˆ¶æƒã€‚è¿™æ ·åº”ç”¨æš‚æ—¶é€€å›åå°æ—¶ï¼Œå…¶ä»–åº”ç”¨å¯ä»¥æ“ä½œæ‘„åƒå¤´ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TextureAct</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;rustApp&quot;</span>;<br>    <span class="hljs-keyword">private</span> Camera mCamera;<br>    <span class="hljs-keyword">private</span> CameraPreview mPreview;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_texture);<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitCameraThread</span>().start();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResume</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == mCamera) &#123;<br>            <span class="hljs-keyword">if</span> (safeCameraOpen()) &#123;<br>                mPreview.setCamera(mCamera); <span class="hljs-comment">// é‡æ–°è·å–cameraæ“ä½œæƒ</span><br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                Log.e(TAG, <span class="hljs-string">&quot;æ— æ³•æ“ä½œcamera&quot;</span>);<br>            &#125;<br>        &#125;<br>        <span class="hljs-built_in">super</span>.onResume();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPause</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onPause();<br>        releaseCamera();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onDestroy();<br>        releaseCamera();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">safeCameraOpen</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">qOpened</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            releaseCamera();<br>            mCamera = Camera.open();<br>            qOpened = (mCamera != <span class="hljs-literal">null</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            Log.e(TAG, <span class="hljs-string">&quot;failed to open Camera&quot;</span>);<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> qOpened;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseCamera</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (mCamera != <span class="hljs-literal">null</span>) &#123;<br>            mCamera.setPreviewCallback(<span class="hljs-literal">null</span>);<br>            mCamera.release();        <span class="hljs-comment">// release the camera for other applications</span><br>            mCamera = <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InitCameraThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-built_in">super</span>.run();<br>            <span class="hljs-keyword">if</span> (safeCameraOpen()) &#123;<br>                Log.d(TAG, <span class="hljs-string">&quot;TextureAct å¼€å¯æ‘„åƒå¤´&quot;</span>);<br>                runOnUiThread(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                        mPreview = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CameraPreview</span>(TextureAct.<span class="hljs-built_in">this</span>, mCamera);<br>                        mPreview.setSurfaceTextureListener(mPreview);<br>                        <span class="hljs-type">FrameLayout</span> <span class="hljs-variable">preview</span> <span class="hljs-operator">=</span> findViewById(R.id.camera_preview);<br>                        preview.addView(mPreview);<br>                    &#125;<br>                &#125;);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br><code>Textureview</code>å¿…é¡»åœ¨ç¡¬ä»¶åŠ é€Ÿå¼€å¯çš„çª—å£ä¸­ä½¿ç”¨ã€‚<code>android:hardwareAccelerated=&quot;true&quot;</code> é»˜è®¤çš„è¿™ä¸ªå±æ€§å°±æ˜¯trueï¼Œæ— éœ€å†è®¾ç½®ã€‚</p><p>æ¯æ¥åˆ°ä¸€å¸§æ•°æ®ï¼Œå°±ä¼šè°ƒç”¨ä¸€æ¬¡<code>onSurfaceTextureUpdated()</code>ã€‚é€šè¿‡è¿™ä¸ªæ¥å£ã€‚èƒ½å¤Ÿå°†ä¸Šæ¥çš„SurfaceTextureé€ç»™OpenGLå†å»å¤„ç†ã€‚</p><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul><li><a href="https://developer.android.com/training/camera/cameradirect.html">Controlling the Camera - Android Developer</a></li><li><a href="https://developer.android.com/guide/topics/media/camera.html">Camera API - Android Developer</a></li><li><a href="https://developer.android.com/reference/android/view/TextureView.html">TextureView - Android Developer</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android_Media</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android Camera API éŸ³è§†é¢‘é‡‡é›†ã€ç¼–ç ã€å°åŒ…æˆmp4</title>
    <link href="/2020/01/11/Android/Android-Camera_record_video_and_output/"/>
    <url>/2020/01/11/Android/Android-Camera_record_video_and_output/</url>
    
    <content type="html"><![CDATA[<ul><li>win7</li><li>Android Studio 3.0.1</li></ul><p>ç›¸å…³ä»£ç è¯·å‚é˜…ï¼š <a href="https://github.com/RustFisher/android-CameraRecorder">https://github.com/RustFisher/android-CameraRecorder</a></p><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>æœ¬æ–‡ç›®çš„ï¼šä½¿ç”¨ Android Camera API å®ŒæˆéŸ³è§†é¢‘çš„é‡‡é›†ã€ç¼–ç ã€å°åŒ…æˆ mp4 è¾“å‡º</p><p>åŸºäº<code>android.hardware.Camera</code>ï¼Œåˆ›å»ºä¸€ä¸ªæ¨ªå±åº”ç”¨ï¼Œå®æ—¶é¢„è§ˆæ‘„åƒå¤´å›¾åƒï¼Œå®ç°å½•åƒå¹¶è¾“å‡ºMP4çš„åŠŸèƒ½ã€‚<br>è¿™é‡Œä¸ä½¿ç”¨Camera2ã€‚</p><h2 id="ç”³è¯·æƒé™"><a href="#ç”³è¯·æƒé™" class="headerlink" title="ç”³è¯·æƒé™"></a>ç”³è¯·æƒé™</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- éœ€è¦å½•åˆ¶éŸ³è§†é¢‘æƒé™å’Œå†™å¤–éƒ¨å­˜å‚¨æƒé™ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.RECORD_AUDIO&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.CAMERA&quot;</span> /&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">uses-feature</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.hardware.camera&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><p>åœ¨activityä¸­åŠ¨æ€ç”³è¯·æƒé™<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] VIDEO_PERMISSIONS = &#123;<br>        Manifest.permission.CAMERA,<br>        Manifest.permission.RECORD_AUDIO,<br>        Manifest.permission.WRITE_EXTERNAL_STORAGE<br>&#125;;<br></code></pre></td></tr></table></figure></p><h2 id="å®ç°æ‘„åƒå¤´é¢„è§ˆåŠŸèƒ½"><a href="#å®ç°æ‘„åƒå¤´é¢„è§ˆåŠŸèƒ½" class="headerlink" title="å®ç°æ‘„åƒå¤´é¢„è§ˆåŠŸèƒ½"></a>å®ç°æ‘„åƒå¤´é¢„è§ˆåŠŸèƒ½</h2><p>ä½¿ç”¨<code>SurfaceView</code>æ¥é¢„è§ˆã€‚æ–°å»º<code>CameraPreview</code>ç±»ç»§æ‰¿è‡ª<code>SurfaceView</code>å¹¶å®ç°<code>SurfaceHolder.Callback</code>ï¼›<br>cameraç›¸å…³æ“ä½œéƒ½æ”¾åœ¨è¿™ä¸ªViewé‡Œã€‚</p><ul><li><code>surfaceCreated</code>ä¸­è·å–Cameraå®ä¾‹ï¼Œå¯åŠ¨é¢„è§ˆï¼›è®¾ç½®é¢„è§ˆç›¸å…³å‚æ•°</li><li><code>surfaceDestroyed</code>é‡Šæ”¾Camera</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CameraPreview</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SurfaceView</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SurfaceHolder</span>.Callback &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;rustAppCameraPreview&quot;</span>;<br>    <span class="hljs-keyword">private</span> SurfaceHolder mHolder;<br>    <span class="hljs-keyword">private</span> Camera mCamera;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MEDIA_TYPE_IMAGE</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MEDIA_TYPE_VIDEO</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">mOptVideoWidth</span> <span class="hljs-operator">=</span> <span class="hljs-number">1920</span>;  <span class="hljs-comment">// é»˜è®¤è§†é¢‘å¸§å®½åº¦</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">mOptVideoHeight</span> <span class="hljs-operator">=</span> <span class="hljs-number">1080</span>;<br>    <span class="hljs-keyword">private</span> Uri outputMediaFileUri;<br>    <span class="hljs-keyword">private</span> String outputMediaFileType;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CameraPreview</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context);<br>        mHolder = getHolder();<br>        mHolder.addCallback(<span class="hljs-built_in">this</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Camera <span class="hljs-title function_">getCameraInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">Camera</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            c = Camera.open();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;camera is not available&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> c;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">surfaceCreated</span><span class="hljs-params">(SurfaceHolder holder)</span> &#123;<br>        mCamera = getCameraInstance();<br>        <span class="hljs-keyword">try</span> &#123;<br>            mCamera.setPreviewDisplay(holder);<br>            mCamera.startPreview();<br>            getCameraOptimalVideoSize(); <span class="hljs-comment">// æ‰¾åˆ°æœ€åˆé€‚çš„åˆ†è¾¨ç‡</span><br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;Error setting camera preview: &quot;</span> + e.getMessage());<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getCameraOptimalVideoSize</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Camera.<span class="hljs-type">Parameters</span> <span class="hljs-variable">parameters</span> <span class="hljs-operator">=</span> mCamera.getParameters();<br>            List&lt;Camera.Size&gt; mSupportedPreviewSizes = parameters.getSupportedPreviewSizes();<br>            List&lt;Camera.Size&gt; mSupportedVideoSizes = parameters.getSupportedVideoSizes();<br>            Camera.<span class="hljs-type">Size</span> <span class="hljs-variable">optimalSize</span> <span class="hljs-operator">=</span> CameraHelper.getOptimalVideoSize(mSupportedVideoSizes,<br>                    mSupportedPreviewSizes, getWidth(), getHeight());<br>            mOptVideoWidth = optimalSize.width;<br>            mOptVideoHeight = optimalSize.height;<br>            Log.d(TAG, <span class="hljs-string">&quot;prepareVideoRecorder: optimalSize:&quot;</span> + mOptVideoWidth + <span class="hljs-string">&quot;, &quot;</span> + mOptVideoHeight);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            Log.e(TAG, <span class="hljs-string">&quot;getCameraOptimalVideoSize: &quot;</span>, e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">surfaceDestroyed</span><span class="hljs-params">(SurfaceHolder holder)</span> &#123;<br>        mHolder.removeCallback(<span class="hljs-built_in">this</span>);<br>        mCamera.setPreviewCallback(<span class="hljs-literal">null</span>);<br>        mCamera.stopPreview();<br>        mCamera.release();<br>        mCamera = <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">surfaceChanged</span><span class="hljs-params">(SurfaceHolder holder, <span class="hljs-type">int</span> format, <span class="hljs-type">int</span> w, <span class="hljs-type">int</span> h)</span> &#123;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="åœ¨Fragmentä¸­æ˜¾ç¤ºæ‘„åƒå¤´é¢„è§ˆ"><a href="#åœ¨Fragmentä¸­æ˜¾ç¤ºæ‘„åƒå¤´é¢„è§ˆ" class="headerlink" title="åœ¨Fragmentä¸­æ˜¾ç¤ºæ‘„åƒå¤´é¢„è§ˆ"></a>åœ¨Fragmentä¸­æ˜¾ç¤ºæ‘„åƒå¤´é¢„è§ˆ</h3><p>é¢„ç½®ä¸€ä¸ªFrameLayoutï¼Œå®ä¾‹åŒ–ä¸€ä¸ª<code>CameraPreview</code>æ·»åŠ è¿›å»<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è§†é¢‘å½•åˆ¶ç•Œé¢</span><br><span class="hljs-comment"> * Created by Rust on 2018/5/17.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoRecordFragment</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Fragment</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;rustAppVideoFrag&quot;</span>;<br><br>    <span class="hljs-keyword">private</span> Button mCaptureBtn;<br>    <span class="hljs-keyword">private</span> CameraPreview mCameraPreview;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> VideoRecordFragment <span class="hljs-title function_">newInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VideoRecordFragment</span>();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        Log.d(TAG, <span class="hljs-string">&quot;frag onCreate&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Nullable</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> View <span class="hljs-title function_">onCreateView</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> LayoutInflater inflater, <span class="hljs-meta">@Nullable</span> ViewGroup container, <span class="hljs-meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;frag onCreateView&quot;</span>);<br>        <span class="hljs-keyword">return</span> inflater.inflate(R.layout.frag_video_record, container, <span class="hljs-literal">false</span>);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onViewCreated</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> View view, <span class="hljs-meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;frag onViewCreated&quot;</span>);<br>        <span class="hljs-built_in">super</span>.onViewCreated(view, savedInstanceState);<br>        mCaptureBtn = view.findViewById(R.id.capture_btn);<br>        <span class="hljs-comment">//mCaptureBtn.setOnClickListener(mOnClickListener);// å½•åˆ¶é”®</span><br><br>        mCameraPreview = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CameraPreview</span>(getContext());<br>        <span class="hljs-type">FrameLayout</span> <span class="hljs-variable">preview</span> <span class="hljs-operator">=</span> view.findViewById(R.id.camera_preview);<br>        preview.addView(mCameraPreview);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><h2 id="ä½¿ç”¨MediaRecorderå½•åˆ¶"><a href="#ä½¿ç”¨MediaRecorderå½•åˆ¶" class="headerlink" title="ä½¿ç”¨MediaRecorderå½•åˆ¶"></a>ä½¿ç”¨<code>MediaRecorder</code>å½•åˆ¶</h2><p>ç»™<code>MediaRecorder</code>æŒ‡å®šå‚æ•°åï¼Œè°ƒç”¨<code>start()</code>å¼€å§‹å½•åˆ¶ï¼Œ<code>stop()</code>ç»“æŸå½•åˆ¶</p><p>å½•åˆ¶å¼€å§‹å‰ï¼Œè·å–cameraï¼Œ<code>mCamera.unlock()</code>è§£é”ï¼›å½•åˆ¶å®Œæ¯•åï¼Œæ¸…é™¤<code>MediaRecorder</code>ï¼Œ<code>mCamera.lock()</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> MediaRecorder mMediaRecorder;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">startRecording</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (prepareVideoRecorder()) &#123;<br>            mMediaRecorder.start();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            releaseMediaRecorder();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stopRecording</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (mMediaRecorder != <span class="hljs-literal">null</span>) &#123;<br>            mMediaRecorder.stop();<br>        &#125;<br>        releaseMediaRecorder();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isRecording</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> mMediaRecorder != <span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">prepareVideoRecorder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == mCamera) &#123;<br>            mCamera = getCameraInstance();<br>        &#125;<br>        mMediaRecorder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaRecorder</span>();<br><br>        mCamera.unlock();<br>        mMediaRecorder.setCamera(mCamera);<br><br>        mMediaRecorder.setAudioSource(MediaRecorder.AudioSource.DEFAULT);<br>        mMediaRecorder.setVideoSource(MediaRecorder.VideoSource.CAMERA);<br><br>        mMediaRecorder.setProfile(CamcorderProfile.get(CamcorderProfile.QUALITY_HIGH));<br><br>        mMediaRecorder.setVideoSize(mOptVideoWidth, mOptVideoHeight);<br>        mMediaRecorder.setOutputFile(getOutputMediaFile(MEDIA_TYPE_VIDEO).toString());<br>        mMediaRecorder.setPreviewDisplay(mHolder.getSurface());<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            mMediaRecorder.prepare();<br>        &#125; <span class="hljs-keyword">catch</span> (IllegalStateException e) &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;IllegalStateException preparing MediaRecorder: &quot;</span> + e.getMessage());<br>            releaseMediaRecorder();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;IOException preparing MediaRecorder: &quot;</span> + e.getMessage());<br>            releaseMediaRecorder();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseMediaRecorder</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (mMediaRecorder != <span class="hljs-literal">null</span>) &#123;<br>            mMediaRecorder.reset();<br>            mMediaRecorder.release();<br>            mMediaRecorder = <span class="hljs-literal">null</span>;<br>            mCamera.lock();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> File <span class="hljs-title function_">getOutputMediaFile</span><span class="hljs-params">(<span class="hljs-type">int</span> type)</span> &#123;<br>        <span class="hljs-type">File</span> <span class="hljs-variable">mediaStorageDir</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(Environment.getExternalStoragePublicDirectory(<br>                Environment.DIRECTORY_PICTURES), TAG);<br>        <span class="hljs-keyword">if</span> (!mediaStorageDir.exists()) &#123;<br>            <span class="hljs-keyword">if</span> (!mediaStorageDir.mkdirs()) &#123;<br>                Log.d(TAG, <span class="hljs-string">&quot;failed to create directory&quot;</span>);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">timeStamp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyyMMdd_HHmmss&quot;</span>, Locale.CHINA).format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        File mediaFile;<br>        <span class="hljs-keyword">if</span> (type == MEDIA_TYPE_IMAGE) &#123;<br>            mediaFile = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(mediaStorageDir.getPath() + File.separator +<br>                    <span class="hljs-string">&quot;IMG_&quot;</span> + timeStamp + <span class="hljs-string">&quot;.jpg&quot;</span>);<br>            outputMediaFileType = <span class="hljs-string">&quot;image/*&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == MEDIA_TYPE_VIDEO) &#123;<br>            mediaFile = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(mediaStorageDir.getPath() + File.separator +<br>                    <span class="hljs-string">&quot;VID_&quot;</span> + timeStamp + <span class="hljs-string">&quot;.mp4&quot;</span>);<br>            outputMediaFileType = <span class="hljs-string">&quot;video/*&quot;</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        outputMediaFileUri = Uri.fromFile(mediaFile);<br>        <span class="hljs-keyword">return</span> mediaFile;<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="åå°è¿”å›æ—¶é¢„è§ˆé»‘å±çš„é—®é¢˜"><a href="#åå°è¿”å›æ—¶é¢„è§ˆé»‘å±çš„é—®é¢˜" class="headerlink" title="åå°è¿”å›æ—¶é¢„è§ˆé»‘å±çš„é—®é¢˜"></a>åå°è¿”å›æ—¶é¢„è§ˆé»‘å±çš„é—®é¢˜</h3><p><code>CameraPreview</code>æ˜¯æˆ‘ä»¬åœ¨Fragmentåˆ›å»ºæ—¶å®ä¾‹åŒ–å¹¶æ·»åŠ è¿›å»çš„ã€‚<br>åº”ç”¨é€€åˆ°åå°åï¼Œ<code>CameraPreview</code>å·²ç»è¢«é”€æ¯ã€‚åº”ç”¨å›åˆ°å‰å°æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨<code>onResume</code>æ–¹æ³•ä¸­è¿›è¡Œæ“ä½œã€‚æ¢å¤<code>CameraPreview</code>ã€‚</p><p>åœ¨Fragmentä¸­ï¼Œåˆ¤æ–­é”€æ¯å’Œé‡å»ºé¢„è§ˆçš„æ—¶æœºã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPause</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-built_in">super</span>.onPause();<br>    Log.d(TAG, <span class="hljs-string">&quot;onPause: é”€æ¯é¢„è§ˆ&quot;</span>);<br>    mCameraPreview = <span class="hljs-literal">null</span>;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResume</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-built_in">super</span>.onResume();<br>    Log.d(TAG, <span class="hljs-string">&quot;onResume: å›åˆ°å‰å°&quot;</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == mCameraPreview) &#123;<br>        initCameraPreview();<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initCameraPreview</span><span class="hljs-params">()</span> &#123;<br>    mCameraPreview = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CameraPreview</span>(getContext());<br>    <span class="hljs-type">FrameLayout</span> <span class="hljs-variable">preview</span> <span class="hljs-operator">=</span> mRoot.findViewById(R.id.camera_preview);<br>    preview.addView(mCameraPreview);<br>&#125;<br><br></code></pre></td></tr></table></figure></p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://www.polarxiong.com/archives/Android%E7%9B%B8%E6%9C%BA%E5%BC%80%E5%8F%91-%E4%B8%89-%E5%AE%9E%E7%8E%B0%E6%8B%8D%E7%85%A7%E5%BD%95%E5%83%8F%E5%92%8C%E6%9F%A5%E7%9C%8B.html">Androidç›¸æœºå¼€å‘(ä¸‰): å®ç°æ‹ç…§å½•åƒå’ŒæŸ¥çœ‹</a></li><li><a href="https://github.com/googlesamples/android-MediaRecorder">googlesamples/android-MediaRecorder</a></li><li><a href="https://developer.android.com/training/camera/cameradirect.html">Controlling the Camera - Android Developer</a></li><li><a href="https://developer.android.com/guide/topics/media/camera.html">Camera API - Android Developer</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Android éŸ³é¢‘PCMæ•°æ®çš„é‡‡é›†å’Œæ’­æ”¾ï¼Œè¯»å†™éŸ³é¢‘wavæ–‡ä»¶</title>
    <link href="/2020/01/10/Android/Android-AudioRecord_AudioTrack_pcm_wav/"/>
    <url>/2020/01/10/Android/Android-AudioRecord_AudioTrack_pcm_wav/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ç›®çš„ï¼šä½¿ç”¨ AudioRecord å’Œ AudioTrack å®ŒæˆéŸ³é¢‘PCMæ•°æ®çš„é‡‡é›†å’Œæ’­æ”¾ï¼Œå¹¶è¯»å†™éŸ³é¢‘wavæ–‡ä»¶</p><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>Androidæä¾›äº†AudioRecordå’ŒMediaRecordã€‚MediaRecordå¯é€‰æ‹©å½•éŸ³çš„æ ¼å¼ã€‚<br>AudioRecordå¾—åˆ°PCMç¼–ç æ ¼å¼çš„æ•°æ®ã€‚AudioRecordèƒ½å¤Ÿè®¾ç½®æ¨¡æ‹Ÿä¿¡å·è½¬åŒ–ä¸ºæ•°å­—ä¿¡å·çš„ç›¸å…³å‚æ•°ï¼ŒåŒ…æ‹¬é‡‡æ ·ç‡å’Œé‡åŒ–æ·±åº¦ï¼ŒåŒæ—¶ä¹ŸåŒ…æ‹¬é€šé“æ•°ç›®ç­‰ã€‚</p><h3 id="PCM"><a href="#PCM" class="headerlink" title="PCM"></a>PCM</h3><p>PCMæ˜¯åœ¨ç”±æ¨¡æ‹Ÿä¿¡å·å‘æ•°å­—ä¿¡å·è½¬åŒ–çš„ä¸€ç§å¸¸ç”¨çš„ç¼–ç æ ¼å¼ï¼Œç§°ä¸ºè„‰å†²ç¼–ç è°ƒåˆ¶ï¼ŒPCMå°†æ¨¡æ‹Ÿä¿¡å·æŒ‰ç…§ä¸€å®šçš„é—´è·åˆ’åˆ†ä¸ºå¤šæ®µï¼Œç„¶åé€šè¿‡äºŒè¿›åˆ¶å»é‡åŒ–æ¯ä¸€ä¸ªé—´è·çš„å¼ºåº¦ã€‚<br>PCMè¡¨ç¤ºçš„æ˜¯éŸ³é¢‘æ–‡ä»¶ä¸­éšç€æ—¶é—´çš„æµé€çš„ä¸€æ®µéŸ³é¢‘çš„æŒ¯å¹…ã€‚Androidåœ¨WAVæ–‡ä»¶ä¸­æ”¯æŒPCMçš„éŸ³é¢‘æ•°æ®ã€‚</p><h3 id="WAV"><a href="#WAV" class="headerlink" title="WAV"></a>WAV</h3><p>WAVï¼ŒMP3ç­‰æ¯”è¾ƒå¸¸è§çš„éŸ³é¢‘æ ¼å¼ï¼Œä¸åŒçš„ç¼–ç æ ¼å¼å¯¹åº”ä¸é€šè¿‡çš„åŸå§‹éŸ³é¢‘ã€‚ä¸ºäº†æ–¹ä¾¿ä¼ è¾“ï¼Œé€šå¸¸ä¼šå‹ç¼©åŸå§‹éŸ³é¢‘ã€‚<br>ä¸ºäº†è¾¨åˆ«å‡ºéŸ³é¢‘æ ¼å¼ï¼Œæ¯ç§æ ¼å¼æœ‰ç‰¹å®šçš„å¤´æ–‡ä»¶ï¼ˆheaderï¼‰ã€‚<br>WAVä»¥RIFFä¸ºæ ‡å‡†ã€‚RIFFæ˜¯ä¸€ç§èµ„æºäº¤æ¢æ¡£æ¡ˆæ ‡å‡†ã€‚RIFFå°†æ–‡ä»¶å­˜å‚¨åœ¨æ¯ä¸€ä¸ªæ ‡è®°å—ä¸­ã€‚<br>åŸºæœ¬æ„æˆå•ä½æ˜¯trunkï¼Œæ¯ä¸ªtrunkç”±æ ‡è®°ä½ï¼Œæ•°æ®å¤§å°ï¼Œæ•°æ®å­˜å‚¨ï¼Œä¸‰ä¸ªéƒ¨åˆ†æ„æˆã€‚ </p><h3 id="PCMæ‰“åŒ…æˆWAV"><a href="#PCMæ‰“åŒ…æˆWAV" class="headerlink" title="PCMæ‰“åŒ…æˆWAV"></a>PCMæ‰“åŒ…æˆWAV</h3><p>PCMæ˜¯åŸå§‹éŸ³é¢‘æ•°æ®ï¼ŒWAVæ˜¯windowsä¸­å¸¸è§çš„éŸ³é¢‘æ ¼å¼ï¼Œåªæ˜¯åœ¨pcmæ•°æ®ä¸­æ·»åŠ äº†ä¸€ä¸ªæ–‡ä»¶å¤´ã€‚</p><table><thead><tr><th style="text-align:left">èµ·å§‹åœ°å€</th><th style="text-align:left">å ç”¨ç©ºé—´</th><th style="text-align:left">æœ¬åœ°å€æ•°å­—çš„å«ä¹‰</th></tr></thead><tbody><tr><td style="text-align:left">00H</td><td style="text-align:left">4byte</td><td style="text-align:left">RIFFï¼Œèµ„æºäº¤æ¢æ–‡ä»¶æ ‡å¿—ã€‚</td></tr><tr><td style="text-align:left">04H</td><td style="text-align:left">4byte</td><td style="text-align:left">ä»ä¸‹ä¸€ä¸ªåœ°å€å¼€å§‹åˆ°æ–‡ä»¶å°¾çš„æ€»å­—èŠ‚æ•°ã€‚é«˜ä½å­—èŠ‚åœ¨åé¢ï¼Œè¿™é‡Œå°±æ˜¯001437ECHï¼Œæ¢æˆåè¿›åˆ¶æ˜¯1325036byteï¼Œç®—ä¸Šè¿™ä¹‹å‰çš„8byteå°±æ­£å¥½1325044byteäº†ã€‚</td></tr><tr><td style="text-align:left">08H</td><td style="text-align:left">4byte</td><td style="text-align:left">WAVEï¼Œä»£è¡¨wavæ–‡ä»¶æ ¼å¼ã€‚</td></tr><tr><td style="text-align:left">0CH</td><td style="text-align:left">4byte</td><td style="text-align:left">FMT ï¼Œæ³¢å½¢æ ¼å¼æ ‡å¿—</td></tr><tr><td style="text-align:left">10H</td><td style="text-align:left">4byte</td><td style="text-align:left">00000010Hï¼Œ16PCMï¼Œæˆ‘çš„ç†è§£æ˜¯ç”¨16bitçš„æ•°æ®è¡¨ç¤ºä¸€ä¸ªé‡åŒ–ç»“æœã€‚</td></tr><tr><td style="text-align:left">14H</td><td style="text-align:left">2byte</td><td style="text-align:left">ä¸º1æ—¶è¡¨ç¤ºçº¿æ€§PCMç¼–ç ï¼Œå¤§äº1æ—¶è¡¨ç¤ºæœ‰å‹ç¼©çš„ç¼–ç ã€‚è¿™é‡Œæ˜¯0001Hã€‚</td></tr><tr><td style="text-align:left">16H</td><td style="text-align:left">2byte</td><td style="text-align:left">1ä¸ºå•å£°é“ï¼Œ2ä¸ºåŒå£°é“ï¼Œè¿™é‡Œæ˜¯0001Hã€‚</td></tr><tr><td style="text-align:left">18H</td><td style="text-align:left">4byte</td><td style="text-align:left">é‡‡æ ·é¢‘ç‡ï¼Œè¿™é‡Œæ˜¯00002B11Hï¼Œä¹Ÿå°±æ˜¯11025Hzã€‚</td></tr><tr><td style="text-align:left">1CH</td><td style="text-align:left">4byte</td><td style="text-align:left">Byteç‡=<code>é‡‡æ ·é¢‘ç‡*éŸ³é¢‘é€šé“æ•°*æ¯æ¬¡é‡‡æ ·å¾—åˆ°çš„æ ·æœ¬ä½æ•°/8</code>ï¼Œ00005622Hï¼Œä¹Ÿå°±æ˜¯<code>22050Byte/s=11025*1*16/2</code></td></tr><tr><td style="text-align:left">20H</td><td style="text-align:left">2byte</td><td style="text-align:left">å—å¯¹é½=é€šé“æ•°<em>æ¯æ¬¡é‡‡æ ·å¾—åˆ°çš„æ ·æœ¬ä½æ•°/8ï¼Œ0002Hï¼Œä¹Ÿå°±æ˜¯ `2 == 1</em>16/8`</td></tr><tr><td style="text-align:left">22H</td><td style="text-align:left">2byte</td><td style="text-align:left">æ ·æœ¬æ•°æ®ä½æ•°ï¼Œ0010Hå³16ï¼Œä¸€ä¸ªé‡åŒ–æ ·æœ¬å 2byteã€‚</td></tr><tr><td style="text-align:left">24H</td><td style="text-align:left">4byte</td><td style="text-align:left">dataï¼Œä¸€ä¸ªæ ‡å¿—è€Œå·²ã€‚</td></tr><tr><td style="text-align:left">28H</td><td style="text-align:left">4byte</td><td style="text-align:left">Wavæ–‡ä»¶å®é™…éŸ³é¢‘æ•°æ®æ‰€å çš„å¤§å°ï¼Œè¿™é‡Œæ˜¯001437C8Hå³1325000ï¼Œå†åŠ ä¸Š2CHå°±æ­£å¥½æ˜¯1325044ï¼Œæ•´ä¸ªæ–‡ä»¶çš„å¤§å°ã€‚</td></tr><tr><td style="text-align:left">2CH</td><td style="text-align:left">ä¸å®š</td><td style="text-align:left">é‡åŒ–æ•°æ®</td></tr></tbody></table><h3 id="AudioRecord"><a href="#AudioRecord" class="headerlink" title="AudioRecord"></a>AudioRecord</h3><p>AudioRecordå¯å®ç°ä»éŸ³é¢‘è¾“å…¥è®¾å¤‡è®°å½•å£°éŸ³çš„åŠŸèƒ½ã€‚å¾—åˆ°PCMæ ¼å¼çš„éŸ³é¢‘ã€‚<br>è¯»å–éŸ³é¢‘çš„æ–¹æ³•æœ‰<code>read(byte[], int, int)</code>ï¼Œ <code>read(short[], int, int)</code> æˆ– <code>read(ByteBuffer, int)</code>ã€‚<br>å¯æ ¹æ®å­˜å‚¨æ–¹å¼å’Œéœ€æ±‚é€‰æ‹©ä½¿ç”¨è¿™é¡¹æ–¹æ³•ã€‚</p><p>éœ€è¦æƒé™<code>&lt;uses-permission android:name=&quot;android.permission.RECORD_AUDIO&quot; /&gt;</code></p><h4 id="AudioRecord-æ„é€ å‡½æ•°"><a href="#AudioRecord-æ„é€ å‡½æ•°" class="headerlink" title="AudioRecord æ„é€ å‡½æ•°"></a>AudioRecord æ„é€ å‡½æ•°</h4><p><code>public AudioRecord(int audioSource, int sampleRateInHz, int channelConfig, int audioFormat, int bufferSizeInBytes)</code></p><ul><li>audioSource éŸ³æºè®¾å¤‡ï¼Œå¸¸ç”¨éº¦å…‹é£<code>MediaRecorder.AudioSource.MIC</code></li><li>samplerateInHz é‡‡æ ·é¢‘ç‡ï¼Œ44100Hzæ˜¯ç›®å‰æ‰€æœ‰è®¾å¤‡éƒ½æ”¯æŒçš„é¢‘ç‡</li><li>channelConfig éŸ³é¢‘é€šé“ï¼Œå•å£°é“è¿˜æ˜¯ç«‹ä½“å£°</li><li>audioFormat è¯¥å‚æ•°ä¸ºé‡åŒ–æ·±åº¦ï¼Œå³ä¸ºæ¯æ¬¡é‡‡æ ·çš„ä½æ•°</li><li>bufferSizeInBytes å¯é€šè¿‡<code>getMinBufferSize()</code>æ–¹æ³•ç¡®å®šï¼Œæ¯æ¬¡ä»ç¡¬ä»¶è¯»å–æ•°æ®æ‰€éœ€è¦çš„ç¼“å†²åŒºçš„å¤§å°ã€‚</li></ul><h4 id="è·å–wavæ–‡ä»¶"><a href="#è·å–wavæ–‡ä»¶" class="headerlink" title="è·å–wavæ–‡ä»¶"></a>è·å–wavæ–‡ä»¶</h4><p>è‹¥è¦è·å¾—wavæ–‡ä»¶ï¼Œéœ€è¦åœ¨PCMåŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªheaderã€‚å¯ä»¥å°†PCMæ–‡ä»¶è½¬æ¢æˆwavï¼Œè¿™é‡Œæä¾›ä¸€ç§PCMä¸wavå‡ ä¹åŒæ—¶ç”Ÿæˆçš„æ€è·¯ã€‚</p><p>PCMä¸wavåŒæ—¶åˆ›å»ºï¼Œç»™wavæ–‡ä»¶ä¸€ä¸ªé»˜è®¤çš„headerã€‚å½•åˆ¶çº¿ç¨‹å¯åŠ¨åï¼ŒåŒæ—¶å†™PCMä¸wavã€‚<br>å½•åˆ¶å®Œæˆæ—¶ï¼Œé‡æ–°ç”Ÿæˆheaderï¼Œåˆ©ç”¨<code>RandomAccessFile</code>ä¿®æ”¹wavæ–‡ä»¶çš„headerã€‚</p><h3 id="AudioTrack"><a href="#AudioTrack" class="headerlink" title="AudioTrack"></a>AudioTrack</h3><p>ä½¿ç”¨<code>AudioTrack</code>æ’­æ”¾éŸ³é¢‘ã€‚åˆå§‹åŒ–AudioTrackæ—¶ï¼Œè¦æ ¹æ®å½•åˆ¶æ—¶çš„å‚æ•°è¿›è¡Œè®¾å®šã€‚</p><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><p>å·¥å…·ç±»<code>WindEar</code>å®ç°éŸ³é¢‘PCMæ•°æ®çš„é‡‡é›†å’Œæ’­æ”¾ï¼Œä¸è¯»å†™éŸ³é¢‘wavæ–‡ä»¶çš„åŠŸèƒ½ã€‚</p><ul><li><code>AudioRecordThread</code> ä½¿ç”¨<code>AudioRecord</code>å½•åˆ¶PCMæ–‡ä»¶ï¼Œå¯é€‰æ‹©åŒæ—¶ç”Ÿæˆwavæ–‡ä»¶</li><li><code>AudioTrackPlayThread</code> ä½¿ç”¨AudioTrackæ’­æ”¾PCMæˆ–wavéŸ³é¢‘æ–‡ä»¶çš„çº¿ç¨‹</li><li><code>WindState</code> è¡¨ç¤ºå½“å‰çŠ¶æ€ï¼Œä¾‹å¦‚æ˜¯å¦åœ¨æ’­æ”¾ï¼Œå½•åˆ¶ç­‰ç­‰</li></ul><p>PCMæ–‡ä»¶çš„è¯»å†™é‡‡ç”¨<code>FileOutputStream</code>å’Œ<code>FileInputStream</code></p><p><code>generateWavFileHeader</code>æ–¹æ³•å¯ä»¥ç”Ÿæˆwavæ–‡ä»¶çš„header</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * éŸ³é¢‘å½•åˆ¶å™¨</span><br><span class="hljs-comment"> * ä½¿ç”¨ AudioRecord å’Œ AudioTrack API å®ŒæˆéŸ³é¢‘ PCM æ•°æ®çš„é‡‡é›†å’Œæ’­æ”¾ï¼Œå¹¶å®ç°è¯»å†™éŸ³é¢‘ wav æ–‡ä»¶</span><br><span class="hljs-comment"> * æ£€æŸ¥æƒé™ï¼Œæ£€æŸ¥éº¦å…‹é£çš„å·¥ä½œæ”¾åœ¨Activityä¸­è¿›è¡Œ</span><br><span class="hljs-comment"> * Created by Rust on 2018/2/24.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WindEar</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;rustApp&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TMP_FOLDER_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;AnWindEar&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">RECORD_AUDIO_BUFFER_TIMES</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">PLAY_AUDIO_BUFFER_TIMES</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">AUDIO_FREQUENCY</span> <span class="hljs-operator">=</span> <span class="hljs-number">44100</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">RECORD_CHANNEL_CONFIG</span> <span class="hljs-operator">=</span> AudioFormat.CHANNEL_IN_STEREO;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">PLAY_CHANNEL_CONFIG</span> <span class="hljs-operator">=</span> AudioFormat.CHANNEL_OUT_STEREO;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">AUDIO_ENCODING</span> <span class="hljs-operator">=</span> AudioFormat.ENCODING_PCM_16BIT;<br><br>    <span class="hljs-keyword">private</span> AudioRecordThread aRecordThread;           <span class="hljs-comment">// å½•åˆ¶çº¿ç¨‹</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">WindState</span> <span class="hljs-variable">state</span> <span class="hljs-operator">=</span> WindState.IDLE; <span class="hljs-comment">// å½“å‰çŠ¶æ€</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">File</span> <span class="hljs-variable">tmpPCMFile</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">File</span> <span class="hljs-variable">tmpWavFile</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">private</span> OnState onStateListener;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Handler</span> <span class="hljs-variable">mainHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(Looper.getMainLooper());<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * PCMç¼“å­˜ç›®å½•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String cachePCMFolder;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * wavç¼“å­˜ç›®å½•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String wavFolderPath;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">WindEar</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindEar</span>();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">WindEar</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> WindEar <span class="hljs-title function_">getInstance</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == instance) &#123;<br>            instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindEar</span>();<br>        &#125;<br>        <span class="hljs-keyword">return</span> instance;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOnStateListener</span><span class="hljs-params">(OnState onStateListener)</span> &#123;<br>        <span class="hljs-built_in">this</span>.onStateListener = onStateListener;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆå§‹åŒ–ç›®å½•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-comment">// å­˜å‚¨åœ¨Appå†…æˆ–SDå¡ä¸Š</span><br><span class="hljs-comment">//        cachePCMFolder = context.getFilesDir().getAbsolutePath() + File.separator + TMP_FOLDER_NAME;</span><br>        cachePCMFolder = Environment.getExternalStorageDirectory().getAbsolutePath() + File.separator<br>                + TMP_FOLDER_NAME;<br><br>        <span class="hljs-type">File</span> <span class="hljs-variable">folder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(cachePCMFolder);<br>        <span class="hljs-keyword">if</span> (!folder.exists()) &#123;<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> folder.mkdirs();<br>            Log.d(TAG, String.format(Locale.CHINA, <span class="hljs-string">&quot;PCMç›®å½•:%s -&gt; %b&quot;</span>, cachePCMFolder, f));<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">for</span> (File f : folder.listFiles()) &#123;<br>                <span class="hljs-type">boolean</span> <span class="hljs-variable">d</span> <span class="hljs-operator">=</span> f.delete();<br>                Log.d(TAG, String.format(Locale.CHINA, <span class="hljs-string">&quot;åˆ é™¤PCMæ–‡ä»¶:%s %b&quot;</span>, f.getName(), d));<br>            &#125;<br>            Log.d(TAG, String.format(Locale.CHINA, <span class="hljs-string">&quot;PCMç›®å½•:%s&quot;</span>, cachePCMFolder));<br>        &#125;<br><br>        wavFolderPath = Environment.getExternalStorageDirectory().getAbsolutePath() + File.separator<br>                + TMP_FOLDER_NAME;<br><span class="hljs-comment">//        wavFolderPath = context.getFilesDir().getAbsolutePath() + File.separator + TMP_FOLDER_NAME;</span><br>        <span class="hljs-type">File</span> <span class="hljs-variable">wavDir</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(wavFolderPath);<br>        <span class="hljs-keyword">if</span> (!wavDir.exists()) &#123;<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> wavDir.mkdirs();<br>            Log.d(TAG, String.format(Locale.CHINA, <span class="hljs-string">&quot;wavç›®å½•:%s -&gt; %b&quot;</span>, wavFolderPath, w));<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            Log.d(TAG, String.format(Locale.CHINA, <span class="hljs-string">&quot;wavç›®å½•:%s&quot;</span>, wavFolderPath));<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¼€å§‹å½•åˆ¶éŸ³é¢‘</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startRecord</span><span class="hljs-params">(<span class="hljs-type">boolean</span> createWav)</span> &#123;<br>        <span class="hljs-keyword">if</span> (!state.equals(WindState.IDLE)) &#123;<br>            Log.w(TAG, <span class="hljs-string">&quot;æ— æ³•å¼€å§‹å½•åˆ¶ï¼Œå½“å‰çŠ¶æ€ä¸º &quot;</span> + state);<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            tmpPCMFile = File.createTempFile(<span class="hljs-string">&quot;recording&quot;</span>, <span class="hljs-string">&quot;.pcm&quot;</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(cachePCMFolder));<br>            <span class="hljs-keyword">if</span> (createWav) &#123;<br>                <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyMMdd_HHmmss&quot;</span>, Locale.CHINA);<br>                tmpWavFile = <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(wavFolderPath + File.separator + <span class="hljs-string">&quot;r&quot;</span> + sdf.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()) + <span class="hljs-string">&quot;.wav&quot;</span>);<br>            &#125;<br>            Log.d(TAG, <span class="hljs-string">&quot;tmp file &quot;</span> + tmpPCMFile.getName());<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != aRecordThread) &#123;<br>            aRecordThread.interrupt();<br>            aRecordThread = <span class="hljs-literal">null</span>;<br>        &#125;<br>        aRecordThread = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AudioRecordThread</span>(createWav);<br>        aRecordThread.start();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stopRecord</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (!state.equals(WindState.RECORDING)) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        state = WindState.STOP_RECORD;<br>        notifyState(state);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ’­æ”¾å½•åˆ¶å¥½çš„PCMæ–‡ä»¶</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startPlayPCM</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (!isIdle()) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">AudioTrackPlayThread</span>(tmpPCMFile).start();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ’­æ”¾å½•åˆ¶å¥½çš„wavæ–‡ä»¶</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startPlayWav</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (!isIdle()) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">AudioTrackPlayThread</span>(tmpWavFile).start();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stopPlay</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (!state.equals(WindState.PLAYING)) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        state = WindState.STOP_PLAY;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isIdle</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> WindState.IDLE.equals(state);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * éŸ³é¢‘å½•åˆ¶çº¿ç¨‹</span><br><span class="hljs-comment">     * ä½¿ç”¨FileOutputStreamæ¥å†™æ–‡ä»¶</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AudioRecordThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br>        AudioRecord aRecord;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">bufferSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">10240</span>;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">createWav</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><br>        AudioRecordThread(<span class="hljs-type">boolean</span> createWav) &#123;<br>            <span class="hljs-built_in">this</span>.createWav = createWav;<br>            bufferSize = AudioRecord.getMinBufferSize(AUDIO_FREQUENCY,<br>                    RECORD_CHANNEL_CONFIG, AUDIO_ENCODING) * RECORD_AUDIO_BUFFER_TIMES;<br>            Log.d(TAG, <span class="hljs-string">&quot;record buffer size = &quot;</span> + bufferSize);<br>            aRecord = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AudioRecord</span>(MediaRecorder.AudioSource.MIC, AUDIO_FREQUENCY,<br>                    RECORD_CHANNEL_CONFIG, AUDIO_ENCODING, bufferSize);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            state = WindState.RECORDING;<br>            notifyState(state);<br>            Log.d(TAG, <span class="hljs-string">&quot;å½•åˆ¶å¼€å§‹&quot;</span>);<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// è¿™é‡Œé€‰æ‹©FileOutputStreamè€Œä¸æ˜¯DataOutputStream</span><br>                <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">pcmFos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(tmpPCMFile);<br><br>                <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">wavFos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(tmpWavFile);<br>                <span class="hljs-keyword">if</span> (createWav) &#123;<br>                    writeWavFileHeader(wavFos, bufferSize, AUDIO_FREQUENCY, aRecord.getChannelCount());<br>                &#125;<br>                aRecord.startRecording();<br>                <span class="hljs-type">byte</span>[] byteBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[bufferSize];<br>                <span class="hljs-keyword">while</span> (state.equals(WindState.RECORDING) &amp;&amp; !isInterrupted()) &#123;<br>                    <span class="hljs-type">int</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> aRecord.read(byteBuffer, <span class="hljs-number">0</span>, byteBuffer.length);<br>                    pcmFos.write(byteBuffer, <span class="hljs-number">0</span>, end);<br>                    pcmFos.flush();<br>                    <span class="hljs-keyword">if</span> (createWav) &#123;<br>                        wavFos.write(byteBuffer, <span class="hljs-number">0</span>, end);<br>                        wavFos.flush();<br>                    &#125;<br>                &#125;<br>                aRecord.stop(); <span class="hljs-comment">// å½•åˆ¶ç»“æŸ</span><br>                pcmFos.close();<br>                wavFos.close();<br>                <span class="hljs-keyword">if</span> (createWav) &#123;<br>                    <span class="hljs-comment">// ä¿®æ”¹header</span><br>                    <span class="hljs-type">RandomAccessFile</span> <span class="hljs-variable">wavRaf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RandomAccessFile</span>(tmpWavFile, <span class="hljs-string">&quot;rw&quot;</span>);<br>                    <span class="hljs-type">byte</span>[] header = generateWavFileHeader(tmpPCMFile.length(), AUDIO_FREQUENCY, aRecord.getChannelCount());<br>                    Log.d(TAG, <span class="hljs-string">&quot;header: &quot;</span> + getHexString(header));<br>                    wavRaf.seek(<span class="hljs-number">0</span>);<br>                    wavRaf.write(header);<br>                    wavRaf.close();<br>                    Log.d(TAG, <span class="hljs-string">&quot;tmpWavFile.length: &quot;</span> + tmpWavFile.length());<br>                &#125;<br>                Log.i(TAG, <span class="hljs-string">&quot;audio tmp PCM file len: &quot;</span> + tmpPCMFile.length());<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                Log.e(TAG, <span class="hljs-string">&quot;AudioRecordThread:&quot;</span>, e);<br>                notifyState(WindState.ERROR);<br>            &#125;<br>            notifyState(state);<br>            state = WindState.IDLE;<br>            notifyState(state);<br>            Log.d(TAG, <span class="hljs-string">&quot;å½•åˆ¶ç»“æŸ&quot;</span>);<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getHexString</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] bytes)</span> &#123;<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">byte</span> b : bytes) &#123;<br>            sb.append(Integer.toHexString(b)).append(<span class="hljs-string">&quot;,&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> sb.toString();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * AudioTrackæ’­æ”¾éŸ³é¢‘çº¿ç¨‹</span><br><span class="hljs-comment">     * ä½¿ç”¨FileInputStreamè¯»å–æ–‡ä»¶</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AudioTrackPlayThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br>        AudioTrack track;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">bufferSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">10240</span>;<br>        <span class="hljs-type">File</span> <span class="hljs-variable">audioFile</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        AudioTrackPlayThread(File aFile) &#123;<br>            setPriority(Thread.MAX_PRIORITY);<br>            audioFile = aFile;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">bufferSize</span> <span class="hljs-operator">=</span> AudioTrack.getMinBufferSize(AUDIO_FREQUENCY,<br>                    PLAY_CHANNEL_CONFIG, AUDIO_ENCODING) * PLAY_AUDIO_BUFFER_TIMES;<br>            track = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AudioTrack</span>(AudioManager.STREAM_MUSIC,<br>                    AUDIO_FREQUENCY,<br>                    PLAY_CHANNEL_CONFIG, AUDIO_ENCODING, bufferSize,<br>                    AudioTrack.MODE_STREAM);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-built_in">super</span>.run();<br>            state = WindState.PLAYING;<br>            notifyState(state);<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(audioFile);<br>                track.play();<br>                <span class="hljs-type">byte</span>[] aByteBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[bufferSize];<br>                <span class="hljs-keyword">while</span> (state.equals(WindState.PLAYING) &amp;&amp;<br>                        fis.read(aByteBuffer) &gt;= <span class="hljs-number">0</span>) &#123;<br>                    track.write(aByteBuffer, <span class="hljs-number">0</span>, aByteBuffer.length);<br>                &#125;<br>                track.stop();<br>                track.release();<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                Log.e(TAG, <span class="hljs-string">&quot;AudioTrackPlayThread:&quot;</span>, e);<br>                notifyState(WindState.ERROR);<br>            &#125;<br>            state = WindState.STOP_PLAY;<br>            notifyState(state);<br>            state = WindState.IDLE;<br>            notifyState(state);<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyState</span><span class="hljs-params">(<span class="hljs-keyword">final</span> WindState currentState)</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != onStateListener) &#123;<br>            mainHandler.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>                <span class="hljs-meta">@Override</span><br>                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                    onStateListener.onStateChanged(currentState);<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OnState</span> &#123;<br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onStateChanged</span><span class="hljs-params">(WindState currentState)</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¡¨ç¤ºå½“å‰çŠ¶æ€</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">WindState</span> &#123;<br>        ERROR,<br>        IDLE,<br>        RECORDING,<br>        STOP_RECORD,<br>        PLAYING,<br>        STOP_PLAY<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> out            wavéŸ³é¢‘æ–‡ä»¶æµ</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> totalAudioLen  ä¸åŒ…æ‹¬headerçš„éŸ³é¢‘æ•°æ®æ€»é•¿åº¦</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> longSampleRate é‡‡æ ·ç‡,ä¹Ÿå°±æ˜¯å½•åˆ¶æ—¶ä½¿ç”¨çš„é¢‘ç‡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> channels       audioRecordçš„é¢‘é“æ•°é‡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> IOException å†™æ–‡ä»¶é”™è¯¯</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeWavFileHeader</span><span class="hljs-params">(FileOutputStream out, <span class="hljs-type">long</span> totalAudioLen, <span class="hljs-type">long</span> longSampleRate,</span><br><span class="hljs-params">                                    <span class="hljs-type">int</span> channels)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">byte</span>[] header = generateWavFileHeader(totalAudioLen, longSampleRate, channels);<br>        out.write(header, <span class="hljs-number">0</span>, header.length);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä»»ä½•ä¸€ç§æ–‡ä»¶åœ¨å¤´éƒ¨æ·»åŠ ç›¸åº”çš„å¤´æ–‡ä»¶æ‰èƒ½å¤Ÿç¡®å®šçš„è¡¨ç¤ºè¿™ç§æ–‡ä»¶çš„æ ¼å¼ï¼Œ</span><br><span class="hljs-comment">     * waveæ˜¯RIFFæ–‡ä»¶ç»“æ„ï¼Œæ¯ä¸€éƒ¨åˆ†ä¸ºä¸€ä¸ªchunkï¼Œå…¶ä¸­æœ‰RIFF WAVE chunkï¼Œ</span><br><span class="hljs-comment">     * FMT Chunkï¼ŒFact chunk,Data chunk,å…¶ä¸­Fact chunkæ˜¯å¯ä»¥é€‰æ‹©çš„</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pcmAudioByteCount ä¸åŒ…æ‹¬headerçš„éŸ³é¢‘æ•°æ®æ€»é•¿åº¦</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> longSampleRate    é‡‡æ ·ç‡,ä¹Ÿå°±æ˜¯å½•åˆ¶æ—¶ä½¿ç”¨çš„é¢‘ç‡</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> channels          audioRecordçš„é¢‘é“æ•°é‡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] generateWavFileHeader(<span class="hljs-type">long</span> pcmAudioByteCount, <span class="hljs-type">long</span> longSampleRate, <span class="hljs-type">int</span> channels) &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">totalDataLen</span> <span class="hljs-operator">=</span> pcmAudioByteCount + <span class="hljs-number">36</span>; <span class="hljs-comment">// ä¸åŒ…å«å‰8ä¸ªå­—èŠ‚çš„WAVæ–‡ä»¶æ€»é•¿åº¦</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">byteRate</span> <span class="hljs-operator">=</span> longSampleRate * <span class="hljs-number">2</span> * channels;<br>        <span class="hljs-type">byte</span>[] header = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">44</span>];<br>        header[<span class="hljs-number">0</span>] = <span class="hljs-string">&#x27;R&#x27;</span>; <span class="hljs-comment">// RIFF</span><br>        header[<span class="hljs-number">1</span>] = <span class="hljs-string">&#x27;I&#x27;</span>;<br>        header[<span class="hljs-number">2</span>] = <span class="hljs-string">&#x27;F&#x27;</span>;<br>        header[<span class="hljs-number">3</span>] = <span class="hljs-string">&#x27;F&#x27;</span>;<br><br>        header[<span class="hljs-number">4</span>] = (<span class="hljs-type">byte</span>) (totalDataLen &amp; <span class="hljs-number">0xff</span>);<span class="hljs-comment">//æ•°æ®å¤§å°</span><br>        header[<span class="hljs-number">5</span>] = (<span class="hljs-type">byte</span>) ((totalDataLen &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>);<br>        header[<span class="hljs-number">6</span>] = (<span class="hljs-type">byte</span>) ((totalDataLen &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xff</span>);<br>        header[<span class="hljs-number">7</span>] = (<span class="hljs-type">byte</span>) ((totalDataLen &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xff</span>);<br><br>        header[<span class="hljs-number">8</span>] = <span class="hljs-string">&#x27;W&#x27;</span>;<span class="hljs-comment">//WAVE</span><br>        header[<span class="hljs-number">9</span>] = <span class="hljs-string">&#x27;A&#x27;</span>;<br>        header[<span class="hljs-number">10</span>] = <span class="hljs-string">&#x27;V&#x27;</span>;<br>        header[<span class="hljs-number">11</span>] = <span class="hljs-string">&#x27;E&#x27;</span>;<br>        <span class="hljs-comment">//FMT Chunk</span><br>        header[<span class="hljs-number">12</span>] = <span class="hljs-string">&#x27;f&#x27;</span>; <span class="hljs-comment">// &#x27;fmt &#x27;</span><br>        header[<span class="hljs-number">13</span>] = <span class="hljs-string">&#x27;m&#x27;</span>;<br>        header[<span class="hljs-number">14</span>] = <span class="hljs-string">&#x27;t&#x27;</span>;<br>        header[<span class="hljs-number">15</span>] = <span class="hljs-string">&#x27; &#x27;</span>;<span class="hljs-comment">//è¿‡æ¸¡å­—èŠ‚</span><br>        <span class="hljs-comment">//æ•°æ®å¤§å°</span><br>        header[<span class="hljs-number">16</span>] = <span class="hljs-number">16</span>; <span class="hljs-comment">// 4 bytes: size of &#x27;fmt &#x27; chunk</span><br>        header[<span class="hljs-number">17</span>] = <span class="hljs-number">0</span>;<br>        header[<span class="hljs-number">18</span>] = <span class="hljs-number">0</span>;<br>        header[<span class="hljs-number">19</span>] = <span class="hljs-number">0</span>;<br>        <span class="hljs-comment">//ç¼–ç æ–¹å¼ 10Hä¸ºPCMç¼–ç æ ¼å¼</span><br>        header[<span class="hljs-number">20</span>] = <span class="hljs-number">1</span>; <span class="hljs-comment">// format = 1</span><br>        header[<span class="hljs-number">21</span>] = <span class="hljs-number">0</span>;<br>        <span class="hljs-comment">//é€šé“æ•°</span><br>        header[<span class="hljs-number">22</span>] = (<span class="hljs-type">byte</span>) channels;<br>        header[<span class="hljs-number">23</span>] = <span class="hljs-number">0</span>;<br>        <span class="hljs-comment">//é‡‡æ ·ç‡ï¼Œæ¯ä¸ªé€šé“çš„æ’­æ”¾é€Ÿåº¦</span><br>        header[<span class="hljs-number">24</span>] = (<span class="hljs-type">byte</span>) (longSampleRate &amp; <span class="hljs-number">0xff</span>);<br>        header[<span class="hljs-number">25</span>] = (<span class="hljs-type">byte</span>) ((longSampleRate &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>);<br>        header[<span class="hljs-number">26</span>] = (<span class="hljs-type">byte</span>) ((longSampleRate &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xff</span>);<br>        header[<span class="hljs-number">27</span>] = (<span class="hljs-type">byte</span>) ((longSampleRate &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xff</span>);<br>        <span class="hljs-comment">//éŸ³é¢‘æ•°æ®ä¼ é€é€Ÿç‡,é‡‡æ ·ç‡*é€šé“æ•°*é‡‡æ ·æ·±åº¦/8</span><br>        header[<span class="hljs-number">28</span>] = (<span class="hljs-type">byte</span>) (byteRate &amp; <span class="hljs-number">0xff</span>);<br>        header[<span class="hljs-number">29</span>] = (<span class="hljs-type">byte</span>) ((byteRate &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>);<br>        header[<span class="hljs-number">30</span>] = (<span class="hljs-type">byte</span>) ((byteRate &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xff</span>);<br>        header[<span class="hljs-number">31</span>] = (<span class="hljs-type">byte</span>) ((byteRate &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xff</span>);<br>        <span class="hljs-comment">// ç¡®å®šç³»ç»Ÿä¸€æ¬¡è¦å¤„ç†å¤šå°‘ä¸ªè¿™æ ·å­—èŠ‚çš„æ•°æ®ï¼Œç¡®å®šç¼“å†²åŒºï¼Œé€šé“æ•°*é‡‡æ ·ä½æ•°</span><br>        header[<span class="hljs-number">32</span>] = (<span class="hljs-type">byte</span>) (<span class="hljs-number">2</span> * channels);<br>        header[<span class="hljs-number">33</span>] = <span class="hljs-number">0</span>;<br>        <span class="hljs-comment">//æ¯ä¸ªæ ·æœ¬çš„æ•°æ®ä½æ•°</span><br>        header[<span class="hljs-number">34</span>] = <span class="hljs-number">16</span>;<br>        header[<span class="hljs-number">35</span>] = <span class="hljs-number">0</span>;<br>        <span class="hljs-comment">//Data chunk</span><br>        header[<span class="hljs-number">36</span>] = <span class="hljs-string">&#x27;d&#x27;</span>;<span class="hljs-comment">//data</span><br>        header[<span class="hljs-number">37</span>] = <span class="hljs-string">&#x27;a&#x27;</span>;<br>        header[<span class="hljs-number">38</span>] = <span class="hljs-string">&#x27;t&#x27;</span>;<br>        header[<span class="hljs-number">39</span>] = <span class="hljs-string">&#x27;a&#x27;</span>;<br>        header[<span class="hljs-number">40</span>] = (<span class="hljs-type">byte</span>) (pcmAudioByteCount &amp; <span class="hljs-number">0xff</span>);<br>        header[<span class="hljs-number">41</span>] = (<span class="hljs-type">byte</span>) ((pcmAudioByteCount &gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>);<br>        header[<span class="hljs-number">42</span>] = (<span class="hljs-type">byte</span>) ((pcmAudioByteCount &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xff</span>);<br>        header[<span class="hljs-number">43</span>] = (<span class="hljs-type">byte</span>) ((pcmAudioByteCount &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xff</span>);<br>        <span class="hljs-keyword">return</span> header;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><ul><li><a href="https://developer.android.com/reference/android/media/AudioRecord.html">AudioRecord - developer.android.com</a></li><li><a href="https://developer.android.com/reference/android/media/AudioTrack.html">AudioTrack - developer.android.com</a></li></ul><p>AndroidéŸ³è§†é¢‘ç›¸å…³æ–‡ç« è¯·å‚è€ƒ <a href="https://rustfisher.com/tags/Android-Media/">https://rustfisher.com/tags/Android-Media/</a></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android_Media</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Androidæ•™ç¨‹2020 - ç³»åˆ—ç®€ä»‹</title>
    <link href="/2019/12/08/Android_tutorial_2020/Android-tutorial_2020_a_menu/"/>
    <url>/2019/12/08/Android_tutorial_2020/Android-tutorial_2020_a_menu/</url>
    
    <content type="html"><![CDATA[<p>Androidæ•™ç¨‹2020è¿ç§»åˆ°<a href="https://an.rustfisher.com/">Androidæ•™ç¨‹2020</a>ï¼Œæ¬¢è¿å¤§å®¶å‰æ¥é˜…è¯»ğŸ‘</p><p>ä¸ºäº†æ–¹ä¾¿æœ‹å‹å…¥é—¨å®‰å“åº”ç”¨å¼€å‘ï¼Œå¼€å§‹æ•´ç†2020å¹´çš„Androidæ–°æ‰‹æ•™ç¨‹ã€‚çªå‡ºä¸€ä¸ªç®€å•æ˜äº†ï¼Œä¸Šæ‰‹å¿«ã€‚<br>ä»å®ç”¨æ€§å‡ºå‘ï¼Œå¿«é€ŸæŒæ¡Androidå¼€å‘åŸºæœ¬æŠ€èƒ½ã€‚éœ€è¦è¯»è€…æœ‰ä¸€å®šçš„JavaåŸºç¡€ã€‚</p><p>å­¦å®Œæœ¬è¯¾ç¨‹åï¼Œè¯»è€…å¯ä»¥è‡ªå·±åšå‡ºä¸€ä¸ªä¸ªæ–¹ä¾¿å·¥ä½œç”Ÿæ´»çš„å°å·¥å…·æ¥ã€‚</p><p>æˆ‘çš„åšå®¢å³å°†åŒæ­¥è‡³è…¾è®¯äº‘+ç¤¾åŒºï¼Œé‚€è¯·å¤§å®¶ä¸€åŒå…¥é©»ï¼š<a href="https://cloud.tencent.com/developer/support-plan?invite_code=1htj93xu8gcij">https://cloud.tencent.com/developer/support-plan?invite_code=1htj93xu8gcij</a></p>]]></content>
    
    
    <categories>
      
      <category>Android_tutorial_2020</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android-2020</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€è¿è¥çš„PythonæŒ‡å—ã€‘Python Excel ç»˜åˆ¶æŸ±å½¢å›¾</title>
    <link href="/2019/11/19/Python/Python-op-excel_openpyxl_bar_column_chart/"/>
    <url>/2019/11/19/Python/Python-op-excel_openpyxl_bar_column_chart/</url>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ä»½å†™ç»™è¿è¥äººå‘˜çš„PythonæŒ‡å—ã€‚æœ¬æ–‡ä¸»è¦è®²è¿°å¦‚ä½•ä½¿ç”¨Pythonæ“ä½œExcelç»˜åˆ¶æŸ±å½¢å›¾ã€‚</p><p>ç›¸å…³ä»£ç è¯·å‚è€ƒ <a href="https://github.com/RustFisher/python-playground">https://github.com/RustFisher/python-playground</a></p><p>æœ¬æ–‡é“¾æ¥ï¼š<a href="https://www.rustfisher.com/2019/11/19/Python/Python-op-excel_openpyxl_bar_column_chart/">https://www.rustfisher.com/2019/11/19/Python/Python-op-excel_openpyxl_bar_column_chart/</a></p><p>å¼€å‘å·¥å…·ï¼Œç¯å¢ƒ</p><ul><li>PyCharm</li><li>Python3</li><li>Office Excel</li></ul><p><a href="https://www.rustfisher.com/2019/11/05/Python/Python-op-excel_openpyxl_use/">å‰é¢</a>æˆ‘ä»¬å·²ç»åˆ›å»ºå¥½äº†ä¸€å¼ Excelè¡¨ã€‚<br>ç°åœ¨æˆ‘ä»¬è¦æ ¹æ®å·²æœ‰çš„æ•°æ®ï¼Œå¾€é‡Œé¢æ·»åŠ æŸ±å½¢å›¾ã€‚</p><h2 id="æŸ±å½¢å›¾-BarChart"><a href="#æŸ±å½¢å›¾-BarChart" class="headerlink" title="æŸ±å½¢å›¾ BarChart"></a>æŸ±å½¢å›¾ BarChart</h2><p>å‚è€ƒ<a href="https://rustfisher.com/2019/11/14/Python/Python-openpyxl_charts_Bar_and_Column/">ã€ŠPython openpyxl Excelç»˜åˆ¶æŸ±å½¢å›¾ã€‹</a>å¾—çŸ¥ï¼Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨<code>BarChart</code>ä¸<code>BarChart3D</code>ç±»ã€‚<br>å›¾è¡¨ä¸­è®¸å¤šçš„ç»†èŠ‚ç”±BarChartå±æ€§æ§åˆ¶ã€‚</p><p>åæ–‡éƒ½ä»¥chart1æ¥è¡¨ç¤ºæŸ±å½¢å›¾å¯¹è±¡ <code>chart1 = BarChart()</code> ã€‚</p><h3 id="æ•°æ®æ¥æºèŒƒå›´-Reference"><a href="#æ•°æ®æ¥æºèŒƒå›´-Reference" class="headerlink" title="æ•°æ®æ¥æºèŒƒå›´ Reference"></a>æ•°æ®æ¥æºèŒƒå›´ Reference</h3><p>é¦–å…ˆæˆ‘ä»¬åº”è¯¥ç¡®å®šæ•°æ®çš„èŒƒå›´ã€‚æœ‰æ•°æ®æ‰å¥½ç»˜å›¾ã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯<code>Reference</code>ç±»æ¥è¡¨ç¤ºæ•°æ®â€œå¼•ç”¨â€èŒƒå›´ã€‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">data1 = Reference(st, min_col=<span class="hljs-number">2</span>, min_row=<span class="hljs-number">1</span>, max_row=<span class="hljs-number">7</span>, max_col=<span class="hljs-number">3</span>)<br>cats1 = Reference(st, min_col=<span class="hljs-number">1</span>, min_row=<span class="hljs-number">2</span>, max_row=<span class="hljs-number">7</span>)<br></code></pre></td></tr></table></figure><br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒèŒƒå›´çš„ä¸‹æ ‡æ˜¯ä»1å¼€å§‹çš„ã€‚<br>è¿™é‡Œçš„data1æŠŠæ ‡é¢˜ä¹Ÿæ¡†è¿›å»äº†ã€‚è®¾å®šæ•°æ®çš„æ—¶å€™ï¼Œéœ€è¦è®¾ç½®<code>titles_from_data=True</code><br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">chart1.add_data(data1, titles_from_data=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure></p><p>è®¾ç½®ç§ç±»ä½¿ç”¨<code>set_categories</code>æ–¹æ³•ï¼Œä¹Ÿæ˜¯æŠŠä¸€ä¸ªèŒƒå›´ï¼ˆReferenceï¼‰çš„æ•°æ®ä¼ å…¥ã€‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">chart1.set_categories(cats1)<br></code></pre></td></tr></table></figure></p><h3 id="æŸ±å­æ–¹å‘æ§åˆ¶-type"><a href="#æŸ±å­æ–¹å‘æ§åˆ¶-type" class="headerlink" title="æŸ±å­æ–¹å‘æ§åˆ¶ type"></a>æŸ±å­æ–¹å‘æ§åˆ¶ type</h3><p>æ–¹å‘ç”±å±æ€§<code>type</code>æ¥æ§åˆ¶ï¼Œæœ‰2ä¸ªå¯é€‰å‚æ•°ï¼š<code>bar</code>è¡¨ç¤ºæ¨ªå‘ï¼Œ<code>col</code>è¡¨ç¤ºç«–ç›´ã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">chart1.<span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;bar&quot;</span> <span class="hljs-comment"># æ¨ªå‘æŸ±å½¢å›¾</span><br>chart1.<span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;col&quot;</span> <span class="hljs-comment"># çºµå‘æŸ±å½¢å›¾</span><br></code></pre></td></tr></table></figure><h3 id="æ ‡é¢˜-title"><a href="#æ ‡é¢˜-title" class="headerlink" title="æ ‡é¢˜ title"></a>æ ‡é¢˜ title</h3><p>å±æ€§titleæ§åˆ¶æ ‡é¢˜ã€‚å¦‚æœç½®ä¸ºNoneåˆ™ä¸æ˜¾ç¤ºæ ‡é¢˜ã€‚</p><p>å›¾è¡¨çš„æ ‡é¢˜ <code>chart1.title = &quot;æ—¥å‡å€¼å¯¹æ¯”&quot;</code></p><p>åæ ‡çš„æ ‡é¢˜ï¼Œé¦–å…ˆéœ€è¦æ‹¿åˆ°xï¼Œyçš„åæ ‡ã€‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">chart1.y_axis.title = <span class="hljs-string">&#x27;æ•°å€¼&#x27;</span><br>chart1.x_axis.title = st.cell(column=<span class="hljs-number">1</span>, row=<span class="hljs-number">1</span>).value  <span class="hljs-comment"># ç›´æ¥ç”¨å•å…ƒæ ¼çš„å†…å®¹åšæ ‡é¢˜</span><br></code></pre></td></tr></table></figure></p><h3 id="æ·»åŠ å›¾è¡¨"><a href="#æ·»åŠ å›¾è¡¨" class="headerlink" title="æ·»åŠ å›¾è¡¨"></a>æ·»åŠ å›¾è¡¨</h3><p>add_chartå°†å›¾è¡¨æ·»åŠ åˆ°sheetä¸­ã€‚å›¾è¡¨çš„å·¦ä¸Šè§’å¯¹é½æŸä¸ªå•å…ƒæ ¼ã€‚ä¸‹é¢æ˜¯å¯¹é½A8ã€‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">st.add_chart(chart1, <span class="hljs-string">&#x27;A8&#x27;</span>)<br></code></pre></td></tr></table></figure></p><h3 id="3DæŸ±å½¢å›¾-BarChart3D"><a href="#3DæŸ±å½¢å›¾-BarChart3D" class="headerlink" title="3DæŸ±å½¢å›¾ BarChart3D"></a>3DæŸ±å½¢å›¾ BarChart3D</h3><h4 id="æŸ±å­çš„å½¢çŠ¶-shape"><a href="#æŸ±å­çš„å½¢çŠ¶-shape" class="headerlink" title="æŸ±å­çš„å½¢çŠ¶ shape"></a>æŸ±å­çš„å½¢çŠ¶ shape</h4><p>é»˜è®¤æ˜¯ç«‹æ–¹ä½“ï¼Œä½†ä¹Ÿå¯ä»¥ä»ä¸‹é¢çš„å½¢çŠ¶é‡Œé€‰ä¸€ä¸ªã€‚</p><p><code>&#123;&#39;box&#39;, &#39;pyramid&#39;, &#39;pyramidToMax&#39;, &#39;coneToMax&#39;, &#39;cone&#39;, &#39;cylinder&#39;&#125;</code></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">chart1.<span class="hljs-built_in">type</span> = <span class="hljs-string">&#x27;cone&#x27;</span><br></code></pre></td></tr></table></figure><p>box æ˜¯ç«‹æ–¹ä½“ï¼Œä¸­è§„ä¸­çŸ©ã€‚<br>pyramid æ˜¯é‡‘å­—å¡”ï¼Œé¡¶éƒ¨ä¹Ÿæ˜¯å°–çš„ã€‚<br>cone æ˜¯åœ†é”¥ï¼Œçœ‹èµ·æ¥å¾ˆå°–é”ã€‚<br>cylinder æ˜¯åœ†æŸ±ã€‚</p><h4 id="é…è‰²é£æ ¼-style"><a href="#é…è‰²é£æ ¼-style" class="headerlink" title="é…è‰²é£æ ¼ style"></a>é…è‰²é£æ ¼ style</h4><p>style ä¼šå½±å“å›¾è¡¨çš„é…è‰²é£æ ¼ï¼Œä¸€èˆ¬ç”¨10æ¯”è¾ƒå¤šå½©å¤šæ ·ã€‚</p><h3 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h3><p>ç»˜åˆ¶å›¾è¡¨ç”¨çš„æ•°æ®æ¥è‡ª<a href="https://rustfisher.com/2019/11/05/Python/Python-op-excel_openpyxl_use/">è¿è¥çš„PythonæŒ‡å— - Python æ“ä½œExcel</a>ã€‚<br>æˆ‘ä»¬åœ¨å·²æœ‰çš„è¡¨æ ¼ä¸­æ·»åŠ æŸ±å½¢å›¾ã€‚ä»£ç å‚è€ƒ<a href="https://github.com/RustFisher/python-playground">python-playground - Github</a></p><h4 id="ç»˜åˆ¶2DæŸ±å½¢å›¾"><a href="#ç»˜åˆ¶2DæŸ±å½¢å›¾" class="headerlink" title="ç»˜åˆ¶2DæŸ±å½¢å›¾"></a>ç»˜åˆ¶2DæŸ±å½¢å›¾</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_bar_chart_1</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    æ’å…¥æŸ±å½¢å›¾</span><br><span class="hljs-string">    :param file_path: Excel æ–‡ä»¶è·¯å¾„</span><br><span class="hljs-string">    :return: None</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    wb = load_workbook(file_path)<br>    st = wb.active<br><br>    data1 = Reference(st, min_col=<span class="hljs-number">2</span>, min_row=<span class="hljs-number">1</span>, max_row=<span class="hljs-number">7</span>, max_col=<span class="hljs-number">3</span>)<br>    cats1 = Reference(st, min_col=<span class="hljs-number">1</span>, min_row=<span class="hljs-number">2</span>, max_row=<span class="hljs-number">7</span>)<br><br>    chart1 = BarChart()<br>    chart1.<span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;col&quot;</span><br>    chart1.style = <span class="hljs-number">9</span><br>    chart1.title = <span class="hljs-string">&quot;æ—¥å‡å€¼å¯¹æ¯”&quot;</span><br>    <span class="hljs-comment"># chart1.y_axis.title = &#x27;æ•°å€¼&#x27;</span><br>    chart1.x_axis.title = st.cell(column=<span class="hljs-number">1</span>, row=<span class="hljs-number">1</span>).value<br><br>    chart1.add_data(data1, titles_from_data=<span class="hljs-literal">True</span>)<br>    chart1.set_categories(cats1)<br>    chart1.shape = <span class="hljs-number">0</span><br>    st.add_chart(chart1, <span class="hljs-string">&#x27;A8&#x27;</span>)<br>    wb.save(file_path)<br></code></pre></td></tr></table></figure><h4 id="ç»˜åˆ¶3DæŸ±å½¢å›¾"><a href="#ç»˜åˆ¶3DæŸ±å½¢å›¾" class="headerlink" title="ç»˜åˆ¶3DæŸ±å½¢å›¾"></a>ç»˜åˆ¶3DæŸ±å½¢å›¾</h4><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_bar_chart_2</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    æ’å…¥3DæŸ±å½¢å›¾</span><br><span class="hljs-string">    :param file_path: Excel æ–‡ä»¶è·¯å¾„</span><br><span class="hljs-string">    :return: None</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    wb = load_workbook(file_path)<br>    st = wb.active<br><br>    data1 = Reference(st, min_col=<span class="hljs-number">2</span>, min_row=<span class="hljs-number">1</span>, max_row=<span class="hljs-number">7</span>, max_col=<span class="hljs-number">3</span>)<br>    cats1 = Reference(st, min_col=<span class="hljs-number">1</span>, min_row=<span class="hljs-number">2</span>, max_row=<span class="hljs-number">7</span>)<br><br>    chart1 = BarChart3D()<br>    chart1.<span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;bar&quot;</span><br>    chart1.style = <span class="hljs-number">10</span><br>    chart1.title = <span class="hljs-string">&quot;æ—¥å‡å€¼å¯¹æ¯”&quot;</span><br>    chart1.x_axis.title = <span class="hljs-literal">None</span><br>    chart1.shape = <span class="hljs-string">&#x27;cylinder&#x27;</span><br><br>    chart1.add_data(data1, titles_from_data=<span class="hljs-literal">True</span>)<br>    chart1.set_categories(cats1)<br>    st.add_chart(chart1, <span class="hljs-string">&#x27;A26&#x27;</span>)<br>    wb.save(file_path)<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœç¤ºä¾‹å›¾ç‰‡</p><p><img src="py-op-excel-bar-chart-4.png" alt="æ•´ä½“å›¾ç‰‡ - Excelæ‰“å¼€"></p><p>ç›¸å…³ä»£ç è¯·å‚è€ƒ <a href="https://github.com/RustFisher/python-playground">https://github.com/RustFisher/python-playground</a></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è¿è¥çš„PythonæŒ‡å—</tag>
      
      <tag>openpyxl</tag>
      
      <tag>Excel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python openpyxl Excelç»˜åˆ¶æŸ±å½¢å›¾</title>
    <link href="/2019/11/14/Python/Python-openpyxl_charts_Bar_and_Column/"/>
    <url>/2019/11/14/Python/Python-openpyxl_charts_Bar_and_Column/</url>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ä»½<a href="https://openpyxl.readthedocs.io/en/stable/">openpyxl</a>çš„ä½¿ç”¨æŒ‡å—ã€‚</p><p>å¤§ä½“å†…å®¹ç¿»è¯‘è‡ªå®˜ç½‘ <a href="https://openpyxl.readthedocs.io/en/stable/charts/bar.html#vertical-horizontal-and-stacked-bar-charts">https://openpyxl.readthedocs.io/en/stable/charts/bar.html#vertical-horizontal-and-stacked-bar-charts</a></p><p>æœ¬æ–‡åœ¨å®˜ç½‘åŸºç¡€ä¸Šä¼šæœ‰ä¸€äº›æ”¹åŠ¨ã€‚ä»£ç è¯·å‚è€ƒ <a href="https://github.com/RustFisher/python-playground">https://github.com/RustFisher/python-playground</a></p><p>æœ¬æ–‡é“¾æ¥ <a href="https://rustfisher.com/2019/11/14/Python/Python-openpyxl_charts_Bar_and_Column/">https://rustfisher.com/2019/11/14/Python/Python-openpyxl_charts_Bar_and_Column/</a></p><h2 id="æŸ±å½¢å›¾"><a href="#æŸ±å½¢å›¾" class="headerlink" title="æŸ±å½¢å›¾"></a>æŸ±å½¢å›¾</h2><p>æ•°æ®ä¼šè¢«ç»˜åˆ¶æˆå‚ç›´ï¼Œæ°´å¹³æˆ–è€…æ˜¯å±‚å æ•ˆæœçš„æŸ±å½¢å›¾ã€‚</p><p>æ³¨æ„ï¼š</p><ul><li>æ¥ä¸‹æ¥çš„è®¾ç½®ä¼šå½±å“åˆ°ä¸åŒç±»å‹çš„å›¾è¡¨ã€‚</li><li>è®¾ç½®ç±»åˆ«å¯ä»¥æ§åˆ¶æŸ±å½¢å›¾æ˜¯å‚ç›´æˆ–æ˜¯æ°´å¹³ã€‚</li><li>ä½¿ç”¨å±‚å å›¾å½¢æ—¶ï¼Œéœ€è¦è®¾ç½®overlapæˆ100ã€‚</li><li>å¦‚æœæŸ±å½¢æ˜¯æ°´å¹³çš„ï¼Œxå’Œyåæ ‡ä¼šå¯¹è°ƒè¿‡æ¥ã€‚</li></ul><h3 id="2Då›¾è¡¨"><a href="#2Då›¾è¡¨" class="headerlink" title="2Då›¾è¡¨"></a>2Då›¾è¡¨</h3><p><img src="https://openpyxl.readthedocs.io/en/stable/_images/bar.png" alt="2Då›¾è¡¨å‚è€ƒæ•ˆæœå›¾ - åŸæ–‡å›¾ç‰‡"></p><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼Œæ ¹æ®ç»™å®šçš„æ•°æ®ç»˜åˆ¶äº†4å¼ å›¾è¡¨ã€‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> openpyxl <span class="hljs-keyword">import</span> Workbook<br><span class="hljs-keyword">from</span> openpyxl.chart <span class="hljs-keyword">import</span> BarChart, Series, Reference<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">bar_chart_demo</span>():<br>    wb = Workbook(write_only=<span class="hljs-literal">True</span>)<br>    ws = wb.create_sheet()<br><br>    rows = [<br>        (<span class="hljs-string">&#x27;Number&#x27;</span>, <span class="hljs-string">&#x27;Batch 1&#x27;</span>, <span class="hljs-string">&#x27;Batch 2&#x27;</span>),<br>        (<span class="hljs-number">2</span>, <span class="hljs-number">10</span>, <span class="hljs-number">30</span>),<br>        (<span class="hljs-number">3</span>, <span class="hljs-number">40</span>, <span class="hljs-number">60</span>),<br>        (<span class="hljs-number">4</span>, <span class="hljs-number">50</span>, <span class="hljs-number">70</span>),<br>        (<span class="hljs-number">5</span>, <span class="hljs-number">20</span>, <span class="hljs-number">10</span>),<br>        (<span class="hljs-number">6</span>, <span class="hljs-number">10</span>, <span class="hljs-number">40</span>),<br>        (<span class="hljs-number">7</span>, <span class="hljs-number">50</span>, <span class="hljs-number">30</span>),<br>    ]<br><br>    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> rows:<br>        ws.append(row)<br><br>    chart1 = BarChart()<br>    chart1.<span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;col&quot;</span><br>    chart1.style = <span class="hljs-number">10</span><br>    chart1.title = <span class="hljs-string">&quot;Bar Chart&quot;</span><br>    chart1.y_axis.title = <span class="hljs-string">&#x27;Test number&#x27;</span><br>    chart1.x_axis.title = <span class="hljs-string">&#x27;Sample length (mm)&#x27;</span><br><br>    data = Reference(ws, min_col=<span class="hljs-number">2</span>, min_row=<span class="hljs-number">1</span>, max_row=<span class="hljs-number">7</span>, max_col=<span class="hljs-number">3</span>)<br>    cats = Reference(ws, min_col=<span class="hljs-number">1</span>, min_row=<span class="hljs-number">2</span>, max_row=<span class="hljs-number">7</span>)<br>    chart1.add_data(data, titles_from_data=<span class="hljs-literal">True</span>)<br>    chart1.set_categories(cats)<br>    chart1.shape = <span class="hljs-number">4</span><br>    ws.add_chart(chart1, <span class="hljs-string">&quot;A10&quot;</span>)<br><br>    <span class="hljs-keyword">from</span> copy <span class="hljs-keyword">import</span> deepcopy<br><br>    chart2 = deepcopy(chart1)<br>    chart2.style = <span class="hljs-number">11</span><br>    chart2.<span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;bar&quot;</span><br>    chart2.title = <span class="hljs-string">&quot;Horizontal Bar Chart&quot;</span><br><br>    ws.add_chart(chart2, <span class="hljs-string">&quot;I10&quot;</span>)<br><br>    chart3 = deepcopy(chart1)<br>    chart3.<span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;col&quot;</span><br>    chart3.style = <span class="hljs-number">12</span><br>    chart3.grouping = <span class="hljs-string">&quot;stacked&quot;</span><br>    chart3.overlap = <span class="hljs-number">100</span><br>    chart3.title = <span class="hljs-string">&#x27;Stacked Chart&#x27;</span><br><br>    ws.add_chart(chart3, <span class="hljs-string">&quot;A27&quot;</span>)<br><br>    chart4 = deepcopy(chart1)<br>    chart4.<span class="hljs-built_in">type</span> = <span class="hljs-string">&quot;bar&quot;</span><br>    chart4.style = <span class="hljs-number">13</span><br>    chart4.grouping = <span class="hljs-string">&quot;percentStacked&quot;</span><br>    chart4.overlap = <span class="hljs-number">100</span><br>    chart4.title = <span class="hljs-string">&#x27;Percent Stacked Chart&#x27;</span><br><br>    ws.add_chart(chart4, <span class="hljs-string">&quot;I27&quot;</span>)<br><br>    wb.save(<span class="hljs-string">&quot;out/bar.xlsx&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    bar_chart_demo()<br><br></code></pre></td></tr></table></figure></p><blockquote><p>è¯‘è€…æ³¨ï¼šè¿™é‡Œè°ƒæ•´äº†å›¾è¡¨åœ¨excelä¸­çš„ä½ç½®ï¼ŒåŸæ–‡æ˜¯åœ¨<code>G</code>åˆ—ï¼Œå³<code>G10</code>å’Œ<code>G27</code>ï¼Œè¿™é‡Œæ”¹ä¸ºäº†<code>I</code>åˆ—ã€‚ä»£ç æ ¼å¼ä¹Ÿæœ‰å¾®è°ƒã€‚</p></blockquote><p>æˆ‘ä»¬éœ€è¦ç”Ÿæˆå›¾è¡¨çš„æ—¶å€™ï¼ŒExcelä¼šè¦æˆ‘ä»¬å…ˆé€‰å®šæ•°æ®èŒƒå›´ï¼ˆæ¥æºï¼‰ã€‚åœ¨ä»£ç ä¸­ç”¨<code>Reference</code>æ¥æŒ‡å®šæ•°æ®æ¥æºèŒƒå›´ã€‚</p><h3 id="3Då›¾è¡¨"><a href="#3Då›¾è¡¨" class="headerlink" title="3Då›¾è¡¨"></a>3Då›¾è¡¨</h3><p>ç»˜åˆ¶3Då›¾è¡¨ï¼Œä½¿ç”¨<code>BarChart3D</code>ã€‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">bar_3d</span>():<br>    wb = Workbook()<br>    ws = wb.active<br><br>    rows = [<br>        (<span class="hljs-literal">None</span>, <span class="hljs-number">2013</span>, <span class="hljs-number">2014</span>),<br>        (<span class="hljs-string">&quot;Apples&quot;</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>),<br>        (<span class="hljs-string">&quot;Oranges&quot;</span>, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>),<br>        (<span class="hljs-string">&quot;Pears&quot;</span>, <span class="hljs-number">8</span>, <span class="hljs-number">3</span>)<br>    ]<br><br>    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> rows:<br>        ws.append(row)<br><br>    data = Reference(ws, min_col=<span class="hljs-number">2</span>, min_row=<span class="hljs-number">1</span>, max_col=<span class="hljs-number">3</span>, max_row=<span class="hljs-number">4</span>)<br>    titles = Reference(ws, min_col=<span class="hljs-number">1</span>, min_row=<span class="hljs-number">2</span>, max_row=<span class="hljs-number">4</span>)<br>    chart = BarChart3D()<br>    chart.title = <span class="hljs-string">&quot;3D Bar Chart&quot;</span><br>    chart.add_data(data=data, titles_from_data=<span class="hljs-literal">True</span>)<br>    chart.set_categories(titles)<br><br>    ws.add_chart(chart, <span class="hljs-string">&quot;E5&quot;</span>)<br>    wb.save(<span class="hljs-string">&quot;out/bar3d.xlsx&quot;</span>)<br></code></pre></td></tr></table></figure></p><p>åˆ›å»ºå¥½çš„å›¾è¡¨ç”¨WPSæ‰“å¼€å‘ç°æ˜¯2Dçš„ã€‚ç”¨Office Excelæ‰“å¼€æ˜¯3Dçš„ã€‚</p><p><img src="https://openpyxl.readthedocs.io/en/stable/_images/bar3D.png" alt="3Då›¾è¡¨æ•ˆæœå›¾ - åŸæ–‡å›¾ç‰‡"></p><p>ä»£ç è¯·å‚è€ƒ <a href="https://github.com/RustFisher/python-playground">https://github.com/RustFisher/python-playground</a></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>openpyxl</tag>
      
      <tag>Excel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€è¿è¥çš„PythonæŒ‡å—ã€‘Python æ“ä½œExcel</title>
    <link href="/2019/11/05/Python/Python-op-excel_openpyxl_use/"/>
    <url>/2019/11/05/Python/Python-op-excel_openpyxl_use/</url>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ä»½å†™ç»™è¿è¥äººå‘˜çš„PythonæŒ‡å—ã€‚æœ¬æ–‡ä¸»è¦è®²è¿°å¦‚ä½•ä½¿ç”¨Pythonæ“ä½œExcelã€‚å®ŒæˆExcelçš„åˆ›å»ºï¼ŒæŸ¥è¯¢å’Œä¿®æ”¹æ“ä½œã€‚<br>ç›¸å…³ä»£ç è¯·å‚è€ƒ <a href="https://github.com/RustFisher/python-playground">https://github.com/RustFisher/python-playground</a></p><p>æœ¬æ–‡é“¾æ¥ï¼š<a href="https://www.rustfisher.com/2019/11/05/Python/Python-op-excel_openpyxl_use/">https://www.rustfisher.com/2019/11/05/Python/Python-op-excel_openpyxl_use/</a></p><p>å¼€å‘å·¥å…·ï¼Œç¯å¢ƒ</p><ul><li>PyCharm - æ–¹ä¾¿å¥½ç”¨çš„IDE</li><li>Python3</li></ul><p>è¿™é‡Œé»˜è®¤ä½ çš„ç”µè„‘ä¸Šå·²ç»è£…æœ‰python3.xï¼Œç¯å¢ƒå˜é‡å·²ç»é…ç½®å¥½ã€‚</p><h2 id="å¼•å…¥openpyxl"><a href="#å¼•å…¥openpyxl" class="headerlink" title="å¼•å…¥openpyxl"></a>å¼•å…¥openpyxl</h2><p>è¿™é‡Œä½¿ç”¨<a href="https://openpyxl.readthedocs.io/en/stable/">openpyxl</a>åº“æ¥æ“ä½œExcelã€‚ç±»ä¼¼çš„åº“è¿˜æœ‰xlrdã€‚</p><p>penpyxlçš„åŸºç¡€ä½¿ç”¨æ–¹æ³•è¯·å‚è§<a href="http://rustfisher.com/2019/11/03/Python/Python-openpyxl_tutorial/">Python openpyxl å¤„ç†Excelä½¿ç”¨æŒ‡å—</a>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install openpyxl<br></code></pre></td></tr></table></figure><h2 id="æ•°æ®å‡†å¤‡"><a href="#æ•°æ®å‡†å¤‡" class="headerlink" title="æ•°æ®å‡†å¤‡"></a>æ•°æ®å‡†å¤‡</h2><p>å‡å®šæ•°æ®æ¥è‡ªç™¾åº¦æŒ‡æ•°ï¼Œä»¥å¸¸è§çš„ä¸€äº›æœç´¢æŒ‡æ•°ä¸ºä¾‹ã€‚ç»™åé¢çš„æ“ä½œå‡†å¤‡ä¸€äº›æ•°æ®ï¼ŒæŠŠæ•°æ®å†™å…¥Excelä¸­ã€‚</p><p>åˆ›å»ºWorkbookå¯¹è±¡ï¼Œè·å–åˆ°å½“å‰å¯ç”¨çš„è¡¨æ ¼ï¼ˆsheetï¼‰ã€‚<br>ç›´æ¥ä½¿ç”¨<code>append</code>æ–¹æ³•æŠŠä¸€è¡Œæ•°æ®è¿½åŠ å†™å…¥ã€‚æœ€åè°ƒç”¨Workbookçš„ä¿å­˜æ–¹æ³•ï¼Œå­˜å‚¨æ•°æ®ã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_excel_demo</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    åˆ›å»ºExcelæ–‡ä»¶ï¼Œå¹¶å†™å…¥æ•°æ®</span><br><span class="hljs-string">    :param file_path: ç›®æ ‡æ–‡ä»¶è·¯å¾„</span><br><span class="hljs-string">    :return none</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    wb = Workbook()<br>    ws = wb.active<br>    ws.title = <span class="hljs-string">&#x27;æœç´¢æŒ‡æ•°æ¦‚è§ˆ&#x27;</span><br><br>    ws.append([<span class="hljs-string">&#x27;å…³é”®è¯&#x27;</span>, <span class="hljs-string">&#x27;æ•´ä½“æ—¥å‡å€¼&#x27;</span>, <span class="hljs-string">&#x27;ç§»åŠ¨æ—¥å‡å€¼&#x27;</span>, <span class="hljs-string">&#x27;æ•´ä½“åŒæ¯”&#x27;</span>, <span class="hljs-string">&#x27;æ•´ä½“ç¯æ¯”&#x27;</span>, <span class="hljs-string">&#x27;ç§»åŠ¨åŒæ¯”&#x27;</span>, <span class="hljs-string">&#x27;ç§»åŠ¨ç¯æ¯”&#x27;</span>])<br>    ws.append([<span class="hljs-string">&#x27;excel&#x27;</span>, <span class="hljs-number">27782</span>, <span class="hljs-number">18181</span>, -<span class="hljs-number">0.11</span>, -<span class="hljs-number">2</span>, <span class="hljs-number">0.21</span>, <span class="hljs-number">0.02</span>])<br>    ws.append([<span class="hljs-string">&#x27;python&#x27;</span>, <span class="hljs-number">24267</span>, <span class="hljs-number">8204</span>, <span class="hljs-number">0.27</span>, <span class="hljs-number">0.06</span>, <span class="hljs-number">0.56</span>, <span class="hljs-number">0.01</span>])<br>    ws.append([<span class="hljs-string">&#x27;æ–‡æ¡ˆ&#x27;</span>, <span class="hljs-number">2411</span>, <span class="hljs-number">1690</span>, <span class="hljs-number">0.56</span>, <span class="hljs-number">0.33</span>, <span class="hljs-number">0.91</span>, <span class="hljs-number">0.46</span>])<br>    ws.append([<span class="hljs-string">&#x27;okr&#x27;</span>, <span class="hljs-number">1928</span>, <span class="hljs-number">880</span>, <span class="hljs-number">0.38</span>, <span class="hljs-number">0.15</span>, <span class="hljs-number">0.29</span>, <span class="hljs-number">0.09</span>])<br>    ws.append([<span class="hljs-string">&#x27;kpi&#x27;</span>, <span class="hljs-number">4212</span>, <span class="hljs-number">2784</span>, <span class="hljs-number">0.21</span>, -<span class="hljs-number">0.19</span>, <span class="hljs-number">0.36</span>, -<span class="hljs-number">0.22</span>])<br>    wb.save(file_path)<br></code></pre></td></tr></table></figure><p>åˆ›å»ºå‡ºæ¥çš„è¡¨æ ¼ï¼Œç¤ºä¾‹æ•°æ®å¦‚ä¸‹</p><table><thead><tr><th style="text-align:left">å…³é”®è¯</th><th style="text-align:center">æ•´ä½“æ—¥å‡å€¼</th><th style="text-align:center">ç§»åŠ¨æ—¥å‡å€¼</th><th style="text-align:center">æ•´ä½“åŒæ¯”</th><th style="text-align:center">æ•´ä½“ç¯æ¯”</th><th style="text-align:center">ç§»åŠ¨åŒæ¯”</th><th style="text-align:center">ç§»åŠ¨ç¯æ¯”</th></tr></thead><tbody><tr><td style="text-align:left">excel</td><td style="text-align:center">27782</td><td style="text-align:center">18181</td><td style="text-align:center">-0.11</td><td style="text-align:center">-2</td><td style="text-align:center">0.21</td><td style="text-align:center">0.02</td></tr><tr><td style="text-align:left">python</td><td style="text-align:center">24267</td><td style="text-align:center">8204</td><td style="text-align:center">0.27</td><td style="text-align:center">0.06</td><td style="text-align:center">0.56</td><td style="text-align:center">0.01</td></tr><tr><td style="text-align:left">â€¦</td><td style="text-align:center">â€¦</td><td style="text-align:center">â€¦</td><td style="text-align:center">â€¦</td><td style="text-align:center">â€¦</td><td style="text-align:center">â€¦</td><td style="text-align:center">â€¦</td></tr></tbody></table><h2 id="è¯»å–æ•°æ®"><a href="#è¯»å–æ•°æ®" class="headerlink" title="è¯»å–æ•°æ®"></a>è¯»å–æ•°æ®</h2><h3 id="è®¿é—®æ•´ä¸ªè¡¨æ ¼çš„æ•°æ®"><a href="#è®¿é—®æ•´ä¸ªè¡¨æ ¼çš„æ•°æ®" class="headerlink" title="è®¿é—®æ•´ä¸ªè¡¨æ ¼çš„æ•°æ®"></a>è®¿é—®æ•´ä¸ªè¡¨æ ¼çš„æ•°æ®</h3><p>è®¿é—®è¡¨æ ¼ä¸­æ‰€æœ‰çš„æ•°æ®ï¼Œå¹¶æ‰“å°å‡ºæ¥ã€‚<br>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“è¡¨æ ¼ä¸­æœ‰æ•°æ®çš„å•å…ƒæ ¼çš„èŒƒå›´ï¼Œä½¿ç”¨sheet.max_rowä¸sheet.max_columnè·å–è¡¨æ ¼çš„è¡Œåˆ—æ•°é‡ã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_xlsx_basic</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    è¯»å–Excelçš„æ•°æ®å¹¶æ‰“å°å‡ºæ¥</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    wb = load_workbook(file_path)<br>    st = wb.active<br>    end_row = st.max_row + <span class="hljs-number">1</span><br>    end_column = st.max_column + <span class="hljs-number">1</span><br>    <span class="hljs-built_in">print</span>(st.title, <span class="hljs-string">&#x27;æœ‰&#x27;</span>, end_row, <span class="hljs-string">&#x27;è¡Œ&#x27;</span>, end_column, <span class="hljs-string">&#x27;åˆ—&#x27;</span>)<br>    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, end_row):<br>        <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, end_column):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;&#123;:10&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(st.cell(row=row, column=col).value), end=<span class="hljs-string">&#x27;&#x27;</span>)<br>        <span class="hljs-built_in">print</span>()<br></code></pre></td></tr></table></figure><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå•å…ƒæ ¼ä¸‹æ ‡æ˜¯ä»1å¼€å§‹çš„ã€‚å¦‚æœä½¿ç”¨äº†ä¸å½“çš„ä¸‹æ ‡ï¼ŒæŠ¥é”™ä¿¡æ¯</p><blockquote><p>ValueError: Row or column values must be at least 1</p></blockquote><p>å‚è€ƒï¼š <a href="https://stackoverflow.com/questions/34492322/how-to-scan-all-sheet-cells">https://stackoverflow.com/questions/34492322/how-to-scan-all-sheet-cells</a></p><h2 id="ä¿®æ”¹è¡¨æ ¼"><a href="#ä¿®æ”¹è¡¨æ ¼" class="headerlink" title="ä¿®æ”¹è¡¨æ ¼"></a>ä¿®æ”¹è¡¨æ ¼</h2><p>æœ‰äº†Excelè¡¨æ ¼åï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹è¡¨æ ¼çš„ä¸€äº›æ ¼å¼å’Œæ•°æ®ã€‚</p><p><code>st</code>è¡¨ç¤ºå½“å‰è¡¨ã€‚</p><h3 id="è°ƒæ•´åˆ—çš„å®½åº¦"><a href="#è°ƒæ•´åˆ—çš„å®½åº¦" class="headerlink" title="è°ƒæ•´åˆ—çš„å®½åº¦"></a>è°ƒæ•´åˆ—çš„å®½åº¦</h3><p>ç”¨ column_dimensions æ¥è·å–åˆ—ã€‚ä¾‹å¦‚column_dimensions[â€˜Aâ€™]è·å–åˆ°çš„æ˜¯ç¬¬Aåˆ—ã€‚<br><code>ord</code>æ–¹æ³•æ˜¯å°†å­—ç¬¦è½¬æ¢ä¸ºasciiç ã€‚ord(â€˜Aâ€™)å¾—åˆ°65ã€‚</p><p>è¿™é‡Œè°ƒæ•´çš„æ˜¯Aåˆ—åˆ°Gåˆ—çš„å®½åº¦ã€‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;A&#x27;</span>), <span class="hljs-built_in">ord</span>(<span class="hljs-string">&#x27;G&#x27;</span>) + <span class="hljs-number">1</span>):<br>    st.column_dimensions[<span class="hljs-built_in">chr</span>(col)].width = <span class="hljs-number">15</span><br></code></pre></td></tr></table></figure></p><h3 id="è®¾ç½®å•å…ƒæ ¼æ ¼å¼"><a href="#è®¾ç½®å•å…ƒæ ¼æ ¼å¼" class="headerlink" title="è®¾ç½®å•å…ƒæ ¼æ ¼å¼"></a>è®¾ç½®å•å…ƒæ ¼æ ¼å¼</h3><p>æ ¼å¼ï¼Œæ¯”å¦‚å­—ä½“å¤§å°ï¼Œå¯¹é½æ¨¡å¼ï¼Œç²—ä½“æ–œä½“ç­‰ã€‚</p><h4 id="å­—ä½“"><a href="#å­—ä½“" class="headerlink" title="å­—ä½“"></a>å­—ä½“</h4><p>é¦–å…ˆæˆ‘ä»¬è¦æ‹¿åˆ°å•å…ƒæ ¼cellï¼Œè¿™é‡Œä½¿ç”¨st.cell(row=1, column=col)æ¥è·å–æŸä¸€ä¸ªæ ¼å­ã€‚<br>CellæŒæœ‰çš„fontæ˜¯ä¸å¯ä¿®æ”¹çš„ã€‚ä¸èƒ½ä½¿ç”¨å¦‚<code>cell.font.size = 13</code>è¿™æ ·çš„æ“ä½œï¼Œä¼šæŠ¥å¼‚å¸¸ã€‚<br>copyæ–¹æ³•æ˜¯å¤åˆ¶ä¸€ä¸ªå¯¹è±¡ã€‚è¿™é‡Œå¤åˆ¶çš„æ˜¯fontã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py">cell = st.cell(row=<span class="hljs-number">1</span>, column=col)<br>font = copy(cell.font)<br>font.size = <span class="hljs-number">13</span><br>font.bold = <span class="hljs-literal">True</span><br>cell.font = font<br></code></pre></td></tr></table></figure><h4 id="å¯¹é½"><a href="#å¯¹é½" class="headerlink" title="å¯¹é½"></a>å¯¹é½</h4><p>å¯¹é½æ¨¡å¼ã€‚ä½¿ç”¨alignmentå±æ€§ã€‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">cell.alignment = Alignment(horizontal=<span class="hljs-string">&quot;center&quot;</span>, vertical=<span class="hljs-string">&quot;center&quot;</span>)<br></code></pre></td></tr></table></figure></p><h4 id="æ•°æ®æ˜¾ç¤º"><a href="#æ•°æ®æ˜¾ç¤º" class="headerlink" title="æ•°æ®æ˜¾ç¤º"></a>æ•°æ®æ˜¾ç¤º</h4><p>æ“ä½œExcelæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®å•å…ƒæ ¼æ•°æ®æ˜¾ç¤ºçš„æ–¹å¼ï¼Œæ¯”å¦‚å¸¸è§„ï¼Œæ•°å€¼ï¼Œè´§å¸ï¼Œç™¾åˆ†æ¯”ç­‰ç­‰ã€‚<br>è¿™é‡Œä½¿ç”¨çš„æ˜¯number_formatå±æ€§ã€‚</p><p>å¦‚æœæ•°æ®ï¼ˆvalueï¼‰æ˜¯0.02ï¼Œç»è¿‡ä¸‹é¢çš„è®¾ç½®åï¼ŒExcelä¸­æ˜¾ç¤ºçš„æ˜¯2%ã€‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">cell.number_format = <span class="hljs-string">&#x27;0%&#x27;</span><br></code></pre></td></tr></table></figure></p><h4 id="ä¿®æ”¹æ•°æ®"><a href="#ä¿®æ”¹æ•°æ®" class="headerlink" title="ä¿®æ”¹æ•°æ®"></a>ä¿®æ”¹æ•°æ®</h4><p>ä¿®æ”¹å•å…ƒæ ¼çš„æ•°å€¼ï¼ˆvalueï¼‰ã€‚<br>ä¿®æ”¹æ•°æ®é¦–å…ˆè¦æ‹¿åˆ°é‚£ä¸ªå•å…ƒæ ¼cellï¼Œç„¶åå¯¹å…¶valueèµ‹å€¼ã€‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">st.cell(row=<span class="hljs-number">2</span>, column=<span class="hljs-number">7</span>).value = <span class="hljs-number">0.42</span>  <span class="hljs-comment"># ä¿®æ”¹æ•°å€¼</span><br></code></pre></td></tr></table></figure></p><p>ä¿®æ”¹äº†å•å…ƒæ ¼çš„æ ·å¼å’Œæ•°æ®åï¼Œå¯ä»¥æ‰“å¼€è¡¨æ ¼çœ‹çœ‹æ•ˆæœã€‚</p><p>å‚è€ƒï¼š</p><ul><li><a href="https://stackoverflow.com/questions/12387212/openpyxl-setting-number-format">https://stackoverflow.com/questions/12387212/openpyxl-setting-number-format</a></li><li><a href="https://stackoverflow.com/questions/30050716/how-to-put-two-decimals-in-cell-with-type-of-percent">https://stackoverflow.com/questions/30050716/how-to-put-two-decimals-in-cell-with-type-of-percent</a></li></ul><p>ç›¸å…³ä»£ç è¯·å‚è€ƒ <a href="https://github.com/RustFisher/python-playground">https://github.com/RustFisher/python-playground</a></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è¿è¥çš„PythonæŒ‡å—</tag>
      
      <tag>openpyxl</tag>
      
      <tag>Excel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python openpyxl å¤„ç†Excelä½¿ç”¨æŒ‡å—</title>
    <link href="/2019/11/03/Python/Python-openpyxl_tutorial/"/>
    <url>/2019/11/03/Python/Python-openpyxl_tutorial/</url>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ä»½<a href="https://openpyxl.readthedocs.io/en/stable/">openpyxl</a>çš„ä½¿ç”¨æŒ‡å—ã€‚<br>ç¿»è¯‘è‡ªå®˜ç½‘ <a href="https://openpyxl.readthedocs.io/en/stable/tutorial.html">https://openpyxl.readthedocs.io/en/stable/tutorial.html</a></p><p>æœ¬æ–‡é“¾æ¥ <a href="https://rustfisher.com/2019/11/03/Python/Python-openpyxl_tutorial/">https://rustfisher.com/2019/11/03/Python/Python-openpyxl_tutorial/</a></p><h2 id="åˆ›å»ºå·¥ä½œæœ¬"><a href="#åˆ›å»ºå·¥ä½œæœ¬" class="headerlink" title="åˆ›å»ºå·¥ä½œæœ¬"></a>åˆ›å»ºå·¥ä½œæœ¬</h2><p>workbookæŒ‡çš„å°±æ˜¯Excelæ–‡ä»¶ã€‚ä½¿ç”¨openpyxlå¹¶ä¸éœ€è¦ä½ åœ¨ç”µè„‘ä¸Šè‡ªå·±åˆ›å»ºæ–‡ä»¶ã€‚ç›´æ¥å¼•å…¥Workbookç±»å°±å¯ä»¥å¼€å§‹å·¥ä½œã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> openpyxl <span class="hljs-keyword">import</span> Workbook<br><span class="hljs-meta">&gt;&gt;&gt; </span>wb = Workbook()<br></code></pre></td></tr></table></figure><p>è‡³æ­¤ä¸€ä¸ªè‡³å°‘æœ‰1ä¸ªå·¥ä½œè¡¨çš„å·¥ä½œæœ¬å·²ç»è¢«åˆ›å»ºäº†ã€‚ä½ å¯ä»¥é€šè¿‡Workbook.activeå±æ€§æ¥è·å–åˆ°å·¥ä½œè¡¨ã€‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span>ws = wb.active<br></code></pre></td></tr></table></figure></p><blockquote><p>æ³¨æ„ï¼š<br>é»˜è®¤å·¥ä½œè¡¨åºå·æ˜¯è¢«è®¾ç½®æˆ0çš„ã€‚é™¤éä½ ä¿®æ”¹äº†è¿™ä¸ªå€¼ï¼Œå¦åˆ™ç”¨è¿™ä¸ªæ–¹æ³•è·å–åˆ°çš„éƒ½æ˜¯ç¬¬ä¸€å¼ è¡¨ã€‚</p></blockquote><p>å¯ä»¥é€šè¿‡ Workbook.create_sheet() æ–¹æ³•æ¥åˆ›å»ºæ–°çš„å·¥ä½œè¡¨</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span>ws1 = wb.create_sheet(<span class="hljs-string">&quot;Mysheet&quot;</span>) <span class="hljs-comment"># é»˜è®¤åœ¨åé¢æ’å…¥ä¸€å¼ æ–°è¡¨</span><br><span class="hljs-comment"># æˆ–è€…</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>ws2 = wb.create_sheet(<span class="hljs-string">&quot;Mysheet&quot;</span>, <span class="hljs-number">0</span>) <span class="hljs-comment"># åœ¨ç¬¬ä¸€ä½æ’å…¥æ–°è¡¨</span><br><span class="hljs-comment"># æˆ–è€…</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>ws3 = wb.create_sheet(<span class="hljs-string">&quot;Mysheet&quot;</span>, -<span class="hljs-number">1</span>) <span class="hljs-comment"># åœ¨å€’æ•°ç¬¬äºŒçš„ä½ç½®æ’å…¥è¡¨</span><br></code></pre></td></tr></table></figure><p>å·¥ä½œè¡¨è¢«åˆ›å»ºçš„æ—¶å€™ä¼šè‡ªåŠ¨å‘½åï¼Œåå­—æ˜¯ä»¥æ•°å­—åºåˆ—æ¥æ’çš„ï¼ˆä¾‹å¦‚Sheet, Sheet1, Sheet2, â€¦ï¼‰ã€‚<br>å¯ä»¥ä½¿ç”¨ Worksheet.title æ¥ä¿®æ”¹å·¥ä½œè¡¨çš„åå­—ã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">ws.title = <span class="hljs-string">&quot;New Title&quot;</span><br></code></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå·¥ä½œè¡¨åå­—çš„æ ‡é¢˜é¢œè‰²æ˜¯ç™½è‰²çš„ã€‚<br>èµ‹äºˆRGBå€¼ Worksheet.sheet_properties.tabColor æ¥ä¿®æ”¹é¢œè‰²ã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">ws.sheet_properties.tabColor = <span class="hljs-string">&quot;1072BA&quot;</span><br></code></pre></td></tr></table></figure><p>å½“ä½ å‘½åäº†å·¥ä½œè¡¨åï¼Œä¹Ÿå¯ä»¥é€šè¿‡åå­—æ¥è·å–åˆ°è¿™å¼ è¡¨ã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span>ws3 = wb[<span class="hljs-string">&quot;New Title&quot;</span>]<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹å·¥ä½œæœ¬ä¸­æ‰€æœ‰è¡¨æ ¼çš„åå­—ï¼Œä½¿ç”¨ Workbook.sheetname å±æ€§ã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(wb.sheetnames)<br>[<span class="hljs-string">&#x27;Sheet2&#x27;</span>, <span class="hljs-string">&#x27;New Title&#x27;</span>, <span class="hljs-string">&#x27;Sheet1&#x27;</span>]<br></code></pre></td></tr></table></figure><p>å¾ªç¯æ‰“å°åå­—<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> sheet <span class="hljs-keyword">in</span> wb:<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(sheet.title)<br></code></pre></td></tr></table></figure></p><p>åœ¨åŒä¸€ä¸ªå·¥ä½œæœ¬ï¼ˆExcelæ–‡ä»¶ï¼‰ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Workbook.copy_worksheet() å¤åˆ¶è¡¨æ ¼ã€‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span>source = wb.active<br><span class="hljs-meta">&gt;&gt;&gt; </span>target = wb.copy_worksheet(source)<br></code></pre></td></tr></table></figure></p><blockquote><p>æ³¨æ„<br>åªæœ‰å•å…ƒæ ¼ï¼ˆåŒ…æ‹¬æ•°å€¼ï¼Œé£æ ¼ï¼Œè¶…é“¾æ¥å’Œæ³¨é‡Šï¼‰å’Œç¡®å®šçš„å·¥ä½œè¡¨å±æ€§ï¼ˆåŒ…æ‹¬å°ºå¯¸ï¼Œæ ¼å¼å’Œå±æ€§ï¼‰å¯ä»¥è¢«å¤åˆ¶ã€‚<br>å·¥ä½œè¡¨å…¶ä»–çš„å†…å®¹æ˜¯ä¸èƒ½å¤åˆ¶çš„ï¼Œæ¯”å¦‚å›¾ç‰‡ï¼Œå›¾è¡¨ç­‰ã€‚</p></blockquote><p>ä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„Excelæ–‡ä»¶ä¸­å¤åˆ¶è¡¨æ ¼ã€‚å¦‚æœExcelæ–‡ä»¶æ˜¯åªè¯»æˆ–åªå†™çš„ï¼Œå°±ä¸èƒ½å¤åˆ¶è¡¨æ ¼ã€‚</p><h2 id="å¤„ç†æ•°æ®"><a href="#å¤„ç†æ•°æ®" class="headerlink" title="å¤„ç†æ•°æ®"></a>å¤„ç†æ•°æ®</h2><h3 id="å•å…ƒæ ¼"><a href="#å•å…ƒæ ¼" class="headerlink" title="å•å…ƒæ ¼"></a>å•å…ƒæ ¼</h3><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“æ¥å¦‚ä½•è·å–åˆ°å·¥ä½œè¡¨ã€‚æˆ‘ä»¬å¯ä»¥å¼€å§‹ä¿®æ”¹å•å…ƒæ ¼æ•°æ®äº†ã€‚<br>ç”¨å•å…ƒæ ¼çš„åæ ‡å¯ä»¥è·å–åˆ°å•å…ƒæ ¼ã€‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span>c = ws[<span class="hljs-string">&#x27;A4&#x27;</span>]<br></code></pre></td></tr></table></figure><br>è¿”å›çš„æ˜¯A4å•å…ƒæ ¼ã€‚å¦‚æœä¹‹å‰A4ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºA4å•å…ƒæ ¼ã€‚</p><p>ç»™å•å…ƒæ ¼ä¼ å…¥æ•°æ®ï¼Œç›´æ¥èµ‹å€¼<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span>ws[<span class="hljs-string">&#x27;A4&#x27;</span>] = <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure></p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ Worksheet.cell() æ–¹æ³•ï¼Œé€šè¿‡è¡Œåˆ—åºå·çš„æ–¹å¼æ¥æ‹¿åˆ°å•å…ƒæ ¼ã€‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span>d = ws.cell(row=<span class="hljs-number">4</span>, column=<span class="hljs-number">2</span>, value=<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure></p><blockquote><p>æ³¨æ„<br>å¦‚æœå·¥ä½œè¡¨æ˜¯åœ¨å†…å­˜ä¸­åˆ›å»ºçš„ï¼Œå®ƒæ˜¯ä¸åŒ…å«å•å…ƒæ ¼çš„ã€‚ç¬¬ä¸€æ¬¡è·å–å•å…ƒæ ¼æ—¶ä¼šå…ˆåˆ›å»ºå•å…ƒæ ¼ã€‚</p></blockquote><p>è­¦å‘Šï¼šå› ä¸ºè¿™ä¸ªç‰¹æ€§ï¼Œå°±ç®—æ˜¯æ²¡ç»™å•å…ƒæ ¼èµ‹å€¼ï¼Œéå†çš„æ—¶å€™ä¼šç›´æ¥åœ¨å†…å­˜ä¸­åˆ›å»ºå®ƒä»¬ã€‚</p><p>ä¾‹å¦‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">101</span>):<br><span class="hljs-meta">... </span>       <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">101</span>):<br><span class="hljs-meta">... </span>           ws.cell(row=x, column=y)<br></code></pre></td></tr></table></figure><br>ä¼šåœ¨å†…å­˜ä¸­åˆ›å»º 100x100 ä¸ªæ²¡æœ‰å€¼çš„å•å…ƒæ ¼ã€‚</p><h3 id="å¤„ç†å¤šä¸ªå•å…ƒæ ¼"><a href="#å¤„ç†å¤šä¸ªå•å…ƒæ ¼" class="headerlink" title="å¤„ç†å¤šä¸ªå•å…ƒæ ¼"></a>å¤„ç†å¤šä¸ªå•å…ƒæ ¼</h3><p>è·å–ä¸€ä¸ªèŒƒå›´å†…çš„å¤šä¸ªå•å…ƒæ ¼ã€‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span>cell_range = ws[<span class="hljs-string">&#x27;A1&#x27;</span>:<span class="hljs-string">&#x27;C2&#x27;</span>]<br></code></pre></td></tr></table></figure></p><p>è·å–è¡Œæˆ–åˆ—çš„å•å…ƒæ ¼<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span>colC = ws[<span class="hljs-string">&#x27;C&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>col_range = ws[<span class="hljs-string">&#x27;C:D&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>row10 = ws[<span class="hljs-number">10</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>row_range = ws[<span class="hljs-number">5</span>:<span class="hljs-number">10</span>]<br></code></pre></td></tr></table></figure></p><p>ä¹Ÿå¯ä»¥ç”¨ Worksheet.iter_rows() æ–¹æ³•<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> ws.iter_rows(min_row=<span class="hljs-number">1</span>, max_col=<span class="hljs-number">3</span>, max_row=<span class="hljs-number">2</span>):<br><span class="hljs-meta">... </span>   <span class="hljs-keyword">for</span> cell <span class="hljs-keyword">in</span> row:<br><span class="hljs-meta">... </span>       <span class="hljs-built_in">print</span>(cell)<br>&lt;Cell Sheet1.A1&gt;<br>&lt;Cell Sheet1.B1&gt;<br>&lt;Cell Sheet1.C1&gt;<br>&lt;Cell Sheet1.A2&gt;<br>&lt;Cell Sheet1.B2&gt;<br>&lt;Cell Sheet1.C2&gt;<br></code></pre></td></tr></table></figure></p><p>ç±»ä¼¼çš„ Worksheet.iter_cols() ä¹Ÿä¼šè¿”å›åˆ—å•å…ƒæ ¼<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> ws.iter_cols(min_row=<span class="hljs-number">1</span>, max_col=<span class="hljs-number">3</span>, max_row=<span class="hljs-number">2</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">for</span> cell <span class="hljs-keyword">in</span> col:<br><span class="hljs-meta">... </span>        <span class="hljs-built_in">print</span>(cell)<br>&lt;Cell Sheet1.A1&gt;<br>&lt;Cell Sheet1.A2&gt;<br>&lt;Cell Sheet1.B1&gt;<br>&lt;Cell Sheet1.B2&gt;<br>&lt;Cell Sheet1.C1&gt;<br>&lt;Cell Sheet1.C2&gt;<br></code></pre></td></tr></table></figure></p><blockquote><p>æ³¨æ„ï¼šæ€§èƒ½åŸå›  Worksheet.iter_cols() æ–¹æ³•åœ¨åªè¯»æ¨¡å¼ä¸‹ä¸èƒ½ä½¿ç”¨ã€‚</p></blockquote><p>å¦‚æœä½ éœ€è¦éå†æ–‡ä»¶ä¸­çš„æ‰€æœ‰è¡Œåˆ—ï¼Œå¯ä»¥ä½¿ç”¨Worksheet.rows<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span>ws = wb.active<br><span class="hljs-meta">&gt;&gt;&gt; </span>ws[<span class="hljs-string">&#x27;C9&#x27;</span>] = <span class="hljs-string">&#x27;hello world&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">tuple</span>(ws.rows)<br>((&lt;Cell Sheet.A1&gt;, &lt;Cell Sheet.B1&gt;, &lt;Cell Sheet.C1&gt;),<br>(&lt;Cell Sheet.A2&gt;, &lt;Cell Sheet.B2&gt;, &lt;Cell Sheet.C2&gt;),<br>(&lt;Cell Sheet.A3&gt;, &lt;Cell Sheet.B3&gt;, &lt;Cell Sheet.C3&gt;),<br>(&lt;Cell Sheet.A4&gt;, &lt;Cell Sheet.B4&gt;, &lt;Cell Sheet.C4&gt;),<br>(&lt;Cell Sheet.A5&gt;, &lt;Cell Sheet.B5&gt;, &lt;Cell Sheet.C5&gt;),<br>(&lt;Cell Sheet.A6&gt;, &lt;Cell Sheet.B6&gt;, &lt;Cell Sheet.C6&gt;),<br>(&lt;Cell Sheet.A7&gt;, &lt;Cell Sheet.B7&gt;, &lt;Cell Sheet.C7&gt;),<br>(&lt;Cell Sheet.A8&gt;, &lt;Cell Sheet.B8&gt;, &lt;Cell Sheet.C8&gt;),<br>(&lt;Cell Sheet.A9&gt;, &lt;Cell Sheet.B9&gt;, &lt;Cell Sheet.C9&gt;))<br></code></pre></td></tr></table></figure></p><p>æˆ–è€…æ˜¯Worksheet.columnså±æ€§<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">tuple</span>(ws.columns)<br>((&lt;Cell Sheet.A1&gt;,<br>&lt;Cell Sheet.A2&gt;,<br>&lt;Cell Sheet.A3&gt;,<br>&lt;Cell Sheet.A4&gt;,<br>&lt;Cell Sheet.A5&gt;,<br>&lt;Cell Sheet.A6&gt;,<br>...<br>&lt;Cell Sheet.B7&gt;,<br>&lt;Cell Sheet.B8&gt;,<br>&lt;Cell Sheet.B9&gt;),<br>(&lt;Cell Sheet.C1&gt;,<br>&lt;Cell Sheet.C2&gt;,<br>&lt;Cell Sheet.C3&gt;,<br>&lt;Cell Sheet.C4&gt;,<br>&lt;Cell Sheet.C5&gt;,<br>&lt;Cell Sheet.C6&gt;,<br>&lt;Cell Sheet.C7&gt;,<br>&lt;Cell Sheet.C8&gt;,<br>&lt;Cell Sheet.C9&gt;))<br></code></pre></td></tr></table></figure></p><blockquote><p>æ³¨æ„ï¼šåŸºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼ŒWorksheet.columnsåœ¨åªè¯»æ¨¡å¼ä¸­ä¸èƒ½ä½¿ç”¨ã€‚</p></blockquote><h3 id="è¯»å–æ•°æ®"><a href="#è¯»å–æ•°æ®" class="headerlink" title="è¯»å–æ•°æ®"></a>è¯»å–æ•°æ®</h3><p>å¦‚æœåªæ˜¯è¦è¯»å–è¡¨ä¸­çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ Worksheet.valuesã€‚å®ƒä¼šè¿”å›è¡¨ä¸­æ‰€æœ‰è¡Œçš„å•å…ƒæ ¼çš„å€¼ã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> ws.values:<br>   <span class="hljs-keyword">for</span> value <span class="hljs-keyword">in</span> row:<br>     <span class="hljs-built_in">print</span>(value)<br></code></pre></td></tr></table></figure><p>Worksheet.iter_rows() å’Œ Worksheet.iter_cols() éƒ½å¯ä»¥è·å–åˆ°å•å…ƒæ ¼çš„å€¼ã€‚<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&gt;&gt;&gt; <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> ws.iter_rows(<span class="hljs-attribute">min_row</span>=1, <span class="hljs-attribute">max_col</span>=3, <span class="hljs-attribute">max_row</span>=2, <span class="hljs-attribute">values_only</span>=<span class="hljs-literal">True</span>):<br><span class="hljs-built_in">..</span>.   <span class="hljs-built_in">print</span>(row)<br><br>(None, None, None)<br>(None, None, None)<br></code></pre></td></tr></table></figure></p><h3 id="æ•°æ®å­˜å‚¨"><a href="#æ•°æ®å­˜å‚¨" class="headerlink" title="æ•°æ®å­˜å‚¨"></a>æ•°æ®å­˜å‚¨</h3><p>å½“æˆ‘ä»¬æœ‰äº†å•å…ƒæ ¼åï¼Œå¯ä»¥èµ‹å€¼<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span>c.value = <span class="hljs-string">&#x27;hello, world&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(c.value)<br><span class="hljs-string">&#x27;hello, world&#x27;</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span>d.value = <span class="hljs-number">3.14</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(d.value)<br><span class="hljs-number">3.14</span><br></code></pre></td></tr></table></figure></p><h2 id="ä¿å­˜æ–‡ä»¶"><a href="#ä¿å­˜æ–‡ä»¶" class="headerlink" title="ä¿å­˜æ–‡ä»¶"></a>ä¿å­˜æ–‡ä»¶</h2><p>æœ€ç®€å•å’Œæœ€å®‰å…¨çš„ä¿å­˜æ–‡ä»¶çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ Workbook.save()ã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">wb = Workbook()<br>wb.save(<span class="hljs-string">&#x27;balances.xlsx&#x27;</span>)<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨æ²¡æœ‰è­¦å‘Šçš„æƒ…å†µä¸‹è¦†ç›–å·²æœ‰çš„æ–‡ä»¶ã€‚</p><p>æ–‡ä»¶æ‰©å±•åå¹¶æ²¡æœ‰è¢«é™åˆ¶ä¸ºxlsxæˆ–xlsmã€‚</p><h3 id="å­˜å‚¨æˆä¸ºæµï¼ˆstreamï¼‰"><a href="#å­˜å‚¨æˆä¸ºæµï¼ˆstreamï¼‰" class="headerlink" title="å­˜å‚¨æˆä¸ºæµï¼ˆstreamï¼‰"></a>å­˜å‚¨æˆä¸ºæµï¼ˆstreamï¼‰</h3><p>å¦‚æœè¦æŠŠæ–‡ä»¶å­˜æˆæµï¼Œä¾‹å¦‚webåº”ç”¨Pyramid, Flask æˆ–è€…Djangoï¼Œæä¾›ä¸€ä¸ªNamedTemporaryFile()å³å¯<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> tempfile <span class="hljs-keyword">import</span> NamedTemporaryFile<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> openpyxl <span class="hljs-keyword">import</span> Workbook<br><span class="hljs-meta">&gt;&gt;&gt; </span>wb = Workbook()<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">with</span> NamedTemporaryFile() <span class="hljs-keyword">as</span> tmp:<br>        wb.save(tmp.name)<br>        tmp.seek(<span class="hljs-number">0</span>)<br>        stream = tmp.read()<br></code></pre></td></tr></table></figure></p><p>æŠŠå·¥ä½œæœ¬ä¿å­˜æˆä¸ºæ¨¡æ¿ï¼Œéœ€è¦æŒ‡å®šå±æ€§ template=True<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span>wb = load_workbook(<span class="hljs-string">&#x27;document.xlsx&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>wb.template = <span class="hljs-literal">True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>wb.save(<span class="hljs-string">&#x27;document_template.xltx&#x27;</span>)<br></code></pre></td></tr></table></figure></p><p>è®¾templateä¸ºFalseï¼Œå³ä¿å­˜ä¸ºæ–‡æ¡£ã€‚<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span>wb = load_workbook(<span class="hljs-string">&#x27;document_template.xltx&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>wb.template = <span class="hljs-literal">False</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>wb.save(<span class="hljs-string">&#x27;document.xlsx&#x27;</span>, as_template=<span class="hljs-literal">False</span>)<br></code></pre></td></tr></table></figure></p><p>æ³¨æ„ï¼šåœ¨ä¿å­˜æ–‡æ¡£çš„æ—¶å€™åº”è¯¥æ³¨æ„æ–‡ä»¶æ‰©å±•åï¼Œæ¯”å¦‚.xltxå’Œ.xlsxã€‚ä»¥é˜²åé¢ç”¨å…¶ä»–è½¯ä»¶æ‰“å¼€çš„æ—¶å€™é‡åˆ°éº»çƒ¦ã€‚</p><p>æ¥ä¸‹æ¥çš„è¿™äº›æ˜¯é”™è¯¯æ“ä½œ<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">&gt;&gt;&gt; </span>wb = load_workbook(<span class="hljs-string">&#x27;document.xlsx&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># éœ€è¦å­˜å‚¨æˆ*.xlsxæ–‡ä»¶</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>wb.save(<span class="hljs-string">&#x27;new_document.xlsm&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># MS Excel å°†æ— æ³•æ‰“å¼€è¿™ä¸ªæ–‡ä»¶</span><br>&gt;&gt;&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># æˆ–è€…</span><br>&gt;&gt;&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># éœ€è¦æŒ‡å®š keep_vba=True</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>wb = load_workbook(<span class="hljs-string">&#x27;document.xlsm&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>wb.save(<span class="hljs-string">&#x27;new_document.xlsm&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># MS Excel å°†æ— æ³•æ‰“å¼€è¿™ä¸ªæ–‡ä»¶</span><br>&gt;&gt;&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># æˆ–è€…</span><br>&gt;&gt;&gt;<br><span class="hljs-meta">&gt;&gt;&gt; </span>wb = load_workbook(<span class="hljs-string">&#x27;document.xltm&#x27;</span>, keep_vba=<span class="hljs-literal">True</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ¨¡æ¿æ–‡ä»¶ï¼Œæˆ‘ä»¬å¿…é¡»æŒ‡å®šæ‰©å±•åä¸ºxltm</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>wb.save(<span class="hljs-string">&#x27;new_document.xlsm&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># MS Excel å°†æ— æ³•æ‰“å¼€è¿™ä¸ªæ–‡ä»¶</span><br></code></pre></td></tr></table></figure></p><h3 id="è¯»å–æ–‡ä»¶"><a href="#è¯»å–æ–‡ä»¶" class="headerlink" title="è¯»å–æ–‡ä»¶"></a>è¯»å–æ–‡ä»¶</h3><p>å’Œå†™æ–‡ä»¶ç±»ä¼¼ï¼Œä½¿ç”¨openpyxl.load_workbook()æ–¹æ³•å»æ‰“å¼€ä¸€ä¸ªå·²æœ‰æ–‡ä»¶ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> openpyxl <span class="hljs-keyword">import</span> load_workbook<br><span class="hljs-meta">&gt;&gt;&gt; </span>wb2 = load_workbook(<span class="hljs-string">&#x27;test.xlsx&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span> wb2.sheetnames<br>[<span class="hljs-string">&#x27;Sheet2&#x27;</span>, <span class="hljs-string">&#x27;New Title&#x27;</span>, <span class="hljs-string">&#x27;Sheet1&#x27;</span>]<br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>openpyxl</tag>
      
      <tag>Excel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android OkHttp + Retrofit æ–­ç‚¹ç»­ä¼ </title>
    <link href="/2019/10/18/Android/Android-OkHttp_Retrofit_download_file_partial/"/>
    <url>/2019/10/18/Android/Android-OkHttp_Retrofit_download_file_partial/</url>
    
    <content type="html"><![CDATA[<p><a href="https://rustfisher.com/2019/10/18/Android/Android-OkHttp_Retrofit_download_file_partial/">æœ¬æ–‡é“¾æ¥</a></p><p>å‰é¢æˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•<a href="https://rustfisher.com/2019/10/18/Android/Android-OkHttp_Retrofit_download_file/">ä½¿ç”¨OkHttp+Retrofitä¸‹è½½æ–‡ä»¶</a>ã€‚<br>ä¸‹è½½æ–‡ä»¶æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸€äº›æ„å¤–æƒ…å†µï¼Œæ¯”å¦‚ç½‘ç»œé”™è¯¯æˆ–æ˜¯ç”¨æˆ·æš‚åœäº†ä¸‹è½½ã€‚<br>å†æ¬¡å¯åŠ¨ä¸‹è½½ï¼Œå¦‚æœåˆè¦ä»å¤´å¼€å§‹ï¼Œä¼šç™½ç™½æµªè´¹å‰é¢ä¸‹è½½å¥½çš„å†…å®¹ã€‚<br>æ–­ç‚¹ç»­ä¼ åŠŸèƒ½å¯ä»¥ä»ä¸Šæ¬¡åœæ­¢çš„åœ°æ–¹ç»§ç»­ä¸‹è½½æ–‡ä»¶ã€‚</p><h2 id="httpèŒƒå›´è¯·æ±‚"><a href="#httpèŒƒå›´è¯·æ±‚" class="headerlink" title="httpèŒƒå›´è¯·æ±‚"></a>httpèŒƒå›´è¯·æ±‚</h2><p>Range æ˜¯ä¸€ä¸ªè¯·æ±‚é¦–éƒ¨ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨è¿”å›æ–‡ä»¶çš„å“ªä¸€éƒ¨åˆ†ã€‚<br>åœ¨ä¸€ä¸ª Range é¦–éƒ¨ä¸­ï¼Œå¯ä»¥ä¸€æ¬¡æ€§è¯·æ±‚å¤šä¸ªéƒ¨åˆ†ï¼ŒæœåŠ¡å™¨ä¼šä»¥ multipart æ–‡ä»¶çš„å½¢å¼å°†å…¶è¿”å›ã€‚<br>å¦‚æœæœåŠ¡å™¨è¿”å›çš„æ˜¯èŒƒå›´å“åº”ï¼Œéœ€è¦ä½¿ç”¨ 206 Partial Content çŠ¶æ€ç ã€‚<br>å‡å¦‚æ‰€è¯·æ±‚çš„èŒƒå›´ä¸åˆæ³•ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ä¼šè¿”å›  416 Range Not Satisfiable çŠ¶æ€ç ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯é”™è¯¯ã€‚<br>æœåŠ¡å™¨å…è®¸å¿½ç•¥Rangeé¦–éƒ¨ï¼Œä»è€Œè¿”å›æ•´ä¸ªæ–‡ä»¶ï¼ŒçŠ¶æ€ç ç”¨200ã€‚</p><p>ç¤ºä¾‹<br><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">Range: &lt;unit&gt;=&lt;<span class="hljs-keyword">range</span>-<span class="hljs-keyword">start</span>&gt;-<br>Range: &lt;unit&gt;=&lt;<span class="hljs-keyword">range</span>-<span class="hljs-keyword">start</span>&gt;-&lt;<span class="hljs-keyword">range</span>-<span class="hljs-keyword">end</span>&gt;<br>Range: &lt;unit&gt;=&lt;<span class="hljs-keyword">range</span>-<span class="hljs-keyword">start</span>&gt;-&lt;<span class="hljs-keyword">range</span>-<span class="hljs-keyword">end</span>&gt;, &lt;<span class="hljs-keyword">range</span>-<span class="hljs-keyword">start</span>&gt;-&lt;<span class="hljs-keyword">range</span>-<span class="hljs-keyword">end</span>&gt;<br>Range: &lt;unit&gt;=&lt;<span class="hljs-keyword">range</span>-<span class="hljs-keyword">start</span>&gt;-&lt;<span class="hljs-keyword">range</span>-<span class="hljs-keyword">end</span>&gt;, &lt;<span class="hljs-keyword">range</span>-<span class="hljs-keyword">start</span>&gt;-&lt;<span class="hljs-keyword">range</span>-<span class="hljs-keyword">end</span>&gt;, &lt;<span class="hljs-keyword">range</span>-<span class="hljs-keyword">start</span>&gt;-&lt;<span class="hljs-keyword">range</span>-<span class="hljs-keyword">end</span>&gt;<br></code></pre></td></tr></table></figure></p><p>å‘èµ·è¯·æ±‚æ—¶ï¼Œä¸€èˆ¬Rangeçš„å†…å®¹å†™æˆ bytes=0-100 è¿™æ ·çš„å½¢å¼ã€‚<br>æˆ–è€…è¯·æ±‚å¤šä¸ªéƒ¨åˆ†æ—¶ï¼ŒæŒ‡å®šå¤šä¸ªèŒƒå›´ã€‚<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Range</span>: bytes=<span class="hljs-number">200</span>-<span class="hljs-number">1000</span>, <span class="hljs-number">2000</span>-<span class="hljs-number">6576</span>, <span class="hljs-number">19000</span>- <br></code></pre></td></tr></table></figure></p><p>Content-Range è¡¨ç¤ºä¸»ä½“é•¿åº¦æˆ–è€…å°ºå¯¸ã€‚</p><p>å‚è€ƒï¼š</p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Range">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Range</a></p><h2 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h2><p>å‚è€ƒ<br><a href="https://github.com/AnRFDev/android-Basic4/tree/master/appdowloadsample">https://github.com/AnRFDev/android-Basic4/tree/master/appdowloadsample</a></p><p>ä½¿ç”¨OkHttpæ·»åŠ Rangeå¤´éƒ¨ï¼Œå‘ŠçŸ¥æœåŠ¡å™¨æˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶æ•°æ®èŒƒå›´ã€‚</p><p>å®šä¹‰çš„æ–¹æ³•ä¸­è¦æ±‚ä¼ å…¥ @Header(â€œRangeâ€)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiService</span> &#123;<br>    <span class="hljs-meta">@Streaming</span><br>    <span class="hljs-meta">@GET</span><br>    Observable&lt;ResponseBody&gt; <span class="hljs-title function_">downloadPartial</span><span class="hljs-params">(<span class="hljs-meta">@Url</span> String url, <span class="hljs-meta">@Header(&quot;Range&quot;)</span> String range)</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>éœ€è¦ä¼ å…¥çš„Rangeå­—ç¬¦ä¸²å½¢å¦‚ bytes=200-1000</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java">retrofit.create(ApiService.class)<br>    .downloadPartial(callBack.getUrl(), <span class="hljs-string">&quot;bytes=&quot;</span> + startByte + <span class="hljs-string">&quot;-&quot;</span>)<br>    .subscribeOn(Schedulers.newThread())<br>    .observeOn(Schedulers.io())<br>    .doOnNext(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Consumer</span>&lt;ResponseBody&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(ResponseBody responseBody)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            callBack.saveFile(responseBody);<br>        &#125;<br>    &#125;)<br>    .doOnError(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Consumer</span>&lt;Throwable&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Throwable throwable)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            tellDownloadError(callBack.getUrl(), throwable);<br>        &#125;<br>    &#125;)<br>    .observeOn(AndroidSchedulers.mainThread())<br>    .subscribe(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>&lt;ResponseBody&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSubscribe</span><span class="hljs-params">(Disposable d)</span> &#123;<br><br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNext</span><span class="hljs-params">(ResponseBody responseBody)</span> &#123;<br><br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Throwable e)</span> &#123;<br>            callBack.setState(DownloadTaskState.ERROR);<br>            tellDownloadError(callBack.getUrl(), e);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onComplete</span><span class="hljs-params">()</span> &#123;<br><br>        &#125;<br>    &#125;);<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ä¸‹è½½å‰ï¼Œå…ˆå»æ£€æŸ¥æ–‡ä»¶å·²ä¸‹è½½çš„éƒ¨åˆ†çš„å¤§å°ï¼Œå†å†³å®šRangeèŒƒå›´ã€‚<br>ç»­ä¼ æ—¶ï¼Œå†™å…¥æœ¬åœ°æ–‡ä»¶æ³¨æ„é€‰æ‹©æµçš„appendæ¨¡å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">fos = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(file, <span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure><p>æ›´å¤šè¯·å‚è€ƒï¼š</p><p><a href="https://rustfisher.com/2018/08/22/Android/Android-OkHttp_Retrofit_use_intro/">Android OkHttp + Retrofit ä½¿ç”¨ç¤ºä¾‹</a></p><p><a href="https://rustfisher.com/2019/06/26/Android/Android-OkHttp_Retrofit_cancel_request/">Android OkHttp + Retrofit å–æ¶ˆè¯·æ±‚çš„æ–¹æ³•</a></p><p><a href="https://rustfisher.com/2019/10/18/Android/Android-OkHttp_Retrofit_download_file/">Android OkHttp + Retrofit ä¸‹è½½æ–‡ä»¶ä¸è¿›åº¦ç›‘å¬</a></p><p><a href="https://rustfisher.com/2019/10/18/Android/Android-OkHttp_Retrofit_download_file_partial/">Android OkHttp + Retrofit æ–­ç‚¹ç»­ä¼ </a></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>network</tag>
      
      <tag>OkHttp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android OkHttp + Retrofit ä¸‹è½½æ–‡ä»¶ä¸è¿›åº¦ç›‘å¬</title>
    <link href="/2019/10/18/Android/Android-OkHttp_Retrofit_download_file/"/>
    <url>/2019/10/18/Android/Android-OkHttp_Retrofit_download_file/</url>
    
    <content type="html"><![CDATA[<p><a href="https://rustfisher.com/2019/10/18/Android/Android-OkHttp_Retrofit_download_file/">æœ¬æ–‡é“¾æ¥</a></p><p>ä¸‹è½½æ–‡ä»¶æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„éœ€æ±‚ã€‚ç»™å®šä¸€ä¸ªurlï¼Œæˆ‘ä»¬å¯ä»¥<a href="https://rustfisher.com/2019/09/23/Android/Android-Media_download_stream_file/">ä½¿ç”¨URLConnectionä¸‹è½½æ–‡ä»¶</a>ã€‚<br>ä½¿ç”¨OkHttpä¹Ÿå¯ä»¥é€šè¿‡æµæ¥ä¸‹è½½æ–‡ä»¶ã€‚<br>ç»™OkHttpä¸­æ·»åŠ æ‹¦æˆªå™¨ï¼Œå³å¯å®ç°ä¸‹è½½è¿›åº¦çš„ç›‘å¬åŠŸèƒ½ã€‚</p><h2 id="ä½¿ç”¨æµæ¥å®ç°ä¸‹è½½æ–‡ä»¶"><a href="#ä½¿ç”¨æµæ¥å®ç°ä¸‹è½½æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨æµæ¥å®ç°ä¸‹è½½æ–‡ä»¶"></a>ä½¿ç”¨æµæ¥å®ç°ä¸‹è½½æ–‡ä»¶</h2><p>ä»£ç å¯ä»¥å‚è€ƒï¼š<a href="https://github.com/AnRFDev/android-Basic4/tree/master/appdowloadsample">https://github.com/AnRFDev/android-Basic4/tree/master/appdowloadsample</a></p><p>è·å–å¹¶ä½¿ç”¨å­—èŠ‚æµï¼Œéœ€è¦æ³¨æ„ä¸¤ä¸ªè¦ç‚¹ï¼Œä¸€ä¸ªæ˜¯æœåŠ¡æ¥å£æ–¹æ³•çš„ @Streaming æ³¨è§£ï¼Œå¦ä¸€ä¸ªæ˜¯è·å–åˆ°ResponseBodyã€‚</p><p>è·å–æµï¼ˆStreamï¼‰ã€‚å…ˆå®šä¹‰ä¸€ä¸ªæœåŠ¡ApiServiceã€‚ç»™æ–¹æ³•æ·»åŠ ä¸Š@Streamingçš„æ³¨è§£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiService</span> &#123;<br>    <span class="hljs-meta">@Streaming</span><br>    <span class="hljs-meta">@GET</span><br>    Observable&lt;ResponseBody&gt; <span class="hljs-title function_">download</span><span class="hljs-params">(<span class="hljs-meta">@Url</span> String url)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆå§‹åŒ–OkHttpã€‚è®°å¾—å¡«å…¥ä½ çš„baseUrlã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">OkHttpClient</span> <span class="hljs-variable">okHttpClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>.Builder()<br>        .connectTimeout(<span class="hljs-number">8</span>, TimeUnit.SECONDS)<br>        .build();<br><br>retrofit = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Retrofit</span>.Builder()<br>        .client(okHttpClient)<br>        .addCallAdapterFactory(RxJava2CallAdapterFactory.create())<br>        .baseUrl(<span class="hljs-string">&quot;https://yourbaseurl.com&quot;</span>)<br>        .build();<br></code></pre></td></tr></table></figure></p><p>å‘èµ·ç½‘ç»œè¯·æ±‚ã€‚è·å–åˆ°ResponseBodyã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">downUrl</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;xxx.com/aaa.apk&quot;</span>;<br>retrofit.create(ApiService.class)<br>        .download(downUrl)<br>        .subscribeOn(Schedulers.io())<br>        .observeOn(Schedulers.io())<br>        .doOnNext(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Consumer</span>&lt;ResponseBody&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(ResponseBody responseBody)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                <span class="hljs-comment">// å¤„ç† ResponseBody ä¸­çš„æµ</span><br>            &#125;<br>        &#125;)<br>        .doOnError(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Consumer</span>&lt;Throwable&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">accept</span><span class="hljs-params">(Throwable throwable)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>                Log.e(TAG, <span class="hljs-string">&quot;accept on error: &quot;</span> + downUrl, throwable);<br>            &#125;<br>        &#125;)<br>        .observeOn(AndroidSchedulers.mainThread())<br>        .subscribe(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>&lt;ResponseBody&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSubscribe</span><span class="hljs-params">(Disposable d)</span> &#123;<br><br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNext</span><span class="hljs-params">(ResponseBody responseBody)</span> &#123;<br><br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Throwable e)</span> &#123;<br>                Log.e(TAG, <span class="hljs-string">&quot;Download center retrofit onError: &quot;</span>, e);<br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onComplete</span><span class="hljs-params">()</span> &#123;<br><br>            &#125;<br>        &#125;);<br></code></pre></td></tr></table></figure></p><p>é€šè¿‡ResponseBodyæ‹¿åˆ°å­—èŠ‚æµ body.byteStream()ã€‚è¿™é‡Œä¼šå…ˆåˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶tmpFileï¼ŒæŠŠæ•°æ®å†™åˆ°ä¸´æ—¶æ–‡ä»¶é‡Œã€‚<br>ä¸‹è½½å®Œæˆåå†é‡å‘½åæˆç›®æ ‡æ–‡ä»¶targetFileã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveFile</span><span class="hljs-params">(ResponseBody body)</span> &#123;<br>    state = DownloadTaskState.DOWNLOADING;<br>    <span class="hljs-type">byte</span>[] buf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">2048</span>];<br>    <span class="hljs-type">int</span> len;<br>    <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;saveFile: body content length: &quot;</span> + body.contentLength());<br>        srcInputStream = body.byteStream();<br>        <span class="hljs-type">File</span> <span class="hljs-variable">dir</span> <span class="hljs-operator">=</span> tmpFile.getParentFile();<br>        <span class="hljs-keyword">if</span> (dir == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileNotFoundException</span>(<span class="hljs-string">&quot;target file has no dir.&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!dir.exists()) &#123;<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> dir.mkdirs();<br>            onInfo(<span class="hljs-string">&quot;Create dir &quot;</span> + m + <span class="hljs-string">&quot;, &quot;</span> + dir);<br>        &#125;<br>        <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> tmpFile;<br>        <span class="hljs-keyword">if</span> (!file.exists()) &#123;<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> file.createNewFile();<br>            onInfo(<span class="hljs-string">&quot;Create new file &quot;</span> + c);<br>        &#125;<br>        fos = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(file);<br>        <span class="hljs-type">long</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>        <span class="hljs-keyword">while</span> ((len = srcInputStream.read(buf)) != -<span class="hljs-number">1</span> &amp;&amp; !isCancel) &#123;<br>            fos.write(buf, <span class="hljs-number">0</span>, len);<br>            <span class="hljs-type">int</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (System.currentTimeMillis() - time);<br><br>            <span class="hljs-type">int</span> <span class="hljs-variable">overBytes</span> <span class="hljs-operator">=</span> len - downloadBytePerMs() * duration;<br>            <span class="hljs-keyword">if</span> (overBytes &gt; <span class="hljs-number">0</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(overBytes / downloadBytePerMs());<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>            time = System.currentTimeMillis();<br>            <span class="hljs-keyword">if</span> (isCancel) &#123;<br>                state = DownloadTaskState.CLOSING;<br>                srcInputStream.close();<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!isCancel) &#123;<br>            fos.flush();<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">rename</span> <span class="hljs-operator">=</span> tmpFile.renameTo(targetFile);<br>            <span class="hljs-keyword">if</span> (rename) &#123;<br>                setState(DownloadTaskState.DONE);<br>                onSuccess(url);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                setState(DownloadTaskState.ERROR);<br>                onError(url, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">&quot;Rename file fail. &quot;</span> + tmpFile));<br>            &#125;<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (FileNotFoundException e) &#123;<br>        Log.e(TAG, <span class="hljs-string">&quot;saveFile: FileNotFoundException &quot;</span>, e);<br>        setState(DownloadTaskState.ERROR);<br>        onError(url, e);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        Log.e(TAG, <span class="hljs-string">&quot;saveFile: IOException &quot;</span>, e);<br>        setState(DownloadTaskState.ERROR);<br>        onError(url, e);<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (srcInputStream != <span class="hljs-literal">null</span>) &#123;<br>                srcInputStream.close();<br>            &#125;<br>            <span class="hljs-keyword">if</span> (fos != <span class="hljs-literal">null</span>) &#123;<br>                fos.close();<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            Log.e(TAG, <span class="hljs-string">&quot;saveFile&quot;</span>, e);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (isCancel) &#123;<br>            onCancel(url);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></p><p>æ¯æ¬¡è¯»æ•°æ®çš„å¾ªç¯ï¼Œè®¡ç®—è¯»äº†å¤šå°‘æ•°æ®å’Œç”¨äº†å¤šå°‘æ—¶é—´ã€‚è¶…è¿‡é™é€Ÿåä¸»åŠ¨sleepä¸€ä¸‹ï¼Œè¾¾åˆ°æ§åˆ¶ä¸‹è½½é€Ÿåº¦çš„æ•ˆæœã€‚<br>è¦æ³¨æ„ä¸èƒ½sleepå¤ªä¹…ï¼Œä»¥å…socketå…³é—­ã€‚<br>è¿™é‡Œæ§åˆ¶çš„æ˜¯ç½‘ç»œæ•°æ®æµä¸æœ¬åœ°æ–‡ä»¶çš„è¯»å†™é€Ÿåº¦ã€‚</p><h2 id="ä¸‹è½½è¿›åº¦ç›‘å¬"><a href="#ä¸‹è½½è¿›åº¦ç›‘å¬" class="headerlink" title="ä¸‹è½½è¿›åº¦ç›‘å¬"></a>ä¸‹è½½è¿›åº¦ç›‘å¬</h2><p>OkHttpå®ç°ä¸‹è½½è¿›åº¦ç›‘å¬ï¼Œå¯ä»¥ä»å­—èŠ‚æµçš„è¯»å†™é‚£é‡Œå…¥æ‰‹ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨æ‹¦æˆªå™¨ï¼Œå‚è€ƒ<a href="https://github.com/square/okhttp/blob/master/samples/guide/src/main/java/okhttp3/recipes/Progress.java">å®˜æ–¹çš„ä¾‹å­</a>ã€‚<br>è¿™é‡Œç”¨æ‹¦æˆªå™¨çš„æ–¹å¼å®ç°ç½‘ç»œä¸‹è½½è¿›åº¦ç›‘å¬åŠŸèƒ½ã€‚</p><h3 id="å®šä¹‰å›è°ƒä¸ç½‘ç»œæ‹¦æˆªå™¨"><a href="#å®šä¹‰å›è°ƒä¸ç½‘ç»œæ‹¦æˆªå™¨" class="headerlink" title="å®šä¹‰å›è°ƒä¸ç½‘ç»œæ‹¦æˆªå™¨"></a>å®šä¹‰å›è°ƒä¸ç½‘ç»œæ‹¦æˆªå™¨</h3><p>å…ˆå®šä¹‰å›è°ƒã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ProgressListener</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(String url, <span class="hljs-type">long</span> bytesRead, <span class="hljs-type">long</span> contentLength, <span class="hljs-type">boolean</span> done)</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>è‡ªå®šä¹‰ProgressResponseBodyã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProgressResponseBody</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ResponseBody</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ResponseBody responseBody;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ProgressListener progressListener;<br>    <span class="hljs-keyword">private</span> BufferedSource bufferedSource;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String url;<br><br>    ProgressResponseBody(String url, ResponseBody responseBody, ProgressListener progressListener) &#123;<br>        <span class="hljs-built_in">this</span>.responseBody = responseBody;<br>        <span class="hljs-built_in">this</span>.progressListener = progressListener;<br>        <span class="hljs-built_in">this</span>.url = url;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> MediaType <span class="hljs-title function_">contentType</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> responseBody.contentType();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">contentLength</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> responseBody.contentLength();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> BufferedSource <span class="hljs-title function_">source</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (bufferedSource == <span class="hljs-literal">null</span>) &#123;<br>            bufferedSource = Okio.buffer(source(responseBody.source()));<br>        &#125;<br>        <span class="hljs-keyword">return</span> bufferedSource;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> Source <span class="hljs-title function_">source</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Source source)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForwardingSource</span>(source) &#123;<br>            <span class="hljs-type">long</span> <span class="hljs-variable">totalBytesRead</span> <span class="hljs-operator">=</span> <span class="hljs-number">0L</span>;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">read</span><span class="hljs-params">(Buffer sink, <span class="hljs-type">long</span> byteCount)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>                <span class="hljs-type">long</span> <span class="hljs-variable">bytesRead</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.read(sink, byteCount);<br>                <span class="hljs-comment">// read() returns the number of bytes read, or -1 if this source is exhausted.</span><br>                totalBytesRead += bytesRead != -<span class="hljs-number">1</span> ? bytesRead : <span class="hljs-number">0</span>;<br>                progressListener.update(url, totalBytesRead, responseBody.contentLength(), bytesRead == -<span class="hljs-number">1</span>);<br>                <span class="hljs-keyword">return</span> bytesRead;<br>            &#125;<br>        &#125;;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>å®šä¹‰æ‹¦æˆªå™¨ã€‚ä»Responseä¸­è·å–ä¿¡æ¯ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProgressInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Interceptor</span> &#123;<br><br>    <span class="hljs-keyword">private</span> ProgressListener progressListener;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ProgressInterceptor</span><span class="hljs-params">(ProgressListener progressListener)</span> &#123;<br>        <span class="hljs-built_in">this</span>.progressListener = progressListener;<br>    &#125;<br><br>    <span class="hljs-meta">@NotNull</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">intercept</span><span class="hljs-params">(<span class="hljs-meta">@NotNull</span> Chain chain)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">Response</span> <span class="hljs-variable">originalResponse</span> <span class="hljs-operator">=</span> chain.proceed(chain.request());<br>        <span class="hljs-keyword">return</span> originalResponse.newBuilder()<br>                .body(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProgressResponseBody</span>(chain.request().url().url().toString(), originalResponse.body(), progressListener))<br>                .build();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="æ·»åŠ æ‹¦æˆªå™¨"><a href="#æ·»åŠ æ‹¦æˆªå™¨" class="headerlink" title="æ·»åŠ æ‹¦æˆªå™¨"></a>æ·»åŠ æ‹¦æˆªå™¨</h3><p>åœ¨åˆ›å»ºOkHttpClientæ—¶æ·»åŠ ProgressInterceptorã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">OkHttpClient</span> <span class="hljs-variable">okHttpClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>.Builder()<br>        .connectTimeout(<span class="hljs-number">8</span>, TimeUnit.SECONDS)<br>        .addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProgressInterceptor</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ProgressListener</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(String url, <span class="hljs-type">long</span> bytesRead, <span class="hljs-type">long</span> contentLength, <span class="hljs-type">boolean</span> done)</span> &#123;<br>                <span class="hljs-comment">// tellProgress(url, bytesRead, contentLength, done);</span><br>            &#125;<br>        &#125;))<br>        .build();<br></code></pre></td></tr></table></figure></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯è¿™é‡Œçš„è¿›åº¦æ›´æ–°éå¸¸é¢‘ç¹ã€‚å¹¶ä¸ä¸€å®šæ¯æ¬¡å›è°ƒéƒ½è¦å»æ›´æ–°UIã€‚</p><p>æ›´å¤šè¯·å‚è€ƒï¼š</p><p><a href="https://rustfisher.com/2018/08/22/Android/Android-OkHttp_Retrofit_use_intro/">Android OkHttp + Retrofit ä½¿ç”¨ç¤ºä¾‹</a></p><p><a href="https://rustfisher.com/2019/06/26/Android/Android-OkHttp_Retrofit_cancel_request/">Android OkHttp + Retrofit å–æ¶ˆè¯·æ±‚çš„æ–¹æ³•</a></p><p><a href="https://rustfisher.com/2019/10/18/Android/Android-OkHttp_Retrofit_download_file/">Android OkHttp + Retrofit ä¸‹è½½æ–‡ä»¶ä¸è¿›åº¦ç›‘å¬</a></p><p><a href="https://rustfisher.com/2019/10/18/Android/Android-OkHttp_Retrofit_download_file_partial/">Android OkHttp + Retrofit æ–­ç‚¹ç»­ä¼ </a></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>network</tag>
      
      <tag>OkHttp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python ä½¿ç”¨FFmpegæ“ä½œmp4</title>
    <link href="/2019/10/09/Python/Python-FFmpeg-extraction-mp4_tool/"/>
    <url>/2019/10/09/Python/Python-FFmpeg-extraction-mp4_tool/</url>
    
    <content type="html"><![CDATA[<h2 id="ä½¿ç”¨FFmpeg"><a href="#ä½¿ç”¨FFmpeg" class="headerlink" title="ä½¿ç”¨FFmpeg"></a>ä½¿ç”¨FFmpeg</h2><p>é¦–å…ˆå¾—äº†è§£FFmpegçš„ç”¨æ³•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ffmpeg -i red.mkv -f flac -vn red.flac<br></code></pre></td></tr></table></figure><p>å¦‚æœéŸ³é¢‘ï¼ˆè§†é¢‘ï¼‰æ¯”å­—å¹•å¿«ï¼ˆæˆ–æ…¢ï¼‰ï¼Œåˆ™åœ¨è£å‰ªçš„æ—¶å€™ç»Ÿä¸€åŠ ä¸Šæˆ–å‡å»ä¸€ä¸ªæ—¶é—´å·®ã€‚</p><h2 id="FFmpeg"><a href="#FFmpeg" class="headerlink" title="FFmpeg"></a>FFmpeg</h2><p>PyCharm æŠ¥é”™ â€˜ffmpegâ€™ ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åº</p><p>è™šæ‹Ÿç¯å¢ƒä¸­éœ€è¦æ‰¾åˆ°FFmpegçš„ç»å¯¹è·¯å¾„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">ffmpeg_bin = <span class="hljs-string">&#x27;E:/ffmpeg-20191019-31aafda-win64-static/bin/ffmpeg&#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">subprocess.call(get_mp3_cmd, shell=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><h3 id="python-è¯»å–æ–‡ä»¶æ—¶æŠ¥é”™-UnicodeDecodeError-39-gbk-39-codec-can-39-t-decode"><a href="#python-è¯»å–æ–‡ä»¶æ—¶æŠ¥é”™-UnicodeDecodeError-39-gbk-39-codec-can-39-t-decode" class="headerlink" title="python è¯»å–æ–‡ä»¶æ—¶æŠ¥é”™ UnicodeDecodeError: &#39;gbk&#39; codec can&#39;t decode"></a>python è¯»å–æ–‡ä»¶æ—¶æŠ¥é”™ <code>UnicodeDecodeError: &#39;gbk&#39; codec can&#39;t decode</code></h3><p>é”™è¯¯<code>UnicodeEncodeError: â€˜gbk&#39; codec can&#39;t encode character â€˜\xa0&#39; in position</code></p><p>åœ¨ç½‘ä¸Šä¸€æŸ¥ï¼Œå‘ç°æ˜¯ Windows çš„æ§åˆ¶å°çš„é—®é¢˜ã€‚æ§åˆ¶å°çš„ç¼–ç æ˜¯ GBKï¼ŒPython æ˜¯ UTF-8ï¼Œé€ æˆäº†å†²çªã€‚</p><p>ç¬¬ä¸€ç§æ–¹æ³•ï¼šç›´æ¥æ›¿æ¢å‡ºé”™çš„å†…å®¹<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests <br>url = <span class="hljs-string">&#x27;https://blog.csdn.net/jianhong1990/article/details/17349537&#x27;</span><br><span class="hljs-built_in">print</span>(requests.get(url).text.replace(<span class="hljs-string">&#x27;\xa0&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>))<br></code></pre></td></tr></table></figure></p><p>ç¬¬äºŒç§æ–¹æ³•ï¼šå†è§£ç </p><p>å…ˆç”¨ GBK ç¼–ç ï¼ŒåŠ ä¸ª ignore ä¸¢å¼ƒé”™è¯¯çš„å­—ç¬¦ï¼Œç„¶åå†è§£ç ã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> requests<br>url = <span class="hljs-string">&#x27;https://blog.csdn.net/jianhong1990/article/details/17349537&#x27;</span><br><span class="hljs-built_in">print</span>(requests.get(url).text.encode(<span class="hljs-string">&#x27;gbk&#x27;</span>, <span class="hljs-string">&#x27;ignore&#x27;</span>).decode(<span class="hljs-string">&#x27;gbk&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="intä¸stringä¹‹é—´çš„è½¬åŒ–"><a href="#intä¸stringä¹‹é—´çš„è½¬åŒ–" class="headerlink" title="intä¸stringä¹‹é—´çš„è½¬åŒ–"></a>intä¸stringä¹‹é—´çš„è½¬åŒ–</h3><p>strè½¬æˆæ•°å­—<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">ms = <span class="hljs-built_in">int</span>(ms)<br></code></pre></td></tr></table></figure></p><h4 id="æ•°å­—è½¬æˆstr"><a href="#æ•°å­—è½¬æˆstr" class="headerlink" title="æ•°å­—è½¬æˆstr"></a>æ•°å­—è½¬æˆstr</h4><p>è¡¥é›¶<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-string">&#x27;&#123;:0&gt;2d&#125;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-number">1</span>)  <span class="hljs-comment"># output 01</span><br></code></pre></td></tr></table></figure></p><h3 id="è·å–å½“å‰æ—¶é—´"><a href="#è·å–å½“å‰æ—¶é—´" class="headerlink" title="è·å–å½“å‰æ—¶é—´"></a>è·å–å½“å‰æ—¶é—´</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> time<br><br>time.time() <span class="hljs-comment"># æ ¼å¼åŒ–æ—¶é—´æˆ³ä¸ºæ ‡å‡†æ ¼å¼</span><br><span class="hljs-built_in">print</span>(time.strftime(<span class="hljs-string">&#x27;%Y%m%d-%H%M%S&#x27;</span>, time.localtime(time.time())))<br><br><span class="hljs-comment"># è·å–30å¤©å‰çš„æ—¶é—´ï¼ˆé€šè¿‡åŠ å‡ç§’æ•°æ¥è·å–ç°åœ¨æˆ–è€…æœªæ¥æŸä¸ªæ—¶é—´ç‚¹ï¼‰</span><br><span class="hljs-built_in">print</span> time.strftime(<span class="hljs-string">&#x27;%Y.%m.%d&#x27;</span>,time.localtime(time.time()-<span class="hljs-number">2592000</span>))<br></code></pre></td></tr></table></figure><p>å‚è€ƒ</p><ul><li><a href="http://www.zimuku.la/detail/123853.html">http://www.zimuku.la/detail/123853.html</a></li><li><a href="http://assrt.net/">http://assrt.net/</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Android MediaPlayer éŸ³é¢‘å€é€Ÿæ’­æ”¾ï¼Œè°ƒæ•´æ’­æ”¾é€Ÿåº¦</title>
    <link href="/2019/09/25/Android/Android-MediaPlayer_use_play_speed/"/>
    <url>/2019/09/25/Android/Android-MediaPlayer_use_play_speed/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡é“¾æ¥ï¼š <a href="https://rustfisher.com/2019/09/25/Android/Android-MediaPlayer_use_play_speed/">Android MediaPlayer éŸ³é¢‘å€é€Ÿæ’­æ”¾ï¼Œè°ƒæ•´æ’­æ”¾é€Ÿåº¦</a></p><p>ç°åœ¨å¸‚é¢ä¸Šçš„å¾ˆå¤šéŸ³è§†é¢‘Appéƒ½æœ‰å€é€Ÿæ’­æ”¾çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æŠŠæ’­æ”¾é€Ÿåº¦è°ƒæ•´ä¸º0.5ã€1.5ã€2å€ç­‰ç­‰ã€‚</p><p>ä»Android API 23 (Android M)å¼€å§‹ï¼ŒMediaPlayeræ”¯æŒè°ƒæ•´æ’­æ”¾é€Ÿåº¦ã€‚<br>ä½¿ç”¨çš„æ–¹æ³•æ˜¯setPlaybackParamsï¼Œä¼ å…¥ä¸€ä¸ªä»£è¡¨æ’­æ”¾å±æ€§çš„ç±»PlaybackParamsã€‚</p><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•ä½¿ç”¨MediaPlayerè°ƒæ•´æ’­æ”¾é€Ÿåº¦ã€‚</p><h2 id="MediaPlayer-setPlaybackParams-è¯´æ˜"><a href="#MediaPlayer-setPlaybackParams-è¯´æ˜" class="headerlink" title="MediaPlayer.setPlaybackParams è¯´æ˜"></a>MediaPlayer.setPlaybackParams è¯´æ˜</h2><p>æ’­æ”¾é€Ÿåº¦è®¾ç½®åœ¨PlaybackParamså¯¹è±¡ä¸­ï¼Œå†å°†æ­¤å¯¹è±¡ä¼ å…¥setPlaybackParamsã€‚</p><p>setPlaybackParamsæ˜¯ä¸€ä¸ªnativeæ–¹æ³•ã€‚<br>å¦‚æœMediaPlayeræ²¡æœ‰å‡†å¤‡ï¼ˆåœ¨preparedä¹‹å‰ï¼‰ï¼Œè°ƒç”¨æ­¤æ–¹æ³•å¹¶ä¸ä¼šæ”¹å˜MediaPlayerçš„çŠ¶æ€ã€‚<br>åœ¨MediaPlayeræˆåŠŸprepareä¹‹åï¼Œå¦‚æœè®¾ç½®çš„é€Ÿåº¦ä¸º0ï¼Œç›¸å½“äºè°ƒç”¨äº†pauseæ–¹æ³•ï¼›å¦‚æœè®¾ç½®é€Ÿåº¦ä¸ä¸º0ï¼Œç›¸å½“äºè°ƒç”¨äº†startæ–¹æ³•ã€‚</p><h3 id="å¼‚å¸¸æƒ…å†µ"><a href="#å¼‚å¸¸æƒ…å†µ" class="headerlink" title="å¼‚å¸¸æƒ…å†µ"></a>å¼‚å¸¸æƒ…å†µ</h3><p>å¦‚æœMediaPlayeræ²¡æœ‰åˆå§‹åŒ–æˆ–è€…å·²ç»è¢«é‡Šæ”¾ï¼Œå³å¤„äºIdleæˆ–EndçŠ¶æ€ï¼Œè°ƒç”¨setPlaybackParamsæ–¹æ³•ä¼šæŠ›å‡ºIllegalStateExceptionå¼‚å¸¸ã€‚</p><p>å¦‚æœä¼ å…¥çš„PlaybackParamsä¸è¢«æ”¯æŒï¼Œåˆ™æŠ›å‡ºIllegalArgumentExceptionå¼‚å¸¸ã€‚</p><p>å¦‚æœè®¾ç½®é€Ÿåº¦å°äº0ï¼Œåˆ™æŠ›å‡ºjava.lang.IllegalArgumentExceptionå¼‚å¸¸ã€‚</p><h2 id="MediaPlayer-setPlaybackParams-æ–¹æ³•ç¤ºä¾‹"><a href="#MediaPlayer-setPlaybackParams-æ–¹æ³•ç¤ºä¾‹" class="headerlink" title="MediaPlayer.setPlaybackParams æ–¹æ³•ç¤ºä¾‹"></a>MediaPlayer.setPlaybackParams æ–¹æ³•ç¤ºä¾‹</h2><p>è®¾ç½®æ’­æ”¾é€Ÿåº¦ã€‚å…ˆåˆ¤æ–­å½“å‰ç³»ç»Ÿç‰ˆæœ¬ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setPlaySpeed</span><span class="hljs-params">(<span class="hljs-type">float</span> speed)</span> &#123;<br>    <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) &#123;<br>        <span class="hljs-type">PlaybackParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> mediaPlayer.getPlaybackParams();<br>        params.setSpeed(speed);<br>        mediaPlayer.setPlaybackParams(params);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>getPlaybackParamså¯ä»¥è·å–åˆ°MediaPlayerå½“å‰çš„PlaybackParamså¯¹è±¡ã€‚<br>ä¹Ÿå¯ä»¥ç»™è¿™ä¸ªæ–¹æ³•åŠ ä¸Štry catchï¼Œç»“åˆè¿”å›çš„booleanå€¼åˆ¤æ–­è®¾ç½®é€Ÿåº¦æ˜¯å¦æˆåŠŸã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setPlaySpeed</span><span class="hljs-params">(<span class="hljs-type">float</span> speed)</span> &#123;<br>    <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">PlaybackParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> mediaPlayer.getPlaybackParams();<br>            params.setSpeed(speed);<br>            mediaPlayer.setPlaybackParams(params);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            Log.e(TAG, <span class="hljs-string">&quot;setPlaySpeed: &quot;</span>, e);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å‚è€ƒä»£ç  <a href="https://github.com/RustFisher/android-MediaPlayer">https://github.com/RustFisher/android-MediaPlayer</a></p><h2 id="PlaybackParams-åŒ…å«çš„é€Ÿåº¦å€¼"><a href="#PlaybackParams-åŒ…å«çš„é€Ÿåº¦å€¼" class="headerlink" title="PlaybackParams åŒ…å«çš„é€Ÿåº¦å€¼"></a>PlaybackParams åŒ…å«çš„é€Ÿåº¦å€¼</h2><p>è°ƒæ•´MediaPlayeræ’­æ”¾é€Ÿåº¦æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†PlaybackParamså¯¹è±¡ã€‚AudioTrackä¹Ÿä¼šç”¨åˆ°è¿™ä¸ªç±»ã€‚</p><p>PlaybackParamsåŒ…å«ç€æ’­æ”¾æ—¶å€™çš„ä¸€äº›å±æ€§ã€‚ä¾‹å¦‚speedå°±æ˜¯æ’­æ”¾é€Ÿåº¦ã€‚</p><h3 id="PlaybackParams-setSpeed-float-speed"><a href="#PlaybackParams-setSpeed-float-speed" class="headerlink" title="PlaybackParams.setSpeed(float speed)"></a>PlaybackParams.setSpeed(float speed)</h3><p>ä¼ å…¥é€Ÿåº¦å€ç‡å€¼ã€‚ä¼šæ ‡è®°å½“å‰è®¾ç½®è¿‡äº†é€Ÿåº¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> PlaybackParams <span class="hljs-title function_">setSpeed</span><span class="hljs-params">(<span class="hljs-type">float</span> speed)</span> &#123;<br>    mSpeed = speed;<br>    mSet |= SET_SPEED;<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="PlaybackParams-getSpeed"><a href="#PlaybackParams-getSpeed" class="headerlink" title="PlaybackParams.getSpeed()"></a>PlaybackParams.getSpeed()</h3><p>è·å–å·²è®¾ç½®çš„é€Ÿåº¦å€¼ã€‚å¦‚æœä¹‹å‰æ²¡è®¾ç½®è¿‡é€Ÿåº¦ï¼Œåˆ™æŠ›å‡ºIllegalStateExceptionå¼‚å¸¸ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getSpeed</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span> ((mSet &amp; SET_SPEED) == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;speed not set&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> mSpeed;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ›´å¤šå‚è€ƒï¼š</p><p><a href="https://rustfisher.com/2019/09/19/Android/Android-MediaPlayer_intro/">Android MediaPlayer åŸºç¡€ç®€ä»‹</a></p><p><a href="https://rustfisher.com/2019/09/22/Android/Android-MediaPlayer_use_play_audio/">Android MediaPlayer æ’­æ”¾éŸ³é¢‘</a></p><p><a href="https://rustfisher.com/2019/09/23/Android/Android-Media_download_stream_file/">Android ä½¿ç”¨URLConnectionä¸‹è½½éŸ³é¢‘æ–‡ä»¶</a></p><p><a href="https://rustfisher.com/2019/09/25/Android/Android-MediaPlayer_use_play_speed/">Android MediaPlayer éŸ³é¢‘å€é€Ÿæ’­æ”¾ï¼Œè°ƒæ•´æ’­æ”¾é€Ÿåº¦</a></p><p>AndroidéŸ³è§†é¢‘ç›¸å…³æ–‡ç« è¯·å‚è€ƒ <a href="https://rustfisher.com/tags/Android-Media/">https://rustfisher.com/tags/Android-Media/</a></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android_Media</tag>
      
      <tag>Media</tag>
      
      <tag>MediaPlayer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android ä½¿ç”¨URLConnectionä¸‹è½½éŸ³é¢‘æ–‡ä»¶</title>
    <link href="/2019/09/23/Android/Android-Media_download_stream_file/"/>
    <url>/2019/09/23/Android/Android-Media_download_stream_file/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡é“¾æ¥ï¼š <a href="https://rustfisher.com/2019/09/23/Android/Android-Media_download_stream_file/">Android ä½¿ç”¨URLConnectionä¸‹è½½éŸ³é¢‘æ–‡ä»¶</a></p><p>ä½¿ç”¨MediaPlayeræ’­æ”¾åœ¨çº¿éŸ³é¢‘ï¼Œè¯·å‚è€ƒ<a href="https://rustfisher.com/2019/09/22/Android/Android-MediaPlayer_use_play_audio/">Android MediaPlayer æ’­æ”¾éŸ³é¢‘</a></p><p>æœ‰æ—¶å€™æˆ‘ä»¬ä¼šéœ€è¦ä¸‹è½½éŸ³é¢‘æ–‡ä»¶ã€‚è¿™é‡Œæä¾›ä¸€ç§æ€è·¯ï¼Œå°†åœ¨çº¿éŸ³é¢‘æ–‡ä»¶é€šè¿‡æµå†™åˆ°æœ¬åœ°æ–‡ä»¶ä¸­ã€‚<br>ä½¿ç”¨URLConnectionæ¥å»ºç«‹è¿æ¥ï¼Œè·å–åˆ°çš„æ•°æ®å†™åˆ°æ–‡ä»¶ä¸­ã€‚</p><p>URLConnectionå»ºç«‹è¿æ¥åï¼Œå¯ä»¥è·å–åˆ°æ•°æ®é•¿åº¦ã€‚ç”±æ­¤æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºä¸‹è½½è¿›åº¦ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DownloadStreamThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br>    String urlStr;<br>    <span class="hljs-keyword">final</span> String targetFileAbsPath;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DownloadStreamThread</span><span class="hljs-params">(String urlStr, String targetFileAbsPath)</span> &#123;<br>        <span class="hljs-built_in">this</span>.urlStr = urlStr;<br>        <span class="hljs-built_in">this</span>.targetFileAbsPath = targetFileAbsPath;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.run();<br>        <span class="hljs-type">int</span> count;<br>        <span class="hljs-type">File</span> <span class="hljs-variable">targetFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(targetFileAbsPath);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> targetFile.createNewFile();<br>            Log.d(TAG, <span class="hljs-string">&quot;Create new file: &quot;</span> + n + <span class="hljs-string">&quot;, &quot;</span> + targetFile);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            Log.e(TAG, <span class="hljs-string">&quot;run: &quot;</span>, e);<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">URL</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URL</span>(urlStr);<br>            <span class="hljs-type">URLConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> url.openConnection();<br>            connection.connect();<br>            <span class="hljs-type">int</span> <span class="hljs-variable">contentLength</span> <span class="hljs-operator">=</span> connection.getContentLength();<br>            <span class="hljs-type">InputStream</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedInputStream</span>(url.openStream());<br>            <span class="hljs-type">OutputStream</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(targetFileAbsPath);<br><br>            <span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br>            <span class="hljs-type">long</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">while</span> ((count = input.read(buffer)) != -<span class="hljs-number">1</span>) &#123;<br>                total += count;<br>                Log.d(TAG, String.format(Locale.CHINA, <span class="hljs-string">&quot;Download progress: %.2f%%&quot;</span>, <span class="hljs-number">100</span> * (total / (<span class="hljs-type">double</span>) contentLength)));<br>                output.write(buffer, <span class="hljs-number">0</span>, count);<br>            &#125;<br>            output.flush();<br>            output.close();<br>            input.close();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            Log.e(TAG, <span class="hljs-string">&quot;run: &quot;</span>, e);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></p><p>å¯åŠ¨ä¸‹è½½ï¼Œå³å¯åŠ¨çº¿ç¨‹ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">new</span> <span class="hljs-title class_">DownloadStreamThread</span>(urlStr, targetFileAbsPath).start();<br></code></pre></td></tr></table></figure></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæœ¬åœ°å·²ç»æœ‰äº†æ–‡ä»¶ï¼Œéœ€è¦åšä¸€äº›é€»è¾‘åˆ¤æ–­ã€‚ä¾‹å¦‚æ˜¯å¦åˆ æ‰æ—§æ–‡ä»¶ï¼Œé‡æ–°ä¸‹è½½ã€‚æˆ–æ˜¯åˆ¤æ–­å‡ºå·²æœ‰æ–‡ä»¶ï¼Œä¸­æ­¢æ­¤æ¬¡ä¸‹è½½ä»»åŠ¡ã€‚<br>ä¾‹å¦‚å¯ä»¥ç”¨connection.getContentLength()ä¸å½“å‰æ–‡ä»¶é•¿åº¦æ¥æ¯”è¾ƒï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™åˆ æ‰æœ¬åœ°æ–‡ä»¶ï¼Œé‡æ–°ä¸‹è½½ã€‚</p><p>å®é™…ä¸Šï¼ŒURLConnectionèƒ½å¤„ç†å¾ˆå¤šæµåª’ä½“ã€‚åœ¨è¿™é‡Œæ˜¯ç”¨æ¥ä¸‹è½½éŸ³é¢‘æ–‡ä»¶ã€‚å¯ä»¥å®ç°ä¸‹è½½åŠŸèƒ½å’Œç±»ä¼¼â€œè¾¹ä¸‹è¾¹æ’­â€çš„åŠŸèƒ½ã€‚</p><p>ä»£ç å¯ä»¥å‚è€ƒç¤ºä¾‹å·¥ç¨‹ï¼š <a href="https://github.com/RustFisher/android-MediaPlayer">https://github.com/RustFisher/android-MediaPlayer</a></p><p>æ›´å¤šå‚è€ƒï¼š</p><p><a href="https://rustfisher.com/2019/09/19/Android/Android-MediaPlayer_intro/">Android MediaPlayer åŸºç¡€ç®€ä»‹</a></p><p><a href="https://rustfisher.com/2019/09/22/Android/Android-MediaPlayer_use_play_audio/">Android MediaPlayer æ’­æ”¾éŸ³é¢‘</a></p><p><a href="https://rustfisher.com/2019/09/23/Android/Android-Media_download_stream_file/">Android ä½¿ç”¨URLConnectionä¸‹è½½éŸ³é¢‘æ–‡ä»¶</a></p><p><a href="https://rustfisher.com/2019/09/25/Android/Android-MediaPlayer_use_play_speed/">Android MediaPlayer éŸ³é¢‘å€é€Ÿæ’­æ”¾ï¼Œè°ƒæ•´æ’­æ”¾é€Ÿåº¦</a></p><p>AndroidéŸ³è§†é¢‘ç›¸å…³æ–‡ç« è¯·å‚è€ƒ <a href="https://rustfisher.com/tags/Android-Media/">https://rustfisher.com/tags/Android-Media/</a></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android_Media</tag>
      
      <tag>Media</tag>
      
      <tag>Network</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android MediaPlayer æ’­æ”¾éŸ³é¢‘</title>
    <link href="/2019/09/22/Android/Android-MediaPlayer_use_play_audio/"/>
    <url>/2019/09/22/Android/Android-MediaPlayer_use_play_audio/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡é“¾æ¥ï¼š <a href="https://rustfisher.com/2019/09/22/Android/Android-MediaPlayer_use_play_audio/">Android MediaPlayer æ’­æ”¾éŸ³é¢‘</a></p><p>ä¸»è¦ä»‹ç»ä½¿ç”¨MediaPlayeræ’­æ”¾éŸ³é¢‘çš„æ–¹å¼ã€‚å…³äºMediaPlayerçš„åŸºç¡€çŸ¥è¯†ï¼Œæ¯”å¦‚çŠ¶æ€ï¼Œå¯ä»¥å‚è€ƒ<a href="https://rustfisher.com/2019/09/19/Android/Android-MediaPlayer_intro/">Android MediaPlayer åŸºç¡€ç®€ä»‹</a>ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿è¡¨è¾¾ï¼Œå®šä¹‰å˜é‡åä¸ºmediaPlayerã€‚</p><h2 id="MediaPlayerçš„ä½¿ç”¨æ–¹å¼"><a href="#MediaPlayerçš„ä½¿ç”¨æ–¹å¼" class="headerlink" title="MediaPlayerçš„ä½¿ç”¨æ–¹å¼"></a>MediaPlayerçš„ä½¿ç”¨æ–¹å¼</h2><h3 id="åˆ›å»ºMediaPlayer"><a href="#åˆ›å»ºMediaPlayer" class="headerlink" title="åˆ›å»ºMediaPlayer"></a>åˆ›å»ºMediaPlayer</h3><p>å¯ä»¥ç›´æ¥ new MediaPlayerï¼Œä¹Ÿå¯ä»¥ç”¨MediaPlayeræä¾›çš„createæ–¹æ³•åˆ›å»ºã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">mediaPlayer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>();<br></code></pre></td></tr></table></figure></p><p>ä½¿ç”¨createæ–¹æ³•åˆ›å»ºæˆåŠŸåï¼ŒmediaPlayerå¤„äºPreparedçŠ¶æ€ã€‚å¯ä»¥ç›´æ¥startæ’­æ”¾ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">mediaPlayer = MediaPlayer.create(getApplicationContext(), Uri.fromFile(file));<br>mediaPlayer.start();<br></code></pre></td></tr></table></figure></p><h3 id="è®¾ç½®éŸ³æº-setDataSource"><a href="#è®¾ç½®éŸ³æº-setDataSource" class="headerlink" title="è®¾ç½®éŸ³æº - setDataSource"></a>è®¾ç½®éŸ³æº - setDataSource</h3><p>é€šè¿‡è°ƒç”¨<code>setDataSource</code>æ¥è®¾ç½®éŸ³æºã€‚<code>setDataSource</code>æœ‰å¤šä¸ªé‡è½½æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹å¸¸ç”¨çš„å‡ ç§ã€‚</p><p>ä¾‹å¦‚è®¾ç½®ä½¿ç”¨assetsé‡Œçš„èµ„æºã€‚å®é™…æƒ…å†µå¯èƒ½éœ€è¦try catchã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">AssetFileDescriptor</span> <span class="hljs-variable">fd</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><span class="hljs-type">MediaPlayer</span> <span class="hljs-variable">mediaPlayer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>();<br>fd = context.getApplicationContext().getAssets().openFd(name);<br>mediaPlayer.setDataSource(fd.getFileDescriptor(), fd.getStartOffset(), fd.getLength());<br></code></pre></td></tr></table></figure></p><p>æœ¬åœ°æ–‡ä»¶ï¼Œéœ€è¦æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">mediaPlayer.setDataSource(file.getAbsolutePath());<br></code></pre></td></tr></table></figure></p><p>æˆ–è€…è·å–æ–‡ä»¶çš„Uriæ¥åˆ›å»ºmediaPlayerã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">mediaPlayer = MediaPlayer.create(getApplicationContext(), Uri.fromFile(file));<br></code></pre></td></tr></table></figure></p><p>è®¾ç½®ç½‘ç»œéŸ³é¢‘ï¼Œä¹Ÿæ˜¯ç”¨setDataSourceæ–¹æ³•ï¼Œè®¾ç½®urlã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">mediaPlayer.setDataSource(<span class="hljs-string">&quot;https://demo.com/sample.mp3&quot;</span>));<br></code></pre></td></tr></table></figure></p><p>æ’­æ”¾ç½‘ç»œéŸ³é¢‘æ—¶ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯httpï¼Œæœ‰å¯èƒ½ä¼šæŠ¥é”™<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">java<span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.IOException</span>: Cleartext HTTP traffic to demo<span class="hljs-selector-class">.com</span> not permitted<br></code></pre></td></tr></table></figure></p><p>å¯ä»¥ç®€å•åœ°è®¾ç½®ä¸€ä¸‹manifestï¼Œè®¾ç½®usesCleartextTraffic=â€trueâ€<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">application</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:usesCleartextTraffic</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure></p><h3 id="å‡†å¤‡-prepare"><a href="#å‡†å¤‡-prepare" class="headerlink" title="å‡†å¤‡ - prepare"></a>å‡†å¤‡ - prepare</h3><p>åŒæ­¥å’Œå¼‚æ­¥å‡†å¤‡éŸ³é¢‘èµ„æºã€‚prepareAsync()æ˜¯å¼‚æ­¥çš„æ–¹å¼ï¼Œprepareæ˜¯åŒæ­¥çš„ã€‚æ³¨æ„çº¿ç¨‹è°ƒåº¦é—®é¢˜ï¼ŒåŒæ—¶ä¸è¦é˜»å¡UIçº¿ç¨‹ã€‚</p><p>ä½¿ç”¨å¼‚æ­¥æ–¹å¼å‡†å¤‡éŸ³é¢‘ï¼Œç»å¸¸ä¸MediaPlayer.OnPreparedListenerç›‘å¬å™¨é…åˆä½¿ç”¨ã€‚å¼‚æ­¥å‡†å¤‡æ—¶ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œå…¶ä»–çš„è®¾ç½®ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">mediaPlayer.prepareAsync();<br>mediaPlayer.setOnPreparedListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>.OnPreparedListener() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPrepared</span><span class="hljs-params">(MediaPlayer mediaPlayer)</span> &#123;<br>        mediaPlayer.start(); <span class="hljs-comment">// å‡†å¤‡å¥½äº†å°±æ’­æ”¾</span><br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure></p><h3 id="å¾ªç¯æ’­æ”¾-Looping"><a href="#å¾ªç¯æ’­æ”¾-Looping" class="headerlink" title="å¾ªç¯æ’­æ”¾ - Looping"></a>å¾ªç¯æ’­æ”¾ - Looping</h3><p>è®¾ç½®å¾ªç¯æ’­æ”¾setLoopingã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">mediaPlayer.setLooping(<span class="hljs-literal">true</span>);<br></code></pre></td></tr></table></figure><br>æ’­æ”¾å®Œæ¯•åï¼Œä¸ä¼šå›è°ƒOnCompletionListenerï¼Œè€Œæ˜¯ä»å¤´æ’­æ”¾å½“å‰éŸ³é¢‘ã€‚</p><h3 id="æ’­æ”¾-start"><a href="#æ’­æ”¾-start" class="headerlink" title="æ’­æ”¾ - start"></a>æ’­æ”¾ - start</h3><p>æ’­æ”¾éŸ³é¢‘ï¼Œè°ƒç”¨startæ–¹æ³•ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">mediaPlayer.start();<br></code></pre></td></tr></table></figure></p><p>å¤„äºPreparedï¼ŒPauseå’ŒPlaybackCompleteçŠ¶æ€æ—¶ï¼Œå¯ä»¥è°ƒç”¨startæ–¹æ³•ï¼Œè¿›å…¥StartedçŠ¶æ€ã€‚</p><h3 id="æš‚åœ-pause"><a href="#æš‚åœ-pause" class="headerlink" title="æš‚åœ - pause"></a>æš‚åœ - pause</h3><p>æš‚åœæ’­æ”¾ï¼Œä½¿ç”¨pauseæ–¹æ³•ã€‚åœ¨æš‚åœå‰å…ˆåˆ¤æ–­ä¸€ä¸‹mediaPlayerçš„æ˜¯å¦åœ¨æ’­æ”¾ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (mediaPlayer.isPlaying()) &#123;<br>    mediaPlayer.pause();<br>&#125;<br></code></pre></td></tr></table></figure><p>æš‚åœæˆåŠŸåˆ™å¤„äºPausedçŠ¶æ€ã€‚</p><h3 id="åœæ­¢-stop"><a href="#åœæ­¢-stop" class="headerlink" title="åœæ­¢ - stop"></a>åœæ­¢ - stop</h3><p>å›é¡¾ä¸€ä¸‹MediaPlayerçŠ¶æ€åˆ‡æ¢çš„å›¾ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥åœ¨æ’­æ”¾ä¸­ï¼Œæš‚åœï¼Œæ’­æ”¾å®Œæˆè¿™3ä¸ªçŠ¶æ€ä¸‹ï¼Œå¯ä»¥è°ƒç”¨stopæ–¹æ³•ï¼Œè¿›å…¥StoppedçŠ¶æ€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">mediaPlayer.stop();<br></code></pre></td></tr></table></figure><h3 id="è°ƒè¿›åº¦-seekTo"><a href="#è°ƒè¿›åº¦-seekTo" class="headerlink" title="è°ƒè¿›åº¦ - seekTo"></a>è°ƒè¿›åº¦ - seekTo</h3><p>è°ƒæ•´æ’­æ”¾è¿›åº¦ã€‚æˆ‘ä»¬å¹³æ—¶ä½¿ç”¨éŸ³ä¹æ’­æ”¾è½¯ä»¶ä¸€èˆ¬éƒ½ä¼šæœ‰è¿™ä¸ªåŠŸèƒ½ã€‚<br>seekToæ–¹æ³•æ¥å—ä¸€ä¸ªæ¯«ç§’å‚æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> <span class="hljs-variable">targetMS</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (percent * mediaPlayer.getDuration());<br>mediaPlayer.seekTo(targetMS);<br></code></pre></td></tr></table></figure><p>seekToå¹¶ä¸ä¼šæ”¹å˜MediaPlayerçš„çŠ¶æ€ã€‚</p><h3 id="é‡ç½®-reset"><a href="#é‡ç½®-reset" class="headerlink" title="é‡ç½® - reset"></a>é‡ç½® - reset</h3><p>resetåçš„mediaPlayerè¿›å…¥IdleçŠ¶æ€ã€‚éœ€è¦é‡æ–°è®¾ç½®éŸ³æºä¸å‡†å¤‡ã€‚</p><h3 id="é‡Šæ”¾-release"><a href="#é‡Šæ”¾-release" class="headerlink" title="é‡Šæ”¾ - release"></a>é‡Šæ”¾ - release</h3><p>ä¸å†ä½¿ç”¨è¿™ä¸ªmediaPlayeræ—¶ï¼Œåº”å½“å°½å¿«é‡Šæ”¾æ‰ï¼Œä»¥é‡Šæ”¾ç›¸å…³çš„èµ„æºã€‚<br>è°ƒç”¨releaseåï¼ŒmediaPlayerè¿›å…¥EndçŠ¶æ€ã€‚æ­¤æ—¶è¿™ä¸ªmediaPlayerå°±ä¸èƒ½å†ä½¿ç”¨äº†ã€‚</p><h2 id="å¸¸ç”¨ç›‘å¬å™¨"><a href="#å¸¸ç”¨ç›‘å¬å™¨" class="headerlink" title="å¸¸ç”¨ç›‘å¬å™¨"></a>å¸¸ç”¨ç›‘å¬å™¨</h2><h3 id="ç¼“å†²ç›‘å¬å™¨-OnBufferingUpdateListener"><a href="#ç¼“å†²ç›‘å¬å™¨-OnBufferingUpdateListener" class="headerlink" title="ç¼“å†²ç›‘å¬å™¨ OnBufferingUpdateListener"></a>ç¼“å†²ç›‘å¬å™¨ OnBufferingUpdateListener</h3><p>æ¯”å¦‚æˆ‘ä»¬åŠ è½½ç½‘ç»œéŸ³é¢‘çš„æ—¶å€™ï¼Œå¸¸ç”¨è¿™ä¸ªç›‘å¬å™¨æ¥ç›‘å¬ç¼“å†²è¿›åº¦ã€‚æ˜¾ç¤ºç¼“å†²è¿›åº¦ï¼Œä¹Ÿå¯ä»¥æé«˜ç”¨æˆ·ä½“éªŒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">mMediaPlayer.prepareAsync();<br>mMediaPlayer.setOnBufferingUpdateListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>.OnBufferingUpdateListener() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBufferingUpdate</span><span class="hljs-params">(MediaPlayer mp, <span class="hljs-type">int</span> percent)</span> &#123;<br>        <span class="hljs-comment">// percentä»£è¡¨ç¼“å†²ç™¾åˆ†æ¯”</span><br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="é”™è¯¯ç›‘å¬å™¨-OnErrorListener"><a href="#é”™è¯¯ç›‘å¬å™¨-OnErrorListener" class="headerlink" title="é”™è¯¯ç›‘å¬å™¨ OnErrorListener"></a>é”™è¯¯ç›‘å¬å™¨ OnErrorListener</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">mediaPlayer.setOnErrorListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>.OnErrorListener() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(MediaPlayer mediaPlayer, <span class="hljs-type">int</span> i, <span class="hljs-type">int</span> i1)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// è¿”å›trueè¡¨ç¤ºåœ¨æ­¤å¤„ç†é”™è¯¯ï¼Œä¸ä¼šå›è°ƒonCompletion</span><br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>æ³¨æ„onErrorçš„è¿”å›å€¼ã€‚å¯ä»¥é€‰æ‹©è‡ªå·±å¤„ç†errorã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"> * <span class="hljs-meta">@return</span> True <span class="hljs-keyword">if</span> the method handled the error, <span class="hljs-literal">false</span> <span class="hljs-keyword">if</span> it didn<span class="hljs-string">&#x27;t.</span><br><span class="hljs-string"> * Returning false, or not having an OnErrorListener at all, will</span><br><span class="hljs-string"> * cause the OnCompletionListener to be called.</span><br><span class="hljs-string"> */</span><br><span class="hljs-string">boolean onError(MediaPlayer mp, int what, int extra);</span><br></code></pre></td></tr></table></figure><h3 id="æ’­æ”¾å®Œæ¯•ç›‘å¬å™¨-OnCompletionListener"><a href="#æ’­æ”¾å®Œæ¯•ç›‘å¬å™¨-OnCompletionListener" class="headerlink" title="æ’­æ”¾å®Œæ¯•ç›‘å¬å™¨ OnCompletionListener"></a>æ’­æ”¾å®Œæ¯•ç›‘å¬å™¨ OnCompletionListener</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">mediaPlayer.setOnCompletionListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>.OnCompletionListener() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCompletion</span><span class="hljs-params">(MediaPlayer mediaPlayer)</span> &#123;<br>        <span class="hljs-comment">// æ’­æ”¾å®Œæ¯•</span><br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨ç¤ºä¾‹"><a href="#ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="ä½¿ç”¨ç¤ºä¾‹"></a>ä½¿ç”¨ç¤ºä¾‹</h2><h3 id="æ’­æ”¾assetsé‡Œçš„éŸ³é¢‘"><a href="#æ’­æ”¾assetsé‡Œçš„éŸ³é¢‘" class="headerlink" title="æ’­æ”¾assetsé‡Œçš„éŸ³é¢‘"></a>æ’­æ”¾assetsé‡Œçš„éŸ³é¢‘</h3><p>æ’­æ”¾assetsé‡Œçš„éŸ³é¢‘æ–‡ä»¶ï¼Œä½¿ç”¨åˆ°AssetFileDescriptorç±»ã€‚ä½¿ç”¨åè®°å¾—å…³é—­AssetFileDescriptorã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">playAssetsAudio</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String name, Context context)</span> &#123;<br>    Log.d(TAG, <span class="hljs-string">&quot;playAssetWordSound: try to play assets sound file. -&gt; &quot;</span> + name);<br>    <span class="hljs-type">AssetFileDescriptor</span> <span class="hljs-variable">fd</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        MediaPlayer mediaPlayer;<br>        Log.v(TAG, <span class="hljs-string">&quot;Looking in assets.&quot;</span>);<br>        fd = context.getApplicationContext().getAssets().openFd(name);<br>        mediaPlayer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>();<br>        mediaPlayer.reset();<br>        mediaPlayer.setDataSource(fd.getFileDescriptor(), fd.getStartOffset(), fd.getLength());<br>        mediaPlayer.prepareAsync();<br>        mediaPlayer.setOnPreparedListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>.OnPreparedListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPrepared</span><span class="hljs-params">(MediaPlayer mediaPlayer)</span> &#123;<br>                Log.d(TAG, <span class="hljs-string">&quot;onPrepared: &quot;</span> + name);<br>                mediaPlayer.start();<br>            &#125;<br>        &#125;);<br>        mediaPlayer.setOnCompletionListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>.OnCompletionListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCompletion</span><span class="hljs-params">(MediaPlayer mp)</span> &#123;<br>                mp.release();<br>                Log.d(TAG, <span class="hljs-string">&quot;onCompletion: &quot;</span> + name);<br>            &#125;<br>        &#125;);<br>        mediaPlayer.setOnErrorListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>.OnErrorListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(MediaPlayer mp, <span class="hljs-type">int</span> i, <span class="hljs-type">int</span> i1)</span> &#123;<br>                mp.release();<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">if</span> (fd != <span class="hljs-literal">null</span>) &#123;<br>                fd.close();<br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e1) &#123;<br>            Log.e(TAG, <span class="hljs-string">&quot;Exception close fd: &quot;</span>, e1);<br>        &#125;<br>    &#125; <span class="hljs-keyword">finally</span> &#123;<br>        <span class="hljs-keyword">if</span> (fd != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                fd.close();<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                Log.e(TAG, <span class="hljs-string">&quot;Finally, close fd &quot;</span>, e);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="æ’­æ”¾æœ¬åœ°éŸ³é¢‘æ–‡ä»¶"><a href="#æ’­æ”¾æœ¬åœ°éŸ³é¢‘æ–‡ä»¶" class="headerlink" title="æ’­æ”¾æœ¬åœ°éŸ³é¢‘æ–‡ä»¶"></a>æ’­æ”¾æœ¬åœ°éŸ³é¢‘æ–‡ä»¶</h3><p>å°è¯•æ’­æ”¾éŸ³é¢‘æ–‡ä»¶ã€‚ä»…æ’­æ”¾ä¸€æ¬¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">playAudioFile</span><span class="hljs-params">(<span class="hljs-keyword">final</span> File file)</span> &#123;<br>    Log.d(TAG, <span class="hljs-string">&quot;playAudioFile: &quot;</span> + file.getAbsolutePath());<br>    MediaPlayer mediaPlayer;<br>    <span class="hljs-keyword">try</span> &#123;<br>        mediaPlayer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>();<br>        mediaPlayer.setLooping(<span class="hljs-literal">false</span>);<br>        mediaPlayer.setDataSource(file.getAbsolutePath());<br>        mediaPlayer.prepare();<br>        mediaPlayer.start();<br>        mediaPlayer.setOnCompletionListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>.OnCompletionListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCompletion</span><span class="hljs-params">(MediaPlayer mp)</span> &#123;<br>                mp.release();<br>            &#125;<br>        &#125;);<br>        mediaPlayer.setOnErrorListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>.OnErrorListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(MediaPlayer mediaPlayer, <span class="hljs-type">int</span> i, <span class="hljs-type">int</span> i1)</span> &#123;<br>                Log.d(TAG, <span class="hljs-string">&quot;Play local sound onError: &quot;</span> + i + <span class="hljs-string">&quot;, &quot;</span> + i1);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        Log.e(TAG, <span class="hljs-string">&quot;playAudioFile: &quot;</span>, e);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ’­æ”¾åœ¨çº¿éŸ³é¢‘"><a href="#æ’­æ”¾åœ¨çº¿éŸ³é¢‘" class="headerlink" title="æ’­æ”¾åœ¨çº¿éŸ³é¢‘"></a>æ’­æ”¾åœ¨çº¿éŸ³é¢‘</h3><p>è®¾ç½®urlï¼Œæ’­æ”¾åœ¨çº¿éŸ³é¢‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">playOnlineSound</span><span class="hljs-params">(String soundUrlDict)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">MediaPlayer</span> <span class="hljs-variable">mediaPlayer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>();<br>        mediaPlayer.setDataSource(soundUrlDict);<br>        mediaPlayer.prepareAsync();<br>        mediaPlayer.setOnPreparedListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>.OnPreparedListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPrepared</span><span class="hljs-params">(MediaPlayer mediaPlayer)</span> &#123;<br>                mediaPlayer.start();<br>            &#125;<br>        &#125;);<br>        mediaPlayer.setOnCompletionListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>.OnCompletionListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCompletion</span><span class="hljs-params">(MediaPlayer mp)</span> &#123;<br>                <span class="hljs-keyword">if</span> (mp != <span class="hljs-literal">null</span>) &#123;<br>                    mp.release();<br>                &#125;<br>                Log.d(TAG, <span class="hljs-string">&quot;onCompletion: play sound.&quot;</span>);<br>            &#125;<br>        &#125;);<br>        mediaPlayer.setOnErrorListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>.OnErrorListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(MediaPlayer mediaPlayer, <span class="hljs-type">int</span> i, <span class="hljs-type">int</span> i1)</span> &#123;<br>                Log.d(TAG, <span class="hljs-string">&quot;Play online sound onError: &quot;</span> + i + <span class="hljs-string">&quot;, &quot;</span> + i1);<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>            &#125;<br>        &#125;);<br>    &#125; <span class="hljs-keyword">catch</span> (IOException e1) &#123;<br>        Log.e(TAG, <span class="hljs-string">&quot;url: &quot;</span>, e1);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç å¯ä»¥å‚è€ƒç¤ºä¾‹å·¥ç¨‹ï¼š <a href="https://github.com/RustFisher/android-MediaPlayer">https://github.com/RustFisher/android-MediaPlayer</a></p><p>æ›´å¤šå‚è€ƒï¼š</p><p><a href="https://rustfisher.com/2019/09/19/Android/Android-MediaPlayer_intro/">Android MediaPlayer åŸºç¡€ç®€ä»‹</a></p><p><a href="https://rustfisher.com/2019/09/22/Android/Android-MediaPlayer_use_play_audio/">Android MediaPlayer æ’­æ”¾éŸ³é¢‘</a></p><p><a href="https://rustfisher.com/2019/09/23/Android/Android-Media_download_stream_file/">Android ä½¿ç”¨URLConnectionä¸‹è½½éŸ³é¢‘æ–‡ä»¶</a></p><p><a href="https://rustfisher.com/2019/09/25/Android/Android-MediaPlayer_use_play_speed/">Android MediaPlayer éŸ³é¢‘å€é€Ÿæ’­æ”¾ï¼Œè°ƒæ•´æ’­æ”¾é€Ÿåº¦</a></p><p>AndroidéŸ³è§†é¢‘ç›¸å…³æ–‡ç« è¯·å‚è€ƒ <a href="https://rustfisher.com/tags/Android-Media/">https://rustfisher.com/tags/Android-Media/</a></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android_Media</tag>
      
      <tag>Media</tag>
      
      <tag>MediaPlayer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android MediaPlayer åŸºç¡€ç®€ä»‹</title>
    <link href="/2019/09/19/Android/Android-MediaPlayer_intro/"/>
    <url>/2019/09/19/Android/Android-MediaPlayer_intro/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡é“¾æ¥ï¼š <a href="https://rustfisher.com/2019/09/19/Android/Android-MediaPlayer_intro/">Android MediaPlayer åŸºç¡€ç®€ä»‹</a></p><p>ç®€å•ä»‹ç»MediaPlayerçš„åŸºæœ¬æ¦‚å¿µï¼ŒçŠ¶æ€ï¼Œå¸¸ç”¨çš„æ–¹æ³•ä¸ç›‘å¬å™¨ã€‚</p><h2 id="ä»€ä¹ˆæ˜¯MediaPlayer"><a href="#ä»€ä¹ˆæ˜¯MediaPlayer" class="headerlink" title="ä»€ä¹ˆæ˜¯MediaPlayer"></a>ä»€ä¹ˆæ˜¯MediaPlayer</h2><p>MediaPlayerç±»å¯ä»¥ç”¨æ¥æ’­æ”¾éŸ³è§†é¢‘æ–‡ä»¶ï¼Œæˆ–è€…æ˜¯éŸ³é¢‘æµã€‚å¼€å‘è€…å¯ä»¥ç”¨å®ƒæ¥æ’­æ”¾æœ¬åœ°éŸ³é¢‘ï¼Œæˆ–è€…æ˜¯ç½‘ç»œåœ¨çº¿éŸ³é¢‘ã€‚</p><p>MediaPlayerå±äº<code>android.media</code>åŒ…ã€‚</p><h2 id="MediaPlayerçš„çŠ¶æ€"><a href="#MediaPlayerçš„çŠ¶æ€" class="headerlink" title="MediaPlayerçš„çŠ¶æ€"></a>MediaPlayerçš„çŠ¶æ€</h2><p>æ’­æ”¾æ§åˆ¶ç”±çŠ¶æ€æœºæ§åˆ¶ã€‚åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œæˆ‘ä»¬å¸¸è§çš„éŸ³é¢‘çŠ¶æ€æœ‰æ’­æ”¾ä¸­ï¼Œæš‚åœï¼Œåœæ­¢ï¼Œç¼“å†²ç­‰ç­‰ã€‚<br>MediaPlayerçš„çŠ¶æ€æœ‰å¦‚ä¸‹å‡ ç§ï¼š</p><ul><li>Idle</li><li>End</li><li>Error</li><li>Initialized</li><li>Preparing</li><li>Prepared</li><li>Started</li><li>Stopped</li><li>Paused</li><li>PlaybackCompleted</li></ul><p>çŠ¶æ€çš„åˆ‡æ¢å‚è€ƒ<a href="https://developer.android.com/reference/android/media/MediaPlayer">å®˜æ–¹</a>å›¾ä¾‹ã€‚<br>è¿™é‡Œç¨å¾®è§£é‡Šä¸€ä¸‹çŠ¶æ€è½¬æ¢å›¾ç‰‡ã€‚æ¤­åœ†ä»£è¡¨MediaPlayerå¯èƒ½åœç•™çš„çŠ¶æ€ã€‚æ¤­åœ†ä¹‹é—´çš„ç®­å¤´è¡¨ç¤ºæ–¹æ³•è°ƒç”¨ï¼ŒçŠ¶æ€åˆ‡æ¢çš„æ–¹å‘ã€‚å•ç®­å¤´è¡¨ç¤ºæ–¹æ³•åŒæ­¥è°ƒç”¨ï¼ŒåŒç®­å¤´è¡¨ç¤ºå¼‚æ­¥è°ƒç”¨ã€‚</p><p><img src="http://rustblogres.rustfisher.com/Android-mediaplayer_state_diagram.gif" alt="mediaplayer_state_diagram"></p><p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºçŠ¶æ€åˆ‡æ¢çš„è·¯å¾„å’Œæ¶‰åŠåˆ°çš„æ–¹æ³•ã€‚</p><h3 id="Idleä¸EndçŠ¶æ€"><a href="#Idleä¸EndçŠ¶æ€" class="headerlink" title="Idleä¸EndçŠ¶æ€"></a>Idleä¸EndçŠ¶æ€</h3><p>å½“newä¸€ä¸ªMediaPlayeræˆ–è€…è°ƒç”¨äº†resetæ–¹æ³•ï¼Œå½“å‰MediaPlayerä¼šå¤„äºIdleçŠ¶æ€ã€‚è°ƒç”¨releaseåï¼Œä¼šå¤„äºEndçŠ¶æ€ã€‚åœ¨è¿™2ä¸ªçŠ¶æ€ä¹‹é—´çš„çŠ¶æ€å¯ä»¥çœ‹åšæ˜¯MediaPlayerå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>åœ¨æ–°åˆ›å»ºMediaPlayerå’Œè°ƒç”¨resetçš„MediaPlayerä¹‹é—´æœ‰ä¸€äº›ç»†å¾®çš„å·®åˆ«ã€‚<br>è¿™ä¸¤ç§æƒ…å†µéƒ½å¤„äºIdleçŠ¶æ€ï¼Œè°ƒç”¨ getCurrentPosition(), getDuration(), getVideoHeight(), getVideoWidth(), setAudioAttributes(android.media.AudioAttributes), setLooping(boolean), setVolume(float, float), pause(), start(), stop(), seekTo(long, int), prepare() æˆ– prepareAsync()æ–¹æ³•éƒ½ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå¦‚æœæ˜¯æ–°å®ä¾‹åŒ–çš„MediaPlayerï¼Œä¸ä¼šå›è°ƒ OnErrorListener.onError()ï¼›ä½†å¦‚æœæ˜¯resetåçš„MediaPlayerï¼Œä¼šå›è°ƒ OnErrorListener.onError()å¹¶ä¸”è½¬æ¢åˆ°ErrorçŠ¶æ€ã€‚</p><p>å¦‚æœMediaPlayerå¯¹è±¡ä¸å†ä½¿ç”¨äº†ï¼Œç«‹å³è°ƒç”¨release()æ–¹æ³•ï¼Œé‡Šæ”¾å†…éƒ¨æ’­æ”¾å™¨å ç”¨çš„èµ„æºã€‚è¿™äº›èµ„æºå¯èƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ¯”å¦‚ç¡¬ä»¶åŠ é€Ÿç»„ä»¶ã€‚å¦‚æœè°ƒç”¨releaseå¤±è´¥ï¼Œå¯èƒ½ä¼šå¼•èµ·ä¸€è¿ä¸²çš„MediaPlayerå®ä¾‹å¤±æ•ˆã€‚å½“MediaPlayerå¤„äºEndçŠ¶æ€ï¼Œå®ƒå°±ä¸èƒ½å†è½¬ç§»åˆ°å…¶å®ƒçŠ¶æ€äº†ã€‚</p><p>newä¸€ä¸ªMediaPlayerï¼Œå¤„äºIdleçŠ¶æ€ã€‚å¦‚æœç”¨createæ–¹æ³•åˆ›å»ºå®ä¾‹ï¼Œå½“åˆ›å»ºå®Œæˆæ—¶å¤„äºPreparedçŠ¶æ€ã€‚</p><h3 id="å‘ç”Ÿé”™è¯¯"><a href="#å‘ç”Ÿé”™è¯¯" class="headerlink" title="å‘ç”Ÿé”™è¯¯"></a>å‘ç”Ÿé”™è¯¯</h3><p>ä¸€äº›æƒ…å½¢å¯èƒ½ä¼šè®©MediaPlayeræ“ä½œå¤±è´¥ï¼Œæ¯”å¦‚ä¸æ”¯æŒçš„éŸ³è§†é¢‘æ ¼å¼ï¼Œåˆ†è¾¨ç‡è¿‡é«˜ï¼Œç½‘ç»œè¶…æ—¶ç­‰ç­‰ã€‚<br>å› æ­¤åœ¨è¿™äº›æƒ…å½¢ä¸‹é”™è¯¯å¤„ç†å’Œæ¢å¤éå¸¸é‡è¦ã€‚æœ‰æ—¶å€™ç¼–ç¨‹é”™è¯¯ä¹Ÿä¼šå¯¼è‡´MediaPlayeræ“ä½œé”™è¯¯ã€‚<br>å¼€å‘è€…å¯ä»¥è®¾ç½®é”™è¯¯ç›‘å¬å™¨<code>setOnErrorListener(android.media.MediaPlayer.OnErrorListener)</code>ã€‚å½“é”™è¯¯å‘ç”Ÿæ—¶ï¼Œä¼šè°ƒç”¨ç”¨æˆ·å®ç°çš„OnErrorListener.onError()æ–¹æ³•ã€‚</p><p>ä¸ç®¡æœ‰æ²¡æœ‰è®¾ç½®ç›‘å¬å™¨ï¼Œé”™è¯¯å‘ç”Ÿæ—¶MediaPlayerä¼šè¿›å…¥ErrorçŠ¶æ€ã€‚</p><p>ä¸ºäº†é‡å¤ä½¿ç”¨åŒä¸€ä¸ªMediaPlayerå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨<code>reset()</code>æ–¹æ³•æŠŠå®ƒä»ErrorçŠ¶æ€æ¢å¤åˆ°IdleçŠ¶æ€ã€‚<br>è®¾ç½®é”™è¯¯ç›‘å¬å™¨OnErrorListeneræ˜¯ä¸€ä¸ªå¥½çš„ç¼–ç¨‹ä¹ æƒ¯ã€‚å¼€å‘è€…å¯ä»¥ç›‘å¬åˆ°æ’­æ”¾å¼•æ“çš„é”™è¯¯é€šçŸ¥ã€‚<br>æœ‰æ—¶å€™ä¼šæŠ›å‡ºIllegalStateExceptionå¼‚å¸¸ï¼Œæ¯”å¦‚åœ¨é”™è¯¯çš„çŠ¶æ€è°ƒç”¨äº†prepare(), prepareAsync()æ–¹æ³•ï¼Œæˆ–æ˜¯setDataSourceæ–¹æ³•ã€‚</p><h3 id="è®¾ç½®éŸ³æº-setDataSource"><a href="#è®¾ç½®éŸ³æº-setDataSource" class="headerlink" title="è®¾ç½®éŸ³æº setDataSource"></a>è®¾ç½®éŸ³æº setDataSource</h3><p>è°ƒç”¨setDataSource(java.io.FileDescriptor), æˆ–è€… setDataSource(java.lang.String), æˆ–è€… setDataSource(android.content.Context, android.net.Uri), æˆ–è€… setDataSource(java.io.FileDescriptor, long, long), æˆ–è€… setDataSource(android.media.MediaDataSource) å¯ä»¥å°†MediaPlayerçš„çŠ¶æ€ä»Idleè½¬åˆ°InitializedçŠ¶æ€ã€‚<br>å¦‚æœåœ¨IdleçŠ¶æ€ä¹‹å¤–çš„çŠ¶æ€è°ƒç”¨äº†setDataSource()ï¼Œä¼šæŠ›å‡ºIllegalStateExceptionå¼‚å¸¸ã€‚<br>å¼€å‘è€…åº”è¯¥ç•™æ„setDataSourceæ–¹æ³•æŠ›å‡ºçš„IllegalArgumentExceptionå’ŒIOExceptionå¼‚å¸¸ã€‚</p><h3 id="æ’­æ”¾éŸ³é¢‘å‰å¿…é¡»åœ¨PreparedçŠ¶æ€"><a href="#æ’­æ”¾éŸ³é¢‘å‰å¿…é¡»åœ¨PreparedçŠ¶æ€" class="headerlink" title="æ’­æ”¾éŸ³é¢‘å‰å¿…é¡»åœ¨PreparedçŠ¶æ€"></a>æ’­æ”¾éŸ³é¢‘å‰å¿…é¡»åœ¨PreparedçŠ¶æ€</h3><p>MediaPlayeråœ¨å¼€å§‹æ’­æ”¾éŸ³é¢‘å‰å¿…é¡»å¤„äºPreparedçŠ¶æ€ã€‚</p><p>MediaPlayeræœ‰åŒæ­¥å’Œå¼‚æ­¥2ç§æ–¹å¼æ¥è¿›å…¥PreparedçŠ¶æ€ã€‚å¦‚æœæ˜¯å¼‚æ­¥çš„æ–¹å¼ï¼Œä¼šå…ˆè½¬åˆ°PreparingçŠ¶æ€ï¼Œå†è½¬åˆ°PreparedçŠ¶æ€ã€‚<br>å½“å‡†å¤‡å®Œæˆæ—¶ï¼Œå†…éƒ¨çš„æ’­æ”¾å¼•æ“ä¼šå›è°ƒç”¨æˆ·ä¹‹å‰è®¾ç½®çš„OnPreparedListenerçš„onPrepared()æ–¹æ³•ã€‚</p><p>å¼€å‘è€…å¿…é¡»æ³¨æ„çš„æ˜¯ï¼ŒPreparingçŠ¶æ€æ˜¯ä¸€ä¸ªè¿‡æ¸¡çŠ¶æ€ï¼ˆtransient stateï¼‰ã€‚</p><p>å¤„äºPreparedçŠ¶æ€æ—¶ï¼Œå¯ä»¥é€šè¿‡ç›¸å¯¹åº”çš„æ–¹æ³•è®¾ç½®éŸ³é‡ï¼Œå±å¹•å¸¸äº®ï¼Œæ’­æ”¾å¾ªç¯ç­‰ã€‚</p><h3 id="å¼€å§‹æ’­æ”¾"><a href="#å¼€å§‹æ’­æ”¾" class="headerlink" title="å¼€å§‹æ’­æ”¾"></a>å¼€å§‹æ’­æ”¾</h3><p>æ’­æ”¾éŸ³é¢‘å¿…é¡»è°ƒç”¨start()æ–¹æ³•ã€‚è°ƒç”¨start()è¿”å›æˆåŠŸåï¼ŒMediaPlayerå¤„äºStartedçŠ¶æ€ã€‚<br>å¯ä»¥é€šè¿‡isPlaying()æ¥åˆ¤æ–­å½“å‰æ˜¯å¦åœ¨StartedçŠ¶æ€ã€‚</p><p>å¦‚æœå¼€å‘è€…è®¾ç½®äº†OnBufferingUpdateListenerï¼ŒAndroidå†…éƒ¨æ’­æ”¾å™¨ä¼šå‘å¤–ä¼ é€’bufferä¿¡æ¯ã€‚</p><p>å¦‚æœå½“å‰å¤„äºStartedçŠ¶æ€ï¼Œå†è°ƒç”¨start()æ–¹æ³•æ²¡æœ‰æ•ˆæœã€‚</p><h3 id="æš‚åœæ’­æ”¾ä¸ç»§ç»­æ’­æ”¾"><a href="#æš‚åœæ’­æ”¾ä¸ç»§ç»­æ’­æ”¾" class="headerlink" title="æš‚åœæ’­æ”¾ä¸ç»§ç»­æ’­æ”¾"></a>æš‚åœæ’­æ”¾ä¸ç»§ç»­æ’­æ”¾</h3><p>éŸ³é¢‘å¯ä»¥è¢«æš‚åœæ’­æ”¾å’Œç»§ç»­æ’­æ”¾ï¼Œä¹Ÿå¯ä»¥è°ƒæ•´æ’­æ”¾çš„ä½ç½®ã€‚é€šè¿‡pause()æ–¹æ³•æ¥æš‚åœéŸ³é¢‘æ’­æ”¾ã€‚<br>æˆåŠŸè°ƒç”¨pause()æ–¹æ³•åï¼ŒMediaPlayerè¿›å…¥PausedçŠ¶æ€ã€‚<br>åº”å½“æ³¨æ„çš„æ˜¯ï¼ŒMediaPlayeråœ¨StartedçŠ¶æ€ä¸PausedçŠ¶æ€ä¹‹é—´åˆ‡æ¢æ˜¯å¼‚æ­¥çš„ã€‚æ’­æ”¾éŸ³é¢‘æµçš„æ—¶å€™ï¼Œè¿™ä¸ªè½¬æ¢è¿‡ç¨‹å¯èƒ½ä¼šéœ€è¦å‡ ç§’é’Ÿã€‚</p><p>MediaPlayeræš‚åœæ—¶ï¼Œstart()æ–¹æ³•å¯ä»¥ä»æš‚åœçš„ä½ç½®ç»§ç»­æ’­æ”¾ã€‚æˆåŠŸè°ƒç”¨startæ–¹æ³•åä¼šè¿›å…¥StartedçŠ¶æ€ã€‚</p><p>å¤„äºPausedçŠ¶æ€æ—¶ï¼Œè°ƒç”¨pause()æ–¹æ³•æ²¡æœ‰æ•ˆæœã€‚</p><h3 id="åœæ­¢"><a href="#åœæ­¢" class="headerlink" title="åœæ­¢"></a>åœæ­¢</h3><p>è°ƒç”¨stop()æ–¹æ³•è®©MediaPlayerä»Started, Paused, Prepared æˆ– PlaybackCompleted çŠ¶æ€è¿›å…¥ Stopped çŠ¶æ€ã€‚</p><p>åœ¨StoppedçŠ¶æ€æ—¶ï¼Œå¿…é¡»å…ˆè°ƒç”¨prepare() æˆ– prepareAsync()è¿›å…¥PreparedçŠ¶æ€åï¼Œæ‰èƒ½æ’­æ”¾éŸ³é¢‘ã€‚</p><p>å¤„äºStoppedçŠ¶æ€æ—¶ï¼Œè°ƒç”¨stop()æ–¹æ³•æ²¡æœ‰æ•ˆæœã€‚</p><h3 id="è°ƒæ•´æ’­æ”¾ä½ç½®"><a href="#è°ƒæ•´æ’­æ”¾ä½ç½®" class="headerlink" title="è°ƒæ•´æ’­æ”¾ä½ç½®"></a>è°ƒæ•´æ’­æ”¾ä½ç½®</h3><p>è°ƒç”¨seekTo(long, int)æ¥è°ƒæ•´æ’­æ”¾ä½ç½®ã€‚</p><p>seekTo(long, int)æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œè™½ç„¶å®ƒèƒ½ç«‹åˆ»è¿”å›ï¼Œä½†å®é™…çš„ä½ç½®è°ƒæ•´å¯èƒ½ä¼šæ¶ˆè€—ä¸€æ®µæ—¶é—´ï¼Œç‰¹åˆ«æ˜¯åœ¨æ’­æ”¾éŸ³é¢‘æµçš„æ—¶å€™ã€‚å½“å®é™…æ’­æ”¾ä½ç½®è°ƒæ•´åï¼Œå†…éƒ¨æ’­æ”¾å™¨ä¼šå›è°ƒå¼€å‘è€…è®¾ç½®çš„OnSeekComplete.onSeekComplete()ã€‚</p><p>åœ¨Prepared, Paused å’Œ PlaybackCompletedçŠ¶æ€ä¸­ï¼Œéƒ½å¯ä»¥è°ƒç”¨seekToæ–¹æ³•ã€‚</p><p>å¯ä»¥é€šè¿‡getCurrentPosition()æ–¹æ³•æ¥è·å–å½“å‰æ’­æ”¾ä½ç½®ã€‚å¼€å‘è€…å¯ä»¥å¾—çŸ¥å½“å‰æ’­æ”¾çš„è¿›åº¦ç­‰ç­‰ã€‚</p><h3 id="æ’­æ”¾å®Œæ¯•"><a href="#æ’­æ”¾å®Œæ¯•" class="headerlink" title="æ’­æ”¾å®Œæ¯•"></a>æ’­æ”¾å®Œæ¯•</h3><p>éŸ³é¢‘æ’­æ”¾å®Œæˆåï¼Œæ’­æ”¾å®Œæ¯•ã€‚</p><p>å¦‚æœè°ƒç”¨setLooping(boolean)ä¸ºtrueï¼ŒMediaPlayerä¼šåœç•™åœ¨StartedçŠ¶æ€ã€‚</p><p>å¦‚æœsetLoopingä¸ºfalseï¼Œå†…éƒ¨æ’­æ”¾å™¨ä¼šè°ƒç”¨å¼€å‘è€…è®¾ç½®çš„OnCompletion.onCompletion()ï¼Œå¹¶ä¸”è¿›å…¥PlaybackCompletedçŠ¶æ€ã€‚</p><p>å¤„äºPlaybackCompletedçŠ¶æ€æ—¶ï¼Œè°ƒç”¨start()æ–¹æ³•å¯ä»¥ä»å¤´å¼€å§‹æ’­æ”¾éŸ³é¢‘ã€‚</p><h2 id="å¸¸ç”¨ç›‘å¬å™¨"><a href="#å¸¸ç”¨ç›‘å¬å™¨" class="headerlink" title="å¸¸ç”¨ç›‘å¬å™¨"></a>å¸¸ç”¨ç›‘å¬å™¨</h2><p>å¼€å‘è€…å¯ä»¥è®¾ç½®ä¸€äº›ç›‘å¬å™¨ï¼Œç›‘å¬MediaPlayerçš„çŠ¶æ€ï¼Œé”™è¯¯äº‹ä»¶ç­‰ç­‰ã€‚å¼€å‘è€…åº”åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­åˆ›å»ºMediaPlayerä¸è®¾ç½®çš„ç›‘å¬å™¨ã€‚</p><p><code>setOnPreparedListener(android.media.MediaPlayer.OnPreparedListener)</code><br>ç›‘å¬MediaPlayerå‡†å¤‡å®Œæˆã€‚ä¸€èˆ¬ä¸<code>prepareAsync</code>é…åˆä½¿ç”¨ã€‚</p><p><code>setOnVideoSizeChangedListener(android.media.MediaPlayer.OnVideoSizeChangedListener)</code><br>è·çŸ¥videoå¤§å°æˆ–videoå¤§å°æ”¹å˜æ—¶çš„ç›‘å¬ã€‚</p><p><code>setOnSeekCompleteListener(android.media.MediaPlayer.OnSeekCompleteListener)</code><br>ç›‘å¬è°ƒæ•´ä½ç½®å®Œæˆã€‚</p><p><code>setOnCompletionListener(android.media.MediaPlayer.OnCompletionListener)</code><br>æ’­æ”¾å®Œæˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">mediaPlayer.setOnCompletionListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>.OnCompletionListener() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCompletion</span><span class="hljs-params">(MediaPlayer mediaPlayer)</span> &#123;<br>        <span class="hljs-comment">// å½“å‰æ’­æ”¾å®Œæ¯•</span><br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p><code>setOnBufferingUpdateListener(android.media.MediaPlayer.OnBufferingUpdateListener)</code><br>ç›‘å¬ç¼“å†²è¿›åº¦ã€‚åœ¨æ’­æ”¾ç½‘ç»œéŸ³é¢‘æ—¶å¸¸ç”¨ã€‚</p><p>ç¼“å†²ç›‘å¬å™¨<code>OnBufferingUpdateListener</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">mMediaPlayer.prepareAsync();<br>mMediaPlayer.setOnBufferingUpdateListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>.OnBufferingUpdateListener() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBufferingUpdate</span><span class="hljs-params">(MediaPlayer mp, <span class="hljs-type">int</span> percent)</span> &#123;<br>        <span class="hljs-comment">// ä¾‹å¦‚åœ¨è¿™é‡Œæ›´æ–°UI</span><br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p><code>setOnInfoListener(android.media.MediaPlayer.OnInfoListener)</code><br>ç›‘å¬æ™®é€šä¿¡æ¯æˆ–è€…è­¦å‘Šä¿¡æ¯ã€‚</p><p><code>setOnErrorListener(android.media.MediaPlayer.OnErrorListener)</code><br>ç›‘å¬é”™è¯¯ä¿¡æ¯ã€‚é”™è¯¯å‘ç”Ÿæ—¶ï¼Œå¯ä»¥åœ¨è¿™é‡Œå¤„ç†é”™è¯¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">mediaPlayer.setOnErrorListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaPlayer</span>.OnErrorListener() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(MediaPlayer mediaPlayer, <span class="hljs-type">int</span> i, <span class="hljs-type">int</span> i1)</span> &#123;<br>        LogUtil.e(TAG_PREFIX + <span class="hljs-string">&quot; onERR i = &quot;</span> + i + <span class="hljs-string">&quot; i1 = &quot;</span> + i1);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// è¿”å›trueè¡¨ç¤ºåœ¨æ­¤å¤„ç†é”™è¯¯ï¼Œä¸ä¼šå›è°ƒonCompletion</span><br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>æ³¨æ„onErrorçš„è¿”å›å€¼ã€‚å¯ä»¥é€‰æ‹©è‡ªå·±å¤„ç†errorã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"> * <span class="hljs-meta">@return</span> True <span class="hljs-keyword">if</span> the method handled the error, <span class="hljs-literal">false</span> <span class="hljs-keyword">if</span> it didn<span class="hljs-string">&#x27;t.</span><br><span class="hljs-string"> * Returning false, or not having an OnErrorListener at all, will</span><br><span class="hljs-string"> * cause the OnCompletionListener to be called.</span><br><span class="hljs-string"> */</span><br><span class="hljs-string">boolean onError(MediaPlayer mp, int what, int extra);</span><br></code></pre></td></tr></table></figure><h2 id="éœ€è¦çš„æƒé™"><a href="#éœ€è¦çš„æƒé™" class="headerlink" title="éœ€è¦çš„æƒé™"></a>éœ€è¦çš„æƒé™</h2><p>æ’­æ”¾ç½‘ç»œéŸ³é¢‘æ—¶éœ€è¦Manifest.permission.INTERNETæƒé™ã€‚</p><p>æ›´å¤šå‚è€ƒï¼š</p><p><a href="https://rustfisher.com/2019/09/19/Android/Android-MediaPlayer_intro/">Android MediaPlayer åŸºç¡€ç®€ä»‹</a></p><p><a href="https://rustfisher.com/2019/09/22/Android/Android-MediaPlayer_use_play_audio/">Android MediaPlayer æ’­æ”¾éŸ³é¢‘</a></p><p><a href="https://rustfisher.com/2019/09/23/Android/Android-Media_download_stream_file/">Android ä½¿ç”¨URLConnectionä¸‹è½½éŸ³é¢‘æ–‡ä»¶</a></p><p><a href="https://rustfisher.com/2019/09/25/Android/Android-MediaPlayer_use_play_speed/">Android MediaPlayer éŸ³é¢‘å€é€Ÿæ’­æ”¾ï¼Œè°ƒæ•´æ’­æ”¾é€Ÿåº¦</a></p><p>AndroidéŸ³è§†é¢‘ç›¸å…³æ–‡ç« è¯·å‚è€ƒ <a href="https://rustfisher.com/tags/Android-Media/">https://rustfisher.com/tags/Android-Media/</a></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android_Media</tag>
      
      <tag>Media</tag>
      
      <tag>MediaPlayer</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android mmap æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ä»‹ç»</title>
    <link href="/2019/08/20/Android/Android-mmap_intro_and_use/"/>
    <url>/2019/08/20/Android/Android-mmap_intro_and_use/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡é“¾æ¥ï¼š <a href="https://rustfisher.com/2019/08/20/Android/Android-mmap_intro_and_use/">Android mmap æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜ä»‹ç»</a></p><p>Androidå¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è®°å½•ä¸€äº›æ–‡ä»¶ã€‚ä¾‹å¦‚è®°å½•logæ–‡ä»¶ã€‚å¦‚æœä½¿ç”¨æµæ¥å†™æ–‡ä»¶ï¼Œé¢‘ç¹æ“ä½œæ–‡ä»¶ioå¯èƒ½ä¼šå¼•èµ·æ€§èƒ½é—®é¢˜ã€‚<br>ä¸ºäº†é™ä½å†™æ–‡ä»¶çš„é¢‘ç‡ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡‡ç”¨ç¼“å­˜ä¸€å®šæ•°é‡çš„logï¼Œå†ä¸€æ¬¡æ€§æŠŠå®ƒä»¬å†™åˆ°æ–‡ä»¶ä¸­ã€‚å¦‚æœappå¼‚å¸¸é€€å‡ºï¼Œæˆ‘ä»¬æœ‰å¯èƒ½ä¼šä¸¢å¤±å†…å­˜ä¸­çš„logä¿¡æ¯ã€‚<br>é‚£ä¹ˆæœ‰ä»€ä¹ˆæ¯”è¾ƒç¨³å¦¥çš„å†™æ–‡ä»¶æ–¹å¼ï¼Œæ—¢èƒ½é™ä½ioï¼Œåˆèƒ½å°½å¯èƒ½åœ°ä¿è¯æ•°æ®è¢«å†™å…¥æ–‡ä»¶å‘¢ï¼Ÿ</p><h2 id="mmapç®€ä»‹"><a href="#mmapç®€ä»‹" class="headerlink" title="mmapç®€ä»‹"></a>mmapç®€ä»‹</h2><h3 id="mmapæ¦‚å¿µ"><a href="#mmapæ¦‚å¿µ" class="headerlink" title="mmapæ¦‚å¿µ"></a>mmapæ¦‚å¿µ</h3><p>mmapæ˜¯ä¸€ç§å†…å­˜æ˜ å°„æ–‡ä»¶çš„æ–¹æ³•ï¼Œå³å°†ä¸€ä¸ªæ–‡ä»¶æˆ–è€…å…¶å®ƒå¯¹è±¡æ˜ å°„åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œå®ç°æ–‡ä»¶ç£ç›˜åœ°å€å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ä¸€æ®µè™šæ‹Ÿåœ°å€çš„ä¸€ä¸€å¯¹æ˜ å…³ç³»ã€‚ </p><p>ç‰¹ç‚¹ï¼šå®ç°è¿™æ ·çš„æ˜ å°„å…³ç³»åï¼Œè¿›ç¨‹å°±å¯ä»¥é‡‡ç”¨æŒ‡é’ˆçš„æ–¹å¼è¯»å†™æ“ä½œè¿™ä¸€æ®µå†…å­˜ï¼Œè€Œç³»ç»Ÿä¼šè‡ªåŠ¨å›å†™è„é¡µé¢åˆ°å¯¹åº”çš„æ–‡ä»¶ç£ç›˜ä¸Šï¼Œå³å®Œæˆäº†å¯¹æ–‡ä»¶çš„æ“ä½œè€Œä¸å¿…å†è°ƒç”¨read,writeç­‰ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚ç›¸åï¼Œå†…æ ¸ç©ºé—´å¯¹è¿™æ®µåŒºåŸŸçš„ä¿®æ”¹ä¹Ÿç›´æ¥åæ˜ ç”¨æˆ·ç©ºé—´ï¼Œä»è€Œå¯ä»¥å®ç°ä¸åŒè¿›ç¨‹é—´çš„æ–‡ä»¶å…±äº«ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š </p><p><img src="http://rustblogres.rustfisher.com/Android-mmap-intro1.jpg" alt="mmapç®€ä»‹"></p><h3 id="mmapå†…å­˜æ˜ å°„åŸç†"><a href="#mmapå†…å­˜æ˜ å°„åŸç†" class="headerlink" title="mmapå†…å­˜æ˜ å°„åŸç†"></a>mmapå†…å­˜æ˜ å°„åŸç†</h3><p>mmapå†…å­˜æ˜ å°„çš„å®ç°è¿‡ç¨‹ï¼Œæ€»çš„æ¥è¯´å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><p>åº”ç”¨è¿›ç¨‹å¯åŠ¨æ˜ å°„ï¼Œåœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼Œå¯»æ‰¾ä¸€æ®µç©ºé—²çš„æ»¡è¶³è¦æ±‚çš„è¿ç»­çš„è™šæ‹Ÿåœ°å€ä½œä¸ºæ˜ å°„åŒºåŸŸï¼›<br>è°ƒç”¨ç³»ç»Ÿå‡½æ•°mmapï¼Œå®ç°æ–‡ä»¶ç‰©ç†åœ°å€å’Œè¿›ç¨‹è™šæ‹Ÿåœ°å€çš„ä¸€ä¸€æ˜ å°„ï¼›<br>åº”ç”¨è¿›ç¨‹å¯¹æ˜ å°„åŒºåŸŸè®¿é—®ï¼Œå¼•å‘ç¼ºé¡µå¼‚å¸¸ï¼Œå®ç°æ–‡ä»¶å†…å®¹åˆ°ç‰©ç†å†…å­˜ï¼ˆä¸»å­˜ï¼‰çš„æ‹·è´ã€‚</p><h3 id="mmapä¼˜ç¼ºç‚¹"><a href="#mmapä¼˜ç¼ºç‚¹" class="headerlink" title="mmapä¼˜ç¼ºç‚¹"></a>mmapä¼˜ç¼ºç‚¹</h3><p>åªæœ‰ä¸€æ¬¡æ•°æ®æ‹·è´ï¼šå½“å‘ç”Ÿç¼ºé¡µå¼‚å¸¸æ—¶ï¼Œç›´æ¥å°†æ•°æ®ä»ç£ç›˜æ‹·è´åˆ°è¿›ç¨‹çš„ç”¨æˆ·ç©ºé—´ï¼Œè·³è¿‡äº†é¡µç¼“å­˜ã€‚<br>å®ç°äº†ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´çš„é«˜æ•ˆäº¤äº’æ–¹å¼ï¼šä¸¤ç©ºé—´çš„å„è‡ªä¿®æ”¹æ“ä½œå¯ä»¥ç›´æ¥åæ˜ åœ¨æ˜ å°„çš„åŒºåŸŸå†…ï¼Œä»è€Œè¢«å¯¹æ–¹ç©ºé—´åŠæ—¶æ•æ‰ã€‚<br>æä¾›è¿›ç¨‹é—´å…±äº«å†…å­˜åŠç›¸äº’é€šä¿¡çš„æ–¹å¼ã€‚ </p><p>ä¸ç®¡æ˜¯çˆ¶å­è¿›ç¨‹è¿˜æ˜¯æ— äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ï¼Œéƒ½å¯ä»¥å°†è‡ªèº«ç”¨æˆ·ç©ºé—´æ˜ å°„åˆ°åŒä¸€ä¸ªæ–‡ä»¶æˆ–åŒ¿åæ˜ å°„åˆ°åŒä¸€ç‰‡åŒºåŸŸã€‚ä»è€Œé€šè¿‡å„è‡ªå¯¹æ˜ å°„åŒºåŸŸçš„æ”¹åŠ¨ï¼Œè¾¾åˆ°è¿›ç¨‹é—´é€šä¿¡å’Œè¿›ç¨‹é—´å…±äº«çš„ç›®çš„ã€‚ </p><p>åŒæ—¶ï¼Œå¦‚æœè¿›ç¨‹Aå’Œè¿›ç¨‹Béƒ½æ˜ å°„äº†åŒºåŸŸCï¼Œå½“Aç¬¬ä¸€æ¬¡è¯»å–Cæ—¶é€šè¿‡ç¼ºé¡µä»ç£ç›˜å¤åˆ¶æ–‡ä»¶é¡µåˆ°å†…å­˜ä¸­ï¼›ä½†å½“Bå†è¯»Cçš„ç›¸åŒé¡µé¢æ—¶ï¼Œè™½ç„¶ä¹Ÿä¼šäº§ç”Ÿç¼ºé¡µå¼‚å¸¸ï¼Œä½†æ˜¯ä¸å†éœ€è¦ä»ç£ç›˜ä¸­å¤åˆ¶æ–‡ä»¶è¿‡æ¥ï¼Œè€Œå¯ç›´æ¥ä½¿ç”¨å·²ç»ä¿å­˜åœ¨å†…å­˜ä¸­çš„æ–‡ä»¶æ•°æ®ã€‚</p><h3 id="mmapæ³¨æ„ç‚¹"><a href="#mmapæ³¨æ„ç‚¹" class="headerlink" title="mmapæ³¨æ„ç‚¹"></a>mmapæ³¨æ„ç‚¹</h3><p>å¯¹äºå¤§æ–‡ä»¶è€Œè¨€ï¼Œå†…å­˜æ˜ å°„æ¯”æ™®é€šIOæµè¦å¿«ï¼Œå°æ–‡ä»¶åˆ™æœªå¿…ï¼›<br>ä¸è¦ç»å¸¸è°ƒç”¨MappedByteBuffer.force()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å¼ºåˆ¶æ“ä½œç³»ç»Ÿå°†å†…å­˜ä¸­çš„å†…å®¹å†™å…¥ç¡¬ç›˜ï¼Œæ‰€ä»¥å¦‚æœä½ åœ¨æ¯æ¬¡å†™å†…å­˜æ˜ å°„æ–‡ä»¶åéƒ½è°ƒç”¨force()æ–¹æ³•ï¼Œä½ å°±ä¸èƒ½çœŸæ­£ä»å†…å­˜æ˜ å°„æ–‡ä»¶ä¸­è·ç›Šï¼Œè€Œæ˜¯è·Ÿdisk IOå·®ä¸å¤šã€‚<br>è¯»å†™å†…å­˜æ˜ å°„æ–‡ä»¶æ˜¯æ“ä½œç³»ç»Ÿæ¥è´Ÿè´£çš„ï¼Œå› æ­¤ï¼Œå³ä½¿ä½ çš„Javaç¨‹åºåœ¨å†™å…¥å†…å­˜åå°±æŒ‚æ‰äº†ï¼Œåªè¦æ“ä½œç³»ç»Ÿå·¥ä½œæ­£å¸¸ï¼Œæ•°æ®å°±ä¼šå†™å…¥ç£ç›˜ã€‚<br>å¦‚æœç”µæºæ•…éšœæˆ–è€…ä¸»æœºç˜«ç—ªï¼Œæœ‰å¯èƒ½å†…å­˜æ˜ å°„æ–‡ä»¶è¿˜æ²¡æœ‰å†™å…¥ç£ç›˜ï¼Œæ„å‘³ç€å¯èƒ½ä¼šä¸¢å¤±ä¸€äº›å…³é”®æ•°æ®ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://stackoverflow.com/questions/258091/when-should-i-use-mmap-for-file-access">https://stackoverflow.com/questions/258091/when-should-i-use-mmap-for-file-access</a></li><li><a href="https://www.jianshu.com/p/187eada7b900">https://www.jianshu.com/p/187eada7b900</a></li><li><a href="https://juejin.im/post/5c3ec9ebf265da61223a93de#heading-0">https://juejin.im/post/5c3ec9ebf265da61223a93de#heading-0</a></li><li><a href="https://stackoverflow.com/questions/30180268/android-ndk-mmap-call-broken-on-32-bit-devices-after-upgrading-to-lollipop">https://stackoverflow.com/questions/30180268/android-ndk-mmap-call-broken-on-32-bit-devices-after-upgrading-to-lollipop</a></li><li><a href="https://stackoverflow.com/questions/33897711/android-mmap-fails-with-out-of-memory">https://stackoverflow.com/questions/33897711/android-mmap-fails-with-out-of-memory</a></li></ul><p>Androidä¸­çš„Binderä¹Ÿåˆ©ç”¨çš„mmapã€‚Binderä¼ é€’æ•°æ®æ—¶ï¼Œåªéœ€è¦å¤åˆ¶ä¸€æ¬¡ï¼Œå°±èƒ½æŠŠæ•°æ®ä¼ é€’åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸­ã€‚å‚è€ƒ<a href="https://rustfisher.com/2019/08/08/Android/Android-Binder_%E6%9C%BA%E5%88%B6%E4%BB%8B%E7%BB%8D/">Binderæœºåˆ¶ä»‹ç»</a></p><h2 id="Androidä¸­ä½¿ç”¨mmap"><a href="#Androidä¸­ä½¿ç”¨mmap" class="headerlink" title="Androidä¸­ä½¿ç”¨mmap"></a>Androidä¸­ä½¿ç”¨mmap</h2><p>Androidä¸­ä½¿ç”¨mmapï¼Œå¯ä»¥é€šè¿‡RandomAccessFileä¸MappedByteBufferæ¥é…åˆã€‚å‚è€ƒ<a href="https://rustfisher.com/2018/07/29/Dev-note/dev-note-app-drone/">droneå¼€å‘è®°å½• - logè®°å½•å·¥å…·</a></p><p>é€šè¿‡<code>randomAccessFile.getChannel().map</code>è·å–åˆ°<code>MappedByteBuffer</code>ã€‚ç„¶åè°ƒç”¨ByteBufferçš„putæ–¹æ³•æ·»åŠ æ•°æ®ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>mmap</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Œå°ç¨‹åºã€å¼€å‘è®°å½•</title>
    <link href="/2019/08/10/Dev-note/dev-note-miniapp-all/"/>
    <url>/2019/08/10/Dev-note/dev-note-miniapp-all/</url>
    
    <content type="html"><![CDATA[<h2 id="wxml"><a href="#wxml" class="headerlink" title="wxml"></a>wxml</h2><p>æ ‡ç­¾ä¸¥æ ¼é—­åˆã€‚<br>rpxï¼ˆresponsive pixelï¼‰å°ºå¯¸å•ä½ã€‚<br>å¤§å°å†™æ•æ„Ÿã€‚</p><p>æˆ‘ä»¬åªè¦ä¿æŒä¸€ä¸ªåŸåˆ™å°±å¯ä»¥æé«˜å°ç¨‹åºçš„æ¸²æŸ“æ€§èƒ½ï¼šæ¯æ¬¡åªè®¾ç½®éœ€è¦æ”¹å˜çš„æœ€å°å•ä½æ•°æ®ã€‚<br>æ­¤å¤–éœ€è¦æ³¨æ„ä»¥ä¸‹3ç‚¹ï¼š</p><ul><li>ç›´æ¥ä¿®æ”¹ Pageå®ä¾‹çš„this.data è€Œä¸è°ƒç”¨ this.setData æ˜¯æ— æ³•æ”¹å˜é¡µé¢çš„çŠ¶æ€çš„ï¼Œè¿˜ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´ã€‚</li><li>ç”±äºsetDataæ˜¯éœ€è¦ä¸¤ä¸ªçº¿ç¨‹çš„ä¸€äº›é€šä¿¡æ¶ˆè€—ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œæ¯æ¬¡è®¾ç½®çš„æ•°æ®ä¸åº”è¶…è¿‡1024kBã€‚</li><li>ä¸è¦æŠŠdataä¸­çš„ä»»æ„ä¸€é¡¹çš„valueè®¾ä¸ºundefinedï¼Œå¦åˆ™å¯èƒ½ä¼šæœ‰å¼•èµ·ä¸€äº›ä¸å¯é¢„æ–™çš„bugã€‚</li></ul><p>â€œç”¨æˆ·åœ¨æ¸²æŸ“å±‚çš„è¡Œä¸ºåé¦ˆâ€ä»¥åŠâ€œç»„ä»¶çš„éƒ¨åˆ†çŠ¶æ€åé¦ˆâ€æŠ½è±¡ä¸ºæ¸²æŸ“å±‚ä¼ é€’ç»™é€»è¾‘å±‚çš„â€œäº‹ä»¶â€</p><h3 id="æ•°æ®ç»‘å®š"><a href="#æ•°æ®ç»‘å®š" class="headerlink" title="æ•°æ®ç»‘å®š"></a>æ•°æ®ç»‘å®š</h3><p>é€šè¿‡ <code>å¤§æ‹¬å·å¤§æ‹¬å·</code> è¯­æ³•å¯ä»¥ä½¿å¾— WXML æ‹¥æœ‰åŠ¨æ€æ¸²æŸ“çš„èƒ½åŠ›ï¼Œé™¤æ­¤å¤–è¿˜å¯ä»¥åœ¨å…¶ä¸­è¿›è¡Œç®€å•çš„é€»è¾‘è¿ç®—ã€‚<br><code>å¤§æ‹¬å·å¤§æ‹¬å·</code>ä¸­è¿˜å¯ä»¥ç›´æ¥æ”¾ç½®æ•°å­—ã€å­—ç¬¦ä¸²æˆ–è€…æ˜¯æ•°ç»„ã€‚</p><p>ä½¿ç”¨ <code>wx:key</code> æ¥æŒ‡å®šåˆ—è¡¨ä¸­é¡¹ç›®çš„å”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚</p><p><code>wx:key</code> çš„å€¼ä»¥ä¸¤ç§å½¢å¼æä¾›ï¼š</p><ul><li>å­—ç¬¦ä¸²ï¼Œä»£è¡¨åœ¨ for å¾ªç¯çš„ array ä¸­ item çš„æŸä¸ª propertyï¼Œè¯¥ property çš„å€¼éœ€è¦æ˜¯åˆ—è¡¨ä¸­å”¯ä¸€çš„å­—ç¬¦ä¸²æˆ–æ•°å­—ï¼Œä¸”ä¸èƒ½åŠ¨æ€æ”¹å˜ã€‚</li><li>ä¿ç•™å…³é”®å­— this ä»£è¡¨åœ¨ for å¾ªç¯ä¸­çš„ item æœ¬èº«ï¼Œè¿™ç§è¡¨ç¤ºéœ€è¦ item æœ¬èº«æ˜¯ä¸€ä¸ªå”¯ä¸€çš„å­—ç¬¦ä¸²æˆ–è€…æ•°å­—</li></ul><h3 id="æ¨¡æ¿"><a href="#æ¨¡æ¿" class="headerlink" title="æ¨¡æ¿"></a>æ¨¡æ¿</h3><p>WXMLæä¾›æ¨¡æ¿ï¼ˆtemplateï¼‰ï¼Œå¯ä»¥åœ¨æ¨¡æ¿ä¸­å®šä¹‰ä»£ç ç‰‡æ®µï¼Œç„¶ååœ¨ä¸åŒçš„åœ°æ–¹è°ƒç”¨ã€‚ä½¿ç”¨ name å±æ€§ï¼Œä½œä¸ºæ¨¡æ¿çš„åå­—ã€‚ç„¶ååœ¨ <code>&lt;template/&gt;</code> å†…å®šä¹‰ä»£ç ç‰‡æ®µ</p><p>ä½¿ç”¨ is å±æ€§ï¼Œå£°æ˜éœ€è¦çš„ä½¿ç”¨çš„æ¨¡æ¿ï¼Œç„¶åå°†æ¨¡æ¿æ‰€éœ€è¦çš„ data ä¼ å…¥</p><p>WXML æä¾›ä¸¤ç§æ–‡ä»¶å¼•ç”¨æ–¹å¼importå’Œincludeã€‚</p><p>import å¯ä»¥åœ¨è¯¥æ–‡ä»¶ä¸­ä½¿ç”¨ç›®æ ‡æ–‡ä»¶å®šä¹‰çš„ template</p><p>import ä¸å…·æœ‰é€’å½’çš„ç‰¹æ€§ã€‚</p><h3 id="æ¡ä»¶æ¸²æŸ“"><a href="#æ¡ä»¶æ¸²æŸ“" class="headerlink" title="æ¡ä»¶æ¸²æŸ“"></a>æ¡ä»¶æ¸²æŸ“</h3><p>åœ¨wxmlä¸­ä½¿ç”¨<code>wx:if</code>ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">wx:if</span>=<span class="hljs-string">&quot;&#123;&#123;showPing&#125;&#125;&quot;</span>&gt;</span>&#123;&#123;s.ping&#125;&#125; <span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>WXML ä¸­ï¼Œä½¿ç”¨ wx:if=â€â€œ æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ¸²æŸ“è¯¥ä»£ç å—ã€‚æ ‡ç­¾å®šä¹‰çš„å‰éƒ¨ä½¿ç”¨é€»è¾‘åˆ¤æ–­ã€‚<br>ä½¿ç”¨ wx:elif å’Œ wx:else æ¥æ·»åŠ ä¸€ä¸ª else å—ã€‚</p><h2 id="æ’ç‰ˆå¸ƒå±€"><a href="#æ’ç‰ˆå¸ƒå±€" class="headerlink" title="æ’ç‰ˆå¸ƒå±€"></a>æ’ç‰ˆå¸ƒå±€</h2><h3 id="æ°´å¹³å±…ä¸­å†…å®¹"><a href="#æ°´å¹³å±…ä¸­å†…å®¹" class="headerlink" title="æ°´å¹³å±…ä¸­å†…å®¹"></a>æ°´å¹³å±…ä¸­å†…å®¹</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:100%; display:flex;flex-direction:row;justify-content:center;&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="flexå‚ç›´æ–¹å‘å±…ä¸­"><a href="#flexå‚ç›´æ–¹å‘å±…ä¸­" class="headerlink" title="flexå‚ç›´æ–¹å‘å±…ä¸­"></a>flexå‚ç›´æ–¹å‘å±…ä¸­</h3><p>ä¸»è¦é <code>align-items: center;</code>ã€‚<br>ä¸è®¾ç½®é«˜åº¦çš„æ—¶å€™ã€‚<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.cfg-start</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">flex-direction</span>: row;<br>  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">20px</span>;<br>  <span class="hljs-attribute">align-items</span>: center;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>è®¾ç½®äº†ç»å¯¹å®šä½ã€‚éœ€è¦åŒæ—¶è®¾ç½®é«˜åº¦ã€‚<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.cfg-end</span> &#123;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">right</span>: <span class="hljs-number">0px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">5vh</span>;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">flex-direction</span>: row;<br>  <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">2px</span>;<br>  <span class="hljs-attribute">align-items</span>: center;<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="ç¡®å®šå®½é«˜çš„viewé‡Œå±…ä¸­å†…å®¹"><a href="#ç¡®å®šå®½é«˜çš„viewé‡Œå±…ä¸­å†…å®¹" class="headerlink" title="ç¡®å®šå®½é«˜çš„viewé‡Œå±…ä¸­å†…å®¹"></a>ç¡®å®šå®½é«˜çš„viewé‡Œå±…ä¸­å†…å®¹</h3><p>éœ€è¦è®¾ç½®<code>display: flex;</code>ï¼Œ<code>justify-content:center;</code>ï¼Œ<code>align-items: center;</code>ã€‚<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.ball</span> &#123;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">30px</span>;<br>  <span class="hljs-attribute">height</span>:<span class="hljs-number">30px</span>;<br>  <span class="hljs-attribute">margin</span>: <span class="hljs-number">2px</span> <span class="hljs-number">2px</span>;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">justify-content</span>:center;<br>  <span class="hljs-attribute">align-items</span>: center;<br>  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">15px</span>;<br>  <span class="hljs-attribute">color</span>:white;<br>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="viewä½äºçˆ¶å®¹å™¨åº•éƒ¨"><a href="#viewä½äºçˆ¶å®¹å™¨åº•éƒ¨" class="headerlink" title="viewä½äºçˆ¶å®¹å™¨åº•éƒ¨"></a>viewä½äºçˆ¶å®¹å™¨åº•éƒ¨</h3><p>æˆ–è€…å«åšdivä½äºçˆ¶å®¹å™¨åº•éƒ¨ã€‚<br>çˆ¶å®¹å™¨è®¾ç½®<code>position: relative</code>ã€‚<br>å­viewè®¾ç½®<code>position: absolute</code>ã€‚<br>å¦‚æœçˆ¶å®¹å™¨æ²¡æœ‰è®¾ç½®relativeå±æ€§ï¼Œå­divï¼ˆæˆ–å­viewï¼‰ä¼šç›¸å¯¹äºé¡µé¢çš„åº•éƒ¨ã€‚</p><p>CSS DIVåœ¨å¦ä¸€ä¸ªDIVåº•éƒ¨å±…ä¸­ä¾‹å­<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css">&lt;<span class="hljs-selector-tag">div</span> style=&quot;<span class="hljs-attribute">min-height</span>: <span class="hljs-number">360px</span>;<span class="hljs-attribute">position</span>:relative;&quot;&gt;<br>&lt;<span class="hljs-selector-tag">div</span> style=&quot;<span class="hljs-attribute">position</span>: absolute;<span class="hljs-attribute">bottom</span>: <span class="hljs-number">0px</span>;<span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;<span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);&quot;&gt;<br>&lt;/<span class="hljs-selector-tag">div</span>&gt;<br>&lt;<span class="hljs-selector-tag">div</span>&gt;<br></code></pre></td></tr></table></figure><br>è®¾ç½®<code>bottom</code>çš„æ—¶å€™è®°å¾—å¸¦å•ä½ã€‚</p><p>åŠ¨æ€åˆ¤æ–­èƒŒæ™¯è‰²ã€‚idxè¡¨ç¤ºä¸‹æ ‡ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background:&#123;&#123;idx%2 == 0? &#x27;#757575&#x27;:&#x27;#424242&#x27;&#125;&#125;&quot;</span>&gt;</span>äº”<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>åŠ¨æ€æ”¹å˜æ–‡å­—é¢œè‰²<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">bindtap</span>=<span class="hljs-string">&quot;onTapShowType&quot;</span> <span class="hljs-attr">data-type</span>=<span class="hljs-string">&#x27;1&#x27;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;color:&#123;&#123; showLetterType == 1? &#x27;#4fa003&#x27;:&#x27;#424242&#x27;&#125;&#125;&quot;</span>&gt;</span>äº”<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br></code></pre></td></tr></table></figure></p><h3 id="text"><a href="#text" class="headerlink" title="text"></a>text</h3><p>font-size å­—ä½“å¤§å°ã€‚<br>font-weight å­—ä½“ç²—ç»†ï¼Œ580å·¦å³èƒ½æœ‰ç²—ä½“æ•ˆæœã€‚</p><p>ä¸‹åˆ’çº¿<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-attribute">text-decoration</span>: underline;<br></code></pre></td></tr></table></figure></p><h3 id="scroll-view"><a href="#scroll-view" class="headerlink" title="scroll-view"></a>scroll-view</h3><p>ä½¿ç”¨scroll viewã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">scroll-view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&#x27;word-field&#x27;</span> <span class="hljs-attr">enable-back-to-top</span> <span class="hljs-attr">scroll-into-view</span>=<span class="hljs-string">&quot;&#123;&#123;toView&#125;&#125;&quot;</span> <span class="hljs-attr">scroll-y</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">scroll-with-animation</span>=<span class="hljs-string">&quot;true&quot;</span> &gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;child-field&quot;</span>&gt;</span><br><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">scroll-view</span>&gt;</span><br></code></pre></td></tr></table></figure></p><h3 id="wx-forå­é¡¹æ–¹å‘"><a href="#wx-forå­é¡¹æ–¹å‘" class="headerlink" title="wx:forå­é¡¹æ–¹å‘"></a>wx:forå­é¡¹æ–¹å‘</h3><p>wx:forçš„å­é¡¹æ–¹å‘å…¶å®æ˜¯ç”±å®ƒçš„çˆ¶viewæ¥å†³å®šçš„ã€‚</p><h4 id="åˆ—è¡¨è‡ªåŠ¨æ¢è¡Œ"><a href="#åˆ—è¡¨è‡ªåŠ¨æ¢è¡Œ" class="headerlink" title="åˆ—è¡¨è‡ªåŠ¨æ¢è¡Œ"></a>åˆ—è¡¨è‡ªåŠ¨æ¢è¡Œ</h4><p>å‡è®¾æ¨ªå‘ï¼ˆrowï¼‰æ’åˆ—å­é¡¹ï¼Œå­é¡¹å¤ªå¤šçš„æ—¶å€™ä¼šæ¢åˆ°ä¸‹ä¸€è¡Œã€‚<br>éœ€è¦è®¾ç½®<code>flex-flow</code>ã€‚<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.correct-field</span> &#123;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">flex-flow</span>: row wrap;<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="css-åœ†è§’"><a href="#css-åœ†è§’" class="headerlink" title="css åœ†è§’"></a>css åœ†è§’</h3><p>åªè®¾ç½®ä¸€ä¸ªå€¼çš„è¯ï¼Œæ˜¯4ä¸ªåœ†è§’ã€‚<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;<br></code></pre></td></tr></table></figure><br>å•ä½æ˜¯pxã€‚å¦‚æœå•ä½ç”¨rpxï¼Œåˆ™ä¸æ˜¾ç¤ºåœ†è§’ã€‚</p><h3 id="èƒŒæ™¯åŠé€æ˜"><a href="#èƒŒæ™¯åŠé€æ˜" class="headerlink" title="èƒŒæ™¯åŠé€æ˜"></a>èƒŒæ™¯åŠé€æ˜</h3><p>çœŸæœºè°ƒè¯•æ—¶ï¼Œå°ç¨‹åºè®¾ç½®<code>background: #895fcce0;</code>æ˜¯æ— æ•ˆçš„ï¼Œçœ‹ä¸åˆ°é¢œè‰²ã€‚<br>è¦ä½¿ç”¨<code>opacity</code>å±æ€§æ¥è®¾ç½®ä¸é€æ˜åº¦ã€‚<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-attribute">background</span>: <span class="hljs-number">#895fcc</span>;<br><span class="hljs-attribute">opacity</span>:<span class="hljs-number">0.85</span>;<br></code></pre></td></tr></table></figure></p><p>èƒŒæ™¯æ¸å˜è‰²<br><a href="https://developers.weixin.qq.com/community/develop/doc/06e11913e57af653ca251462fcc134f2">https://developers.weixin.qq.com/community/develop/doc/06e11913e57af653ca251462fcc134f2</a></p><h3 id="css-class-æŒ‰æ¡ä»¶é€‰æ‹©"><a href="#css-class-æŒ‰æ¡ä»¶é€‰æ‹©" class="headerlink" title="css class æŒ‰æ¡ä»¶é€‰æ‹©"></a>css class æŒ‰æ¡ä»¶é€‰æ‹©</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;&#123;&#123;showPage==1?&#x27;chooser.chosen&#x27;:&#x27;chooser&#x27;&#125;&#125;&quot;</span> &gt;</span>sample<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç”¨å¤§æ‹¬å·é‡Œçš„ä¸‰ç›®åˆ¤æ–­ã€‚</p><h3 id="ä¾‹å­ğŸŒ°-è¿›åº¦æ¡å’Œæ–‡å­—"><a href="#ä¾‹å­ğŸŒ°-è¿›åº¦æ¡å’Œæ–‡å­—" class="headerlink" title="ä¾‹å­ğŸŒ° - è¿›åº¦æ¡å’Œæ–‡å­—"></a>ä¾‹å­ğŸŒ° - è¿›åº¦æ¡å’Œæ–‡å­—</h3><p><img src="http://rustblogres.rustfisher.com/mini_progress_text_0201.png" alt="è¿›åº¦æ¡å’Œæ–‡å­—æ•ˆæœå›¾"></p><p>éœ€æ±‚ï¼šæ˜¾ç¤ºåšé¢˜çš„è¿›åº¦ã€‚<br>è¿›åº¦æ¡ä½œä¸ºèƒŒæ™¯ã€‚æ–‡å­—ç›–åœ¨ä¸Šé¢ã€‚å¤´å°¾å„ä¸€ä¸ªæ–‡å­—ã€‚<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.top-bar</span> &#123;<br>  <span class="hljs-attribute">position</span>: relative;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;<br>&#125;<br><br><span class="hljs-selector-class">.pb</span> &#123;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;<br>&#125;<br><br><span class="hljs-selector-class">.top-title-field</span> &#123;<br>  <span class="hljs-attribute">position</span>: absolute;<br>  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">10px</span>;<br>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;<br>  <span class="hljs-attribute">align-items</span>: center;<br>  <span class="hljs-attribute">display</span>: flex;<br>  <span class="hljs-attribute">justify-content</span>: center;<br>&#125;<br></code></pre></td></tr></table></figure></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-bar&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">progress</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;pb&quot;</span> <span class="hljs-attr">stroke-width</span>=<span class="hljs-string">&quot;40px&quot;</span> <span class="hljs-attr">activeColor</span>=<span class="hljs-string">&quot;#42A5F5&quot;</span> <span class="hljs-attr">percent</span>=<span class="hljs-string">&quot;40&quot;</span> /&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;top-title-field&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">text</span>&gt;</span>å•é¡¹é€‰æ‹©<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;progress-text&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">text</span>&gt;</span>4/10<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="æ’­æ”¾éŸ³é¢‘"><a href="#æ’­æ”¾éŸ³é¢‘" class="headerlink" title="æ’­æ”¾éŸ³é¢‘"></a>æ’­æ”¾éŸ³é¢‘</h2><p>æ’­æ”¾éŸ³é¢‘éœ€è¦ç”¨åˆ°<code>InnerAudioContext</code></p><h3 id="æ’­æ”¾æœ¬åœ°æ–‡ä»¶"><a href="#æ’­æ”¾æœ¬åœ°æ–‡ä»¶" class="headerlink" title="æ’­æ”¾æœ¬åœ°æ–‡ä»¶"></a>æ’­æ”¾æœ¬åœ°æ–‡ä»¶</h3><p>æ’­æ”¾æœ¬åœ°éŸ³é¢‘ã€‚<br>éŸ³é¢‘æ–‡ä»¶åœ¨audioç›®å½•é‡Œã€‚audioç›®å½•å’Œpagesç›®å½•åŒçº§ã€‚<br>å…ˆåˆ›å»ºInnerAudioContextã€‚å¹¶ä¸”åœ¨onLoadæ–¹æ³•ä¸­è®¾ç½®ç›‘å¬ã€‚<br>æ³¨æ„æœ¬åœ°éŸ³é¢‘æ–‡ä»¶çš„è·¯å¾„å†™æ³•ï¼Œä¸ç”¨å†™ç›¸å¯¹è·¯å¾„ï¼Œç”¨ç»å¯¹è·¯å¾„å°±å¥½ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> iac = wx.<span class="hljs-title function_">createInnerAudioContext</span>()<br><br><span class="hljs-title class_">Page</span>(&#123;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åŠ è½½</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-attr">onLoad</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">registerAudioContext</span>()<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;ac &#x27;</span>, iac)<br>  &#125;,<br><br>  <span class="hljs-attr">onTapSound</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) &#123;<br>    <span class="hljs-comment">// console.log(event)</span><br>    <span class="hljs-keyword">var</span> word = event.<span class="hljs-property">currentTarget</span>.<span class="hljs-property">id</span>;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;cilck&#x27;</span>, word)<br>    iac.<span class="hljs-property">src</span> = <span class="hljs-string">&#x27;audio/a.mp3&#x27;</span><br>    iac.<span class="hljs-property">volume</span> = <span class="hljs-number">2</span><br>    iac.<span class="hljs-property">loop</span> = <span class="hljs-literal">false</span><br>    iac.<span class="hljs-title function_">play</span>()<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;tap sound done. &#x27;</span>)<br>  &#125;,<br><br>  <span class="hljs-comment">// æ³¨å†ŒéŸ³é¢‘</span><br>  <span class="hljs-attr">registerAudioContext</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    iac.<span class="hljs-title function_">onEnded</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;on ended&#x27;</span>, res)<br>    &#125;)<br><br>    iac.<span class="hljs-title function_">onError</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>      <span class="hljs-comment">// æ’­æ”¾éŸ³é¢‘å¤±è´¥çš„å›è°ƒ</span><br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;æ’­æ”¾éŸ³é¢‘å¤±è´¥&#x27;</span>, res);<br>    &#125;)<br><br>    iac.<span class="hljs-title function_">onStop</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;æ’­æ”¾ç»“æŸ!&#x27;</span>);<br>    &#125;)<br><br>  &#125;,<br>&#125;)<br></code></pre></td></tr></table></figure></p><p>æµ‹è¯•å‘ç°ï¼Œå®‰å“æ‰‹æœºæ’­æ”¾çš„éŸ³é¢‘æ”¯æŒmp3ä¸pepmã€‚iPhone Xsä¸èƒ½æ’­æ”¾pepmã€‚<br>åœ¨æœ¬åœ°æ”¾éŸ³é¢‘æ–‡ä»¶æ—¶ï¼Œå°ç¨‹åºä¼šæç¤ºâ€œæ–‡ä»¶æœªä¸Šä¼ â€ã€‚å¯èƒ½æ˜¯å°ç¨‹åºç¼–è¯‘å®Œæˆéœ€å°äºæŸä¸ªå¤§å°ï¼ˆ2Mï¼‰æ‰èƒ½ä¸Šä¼ ã€‚<br>é‚£ä¹ˆæˆ‘ä»¬æŠŠéŸ³é¢‘æ–‡ä»¶æ”¾åœ¨æœåŠ¡å™¨ä¸Šå§ã€‚<br>å¯ä»¥ä½¿ç”¨å¾®ä¿¡äº‘å¼€å‘é‡Œçš„å­˜å‚¨ã€‚ä¸Šä¼ æ–‡ä»¶åï¼Œæ‰¾åˆ°æ–‡ä»¶çš„ä¸‹è½½åœ°å€ï¼Œhttpså¼€å¤´çš„ã€‚è®¾ç½®ç»™iacçš„srcã€‚</p><h3 id="æ’­æ”¾ç½‘ç»œéŸ³é¢‘"><a href="#æ’­æ”¾ç½‘ç»œéŸ³é¢‘" class="headerlink" title="æ’­æ”¾ç½‘ç»œéŸ³é¢‘"></a>æ’­æ”¾ç½‘ç»œéŸ³é¢‘</h3><p>æ‰¾åˆ°éŸ³é¢‘æ–‡ä»¶çš„urlï¼Œèµ‹å€¼ç»™iac.srcã€‚ç„¶åæ’­æ”¾ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">iac.<span class="hljs-property">src</span> = <span class="hljs-string">&#x27;https://audio....&#x27;</span><br></code></pre></td></tr></table></figure></p><h2 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h2><p><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/ability/file-system.html">https://developers.weixin.qq.com/miniprogram/dev/framework/ability/file-system.html</a></p><p>ä½¿ç”¨<code>FileSystemManager</code>çš„æ–¹æ³•ã€‚</p><h3 id="åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨"><a href="#åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨" class="headerlink" title="åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨"></a>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨</h3><p>å¼‚æ­¥çš„æ–¹å¼åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> fs = wx.<span class="hljs-title function_">getFileSystemManager</span>()<br>fs.<span class="hljs-title function_">access</span>(&#123;<br>  <span class="hljs-attr">path</span>: audioDir,<br>  <span class="hljs-title function_">success</span>(<span class="hljs-params">res</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(audioDir, remoteDir, res)<br>  &#125;,<br>  <span class="hljs-title function_">fail</span>(<span class="hljs-params">err</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err)<br>  &#125;<br>&#125;);<br><br></code></pre></td></tr></table></figure></p><p>åŒæ­¥åˆ¤æ–­ã€‚å¦‚æœä¸å­˜åœ¨åˆ™ä¼šæŠ¥é”™ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">try</span> &#123;<br>  fs.<span class="hljs-title function_">accessSync</span>(localFilePath)<br>&#125; <span class="hljs-keyword">catch</span> (t) &#123;<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(localFilePath, <span class="hljs-string">&#x27;not exists.&#x27;</span>)<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="åˆ›å»ºç›®å½•-mkdir"><a href="#åˆ›å»ºç›®å½•-mkdir" class="headerlink" title="åˆ›å»ºç›®å½• mkdir"></a>åˆ›å»ºç›®å½• mkdir</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js">fs.<span class="hljs-title function_">mkdir</span>(&#123;<br>  <span class="hljs-attr">dirPath</span>: audioDir,<br>  <span class="hljs-title function_">success</span>(<span class="hljs-params">res</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res)<br>  &#125;,<br>  <span class="hljs-title function_">fail</span>(<span class="hljs-params">err</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Can not create dir.&#x27;</span>, audioDir, err)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="ç•Œé¢"><a href="#ç•Œé¢" class="headerlink" title="ç•Œé¢"></a>ç•Œé¢</h2><h3 id="è·³å›ä¸Šä¸€ä¸ªç•Œé¢"><a href="#è·³å›ä¸Šä¸€ä¸ªç•Œé¢" class="headerlink" title="è·³å›ä¸Šä¸€ä¸ªç•Œé¢"></a>è·³å›ä¸Šä¸€ä¸ªç•Œé¢</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js">wx.<span class="hljs-title function_">navigateBack</span>(&#123;&#125;)<br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js">wx.<span class="hljs-title function_">navigateBack</span>(&#123;<br>  <span class="hljs-attr">delta</span>: <span class="hljs-number">1</span><br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="å®šæ—¶ä»»åŠ¡"><a href="#å®šæ—¶ä»»åŠ¡" class="headerlink" title="å®šæ—¶ä»»åŠ¡"></a>å®šæ—¶ä»»åŠ¡</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>  <span class="hljs-comment">// æ“ä½œ</span><br>&#125;, <span class="hljs-number">1000</span>)<br></code></pre></td></tr></table></figure><h2 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h2><p>å¾®ä¿¡å°ç¨‹åºæä¾›äº†ä¸‹è½½apiã€‚</p><h3 id="ä¸‹è½½æ–‡ä»¶"><a href="#ä¸‹è½½æ–‡ä»¶" class="headerlink" title="ä¸‹è½½æ–‡ä»¶"></a>ä¸‹è½½æ–‡ä»¶</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs js">wx.<span class="hljs-title function_">downloadFile</span>(&#123;<br>  <span class="hljs-attr">url</span>: targetUrl,<br>  <span class="hljs-attr">filePath</span>: localFilePath,<br>  <span class="hljs-attr">success</span>: <span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;download success&#x27;</span>)<br>  &#125;,<br>  <span class="hljs-attr">fail</span>: <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;download fail&#x27;</span>,err)<br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure><h2 id="ç‚¹å‡»äº‹ä»¶"><a href="#ç‚¹å‡»äº‹ä»¶" class="headerlink" title="ç‚¹å‡»äº‹ä»¶"></a>ç‚¹å‡»äº‹ä»¶</h2><p>ç‚¹å‡»äº‹ä»¶ä¸»è¦é <code>bindtap</code>æ–¹æ³•ã€‚</p><h3 id="ç‚¹å‡»äº‹ä»¶ä¼ é€’å‚æ•°"><a href="#ç‚¹å‡»äº‹ä»¶ä¼ é€’å‚æ•°" class="headerlink" title="ç‚¹å‡»äº‹ä»¶ä¼ é€’å‚æ•°"></a>ç‚¹å‡»äº‹ä»¶ä¼ é€’å‚æ•°</h3><p>æ•°æ®åœ¨soundRowAé‡Œé¢ã€‚æ¸²æŸ“ä¸€ä¸ªåˆ—è¡¨ã€‚<br>wxmlä¸­åŠ ä¸Šdataç±»å‹ï¼Œè¿™é‡Œæ˜¯<code>data-word</code>ã€‚ä¹Ÿå¯ä»¥èµ·åˆ«çš„åå­—ï¼Œä½†ä¸€å®šè¦<code>data-</code>å¼€å¤´ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">wx:for</span>=<span class="hljs-string">&quot;&#123;&#123;soundRowA&#125;&#125;&quot;</span> <span class="hljs-attr">wx:for-index</span>=<span class="hljs-string">&quot;idx&quot;</span> <span class="hljs-attr">wx:for-item</span>=<span class="hljs-string">&quot;s&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">bindtap</span>=<span class="hljs-string">&quot;onTapSound&quot;</span> <span class="hljs-attr">data-word</span>=<span class="hljs-string">&#x27;&#123;&#123;s&#125;&#125;&#x27;</span>&gt;</span><br>    æ˜¾ç¤ºä¸€äº›æ•°æ®<br>  <span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>jsä¸­å®ç°<code>onTapSound</code>æ–¹æ³•ã€‚è·å–ç‚¹å‡»äº‹ä»¶eventã€‚<br>ä¼ é€’å›æ¥çš„æ•°æ®æ˜¯åœ¨<code>event.currentTarget.dataset</code>ä¸­ã€‚<br>æ ¹æ®wxmlä¸­<code>data-word</code>ï¼Œä¼ é€’å›æ¥çš„æ•°æ®çš„keyæ˜¯<code>word</code>ã€‚<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">onTapSound</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) &#123;<br>  <span class="hljs-keyword">var</span> word = event.<span class="hljs-property">currentTarget</span>.<span class="hljs-property">dataset</span>.<span class="hljs-property">word</span><br>&#125;,<br></code></pre></td></tr></table></figure></p><h2 id="tabbar"><a href="#tabbar" class="headerlink" title="tabbar"></a>tabbar</h2><p><a href="https://developers.weixin.qq.com/miniprogram/dev/extended/weui/tabbar.html">https://developers.weixin.qq.com/miniprogram/dev/extended/weui/tabbar.html</a></p><p>åœ¨åº•éƒ¨ï¼Œèµ·å¯¼èˆªä½œç”¨</p>]]></content>
    
    
    <categories>
      
      <category>miniprogram</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€å‘è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android Binder æœºåˆ¶ä»‹ç»</title>
    <link href="/2019/08/08/Android/Android-Binder_mechanism_intro/"/>
    <url>/2019/08/08/Android/Android-Binder_mechanism_intro/</url>
    
    <content type="html"><![CDATA[<h2 id="é¢å‘å¯¹è±¡çš„IPC-Binder"><a href="#é¢å‘å¯¹è±¡çš„IPC-Binder" class="headerlink" title="é¢å‘å¯¹è±¡çš„IPC - Binder"></a>é¢å‘å¯¹è±¡çš„IPC - Binder</h2><p>c/sæ¶æ„ï¼Œå®¢æˆ·ç«¯è¦æ‰¾å¾—åˆ°æœåŠ¡ç«¯ã€‚<br>Binderä½¿ç”¨Client-Serveré€šä¿¡æ–¹å¼ï¼šä¸€ä¸ªè¿›ç¨‹ä½œä¸ºServeræä¾›è¯¸å¦‚è§†é¢‘/éŸ³é¢‘è§£ç ï¼Œè§†é¢‘æ•è·ï¼Œåœ°å€æœ¬æŸ¥è¯¢ï¼Œç½‘ç»œè¿æ¥ç­‰æœåŠ¡ï¼›å¤šä¸ªè¿›ç¨‹ä½œä¸ºClientå‘Serverå‘èµ·æœåŠ¡è¯·æ±‚ï¼Œè·å¾—æ‰€éœ€è¦çš„æœåŠ¡ã€‚è¦æƒ³å®ç°Client-Serveré€šä¿¡æ®å¿…é¡»å®ç°ä»¥ä¸‹ä¸¤ç‚¹ï¼šä¸€æ˜¯serverå¿…é¡»æœ‰ç¡®å®šçš„è®¿é—®æ¥å…¥ç‚¹æˆ–è€…è¯´åœ°å€æ¥æ¥å—Clientçš„è¯·æ±‚ï¼Œå¹¶ä¸”Clientå¯ä»¥é€šè¿‡æŸç§é€”å¾„è·çŸ¥Serverçš„åœ°å€ï¼›äºŒæ˜¯åˆ¶å®šCommand-Replyåè®®æ¥ä¼ è¾“æ•°æ®ã€‚ä¾‹å¦‚åœ¨ç½‘ç»œé€šä¿¡ä¸­Serverçš„è®¿é—®æ¥å…¥ç‚¹å°±æ˜¯Serverä¸»æœºçš„IPåœ°å€+ç«¯å£å·ï¼Œä¼ è¾“åè®®ä¸ºTCPåè®®ã€‚å¯¹Binderè€Œè¨€ï¼ŒBinderå¯ä»¥çœ‹æˆServeræä¾›çš„å®ç°æŸä¸ªç‰¹å®šæœåŠ¡çš„è®¿é—®æ¥å…¥ç‚¹ï¼Œ Clienté€šè¿‡è¿™ä¸ªâ€˜åœ°å€â€™å‘Serverå‘é€è¯·æ±‚æ¥ä½¿ç”¨è¯¥æœåŠ¡ï¼›å¯¹Clientè€Œè¨€ï¼ŒBinderå¯ä»¥çœ‹æˆæ˜¯é€šå‘Serverçš„ç®¡é“å…¥å£ï¼Œè¦æƒ³å’ŒæŸä¸ªServeré€šä¿¡é¦–å…ˆå¿…é¡»å»ºç«‹è¿™ä¸ªç®¡é“å¹¶è·å¾—ç®¡é“å…¥å£ã€‚</p><p>ä¸å…¶å®ƒIPCä¸åŒï¼ŒBinderä½¿ç”¨äº†é¢å‘å¯¹è±¡çš„æ€æƒ³æ¥æè¿°ä½œä¸ºè®¿é—®æ¥å…¥ç‚¹çš„BinderåŠå…¶åœ¨Clientä¸­çš„å…¥å£ã€‚Binderæ˜¯ä¸€ä¸ªå®ä½“ä½äºServerä¸­çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æä¾›äº†ä¸€å¥—æ–¹æ³•ç”¨ä»¥å®ç°å¯¹æœåŠ¡çš„è¯·æ±‚ï¼Œå°±è±¡ç±»çš„æˆå‘˜å‡½æ•°ã€‚éå¸ƒäºclientä¸­çš„å…¥å£å¯ä»¥çœ‹æˆæŒ‡å‘è¿™ä¸ªbinderå¯¹è±¡çš„â€˜æŒ‡é’ˆâ€™ï¼Œä¸€æ—¦è·å¾—äº†è¿™ä¸ªâ€˜æŒ‡é’ˆâ€™å°±å¯ä»¥è°ƒç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•è®¿é—®serverã€‚åœ¨Clientçœ‹æ¥ï¼Œé€šè¿‡Binderâ€˜æŒ‡é’ˆâ€™è°ƒç”¨å…¶æä¾›çš„æ–¹æ³•å’Œé€šè¿‡æŒ‡é’ˆè°ƒç”¨å…¶å®ƒä»»ä½•æœ¬åœ°å¯¹è±¡çš„æ–¹æ³•å¹¶æ— åŒºåˆ«ï¼Œå°½ç®¡å‰è€…çš„å®ä½“ä½äºè¿œç«¯Serverä¸­ï¼Œè€Œåè€…å®ä½“ä½äºæœ¬åœ°å†…å­˜ä¸­ã€‚â€˜æŒ‡é’ˆâ€™æ˜¯C++çš„æœ¯è¯­ï¼Œè€Œæ›´é€šå¸¸çš„è¯´æ³•æ˜¯å¼•ç”¨ï¼Œå³Clienté€šè¿‡Binderçš„å¼•ç”¨è®¿é—®Serverã€‚è€Œè½¯ä»¶é¢†åŸŸå¦ä¸€ä¸ªæœ¯è¯­â€˜å¥æŸ„â€™ä¹Ÿå¯ä»¥ç”¨æ¥è¡¨è¿°Binderåœ¨Clientä¸­çš„å­˜åœ¨æ–¹å¼ã€‚ä»é€šä¿¡çš„è§’åº¦çœ‹ï¼ŒClientä¸­çš„Binderä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯Server Binderçš„â€˜ä»£ç†â€™ï¼Œåœ¨æœ¬åœ°ä»£è¡¨è¿œç«¯Serverä¸ºClientæä¾›æœåŠ¡ã€‚æœ¬æ–‡ä¸­ä¼šä½¿ç”¨â€˜å¼•ç”¨â€™æˆ–â€˜å¥æŸ„â€™è¿™ä¸ªä¸¤å¹¿æ³›ä½¿ç”¨çš„æœ¯è¯­ã€‚</p><p><strong>Binderå¯¹è±¡æ˜¯ä¸€ä¸ªå¯ä»¥è·¨è¿›ç¨‹å¼•ç”¨çš„å¯¹è±¡ï¼Œå®ƒçš„å®ä½“ä½äºä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œè€Œå®ƒçš„å¼•ç”¨å´éå¸ƒäºç³»ç»Ÿçš„å„ä¸ªè¿›ç¨‹ä¹‹ä¸­ã€‚</strong></p><p>é¢å‘å¯¹è±¡æ€æƒ³çš„å¼•å…¥å°†è¿›ç¨‹é—´é€šä¿¡è½¬åŒ–ä¸ºé€šè¿‡å¯¹æŸä¸ªBinderå¯¹è±¡çš„å¼•ç”¨è°ƒç”¨è¯¥å¯¹è±¡çš„æ–¹æ³•ï¼Œè€Œå…¶ç‹¬ç‰¹ä¹‹å¤„åœ¨äºBinderå¯¹è±¡æ˜¯ä¸€ä¸ªå¯ä»¥è·¨è¿›ç¨‹å¼•ç”¨çš„å¯¹è±¡ï¼Œå®ƒçš„å®ä½“ä½äºä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œè€Œå®ƒçš„å¼•ç”¨å´éå¸ƒäºç³»ç»Ÿçš„å„ä¸ªè¿›ç¨‹ä¹‹ä¸­ã€‚æœ€è¯±äººçš„æ˜¯ï¼Œè¿™ä¸ªå¼•ç”¨å’Œjavaé‡Œå¼•ç”¨ä¸€æ ·æ—¢å¯ä»¥æ˜¯å¼ºç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼±ç±»å‹ï¼Œè€Œä¸”å¯ä»¥ä»ä¸€ä¸ªè¿›ç¨‹ä¼ ç»™å…¶å®ƒè¿›ç¨‹ï¼Œè®©å¤§å®¶éƒ½èƒ½è®¿é—®åŒä¸€Serverï¼Œå°±è±¡å°†ä¸€ä¸ªå¯¹è±¡æˆ–å¼•ç”¨èµ‹å€¼ç»™å¦ä¸€ä¸ªå¼•ç”¨ä¸€æ ·ã€‚Binderæ¨¡ç³Šäº†è¿›ç¨‹è¾¹ç•Œï¼Œæ·¡åŒ–äº†è¿›ç¨‹é—´é€šä¿¡è¿‡ç¨‹ï¼Œæ•´ä¸ªç³»ç»Ÿä»¿ä½›è¿è¡ŒäºåŒä¸€ä¸ªé¢å‘å¯¹è±¡çš„ç¨‹åºä¹‹ä¸­ã€‚å½¢å½¢è‰²è‰²çš„Binderå¯¹è±¡ä»¥åŠæ˜Ÿç½—æ£‹å¸ƒçš„å¼•ç”¨ä»¿ä½›ç²˜æ¥å„ä¸ªåº”ç”¨ç¨‹åºçš„èƒ¶æ°´ï¼Œè¿™ä¹Ÿæ˜¯Binderåœ¨è‹±æ–‡é‡Œçš„åŸæ„ã€‚</p><p>å½“ç„¶é¢å‘å¯¹è±¡åªæ˜¯é’ˆå¯¹åº”ç”¨ç¨‹åºè€Œè¨€ï¼Œå¯¹äºBinderé©±åŠ¨å’Œå†…æ ¸å…¶å®ƒæ¨¡å—ä¸€æ ·ä½¿ç”¨Cè¯­è¨€å®ç°ï¼Œæ²¡æœ‰ç±»å’Œå¯¹è±¡çš„æ¦‚å¿µã€‚Binderé©±åŠ¨ä¸ºé¢å‘å¯¹è±¡çš„è¿›ç¨‹é—´é€šä¿¡æä¾›åº•å±‚æ”¯æŒã€‚</p><h2 id="Binder-é€šä¿¡æ¨¡å‹"><a href="#Binder-é€šä¿¡æ¨¡å‹" class="headerlink" title="Binder é€šä¿¡æ¨¡å‹"></a>Binder é€šä¿¡æ¨¡å‹</h2><p>Binderæ¡†æ¶å®šä¹‰äº†å››ä¸ªè§’è‰²ï¼šServerï¼ŒClientï¼ŒServiceManagerï¼ˆä»¥åç®€ç§°SMgrï¼‰ä»¥åŠBinderé©±åŠ¨ã€‚å…¶ä¸­Serverï¼ŒClientï¼ŒSMgrè¿è¡Œäºç”¨æˆ·ç©ºé—´ï¼Œé©±åŠ¨è¿è¡Œäºå†…æ ¸ç©ºé—´ã€‚è¿™å››ä¸ªè§’è‰²çš„å…³ç³»å’Œäº’è”ç½‘ç±»ä¼¼ï¼šServeræ˜¯æœåŠ¡å™¨ï¼ŒClientæ˜¯å®¢æˆ·ç»ˆç«¯ï¼ŒSMgræ˜¯åŸŸåæœåŠ¡å™¨ï¼ˆDNSï¼‰ï¼Œé©±åŠ¨æ˜¯è·¯ç”±å™¨ã€‚</p><h3 id="Binder-é©±åŠ¨"><a href="#Binder-é©±åŠ¨" class="headerlink" title="Binder é©±åŠ¨"></a>Binder é©±åŠ¨</h3><p>å’Œè·¯ç”±å™¨ä¸€æ ·ï¼ŒBinderé©±åŠ¨è™½ç„¶é»˜é»˜æ— é—»ï¼Œå´æ˜¯é€šä¿¡çš„æ ¸å¿ƒã€‚å°½ç®¡åå«â€˜é©±åŠ¨â€™ï¼Œå®é™…ä¸Šå’Œç¡¬ä»¶è®¾å¤‡æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œåªæ˜¯å®ç°æ–¹å¼å’Œè®¾å¤‡é©±åŠ¨ç¨‹åºæ˜¯ä¸€æ ·çš„ï¼šå®ƒå·¥ä½œäºå†…æ ¸æ€ï¼Œæä¾›open()ï¼Œmmap()ï¼Œpoll()ï¼Œioctl()ç­‰æ ‡å‡†æ–‡ä»¶æ“ä½œï¼Œä»¥å­—ç¬¦é©±åŠ¨è®¾å¤‡ä¸­çš„miscè®¾å¤‡æ³¨å†Œåœ¨è®¾å¤‡ç›®å½•/devä¸‹ï¼Œç”¨æˆ·é€šè¿‡/dev/binderè®¿é—®è¯¥å®ƒã€‚é©±åŠ¨è´Ÿè´£è¿›ç¨‹ä¹‹é—´Binderé€šä¿¡çš„å»ºç«‹ï¼ŒBinderåœ¨è¿›ç¨‹ä¹‹é—´çš„ä¼ é€’ï¼ŒBinderå¼•ç”¨è®¡æ•°ç®¡ç†ï¼Œæ•°æ®åŒ…åœ¨è¿›ç¨‹ä¹‹é—´çš„ä¼ é€’å’Œäº¤äº’ç­‰ä¸€ç³»åˆ—åº•å±‚æ”¯æŒã€‚é©±åŠ¨å’Œåº”ç”¨ç¨‹åºä¹‹é—´å®šä¹‰äº†ä¸€å¥—æ¥å£åè®®ï¼Œä¸»è¦åŠŸèƒ½ç”±ioctl()æ¥å£å®ç°ï¼Œä¸æä¾›read()ï¼Œwrite()æ¥å£ï¼Œå› ä¸ºioctl()çµæ´»æ–¹ä¾¿ï¼Œä¸”èƒ½å¤Ÿä¸€æ¬¡è°ƒç”¨å®ç°å…ˆå†™åè¯»ä»¥æ»¡è¶³åŒæ­¥äº¤äº’ï¼Œè€Œä¸å¿…åˆ†åˆ«è°ƒç”¨write()å’Œread()ã€‚Binderé©±åŠ¨çš„ä»£ç ä½äºlinuxç›®å½•çš„drivers/misc/binder.cä¸­ã€‚</p><h4 id="ServiceManager-ä¸å®åBinder"><a href="#ServiceManager-ä¸å®åBinder" class="headerlink" title="ServiceManager ä¸å®åBinder"></a>ServiceManager ä¸å®åBinder</h4><p>å’ŒDNSç±»ä¼¼ï¼ŒSMgrçš„ä½œç”¨æ˜¯å°†å­—ç¬¦å½¢å¼çš„Binderåå­—è½¬åŒ–æˆClientä¸­å¯¹è¯¥Binderçš„å¼•ç”¨ï¼Œä½¿å¾—Clientèƒ½å¤Ÿé€šè¿‡Binderåå­—è·å¾—å¯¹Serverä¸­Binderå®ä½“çš„å¼•ç”¨ã€‚æ³¨å†Œäº†åå­—çš„Binderå«å®åBinderï¼Œå°±è±¡æ¯ä¸ªç½‘ç«™é™¤äº†æœ‰IPåœ°å€å¤–è¿˜æœ‰è‡ªå·±çš„ç½‘å€ã€‚Serveråˆ›å»ºäº†Binderå®ä½“ï¼Œä¸ºå…¶å–ä¸€ä¸ªå­—ç¬¦å½¢å¼ï¼Œå¯è¯»æ˜“è®°çš„åå­—ï¼Œå°†è¿™ä¸ªBinderè¿åŒåå­—ä»¥æ•°æ®åŒ…çš„å½¢å¼é€šè¿‡Binderé©±åŠ¨å‘é€ç»™SMgrï¼Œé€šçŸ¥SMgræ³¨å†Œä¸€ä¸ªåå«å¼ ä¸‰çš„Binderï¼Œå®ƒä½äºæŸä¸ªServerä¸­ã€‚é©±åŠ¨ä¸ºè¿™ä¸ªç©¿è¿‡è¿›ç¨‹è¾¹ç•Œçš„Binderåˆ›å»ºä½äºå†…æ ¸ä¸­çš„å®ä½“èŠ‚ç‚¹ä»¥åŠSMgrå¯¹å®ä½“çš„å¼•ç”¨ï¼Œå°†åå­—åŠæ–°å»ºçš„å¼•ç”¨æ‰“åŒ…ä¼ é€’ç»™SMgrã€‚SMgræ”¶æ•°æ®åŒ…åï¼Œä»ä¸­å–å‡ºåå­—å’Œå¼•ç”¨å¡«å…¥ä¸€å¼ æŸ¥æ‰¾è¡¨ä¸­ã€‚</p><h4 id="ServiceManagerä»€ä¹ˆæ—¶å€™æ³¨å†Œçš„"><a href="#ServiceManagerä»€ä¹ˆæ—¶å€™æ³¨å†Œçš„" class="headerlink" title="ServiceManagerä»€ä¹ˆæ—¶å€™æ³¨å†Œçš„"></a>ServiceManagerä»€ä¹ˆæ—¶å€™æ³¨å†Œçš„</h4><p>ç»†å¿ƒçš„è¯»è€…å¯èƒ½ä¼šå‘ç°å…¶ä¸­çš„è¹Šè··ï¼šSMgræ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼ŒServeræ˜¯å¦ä¸€ä¸ªè¿›ç¨‹ï¼ŒServerå‘SMgræ³¨å†ŒBinderå¿…ç„¶ä¼šæ¶‰åŠè¿›ç¨‹é—´é€šä¿¡ã€‚å½“å‰å®ç°çš„æ˜¯è¿›ç¨‹é—´é€šä¿¡å´åˆè¦ç”¨åˆ°è¿›ç¨‹é—´é€šä¿¡ï¼Œè¿™å°±å¥½è±¡è›‹å¯ä»¥å­µå‡ºé¸¡å‰æå´æ˜¯è¦æ‰¾åªé¸¡æ¥å­µè›‹ã€‚Binderçš„å®ç°æ¯”è¾ƒå·§å¦™ï¼šé¢„å…ˆåˆ›é€ ä¸€åªé¸¡æ¥å­µè›‹ï¼šSMgrå’Œå…¶å®ƒè¿›ç¨‹åŒæ ·é‡‡ç”¨Binderé€šä¿¡ï¼ŒSMgræ˜¯Serverç«¯ï¼Œæœ‰è‡ªå·±çš„Binderå¯¹è±¡ï¼ˆå®ä½“ï¼‰ï¼Œå…¶å®ƒè¿›ç¨‹éƒ½æ˜¯Clientï¼Œéœ€è¦é€šè¿‡è¿™ä¸ªBinderçš„å¼•ç”¨æ¥å®ç°Binderçš„æ³¨å†Œï¼ŒæŸ¥è¯¢å’Œè·å–ã€‚SMgræä¾›çš„Binderæ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒæ²¡æœ‰åå­—ä¹Ÿä¸éœ€è¦æ³¨å†Œï¼Œå½“ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨BINDER_SET_CONTEXT_MGRå‘½ä»¤å°†è‡ªå·±æ³¨å†ŒæˆSMgræ—¶Binderé©±åŠ¨ä¼šè‡ªåŠ¨ä¸ºå®ƒåˆ›å»ºBinderå®ä½“ï¼ˆè¿™å°±æ˜¯é‚£åªé¢„å…ˆé€ å¥½çš„é¸¡ï¼‰ã€‚å…¶æ¬¡è¿™ä¸ªBinderçš„å¼•ç”¨åœ¨æ‰€æœ‰Clientä¸­éƒ½å›ºå®šä¸º0è€Œæ— é¡»é€šè¿‡å…¶å®ƒæ‰‹æ®µè·å¾—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªServerè‹¥è¦å‘SMgræ³¨å†Œè‡ªå·±Binderå°±å¿…éœ€é€šè¿‡0è¿™ä¸ªå¼•ç”¨å·å’ŒSMgrçš„Binderé€šä¿¡ã€‚ç±»æ¯”ç½‘ç»œé€šä¿¡ï¼Œ0å·å¼•ç”¨å°±å¥½æ¯”åŸŸåæœåŠ¡å™¨çš„åœ°å€ï¼Œä½ å¿…é¡»é¢„å…ˆæ‰‹å·¥æˆ–åŠ¨æ€é…ç½®å¥½ã€‚è¦æ³¨æ„è¿™é‡Œè¯´çš„Clientæ˜¯ç›¸å¯¹SMgrè€Œè¨€çš„ï¼Œä¸€ä¸ªåº”ç”¨ç¨‹åºå¯èƒ½æ˜¯ä¸ªæä¾›æœåŠ¡çš„Serverï¼Œä½†å¯¹SMgræ¥è¯´å®ƒä»ç„¶æ˜¯ä¸ªClientã€‚</p><h4 id="Client-è·å¾—å®åBinderçš„å¼•ç”¨"><a href="#Client-è·å¾—å®åBinderçš„å¼•ç”¨" class="headerlink" title="Client è·å¾—å®åBinderçš„å¼•ç”¨"></a>Client è·å¾—å®åBinderçš„å¼•ç”¨</h4><p>Serverå‘SMgræ³¨å†Œäº†Binderå®ä½“åŠå…¶åå­—åï¼ŒClientå°±å¯ä»¥é€šè¿‡åå­—è·å¾—è¯¥Binderçš„å¼•ç”¨äº†ã€‚Clientä¹Ÿåˆ©ç”¨ä¿ç•™çš„0å·å¼•ç”¨å‘SMgrè¯·æ±‚è®¿é—®æŸä¸ªBinderï¼šæˆ‘ç”³è¯·è·å¾—åå­—å«å¼ ä¸‰çš„Binderçš„å¼•ç”¨ã€‚SMgræ”¶åˆ°è¿™ä¸ªè¿æ¥è¯·æ±‚ï¼Œä»è¯·æ±‚æ•°æ®åŒ…é‡Œè·å¾—Binderçš„åå­—ï¼Œåœ¨æŸ¥æ‰¾è¡¨é‡Œæ‰¾åˆ°è¯¥åå­—å¯¹åº”çš„æ¡ç›®ï¼Œä»æ¡ç›®ä¸­å–å‡ºBinderçš„å¼•ç”¨ï¼Œå°†è¯¥å¼•ç”¨ä½œä¸ºå›å¤å‘é€ç»™å‘èµ·è¯·æ±‚çš„Clientã€‚ä»é¢å‘å¯¹è±¡çš„è§’åº¦ï¼Œè¿™ä¸ªBinderå¯¹è±¡ç°åœ¨æœ‰äº†ä¸¤ä¸ªå¼•ç”¨ï¼šä¸€ä¸ªä½äºSMgrä¸­ï¼Œä¸€ä¸ªä½äºå‘èµ·è¯·æ±‚çš„Clientä¸­ã€‚å¦‚æœæ¥ä¸‹æ¥æœ‰æ›´å¤šçš„Clientè¯·æ±‚è¯¥Binderï¼Œç³»ç»Ÿä¸­å°±ä¼šæœ‰æ›´å¤šçš„å¼•ç”¨æŒ‡å‘è¯¥Binderï¼Œå°±è±¡javaé‡Œä¸€ä¸ªå¯¹è±¡å­˜åœ¨å¤šä¸ªå¼•ç”¨ä¸€æ ·ã€‚è€Œä¸”ç±»ä¼¼çš„è¿™äº›æŒ‡å‘Binderçš„å¼•ç”¨æ˜¯å¼ºç±»å‹ï¼Œä»è€Œç¡®ä¿åªè¦æœ‰å¼•ç”¨Binderå®ä½“å°±ä¸ä¼šè¢«é‡Šæ”¾æ‰ã€‚é€šè¿‡ä»¥ä¸Šè¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼ŒSMgrè±¡ä¸ªç«è½¦ç¥¨ä»£å”®ç‚¹ï¼Œæ”¶é›†äº†æ‰€æœ‰ç«è½¦çš„è½¦ç¥¨ï¼Œå¯ä»¥é€šè¿‡å®ƒè´­ä¹°åˆ°ä¹˜åå„è¶Ÿç«è½¦çš„ç¥¨-å¾—åˆ°æŸä¸ªBinderçš„å¼•ç”¨ã€‚</p><h4 id="åŒ¿å-Binder"><a href="#åŒ¿å-Binder" class="headerlink" title="åŒ¿å Binder"></a>åŒ¿å Binder</h4><p>å¹¶ä¸æ˜¯æ‰€æœ‰Binderéƒ½éœ€è¦æ³¨å†Œç»™SMgrå¹¿è€Œå‘Šä¹‹çš„ã€‚Serverç«¯å¯ä»¥é€šè¿‡å·²ç»å»ºç«‹çš„Binderè¿æ¥å°†åˆ›å»ºçš„Binderå®ä½“ä¼ ç»™Clientï¼Œå½“ç„¶è¿™æ¡å·²ç»å»ºç«‹çš„Binderè¿æ¥å¿…é¡»æ˜¯é€šè¿‡å®åBinderå®ç°ã€‚ç”±äºè¿™ä¸ªBinderæ²¡æœ‰å‘SMgræ³¨å†Œåå­—ï¼Œæ‰€ä»¥æ˜¯ä¸ªåŒ¿åBinderã€‚Clientå°†ä¼šæ”¶åˆ°è¿™ä¸ªåŒ¿åBinderçš„å¼•ç”¨ï¼Œé€šè¿‡è¿™ä¸ªå¼•ç”¨å‘ä½äºServerä¸­çš„å®ä½“å‘é€è¯·æ±‚ã€‚åŒ¿åBinderä¸ºé€šä¿¡åŒæ–¹å»ºç«‹ä¸€æ¡ç§å¯†é€šé“ï¼Œåªè¦Serveræ²¡æœ‰æŠŠåŒ¿åBinderå‘ç»™åˆ«çš„è¿›ç¨‹ï¼Œåˆ«çš„è¿›ç¨‹å°±æ— æ³•é€šè¿‡ç©·ä¸¾æˆ–çŒœæµ‹ç­‰ä»»ä½•æ–¹å¼è·å¾—è¯¥Binderçš„å¼•ç”¨ï¼Œå‘è¯¥Binderå‘é€è¯·æ±‚ã€‚</p><p>ä¸‹å›¾å±•ç¤ºäº†å‚ä¸Binderé€šä¿¡çš„æ‰€æœ‰è§’è‰²ï¼Œå°†åœ¨åé¢çš„å†…å®¹ä¸­ä¸€ä¸€æåˆ°ã€‚</p><p><img src="http://rustblogres.rustfisher.com/Android-Binder-sys.png" alt="Binderé€šä¿¡æ¨¡å‹"></p><h4 id="Binder-å†…å­˜æ˜ å°„å’Œæ¥æ”¶ç¼“å­˜åŒºç®¡ç†"><a href="#Binder-å†…å­˜æ˜ å°„å’Œæ¥æ”¶ç¼“å­˜åŒºç®¡ç†" class="headerlink" title="Binder å†…å­˜æ˜ å°„å’Œæ¥æ”¶ç¼“å­˜åŒºç®¡ç†"></a>Binder å†…å­˜æ˜ å°„å’Œæ¥æ”¶ç¼“å­˜åŒºç®¡ç†</h4><p>æš‚ä¸”æ’‡å¼€Binderï¼Œè€ƒè™‘ä¸€ä¸‹ä¼ ç»Ÿçš„IPCæ–¹å¼ä¸­ï¼Œæ•°æ®æ˜¯æ€æ ·ä»å‘é€ç«¯åˆ°è¾¾æ¥æ”¶ç«¯çš„å‘¢ï¼Ÿé€šå¸¸çš„åšæ³•æ˜¯ï¼Œå‘é€æ–¹å°†å‡†å¤‡å¥½çš„æ•°æ®å­˜æ”¾åœ¨ç¼“å­˜åŒºä¸­ï¼Œè°ƒç”¨APIé€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›å…¥å†…æ ¸ä¸­ã€‚å†…æ ¸æœåŠ¡ç¨‹åºåœ¨å†…æ ¸ç©ºé—´åˆ†é…å†…å­˜ï¼Œå°†æ•°æ®ä»å‘é€æ–¹ç¼“å­˜åŒºå¤åˆ¶åˆ°å†…æ ¸ç¼“å­˜åŒºä¸­ã€‚æ¥æ”¶æ–¹è¯»æ•°æ®æ—¶ä¹Ÿè¦æä¾›ä¸€å—ç¼“å­˜åŒºï¼Œå†…æ ¸å°†æ•°æ®ä»å†…æ ¸ç¼“å­˜åŒºæ‹·è´åˆ°æ¥æ”¶æ–¹æä¾›çš„ç¼“å­˜åŒºä¸­å¹¶å”¤é†’æ¥æ”¶çº¿ç¨‹ï¼Œå®Œæˆä¸€æ¬¡æ•°æ®å‘é€ã€‚è¿™ç§å­˜å‚¨-è½¬å‘æœºåˆ¶æœ‰ä¸¤ä¸ªç¼ºé™·ï¼šé¦–å…ˆæ˜¯æ•ˆç‡ä½ä¸‹ï¼Œéœ€è¦åšä¸¤æ¬¡æ‹·è´ï¼šç”¨æˆ·ç©ºé—´-&gt;å†…æ ¸ç©ºé—´-&gt;ç”¨æˆ·ç©ºé—´ã€‚Linuxä½¿ç”¨copy_from_user()å’Œcopy_to_user()å®ç°è¿™ä¸¤ä¸ªè·¨ç©ºé—´æ‹·è´ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­å¦‚æœä½¿ç”¨äº†é«˜ç«¯å†…å­˜ï¼ˆhigh memoryï¼‰ï¼Œè¿™ç§æ‹·è´éœ€è¦ä¸´æ—¶å»ºç«‹/å–æ¶ˆé¡µé¢æ˜ å°„ï¼Œé€ æˆæ€§èƒ½æŸå¤±ã€‚å…¶æ¬¡æ˜¯æ¥æ”¶æ•°æ®çš„ç¼“å­˜è¦ç”±æ¥æ”¶æ–¹æä¾›ï¼Œå¯æ¥æ”¶æ–¹ä¸çŸ¥é“åˆ°åº•è¦å¤šå¤§çš„ç¼“å­˜æ‰å¤Ÿç”¨ï¼Œåªèƒ½å¼€è¾Ÿå°½é‡å¤§çš„ç©ºé—´æˆ–å…ˆè°ƒç”¨APIæ¥æ”¶æ¶ˆæ¯å¤´è·å¾—æ¶ˆæ¯ä½“å¤§å°ï¼Œå†å¼€è¾Ÿé€‚å½“çš„ç©ºé—´æ¥æ”¶æ¶ˆæ¯ä½“ã€‚ä¸¤ç§åšæ³•éƒ½æœ‰ä¸è¶³ï¼Œä¸æ˜¯æµªè´¹ç©ºé—´å°±æ˜¯æµªè´¹æ—¶é—´ã€‚</p><p>Binderé‡‡ç”¨ä¸€ç§å…¨æ–°ç­–ç•¥ï¼šç”±Binderé©±åŠ¨è´Ÿè´£ç®¡ç†æ•°æ®æ¥æ”¶ç¼“å­˜ã€‚æˆ‘ä»¬æ³¨æ„åˆ°Binderé©±åŠ¨å®ç°äº†mmap()ç³»ç»Ÿè°ƒç”¨ï¼Œè¿™å¯¹å­—ç¬¦è®¾å¤‡æ˜¯æ¯”è¾ƒç‰¹æ®Šçš„ï¼Œå› ä¸ºmmap()é€šå¸¸ç”¨åœ¨æœ‰ç‰©ç†å­˜å‚¨ä»‹è´¨çš„æ–‡ä»¶ç³»ç»Ÿä¸Šï¼Œè€Œè±¡Binderè¿™æ ·æ²¡æœ‰ç‰©ç†ä»‹è´¨ï¼Œçº¯ç²¹ç”¨æ¥é€šä¿¡çš„å­—ç¬¦è®¾å¤‡æ²¡å¿…è¦æ”¯æŒmmap()ã€‚Binderé©±åŠ¨å½“ç„¶ä¸æ˜¯ä¸ºäº†åœ¨ç‰©ç†ä»‹è´¨å’Œç”¨æˆ·ç©ºé—´åšæ˜ å°„ï¼Œè€Œæ˜¯ç”¨æ¥åˆ›å»ºæ•°æ®æ¥æ”¶çš„ç¼“å­˜ç©ºé—´ã€‚å…ˆçœ‹mmap()æ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼š</p><p>fd = open(â€œ/dev/binderâ€, O_RDWR);</p><p>mmap(NULL, MAP_SIZE, PROT_READ, MAP_PRIVATE, fd, 0);</p><p>è¿™æ ·Binderçš„æ¥æ”¶æ–¹å°±æœ‰äº†ä¸€ç‰‡å¤§å°ä¸ºMAP_SIZEçš„æ¥æ”¶ç¼“å­˜åŒºã€‚mmap()çš„è¿”å›å€¼æ˜¯å†…å­˜æ˜ å°„åœ¨ç”¨æˆ·ç©ºé—´çš„åœ°å€ï¼Œä¸è¿‡è¿™æ®µç©ºé—´æ˜¯ç”±é©±åŠ¨ç®¡ç†ï¼Œç”¨æˆ·ä¸å¿…ä¹Ÿä¸èƒ½ç›´æ¥è®¿é—®ï¼ˆæ˜ å°„ç±»å‹ä¸ºPROT_READï¼Œåªè¯»æ˜ å°„ï¼‰ã€‚</p><p>æ¥æ”¶ç¼“å­˜åŒºæ˜ å°„å¥½åå°±å¯ä»¥åšä¸ºç¼“å­˜æ± æ¥æ”¶å’Œå­˜æ”¾æ•°æ®äº†ã€‚å‰é¢è¯´è¿‡ï¼Œæ¥æ”¶æ•°æ®åŒ…çš„ç»“æ„ä¸ºbinder_transaction_dataï¼Œä½†è¿™åªæ˜¯æ¶ˆæ¯å¤´ï¼ŒçœŸæ­£çš„æœ‰æ•ˆè´Ÿè·ä½äºdata.bufferæ‰€æŒ‡å‘çš„å†…å­˜ä¸­ã€‚è¿™ç‰‡å†…å­˜ä¸éœ€è¦æ¥æ”¶æ–¹æä¾›ï¼Œæ°æ°æ˜¯æ¥è‡ªmmap()æ˜ å°„çš„è¿™ç‰‡ç¼“å­˜æ± ã€‚åœ¨æ•°æ®ä»å‘é€æ–¹å‘æ¥æ”¶æ–¹æ‹·è´æ—¶ï¼Œé©±åŠ¨ä¼šæ ¹æ®å‘é€æ•°æ®åŒ…çš„å¤§å°ï¼Œä½¿ç”¨æœ€ä½³åŒ¹é…ç®—æ³•ä»ç¼“å­˜æ± ä¸­æ‰¾åˆ°ä¸€å—å¤§å°åˆé€‚çš„ç©ºé—´ï¼Œå°†æ•°æ®ä»å‘é€ç¼“å­˜åŒºå¤åˆ¶è¿‡æ¥ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œå­˜æ”¾binder_transaction_dataç»“æ„æœ¬èº«ä»¥åŠè¡¨4ä¸­æ‰€æœ‰æ¶ˆæ¯çš„å†…å­˜ç©ºé—´è¿˜æ˜¯å¾—ç”±æ¥æ”¶è€…æä¾›ï¼Œä½†è¿™äº›æ•°æ®å¤§å°å›ºå®šï¼Œæ•°é‡ä¹Ÿä¸å¤šï¼Œä¸ä¼šç»™æ¥æ”¶æ–¹é€ æˆä¸ä¾¿ã€‚æ˜ å°„çš„ç¼“å­˜æ± è¦è¶³å¤Ÿå¤§ï¼Œå› ä¸ºæ¥æ”¶æ–¹çš„çº¿ç¨‹æ± å¯èƒ½ä¼šåŒæ—¶å¤„ç†å¤šæ¡å¹¶å‘çš„äº¤äº’ï¼Œæ¯æ¡äº¤äº’éƒ½éœ€è¦ä»ç¼“å­˜æ± ä¸­è·å–ç›®çš„å­˜å‚¨åŒºï¼Œä¸€æ—¦ç¼“å­˜æ± è€—ç«­å°†äº§ç”Ÿå¯¼è‡´æ— æ³•é¢„æœŸçš„åæœã€‚</p><p>æœ‰åˆ†é…å¿…ç„¶æœ‰é‡Šæ”¾ã€‚æ¥æ”¶æ–¹åœ¨å¤„ç†å®Œæ•°æ®åŒ…åï¼Œå°±è¦é€šçŸ¥é©±åŠ¨é‡Šæ”¾data.bufferæ‰€æŒ‡å‘çš„å†…å­˜åŒºã€‚åœ¨ä»‹ç»Binderåè®®æ—¶å·²ç»æåˆ°ï¼Œè¿™æ˜¯ç”±å‘½ä»¤BC_FREE_BUFFERå®Œæˆçš„ã€‚</p><p>é€šè¿‡ä¸Šé¢ä»‹ç»å¯ä»¥çœ‹åˆ°ï¼Œé©±åŠ¨ä¸ºæ¥æ”¶æ–¹åˆ†æ‹…äº†æœ€ä¸ºç¹ççš„ä»»åŠ¡ï¼šåˆ†é…/é‡Šæ”¾å¤§å°ä¸ç­‰ï¼Œéš¾ä»¥é¢„æµ‹çš„æœ‰æ•ˆè´Ÿè·ç¼“å­˜åŒºï¼Œè€Œæ¥æ”¶æ–¹åªéœ€è¦æä¾›ç¼“å­˜æ¥å­˜æ”¾å¤§å°å›ºå®šï¼Œæœ€å¤§ç©ºé—´å¯ä»¥é¢„æµ‹çš„æ¶ˆæ¯å¤´å³å¯ã€‚åœ¨æ•ˆç‡ä¸Šï¼Œç”±äºmmap()åˆ†é…çš„å†…å­˜æ˜¯æ˜ å°„åœ¨æ¥æ”¶æ–¹ç”¨æˆ·ç©ºé—´é‡Œçš„ï¼Œæ‰€æœ‰æ€»ä½“æ•ˆæœå°±ç›¸å½“äºå¯¹æœ‰æ•ˆè´Ÿè·æ•°æ®åšäº†ä¸€æ¬¡ä»å‘é€æ–¹ç”¨æˆ·ç©ºé—´åˆ°æ¥æ”¶æ–¹ç”¨æˆ·ç©ºé—´çš„ç›´æ¥æ•°æ®æ‹·è´ï¼Œçœå»äº†å†…æ ¸ä¸­æš‚å­˜è¿™ä¸ªæ­¥éª¤ï¼Œæå‡äº†ä¸€å€çš„æ€§èƒ½ã€‚é¡ºä¾¿å†æä¸€ç‚¹ï¼ŒLinuxå†…æ ¸å®é™…ä¸Šæ²¡æœ‰ä»ä¸€ä¸ªç”¨æˆ·ç©ºé—´åˆ°å¦ä¸€ä¸ªç”¨æˆ·ç©ºé—´ç›´æ¥æ‹·è´çš„å‡½æ•°ï¼Œéœ€è¦å…ˆç”¨copy_from_user()æ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼Œå†ç”¨copy_to_user()æ‹·è´åˆ°å¦ä¸€ä¸ªç”¨æˆ·ç©ºé—´ã€‚ä¸ºäº†å®ç°ç”¨æˆ·ç©ºé—´åˆ°ç”¨æˆ·ç©ºé—´çš„æ‹·è´ï¼Œmmap()åˆ†é…çš„å†…å­˜é™¤äº†æ˜ å°„è¿›äº†æ¥æ”¶æ–¹è¿›ç¨‹é‡Œï¼Œè¿˜æ˜ å°„è¿›äº†å†…æ ¸ç©ºé—´ã€‚æ‰€ä»¥è°ƒç”¨copy_from_user()å°†æ•°æ®æ‹·è´è¿›å†…æ ¸ç©ºé—´ä¹Ÿç›¸å½“äºæ‹·è´è¿›äº†æ¥æ”¶æ–¹çš„ç”¨æˆ·ç©ºé—´ï¼Œè¿™å°±æ˜¯Binderåªéœ€ä¸€æ¬¡æ‹·è´çš„â€˜ç§˜å¯†â€™ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://blog.csdn.net/universus/article/details/6211589">universusçš„ä¸“æ  - Android Binderè®¾è®¡ä¸å®ç° - è®¾è®¡ç¯‡</a><br><a href="https://rustfisher.com/2015/10/26/Android/Android-AIDL_intro_and_use/">Android AIDLç®€ä»‹ä¸ä½¿ç”¨</a></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Binder</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexoä¸»é¢˜ä½¿ç”¨ä¸ä¿®æ”¹</title>
    <link href="/2019/08/06/Web/hexo-themes_use/"/>
    <url>/2019/08/06/Web/hexo-themes_use/</url>
    
    <content type="html"><![CDATA[<h2 id="æ·»åŠ ä¸€ä¸ªå°å›¾æ ‡"><a href="#æ·»åŠ ä¸€ä¸ªå°å›¾æ ‡" class="headerlink" title="æ·»åŠ ä¸€ä¸ªå°å›¾æ ‡"></a>æ·»åŠ ä¸€ä¸ªå°å›¾æ ‡</h2><p>å¢åŠ äº†ä¸€ä¸ªæ›´æ–°æ—¥æœŸç±»åˆ«ï¼š updated</p><p>style.scss æ·»åŠ ä¸€ä¸ªupdatedï¼Œä½¿ç”¨FontAwesome<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-selector-class">.post</span> &#123;<br>    <span class="hljs-attribute">padding</span>: <span class="hljs-number">25px</span> <span class="hljs-number">0</span> <span class="hljs-number">15px</span>;<br>    <span class="hljs-selector-class">.post-title</span> &#123;<br>        <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;<br>        <span class="hljs-attribute">color</span>: <span class="hljs-number">#555</span>;<br>        <span class="hljs-attribute">text-align</span>: left;<br>        <span class="hljs-attribute">font</span>: bold <span class="hljs-number">25px</span>/<span class="hljs-number">1.1</span> <span class="hljs-string">&quot;ff-tisa-web-pro&quot;</span>, Cambria, <span class="hljs-string">&quot;Times New Roman&quot;</span>, Georgia, Times, sans-serif;<br>        <span class="hljs-selector-tag">a</span> &#123;<br>            <span class="hljs-attribute">color</span>: <span class="hljs-number">#555</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-selector-class">.post-meta</span> &#123;<br>        <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;<br>        <span class="hljs-attribute">margin</span>: <span class="hljs-number">15px</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-attribute">color</span>: <span class="hljs-number">#6E7173</span>;<br>        <span class="hljs-attribute">float</span>: left;<br>        <span class="hljs-attribute">display</span>: inline;<br>        <span class="hljs-attribute">text-indent</span>: .<span class="hljs-number">15em</span>;<br>        &amp;<span class="hljs-selector-pseudo">:before</span> &#123;<br>              <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&quot;FontAwesome&quot;</span>;<br>              <span class="hljs-attribute">content</span>: <span class="hljs-string">&quot;\f073&quot;</span>;<br>              <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">0.3em</span>;<br>        &#125;<br>        <span class="hljs-selector-class">.category</span> &#123;<br>            &amp;<span class="hljs-selector-pseudo">:before</span> &#123;<br>              <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&quot;FontAwesome&quot;</span>;<br>              <span class="hljs-attribute">content</span>: <span class="hljs-string">&quot;\f07c&quot;</span>;<br>              <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">0.3em</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-selector-class">.updated</span> &#123;<br>            &amp;<span class="hljs-selector-pseudo">:before</span> &#123;<br>                <span class="hljs-attribute">font-family</span>: <span class="hljs-string">&quot;FontAwesome&quot;</span>;<br>                <span class="hljs-attribute">content</span>: <span class="hljs-string">&quot;\f044&quot;</span>;<br>                <span class="hljs-attribute">padding-right</span>: <span class="hljs-number">0.3em</span>;<br>              &#125;<br>        &#125;<br></code></pre></td></tr></table></figure></p><p>post.pug ä½¿ç”¨spanï¼Œæ·»åŠ updatedä¿¡æ¯<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs pug">block content<br>  .post<br>    h1.post-title= page.title<br>    .post-meta= page.date.format(&#x27;ll&#x27;)<br>      if page.categories.length &gt; 0<br>        span= &#x27; | &#x27;<br>        span.category<br>          for category in page.categories.toArray()<br>            a(href=url_for(category.path))= category.name<br>      if page.updated<br>        span= &#x27; | &#x27; <br>        span.updated<br>          = page.updated.format(&#x27;ll&#x27;)<br></code></pre></td></tr></table></figure></p><p>å¦‚æœåœ¨markdownæ–‡ä»¶ä¸­ä¸æ·»åŠ updatedè¿™ä¸ªå€¼ï¼Œé‚£ä¹ˆhexoä¼šè·å–æ–‡ä»¶çš„ä¿®æ”¹æ—¥æœŸï¼Œå¹¶æ¸²æŸ“å‡ºæ¥ã€‚</p><p>å‚è€ƒï¼š</p><ul><li>Font Awesome å‚è€ƒæ‰‹å†Œ <a href="https://www.runoob.com/font-awesome/fontawesome-reference.html">https://www.runoob.com/font-awesome/fontawesome-reference.html</a></li></ul><h2 id="æ·»åŠ Google-Adsense"><a href="#æ·»åŠ Google-Adsense" class="headerlink" title="æ·»åŠ Google Adsense"></a>æ·»åŠ Google Adsense</h2><p>åœ¨<code>head.pug</code>ä¸­æ·»åŠ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pug">script(src=&#x27;https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&#x27;, async)<br>script.<br>  (adsbygoogle = window.adsbygoogle || []).push(&#123;<br>  google_ad_client: &quot;ca-pub-7286632197002340&quot;,<br>  enable_page_level_ads: true<br>  &#125;);<br></code></pre></td></tr></table></figure><h2 id="æ·»åŠ ä¾§è¾¹æ "><a href="#æ·»åŠ ä¾§è¾¹æ " class="headerlink" title="æ·»åŠ ä¾§è¾¹æ "></a>æ·»åŠ ä¾§è¾¹æ </h2><p>æ·»åŠ ä¸€ä¸ªå¾®ä¿¡å…¬ä¼—å·çš„ä¾§è¾¹æ å±•ç¤º</p><p>ä¸»é¢˜layout/_widgetä¸­æ·»åŠ qr_code.pug<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pug">.widget<br>  .widget-title<br>    i(class=&#x27;fa fa-weixin&#x27;)= &#x27; &#x27; + __(&#x27;å¾®ä¿¡å…¬ä¼—å·&#x27;)<br>  img(src=&#x27;http://rustblogres.rustfisher.com/qrcode_for_rf_dev_gzh_258.jpg&#x27;)<br></code></pre></td></tr></table></figure></p><p>_config.ymlä¸­æ·»åŠ  qr_code<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">widgets:</span> <br>  <span class="hljs-comment"># å‰é¢çš„ç»„å»º</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">qr_code</span><br></code></pre></td></tr></table></figure></p><h2 id="æ›´æ”¹å½’æ¡£ç•Œé¢çš„é“¾æ¥ä¸ªæ•°"><a href="#æ›´æ”¹å½’æ¡£ç•Œé¢çš„é“¾æ¥ä¸ªæ•°" class="headerlink" title="æ›´æ”¹å½’æ¡£ç•Œé¢çš„é“¾æ¥ä¸ªæ•°"></a>æ›´æ”¹å½’æ¡£ç•Œé¢çš„é“¾æ¥ä¸ªæ•°</h2><p>åœ¨å·¥ç¨‹çš„é…ç½®æ–‡ä»¶_config.ymlé‡Œä¿®æ”¹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># Pagination</span><br><span class="hljs-comment">## Set per_page to 0 to disable pagination</span><br><span class="hljs-attr">pagination_dir:</span> <span class="hljs-string">page</span><br><span class="hljs-attr">index_generator:</span><br>  <span class="hljs-attr">per_page:</span> <span class="hljs-number">15</span><br>  <span class="hljs-attr">order_by:</span> <span class="hljs-string">-date</span><br><br><span class="hljs-attr">category_generator:</span><br>  <span class="hljs-attr">per_page:</span> <span class="hljs-number">15</span><br><br><span class="hljs-attr">tag_generator:</span><br>  <span class="hljs-attr">per_page:</span> <span class="hljs-number">10</span><br><br><span class="hljs-attr">archive_generator:</span><br>  <span class="hljs-attr">per_page:</span> <span class="hljs-number">30</span><br>  <span class="hljs-attr">yearly:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">monthly:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">daily:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h2 id="æ–‡ç« ç½®é¡¶åŠç½®é¡¶æ ‡ç­¾"><a href="#æ–‡ç« ç½®é¡¶åŠç½®é¡¶æ ‡ç­¾" class="headerlink" title="æ–‡ç« ç½®é¡¶åŠç½®é¡¶æ ‡ç­¾"></a>æ–‡ç« ç½®é¡¶åŠç½®é¡¶æ ‡ç­¾</h2><p>é¦–å…ˆæ›´æ¢ä¸€ä¸‹generator<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ npm uninstall hexo-generator-index --save<br>$ npm install hexo-generator-index-pin-top --save<br></code></pre></td></tr></table></figure></p><p>å†åˆ°themes/maupassanté‡Œï¼ŒæŸ¥æ‰¾<code>.post-meta</code>ï¼Œå¹¶ä¸”åœ¨ä¸‹é¢æ·»åŠ <code>top</code>çš„åˆ¤æ–­ã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pug">.post-meta= post.date.format(config.date_format)<br>  if post.top<br>    span.post-top-icon<br>      i(class=&quot;fa fa-thumb-tack&quot;)<br>      span.post-meta-item-text=&quot; ç½®é¡¶&quot;<br></code></pre></td></tr></table></figure></p><p>åœ¨æ–‡ç« å¼€å¤´çš„<code>Front-matter</code>ä¸­åŠ ä¸Š<code>top: true</code>å³å¯ã€‚</p><h2 id="æŠ¥é”™"><a href="#æŠ¥é”™" class="headerlink" title="æŠ¥é”™"></a>æŠ¥é”™</h2><h3 id="å¤§æ‹¬å·æŠ¥é”™"><a href="#å¤§æ‹¬å·æŠ¥é”™" class="headerlink" title="å¤§æ‹¬å·æŠ¥é”™"></a>å¤§æ‹¬å·æŠ¥é”™</h3><p>mdä¸­å‡ºç°å½¢å¦‚ <code>å¤§æ‹¬å·å¤§æ‹¬å·</code> çš„æ—¶å€™ï¼Œç¼–è¯‘ä¼šæŠ¥é”™ã€‚</p><h2 id="fluidä¸»é¢˜"><a href="#fluidä¸»é¢˜" class="headerlink" title="fluidä¸»é¢˜"></a>fluidä¸»é¢˜</h2><h3 id="é…ç½®leancloudè¯„è®ºä¸pvç»Ÿè®¡"><a href="#é…ç½®leancloudè¯„è®ºä¸pvç»Ÿè®¡" class="headerlink" title="é…ç½®leancloudè¯„è®ºä¸pvç»Ÿè®¡"></a>é…ç½®leancloudè¯„è®ºä¸pvç»Ÿè®¡</h3><p>ä½¿ç”¨fluidï¼Œé…ç½®leancloudè¯„è®ºå’Œpvçš„æ—¶å€™</p><p>æ£€æŸ¥ç”Ÿæˆçš„ç½‘é¡µå‘ç°leancloudé‡Œçš„<code>app_id</code>æ˜¯ç©ºçš„ã€‚<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-attr">&quot;leancloud&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><span class="hljs-attr">&quot;app_id&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;app_key&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;server_url&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;appid&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;xxx&quot;</span><span class="hljs-punctuation">,</span><span class="hljs-attr">&quot;appkey&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;yyy&quot;</span><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><br>æ„è¯†åˆ°è¯„è®ºå’Œpvç»Ÿè®¡åœ¨é…ç½®ä¸Šä¸åŒï¼Œè¯„è®ºç”¨çš„æ˜¯<code>appid</code>ã€‚pvç»Ÿè®¡ç”¨çš„æ˜¯<code>app_id</code>ã€‚</p><p>é…ç½®åº”è¯¥å†™æˆè¿™æ ·<br><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">web_analytics:</span>  <span class="hljs-comment"># ç½‘é¡µè®¿é—®ç»Ÿè®¡</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">leancloud:</span>  <span class="hljs-comment"># LeanCloud è®¡æ•°ç»Ÿè®¡ï¼Œå¯ç”¨äº PV UV å±•ç¤ºï¼Œå¦‚æœ web_analytics.enable æ²¡æœ‰å¼€å¯ï¼ŒPV UV å±•ç¤ºåªä¼šæŸ¥è¯¢ï¼Œä¸ä¼šå¢åŠ </span><br>    <span class="hljs-attr">app_id:</span> <span class="hljs-string">xxx</span> <span class="hljs-comment">## æ³¨æ„è¿™é‡Œçš„keyå†™æ³•</span><br>    <span class="hljs-attr">app_key:</span> <span class="hljs-string">yyy</span> <span class="hljs-comment">## æ³¨æ„è¿™é‡Œçš„keyå†™æ³•</span><br><br><span class="hljs-comment"># ...</span><br><br><span class="hljs-comment"># æ–‡ç« çš„é…ç½®</span><br><span class="hljs-attr">post:</span><br>  <span class="hljs-attr">comments:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">valine</span><br>  <span class="hljs-attr">meta:</span><br>    <span class="hljs-attr">views:</span>  <span class="hljs-comment"># é˜…è¯»æ¬¡æ•°</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">source:</span> <span class="hljs-string">leancloud</span>  <span class="hljs-comment"># ç»Ÿè®¡æ•°æ®æ¥æºï¼Œå¯é€‰ï¼šleancloud | busuanzi   æ³¨æ„ä¸è’œå­ä¼šé—´æ­‡æŠ½é£</span><br>      <span class="hljs-attr">format:</span> <span class="hljs-string">&quot;&#123;&#125; æ¬¡&quot;</span><br><br><span class="hljs-attr">valine:</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span> <span class="hljs-comment">## if you want to use Valine comment system, please set the value to true</span><br>  <span class="hljs-attr">appid:</span> <span class="hljs-string">ddddd</span> <span class="hljs-comment">## æ³¨æ„è¿™é‡Œçš„keyï¼Œæ²¡æœ‰ä¸‹åˆ’çº¿ your leancloud application appid</span><br>  <span class="hljs-attr">appkey:</span> <span class="hljs-string">aaaaa</span> <span class="hljs-comment">## æ³¨æ„è¿™é‡Œçš„keyï¼Œæ²¡æœ‰ä¸‹åˆ’çº¿ your leancloud application appkey</span><br>  <span class="hljs-attr">placeholder:</span> <span class="hljs-string">è¾“å…¥è¯„è®º...</span> <span class="hljs-comment">## comment input placeholder text </span><br>  <span class="hljs-attr">avatar:</span> <span class="hljs-string">&#x27;mp&#x27;</span> <span class="hljs-comment">## header image https://github.com/xCss/Valine/wiki</span><br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>Web_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€å‘è®°å½•</tag>
      
      <tag>hexoä¸»é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€ŒPhoneInfoã€å¼€å‘è®°å½•</title>
    <link href="/2019/08/06/Dev-note/dev-note-app-PhoneInfo/"/>
    <url>/2019/08/06/Dev-note/dev-note-app-PhoneInfo/</url>
    
    <content type="html"><![CDATA[<p>å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸€äº›ä½é¢‘ä½¿ç”¨çš„APIä¸å¤ªè®°å¾—ï¼Œæ¯æ¬¡éƒ½è¦æŸ¥ä¸€ä¸‹ã€‚æ¯”å¦‚Buildè¿™ä¸ªç±»ã€‚<br>åšä¸€ä¸ªappï¼Œä¸€è¾¹æ˜¾ç¤ºä»£ç ï¼Œä¸€è¾¹æ˜¾ç¤ºç»“æœï¼Œå²‚ä¸ç¾å“‰ã€‚</p><p>å‘å¸ƒåœ°å€</p><ul><li><a href="https://www.coolapk.com/apk/238562">PhoneInfo - é…·å®‰</a></li><li><a href="https://play.google.com/store/apps/details?id=com.rustfisher.phoneinfoapp">PhoneInfo - PlayStore</a></li></ul><h2 id="é¡µé¢å¸ƒå±€"><a href="#é¡µé¢å¸ƒå±€" class="headerlink" title="é¡µé¢å¸ƒå±€"></a>é¡µé¢å¸ƒå±€</h2><p>ViewPager + TabLayout</p><p>æ‰¿è½½å¤šä¸ªfragmentï¼Œæ˜¾ç¤ºä¸åŒçš„ä¿¡æ¯ã€‚</p><p>TabLayoutå­—ä½“å¤§å°æ”¹å°ä¸€ç‚¹ã€‚</p><p>style.xmlé‡Œå¢åŠ <br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;DashPageTabText&quot;</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;TextAppearance.AppCompat.Button&quot;</span>&gt;</span><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:textSize&quot;</span>&gt;</span>10sp<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;DashPageTabLayout&quot;</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;Widget.Design.TabLayout&quot;</span>&gt;</span><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;tabTextAppearance&quot;</span>&gt;</span>@style/DashPageTabText<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-comment">&lt;!--&lt;item name=&quot;tabSelectedTextColor&quot;&gt;SELECTED TAB TEXT COLOR&lt;/item&gt;--&gt;</span></span><br><span class="language-xml">    <span class="hljs-comment">&lt;!--&lt;item name=&quot;tabIndicatorColor&quot;&gt;SELECTED TAB INDICATOR COLOR&lt;/item&gt;--&gt;</span></span><br><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>tabLayoutä¸­å¢åŠ style<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">com.google.android.material.tabs.TabLayout</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/dash_page_tabs&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;@style/DashPageTabLayout&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;40dp&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure></p><p>å‚è€ƒ <a href="https://stackoverflow.com/questions/31471177/text-size-of-android-design-tablayout-tabs">https://stackoverflow.com/questions/31471177/text-size-of-android-design-tablayout-tabs</a></p><p>æˆ–è€…è®¾ç½®é€‰ä¸­å’Œæœªé€‰ä¸­tabæ—¶æ–‡å­—çš„é¢œè‰²ï¼Œè®¾ç½®tabå¯ä»¥æ»šåŠ¨<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">com.google.android.material.tabs.TabLayout</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/dash_page_tabs&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;@style/DashPageTabLayout&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;40dp&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:tabMode</span>=<span class="hljs-string">&quot;scrollable&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:tabSelectedTextColor</span>=<span class="hljs-string">&quot;#000&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">app:tabTextColor</span>=<span class="hljs-string">&quot;#99222222&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure></p><h3 id="TabLayout-ViewPager-è”åŠ¨"><a href="#TabLayout-ViewPager-è”åŠ¨" class="headerlink" title="TabLayout ViewPager è”åŠ¨"></a>TabLayout ViewPager è”åŠ¨</h3><p><code>DashPagerAdapter</code>ç±»ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> android.view.View;<br><br><span class="hljs-keyword">import</span> androidx.annotation.NonNull;<br><span class="hljs-keyword">import</span> androidx.fragment.app.Fragment;<br><span class="hljs-keyword">import</span> androidx.fragment.app.FragmentManager;<br><span class="hljs-keyword">import</span> androidx.fragment.app.FragmentPagerAdapter;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DashPagerAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">FragmentPagerAdapter</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> fragCount;<br>    <span class="hljs-comment">// è£…ç€fragment</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DashPagerAdapter</span><span class="hljs-params">(FragmentManager fm, <span class="hljs-type">int</span> count)</span> &#123;<br>        <span class="hljs-built_in">super</span>(fm);<br>        fragCount = count;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getCount</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> fragCount;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Fragment <span class="hljs-title function_">getItem</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-comment">// è¿”å›å¯¹åº”çš„fragment;</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isViewFromObject</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> View view, <span class="hljs-meta">@NonNull</span> Object object)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.isViewFromObject(view, object);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure></p><p>onCreateé‡Œåˆå§‹åŒ–<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java">mTabLayout = findViewById(R.id.dash_page_tabs);<br>mViewPager = findViewById(R.id.dash_page_vp);<br>mTabLayout.addTab(mTabLayout.newTab().setText(<span class="hljs-string">&quot;Build&quot;</span>));<br>mTabLayout.addTab(mTabLayout.newTab().setText(<span class="hljs-string">&quot;Screen&quot;</span>));<br>mTabLayout.addTab(mTabLayout.newTab().setText(<span class="hljs-string">&quot;WiFi&quot;</span>));<br>mTabLayout.addTab(mTabLayout.newTab().setText(<span class="hljs-string">&quot;ext-Storage&quot;</span>));<br>mTabLayout.addTab(mTabLayout.newTab().setText(<span class="hljs-string">&quot;app-Storage&quot;</span>));<br>mTabLayout.addTab(mTabLayout.newTab().setText(<span class="hljs-string">&quot;uri&quot;</span>));<br>mTabLayout.addTab(mTabLayout.newTab().setText(<span class="hljs-string">&quot;battery&quot;</span>));<br><br>mDashPagerAdapter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DashPagerAdapter</span>(getSupportFragmentManager(), mTabLayout.getTabCount());<br><br>mViewPager.setAdapter(mDashPagerAdapter);<br>mViewPager.addOnPageChangeListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TabLayout</span>.TabLayoutOnPageChangeListener(mTabLayout));<br>mTabLayout.addOnTabSelectedListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TabLayout</span>.OnTabSelectedListener() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onTabSelected</span><span class="hljs-params">(TabLayout.Tab tab)</span> &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">pos</span> <span class="hljs-operator">=</span> tab.getPosition();<br>        mViewPager.setCurrentItem(pos);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onTabUnselected</span><span class="hljs-params">(TabLayout.Tab tab)</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onTabReselected</span><span class="hljs-params">(TabLayout.Tab tab)</span> &#123;<br><br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure></p><h2 id="Buildç±»"><a href="#Buildç±»" class="headerlink" title="Buildç±»"></a>Buildç±»</h2><p>æ¯”å¦‚è¿™æ ·</p><p><img src="http://rustblogres.rustfisher.com/phoneinfo-app-build-page-1p.jpg" alt="å±•ç¤ºBuildç±»çš„API"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O &amp;&amp;<br>        PackageManager.PERMISSION_GRANTED == ContextCompat.checkSelfPermission(<span class="hljs-built_in">this</span>, Manifest.permission.READ_PHONE_STATE)) &#123;<br>    mInfoReAdapter.addOrUpdate(K_SERIAL, <span class="hljs-string">&quot;Build.getSerial()&quot;</span>, Build.getSerial());<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    mInfoReAdapter.addOrUpdate(Build.SERIAL, <span class="hljs-string">&quot;Build.SERIAL&quot;</span>, Build.SERIAL);<br>&#125;<br>mInfoReAdapter.addOrUpdate(<span class="hljs-string">&quot;Build.getRadioVersion()&quot;</span>, <span class="hljs-string">&quot;Build.getRadioVersion()&quot;</span>, Build.getRadioVersion());<br>mInfoReAdapter.addOrUpdate(<span class="hljs-string">&quot;Build.ID               &quot;</span>, <span class="hljs-string">&quot;Build.ID&quot;</span>, Build.ID);<br><span class="hljs-comment">// ....</span><br>mInfoReAdapter.addOrUpdate(<span class="hljs-string">&quot;Build.USER             &quot;</span>, <span class="hljs-string">&quot;Build.USER&quot;</span>, Build.USER);<br>mInfoReAdapter.notifyDataSetChanged();<br></code></pre></td></tr></table></figure><h2 id="å±å¹•ä¿¡æ¯"><a href="#å±å¹•ä¿¡æ¯" class="headerlink" title="å±å¹•ä¿¡æ¯"></a>å±å¹•ä¿¡æ¯</h2><p>è·å–å±å¹•å®½é«˜ã€‚è·å–å±å¹•å®½é«˜çš„æ–¹æ³•å¤§çº¦æœ‰3ç§ï¼Œè¿™é‡Œç›´æ¥ç”¨view.post(runnable)çš„æ–¹å¼æ¥è·å–å®é™…å®½é«˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">View</span> <span class="hljs-variable">root</span> <span class="hljs-operator">=</span> findViewById(R.id.container);<br>root.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">wid</span> <span class="hljs-operator">=</span> root.getWidth();<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">height</span> <span class="hljs-operator">=</span> root.getHeight();<br>        Log.d(TAG, <span class="hljs-string">&quot;phone screen size [&quot;</span> + wid + <span class="hljs-string">&quot;, &quot;</span> + height + <span class="hljs-string">&quot;]&quot;</span>);<br>        mDashPagerAdapter.setPhoneScreenSize(wid, height);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>æŠŠåƒç´ è½¬æ¢æˆdp</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">float</span> <span class="hljs-title function_">pxToDp</span><span class="hljs-params">(<span class="hljs-type">int</span> px)</span> &#123;<br>    <span class="hljs-keyword">return</span> (px / Resources.getSystem().getDisplayMetrics().density);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å­˜å‚¨è·¯å¾„ä¿¡æ¯"><a href="#å­˜å‚¨è·¯å¾„ä¿¡æ¯" class="headerlink" title="å­˜å‚¨è·¯å¾„ä¿¡æ¯"></a>å­˜å‚¨è·¯å¾„ä¿¡æ¯</h2><p>æ¯”å¦‚è·å–åˆ°å¤–éƒ¨å­˜å‚¨çš„è·¯å¾„ç­‰ç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">mInfoReAdapter.addOrUpdateUpDown(<span class="hljs-string">&quot;root&quot;</span>, <span class="hljs-string">&quot;Environment.getRootDirectory().getAbsolutePath()&quot;</span>,<br>        Environment.getRootDirectory().getAbsolutePath());<br></code></pre></td></tr></table></figure><h2 id="Uriç±»ä¿¡æ¯"><a href="#Uriç±»ä¿¡æ¯" class="headerlink" title="Uriç±»ä¿¡æ¯"></a>Uriç±»ä¿¡æ¯</h2><p>å±•ç¤ºUriç±»çš„ä¸€äº›ä¿¡æ¯ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Uri</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> Uri.fromFile(getActivity().getApplicationContext().getFilesDir());<br></code></pre></td></tr></table></figure><h2 id="crash-java-lang-ClassNotFoundException"><a href="#crash-java-lang-ClassNotFoundException" class="headerlink" title="crash java.lang.ClassNotFoundException"></a>crash java.lang.ClassNotFoundException</h2><p>Google play console æ”¶é›†åˆ°çš„crashä¿¡æ¯ã€‚å´©æºƒæœºå‹æ˜¯åä¸ºå’Œä¸‰æ˜Ÿã€‚</p><p>Galaxy A40 (a40)ï¼Œ Note9 (crownlte)ï¼Œ A70 (a70q)ï¼Œ Note8 (greatlte)ï¼›Mate 10 Pro (HWBLA)</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs stylus">java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.RuntimeException</span>: <br>  at android<span class="hljs-selector-class">.app</span><span class="hljs-selector-class">.ActivityThread</span><span class="hljs-selector-class">.handleReceiver</span> (ActivityThread<span class="hljs-selector-class">.java</span>:<span class="hljs-number">3586</span>)<br>  at android<span class="hljs-selector-class">.app</span><span class="hljs-selector-class">.ActivityThread</span>.access$<span class="hljs-number">1300</span> (ActivityThread<span class="hljs-selector-class">.java</span>:<span class="hljs-number">240</span>)<br>  at android<span class="hljs-selector-class">.app</span>.ActivityThread<span class="hljs-variable">$H</span><span class="hljs-selector-class">.handleMessage</span> (ActivityThread<span class="hljs-selector-class">.java</span>:<span class="hljs-number">1808</span>)<br>  at android<span class="hljs-selector-class">.os</span><span class="hljs-selector-class">.Handler</span><span class="hljs-selector-class">.dispatchMessage</span> (Handler<span class="hljs-selector-class">.java</span>:<span class="hljs-number">106</span>)<br>  at android<span class="hljs-selector-class">.os</span><span class="hljs-selector-class">.Looper</span><span class="hljs-selector-class">.loop</span> (Looper<span class="hljs-selector-class">.java</span>:<span class="hljs-number">214</span>)<br>  at android<span class="hljs-selector-class">.app</span><span class="hljs-selector-class">.ActivityThread</span><span class="hljs-selector-class">.main</span> (ActivityThread<span class="hljs-selector-class">.java</span>:<span class="hljs-number">7094</span>)<br>  at java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.reflect</span><span class="hljs-selector-class">.Method</span><span class="hljs-selector-class">.invoke</span> (Native Method)<br>  at com<span class="hljs-selector-class">.android</span><span class="hljs-selector-class">.internal</span><span class="hljs-selector-class">.os</span>.RuntimeInit<span class="hljs-variable">$MethodAndArgsCaller</span><span class="hljs-selector-class">.run</span> (RuntimeInit<span class="hljs-selector-class">.java</span>:<span class="hljs-number">494</span>)<br>  at com<span class="hljs-selector-class">.android</span><span class="hljs-selector-class">.internal</span><span class="hljs-selector-class">.os</span><span class="hljs-selector-class">.ZygoteInit</span><span class="hljs-selector-class">.main</span> (ZygoteInit<span class="hljs-selector-class">.java</span>:<span class="hljs-number">975</span>)<br>Caused by: java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.ClassNotFoundException</span>: <br>  at dalvik<span class="hljs-selector-class">.system</span><span class="hljs-selector-class">.BaseDexClassLoader</span><span class="hljs-selector-class">.findClass</span> (BaseDexClassLoader<span class="hljs-selector-class">.java</span>:<span class="hljs-number">134</span>)<br>  at java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.ClassLoader</span><span class="hljs-selector-class">.loadClass</span> (ClassLoader<span class="hljs-selector-class">.java</span>:<span class="hljs-number">379</span>)<br>  at java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.ClassLoader</span><span class="hljs-selector-class">.loadClass</span> (ClassLoader<span class="hljs-selector-class">.java</span>:<span class="hljs-number">312</span>)<br>  at android<span class="hljs-selector-class">.app</span><span class="hljs-selector-class">.AppComponentFactory</span><span class="hljs-selector-class">.instantiateReceiver</span> (AppComponentFactory<span class="hljs-selector-class">.java</span>:<span class="hljs-number">84</span>)<br>  at androidx<span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.app</span><span class="hljs-selector-class">.CoreComponentFactory</span><span class="hljs-selector-class">.instantiateReceiver</span> (CoreComponentFactory<span class="hljs-selector-class">.java</span>:<span class="hljs-number">56</span>)<br>  at android<span class="hljs-selector-class">.app</span><span class="hljs-selector-class">.ActivityThread</span><span class="hljs-selector-class">.handleReceiver</span> (ActivityThread<span class="hljs-selector-class">.java</span>:<span class="hljs-number">3579</span>)<br></code></pre></td></tr></table></figure><p>æ ¹æ®<code>ActivityThread.handleReceiver</code>çŒœæµ‹ï¼Œæœ‰ä¸€ä¸ªå¹¿æ’­æ¥æ”¶å™¨ç¤ºä¾‹åŒ–å¤±è´¥äº†ã€‚<br>åº”ç”¨é‡Œåªæœ‰ä¸€ä¸ªåŠ¨æ€æ³¨å†Œçš„å¹¿æ’­æ¥æ”¶å™¨ã€‚åº”è¯¥æ˜¯æ³¨å†Œå¤±è´¥äº†ã€‚æ‰‹å¤´ä¸Šæ²¡æœ‰ä¸‰æ˜Ÿå’Œåä¸ºã€‚æš‚æ—¶æ²¡æ³•é‡ç°ã€‚</p><h2 id="æ›´æ–°è®°å½•"><a href="#æ›´æ–°è®°å½•" class="headerlink" title="æ›´æ–°è®°å½•"></a>æ›´æ–°è®°å½•</h2><ul><li>[1.1.4] 2020-1-7<ul><li>ä½¿ç”¨æ–°çš„UIæ ·å¼</li></ul></li><li>[1.1.1] 2019-11-10<ul><li>ä¿®æ”¹ç”µæ± å¹¿æ’­æ¥æ”¶å™¨çš„ä¿¡æ¯ç±»å‹</li></ul></li><li>[1.0.9] 2019-9-14<ul><li>ä¿®æ”¹ui</li></ul></li><li>[1.0.8] 2019-9-13<ul><li>å¢åŠ äº†Uriç±»çš„ä¿¡æ¯</li></ul></li><li>[1.0.6] 2019-9-4<ul><li>å¢åŠ äº†Environmentç±»çš„ä¿¡æ¯</li><li>ä¿®å¤äº†å®šä½æƒé™å¯¹Wi-Fiä¿¡æ¯ç•Œé¢çš„å½±å“</li></ul></li><li>2019-8-17<ul><li>å¢åŠ äº†å±å¹•å°ºå¯¸ä¿¡æ¯</li><li>é‡‡ç”¨ViewPager + TabLayoutæ˜¾ç¤ºå¤šä¸ªé¡µé¢</li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€å‘è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€ŒSDç¼–è¾‘ã€å¼€å‘è®°å½•</title>
    <link href="/2019/07/29/Dev-note/dev-note-app-SDEdit/"/>
    <url>/2019/07/29/Dev-note/dev-note-app-SDEdit/</url>
    
    <content type="html"><![CDATA[<p>SD - Slam Dumpï¼ˆå¹¶ä¸æ˜¯ï¼‰</p><p>è¿™ä¸ªAppçš„ä¸»è¦ç›®çš„æ˜¯æ»¡è¶³å¹¿å¤§äººæ°‘ç¾¤ä¼—å¯¹å›¾ç‰‡ç¼–è¾‘çš„éœ€æ±‚ã€‚</p><h2 id="å­—ä½“é—®é¢˜"><a href="#å­—ä½“é—®é¢˜" class="headerlink" title="å­—ä½“é—®é¢˜"></a>å­—ä½“é—®é¢˜</h2><p>Androidé»˜è®¤çš„å­—ä½“ä¸å¤ªå¥½çœ‹ï¼Œä¹Ÿä¸ä¸€å®šèƒ½å¾ˆå¥½åœ°åŒ¹é…èƒŒæ™¯å›¾ã€‚å¦‚æœå†…ç½®å­—ä½“ï¼Œé‡åˆ°æœ€å¤§çš„é—®é¢˜æ˜¯ç‰ˆæƒé—®é¢˜ã€‚<br>å› æ­¤å†³å®šå¢åŠ ç”¨æˆ·è‡ªè¡Œå¯¼å…¥å­—ä½“çš„åŠŸèƒ½ï¼Œç”±ç”¨æˆ·æ¥å†³å®šä½¿ç”¨ä»€ä¹ˆå­—ä½“ã€‚</p><p>åŸæ¥çš„å­—ä½“æ–‡ä»¶æ˜¯æ”¾åœ¨assetä¸­ã€‚<code>Typeface.createFromAsset</code>ç›´æ¥å¼•å…¥å¹¶ä½¿ç”¨ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Typeface</span> <span class="hljs-variable">tf</span> <span class="hljs-operator">=</span> Typeface.createFromAsset(mgr, <span class="hljs-string">&quot;fonts/fz_grid.ttf&quot;</span>);<br>mContentTv.setTypeface(tf);<br></code></pre></td></tr></table></figure></p><p>è®¾è®¡ä¸€ä¸ªå­—ä½“ç®¡ç†ç•Œé¢ã€‚ç”¨æˆ·è‡ªè¡Œé€‰æ‹©å°†å­—ä½“æ–‡ä»¶å¤åˆ¶åˆ°Appå†…éƒ¨å­˜å‚¨è·¯å¾„ã€‚<br>ä½¿ç”¨å­—ä½“æ—¶ï¼Œå†ç”¨<code>Typeface.createFromFile()</code>è·å–Typefaceã€‚</p><h2 id="é€‰æ‹©æ–‡ä»¶"><a href="#é€‰æ‹©æ–‡ä»¶" class="headerlink" title="é€‰æ‹©æ–‡ä»¶"></a>é€‰æ‹©æ–‡ä»¶</h2><p>è°ƒç”¨ç³»ç»Ÿæ–‡ä»¶é€‰æ‹©å™¨<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">REQ_CODE_CHOOSE_FILE</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;<br><br>    <span class="hljs-comment">// å¯åŠ¨é€‰æ‹©æ–‡ä»¶...</span><br>    <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Intent.ACTION_GET_CONTENT);<br>    intent.setType(<span class="hljs-string">&quot;*/*&quot;</span>);<br>    startActivityForResult(intent, REQ_CODE_CHOOSE_FILE);<br>    <span class="hljs-comment">// ......</span><br><br>    <span class="hljs-comment">// å¤„ç†é€‰æ‹©çš„æ–‡ä»¶</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onActivityResult</span><span class="hljs-params">(<span class="hljs-type">int</span> requestCode, <span class="hljs-type">int</span> resultCode, <span class="hljs-meta">@Nullable</span> Intent data)</span> &#123;<br>        <span class="hljs-keyword">switch</span> (requestCode) &#123;<br>            <span class="hljs-keyword">case</span> REQ_CODE_CHOOSE_FILE:<br>                <span class="hljs-keyword">if</span> (data != <span class="hljs-literal">null</span>) &#123;<br>                    <span class="hljs-type">Uri</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> data.getData();<br>                    Log.d(TAG, <span class="hljs-string">&quot;onActivityResult: uri: &quot;</span> + uri);<br>                    <span class="hljs-keyword">if</span> (uri != <span class="hljs-literal">null</span> &amp;&amp; !TextUtils.isEmpty(uri.getPath())) &#123;<br>                        copyFile(uri);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        Log.e(TAG, <span class="hljs-string">&quot;onActivityResult: é€‰æ‹©çš„æ–‡ä»¶æ— æ•ˆ&quot;</span>);<br>                    &#125;<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    showShort(getApplicationContext(), <span class="hljs-string">&quot;æ²¡é€‰ä¸­æ–‡ä»¶&quot;</span>);<br>                    Log.e(TAG, <span class="hljs-string">&quot;onActivityResult: data is NULL æ²¡é€‰ä¸­æ–‡ä»¶&quot;</span>);<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">default</span>:<br>                <span class="hljs-built_in">super</span>.onActivityResult(requestCode, resultCode, data);<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br><br></code></pre></td></tr></table></figure></p><h2 id="å¤„ç†uri"><a href="#å¤„ç†uri" class="headerlink" title="å¤„ç†uri"></a>å¤„ç†uri</h2><p>uriå½¢å¦‚ </p><p>content://com.android.externalstorage.documents/document/primary%3ADownload%2Ffz_grid.ttf</p><p>uri.getPathè·å–åˆ°çš„å¹¶ä¸æ˜¯æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚ä½†æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ContentResolveræ¥è·å–åˆ°InputStreamã€‚<br>ä¹Ÿå¯ä»¥è·å–åˆ°uriçš„æ–‡ä»¶åã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">copyFile</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Uri uri)</span> &#123;<br>    mAddIv.setClickable(<span class="hljs-literal">false</span>);<br>    <span class="hljs-type">Animation</span> <span class="hljs-variable">rotate</span> <span class="hljs-operator">=</span> AnimationUtils.loadAnimation(getApplicationContext(), R.anim.rotate_scan);<br>    rotate.setDuration(<span class="hljs-number">400</span>);<br>    mAddIv.startAnimation(rotate);<br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">Cursor</span> <span class="hljs-variable">cursor</span> <span class="hljs-operator">=</span> getContentResolver().query(uri, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);<br>                <span class="hljs-type">int</span> <span class="hljs-variable">nameIndex</span> <span class="hljs-operator">=</span> cursor.getColumnIndex(OpenableColumns.DISPLAY_NAME);<br>                cursor.moveToFirst();<br>                <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> cursor.getString(nameIndex);<br>                cursor.close();<br>                <span class="hljs-type">InputStream</span> <span class="hljs-variable">fis</span> <span class="hljs-operator">=</span> getContentResolver().openInputStream(uri);<br>                <span class="hljs-type">File</span> <span class="hljs-variable">outputFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(TypefaceStore.getStorePath(getApplicationContext()), name);<br>                <span class="hljs-keyword">if</span> (outputFile.exists()) &#123;<br>                    <span class="hljs-type">boolean</span> <span class="hljs-variable">d</span> <span class="hljs-operator">=</span> outputFile.delete();<br>                    Log.d(TAG, <span class="hljs-string">&quot;åˆ é™¤æ—§æ–‡ä»¶: &quot;</span> + d);<br>                &#125;<br>                <span class="hljs-type">boolean</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> outputFile.createNewFile();<br>                Log.d(TAG, <span class="hljs-string">&quot;copyFile: æ–°å»ºæ–‡ä»¶ &quot;</span> + n);<br>                <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(outputFile);<br>                <span class="hljs-type">byte</span>[] tmp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">2048</span>];<br>                <span class="hljs-type">int</span> i;<br>                <span class="hljs-keyword">while</span> ((i = fis.read(tmp)) != -<span class="hljs-number">1</span>) &#123;<br>                    fos.write(tmp, <span class="hljs-number">0</span>, i);<br>                &#125;<br>                fos.flush();<br>                fos.close();<br>                fis.close();<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                Log.e(TAG, <span class="hljs-string">&quot;copyFile ERROR:&quot;</span>, e);<br>                <br>            &#125;<br>            <br>        &#125;<br>    &#125;).start();<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç®€å•åœ°ä½¿ç”¨uri.getLastPathSegmentæ¥è·å–æ–‡ä»¶å<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">uri.getLastPathSegment();<br>String[] t = uriPath.split(File.separator);<br><span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> t[t.length - <span class="hljs-number">1</span>];<br></code></pre></td></tr></table></figure></p><p><a href="https://stackoverflow.com/questions/4263002/how-to-get-file-name-from-uri">https://stackoverflow.com/questions/4263002/how-to-get-file-name-from-uri</a></p><h2 id="Toolbaré—®é¢˜"><a href="#Toolbaré—®é¢˜" class="headerlink" title="Toolbaré—®é¢˜"></a>Toolbaré—®é¢˜</h2><p>ä½¿ç”¨toolbaræ—¶ç»å¸¸ä¼šé‡åˆ°é—®é¢˜ã€‚ä¾‹å¦‚<a href="https://stackoverflow.com/questions/26486730/in-android-app-toolbar-settitle-method-has-no-effect-application-name-is-shown">è®¾ç½®titleçš„é—®é¢˜</a>ã€‚</p><p>è¿™é‡Œè‡ªå·±åˆ›å»ºä¸€ä¸ªç»Ÿä¸€çš„æ ‡é¢˜æ TitleBarã€‚æƒ³è¦ä»€ä¹ˆæ§ä»¶è‡ªå·±æ·»åŠ ã€‚</p><h2 id="Google-MobileAds"><a href="#Google-MobileAds" class="headerlink" title="Google MobileAds"></a>Google MobileAds</h2><p><code>MobileAds.initialize(getApplicationContext(), AdsMgr.GOOGLE_ADS_APP_ID);</code>çš„æ‰§è¡Œä¼šå ç”¨å¾ˆå¤šæ—¶é—´ã€‚æµ‹è¯•è¿‡ç¨‹ä¸­å‘ç°å°ç±³æ‰‹æœºç”šè‡³ä½¿ç”¨äº†3ç§’é’Ÿæ¥æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ã€‚</p><p><a href="https://stackoverflow.com/questions/37418663/what-is-the-proper-way-to-call-mobileads-initialize">https://stackoverflow.com/questions/37418663/what-is-the-proper-way-to-call-mobileads-initialize</a></p><p>ç»™å¯åŠ¨é¡µActivityä¸€ä¸ªçº¯è‰²çš„å¯åŠ¨èƒŒæ™¯ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;AppTheme.NoActionBar&quot;</span>&gt;</span><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;windowActionBar&quot;</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;windowNoTitle&quot;</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:windowBackground&quot;</span>&gt;</span>@color/colorPrimary<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>å¯åŠ¨é¡µä¸­åˆå§‹åŒ–Adsæ—¶å®åœ¨æ˜¯è€—æ—¶å¤ªé•¿ï¼Œå¹²è„†æ”¾åˆ°å­çº¿ç¨‹ä¸­å»æ“ä½œã€‚<br>è™½ç„¶<a href="https://developers.google.com/admob/android/quick-start">å®˜æ–¹æ–‡æ¡£</a>å»ºè®®çš„æ˜¯è¶Šæ—©åˆå§‹åŒ–è¶Šå¥½ã€‚ä½†ä¹Ÿä¸å¸Œæœ›å¤ªå½±å“ç”¨æˆ·ä½“éªŒã€‚</p><h2 id="é€’å½’æŸ¥çœ‹æŸä¸ªè·¯å¾„ä¸‹çš„æ–‡ä»¶"><a href="#é€’å½’æŸ¥çœ‹æŸä¸ªè·¯å¾„ä¸‹çš„æ–‡ä»¶" class="headerlink" title="é€’å½’æŸ¥çœ‹æŸä¸ªè·¯å¾„ä¸‹çš„æ–‡ä»¶"></a>é€’å½’æŸ¥çœ‹æŸä¸ªè·¯å¾„ä¸‹çš„æ–‡ä»¶</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">treeDir</span><span class="hljs-params">(File dir, <span class="hljs-type">int</span> level)</span> &#123;<br>        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; level; i++) &#123;<br>            sb.append(<span class="hljs-string">&quot;-&quot;</span>);<br>        &#125;<br>        sb.append(<span class="hljs-string">&quot; &quot;</span>);<br>        <span class="hljs-keyword">if</span> (dir.isDirectory()) &#123;<br><span class="hljs-comment">//            LL.d(TAG, sb.toString() + dir.getName());</span><br>            level++;<br>            <span class="hljs-keyword">for</span> (File f : dir.listFiles()) &#123;<br>                treeDir(f, level);<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-comment">//            LL.d(TAG, sb.toString() + dir.getName());</span><br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="æä¾›è‰ç¨¿åŠŸèƒ½"><a href="#æä¾›è‰ç¨¿åŠŸèƒ½" class="headerlink" title="æä¾›è‰ç¨¿åŠŸèƒ½"></a>æä¾›è‰ç¨¿åŠŸèƒ½</h2><p>ä¸ºæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ï¼Œæä¾›è‰ç¨¿åŠŸèƒ½ã€‚è¿™å°±æ¶‰åŠåˆ°å¢åˆ æŸ¥æ”¹çš„æ“ä½œã€‚</p><p>[2019-7-31] æœ¬æ¥æƒ³ç›´æ¥ç”¨sqliteï¼Œä½†ä¸ºäº†å¼€å‘æ–¹ä¾¿ï¼Œé€‰ç”¨äº†<a href="http://greenrobot.org/greendao/">greenDAO</a>ã€‚</p><p><a href="https://github.com/greenrobot/greenDAO">https://github.com/greenrobot/greenDAO</a></p><p>ä½¿ç”¨2ä¸ªè¡¨ï¼Œåˆ†åˆ«ä¸ºDraftï¼ˆå­˜æ¡£ï¼‰å’ŒDraftContentï¼ˆå›¾å±‚ï¼‰ã€‚DraftContentä¸­å­˜æ”¾ç€å…³è”çš„å­˜æ¡£IDã€‚</p><p>èƒ½ä¿å­˜çš„ä¸œè¥¿éƒ½ä¿å­˜ä¸‹æ¥ã€‚</p><h3 id="greendaoæ’å…¥å…ƒç´ "><a href="#greendaoæ’å…¥å…ƒç´ " class="headerlink" title="greendaoæ’å…¥å…ƒç´ "></a>greendaoæ’å…¥å…ƒç´ </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Draft</span> <span class="hljs-variable">draft1</span> <span class="hljs-operator">=</span> genDraft(<span class="hljs-string">&quot;ç¤ºä¾‹1&quot;</span>, p1Path);<br><span class="hljs-type">Draft</span> <span class="hljs-variable">draft2</span> <span class="hljs-operator">=</span> genDraft(<span class="hljs-string">&quot;ç¤ºä¾‹2&quot;</span>, p2Path);<br><span class="hljs-type">Draft</span> <span class="hljs-variable">draft3</span> <span class="hljs-operator">=</span> genDraft(<span class="hljs-string">&quot;ç¤ºä¾‹3&quot;</span>, p3Path);<br>Log.d(TAG, <span class="hljs-string">&quot;addDemoDraft: id: &quot;</span> + draft1.getDraftId() + <span class="hljs-string">&quot;,&quot;</span> + draft3.getDraftId());<br>daoSession.insert(draft1);<br>daoSession.insert(draft2);<br>daoSession.insert(draft3);<br></code></pre></td></tr></table></figure><p>æ’å…¥å…ƒç´ åå°±æœ‰idäº†ã€‚</p><h3 id="greendaoåˆ é™¤å…ƒç´ "><a href="#greendaoåˆ é™¤å…ƒç´ " class="headerlink" title="greendaoåˆ é™¤å…ƒç´ "></a>greendaoåˆ é™¤å…ƒç´ </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">DraftDao</span> <span class="hljs-variable">draftDao</span> <span class="hljs-operator">=</span> daoSession.getDraftDao();<br><span class="hljs-type">DraftContentDao</span> <span class="hljs-variable">draftContentDao</span> <span class="hljs-operator">=</span> daoSession.getDraftContentDao();<br><span class="hljs-keyword">for</span> (Draft d : drafts) &#123;<br>    Log.d(TAG, <span class="hljs-string">&quot;åˆ é™¤ &quot;</span> + d.getName());<br>    draftDao.queryBuilder()<br>            .where(DraftDao.Properties.DraftId.eq(d.getDraftId())).buildDelete()<br>            .executeDeleteWithoutDetachingEntities();<br>    draftContentDao.queryBuilder()<br>            .where(DraftContentDao.Properties.RelativeDraftId.eq(d.getDraftId())).buildDelete()<br>            .executeDeleteWithoutDetachingEntities();<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨DrawerLayout"><a href="#ä½¿ç”¨DrawerLayout" class="headerlink" title="ä½¿ç”¨DrawerLayout"></a>ä½¿ç”¨DrawerLayout</h2><p>æŠ¥é”™ï¼š <code>IllegalArgumentException: No drawer view found with gravity LEFT</code></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus">java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.IllegalArgumentException</span>: No drawer view found with gravity LEFT<br>    at androidx<span class="hljs-selector-class">.drawerlayout</span><span class="hljs-selector-class">.widget</span><span class="hljs-selector-class">.DrawerLayout</span><span class="hljs-selector-class">.openDrawer</span>(DrawerLayout<span class="hljs-selector-class">.java</span>:<span class="hljs-number">1736</span>)<br>    at androidx<span class="hljs-selector-class">.drawerlayout</span><span class="hljs-selector-class">.widget</span><span class="hljs-selector-class">.DrawerLayout</span><span class="hljs-selector-class">.openDrawer</span>(DrawerLayout<span class="hljs-selector-class">.java</span>:<span class="hljs-number">1722</span>)<br></code></pre></td></tr></table></figure><p>å¿˜è®°ä¸­xmlä¸­åŠ ä¸Šå¼€æŠ½å±‰æ–¹å‘äº† tools:openDrawer=â€startâ€<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">androidx.drawerlayout.widget.DrawerLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">&quot;http://schemas.android.com/tools&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/main_page_root&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">&quot;vertical&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:context</span>=<span class="hljs-string">&quot;.act.MainActivity&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">tools:openDrawer</span>=<span class="hljs-string">&quot;start&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>æŠ½å±‰åŠ ä¸Šæ–¹å‘ android:layout_gravity=â€startâ€<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- æŠ½å±‰ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_gravity</span>=<span class="hljs-string">&quot;start&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_marginEnd</span>=<span class="hljs-string">&quot;100dp&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">&quot;vertical&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure></p><h2 id="ç¾æœ¯è®¾è®¡ï¼ŒAppäº¤äº’è®¾è®¡"><a href="#ç¾æœ¯è®¾è®¡ï¼ŒAppäº¤äº’è®¾è®¡" class="headerlink" title="ç¾æœ¯è®¾è®¡ï¼ŒAppäº¤äº’è®¾è®¡"></a>ç¾æœ¯è®¾è®¡ï¼ŒAppäº¤äº’è®¾è®¡</h2><p>è®¾è®¡æ˜¯ä¸€ä¸ªæ¯”è¾ƒä»¤æˆ‘å¤´ç–¼çš„é—®é¢˜ã€‚åœ¨è¿™ä¸ªçœ‹è„¸çš„æ—¶ä»£ï¼ŒAppä¸€å®šè¦å¥½çœ‹ï¼å¯¹æˆ‘è€Œè¨€ï¼Œç›´æ¥é‡‡ç”¨material designçš„é£æ ¼ä¼šæ¯”è¾ƒçœäº‹ã€‚<br>ç»è¿‡è°ƒæ•´å’Œå¯¹æ¯”ï¼Œæˆ‘é€‰æ‹©ä½¿ç”¨æš—è‰²çš„é£æ ¼ã€‚å› ä¸ºç°åœ¨ä¸»æµçš„å›¾å½¢ç¼–è¾‘è½¯ä»¶ï¼Œé¢œè‰²é£æ ¼ä»¥æš—è‰²å±…å¤šã€‚</p><p>å‚è€ƒï¼š</p><ul><li>çœ‹é¢œè‰²ç¤ºä¾‹ <a href="https://material.io/design/color/applying-color-to-ui.html#sheets-surfaces">https://material.io/design/color/applying-color-to-ui.html#sheets-surfaces</a></li><li>æŸ¥é¢œè‰² <a href="https://material-ui.com/customization/color/">https://material-ui.com/customization/color/</a></li></ul><h2 id="æ–‡å­—ç¼–è¾‘"><a href="#æ–‡å­—ç¼–è¾‘" class="headerlink" title="æ–‡å­—ç¼–è¾‘"></a>æ–‡å­—ç¼–è¾‘</h2><p>æ–‡å­—å†…å®¹ï¼Œå¤§å°ï¼Œæ—‹è½¬æ–¹å‘ï¼Œé¢œè‰²éƒ½å¯ä»¥è°ƒæ•´ã€‚</p><p>éœ€è¦ä¸€ä¸ªè°ƒè‰²ç›˜æ¥è°ƒæ•´é¢œè‰²ã€‚æ‰¾ä¸ªç¬¬ä¸‰æ–¹çš„ï¼Œå¥½çœ‹èƒ½ç”¨å³å¯ã€‚</p><h2 id="åˆ é™¤å­˜æ¡£æŠ¥é”™"><a href="#åˆ é™¤å­˜æ¡£æŠ¥é”™" class="headerlink" title="åˆ é™¤å­˜æ¡£æŠ¥é”™"></a>åˆ é™¤å­˜æ¡£æŠ¥é”™</h2><p>listç±»çš„ç»å…¸å¼‚å¸¸ ConcurrentModificationExceptionã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.ConcurrentModificationException</span><br>    at java<span class="hljs-selector-class">.util</span>.ArrayList<span class="hljs-variable">$Itr</span><span class="hljs-selector-class">.next</span>(ArrayList<span class="hljs-selector-class">.java</span>:<span class="hljs-number">860</span>)<br></code></pre></td></tr></table></figure><p>liståˆ é™¤å…ƒç´ æ—¶æŠ¥é”™ã€‚è¿™æ ·å†™æ˜¯ä¸è¡Œçš„ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (Data d : dataList) &#123;<br>    <span class="hljs-keyword">if</span> (d.selected) &#123;<br>        dataList.remove(d);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>ç”¨è¿­ä»£å™¨æ¥åˆ é™¤å…ƒç´ ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">Iterator&lt;Data&gt; iterator = dataList.iterator();<br><span class="hljs-keyword">while</span> (iterator.hasNext()) &#123;<br>    <span class="hljs-type">Data</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> iterator.next();<br>    <span class="hljs-keyword">if</span> (data.selected) &#123;<br>        iterator.remove();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><h2 id="è¾“å‡ºå›¾ç‰‡"><a href="#è¾“å‡ºå›¾ç‰‡" class="headerlink" title="è¾“å‡ºå›¾ç‰‡"></a>è¾“å‡ºå›¾ç‰‡</h2><h3 id="ä¿å­˜Viewçš„æ˜¾ç¤ºå†…å®¹"><a href="#ä¿å­˜Viewçš„æ˜¾ç¤ºå†…å®¹" class="headerlink" title="ä¿å­˜Viewçš„æ˜¾ç¤ºå†…å®¹"></a>ä¿å­˜Viewçš„æ˜¾ç¤ºå†…å®¹</h3><p>è·å–ä¸€ä¸ªviewçš„bitmapï¼Œç„¶åä¿å­˜åˆ°æ–‡ä»¶å»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è·å–ä¸€ä¸ª View çš„ç¼“å­˜è§†å›¾</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> Bitmap <span class="hljs-title function_">getCacheBitmapFromView</span><span class="hljs-params">(View view)</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">drawingCacheEnabled</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>    view.setDrawingCacheEnabled(drawingCacheEnabled);<br>    view.buildDrawingCache(drawingCacheEnabled);<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">Bitmap</span> <span class="hljs-variable">drawingCache</span> <span class="hljs-operator">=</span> view.getDrawingCache();<br>    Bitmap bitmap;<br>    <span class="hljs-keyword">if</span> (drawingCache != <span class="hljs-literal">null</span>) &#123;<br>        bitmap = Bitmap.createBitmap(drawingCache);<br>        view.setDrawingCacheEnabled(<span class="hljs-literal">false</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        bitmap = <span class="hljs-literal">null</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> bitmap;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">saveBitmapFile</span><span class="hljs-params">(Bitmap bitmap, String fileAbsPath)</span> &#123;<br>    <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(fileAbsPath); <span class="hljs-comment">// å°†è¦ä¿å­˜å›¾ç‰‡çš„è·¯å¾„</span><br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-keyword">if</span> (file.exists()) &#123;<br>            file.delete();<br>        &#125;<br>        <span class="hljs-type">BufferedOutputStream</span> <span class="hljs-variable">bos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(file));<br>        bitmap.compress(Bitmap.CompressFormat.JPEG, <span class="hljs-number">100</span>, bos);<br>        bos.flush();<br>        bos.close();<br>    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>        e.printStackTrace();<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä¿å­˜å›¾ç‰‡æ–‡ä»¶åçš„å¤„ç†"><a href="#ä¿å­˜å›¾ç‰‡æ–‡ä»¶åçš„å¤„ç†" class="headerlink" title="ä¿å­˜å›¾ç‰‡æ–‡ä»¶åçš„å¤„ç†"></a>ä¿å­˜å›¾ç‰‡æ–‡ä»¶åçš„å¤„ç†</h3><p>ç”¨æˆ·è¾“å‡ºå›¾ç‰‡æ–‡ä»¶åï¼Œæ‰“å¼€å¾®ä¿¡æƒ³å‘é€è¿™å¼ å›¾ç‰‡ã€‚ä½†æ˜¯ç”¨æˆ·å‘ç°å¾®ä¿¡çš„å¿«æ·å‘é€åŠŸèƒ½æ‰¾ä¸åˆ°è¿™å¼ å›¾ç‰‡ã€‚<br>æ€ä¹ˆæ‰èƒ½è®©å¾®ä¿¡çŸ¥é“è¿™é‡Œæ–°å¢äº†ä¸€å¼ å›¾ç‰‡å‘¢ï¼Ÿ</p><p>å¦‚æœè¦å‘é€å¹¿æ’­<code>ACTION_MEDIA_MOUNTED</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">sendBroadcast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Intent.ACTION_MEDIA_MOUNTED, Uri.fromFile(outputFile)));<br></code></pre></td></tr></table></figure><p>æŠ¥é”™ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„æƒé™</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.SecurityException</span>: Permission Denial: not allowed to send broadcast android<span class="hljs-selector-class">.intent</span><span class="hljs-selector-class">.action</span>.MEDIA_MOUNTED<br></code></pre></td></tr></table></figure><p>Android KKå¼€å§‹ï¼Œè¿™ä¸ªå¹¿æ’­å¼€å§‹åªèƒ½ç”±ç³»ç»Ÿå‘å‡ºã€‚KKåŠä¹‹åçš„ç‰ˆæœ¬éœ€ä½¿ç”¨<code>Intent.ACTION_MEDIA_SCANNER_SCAN_FILE</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">File</span> <span class="hljs-variable">outputFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(filePath);<br>sendBroadcast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Intent.ACTION_MEDIA_SCANNER_SCAN_FILE, Uri.fromFile(outputFile)));<br></code></pre></td></tr></table></figure><p>å‚è€ƒ</p><p><a href="https://stackoverflow.com/questions/24072489/java-lang-securityexception-permission-denial-not-allowed-to-send-broadcast-an">https://stackoverflow.com/questions/24072489/java-lang-securityexception-permission-denial-not-allowed-to-send-broadcast-an</a></p><h2 id="ç§»åŠ¨TextView"><a href="#ç§»åŠ¨TextView" class="headerlink" title="ç§»åŠ¨TextView"></a>ç§»åŠ¨TextView</h2><p>ç¼–è¾‘é¡µä¸­æœ‰ä¸€ä¸ªéœ€æ±‚æ˜¯æ‰‹æŒ‡æ‹–åŠ¨æ–‡å­—ã€‚</p><h3 id="1-1-xç‰ˆæœ¬"><a href="#1-1-xç‰ˆæœ¬" class="headerlink" title="1.1.xç‰ˆæœ¬"></a>1.1.xç‰ˆæœ¬</h3><p>1.1.0ç‰ˆæœ¬çš„åšæ³•æ˜¯ï¼Œåœ¨Activityçš„onTouchæ–¹æ³•é‡Œæ¥æ”¹å˜TextViewçš„åæ ‡ã€‚ä»è€Œå®ç°TextViewçš„æ‹–åŠ¨æ•ˆæœã€‚<br>çˆ¶Viewå’Œå­Viewè®¾åŒä¸€ä¸ªOnTouchListenerã€‚ä½†æ˜¯åªæœ‰çˆ¶viewæ¥å¤„ç†è§¦æ‘¸äº‹ä»¶ã€‚<br>å¦‚æœæ˜¯å­viewæ¥æ”¶åˆ°äº†è§¦æ‘¸äº‹ä»¶ï¼Œåˆ™åšä¸€ä¸ªboolæ ‡è®°firstOnTv = trueï¼Œè¿”å›falseï¼ŒæŠŠè§¦æ‘¸äº‹ä»¶äº¤ç»™çˆ¶viewæ¥å¤„ç†ã€‚<br>çˆ¶viewå¤„ç†è§¦æ‘¸äº‹ä»¶æ—¶ï¼Œåˆ¤æ–­å¦‚æœåˆšæ‰ç‚¹ä¸­çš„æ˜¯å­viewï¼ˆå³mContentTvï¼‰ï¼Œåˆ™åœ¨MotionEvent.ACTION_MOVEæ—¶æ›´æ”¹å­viewçš„åæ ‡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-keyword">private</span> View.<span class="hljs-type">OnTouchListener</span> <span class="hljs-variable">mWsOnTouchListener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnTouchListener() &#123;<br><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">firstOnTv</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// æœ€å¼€å§‹ç‚¹ä¸­çš„æ˜¯tv</span><br>        <span class="hljs-type">float</span> originTvX;           <span class="hljs-comment">// tvæœ€å¼€å§‹çš„åæ ‡</span><br>        <span class="hljs-type">float</span> originTvY;<br><br>        <span class="hljs-type">float</span> downX;<br>        <span class="hljs-type">float</span> downY;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onTouch</span><span class="hljs-params">(View v, MotionEvent event)</span> &#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> v.getId();<br><span class="hljs-comment">//            Log.d(TAG, &quot;onTouch: touch tv: &quot; + (id == mContentTv.getId()) + &quot;, touch ws: &quot; + (id == mWorkspaceField.getId()));</span><br>            <span class="hljs-type">float</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> event.getX();<br>            <span class="hljs-type">float</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> event.getY();<br><span class="hljs-comment">//            Log.d(TAG, &quot;onTouch: [&quot; + x + &quot;, &quot; + y + &quot;] , &quot; + event);</span><br>            <span class="hljs-keyword">if</span> (event.getAction() == MotionEvent.ACTION_DOWN) &#123;<br>                mSaveIv.setEnabled(<span class="hljs-literal">true</span>);<br>                <span class="hljs-keyword">if</span> (id == mContentTv.getId()) &#123;<br>                    firstOnTv = <span class="hljs-literal">true</span>;<br>                    originTvX = mContentTv.getX();<br>                    originTvY = mContentTv.getY();<br><span class="hljs-comment">//                    Log.d(TAG, &quot;onTouch: ä¿å­˜tvåæ ‡ (&quot; + originTvX + &quot;, &quot; + originTvY + &quot;)&quot;);</span><br>                &#125;<br>                downX = event.getX();<br>                downY = event.getY();<br><span class="hljs-comment">//                Log.d(TAG, &quot;onTouch: down: x,y [&quot; + x + &quot;, &quot; + y + &quot;]&quot;);</span><br>                <span class="hljs-keyword">return</span> id != mContentTv.getId();<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.getAction() == MotionEvent.ACTION_MOVE) &#123;<br><span class="hljs-comment">//                Log.d(TAG, &quot;onTouch: move: x,y [&quot; + x + &quot;, &quot; + y + &quot;]&quot;);</span><br>                <span class="hljs-keyword">if</span> (!firstOnTv) &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// ä¸ç§»åŠ¨tvï¼Œç›´æ¥æ¶ˆè€—æ‰è¿™ä¸ªæ“ä½œ</span><br>                &#125;<br>                <span class="hljs-type">float</span> <span class="hljs-variable">dx</span> <span class="hljs-operator">=</span> x - downX;<br>                <span class="hljs-type">float</span> <span class="hljs-variable">dy</span> <span class="hljs-operator">=</span> y - downY;<br>                <span class="hljs-keyword">if</span> (Math.abs(dx) &gt; <span class="hljs-number">2</span> &amp;&amp; Math.abs(dy) &gt; <span class="hljs-number">2</span>) &#123;<br>                    mContentTv.setX(originTvX + dx);<br>                    mContentTv.setY(originTvY + dy);<br>                &#125;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.getAction() == MotionEvent.ACTION_UP) &#123;<br>                firstOnTv = <span class="hljs-literal">false</span>;<br>                <span class="hljs-keyword">if</span> (mCanvasWid &gt; <span class="hljs-number">0</span> &amp;&amp; mCanvasHeight &gt; <span class="hljs-number">0</span>) &#123;<br>                    mDraftContent.setTvLocationXRatio(mContentTv.getX() / mCanvasWid);<br>                    mDraftContent.setTvLocationYRatio(mContentTv.getY() / mCanvasHeight);<br>                &#125;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;;<br><br></code></pre></td></tr></table></figure><h2 id="ç‰ˆæœ¬æ›´æ–°"><a href="#ç‰ˆæœ¬æ›´æ–°" class="headerlink" title="ç‰ˆæœ¬æ›´æ–°"></a>ç‰ˆæœ¬æ›´æ–°</h2><ul><li>2019-8-8 v1.1.1 ç‰ˆæœ¬æ›´æ–°<ul><li>è§£å†³äº†ä¸€äº›bug</li><li>UIè°ƒæ•´ï¼Œå¢åŠ äº†æŠ½å±‰çš„å¤´å›¾å’Œæ¬¢è¿æ–‡å­—</li></ul></li><li>2019-8-4 v1.1.0 ç‰ˆæœ¬æ›´æ–°</li></ul>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€å‘è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Web tools å¼€å‘è®°å½•</title>
    <link href="/2019/07/21/Dev-note/dev-note-web-tools/"/>
    <url>/2019/07/21/Dev-note/dev-note-web-tools/</url>
    
    <content type="html"><![CDATA[<p><a href="http://tools.rustfisher.com/">http://tools.rustfisher.com/</a></p><p>å¹³æ—¶å¼€å‘ä¸­æˆ‘ä»¬ä¼šç”¨åˆ°ä¸€äº›å·¥å…·ï¼Œæ¯”å¦‚æ—¶é—´æˆ³å·¥å…·ï¼ŒæŸ¥è¯¢asciiç ï¼ŒæŸ¥è¯¢é¢œè‰²è‰²å€¼ç­‰ç­‰ã€‚<br>åšä¸€äº›é™æ€ç½‘é¡µï¼ŒæŠŠè¿™äº›å¼€å‘è€…ï¼Œç¾æœ¯å¸¸ç”¨çš„åŠŸèƒ½é›†åˆèµ·æ¥ï¼Œä¾¿äºå¤§å®¶çš„å·¥ä½œå’Œå­¦ä¹ ã€‚</p><h2 id="æ—¶é—´æˆ³å·¥å…·"><a href="#æ—¶é—´æˆ³å·¥å…·" class="headerlink" title="æ—¶é—´æˆ³å·¥å…·"></a>æ—¶é—´æˆ³å·¥å…·</h2><p><a href="http://tools.rustfisher.com/timestamp-tool.html">http://tools.rustfisher.com/timestamp-tool.html</a></p><p>ä½¿ç”¨äº†bootstrapã€‚é¢œè‰²é£æ ¼ç±»ä¼¼material designã€‚</p><p>çˆ¶divå®šä¹‰<code>position: relative;</code>ï¼Œå­å…ƒç´ å¯ä»¥æŒ‡å®šä½ç½®<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-attribute">position</span>: absolute;<br><span class="hljs-attribute">bottom</span>: <span class="hljs-number">10px</span>;<br><span class="hljs-attribute">right</span>: <span class="hljs-number">10px</span>;<br></code></pre></td></tr></table></figure></p><h2 id="æ—¶é’Ÿç½‘é¡µ-ç”¨äºkindle"><a href="#æ—¶é’Ÿç½‘é¡µ-ç”¨äºkindle" class="headerlink" title="æ—¶é’Ÿç½‘é¡µ - ç”¨äºkindle"></a>æ—¶é’Ÿç½‘é¡µ - ç”¨äºkindle</h2><p><a href="https://tools.rustfisher.com/clock-k1.html">https://tools.rustfisher.com/clock-k1.html</a></p><p>ç»“åˆkindleçš„ç‰¹ç‚¹ï¼Œåšä¸€ä¸ªæ—¶é’Ÿé¡µé¢ã€‚é¢œè‰²é£æ ¼ä»¥é»‘ç™½ä¸ºä¸»ã€‚<br>ç›®å‰çš„kindleæ²¡æœ‰é‡åŠ›ä¼ æ„Ÿå™¨ï¼Œè€ƒè™‘æ·»åŠ åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥è®©ç½‘é¡µæ—‹è½¬90åº¦ã€‚</p><p>éœ€è¦å°†å…ƒç´ å±…ä¸­æ˜¾ç¤ºã€‚<br>è¿™é‡Œé‡‡ç”¨çš„æ–¹æ³•æ˜¯flexå¸ƒå±€ã€‚çˆ¶å…ƒç´ è®¾ç½®display: flexã€‚<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-selector-class">.parentMain</span>&#123;<br><span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;<br><span class="hljs-attribute">display</span>: flex;<br><span class="hljs-attribute">justify-content</span>: center;<br><span class="hljs-attribute">align-items</span>: center;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>å­å…ƒç´ çš„è®¾ç½®<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;main&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;parentMain&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;content&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display:inline-block; margin: auto; align-content: center;&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>é…åˆåŠ¨æ€è°ƒæ•´divå¤§å°<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">autoResizeDiv</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;main&#x27;</span>).<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span> +<span class="hljs-string">&#x27;px&#x27;</span>;<br>&#125;<br><span class="hljs-variable language_">window</span>.<span class="hljs-property">onresize</span> = autoResizeDiv;<br><span class="hljs-title function_">autoResizeDiv</span>();<br></code></pre></td></tr></table></figure></p><p>è®¾ç½®<code>display:inline-block;text-align: center;</code>åï¼Œå¯ä»¥å­å…ƒç´ æ°´å¹³å±…ä¸­æ˜¾ç¤ºã€‚</p><h3 id="æ—‹è½¬div"><a href="#æ—‹è½¬div" class="headerlink" title="æ—‹è½¬div"></a>æ—‹è½¬div</h3><p>ç‚¹å‡»æŒ‰é’®ï¼ŒæŠŠæŸä¸ªdivé¡ºæ—¶é’ˆæ—‹è½¬90åº¦ã€‚è¿™é‡Œæ˜¯æƒ³æŠŠæ—¶é—´æ˜¾ç¤ºåŒºå—æ—‹è½¬90åº¦ã€‚<br>jsæ§åˆ¶cssçš„å±æ€§ï¼Œæ—‹è½¬div</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs js">timeFieldRotateDeg = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">function</span> <span class="hljs-title function_">rotateTimeFieldRight</span>(<span class="hljs-params"></span>) &#123;<br>timeFieldRotateDeg += <span class="hljs-number">90</span>;<br><span class="hljs-keyword">if</span>(timeFieldRotateDeg == <span class="hljs-number">360</span>) &#123;<br>timeFieldRotateDeg = <span class="hljs-number">0</span>;<br>&#125;<br>timeContentField = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;timeContentField&#x27;</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;rotate time content field&#x27;</span>);<br>timeContentField.<span class="hljs-property">style</span>.<span class="hljs-property">webkitTransform</span> = <span class="hljs-string">&#x27;rotate(&#x27;</span>+timeFieldRotateDeg+<span class="hljs-string">&#x27;deg)&#x27;</span>; <br>timeContentField.<span class="hljs-property">style</span>.<span class="hljs-property">mozTransform</span>    = <span class="hljs-string">&#x27;rotate(&#x27;</span>+timeFieldRotateDeg+<span class="hljs-string">&#x27;deg)&#x27;</span>; <br>timeContentField.<span class="hljs-property">style</span>.<span class="hljs-property">msTransform</span>     = <span class="hljs-string">&#x27;rotate(&#x27;</span>+timeFieldRotateDeg+<span class="hljs-string">&#x27;deg)&#x27;</span>; <br>timeContentField.<span class="hljs-property">style</span>.<span class="hljs-property">oTransform</span>      = <span class="hljs-string">&#x27;rotate(&#x27;</span>+timeFieldRotateDeg+<span class="hljs-string">&#x27;deg)&#x27;</span>; <br>timeContentField.<span class="hljs-property">style</span>.<span class="hljs-property">transform</span>       = <span class="hljs-string">&#x27;rotate(&#x27;</span>+timeFieldRotateDeg+<span class="hljs-string">&#x27;deg)&#x27;</span>; <br>&#125;<br></code></pre></td></tr></table></figure><p>å‚è€ƒ</p><ul><li><a href="https://stackoverflow.com/questions/19126432/rotate-a-div-using-javascript">https://stackoverflow.com/questions/19126432/rotate-a-div-using-javascript</a></li><li><a href="https://stackoverflow.com/questions/14233341/how-can-i-rotate-an-html-div-90-degrees">https://stackoverflow.com/questions/14233341/how-can-i-rotate-an-html-div-90-degrees</a></li></ul><h3 id="kindleé€‚é…é—®é¢˜"><a href="#kindleé€‚é…é—®é¢˜" class="headerlink" title="kindleé€‚é…é—®é¢˜"></a>kindleé€‚é…é—®é¢˜</h3><p>bootstrapä¼¼ä¹å¹¶ä¸èƒ½åœ¨kindleçš„æµè§ˆå™¨ä¸Šå¾ˆå¥½çš„å·¥ä½œã€‚<br>ä¸é‡‡ç”¨åŠ¨æ€è®¡ç®—å±å¹•å®½é«˜çš„æ–¹å¼ã€‚å±…ä¸­å…ƒç´ ã€‚</p><p><a href="https://tools.rustfisher.com/clock-k2.html">https://tools.rustfisher.com/clock-k2.html</a></p>]]></content>
    
    
    <categories>
      
      <category>Web_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€å‘è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android OkHttp + Retrofit å–æ¶ˆè¯·æ±‚çš„æ–¹æ³•</title>
    <link href="/2019/06/26/Android/Android-OkHttp_Retrofit_cancel_request/"/>
    <url>/2019/06/26/Android/Android-OkHttp_Retrofit_cancel_request/</url>
    
    <content type="html"><![CDATA[<p><a href="https://rustfisher.com/2019/06/26/Android/Android-OkHttp_Retrofit_cancel_request/">æœ¬æ–‡é“¾æ¥</a></p><h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨æŸä¸€ä¸ªç•Œé¢ï¼Œç”¨æˆ·å‘èµ·äº†ä¸€ä¸ªç½‘ç»œè¯·æ±‚ï¼Œå› ä¸ºæŸç§åŸå› ç”¨æˆ·åœ¨ç½‘ç»œè¯·æ±‚å®Œæˆå‰ç¦»å¼€äº†å½“å‰ç•Œé¢ï¼Œæ¯”è¾ƒå¥½çš„åšæ³•æ˜¯å–æ¶ˆè¿™ä¸ªç½‘ç»œè¯·æ±‚ã€‚å¯¹äºOkHttpæ¥è¯´ï¼Œå…·ä½“æ˜¯è°ƒç”¨<code>Call</code>çš„<code>cancel</code>æ–¹æ³•ã€‚</p><p>å¦‚ä½•æ‰¾åˆ°è¿™ä¸€ä¸ªç½‘ç»œè¯·æ±‚å¹¶å–æ¶ˆæ‰å®ƒå‘¢ï¼Ÿ</p><p>æ“ä½œå¤§è‡´åˆ†ä¸º3æ­¥ã€‚ç¬¬ä¸€æ­¥ï¼Œåœ¨å»ºç«‹è¯·æ±‚æ—¶ï¼Œç»™è¯·æ±‚ï¼ˆrequestï¼‰æ·»åŠ æ ‡è®°ï¼›ç¬¬äºŒæ­¥ï¼Œæ ¹æ®æ ‡è®°ï¼Œæ‰¾åˆ°è¯·æ±‚ï¼›æœ€åï¼Œå–æ¶ˆè¿™ä¸ªè¯·æ±‚ã€‚</p><h1 id="OkHttpä¸­çš„tag"><a href="#OkHttpä¸­çš„tag" class="headerlink" title="OkHttpä¸­çš„tag"></a>OkHttpä¸­çš„tag</h1><p>è¦å–æ¶ˆä¸€ä¸ªè¯·æ±‚ï¼ŒOkHttpä¸­å¯ä»¥ä½¿ç”¨cancelæ–¹æ³•ï¼Œ<a href="https://www.jianshu.com/p/b74466039b84">å‚è€ƒ</a>ã€‚</p><p>OkHttpçš„requestå¯¹è±¡æœ‰tagã€‚å¯ä»¥æ ¹æ®tagæ¥æ ‡ç¤ºè¯·æ±‚ã€‚<a href="https://stackoverflow.com/questions/46477195/how-to-cancel-the-request-using-okhttp">å‚è€ƒStack Overflow</a>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//Set tags for your requests when you build them:</span><br><span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Request</span>.Builder().<br>url(url).tag(<span class="hljs-string">&quot;requestKey&quot;</span>).build();<br><br><span class="hljs-comment">//When you want to cancel:</span><br><span class="hljs-comment">//A) go through the queued calls and cancel if the tag matches:</span><br><span class="hljs-keyword">for</span> (Call call : mHttpClient.dispatcher().queuedCalls()) &#123;<br>    <span class="hljs-keyword">if</span> (call.request().tag().equals(<span class="hljs-string">&quot;requestKey&quot;</span>))<br>        call.cancel();<br>&#125;<br><br><span class="hljs-comment">//B) go through the running calls and cancel if the tag matches:</span><br><span class="hljs-keyword">for</span> (Call call : mHttpClient.dispatcher().runningCalls()) &#123;<br>    <span class="hljs-keyword">if</span> (call.request().tag().equals(<span class="hljs-string">&quot;requestKey&quot;</span>))<br>        call.cancel();<br>&#125;<br><br></code></pre></td></tr></table></figure><p>Retrofitä¸­å¹¶æ²¡æœ‰æ˜¾ç¤ºåœ°æä¾›å–æ¶ˆè¯·æ±‚çš„æ¥å£ã€‚<a href="https://github.com/square/retrofit/issues/2608">2018å¹´æ—¶Retrofitä»æœªæä¾›ç›´æ¥è®¿é—®callå¯¹è±¡çš„æ–¹æ³•</a><br>é‚£ä¹ˆå¦‚ä½•æ‰¾åˆ°ç›®æ ‡ç½‘ç»œè¯·æ±‚å‘¢ï¼Ÿ</p><h1 id="RetrofitåŠ å…¥è‡ªå®šä¹‰header"><a href="#RetrofitåŠ å…¥è‡ªå®šä¹‰header" class="headerlink" title="RetrofitåŠ å…¥è‡ªå®šä¹‰header"></a>RetrofitåŠ å…¥è‡ªå®šä¹‰header</h1><p>ç»™æ¯ä¸ªä¸é¡µé¢ï¼ˆActivityï¼ŒFragmentï¼‰ç›¸å…³çš„requeståŠ å…¥è‡ªå®šä¹‰headerï¼Œ<a href="https://publicobject.com/2016/01/17/sneaking-data-into-an-okhttp-interceptor/">å‚è€ƒ</a>ã€‚<br>ç»™OkHttpClientæ·»åŠ æ‹¦æˆªå™¨ã€‚æ ‡è®°å‡ºé¡µé¢çš„ç”Ÿå­˜çŠ¶æ€ã€‚å¦‚æœé¡µé¢é”€æ¯äº†ï¼Œåˆ™å–æ¶ˆå¯¹åº”çš„requestã€‚</p><p>ä»¥GithubOnAndroidé¡¹ç›®ä¸ºä¾‹ï¼Œ<a href="https://github.com/RustFisher/GithubOnAndroid">https://github.com/RustFisher/GithubOnAndroid</a></p><h2 id="æ·»åŠ æ ‡è®°"><a href="#æ·»åŠ æ ‡è®°" class="headerlink" title="æ·»åŠ æ ‡è®°"></a>æ·»åŠ æ ‡è®°</h2><p>æŒæœ‰ä¸€ä¸ªConcurrentHashMap&lt;String, Boolean&gt;æ¥æ ‡è®°é¡µé¢å­˜æ´»çŠ¶æ€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ConcurrentHashMap&lt;String, Boolean&gt; actLiveMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;(); <span class="hljs-comment">// æ ‡è®°Activityæ˜¯å¦å­˜æ´»</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">markPageAlive</span><span class="hljs-params">(String actName)</span> &#123;<br>    actLiveMap.put(actName, <span class="hljs-literal">true</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">markPageDestroy</span><span class="hljs-params">(String actName)</span> &#123;<br>    actLiveMap.put(actName, <span class="hljs-literal">false</span>);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Activityä¸­ç™»è®°ç•Œé¢çŠ¶æ€"><a href="#Activityä¸­ç™»è®°ç•Œé¢çŠ¶æ€" class="headerlink" title="Activityä¸­ç™»è®°ç•Œé¢çŠ¶æ€"></a>Activityä¸­ç™»è®°ç•Œé¢çŠ¶æ€</h2><p>ç»™å½“å‰Activityèµ·åå­—ã€‚æ¯ä¸ªActivityçš„æ ‡è®°åå¿…é¡»å”¯ä¸€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">MY_ACT_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;xxx1Activity&quot;</span>;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        NetworkCenter.markPageAlive(MY_ACT_NAME);<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onDestroy();<br>        NetworkCenter.markPageDestroy(MY_ACT_NAME);<br>        <span class="hljs-comment">// ...</span><br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="OkHttpClientæ·»åŠ æ‹¦æˆªå™¨"><a href="#OkHttpClientæ·»åŠ æ‹¦æˆªå™¨" class="headerlink" title="OkHttpClientæ·»åŠ æ‹¦æˆªå™¨"></a>OkHttpClientæ·»åŠ æ‹¦æˆªå™¨</h2><p>ç»™OkHttpClientæ·»åŠ æ‹¦æˆªå™¨ï¼Œåœ¨æ‹¦æˆªå™¨ä¸­æ£€æŸ¥é¡µé¢çš„å­˜æ´»æƒ…å†µã€‚<br>æ£€æŸ¥åï¼ŒæŠŠè¿™ä¸ªè‡ªå®šä¹‰headerç§»é™¤æ‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">HEADER_ACT_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;Activity-Name&quot;</span>; <span class="hljs-comment">// æ ‡è®°Activityç•Œé¢åå­—</span><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">Interceptor</span> <span class="hljs-variable">lifeInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Interceptor</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">intercept</span><span class="hljs-params">(Chain chain)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>            <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> chain.request();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">actName</span> <span class="hljs-operator">=</span> request.header(HEADER_ACT_NAME);<br>            <span class="hljs-keyword">if</span> (!TextUtils.isEmpty(actName)) &#123;<br>                Log.d(TAG, <span class="hljs-string">&quot;lifeInterceptor: actName: &quot;</span> + actName);<br>                <span class="hljs-type">Boolean</span> <span class="hljs-variable">actLive</span> <span class="hljs-operator">=</span> actLiveMap.get(actName);<br>                <span class="hljs-keyword">if</span> (actLive == <span class="hljs-literal">null</span> || !actLive) &#123;<br>                    chain.call().cancel();<br>                    Log.d(TAG, <span class="hljs-string">&quot;lifeInterceptor: å–æ¶ˆè¯·æ±‚, actName: &quot;</span> + actName);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    Log.d(TAG, <span class="hljs-string">&quot;lifeInterceptor: å‘èµ·è¯·æ±‚, actName: &quot;</span> + actName);<br>                &#125;<br>            &#125;<br>            <span class="hljs-type">Request</span> <span class="hljs-variable">newRequest</span> <span class="hljs-operator">=</span> request.newBuilder().removeHeader(HEADER_ACT_NAME).build();<br>            <span class="hljs-keyword">return</span> chain.proceed(newRequest);<br>        &#125;<br>    &#125;;<br><br><br>OkHttpClient = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>.Builder()<br>        .readTimeout(<span class="hljs-number">10</span>, TimeUnit.SECONDS)<br>        .connectTimeout(<span class="hljs-number">10</span>, TimeUnit.SECONDS)<br>        .addInterceptor(lifeInterceptor) <span class="hljs-comment">// æ·»åŠ æ‹¦æˆªå™¨</span><br>        .build();<br></code></pre></td></tr></table></figure><p>call.cancel()åï¼Œä¸ä¼šå†èµ°Retrofitçš„subscribeæ–¹æ³•ã€‚</p><h2 id="æ·»åŠ header"><a href="#æ·»åŠ header" class="headerlink" title="æ·»åŠ header"></a>æ·»åŠ header</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GET(&quot;users/&#123;owner&#125;/repos&quot;)</span><br>Observable&lt;List&lt;UserRepo&gt;&gt; <span class="hljs-title function_">userRepo</span><span class="hljs-params">(</span><br><span class="hljs-params">        <span class="hljs-meta">@Header(NetworkCenter.HEADER_ACT_NAME)</span> <span class="hljs-meta">@Nullable</span> String actName,</span><br><span class="hljs-params">        <span class="hljs-meta">@Path(&quot;owner&quot;)</span> String owner,</span><br><span class="hljs-params">        <span class="hljs-meta">@Query(&quot;sort&quot;)</span> String sortType)</span>;<br></code></pre></td></tr></table></figure><p>æ›´å¤šè¯·å‚è€ƒï¼š</p><p><a href="https://rustfisher.com/2018/08/22/Android/Android-OkHttp_Retrofit_use_intro/">Android OkHttp + Retrofit ä½¿ç”¨ç¤ºä¾‹</a></p><p><a href="https://rustfisher.com/2019/06/26/Android/Android-OkHttp_Retrofit_cancel_request/">Android OkHttp + Retrofit å–æ¶ˆè¯·æ±‚çš„æ–¹æ³•</a></p><p><a href="https://rustfisher.com/2019/10/18/Android/Android-OkHttp_Retrofit_download_file/">Android OkHttp + Retrofit ä¸‹è½½æ–‡ä»¶ä¸è¿›åº¦ç›‘å¬</a></p><p><a href="https://rustfisher.com/2019/10/18/Android/Android-OkHttp_Retrofit_download_file_partial/">Android OkHttp + Retrofit æ–­ç‚¹ç»­ä¼ </a></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>network</tag>
      
      <tag>OkHttp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android SparseArray åŸç†è§£æ</title>
    <link href="/2019/04/21/Android/Android-SparseArray_src_code_note/"/>
    <url>/2019/04/21/Android/Android-SparseArray_src_code_note/</url>
    
    <content type="html"><![CDATA[<h1 id="Android-SparseArray-åŸç†è§£æ"><a href="#Android-SparseArray-åŸç†è§£æ" class="headerlink" title="Android SparseArray åŸç†è§£æ"></a>Android SparseArray åŸç†è§£æ</h1><h2 id="ä»€ä¹ˆæ˜¯SparseArrayï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯SparseArrayï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯SparseArrayï¼Ÿ"></a>ä»€ä¹ˆæ˜¯SparseArrayï¼Ÿ</h2><p>SparseArrayå­˜å‚¨çš„æ˜¯é”®å€¼å¯¹ï¼Œä»¥intä½œä¸ºkeyï¼ŒObjectä½œä¸ºvalueã€‚Sparseæœ‰ç¨€ç–ã€ç¼ºå°‘çš„æ„æ€ã€‚SparseArrayåº”ç”¨åœºæ™¯æ˜¯ç›¸å¯¹ç¨€å°‘çš„æ•°æ®ï¼Œä¸€èˆ¬æ˜¯å‡ ç™¾ä»¥å†…ã€‚</p><h2 id="SparseArrayé‡‡ç”¨çš„æ•°æ®ç»“æ„ï¼Ÿ"><a href="#SparseArrayé‡‡ç”¨çš„æ•°æ®ç»“æ„ï¼Ÿ" class="headerlink" title="SparseArrayé‡‡ç”¨çš„æ•°æ®ç»“æ„ï¼Ÿ"></a>SparseArrayé‡‡ç”¨çš„æ•°æ®ç»“æ„ï¼Ÿ</h2><p>SparseArrayå¹¶ä¸åƒHashMapé‡‡ç”¨ä¸€ç»´æ•°ç»„+å•é“¾è¡¨å’ŒäºŒå‰æ ‘ç»“æ„ï¼Œè€Œæ˜¯é‡‡ç”¨ä¸¤ä¸ªä¸€ç»´æ•°ç»„ï¼Œä¸€ä¸ªæ˜¯å­˜å‚¨key(intç±»å‹),ä¸€ä¸ªæ˜¯å­˜value objectã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] mKeys; <span class="hljs-comment">// å­˜å‚¨key</span><br><span class="hljs-keyword">private</span> Object[] mValues; <span class="hljs-comment">// å­˜å‚¨valueå¯¹è±¡</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mSize; <span class="hljs-comment">// è®°å½•å­˜å‚¨é”®å€¼å¯¹çš„æ•°é‡</span><br></code></pre></td></tr></table></figure><p>mKeyså’ŒmValuesè¯»å†™æ—¶é‡‡ç”¨çš„ä¸‹æ ‡æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚<br><img src="http://rustblogres.rustfisher.com/Android-SparseArray-mKeys-mValues.pngg" alt=""></p><h2 id="SparseArrayé»˜è®¤å®¹é‡å¤šå¤§ï¼Ÿ"><a href="#SparseArrayé»˜è®¤å®¹é‡å¤šå¤§ï¼Ÿ" class="headerlink" title="SparseArrayé»˜è®¤å®¹é‡å¤šå¤§ï¼Ÿ"></a>SparseArrayé»˜è®¤å®¹é‡å¤šå¤§ï¼Ÿ</h2><p>SparseArrayåœ¨é»˜è®¤æ„é€ å‡½æ•°ä¸­æŒ‡å®šå…¶é»˜è®¤å®¹é‡å¤§å°ã€‚é»˜è®¤ä¸º10</p><p>åˆå§‹åŒ–å<code>mSize = 0</code>ï¼Œå®ä¾‹åŒ–mKeyså’ŒmValuesã€‚</p><h2 id="SparseArray-getæ–¹æ³•çš„æµç¨‹åˆ†æ"><a href="#SparseArray-getæ–¹æ³•çš„æµç¨‹åˆ†æ" class="headerlink" title="SparseArray getæ–¹æ³•çš„æµç¨‹åˆ†æ"></a>SparseArray getæ–¹æ³•çš„æµç¨‹åˆ†æ</h2><p>è¾“å…¥ä¸€ä¸ªintå‹çš„keyï¼Œé€šè¿‡äºŒåˆ†æ³•æŸ¥æ‰¾åŒ¹é…çš„ä¸‹æ ‡ã€‚è‹¥æ²¡æ‰¾åˆ°å¯¹åº”çš„ä¸‹æ ‡ï¼Œåˆ™è¿”å›nullæˆ–ç”¨æˆ·æŒ‡å®šçš„é»˜è®¤å¯¹è±¡ã€‚</p><p>keyæ˜¯é€’å¢å­˜æ”¾çš„ã€‚äºŒåˆ†æ³•æŸ¥æ‰¾ä¸‹æ ‡æ—¶ï¼Œå¯èƒ½ä¼šè¿”å›ä¸€ä¸ªè´Ÿå€¼ï¼Œæ­¤æ—¶è¡¨ç¤ºåœ¨mKeysä¸­æ²¡æ‰¾åˆ°å¯¹åº”çš„é”®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> E <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">int</span> key)</span> &#123;<br>    <span class="hljs-keyword">return</span> get(key, <span class="hljs-literal">null</span>);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Gets the Object mapped from the specified key, or the specified Object</span><br><span class="hljs-comment"> * if no such mapping has been made.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="hljs-keyword">public</span> E <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">int</span> key, E valueIfKeyNotFound)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> ContainerHelpers.binarySearch(mKeys, mSize, key); <span class="hljs-comment">// äºŒåˆ†æ³•æŸ¥æ‰¾ä¸‹æ ‡</span><br><br>    <span class="hljs-keyword">if</span> (i &lt; <span class="hljs-number">0</span> || mValues[i] == DELETED) &#123; <br>    <span class="hljs-comment">// æ‰¾åˆ°çš„ä¸‹æ ‡ä¸ºè´Ÿæˆ–å½“å‰ä½ç½®å…ƒç´ ä»¥è¢«åˆ é™¤ï¼Œè¡¨æ˜æ²¡æ‰¾åˆ°</span><br>        <span class="hljs-keyword">return</span> valueIfKeyNotFound;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> (E) mValues[i]; <span class="hljs-comment">// æ‰¾åˆ°æŒ‡å®šå…ƒç´ </span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="SparseArray-putæ–¹æ³•çš„æµç¨‹åˆ†æ"><a href="#SparseArray-putæ–¹æ³•çš„æµç¨‹åˆ†æ" class="headerlink" title="SparseArray putæ–¹æ³•çš„æµç¨‹åˆ†æ"></a>SparseArray putæ–¹æ³•çš„æµç¨‹åˆ†æ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(<span class="hljs-type">int</span> key, E value)</span> &#123;<br>       <span class="hljs-comment">// äºŒåˆ†æ³•æ‰¾åˆ°keyçš„ä¸‹æ ‡</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> ContainerHelpers.binarySearch(mKeys, mSize, key);<br><br>        <span class="hljs-keyword">if</span> (i &gt;= <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// ä»£è¡¨å½“å‰å·²ç»å­˜åœ¨keyåŠå…¶å¯¹åº”çš„å€¼ï¼Œç›´æ¥æ›¿æ¢value</span><br>            mValues[i] = value;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// è¡¨ç¤ºå½“å‰å¹¶ä¸å­˜åœ¨keyï¼Œåˆ™åº”æ·»åŠ æ–°çš„é”®å€¼å¯¹</span><br>            <span class="hljs-comment">// iå–åï¼Œå¾—åˆ°è¦æ·»åŠ çš„æ•°ç»„ä½ç½®ä¸‹æ ‡ã€‚äºŒå‰æŸ¥æ‰¾è¿”å›çš„æ˜¯keyçš„â€œåº”å½“â€å­˜æ”¾çš„ä½ç½®ä¸‹æ ‡ã€‚</span><br>            i = ~i;<br>            <br>            <span class="hljs-keyword">if</span> (i &lt; mSize &amp;&amp; mValues[i] == DELETED) &#123;<br>                <span class="hljs-comment">// åŸæ¥ä½ç½®ä¸Šçš„å…ƒç´ å·²ç»è¢«åˆ æ‰äº†ï¼Œç›´æ¥èµ‹å€¼æ›¿æ¢</span><br>                mKeys[i] = key;<br>                mValues[i] = value;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            <br>            <span class="hljs-keyword">if</span> (mGarbage &amp;&amp; mSize &gt;= mKeys.length) &#123;<br>                <span class="hljs-comment">// å®¹é‡ä¸è¶³ï¼Œè¿›è¡Œå›æ”¶æ“ä½œ</span><br>                gc();<br>                <span class="hljs-comment">// é‡æ–°æŸ¥æ‰¾ç›®æ ‡ä¸‹æ ‡</span><br>                i = ~ContainerHelpers.binarySearch(mKeys, mSize, key);<br>            &#125;<br>            <span class="hljs-comment">// ç›®æ ‡ä¸‹æ ‡ä¸ºiï¼Œå°†keyæ·»åŠ è¿›mKeysæ•°ç»„ä¸­</span><br>            mKeys = GrowingArrayUtils.insert(mKeys, mSize, i, key);<br>            <span class="hljs-comment">// ç›®æ ‡ä¸‹æ ‡ä¸ºiï¼Œå°†valueæ’å…¥mValuesæ•°ç»„ä¸­</span><br>            mValues = GrowingArrayUtils.insert(mValues, mSize, i, value);<br>            <span class="hljs-comment">// å·²å­˜å‚¨çš„æ•°æ®ä¸ªæ•°åŠ 1</span><br>            mSize++;<br>        &#125;<br>&#125;<br><br><span class="hljs-comment">// GrowingArrayUtils.java</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; T[] insert(T[] array, <span class="hljs-type">int</span> currentSize, <span class="hljs-type">int</span> index, T element) &#123;<br>        <span class="hljs-keyword">assert</span> currentSize &lt;= array.length;<br><br>        <span class="hljs-keyword">if</span> (currentSize + <span class="hljs-number">1</span> &lt;= array.length) &#123;<br>            <span class="hljs-comment">// å½“å‰æ•°ç»„å®¹é‡å……è¶³ï¼Œindexå¼€å§‹çš„å…ƒç´ åç§»1ä½</span><br>            System.arraycopy(array, index, array, index + <span class="hljs-number">1</span>, currentSize - index);<br>            array[index] = element;<br>            <span class="hljs-keyword">return</span> array;<br>        &#125;<br>        <br>        <span class="hljs-comment">// å®¹é‡ä¸è¶³ï¼Œå…ˆæ‰©å®¹ç”Ÿæˆæ–°çš„æ•°ç»„newArray</span><br>        <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>        T[] newArray = ArrayUtils.newUnpaddedArray((Class&lt;T&gt;)array.getClass().getComponentType(),<br>                growSize(currentSize));<br>        <span class="hljs-comment">// å°†åŸæ¥æ•°ç»„indexä¹‹å‰çš„éƒ¨åˆ†å¤åˆ¶åˆ°æ–°æ•°ç»„å¯¹è±¡ä¸­</span><br>        System.arraycopy(array, <span class="hljs-number">0</span>, newArray, <span class="hljs-number">0</span>, index);<br>        newArray[index] = element; <span class="hljs-comment">// æ’å…¥å…ƒç´ </span><br>        <span class="hljs-comment">// å°†åŸæ•°ç»„index+1ä¹‹åçš„å…ƒç´ æ‹·è´åˆ°æ–°æ•°ç»„ä¸­</span><br>        System.arraycopy(array, index, newArray, index + <span class="hljs-number">1</span>, array.length - index);<br>        <span class="hljs-keyword">return</span> newArray;<br>    &#125;<br><br><span class="hljs-comment">// æ‰©å®¹è®¡ç®—è§„åˆ™ï¼Œå½“å‰å®¹é‡å°äºç­‰äº4åˆ™è¿”å›8ï¼›å¦åˆ™è¿”å›2å€çš„å®¹é‡</span><br><span class="hljs-comment">// æ‰©å®¹åæœ€å°å®¹é‡æ˜¯8</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">growSize</span><span class="hljs-params">(<span class="hljs-type">int</span> currentSize)</span> &#123;<br>        <span class="hljs-keyword">return</span> currentSize &lt;= <span class="hljs-number">4</span> ? <span class="hljs-number">8</span> : currentSize * <span class="hljs-number">2</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="keyä¸‹æ ‡çš„äºŒå‰æŸ¥æ‰¾æ–¹æ³•åˆ†æ"><a href="#keyä¸‹æ ‡çš„äºŒå‰æŸ¥æ‰¾æ–¹æ³•åˆ†æ" class="headerlink" title="keyä¸‹æ ‡çš„äºŒå‰æŸ¥æ‰¾æ–¹æ³•åˆ†æ"></a>keyä¸‹æ ‡çš„äºŒå‰æŸ¥æ‰¾æ–¹æ³•åˆ†æ</h2><p>äºŒå‰æŸ¥æ‰¾æ–¹æ³•<code>ContainerHelpers.binarySearch(int[] array, int size, int value)</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">binarySearch</span><span class="hljs-params">(<span class="hljs-type">int</span>[] array, <span class="hljs-type">int</span> size, <span class="hljs-type">int</span> value)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">lo</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">hi</span> <span class="hljs-operator">=</span> size - <span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">while</span> (lo &lt;= hi) &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> (lo + hi) &gt;&gt;&gt; <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">midVal</span> <span class="hljs-operator">=</span> array[mid];<br><br>        <span class="hljs-keyword">if</span> (midVal &lt; value) &#123;<br>            lo = mid + <span class="hljs-number">1</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (midVal &gt; value) &#123;<br>            hi = mid - <span class="hljs-number">1</span>;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> mid;  <span class="hljs-comment">// value found</span><br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> ~lo;  <span class="hljs-comment">// value not present</span><br>&#125;<br></code></pre></td></tr></table></figure></p><p>å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¾“å…¥valueå¯¹åº”çš„ä¸‹æ ‡ï¼Œåˆ™ä¼šè¿”å›ä¸€ä¸ªæŒ‰ä½å–ååçš„å€¼ï¼ˆä¸€èˆ¬æ˜¯ä¸ªè´Ÿå€¼ï¼‰ã€‚</p><p>ä¾‹å¦‚è¾“å…¥arrayæ˜¯ [1,2,4,5]ï¼Œsizeæ˜¯4ï¼Œvalueæ˜¯3ï¼›é‚£ä¹ˆä¼šå¾—åˆ°2çš„å–åå€¼ã€‚è€Œ<code>2</code>å°±æ˜¯valueçš„ç›®æ ‡ä½ç½®ä¸‹æ ‡ã€‚</p><h2 id="SparseArrayæœ€å¤§å®¹é‡ï¼Ÿæ¯æ¬¡æ‰©å®¹å¤šå°‘ï¼Ÿ"><a href="#SparseArrayæœ€å¤§å®¹é‡ï¼Ÿæ¯æ¬¡æ‰©å®¹å¤šå°‘ï¼Ÿ" class="headerlink" title="SparseArrayæœ€å¤§å®¹é‡ï¼Ÿæ¯æ¬¡æ‰©å®¹å¤šå°‘ï¼Ÿ"></a>SparseArrayæœ€å¤§å®¹é‡ï¼Ÿæ¯æ¬¡æ‰©å®¹å¤šå°‘ï¼Ÿ</h2><p>SparseArrayå¹¶ä¸åƒHashMapä¸€æ ·å®šä¹‰æœ‰æœ€å¤§å®¹é‡æ˜¯å¤šå°‘ï¼Œæœ€å¤§å¯ä»¥è¾¾åˆ°Integer.MAX_VALUEï¼Œå¯èƒ½ä¼šæŠ¥oomã€‚æ¯æ¬¡æ‰©å®¹æ—¶å¦‚æœå½“å‰å®¹é‡å°äº5åˆ™æ‰©å®¹æ˜¯8ï¼Œå¦åˆ™æ‰©å®¹ä¸ºåŸå®¹é‡çš„2å€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">growSize</span><span class="hljs-params">(<span class="hljs-type">int</span> currentSize)</span> &#123;<br>        <span class="hljs-keyword">return</span> currentSize &lt;= <span class="hljs-number">4</span> ? <span class="hljs-number">8</span> : currentSize * <span class="hljs-number">2</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="SparseArrayä¸HashMapçš„æ¯”è¾ƒï¼Œåº”ç”¨åœºæ™¯æ˜¯ï¼Ÿ"><a href="#SparseArrayä¸HashMapçš„æ¯”è¾ƒï¼Œåº”ç”¨åœºæ™¯æ˜¯ï¼Ÿ" class="headerlink" title="SparseArrayä¸HashMapçš„æ¯”è¾ƒï¼Œåº”ç”¨åœºæ™¯æ˜¯ï¼Ÿ"></a>SparseArrayä¸HashMapçš„æ¯”è¾ƒï¼Œåº”ç”¨åœºæ™¯æ˜¯ï¼Ÿ</h2><ul><li>SparseArrayé‡‡ç”¨çš„ä¸æ˜¯å“ˆå¸Œç®—æ³•ï¼ŒHashMapé‡‡ç”¨çš„æ˜¯å“ˆå¸Œç®—æ³•ã€‚</li><li>SparseArrayé‡‡ç”¨çš„æ˜¯ä¸¤ä¸ªä¸€ç»´æ•°ç»„åˆ†åˆ«ç”¨äºå­˜å‚¨é”®å’Œå€¼ï¼ŒHashMapé‡‡ç”¨çš„æ˜¯ä¸€ç»´æ•°ç»„+å•å‘é“¾è¡¨æˆ–äºŒå‰æ ‘ã€‚</li><li>SparseArray keyåªèƒ½æ˜¯intç±»å‹ï¼Œè€ŒHashMapçš„keyæ˜¯Objectã€‚</li><li>SparseArray  keyæ˜¯æœ‰åºå­˜å‚¨ï¼ˆå‡åºï¼‰ï¼Œè€ŒHashMapä¸æ˜¯ã€‚</li><li>SparseArray é»˜è®¤å®¹é‡æ˜¯10ï¼Œè€ŒHashMapé»˜è®¤å®¹é‡æ˜¯16ã€‚</li><li>SparseArray é»˜è®¤æ¯æ¬¡æ‰©å®¹æ˜¯2å€äºåŸæ¥çš„å®¹é‡ï¼Œè€ŒHashMapé»˜è®¤æ¯æ¬¡æ‰©å®¹æ—¶æ˜¯åŸå®¹é‡*0.75å€</li><li>SparseArray valueçš„å­˜å‚¨è¢«ä¸åƒHashMapä¸€æ ·éœ€è¦é¢å¤–çš„éœ€è¦ä¸€ä¸ªå®ä½“ç±»ï¼ˆNodeï¼‰è¿›è¡ŒåŒ…è£…</li><li>SparseArrayæŸ¥æ‰¾å…ƒç´ æ€»ä½“è€Œè¨€æ¯”HashMapè¦é€Šè‰²ï¼Œå› ä¸ºSparseArrayæŸ¥æ‰¾æ˜¯éœ€è¦ç»è¿‡äºŒåˆ†æ³•çš„è¿‡ç¨‹ï¼Œè€ŒHashMapä¸å­˜åœ¨å†²çªçš„æƒ…å†µå…¶æŠ€æœ¯å¤„çš„hashå¯¹åº”çš„ä¸‹æ ‡ç›´æ¥å°±å¯ä»¥å–åˆ°å€¼ã€‚</li></ul><p>é’ˆå¯¹ä¸Šé¢ä¸HashMapçš„æ¯”è¾ƒï¼Œé‡‡ç”¨SparseArrayè¿˜æ˜¯HashMapï¼Œå»ºè®®æ ¹æ®å¦‚ä¸‹éœ€æ±‚é€‰å–ï¼š</p><ul><li>å¦‚æœå¯¹å†…å­˜è¦æ±‚æ¯”è¾ƒé«˜ï¼Œè€Œå¯¹æŸ¥è¯¢æ•ˆç‡æ²¡ä»€ä¹ˆå¤§çš„è¦æ±‚ï¼Œå¯ä»¥æ˜¯ä½¿ç”¨SparseArray</li><li>æ•°é‡åœ¨ç™¾çº§åˆ«çš„SparseArrayæ¯”HashMapæœ‰æ›´å¥½çš„ä¼˜åŠ¿</li><li>è¦æ±‚keyæ˜¯intç±»å‹çš„ï¼Œå› ä¸ºHashMapä¼šå¯¹intè‡ªå®šè£…ç®±å˜æˆIntegerç±»å‹</li><li>è¦æ±‚keyæ˜¯æœ‰åºçš„ä¸”æ˜¯å‡åº</li></ul><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://www.jianshu.com/p/30a2bfb202b4">https://www.jianshu.com/p/30a2bfb202b4</a></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Androidæºç </tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL Mac å®‰è£…ä¸ç®€å•é…ç½®</title>
    <link href="/2019/02/26/Database/MySQL-install_and_config_Mac/"/>
    <url>/2019/02/26/Database/MySQL-install_and_config_Mac/</url>
    
    <content type="html"><![CDATA[<h2 id="homebrewå®‰è£…mysql"><a href="#homebrewå®‰è£…mysql" class="headerlink" title="homebrewå®‰è£…mysql"></a>homebrewå®‰è£…mysql</h2><p>ä½¿ç”¨brewå‘½ä»¤å®‰è£…mysql<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mb:~ rustfisher$ brew install mysql<br></code></pre></td></tr></table></figure></p><h2 id="å¯åŠ¨åœæ­¢mysqlæœåŠ¡"><a href="#å¯åŠ¨åœæ­¢mysqlæœåŠ¡" class="headerlink" title="å¯åŠ¨åœæ­¢mysqlæœåŠ¡"></a>å¯åŠ¨åœæ­¢mysqlæœåŠ¡</h2><p>å¯åŠ¨æœåŠ¡ <code>mysql.server start</code><br>å®‰è£…æ—¶æ²¡æœ‰è®¾ç½®å¯†ç ï¼Œå¯ä»¥ç›´æ¥<code>mysql -uroot</code>ç™»å…¥ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">mb:~ rustfisher$ mysql.server start<br>Starting MySQL<br>. SUCCESS! <br><br>mb:~ rustfisher$ mysql -uroot<br>Welcome to the MySQL monitor.  Commands end with ; or \g.<br>Your MySQL connection <span class="hljs-built_in">id</span> is 9<br>Server version: 8.0.12 Homebrew<br><br>Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.<br><br>Oracle is a registered trademark of Oracle Corporation and/or its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type <span class="hljs-string">&#x27;help;&#x27;</span> or <span class="hljs-string">&#x27;\h&#x27;</span> <span class="hljs-keyword">for</span> <span class="hljs-built_in">help</span>. Type <span class="hljs-string">&#x27;\c&#x27;</span> to clear the current input statement.<br><br>mysql&gt; <span class="hljs-built_in">exit</span>;<br>Bye<br></code></pre></td></tr></table></figure></p><p>è¾“å…¥mysqlæŒ‡ä»¤é‡åˆ°é”™è¯¯<br><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mysql&gt; <span class="hljs-keyword">show</span> <span class="hljs-keyword">database</span>;<br>ERROR <span class="hljs-number">1064</span> (<span class="hljs-number">42000</span>): You have an error <span class="hljs-keyword">in</span> your <span class="hljs-keyword">SQL</span> syntax; <span class="hljs-keyword">check</span> the manual that corresponds <span class="hljs-keyword">to</span> your MySQL <span class="hljs-keyword">server</span> <span class="hljs-keyword">version</span> <span class="hljs-keyword">for</span> the right syntax <span class="hljs-keyword">to</span> use near <span class="hljs-string">&#x27;database&#x27;</span> at <span class="hljs-type">line</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></p><p>æŒ‡ä»¤è¾“å…¥é”™è¯¯ï¼Œä¿®æ­£ä¸€ä¸‹<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; show databases;</span><br><span class="hljs-section">+--------------------+</span><br><span class="hljs-section">| Database           |</span><br><span class="hljs-section">+--------------------+</span><br>| information<span class="hljs-emphasis">_schema |</span><br><span class="hljs-emphasis">| mysql              |</span><br><span class="hljs-emphasis">| performance_</span>schema |<br><span class="hljs-section">| sys                |</span><br><span class="hljs-section">+--------------------+</span><br>4 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure></p><p>åœæ­¢mysqlæœåŠ¡çš„å‘½ä»¤ <code>mysql.server stop</code><br><figure class="highlight node-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs node-repl">mb:anindexserver rustfisher$ mysql.server stop<br>Shutting down MySQL<br><span class="hljs-meta prompt_">...</span> <span class="language-javascript"><span class="hljs-variable constant_">SUCCESS</span>! </span><br></code></pre></td></tr></table></figure></p><h2 id="ç®€å•æ“ä½œ"><a href="#ç®€å•æ“ä½œ" class="headerlink" title="ç®€å•æ“ä½œ"></a>ç®€å•æ“ä½œ</h2><h3 id="æ›´æ”¹å¯†ç "><a href="#æ›´æ”¹å¯†ç " class="headerlink" title="æ›´æ”¹å¯†ç "></a>æ›´æ”¹å¯†ç </h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mysql&gt; <span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;yourpwd&#x27;</span>;<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.05</span> sec)<br></code></pre></td></tr></table></figure><p>è®¾å®šäº†å¯†ç åï¼Œç™»å½•éœ€è¦è¾“å…¥å¯†ç <br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">mb:</span>anindexserver rustfisher$ mysql -uroot -p<br>Enter password: <br>Welcome <span class="hljs-keyword">to</span> the MySQL monitor.  Commands <span class="hljs-keyword">end</span> <span class="hljs-keyword">with</span> ; <span class="hljs-built_in">or</span> \g.<br><br></code></pre></td></tr></table></figure></p><p>å‚è€ƒï¼š</p><ul><li><a href="https://dev.mysql.com/doc/refman/8.0/en/resetting-permissions.html">https://dev.mysql.com/doc/refman/8.0/en/resetting-permissions.html</a></li></ul><h2 id="å¯è§†åŒ–å·¥å…·-mysql-workbench"><a href="#å¯è§†åŒ–å·¥å…·-mysql-workbench" class="headerlink" title="å¯è§†åŒ–å·¥å…· mysql workbench"></a>å¯è§†åŒ–å·¥å…· mysql workbench</h2><p>å®˜æ–¹æ–‡æ¡£è¯·å‚è€ƒ <a href="https://dev.mysql.com/downloads/workbench/">https://dev.mysql.com/downloads/workbench/</a></p><h3 id="mysql-workbench-éœ€è¦primary-key"><a href="#mysql-workbench-éœ€è¦primary-key" class="headerlink" title="mysql workbench éœ€è¦primary key"></a>mysql workbench éœ€è¦primary key</h3><p>éœ€è¦æœ‰primary keyæ‰èƒ½ç¼–è¾‘å†…å®¹</p><p><a href="https://stackoverflow.com/questions/10815029/mysql-workbench-edit-table-data-is-read-only">https://stackoverflow.com/questions/10815029/mysql-workbench-edit-table-data-is-read-only</a></p><h2 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h2><p>macä¸­é…ç½®æ–‡ä»¶é»˜è®¤è·¯å¾„ä¸º <code>/usr/local/etc/my.cnf</code></p><p>å¯ä»¥ä¿®æ”¹portã€‚<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># Default Homebrew MySQL server config</span><br><span class="hljs-section">[mysqld]</span><br><span class="hljs-comment"># Only allow connections from localhost</span><br><span class="hljs-attr">port</span>=<span class="hljs-number">9527</span><br><span class="hljs-attr">bind-address</span> = <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><br></code></pre></td></tr></table></figure><br>è¿™é‡Œé™åˆ¶äº†è¿æ¥çš„ç«¯å£ã€‚</p><p>å‚è€ƒï¼š <a href="https://www.cyberciti.biz/faq/change-default-mysql-port-under-linuxunix/">https://www.cyberciti.biz/faq/change-default-mysql-port-under-linuxunix/</a></p>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
      <tag>mac</tag>
      
      <tag>å®‰è£…mysql</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python3 å‘é€é‚®ä»¶åŠŸèƒ½</title>
    <link href="/2018/11/14/Python/python3-send-email/"/>
    <url>/2018/11/14/Python/python3-send-email/</url>
    
    <content type="html"><![CDATA[<p>å‘ä¿¡é‚®ç®±æ˜¯è…¾è®¯ä¼ä¸šé‚®ç®±ã€‚å¼€å‘ç¯å¢ƒ Windows7ã€‚</p><p>ä¸»è¦ä½¿ç”¨<strong>smtplib</strong>æ¥å®ç°å‘é‚®ä»¶çš„åŠŸèƒ½ã€‚</p><h2 id="ç®€å•çš„å‘é€é‚®ä»¶åŠŸèƒ½"><a href="#ç®€å•çš„å‘é€é‚®ä»¶åŠŸèƒ½" class="headerlink" title="ç®€å•çš„å‘é€é‚®ä»¶åŠŸèƒ½"></a>ç®€å•çš„å‘é€é‚®ä»¶åŠŸèƒ½</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å‘é€é‚®ä»¶</span><br><span class="hljs-keyword">import</span> smtplib<br><span class="hljs-keyword">from</span> email.mime.multipart <span class="hljs-keyword">import</span> MIMEMultipart<br><span class="hljs-keyword">from</span> email.mime.text <span class="hljs-keyword">import</span> MIMEText<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_email</span>():<br>    fromaddr = <span class="hljs-string">&quot;from1@your_email.com&quot;</span> <span class="hljs-comment"># ä½ çš„å‘ä»¶é‚®ç®±</span><br>    toaddr = <span class="hljs-string">&quot;to1@your_email.com&quot;</span> <span class="hljs-comment"># ç›®æ ‡é‚®ç®±</span><br>    msg = MIMEMultipart()<br>    msg[<span class="hljs-string">&#x27;From&#x27;</span>] = fromaddr<br>    msg[<span class="hljs-string">&#x27;To&#x27;</span>] = toaddr<br>    msg[<span class="hljs-string">&#x27;Subject&#x27;</span>] = <span class="hljs-string">&quot;SUBJECT OF THE MAIL&quot;</span><br><br>    body = <span class="hljs-string">&quot;YOUR MESSAGE HERE&quot;</span><br>    msg.attach(MIMEText(body, <span class="hljs-string">&#x27;plain&#x27;</span>))<br><br>    server = smtplib.SMTP(<span class="hljs-string">&#x27;smtp.exmail.qq.com&#x27;</span>, <span class="hljs-number">25</span>) <span class="hljs-comment"># é»˜è®¤ç«¯å£25</span><br>    server.starttls()<br>    server.login(fromaddr, <span class="hljs-string">&quot;xxxxå¯†ç &quot;</span>)<br>    text = msg.as_string()<br>    server.sendmail(fromaddr, toaddr, text)<br>    server.quit()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;start sending email&#x27;</span>)<br>    send_email()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;end...&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="é‚®ä»¶å¸¦ä¸Šé™„ä»¶"><a href="#é‚®ä»¶å¸¦ä¸Šé™„ä»¶" class="headerlink" title="é‚®ä»¶å¸¦ä¸Šé™„ä»¶"></a>é‚®ä»¶å¸¦ä¸Šé™„ä»¶</h2><p>Windowsä¸‹æ³¨æ„æ–‡ä»¶è·¯å¾„çš„è¡¨è¾¾æ–¹å¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å‘é€é‚®ä»¶</span><br><span class="hljs-keyword">import</span> smtplib<br><span class="hljs-keyword">from</span> email <span class="hljs-keyword">import</span> encoders<br><span class="hljs-keyword">from</span> email.mime.base <span class="hljs-keyword">import</span> MIMEBase<br><span class="hljs-keyword">from</span> email.mime.multipart <span class="hljs-keyword">import</span> MIMEMultipart<br><span class="hljs-keyword">from</span> email.mime.text <span class="hljs-keyword">import</span> MIMEText<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_email</span>(<span class="hljs-params">from_email, pwd, target_email_list=[], attachment_file_list=[]</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    å•ç‹¬å‘é€é‚®ä»¶</span><br><span class="hljs-string">    create on 2018-11-14</span><br><span class="hljs-string">    :param from_email: æºé‚®ç®±</span><br><span class="hljs-string">    :param pwd: æºé‚®ç®±å¯†ç </span><br><span class="hljs-string">    :param target_email_list:  ç›®æ ‡é‚®ä»¶åˆ—è¡¨</span><br><span class="hljs-string">    :param attachment_file_list:  é™„ä»¶è·¯å¾„åˆ—è¡¨</span><br><span class="hljs-string">    :return: void</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(target_email_list) &lt;= <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ERR: ç›®æ ‡é‚®ä»¶åˆ—è¡¨ä¸ºç©º -&gt; é€€å‡º&#x27;</span>)<br>        <span class="hljs-keyword">return</span><br><br>    <span class="hljs-keyword">for</span> target_email <span class="hljs-keyword">in</span> target_email_list:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;sending to &#x27;</span> + target_email)<br>        msg = MIMEMultipart()<br>        msg[<span class="hljs-string">&#x27;From&#x27;</span>] = from_email<br>        msg[<span class="hljs-string">&#x27;To&#x27;</span>] = target_email<br>        msg[<span class="hljs-string">&#x27;Subject&#x27;</span>] = <span class="hljs-string">&quot;æ›´æ–°&quot;</span><br><br>        body = <span class="hljs-string">&#x27;&#x27;&#x27;å°Šæ•¬çš„å®¢æˆ·ï¼Œ</span><br><span class="hljs-string">    ä½ å¥½ï¼Œè¯·æŸ¥æ”¶æ–‡ä»¶ã€‚</span><br><span class="hljs-string">è°¢è°¢ï¼</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>        msg.attach(MIMEText(body, <span class="hljs-string">&#x27;plain&#x27;</span>))<br><br>        <span class="hljs-keyword">for</span> file_path <span class="hljs-keyword">in</span> attachment_file_list:<br>            filename = <span class="hljs-built_in">str</span>(file_path).split(<span class="hljs-string">&#x27;\\&#x27;</span>)[-<span class="hljs-number">1</span>]<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;file_path &quot;</span> + file_path + <span class="hljs-string">&quot; filename: &quot;</span> + filename)<br>            attachment = <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&quot;rb&quot;</span>)<br><br>            part = MIMEBase(<span class="hljs-string">&#x27;application&#x27;</span>, <span class="hljs-string">&#x27;octet-stream&#x27;</span>)<br>            part.set_payload(attachment.read())<br>            encoders.encode_base64(part)<br>            part.add_header(<span class="hljs-string">&#x27;Content-Disposition&#x27;</span>, <span class="hljs-string">&quot;attachment; filename= %s&quot;</span> % filename)<br><br>            msg.attach(part)<br><br>            server = smtplib.SMTP(<span class="hljs-string">&#x27;smtp.exmail.qq.com&#x27;</span>, <span class="hljs-number">25</span>)<br>            server.starttls()<br>            server.login(from_email, pwd)<br>            text = msg.as_string()<br>            server.sendmail(from_email, target_email, text)<br>            server.quit()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;start sending email&#x27;</span>)<br>    send_email(from_email=<span class="hljs-string">&quot;your_email.com&quot;</span>,<br>               pwd=<span class="hljs-string">&quot;å¯†ç &quot;</span>,<br>               target_email_list=[<span class="hljs-string">&quot;target1@foxmail.com&quot;</span>, <span class="hljs-string">&quot;target2@qq.com&quot;</span>],<br>               attachment_file_list=[<br>                   <span class="hljs-string">r&quot;E:\your_path.rar&quot;</span>])<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;end...&#x27;</span>)<br></code></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><ul><li><a href="https://blog.csdn.net/u011846143/article/details/78274911?locationNum=9&amp;fps=1">https://blog.csdn.net/u011846143/article/details/78274911?locationNum=9&amp;fps=1</a></li><li><a href="http://naelshiab.com/tutorial-send-email-python/">http://naelshiab.com/tutorial-send-email-python/</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Flutter - å¤„ç†æ‰‹åŠ¿</title>
    <link href="/2018/09/06/Flutter/Flutter-Gesture_handle/"/>
    <url>/2018/09/06/Flutter/Flutter-Gesture_handle/</url>
    
    <content type="html"><![CDATA[<h1 id="Flutter-å¤„ç†æ‰‹åŠ¿"><a href="#Flutter-å¤„ç†æ‰‹åŠ¿" class="headerlink" title="Flutter - å¤„ç†æ‰‹åŠ¿"></a>Flutter - å¤„ç†æ‰‹åŠ¿</h1><p>ç‚¹å‡»ï¼Œæ»‘åŠ¨ç­‰ç­‰æ‰‹åŠ¿ã€‚</p><h2 id="å¤„ç†ç‚¹å‡»"><a href="#å¤„ç†ç‚¹å‡»" class="headerlink" title="å¤„ç†ç‚¹å‡»"></a>å¤„ç†ç‚¹å‡»</h2><h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ul><li>åˆ›å»ºè‡ªå®šä¹‰buttonç±»</li><li>åœ¨å…¶ä¸­ä½¿ç”¨<code>GestureDetector</code>å¹¶å¤å†™<code>onTap</code>å›è°ƒ</li></ul><p>ä»£ç å®ç°<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-comment">/// <span class="language-markdown">è‡ªå®šä¹‰button</span></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ButtonSample1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> GestureDetector(<br>      onTap: () &#123;<br>        <span class="hljs-keyword">final</span> snackBar = SnackBar(content: Text(<span class="hljs-string">&quot;Now you tap the <span class="hljs-subst">$this</span>&quot;</span>),);<br>        Scaffold.of(context).showSnackBar(snackBar);<br>      &#125;,<br>      child: Container(<br>        padding: EdgeInsets.all(<span class="hljs-number">12.0</span>),<br>        margin: EdgeInsets.all(<span class="hljs-number">12.0</span>),<br>        decoration: BoxDecoration(color: Theme<br>            .of(context)<br>            .buttonColor,<br>            borderRadius: BorderRadius.circular(<span class="hljs-number">8.0</span>)),<br>        child: Text(<span class="hljs-string">&quot;<span class="hljs-subst">$this</span>&quot;</span>),),<br>    );<br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></p><p>å‚è€ƒï¼š <a href="https://flutter.io/cookbook/gestures/handling-taps/">https://flutter.io/cookbook/gestures/handling-taps/</a></p><h4 id="å¸¦æ³¢çº¹æ•ˆæœçš„æŒ‰é’®"><a href="#å¸¦æ³¢çº¹æ•ˆæœçš„æŒ‰é’®" class="headerlink" title="å¸¦æ³¢çº¹æ•ˆæœçš„æŒ‰é’®"></a>å¸¦æ³¢çº¹æ•ˆæœçš„æŒ‰é’®</h4><p>ä½¿ç”¨<code>InkWell</code>ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">/// <span class="language-markdown">å¸¦æœ‰æ³¢çº¹æ•ˆæœçš„æŒ‰é’®</span></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ButtonSample2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> InkWell(<br>      onTap: () &#123;<br>        <span class="hljs-keyword">final</span> snackBar = SnackBar(content: Text(<span class="hljs-string">&quot;Now you tap the <span class="hljs-subst">$this</span>&quot;</span>),);<br>        Scaffold.of(context).showSnackBar(snackBar);<br>      &#125;,<br>      child: Container(<br>        padding: EdgeInsets.all(<span class="hljs-number">12.0</span>),<br>        child: Text(<span class="hljs-string">&quot;<span class="hljs-subst">$this</span>&quot;</span>),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>Flutteræä¾›çš„æŒ‰é’®æ§ä»¶è¿˜æœ‰<code>RaisedButton</code>å’Œ<code>FlatButton</code>ã€‚</p><h2 id="åˆ—è¡¨ä¾§æ»‘åˆ é™¤"><a href="#åˆ—è¡¨ä¾§æ»‘åˆ é™¤" class="headerlink" title="åˆ—è¡¨ä¾§æ»‘åˆ é™¤"></a>åˆ—è¡¨ä¾§æ»‘åˆ é™¤</h2><p>æ­¥éª¤ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªåˆ—è¡¨</li><li>ç”¨<code>Dismissible</code>åŒ…è£…æ¯ä¸€ä¸ªitem</li><li>æä¾›åˆ é™¤æ—¶çš„UIæ˜¾ç¤º</li></ul><h3 id="åˆ›å»ºåˆ—è¡¨"><a href="#åˆ›å»ºåˆ—è¡¨" class="headerlink" title="åˆ›å»ºåˆ—è¡¨"></a>åˆ›å»ºåˆ—è¡¨</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">final</span> items = <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt;.generate(<span class="hljs-number">10</span>, (i) =&gt; <span class="hljs-string">&quot;Item <span class="hljs-subst">$i</span>&quot;</span>);<br></code></pre></td></tr></table></figure><p>åˆ›å»ºå­—ç¬¦ä¸²åˆ—è¡¨ã€‚è¿™ä¸ªåˆ—è¡¨ä¸èƒ½æ”¾åœ¨<code>build</code>ä¸­ï¼Œè¦å®šä¹‰ä¸ºStateçš„å…¨å±€å˜é‡ã€‚<br>å¦åˆ™åˆ é™¤itemæ—¶ï¼Œæ— æ³•ä»view treeä¸­ç§»é™¤itemï¼Œä»è€ŒæŠ¥é”™ã€‚</p><h3 id="åˆ é™¤æ—¶çš„UI"><a href="#åˆ é™¤æ—¶çš„UI" class="headerlink" title="åˆ é™¤æ—¶çš„UI"></a>åˆ é™¤æ—¶çš„UI</h3><p>è®¾ç½®<code>Dismissible</code>çš„backgroundï¼Œå¯ä»¥åœ¨åˆ é™¤æ—¶æ˜¾ç¤ºã€‚</p><p>ç¤ºä¾‹ç•Œé¢ä»£ç <br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-comment">/// <span class="language-markdown">ä¾§æ»‘åˆ é™¤åˆ—è¡¨ç•Œé¢</span></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwipeToDismissPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  SwipeToDismissPage(&#123;Key key&#125;) : <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() &#123;<br>    <span class="hljs-keyword">return</span> SwipeState();<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SwipeState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">SwipeToDismissPage</span>&gt; </span>&#123;<br>  <span class="hljs-keyword">final</span> items = <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt;.generate(<span class="hljs-number">10</span>, (i) =&gt; <span class="hljs-string">&quot;Item <span class="hljs-subst">$i</span>&quot;</span>); <span class="hljs-comment">// åˆ—è¡¨å¿…é¡»æ”¾åœ¨å¤–é¢å®šä¹‰</span><br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(<br>      appBar: AppBar(<br>        title: Text(<br>          <span class="hljs-string">&quot;Swipe to dismiss&quot;</span>,<br>        ),<br>      ),<br>      body: ListView.builder(<br>          itemCount: items.length,<br>          itemBuilder: (context, index) &#123;<br>            <span class="hljs-keyword">final</span> item = items[index];<br>            <span class="hljs-keyword">return</span> Dismissible(<br>              key: Key(item),<br>              onDismissed: (direction) &#123;<br>                setState(() &#123;<br>                  items.removeAt(index);<br>                  <span class="hljs-built_in">print</span>(direction);<br>                &#125;);<br>                Scaffold.of(context)<br>                    .showSnackBar(SnackBar(content: Text(<span class="hljs-string">&#x27;remove <span class="hljs-subst">$item</span>&#x27;</span>)));<br>              &#125;,<br>              child: ListTile(<br>                title: Text(<span class="hljs-string">&#x27;<span class="hljs-subst">$item</span>&#x27;</span>),<br>              ),<br>              background: Container(<br>                color: Colors.red,<br>              ),<br>            );<br>          &#125;),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><h2 id="é€‰æ‹©GestureDetectorçš„å“åº”å½¢å¼"><a href="#é€‰æ‹©GestureDetectorçš„å“åº”å½¢å¼" class="headerlink" title="é€‰æ‹©GestureDetectorçš„å“åº”å½¢å¼"></a>é€‰æ‹©GestureDetectorçš„å“åº”å½¢å¼</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">behavior: HitTestBehavior.opaque<br></code></pre></td></tr></table></figure><p><a href="https://docs.flutter.io/flutter/rendering/HitTestBehavior-class.html">https://docs.flutter.io/flutter/rendering/HitTestBehavior-class.html</a></p>]]></content>
    
    
    <categories>
      
      <category>Flutter_note</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Flutter - é¡µé¢é—´è·³è½¬æ“ä½œ</title>
    <link href="/2018/09/05/Flutter/Flutter-Navigator_demo1/"/>
    <url>/2018/09/05/Flutter/Flutter-Navigator_demo1/</url>
    
    <content type="html"><![CDATA[<h2 id="åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°çš„ç•Œé¢å¹¶ä¸”èƒ½è·³å›æ¥"><a href="#åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°çš„ç•Œé¢å¹¶ä¸”èƒ½è·³å›æ¥" class="headerlink" title="åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°çš„ç•Œé¢å¹¶ä¸”èƒ½è·³å›æ¥"></a>åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°çš„ç•Œé¢å¹¶ä¸”èƒ½è·³å›æ¥</h2><p>å¤§å¤šæ•°Appéƒ½åŒ…å«å¤šä¸ªç•Œé¢ã€‚æ¯”å¦‚æ•°æ®åˆ—è¡¨é¡µå’Œè¯¦ç»†é¡µã€‚<br>Androidä¸­çš„é¡µé¢å¯ä»¥æ˜¯Activityï¼›iOSä¸­ä½¿ç”¨ViewControllerã€‚åœ¨Flutterä¸­ï¼Œé¡µé¢ä¹Ÿæ˜¯<code>widget</code>ã€‚<br>ä½¿ç”¨<code>Navigator</code>æ¥åˆ‡æ¢é¡µé¢ã€‚</p><p>æ­¥éª¤ï¼š</p><ul><li>1.åˆ›å»º2ä¸ªé¡µé¢</li><li>2.ç”¨<code>Navigator.push</code>è·³å»ç¬¬äºŒä¸ªé¡µé¢</li><li>3.ç”¨<code>Navigator.pop</code>å›åˆ°ç¬¬ä¸€ä¸ªé¡µé¢</li></ul><p>pushå’Œpopå¾ˆå®¹æ˜“è®©äººè”æƒ³åˆ°æ ˆã€‚Androidä¸­æœ‰ActivityStackï¼Œç”¨æ¥å­˜æ”¾Activityã€‚å½“å‰çš„Activityå°±åœ¨æ ˆé¡¶ã€‚</p><h3 id="1-åˆ›å»º2ä¸ªé¡µé¢"><a href="#1-åˆ›å»º2ä¸ªé¡µé¢" class="headerlink" title="1.åˆ›å»º2ä¸ªé¡µé¢"></a>1.åˆ›å»º2ä¸ªé¡µé¢</h3><p>åˆ›å»º2ä¸ªç®€å•çš„ç•Œé¢ï¼Œç•Œé¢ä¸­åªæœ‰ä¸€ä¸ªæŒ‰é’®ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FirstScreen</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(appBar: AppBar(title: Text(<span class="hljs-string">&#x27;First page&#x27;</span>),),<br>      body: Center(child: RaisedButton(<br>          child: Text(<span class="hljs-string">&#x27;Go to 2nd page&#x27;</span>),<br>          onPressed: () &#123;<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;This is first page&#x27;</span>);<br>            <span class="hljs-comment">// æ‰§è¡Œæƒ³è¦çš„æ“ä½œ..........</span><br>          &#125;),),);<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecondScreen</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;<span class="hljs-subst">$&#123;<span class="hljs-keyword">this</span>&#125;</span> hashCode=<span class="hljs-subst">$&#123;<span class="hljs-keyword">this</span>.hashCode&#125;</span>&#x27;</span>);<br>    <span class="hljs-keyword">return</span> Scaffold(appBar: AppBar(title: Text(<span class="hljs-string">&#x27;Second page&#x27;</span>),),<br>      body: Center(child: RaisedButton(<br>          child: Text(<span class="hljs-string">&quot;Go back&quot;</span>),<br>          onPressed: () &#123;<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;This is 2nd page&#x27;</span>);<br>            <span class="hljs-comment">// æ‰§è¡Œæ“ä½œ........</span><br>          &#125;),),);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="2-ç”¨Navigator-pushè·³è½¬å»ç¬¬äºŒä¸ªç•Œé¢"><a href="#2-ç”¨Navigator-pushè·³è½¬å»ç¬¬äºŒä¸ªç•Œé¢" class="headerlink" title="2.ç”¨Navigator.pushè·³è½¬å»ç¬¬äºŒä¸ªç•Œé¢"></a>2.ç”¨<code>Navigator.push</code>è·³è½¬å»ç¬¬äºŒä¸ªç•Œé¢</h3><p><code>push</code>æ–¹æ³•ä¼šå‘æ ˆä¸­æ·»åŠ ä¸€ä¸ªç”±Navigatorç®¡ç†çš„<code>Route</code>ã€‚<br><code>push</code>æ–¹æ³•æ¥å—ä¸€ä¸ª<code>Route</code>ï¼ˆæš‚ç§°ä¸ºè·¯ç”±ï¼‰ï¼Œè¿™é‡Œæ–°å»ºä¸€ä¸ª<code>Route</code>ï¼Œä½¿ç”¨ç”¨<code>MaterialPageRoute</code>ã€‚</p><p>åœ¨ç¬¬ä¸€ä¸ªé¡µé¢ä¸­æŒ‰é’®æ·»åŠ å›è°ƒçš„æ“ä½œ<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart">onPressed: () &#123;<br>Navigator.push(context,<br>    MaterialPageRoute(builder: (context) =&gt; SecondScreen()));<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="3-ç”¨Navigator-popå›åˆ°ç¬¬ä¸€ä¸ªç•Œé¢"><a href="#3-ç”¨Navigator-popå›åˆ°ç¬¬ä¸€ä¸ªç•Œé¢" class="headerlink" title="3.ç”¨Navigator.popå›åˆ°ç¬¬ä¸€ä¸ªç•Œé¢"></a>3.ç”¨<code>Navigator.pop</code>å›åˆ°ç¬¬ä¸€ä¸ªç•Œé¢</h3><p><code>Navigator.pop</code>ä¼šç§»é™¤navigatorç®¡ç†çš„å½“å‰çš„è·¯ç”±ï¼ˆæ•ˆæœæ˜¯ç§»é™¤å½“å‰ç•Œé¢ï¼‰ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-comment">// ç¬¬äºŒä¸ªé¡µé¢ä¸­</span><br>onPressed: () &#123;<br>  Navigator.pop(context);<br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(<span class="hljs-keyword">new</span> MaterialApp(<br>    title: <span class="hljs-string">&#x27;navigate demo&#x27;</span>,<br>    home: <span class="hljs-keyword">new</span> FirstScreen(),));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FirstScreen</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Scaffold(appBar: AppBar(title: Text(<span class="hljs-string">&#x27;First page&#x27;</span>),),<br>      body: Center(child: RaisedButton(<br>          child: Text(<span class="hljs-string">&#x27;Go to 2nd page&#x27;</span>),<br>          onPressed: () &#123;<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;This is first page&#x27;</span>);<br>            Navigator.push(context,<br>                MaterialPageRoute(builder: (context) =&gt; SecondScreen()));<br>          &#125;),),);<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SecondScreen</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;<span class="hljs-subst">$&#123;<span class="hljs-keyword">this</span>&#125;</span> hashCode=<span class="hljs-subst">$&#123;<span class="hljs-keyword">this</span>.hashCode&#125;</span>&#x27;</span>);<br>    <span class="hljs-keyword">return</span> Scaffold(appBar: AppBar(title: Text(<span class="hljs-string">&#x27;Second page&#x27;</span>),),<br>      body: Center(child: RaisedButton(<br>          child: Text(<span class="hljs-string">&quot;Go back&quot;</span>),<br>          onPressed: () &#123;<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;This is 2nd page&#x27;</span>);<br>            Navigator.pop(context);<br>          &#125;),),);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç è¯·å‚é˜…ï¼š <a href="https://github.com/RustFisher/flutter_basic">https://github.com/RustFisher/flutter_basic</a></p>]]></content>
    
    
    <categories>
      
      <category>Flutter_note</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ã€ŒLearnã€å¼€å‘è®°å½•</title>
    <link href="/2018/09/01/Dev-note/dev-note-app-learn/"/>
    <url>/2018/09/01/Dev-note/dev-note-app-learn/</url>
    
    <content type="html"><![CDATA[<p>å¼€å‘Appè¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œè§£å†³åŠæ³•ã€‚ä¸´æ—¶è®°å½•ä¸€äº›è§£å†³æ–¹æ¡ˆã€‚</p><h2 id="éŸ³é¢‘"><a href="#éŸ³é¢‘" class="headerlink" title="éŸ³é¢‘"></a>éŸ³é¢‘</h2><p><a href="https://rustfisher.com/2019/09/19/Android/Android-MediaPlayer_intro/">Android MediaPlayeråŸºç¡€ã€‚</a><br><a href="https://rustfisher.com/2019/09/22/Android/Android-MediaPlayer_use_play_audio/">åœ¨çº¿éŸ³é¢‘æ’­æ”¾ï¼Œä½¿ç”¨MediaPlayerã€‚</a><br><a href="https://rustfisher.com/2019/09/23/Android/Android-Media_download_stream_file/">ä¸‹è½½åœ¨çº¿éŸ³é¢‘åˆ°æœ¬åœ°ï¼Œä½¿ç”¨URLConnectionã€‚</a></p><h2 id="è‡ªå®šä¹‰ViewGroup"><a href="#è‡ªå®šä¹‰ViewGroup" class="headerlink" title="è‡ªå®šä¹‰ViewGroup"></a>è‡ªå®šä¹‰ViewGroup</h2><p>ç»§æ‰¿è‡ªLinearLayoutï¼Œè‡ªå®šä¹‰å­Viewçš„æ’å¸ƒæ–¹å¼ã€‚</p><h3 id="crash-ViewGroup-resetResolvedLayoutDirection"><a href="#crash-ViewGroup-resetResolvedLayoutDirection" class="headerlink" title="crash ViewGroup.resetResolvedLayoutDirection"></a>crash ViewGroup.resetResolvedLayoutDirection</h3><p>ç»™LinearLayout addViewçš„æ—¶å€™æŠ¥é”™<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">E/AndroidRuntime:     at android<span class="hljs-selector-class">.view</span><span class="hljs-selector-class">.ViewGroup</span><span class="hljs-selector-class">.resetResolvedLayoutDirection</span>(ViewGroup<span class="hljs-selector-class">.java</span>:<span class="hljs-number">7291</span>)<br>    at android<span class="hljs-selector-class">.view</span><span class="hljs-selector-class">.ViewGroup</span><span class="hljs-selector-class">.resetResolvedLayoutDirection</span>(ViewGroup<span class="hljs-selector-class">.java</span>:<span class="hljs-number">7291</span>)<br></code></pre></td></tr></table></figure></p><p>æ£€æŸ¥ä»£ç ï¼Œå‘ç°addViewçš„æ—¶å€™æŠŠLinearLayoutè‡ªå·±æ·»åŠ è¿›å»äº†ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">LinearLayout</span> <span class="hljs-variable">wordCube</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearLayout</span>(<span class="hljs-built_in">this</span>);<br>wordCube.addView(wordCube, chTvParams);<br></code></pre></td></tr></table></figure></p><p>æ”¹æˆ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">LinearLayout</span> <span class="hljs-variable">wordCube</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearLayout</span>(<span class="hljs-built_in">this</span>);<br>wordCube.addView(tv, chTvParams); <span class="hljs-comment">// è¦åŠ çš„æ˜¯tv</span><br></code></pre></td></tr></table></figure></p><h2 id="Buglyçƒ­æ›´æ–°"><a href="#Buglyçƒ­æ›´æ–°" class="headerlink" title="Buglyçƒ­æ›´æ–°"></a>Buglyçƒ­æ›´æ–°</h2><p>Buglyçƒ­æ›´æ–°æ–¹æ¡ˆé›†æˆäº†è…¾è®¯çš„tinkerï¼Œè‡ªå¸¦äº†è¡¥ä¸åŒ…å‘å¸ƒå¹³å°ã€‚</p><p>æ–‡æ¡£</p><p><a href="https://bugly.qq.com/docs/user-guide/instruction-manual-android-hotfix/?v=20181014122344#_3">https://bugly.qq.com/docs/user-guide/instruction-manual-android-hotfix/?v=20181014122344#_3</a></p><p>tinkerä¸æ”¯æŒçƒ­æ›´æ–°æ–°å¢å››å¤§ç»„ä»¶ï¼Œä¸èƒ½ä¿®æ”¹Manifestæ–‡ä»¶ã€‚ä½†æ˜¯å¯ä»¥ä¿®æ”¹å››å¤§ç»„ä»¶é‡Œé¢çš„é€»è¾‘ã€‚<br>å¯ä»¥ä¿®æ”¹layoutæ–‡ä»¶å’Œèµ„æºæ–‡ä»¶ã€‚</p><h2 id="Assetséå†æ–‡ä»¶"><a href="#Assetséå†æ–‡ä»¶" class="headerlink" title="Assetséå†æ–‡ä»¶"></a>Assetséå†æ–‡ä»¶</h2><p>assetsé‡Œå­˜æ”¾ç€å››åƒå¤šä¸ªæ–‡ä»¶ï¼Œçº¢ç±³6Aéå†ä¸€æ¬¡è¦2ç§’å¤šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">String[] list = context.getAssets().list(<span class="hljs-string">&quot;folder&quot;</span>); <span class="hljs-comment">// æ‰§è¡Œè¿™ä¸€å¥è¦ä¸¤åƒå¤šæ¯«ç§’</span><br></code></pre></td></tr></table></figure><h2 id="è¯­éŸ³è¯†åˆ«æ–¹æ¡ˆ"><a href="#è¯­éŸ³è¯†åˆ«æ–¹æ¡ˆ" class="headerlink" title="è¯­éŸ³è¯†åˆ«æ–¹æ¡ˆ"></a>è¯­éŸ³è¯†åˆ«æ–¹æ¡ˆ</h2><p>ä¸»åŠ›æ–¹æ¡ˆä¸ºç™¾åº¦è¯­éŸ³è¯†åˆ«ã€‚</p><p>ç»¼åˆä»·æ ¼è€ƒè™‘ï¼Œå°†ç§‘å¤§è®¯é£çš„<a href="https://www.xfyun.cn/services/voicedictation">è¯­éŸ³å¬å†™</a>ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆã€‚</p><p>å°†ç™¾åº¦è¯­éŸ³è¯†åˆ«ä¸è®¯é£å¬å†™çš„SDKä¸€èµ·å¼•å…¥åˆ°Appä¸­ã€‚ç”±åå°æ§åˆ¶ç”¨æˆ·ä½¿ç”¨å“ªä¸€ä¸ªè¯­éŸ³å¼•æ“ã€‚</p><h2 id="ä¸‹è½½æ–‡ä»¶"><a href="#ä¸‹è½½æ–‡ä»¶" class="headerlink" title="ä¸‹è½½æ–‡ä»¶"></a>ä¸‹è½½æ–‡ä»¶</h2><p>é¡¹ç›®é‡‡ç”¨çš„æ˜¯mvvmæ¶æ„ã€‚æœ‰2ä¸ªé¡µé¢è¦ç”¨åˆ°åŒä¸€ä¸ªæ•°æ®æºã€‚æŠŠè¿™ä¸ªæ•°æ®æºå•ç‹¬æŠ½å‡ºæ¥ï¼Œè®¾è®¡ç›‘å¬å™¨ã€‚</p><p>åŸæ¡†æ¶çš„ä¸‹è½½æ–‡ä»¶åŠŸèƒ½æœ‰ä¸€ä¸ªbugã€‚å¦‚æœä¸‹è½½æ—¶æŠ›å‡ºäº†å¼‚å¸¸ï¼Œä¹Ÿä¼šè°ƒç”¨successå›è°ƒã€‚<br>è¿™é‡Œæ˜¯åœ¨ä¸‹è½½æ—¶è®°å½•ç›®æ ‡æ–‡ä»¶çš„é•¿åº¦ï¼Œåœ¨successå›è°ƒä¸­æ£€æŸ¥æœ¬åœ°æ–‡ä»¶å¤§å°ä¸è¿™ä¸ªé•¿åº¦æ˜¯å¦ä¸€è‡´ã€‚</p><h2 id="é™é€Ÿä¸‹è½½"><a href="#é™é€Ÿä¸‹è½½" class="headerlink" title="é™é€Ÿä¸‹è½½"></a>é™é€Ÿä¸‹è½½</h2><p>åœ¨ioæµé‚£é‡Œè¿›è¡Œå»¶æ—¶æ“ä½œã€‚ç”¨Thread.sleepæ–¹æ³•ã€‚<br>é˜»å¡çš„æ˜¯socketçš„æ“ä½œã€‚</p><h2 id="ä¸‹è½½å®‰è£…apk"><a href="#ä¸‹è½½å®‰è£…apk" class="headerlink" title="ä¸‹è½½å®‰è£…apk"></a>ä¸‹è½½å®‰è£…apk</h2><p>ä¸‹è½½äº†æ–°ç‰ˆæœ¬apkåï¼Œè°ƒç”¨ä»£ç è¿›è¡Œå®‰è£…ã€‚æ ¹æ®æ‰‹æœºç³»ç»Ÿç‰ˆæœ¬çš„ä¸åŒé€‰æ‹©ä¸åŒçš„å®‰è£…æ–¹å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">installApk</span><span class="hljs-params">(Context context,String downloadApk)</span> &#123;<br>    <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(Intent.ACTION_VIEW);<br>    <span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(downloadApk);<br>    <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;<br>        <span class="hljs-type">Uri</span> <span class="hljs-variable">apkUri</span> <span class="hljs-operator">=</span> FileProvider.getUriForFile(context, <span class="hljs-string">&quot;com.iNTGO.nndc.fileprovider&quot;</span>, file);<br>        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);<br>        intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION|<br>                        Intent.FLAG_GRANT_WRITE_URI_PERMISSION);<br>        intent.setDataAndType(apkUri, <span class="hljs-string">&quot;application/vnd.android.package-archive&quot;</span>);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-type">Uri</span> <span class="hljs-variable">uri</span> <span class="hljs-operator">=</span> Uri.fromFile(file);<br>        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);<br>        intent.setDataAndType(uri, <span class="hljs-string">&quot;application/vnd.android.package-archive&quot;</span>);<br>    &#125;<br>    context.startActivity(intent);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹äºå°ç±³4c android 5.1.1ï¼ˆAPI 22ï¼‰ï¼Œå¦‚æœæŠŠapkæ”¾åœ¨appå†…éƒ¨å­˜å‚¨ï¼ŒpackageInstalleræ˜¯æ— æ³•å®‰è£…çš„ã€‚è¦æŠŠapkæ”¾åœ¨å…¬å…±å­˜å‚¨ä¸­æ‰èƒ½å®‰è£…ã€‚</p><h2 id="ä¿®æ”¹Androidç³»ç»Ÿé•œåƒï¼ˆimgï¼‰"><a href="#ä¿®æ”¹Androidç³»ç»Ÿé•œåƒï¼ˆimgï¼‰" class="headerlink" title="ä¿®æ”¹Androidç³»ç»Ÿé•œåƒï¼ˆimgï¼‰"></a>ä¿®æ”¹Androidç³»ç»Ÿé•œåƒï¼ˆimgï¼‰</h2><p>è£…ä¸€ä¸ªVMware Workstation Proï¼Œä¸‹è½½ä¸€ä¸ªUbuntu 16çš„é•œåƒï¼ˆisoï¼‰ã€‚ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„èµ„æºï¼Œæ¯”è¾ƒå¿«ã€‚<br>ä¸€ç³»åˆ—çš„mountï¼Œæ‰“åŒ…åï¼Œåˆ·æœºä¸€ç›´ä¸æˆåŠŸã€‚æ‰¾åˆ°ä¸ªROMåŠ©æ‰‹ï¼Œå°è¯•ä¸€ä¸‹ã€‚ä¿®æ”¹äº†system.imgåï¼Œçº¿åˆ·è¿›å»ï¼Œå¡ç±³ï¼ˆå¡åœ¨å¼€æœºçš„MI logoç•Œé¢ï¼‰ã€‚<br>æŸ¥ä¸€ä¸‹å‘ç°ï¼Œæ˜¯selinuxå¤„äºenforcingçŠ¶æ€ï¼Œæ²¡æ³•è£…ã€‚å°ç±³4cç”¨çš„æ˜¯MIUI8ï¼Œå•†å®¶è¯´æ²¡æ³•rootã€‚MiUI7å¯ä»¥rootã€‚<br>è¿˜æ²¡æ‰¾åˆ°érootæƒ…å†µä¸‹å…³é—­selinuxçš„æ–¹æ³•ã€‚</p><h2 id="åŠ¨ç”»æ•ˆæœ"><a href="#åŠ¨ç”»æ•ˆæœ" class="headerlink" title="åŠ¨ç”»æ•ˆæœ"></a>åŠ¨ç”»æ•ˆæœ</h2><p>åŠ ä¸€äº›åŠ¨æ•ˆä¼šè®©ç•Œé¢æ›´åŠ ç”ŸåŠ¨æœ‰æ´»åŠ›ã€‚</p><h3 id="å±æ€§åŠ¨ç”»-æ˜Ÿæ˜Ÿé£è¡Œ"><a href="#å±æ€§åŠ¨ç”»-æ˜Ÿæ˜Ÿé£è¡Œ" class="headerlink" title="å±æ€§åŠ¨ç”» - æ˜Ÿæ˜Ÿé£è¡Œ"></a>å±æ€§åŠ¨ç”» - æ˜Ÿæ˜Ÿé£è¡Œ</h3><p>æ§åˆ¶æ˜Ÿæ˜Ÿé£å…¥ï¼Œå®šä½ï¼Œé£å‡ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java">        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">flyInTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">stayTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">520</span>;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">flyOutTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">250</span>;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">totalTime</span> <span class="hljs-operator">=</span> flyInTime + stayTime + flyOutTime;<br>        binding.starIv.setX(inX);<br>        binding.starIv.setY(yStay);<br>        binding.starIv.setVisibility(View.VISIBLE);<br>        setStarIvSize(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">ValueAnimator</span> <span class="hljs-variable">animator</span> <span class="hljs-operator">=</span> ValueAnimator.ofInt(<span class="hljs-number">1</span>, totalTime);<br>        animator.setDuration(totalTime);<br>        animator.setInterpolator(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AccelerateInterpolator</span>());<br>        animator.addUpdateListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueAnimator</span>.AnimatorUpdateListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onAnimationUpdate</span><span class="hljs-params">(ValueAnimator valueAnimator)</span> &#123;<br>                <span class="hljs-type">int</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) valueAnimator.getAnimatedValue();<br>                <span class="hljs-type">ImageView</span> <span class="hljs-variable">starIv</span> <span class="hljs-operator">=</span> binding.starIv;<br>                <span class="hljs-keyword">if</span> (value &lt; flyInTime) &#123;<br>                    <span class="hljs-type">float</span> <span class="hljs-variable">inProgress</span> <span class="hljs-operator">=</span> value / (<span class="hljs-number">1.0f</span> * flyInTime);<br>                    <span class="hljs-type">float</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> inProgress * (xStay - inX) + inX;<br>                    <span class="hljs-type">float</span> y;<br>                    <span class="hljs-keyword">if</span> (value &lt; flyInTime / <span class="hljs-number">2</span>) &#123;<br>                        y = yStay + <span class="hljs-number">20</span> - inProgress * <span class="hljs-number">60</span>;<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        y = yStay - <span class="hljs-number">20</span> + inProgress * <span class="hljs-number">60</span>;<br>                    &#125;<br>                    starIv.setX(x);<br>                    starIv.setY(y);<br>                    setStarIvSize((<span class="hljs-type">int</span>) (mStarIvOriginWid * (inProgress)), (<span class="hljs-type">int</span>) (mStarIvOriginHeight * (inProgress)));<br><span class="hljs-comment">//                    Log.d(TAG, &quot;onAnimationUpdate: value: &quot; + value + &quot;, progress: &quot; + inProgress + &quot;, x: &quot; + x);</span><br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value &lt; flyInTime + stayTime) &#123;<br>                    starIv.setX(xStay);<br>                    starIv.setY(yStay);<br>                    setStarIvSize(mStarIvOriginWid, mStarIvOriginHeight);<br>                &#125; <span class="hljs-keyword">else</span> &#123;<br>                    <span class="hljs-keyword">if</span> (valueAnimator.isRunning()) &#123;<br>                        <span class="hljs-type">float</span> <span class="hljs-variable">progress</span> <span class="hljs-operator">=</span> (value - flyInTime - stayTime) / (<span class="hljs-number">1.0f</span> * flyOutTime);<br>                        starIv.setX(xStay + (progress * Math.abs(endX - xStay)));<br>                        starIv.setY(yStay - (progress * Math.abs(endY - yStay)));<br>                        setStarIvSize((<span class="hljs-type">int</span>) (mStarIvOriginWid * (<span class="hljs-number">1</span> - progress)), (<span class="hljs-type">int</span>) (mStarIvOriginHeight * (<span class="hljs-number">1</span> - progress)));<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (value &gt;= totalTime - <span class="hljs-number">10</span>) &#123;<br>                    binding.starIv.setVisibility(View.GONE);<br>                &#125;<br>            &#125;<br>        &#125;);<br>        animator.start();<br><br>    <span class="hljs-comment">// æ”¹å˜æ˜Ÿæ˜ŸImageViewçš„å¤§å°ï¼ŒLayoutParamsä¸èƒ½å¼„é”™äº†</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStarIvSize</span><span class="hljs-params">(<span class="hljs-type">int</span> wid, <span class="hljs-type">int</span> height)</span> &#123;<br>        RelativeLayout.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">lp</span> <span class="hljs-operator">=</span> (RelativeLayout.LayoutParams) binding.starIv.getLayoutParams();<br>        lp.width = wid;<br>        lp.height = height;<br>        binding.starIv.setLayoutParams(lp);<br>    &#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸€ä¸ªViewåœ¨LinearLayouté‡Œï¼Œå®ƒçš„åæ ‡æ²¡æœ‰é‚£ä¹ˆå®¹æ˜“è·å–ã€‚</p><p>ä¸‹é¢çš„ä»£ç è·å–åˆ°çš„åæ ‡æ˜¯[0,0]ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">imageView.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">int</span>[] location = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">2</span>];<br>        imageView.getLocationOnScreen(location);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure></p><p><a href="https://developer.android.google.cn/training/transitions/custom-transitions">åˆ›å»ºè‡ªå®šä¹‰è¿‡æ¸¡åŠ¨ç”» - Google</a><br><a href="https://developer.android.google.cn/training/animation/layout.html">è‡ªåŠ¨ä¸ºå¸ƒå±€æ›´æ–°æ·»åŠ åŠ¨ç”» - Google</a></p><h2 id="é€€å‡ºApp"><a href="#é€€å‡ºApp" class="headerlink" title="é€€å‡ºApp"></a>é€€å‡ºApp</h2><p>åœ¨ç™»å½•ç•Œé¢ï¼Œç‚¹å‡»è¿”å›é”®å³é€€å‡ºæ•´ä¸ªAppã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">mExitApp</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBackPressed</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onBackPressed();<br>        mExitApp = <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onDestroy();<br>        <span class="hljs-keyword">if</span> (mExitApp) &#123;<br>            System.exit(<span class="hljs-number">0</span>);<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="crash"><a href="#crash" class="headerlink" title="crash"></a>crash</h2><p>ä¸ºäº†æé«˜ç¨‹åºçš„å¥å£®æ€§ï¼Œå¾ˆå¤šæ—¶å€™å¹¶ä¸èƒ½è¿‡äºç›¸ä¿¡æœåŠ¡å™¨è¿”å›çš„ç»“æœã€‚è¯¥åŠ åˆ¤ç©ºå°±åˆ¤ç©ºã€‚<br>å¦‚æœæœåŠ¡å™¨è¿”å›ç©ºçš„æ•°æ®æˆ–è€…å­—æ®µï¼Œè¦æœ‰å¯¹åº”çš„æªæ–½ã€‚</p><h3 id="gcè¶…æ—¶"><a href="#gcè¶…æ—¶" class="headerlink" title="gcè¶…æ—¶"></a>gcè¶…æ—¶</h3><p>è¯¥å¼‚å¸¸è¡¨ç¤ºè°ƒç”¨è¶…æ—¶ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼šä¸€èˆ¬æ˜¯ç³»ç»Ÿåœ¨gcæ—¶ï¼Œè°ƒç”¨å¯¹è±¡çš„finalizeè¶…æ—¶å¯¼è‡´</p><p>è§£å†³åŠæ³•ï¼š<br>1.æ£€æŸ¥åˆ†æfinalizeçš„å®ç°ä¸ºä»€ä¹ˆè€—æ—¶è¾ƒé«˜ï¼Œä¿®å¤å®ƒï¼›<br>2.æ£€æŸ¥æ—¥å¿—æŸ¥çœ‹GCæ˜¯å¦è¿‡äºé¢‘ç¹ï¼Œå¯¼è‡´è¶…æ—¶ï¼Œå‡å°‘å†…å®¹å¼€é”€ï¼Œé˜²æ­¢å†…å­˜æ³„éœ²ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs stylus">android<span class="hljs-selector-class">.content</span><span class="hljs-selector-class">.res</span>.XmlBlock<span class="hljs-variable">$Parser</span><span class="hljs-selector-class">.finalize</span>() timed out after <span class="hljs-number">10</span> seconds<br><br>android<span class="hljs-selector-class">.content</span><span class="hljs-selector-class">.res</span><span class="hljs-selector-class">.AssetManager</span><span class="hljs-selector-class">.xmlBlockGone</span>(AssetManager<span class="hljs-selector-class">.java</span>:<span class="hljs-number">500</span>)<br><br>android<span class="hljs-selector-class">.content</span><span class="hljs-selector-class">.res</span><span class="hljs-selector-class">.AssetManager</span><span class="hljs-selector-class">.xmlBlockGone</span>(AssetManager<span class="hljs-selector-class">.java</span>:<span class="hljs-number">500</span>)<br>android<span class="hljs-selector-class">.content</span><span class="hljs-selector-class">.res</span><span class="hljs-selector-class">.XmlBlock</span><span class="hljs-selector-class">.decOpenCountLocked</span>(XmlBlock<span class="hljs-selector-class">.java</span>:<span class="hljs-number">63</span>)<br>android<span class="hljs-selector-class">.content</span><span class="hljs-selector-class">.res</span><span class="hljs-selector-class">.XmlBlock</span>.access$<span class="hljs-number">1600</span>(XmlBlock<span class="hljs-selector-class">.java</span>:<span class="hljs-number">34</span>)<br>android<span class="hljs-selector-class">.content</span><span class="hljs-selector-class">.res</span>.XmlBlock<span class="hljs-variable">$Parser</span><span class="hljs-selector-class">.close</span>(XmlBlock<span class="hljs-selector-class">.java</span>:<span class="hljs-number">448</span>)<br>android<span class="hljs-selector-class">.content</span><span class="hljs-selector-class">.res</span>.XmlBlock<span class="hljs-variable">$Parser</span><span class="hljs-selector-class">.finalize</span>(XmlBlock<span class="hljs-selector-class">.java</span>:<span class="hljs-number">454</span>)<br>java<span class="hljs-selector-class">.lang</span>.Daemons<span class="hljs-variable">$FinalizerDaemon</span><span class="hljs-selector-class">.doFinalize</span>(Daemons<span class="hljs-selector-class">.java</span>:<span class="hljs-number">191</span>)<br>java<span class="hljs-selector-class">.lang</span>.Daemons<span class="hljs-variable">$FinalizerDaemon</span><span class="hljs-selector-class">.run</span>(Daemons<span class="hljs-selector-class">.java</span>:<span class="hljs-number">174</span>)<br>java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.Thread</span><span class="hljs-selector-class">.run</span>(Thread<span class="hljs-selector-class">.java</span>:<span class="hljs-number">818</span>)<br></code></pre></td></tr></table></figure><h3 id="RuntimeException-Cannot-create-an-instance-of-class"><a href="#RuntimeException-Cannot-create-an-instance-of-class" class="headerlink" title="RuntimeException: Cannot create an instance of class"></a>RuntimeException: Cannot create an instance of class</h3><p>ä½¿ç”¨äº†MVVMçš„æ¡†æ¶ï¼Œåˆ›å»ºviewModelæ—¶æŠ¥é”™ã€‚æ£€æŸ¥å‘ç°å¿˜è®°å¤å†™æ–¹æ³•<code>initViewModel</code>ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> MyViewModel <span class="hljs-title function_">initViewModel</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">MyAppViewModelFactory</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> MyAppViewModelFactory.getInstance(getApplication());<br>    <span class="hljs-keyword">return</span> ViewModelProviders.of(<span class="hljs-built_in">this</span>, factory).get(MyViewModel.class);<br>&#125;<br></code></pre></td></tr></table></figure></p><h2 id="ANR"><a href="#ANR" class="headerlink" title="ANR"></a>ANR</h2><h3 id="æ­»å¾ªç¯å¯¼è‡´çš„ANR"><a href="#æ­»å¾ªç¯å¯¼è‡´çš„ANR" class="headerlink" title="æ­»å¾ªç¯å¯¼è‡´çš„ANR"></a>æ­»å¾ªç¯å¯¼è‡´çš„ANR</h3><p>ä¹‹å‰ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œæœ‰ä¸€ä¸ªéšæœºæ·»åŠ ä¸é‡å¤å­—ç¬¦ä¸²çš„åŠŸèƒ½ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">while</span> (needCheckList.size() &lt; <span class="hljs-number">3</span>) &#123;<br>    <span class="hljs-type">Random</span> <span class="hljs-variable">rd</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">word</span> <span class="hljs-operator">=</span> wordList.get(rd.nextInt(wordList.size()));<br>    <span class="hljs-keyword">if</span>(!needCheckList.contains(word)) &#123;<br>        needCheckList.add(word);<br>    &#125;<br>    <span class="hljs-comment">// .....</span><br>&#125;<br></code></pre></td></tr></table></figure><br>è¿™æ®µä»£ç çš„æ•ˆç‡ä¸é«˜ã€‚ä¼ªéšæœºæ•°ä¸èƒ½ä¿è¯é«˜æ•ˆåœ°ä¸é‡å¤åœ°å–åˆ°æ–°çš„ä¸‹æ ‡ã€‚<br>åœ¨æŸäº›æ€§èƒ½è¾ƒå·®çš„æ‰‹æœºä¸Šï¼Œé™·å…¥å¤šæ¬¡å¾ªç¯åæœ‰å¯èƒ½å¯¼è‡´anrã€‚ anr message è¡¨æ˜æ­¤æ—¶CPUå ç”¨ç‡è¶…è¿‡100%ã€‚<br>æˆ‘ä»¬ä½¿ç”¨<code>Collections.shuffle(wordList);</code>æ¥ä»£æ›¿ä¼ªéšæœºæ•°ï¼Œä¹Ÿèƒ½å®ç°éšæœºå–å‡ºå­—ç¬¦ä¸²çš„æ•ˆæœã€‚æé«˜å¥å£®æ€§ã€‚</p><h2 id="gradle"><a href="#gradle" class="headerlink" title="gradle"></a>gradle</h2><p>æƒ³åœ¨Terminalé‡Œä½¿ç”¨gradlewå‘½ä»¤ï¼Œè¿˜å¾—å…ˆåœ¨ç”µè„‘ä¸Šå®‰è£…jdkã€‚<br>ç°åœ¨ï¼ˆ2019-11-18ï¼‰æƒ³åœ¨å®˜ç½‘ä¸‹è½½ä¸ªjdkï¼Œè¿˜å¾—ç™»å½•oracleè´¦å·ã€‚ç½‘é€Ÿå¾ˆæ…¢ï¼Œå»åˆ«çš„åœ°æ–¹ä¸‹è½½jdk-8u181-windows-x64ã€‚</p><h3 id="å¤šæ¸ é“è‡ªåŠ¨æ‰“åŒ…"><a href="#å¤šæ¸ é“è‡ªåŠ¨æ‰“åŒ…" class="headerlink" title="å¤šæ¸ é“è‡ªåŠ¨æ‰“åŒ…"></a>å¤šæ¸ é“è‡ªåŠ¨æ‰“åŒ…</h3><p>å‡è®¾æˆ‘ä»¬æœ‰å¾ˆå¤šç§æ¸ é“ï¼Œæ¯ä¸ªæ¸ é“çš„<code>manifestPlaceholders</code>çš„å†…å®¹éƒ½ä¸åŒã€‚<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gradle">productFlavors &#123;<br>    xxx &#123;<br>        manifestPlaceholders = [XX_ID  : <span class="hljs-string">&quot;123&quot;</span>,<br>                                XX_KEY : <span class="hljs-string">&quot;key_key&quot;</span>]<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>ä¹‹å‰æ¸ é“å°‘çš„æ—¶å€™ï¼Œå¯ä»¥ç‚¹å‡»gradle taskä¸€ä¸ªä¸ªæ¥æ‰“åŒ…ã€‚<br>ç°åœ¨æ¸ é“ç§ç±»å¤šäº†ï¼ˆæ¯”å¦‚äºŒåå¤šä¸ªï¼‰ï¼Œå†ä¸€ä¸ªä¸ªç‚¹å‡»å°±å¾ˆç´¯ã€‚æƒ³è¦ä¸€é”®æ‰“åŒ…æˆ–è€…ä¸€è¡Œå‘½ä»¤æ‰“åŒ…ï¼Œæœ‰ä»€ä¹ˆæˆç†Ÿå¥½ç”¨çš„å¤šæ¸ é“æ‰“åŒ…æ–¹å¼å‘¢ï¼Ÿ<br>æˆ‘ä»¬å°è¯•äº†<a href="https://github.com/Meituan-Dianping/walle">ç¾å›¢ç‚¹è¯„çš„walle</a>ï¼Œå·ç§°æ˜¯<code>Android Signature V2 Schemeç­¾åä¸‹çš„æ–°ä¸€ä»£æ¸ é“åŒ…æ‰“åŒ…ç¥å™¨</code>ã€‚<br>è¯•ç€æ¥å…¥walleçš„å§¿åŠ¿å¯èƒ½ä¸å¯¹ï¼Œæ‰“åŒ…ä¸æˆåŠŸã€‚æ­¤æ—¶çœ‹åˆ°æœ‰äººè¯´<a href="https://github.com/Meituan-Dianping/walle/issues/312">ä¸æ”¯æŒå¤šæ¸ é“ä¸åŒçš„åŒ…åå’Œé…ç½®manifestPlaceholders</a>ï¼Œæš‚æ—¶å…ˆä¸ä½¿ç”¨walleã€‚</p><p>å·²ç»ä½¿ç”¨äº†Buglyï¼Œæœ‰å¾ˆå¤šå½¢å¦‚<code>assembleXxxRelease</code>çš„ä»»åŠ¡ã€‚<br>æˆ‘ä»¬å¯ä»¥åœ¨ç»ˆç«¯å‘½ä»¤è¡Œé‡Œæ‰§è¡Œgradlewå‘½ä»¤æ¥æ‰“åŒ…ã€‚<br>Windowsç¯å¢ƒä¸‹å°±æ˜¯<br><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bat">gradlew assembleXxxRelease<br></code></pre></td></tr></table></figure></p><p>é‚£ä¹ˆå†™ä¸€ä¸ªbatè„šæœ¬ï¼ŒæŠŠè¿™å‡ åä¸ªæ¸ é“åŒ…æŒ‰é¡ºåºä¸€ä¸ªä¸ªæ‰“åŒ…å‡ºæ¥ã€‚<br><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bat">gradlew assembleXxxRelease &amp;&amp; gradlew assembleYyyRelease &amp;&amp; gradlew assembleZzzRelease<br></code></pre></td></tr></table></figure><br>è¿™ä¸ªæ–¹æ³•éå¸¸â€œæš´åŠ›â€ï¼Œä»…ä»…æ˜¯æ›¿ä»£äº†æ‰‹åŠ¨æ‰§è¡Œçš„è¿‡ç¨‹ã€‚</p><h2 id="æ¡†æ¶"><a href="#æ¡†æ¶" class="headerlink" title="æ¡†æ¶"></a>æ¡†æ¶</h2><h3 id="BindingCommand-é—®é¢˜"><a href="#BindingCommand-é—®é¢˜" class="headerlink" title="BindingCommand é—®é¢˜"></a>BindingCommand é—®é¢˜</h3><p>ç”±äºå†å²åŸå› ï¼ŒAppä½¿ç”¨äº†ä¸€ä¸ªMVVMæ¡†æ¶ã€‚layoutä¸­å¯ä»¥ç»‘å®šBindingCommandã€‚<br>ä¸çŸ¥é“æ˜¯ä¸æ˜¯å¼€å‘å§¿åŠ¿ä¸å¯¹ï¼Œå¿«é€Ÿç‚¹å‡»æŸä¸ªæŒ‰é’®æ—¶ï¼Œå¯¹åº”çš„<code>BindingCommand</code>å¹¶ä¸èƒ½ç«‹å³å“åº”ã€‚è¿ç»­ç‚¹å‡»ä¼šé”™è¿‡ç‚¹å‡»äº‹ä»¶ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">BindingCommand</span> <span class="hljs-variable">myCommand</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BindingCommand</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BindingAction</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">call</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// my logic</span><br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure></p><p>è€Œæ¢ç”¨<code>setOnClickListener</code>å¯ä»¥ç«‹åˆ»ç›‘å¬åˆ°æ¯ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ã€‚<br>ä¸ºäº†è¿½æ±‚å“åº”é€Ÿåº¦ï¼Œåœ¨æŸäº›åœ°æ–¹é‡‡ç”¨è®¾ç½®ç›‘å¬å™¨çš„æ–¹å¼äº†ã€‚</p><h2 id="ç•Œé¢UI"><a href="#ç•Œé¢UI" class="headerlink" title="ç•Œé¢UI"></a>ç•Œé¢UI</h2><h3 id="android-è·‘é©¬ç¯é‡å¤æŠ–åŠ¨çš„è§£å†³æ–¹æ³•"><a href="#android-è·‘é©¬ç¯é‡å¤æŠ–åŠ¨çš„è§£å†³æ–¹æ³•" class="headerlink" title="android è·‘é©¬ç¯é‡å¤æŠ–åŠ¨çš„è§£å†³æ–¹æ³•"></a>android è·‘é©¬ç¯é‡å¤æŠ–åŠ¨çš„è§£å†³æ–¹æ³•</h3><p>è§£å†³çš„æ–¹æ³•ï¼Œåœ¨è·‘é©¬ç¯æ§ä»¶å¤–å±‚ï¼Œå†åµŒå¥—ä¸€ä¸ªå¸ƒå±€æ§ä»¶ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;0dp&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_weight</span>=<span class="hljs-string">&quot;55&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">&quot;horizontal&quot;</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">com.rustfisher.view.MarqueeTextView</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:id</span>=<span class="hljs-string">&quot;@+id/tv_name&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:ellipsize</span>=<span class="hljs-string">&quot;marquee&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:focusable</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:focusableInTouchMode</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:maxWidth</span>=<span class="hljs-string">&quot;150dp&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:singleLine</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:text</span>=<span class="hljs-string">&quot;&quot;</span></span><br><span class="hljs-tag">        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">&quot;10sp&quot;</span> /&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="EditTextåˆ’è¯é€‰è¯å¼¹å‡ºèœå•"><a href="#EditTextåˆ’è¯é€‰è¯å¼¹å‡ºèœå•" class="headerlink" title="EditTextåˆ’è¯é€‰è¯å¼¹å‡ºèœå•"></a>EditTextåˆ’è¯é€‰è¯å¼¹å‡ºèœå•</h3><p>etå¯é€‰ï¼Œå¼¹å‡ºäº†ç³»ç»Ÿçš„èœå•ã€‚</p><p>etä¸å¯é€‰ï¼Œå¼¹å‡ºäº†è‡ªå®šä¹‰çš„èœå•ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">registerForContextMenu(mEt);<br>mEt.setOnCreateContextMenuListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnCreateContextMenuListener() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreateContextMenu</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ContextMenu menu, View v, ContextMenu.ContextMenuInfo menuInfo)</span> &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;onCreateContextMenu: selected: &quot;</span> + mEt.getSelectionStart() + <span class="hljs-string">&quot;, &quot;</span> + mEt.getSelectionEnd()); <span class="hljs-comment">// éƒ½æ˜¯0</span><br>        getMenuInflater().inflate(R.menu.et_menu, menu);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure></p><p>etå¯é€‰ï¼Œå¼¹å‡ºäº†è‡ªå®šä¹‰èœå•ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java">mEt.setCustomSelectionActionModeCallback(genActionModeCallback1());<br><br><span class="hljs-keyword">private</span> ActionMode.Callback <span class="hljs-title function_">genActionModeCallback1</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActionMode</span>.Callback() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onCreateActionMode</span><span class="hljs-params">(ActionMode mode, Menu menu)</span> &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;onCreateActionMode:&quot;</span><br>                    + <span class="hljs-string">&quot; selected: &quot;</span> + mEt.getSelectionStart() + <span class="hljs-string">&quot;, &quot;</span> + mEt.getSelectionEnd());<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onPrepareActionMode</span><span class="hljs-params">(ActionMode mode, Menu menu)</span> &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;onPrepareActionMode: &quot;</span> + <span class="hljs-string">&quot; selected: &quot;</span> + mEt.getSelectionStart() + <span class="hljs-string">&quot;, &quot;</span> + mEt.getSelectionEnd());<br>            menu.clear();<br>            mode.getMenuInflater().inflate(R.menu.et_menu, menu);<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onActionItemClicked</span><span class="hljs-params">(ActionMode mode, MenuItem item)</span> &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;onActionItemClicked: &quot;</span> + <span class="hljs-string">&quot; selected: &quot;</span> + mEt.getSelectionStart() + <span class="hljs-string">&quot;, &quot;</span> + mEt.getSelectionEnd());<br>            mode.finish();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroyActionMode</span><span class="hljs-params">(ActionMode mode)</span> &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;onDestroyActionMode: &quot;</span> + <span class="hljs-string">&quot; selected: &quot;</span> + mEt.getSelectionStart() + <span class="hljs-string">&quot;, &quot;</span> + mEt.getSelectionEnd());<br>        &#125;<br>    &#125;;<br>&#125;<br><br></code></pre></td></tr></table></figure><br>1+æ‰‹æœºå¯ä»¥ç”¨ï¼Œä½†å°ç±³æ‰‹æœºæ— æ³•å¼¹å‡ºè‡ªå®šä¹‰èœå•ã€‚æ­¤æ³•ä¸èƒ½é€šç”¨ã€‚</p><h3 id="ç«–ç›´çš„è¿›åº¦æ¡"><a href="#ç«–ç›´çš„è¿›åº¦æ¡" class="headerlink" title="ç«–ç›´çš„è¿›åº¦æ¡"></a>ç«–ç›´çš„è¿›åº¦æ¡</h3><p><a href="https://stackoverflow.com/questions/3926395/android-set-a-progressbar-to-be-a-vertical-bar-instead-of-horizontal">https://stackoverflow.com/questions/3926395/android-set-a-progressbar-to-be-a-vertical-bar-instead-of-horizontal</a></p><h3 id="è·å–statusbaré«˜åº¦"><a href="#è·å–statusbaré«˜åº¦" class="headerlink" title="è·å–statusbaré«˜åº¦"></a>è·å–statusbaré«˜åº¦</h3><p>åœ¨Activityä¸­è·å–DecorViewã€‚é€šè¿‡DecorViewçš„ä½ç½®æ¥åˆ¤æ–­statusBarçš„é«˜åº¦ã€‚Activityåˆ«è®¾ç½®æˆå…¨å±çš„å°±å¥½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getStatusBarHeight</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Rect</span> <span class="hljs-variable">rectangle</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Rect</span>();<br>    <span class="hljs-type">Window</span> <span class="hljs-variable">window</span> <span class="hljs-operator">=</span> getWindow();<br>    window.getDecorView().getWindowVisibleDisplayFrame(rectangle);<br>    Log.d(TAG, <span class="hljs-string">&quot;getStatusBarHeight: &quot;</span> + rectangle.top);<br>&#125;<br></code></pre></td></tr></table></figure><p>è®©statusbarä¸å ä½ç½®ï¼Œå¹¶è®¾ç½®æˆé€æ˜èƒŒæ™¯ã€‚<br>åº•ä¸‹çš„è™šæ‹Ÿç³»ç»ŸæŒ‰é”®ï¼ˆHomeï¼Œbackï¼Œmenuï¼‰ä¸èƒ½å—å½±å“ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;AppTheme&quot;</span> <span class="hljs-attr">parent</span>=<span class="hljs-string">&quot;Theme.AppCompat.DayNight.NoActionBar&quot;</span>&gt;</span><span class="language-xml"></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:windowTranslucentStatus&quot;</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:windowTranslucentNavigation&quot;</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">item</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;android:statusBarColor&quot;</span>&gt;</span>@android:color/transparent<span class="hljs-tag">&lt;/<span class="hljs-name">item</span>&gt;</span></span><br><span class="language-xml"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span><br></code></pre></td></tr></table></figure></p><h3 id="drawable-vector-assets"><a href="#drawable-vector-assets" class="headerlink" title="drawable - vector assets"></a>drawable - vector assets</h3><p>é€šè¿‡å¼•å…¥svgæ–‡ä»¶å¾—åˆ°çš„drawableï¼Œlayoutä¸­ç›´æ¥è®¾ç½®srcä½¿ç”¨drawableã€‚å°ç±³4cå’Œçº¢ç±³6Aæ‰‹æœºå±å¹•ä¸Šå›¾åƒé”™ä¹±ã€‚<br>æ”¹å˜ImageViewçš„å¤§å°ä¸èµ·ä½œç”¨ã€‚æ¸…æ¥šasç¼“å­˜ä¹Ÿä¸èµ·ä½œç”¨ã€‚</p><p>å¦‚æœä¸åœ¨layoutä¸­è®¾ç½®ï¼Œè€Œæ˜¯åœ¨ä»£ç ä¸­<code>setImageResource</code>åˆ™æ˜¾ç¤ºæ­£å¸¸ã€‚</p><h3 id="è®¾è®¡ç•Œé¢"><a href="#è®¾è®¡ç•Œé¢" class="headerlink" title="è®¾è®¡ç•Œé¢"></a>è®¾è®¡ç•Œé¢</h3><p>å»èŠ±ç“£ç½‘ä¸Šæ‰¾çµæ„Ÿã€‚<br>æ¯”å¦‚è®¾è®¡åˆ—è¡¨ç•Œé¢ï¼Œå¯ä»¥ç»™æ¯ä¸ªé¡¹ç›®å¢åŠ ä¸€ä¸ªå°èƒŒæ™¯ã€‚å¯ä»¥æ˜¯é¢œè‰²ï¼Œå¯ä»¥æ˜¯èƒŒæ™¯å›¾ã€‚</p><h2 id="ç½‘ç»œè¯·æ±‚"><a href="#ç½‘ç»œè¯·æ±‚" class="headerlink" title="ç½‘ç»œè¯·æ±‚"></a>ç½‘ç»œè¯·æ±‚</h2><h3 id="è®¾è®¡æ¥å£è·å–æ•°æ®"><a href="#è®¾è®¡æ¥å£è·å–æ•°æ®" class="headerlink" title="è®¾è®¡æ¥å£è·å–æ•°æ®"></a>è®¾è®¡æ¥å£è·å–æ•°æ®</h3><p>é¡¹ç›®é‡Œç”¨OKHttpæ¡†æ¶æ¥è¿›è¡Œç½‘ç»œè¯·æ±‚ã€‚è¿”å›ç»“æœè¢«è½¬åŒ–æˆå¯¹è±¡<code>Entity</code>ã€‚<br>åŒä¸€ä¸ªæœåŠ¡å™¨è¿”å›é‡Œè£…æœ‰ç›¸åŒç»“æ„çš„A,B,Cå¯¹è±¡ã€‚å®ƒä»¬çš„åå­—ä¸ä¸€æ ·ï¼ŒGsonFormatçš„æ—¶å€™æ˜¯åˆ†å¼€æˆ3ä¸ªç±»çš„ã€‚<br>ä¸ºäº†è®©ä»£ç æ›´ç®€æ´ï¼ŒæŠŠè¿™3ä¸ªå¯¹è±¡è¿›è¡ŒæŠ½è±¡ã€‚<br>ä¸€å¼€å§‹æ˜¯åšäº†ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè®©è¿™3ä¸ªç±»ç»§æ‰¿ã€‚ä½†æ˜¯OKHttpé‚£è¾¹ä¼šæŠ¥é”™ã€‚</p><p>ç„¶åæ”¹ç”¨äº†æ¥å£çš„æ–¹å¼ã€‚è®¾è®¡çš„æ¥å£é‡Œæœ‰ä¸€äº›é€šç”¨æ–¹æ³•ã€‚åœ¨<code>Entity</code>é‡Œè®©é‚£3ä¸ªç±»éƒ½å®ç°è¿™ä¸ªæ¥å£ï¼Œç„¶ååœ¨æ–¹æ³•ä¸­è¿”å›æˆ‘ä»¬è¦çš„æ•°æ®ã€‚</p><h2 id="AsyncTask"><a href="#AsyncTask" class="headerlink" title="AsyncTask"></a>AsyncTask</h2><h3 id="èµ„æºåˆ†é…"><a href="#èµ„æºåˆ†é…" class="headerlink" title="èµ„æºåˆ†é…"></a>èµ„æºåˆ†é…</h3><p>AsyncTaskèƒŒåæœ‰ä¸€ä¸ªçº¿ç¨‹æ± ã€‚è°ƒç”¨äº†<code>execute()</code>å¹¶ä¸èƒ½ä¿è¯ä»»åŠ¡ç«‹åˆ»è¢«æ‰§è¡Œã€‚<br>æ¢ç”¨Threadã€‚</p><h2 id="Appè®¾ç½®"><a href="#Appè®¾ç½®" class="headerlink" title="Appè®¾ç½®"></a>Appè®¾ç½®</h2><h3 id="åˆ†å±è®¾ç½®"><a href="#åˆ†å±è®¾ç½®" class="headerlink" title="åˆ†å±è®¾ç½®"></a>åˆ†å±è®¾ç½®</h3><p>å¦‚æœä¸è¿›è¡Œè®¾ç½®ï¼Œé»˜è®¤æ˜¯å…è®¸åˆ†å±çš„ã€‚è¿™é‡Œæˆ‘ä»¬æŠŠåˆ†å±ç»™ç¦æ­¢ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">android:networkSecurityConfig=&quot;@xml/network_security_config&quot;<br>android:resizeableActivity=&quot;false&quot;<br></code></pre></td></tr></table></figure></p><p>æ·»åŠ åœ¨applicationæ ‡ç­¾é‡Œã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">application</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;.app.MyApplication&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:allowBackup</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:icon</span>=<span class="hljs-string">&quot;@mipmap/ic_launcher&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:label</span>=<span class="hljs-string">&quot;@string/app_name&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:networkSecurityConfig</span>=<span class="hljs-string">&quot;@xml/network_security_config&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:theme</span>=<span class="hljs-string">&quot;@style/AppTheme&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure></p><h2 id="adb"><a href="#adb" class="headerlink" title="adb"></a>adb</h2><h3 id="ç³»ç»ŸApp"><a href="#ç³»ç»ŸApp" class="headerlink" title="ç³»ç»ŸApp"></a>ç³»ç»ŸApp</h3><p>æŠŠapkæ”¾è¿›rootåçš„æ‰‹æœºé‡Œï¼Œå½“åšæ˜¯ç³»ç»Ÿappã€‚</p><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cmd"><span class="hljs-function">F:\<span class="hljs-title">IE</span>\<span class="hljs-title">MyApp0826</span>\<span class="hljs-title">app</span>\<span class="hljs-title">libs</span>&gt;<span class="hljs-title">adb</span> <span class="hljs-title">root</span></span><br><span class="hljs-function"><span class="hljs-title">F</span>:\<span class="hljs-title">IE</span>\<span class="hljs-title">MyApp0826</span>\<span class="hljs-title">app</span>\<span class="hljs-title">libs</span>&gt;<span class="hljs-title">adb</span> <span class="hljs-title">remount</span></span><br><span class="hljs-function"><span class="hljs-title">remount</span> <span class="hljs-title">succeeded</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-title">F</span>:\<span class="hljs-title">IE</span>\<span class="hljs-title">MyApp0826</span>\<span class="hljs-title">app</span>\<span class="hljs-title">libs</span>&gt;<span class="hljs-title">adb</span> <span class="hljs-title">shell</span> <span class="hljs-title">mkdir</span> /<span class="hljs-title">system</span>/<span class="hljs-title">priv</span>-<span class="hljs-title">app</span>/<span class="hljs-title">MyApp</span></span><br><span class="hljs-function"><span class="hljs-title">F</span>:\<span class="hljs-title">IE</span>\<span class="hljs-title">MyApp0826</span>\<span class="hljs-title">app</span>\<span class="hljs-title">libs</span>&gt;<span class="hljs-title">adb</span> <span class="hljs-title">shell</span> <span class="hljs-title">chmod</span> 755 /<span class="hljs-title">system</span>/<span class="hljs-title">priv</span>-<span class="hljs-title">app</span>/<span class="hljs-title">MyApp</span></span><br><span class="hljs-function"><span class="hljs-title">F</span>:\<span class="hljs-title">IE</span>\<span class="hljs-title">MyApp0826</span>\<span class="hljs-title">app</span>\<span class="hljs-title">libs</span>&gt;<span class="hljs-title">adb</span> <span class="hljs-title">shell</span> <span class="hljs-title">chmod</span> 644 /<span class="hljs-title">system</span>/<span class="hljs-title">priv</span>-<span class="hljs-title">app</span>/<span class="hljs-title">MyApp</span>/<span class="hljs-title">MyApp.apk</span></span><br><span class="hljs-function"><span class="hljs-title">F</span>:\<span class="hljs-title">IE</span>\<span class="hljs-title">MyApp0826</span>\<span class="hljs-title">app</span>\<span class="hljs-title">libs</span>&gt;<span class="hljs-title">adb</span> <span class="hljs-title">shell</span> <span class="hljs-title">chmod</span> 755 /<span class="hljs-title">system</span>/<span class="hljs-title">priv</span>-<span class="hljs-title">app</span>/<span class="hljs-title">MyApp</span>/<span class="hljs-title">lib</span></span><br><span class="hljs-function"><span class="hljs-title">F</span>:\<span class="hljs-title">IE</span>\<span class="hljs-title">MyApp0826</span>\<span class="hljs-title">app</span>\<span class="hljs-title">libs</span>&gt;<span class="hljs-title">adb</span> <span class="hljs-title">shell</span> <span class="hljs-title">chmod</span> 755 /<span class="hljs-title">system</span>/<span class="hljs-title">priv</span>-<span class="hljs-title">app</span>/<span class="hljs-title">MyApp</span>/<span class="hljs-title">lib</span>/<span class="hljs-title">arm</span></span><br><span class="hljs-function"><span class="hljs-title">F</span>:\<span class="hljs-title">IE</span>\<span class="hljs-title">MyApp0826</span>\<span class="hljs-title">app</span>\<span class="hljs-title">libs</span>&gt;<span class="hljs-title">adb</span> <span class="hljs-title">shell</span> <span class="hljs-title">sync</span></span><br><span class="hljs-function"><span class="hljs-title">F</span>:\<span class="hljs-title">IE</span>\<span class="hljs-title">MyApp0826</span>\<span class="hljs-title">app</span>\<span class="hljs-title">libs</span>&gt;<span class="hljs-title">adb</span> <span class="hljs-title">shell</span> <span class="hljs-title">reboot</span></span><br></code></pre></td></tr></table></figure><h3 id="èŒƒå›´å†…éšæœºæ•°"><a href="#èŒƒå›´å†…éšæœºæ•°" class="headerlink" title="èŒƒå›´å†…éšæœºæ•°"></a>èŒƒå›´å†…éšæœºæ•°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Random</span> <span class="hljs-variable">rand</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>(seed);<br><span class="hljs-type">int</span> <span class="hljs-variable">random_integer</span> <span class="hljs-operator">=</span> rand.nextInt(upperbound-lowerbound) + lowerbound;<br></code></pre></td></tr></table></figure><h2 id="å†…å­˜æ³„æ¼"><a href="#å†…å­˜æ³„æ¼" class="headerlink" title="å†…å­˜æ³„æ¼"></a>å†…å­˜æ³„æ¼</h2><h3 id="Handlerä¸å•ä¾‹"><a href="#Handlerä¸å•ä¾‹" class="headerlink" title="Handlerä¸å•ä¾‹"></a>Handlerä¸å•ä¾‹</h3><p>å•ä¾‹æ¨¡å¼åŠ ä¸ŠHandlerã€‚æœ‰äººæŠŠhandlerç›´æ¥äº¤ç»™å•ä¾‹ã€‚é•¿ç”Ÿå‘½å‘¨æœŸçš„ä¸€ç›´æŒæœ‰çŸ­ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼Œæ²¡æ³•å›æ”¶é€ æˆå†…å­˜æ³„æ¼ã€‚</p><p>viewModelä¸­æœ‰ä¸€ä¸ªhandlerï¼Œè€Œhandlerè¢«å•ä¾‹æŒæœ‰ã€‚handleræ˜¯ç›´æ¥å®ä¾‹åŒ–çš„ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">aHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Message msg)</span> &#123;<br>        handleResult(msg);<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><br>handleResultæ–¹æ³•ä¸­ä½¿ç”¨äº†viewModelçš„æ•°æ®åˆ—è¡¨ã€‚</p><p>è¿™æ ·åœ¨æ–°å»ºä¸€ä¸ªviewModelçš„æ—¶å€™ï¼Œå•ä¾‹æŒæœ‰æ—§çš„handlerï¼ŒhandleræŒæœ‰çš„è¿˜æ˜¯æ—§çš„é‚£ä¸ªæ•°æ®åˆ—è¡¨ã€‚<br>å†…å­˜ä¸­å°±æœ‰2ä»½ä¸ä¸€æ ·çš„æ•°æ®åˆ—è¡¨ã€‚</p><p>ä¿®å¤æ–¹æ¡ˆï¼š<br>é¦–å…ˆä¸èƒ½è®©å•ä¾‹æŒæœ‰è¿™ä¸ªhandlerã€‚<br>å…¶æ¬¡é€€å‡ºviewModelçš„æ—¶å€™ï¼ŒæŠŠhandlerä¸­çš„æ¶ˆæ¯æ¸…ç©ºã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€å‘è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android OkHttp + Retrofit ä½¿ç”¨ç¤ºä¾‹</title>
    <link href="/2018/08/22/Android/Android-OkHttp_Retrofit_use_intro/"/>
    <url>/2018/08/22/Android/Android-OkHttp_Retrofit_use_intro/</url>
    
    <content type="html"><![CDATA[<p><a href="https://rustfisher.com/2018/08/22/Android/Android-OkHttp_Retrofit_use_intro/">æœ¬æ–‡é“¾æ¥</a></p><p>OkHttp + Retrofitä½¿ç”¨ç¤ºä¾‹ã€‚ä»å¼•å…¥ä¾èµ–ï¼Œç¼–å†™æ¥å£ï¼Œåˆ°å‘èµ·ç½‘ç»œè¯·æ±‚ã€‚</p><p><a href="https://github.com/square/okhttp">https://github.com/square/okhttp</a></p><h1 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h1><h2 id="å¼•å…¥ä¾èµ–"><a href="#å¼•å…¥ä¾èµ–" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h2><p>å¼•å…¥ä¾èµ–ï¼Œä½¿ç”¨Retrofit2ã€‚<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">implementation</span> &#x27;com.squareup.retrofit2:retrofit:<span class="hljs-number">2</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span>&#x27;<br><span class="hljs-attribute">implementation</span> &#x27;com.squareup.retrofit2:converter-gson:<span class="hljs-number">2</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span>&#x27;<br><span class="hljs-attribute">implementation</span> &#x27;com.squareup.retrofit2:adapter-rxjava:<span class="hljs-number">2</span>.<span class="hljs-number">1</span>.<span class="hljs-number">0</span>&#x27;<br></code></pre></td></tr></table></figure></p><h2 id="æŸ¥è¯¢-Query"><a href="#æŸ¥è¯¢-Query" class="headerlink" title="æŸ¥è¯¢ @Query"></a>æŸ¥è¯¢ <code>@Query</code></h2><p>ä¾‹å¦‚URL <code>https://base_url/backend-service/config?env=dev</code>ï¼Œé—®å·åé¢å±äºæŸ¥è¯¢å†…å®¹ã€‚<br>ä¸è®ºæ˜¯GETæˆ–POSTï¼Œéƒ½è¦ç”¨<code>@Query</code>è¿™ä¸ªæ³¨è§£ã€‚å¦åˆ™ä¼šæŠ¥å¼‚å¸¸ã€‚</p><h2 id="URLå¡«å……ä¸æ‹¼æ¥"><a href="#URLå¡«å……ä¸æ‹¼æ¥" class="headerlink" title="URLå¡«å……ä¸æ‹¼æ¥"></a>URLå¡«å……ä¸æ‹¼æ¥</h2><p>å•çº¯URLå¡«å……å¯ä»¥ç”¨<code>@Path</code>æ³¨è§£ã€‚<br>ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªpostè¯·æ±‚ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@POST(&quot;user-service/user/&#123;uid&#125;/token/refresh&quot;)</span><br>Call&lt;RefreshTokenResp&gt; <span class="hljs-title function_">refreshToken</span><span class="hljs-params">(<span class="hljs-meta">@Path(&quot;uid&quot;)</span> String uid, <span class="hljs-meta">@Query(&quot;token&quot;)</span> String token)</span>;<br></code></pre></td></tr></table></figure></p><h2 id="GETå¸¦æœ‰æŸ¥è¯¢çš„å‚æ•°"><a href="#GETå¸¦æœ‰æŸ¥è¯¢çš„å‚æ•°" class="headerlink" title="GETå¸¦æœ‰æŸ¥è¯¢çš„å‚æ•°"></a>GETå¸¦æœ‰æŸ¥è¯¢çš„å‚æ•°</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CfgService</span> &#123;<br><br>    <span class="hljs-meta">@GET(&quot;backend-service/config&quot;)</span><br>    Call&lt;ServerCfgResp&gt; <span class="hljs-title function_">getServerCfg</span><span class="hljs-params">(<span class="hljs-meta">@Query(&quot;env&quot;)</span> String env)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="POSTï¼Œå¸¦æœ‰æŸ¥è¯¢çš„å‚æ•°å’Œbody"><a href="#POSTï¼Œå¸¦æœ‰æŸ¥è¯¢çš„å‚æ•°å’Œbody" class="headerlink" title="POSTï¼Œå¸¦æœ‰æŸ¥è¯¢çš„å‚æ•°å’Œbody"></a>POSTï¼Œå¸¦æœ‰æŸ¥è¯¢çš„å‚æ•°å’Œbody</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@POST(&quot;user-service/login&quot;)</span><br>    Call&lt;LoginResp&gt; <span class="hljs-title function_">login</span><span class="hljs-params">(<span class="hljs-meta">@Query(&quot;lenovoST&quot;)</span> String token, <span class="hljs-meta">@Query(&quot;realm&quot;)</span> String realm,</span><br><span class="hljs-params">                            <span class="hljs-meta">@Body</span> RequestBody body)</span>;<br><br>    <span class="hljs-meta">@POST(&quot;user-service/logout&quot;)</span><br>    Call&lt;CommonEntity&gt; <span class="hljs-title function_">logout</span><span class="hljs-params">(<span class="hljs-meta">@Query(&quot;token&quot;)</span> String token, <span class="hljs-meta">@Body</span> RequestBody body)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>è°ƒç”¨çš„æ—¶å€™è¦åˆ›å»º<code>RequestBody</code>ï¼›å…ˆè°ƒæŸ¥å¥½åå°æ¥å—çš„bodyç±»å‹ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">Map&lt;String, String&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();<br>map.put(<span class="hljs-string">&quot;system&quot;</span>, <span class="hljs-string">&quot;Android&quot;</span>);<br>map.put(<span class="hljs-string">&quot;phoneBrand&quot;</span>, Build.BRAND);<br>map.put(<span class="hljs-string">&quot;modelNum&quot;</span>, Build.MODEL);<br><span class="hljs-type">Gson</span> <span class="hljs-variable">gson</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Gson</span>();<br><span class="hljs-type">String</span> <span class="hljs-variable">bodyJson</span> <span class="hljs-operator">=</span> gson.toJson(map);<br><span class="hljs-type">RequestBody</span> <span class="hljs-variable">requestBody</span> <span class="hljs-operator">=</span> RequestBody.create(MediaType.parse(<span class="hljs-string">&quot;application/json&quot;</span>), bodyJson);<br></code></pre></td></tr></table></figure></p><p>åˆå§‹åŒ–<code>OkHttpClient</code>ï¼›è¿™é‡Œä¿¡ä»»æ‰€æœ‰çš„SSLè¯ä¹¦ï¼ˆæ­£å¼ç¯å¢ƒä¸å»ºè®®è¿™ä¹ˆåšï¼‰ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> CfgService cfgService;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initService</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">SSLSocketFactory</span> <span class="hljs-variable">sslSocketFactory</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            sslSocketFactory = SSLUtils.getSSLSocketFactory();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        OkHttpClient.<span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>.Builder();<br>        <span class="hljs-keyword">if</span> (sslSocketFactory != <span class="hljs-literal">null</span>) &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;sslSocketFactory != null&quot;</span>);<br>            builder.sslSocketFactory(sslSocketFactory);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            Log.w(TAG, <span class="hljs-string">&quot;sslSocketFactory == null&quot;</span>);<br>        &#125;<br>        builder.hostnameVerifier(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HostnameVerifier</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">verify</span><span class="hljs-params">(String hostname, SSLSession session)</span> &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// å¼ºåˆ¶è¿”å›true</span><br>            &#125;<br>        &#125;);<br>        <span class="hljs-type">OkHttpClient</span> <span class="hljs-variable">lenClient</span> <span class="hljs-operator">=</span> builder.build();<br>        <span class="hljs-type">Retrofit</span> <span class="hljs-variable">retrofit</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Retrofit</span>.Builder()<br>                .baseUrl(ServerCfg.HOST_URL)<br>                .client(lenClient)<br>                .addCallAdapterFactory(RxJavaCallAdapterFactory.create())<br>                .addConverterFactory(GsonConverterFactory.create())<br>                .build();<br>        cfgService = retrofit.create(CfgService.class);<br>    &#125;<br></code></pre></td></tr></table></figure></p><h2 id="è°ƒç”¨ç½‘ç»œè¯·æ±‚"><a href="#è°ƒç”¨ç½‘ç»œè¯·æ±‚" class="headerlink" title="è°ƒç”¨ç½‘ç»œè¯·æ±‚"></a>è°ƒç”¨ç½‘ç»œè¯·æ±‚</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">mNetworkManager.getUserApi().login(mLenovoToken, ServerCfg.RID, requestBody).enqueue(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Callback</span>&lt;LoginResp&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onResponse</span><span class="hljs-params">(Call&lt;LoginResp&gt; call, <span class="hljs-keyword">final</span> Response&lt;LoginResp&gt; response)</span> &#123;<br>                <span class="hljs-comment">//...</span><br>            &#125;<br><br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">(Call&lt;LoginResp&gt; call, <span class="hljs-keyword">final</span> Throwable t)</span> &#123;<br>                <span class="hljs-comment">//...</span><br>            &#125;<br>        &#125;);<br></code></pre></td></tr></table></figure><h2 id="ä¿¡ä»»æ‰€æœ‰æœåŠ¡å™¨çš„ssl"><a href="#ä¿¡ä»»æ‰€æœ‰æœåŠ¡å™¨çš„ssl" class="headerlink" title="ä¿¡ä»»æ‰€æœ‰æœåŠ¡å™¨çš„ssl"></a>ä¿¡ä»»æ‰€æœ‰æœåŠ¡å™¨çš„ssl</h2><p><strong>å¹¶ä¸æ¨èè¿™ä¹ˆåš</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SSLUtils</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> ä¿¡ä»»æ‰€æœ‰æœåŠ¡å™¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SSLSocketFactory <span class="hljs-title function_">getSSLSocketFactory</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">SSLSocketFactory</span> <span class="hljs-variable">sslSocketFactory</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">SSLContext</span> <span class="hljs-variable">sslContext</span> <span class="hljs-operator">=</span> SSLContext.getInstance(<span class="hljs-string">&quot;TLS&quot;</span>);<br>        sslContext.init(<span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">TrustManager</span>[]&#123;createTrustAllManager()&#125;, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecureRandom</span>());<br>        sslSocketFactory = sslContext.getSocketFactory();<br>        <span class="hljs-keyword">return</span> sslSocketFactory;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> X509TrustManager <span class="hljs-title function_">createTrustAllManager</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">X509TrustManager</span> <span class="hljs-variable">tm</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            tm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">X509TrustManager</span>() &#123;<br>                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkClientTrusted</span><span class="hljs-params">(X509Certificate[] chain, String authType)</span><br>                        <span class="hljs-keyword">throws</span> CertificateException &#123;<br>                    <span class="hljs-comment">//do nothingï¼Œæ¥å—ä»»æ„å®¢æˆ·ç«¯è¯ä¹¦</span><br>                &#125;<br><br>                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkServerTrusted</span><span class="hljs-params">(X509Certificate[] chain, String authType)</span><br>                        <span class="hljs-keyword">throws</span> CertificateException &#123;<br>                    <span class="hljs-comment">//do nothingï¼Œæ¥å—ä»»æ„æœåŠ¡ç«¯è¯ä¹¦</span><br>                &#125;<br><br>                <span class="hljs-keyword">public</span> X509Certificate[] getAcceptedIssuers() &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">X509Certificate</span>[<span class="hljs-number">0</span>];<br>                &#125;<br>            &#125;;<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br><br>        &#125;<br>        <span class="hljs-keyword">return</span> tm;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="serviceä½¿ç”¨io-reactivex-Observable"><a href="#serviceä½¿ç”¨io-reactivex-Observable" class="headerlink" title="serviceä½¿ç”¨io.reactivex.Observable"></a>serviceä½¿ç”¨io.reactivex.Observable</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> io.reactivex.Observable; <span class="hljs-comment">// è¿™ä¸ªæ˜¯rx2çš„åŒ…</span><br><span class="hljs-comment">// ---</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨æˆ·åé¦ˆæ¥å£</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> content ç”¨æˆ·è¾“å…¥çš„åé¦ˆå†…å®¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@POST(&quot;feedbackAction&quot;)</span><br>    Observable&lt;UserFeedback&gt; <span class="hljs-title function_">userFeedback</span><span class="hljs-params">(<span class="hljs-meta">@Query(&quot;appVersion&quot;)</span> String appVersion,</span><br><span class="hljs-params">                                          <span class="hljs-meta">@Query(&quot;phoneModel&quot;)</span> String phoneModel,</span><br><span class="hljs-params">                                          <span class="hljs-meta">@Query(&quot;phoneOsVersion&quot;)</span> String osVersion,</span><br><span class="hljs-params">                                          <span class="hljs-meta">@Query(&quot;submitContent&quot;)</span> String content)</span>;<br><br></code></pre></td></tr></table></figure><h1 id="ç¤ºä¾‹1-Retrofit2ï¼ŒRxJava2"><a href="#ç¤ºä¾‹1-Retrofit2ï¼ŒRxJava2" class="headerlink" title="ç¤ºä¾‹1 - Retrofit2ï¼ŒRxJava2"></a>ç¤ºä¾‹1 - Retrofit2ï¼ŒRxJava2</h1><h2 id="å¼•å…¥ä¾èµ–-1"><a href="#å¼•å…¥ä¾èµ–-1" class="headerlink" title="å¼•å…¥ä¾èµ–"></a>å¼•å…¥ä¾èµ–</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">implementation</span> &#x27;com.squareup.retrofit2:retrofit:<span class="hljs-number">2</span>.<span class="hljs-number">5</span>.<span class="hljs-number">0</span>&#x27;<br><span class="hljs-attribute">implementation</span> &#x27;com.squareup.retrofit2:converter-gson:<span class="hljs-number">2</span>.<span class="hljs-number">5</span>.<span class="hljs-number">0</span>&#x27;<br><span class="hljs-attribute">implementation</span> &#x27;com.squareup.retrofit2:adapter-rxjava2:<span class="hljs-number">2</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span>&#x27;<br><span class="hljs-attribute">implementation</span> &#x27;io.reactivex.rxjava2:rxandroid:<span class="hljs-number">2</span>.<span class="hljs-number">1</span>.<span class="hljs-number">1</span>&#x27;<br><span class="hljs-attribute">implementation</span> &#x27;io.reactivex.rxjava2:rxjava:<span class="hljs-number">2</span>.<span class="hljs-number">2</span>.<span class="hljs-number">8</span>&#x27;<br></code></pre></td></tr></table></figure><h2 id="å®šä¹‰interface"><a href="#å®šä¹‰interface" class="headerlink" title="å®šä¹‰interface"></a>å®šä¹‰interface</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">import</span> io.reactivex.Observable;<br><span class="hljs-keyword">import</span> retrofit2.http.Field;<br><span class="hljs-keyword">import</span> retrofit2.http.FieldMap;<br><span class="hljs-keyword">import</span> retrofit2.http.FormUrlEncoded;<br><span class="hljs-keyword">import</span> retrofit2.http.GET;<br><span class="hljs-keyword">import</span> retrofit2.http.POST;<br><span class="hljs-keyword">import</span> retrofit2.http.Query;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * RustDroneåå°æ¥å£</span><br><span class="hljs-comment"> * Created on 2019-5-17</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RustDroneCommonService</span> &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ç”¨æˆ·åé¦ˆæ¥å£</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> content ç”¨æˆ·è¾“å…¥çš„åé¦ˆå†…å®¹</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@FormUrlEncoded</span><br>    <span class="hljs-meta">@POST(&quot;feedbackAction&quot;)</span><br>    Observable&lt;FeedbackResp&gt; <span class="hljs-title function_">userFeedback</span><span class="hljs-params">(<span class="hljs-meta">@Field(&quot;appVersion&quot;)</span> String appVersion,</span><br><span class="hljs-params">                                          <span class="hljs-meta">@Field(&quot;phoneModel&quot;)</span> String phoneModel,</span><br><span class="hljs-params">                                          <span class="hljs-meta">@Field(&quot;phoneOsVersion&quot;)</span> String osVersion,</span><br><span class="hljs-params">                                          <span class="hljs-meta">@Field(&quot;submitContent&quot;)</span> String content,</span><br><span class="hljs-params">                                          <span class="hljs-meta">@FieldMap</span> Map&lt;String, String&gt; map)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–æ‰‹æœºéªŒè¯ç </span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> mobile æ‰‹æœºå·</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@GET(&quot;verifyCode&quot;)</span><br>    Observable&lt;PhoneCodeResp&gt; <span class="hljs-title function_">getPhoneCode</span><span class="hljs-params">(<span class="hljs-meta">@Query(&quot;mobile&quot;)</span> String mobile, <span class="hljs-meta">@Query(&quot;oprType&quot;)</span> <span class="hljs-type">int</span> type)</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="è°ƒç”¨æ¥å£"><a href="#è°ƒç”¨æ¥å£" class="headerlink" title="è°ƒç”¨æ¥å£"></a>è°ƒç”¨æ¥å£</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> io.reactivex.Observer;<br><span class="hljs-keyword">import</span> io.reactivex.android.schedulers.AndroidSchedulers;<br><span class="hljs-keyword">import</span> io.reactivex.disposables.Disposable;<br><span class="hljs-keyword">import</span> io.reactivex.schedulers.Schedulers;<br><br>RustDroneDataCenter.getCenter().getCommonService().userFeedback(BuildConfig.VERSION_NAME,<br>                    Build.MODEL.replace(<span class="hljs-string">&quot; &quot;</span>, <span class="hljs-string">&quot;-&quot;</span>), Build.VERSION.RELEASE, fd, ext)<br>                    .subscribeOn(Schedulers.newThread())<br>                    .observeOn(AndroidSchedulers.mainThread())<br>                    .subscribe(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>&lt;FeedbackResp&gt;() &#123;<br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSubscribe</span><span class="hljs-params">(Disposable d)</span> &#123;<br><span class="hljs-comment">//                            LL.dn(TAG, &quot;onSubscribe: &quot; + d);</span><br>                        &#125;<br><br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onNext</span><span class="hljs-params">(FeedbackResp feedbackResp)</span> &#123;<br>                            LL.dn(TAG, <span class="hljs-string">&quot;onNext: &quot;</span> + feedbackResp);<br>                            <span class="hljs-keyword">if</span> (feedbackResp.getCode() == <span class="hljs-number">0</span>) &#123;<br>                                popSubmitSuccessDialog();<br>                            &#125; <span class="hljs-keyword">else</span> &#123;<br>                                LL.e(<span class="hljs-string">&quot;ä¸Šä¼ ç”¨æˆ·åé¦ˆå¤±è´¥&quot;</span>);<br>                                mPbLayout.setVisibility(View.GONE);<br>                                popRetryDialog();<br>                            &#125;<br>                        &#125;<br><br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onError</span><span class="hljs-params">(Throwable e)</span> &#123;<br>                            LL.e(<span class="hljs-string">&quot;ä¸Šä¼ ç”¨æˆ·åé¦ˆå¤±è´¥ code: &quot;</span> + e);<br>                            mPbLayout.setVisibility(View.GONE);<br>                            popRetryDialog();<br>                        &#125;<br><br>                        <span class="hljs-meta">@Override</span><br>                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onComplete</span><span class="hljs-params">()</span> &#123;<br>                            mPbLayout.setVisibility(View.GONE);<br>                            LL.dn(TAG, <span class="hljs-string">&quot;onComplete: ä¸Šä¼ ç»“æŸ&quot;</span>);<br>                        &#125;<br>                    &#125;);<br></code></pre></td></tr></table></figure><h1 id="GithubOnAndroidç¤ºä¾‹"><a href="#GithubOnAndroidç¤ºä¾‹" class="headerlink" title="GithubOnAndroidç¤ºä¾‹"></a>GithubOnAndroidç¤ºä¾‹</h1><p>ä»£ç åœ°å€ï¼š <a href="https://github.com/RustFisher/GithubOnAndroid">https://github.com/RustFisher/GithubOnAndroid</a></p><h2 id="æ·»åŠ æ‹¦æˆªå™¨"><a href="#æ·»åŠ æ‹¦æˆªå™¨" class="headerlink" title="æ·»åŠ æ‹¦æˆªå™¨"></a>æ·»åŠ æ‹¦æˆªå™¨</h2><h3 id="å®šä¹‰æ‹¦æˆªå™¨"><a href="#å®šä¹‰æ‹¦æˆªå™¨" class="headerlink" title="å®šä¹‰æ‹¦æˆªå™¨"></a>å®šä¹‰æ‹¦æˆªå™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ä»…ä»…æ˜¯ç¤ºä¾‹ï¼Œä¸åšä»»ä½•å¤„ç†</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">Interceptor</span> <span class="hljs-variable">doNothingInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Interceptor</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">intercept</span><span class="hljs-params">(Chain chain)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;Interceptor1: intercept&quot;</span>);<br>        <span class="hljs-keyword">return</span> chain.proceed(chain.request());<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><h3 id="æ·»åŠ æ‹¦æˆªå™¨-1"><a href="#æ·»åŠ æ‹¦æˆªå™¨-1" class="headerlink" title="æ·»åŠ æ‹¦æˆªå™¨"></a>æ·»åŠ æ‹¦æˆªå™¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">OkHttpClient</span> <span class="hljs-variable">okHttpClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OkHttpClient</span>.Builder()<br>                .readTimeout(<span class="hljs-number">10</span>, TimeUnit.SECONDS)<br>                .connectTimeout(<span class="hljs-number">10</span>, TimeUnit.SECONDS)<br>                .addInterceptor(doNothingInterceptor) <span class="hljs-comment">// æ·»åŠ æ‹¦æˆªå™¨</span><br>                .addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Interceptor</span>() &#123;<br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">intercept</span><span class="hljs-params">(Chain chain)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>                        Log.d(TAG, <span class="hljs-string">&quot;Interceptor2: intercept&quot;</span>);<br>                        <span class="hljs-keyword">return</span> chain.proceed(chain.request());<br>                    &#125;<br>                &#125;)<br>                .addNetworkInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Interceptor</span>() &#123;<br>                    <span class="hljs-meta">@Override</span><br>                    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">intercept</span><span class="hljs-params">(Chain chain)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>                        Log.d(TAG, <span class="hljs-string">&quot;NetworkInterceptor1: intercept&quot;</span>);<br>                        <span class="hljs-keyword">return</span> chain.proceed(chain.request());<br>                    &#125;<br>                &#125;)<br>                .build();<br></code></pre></td></tr></table></figure><h4 id="æ‹¦æˆªå™¨ä¸­å¢åŠ header"><a href="#æ‹¦æˆªå™¨ä¸­å¢åŠ header" class="headerlink" title="æ‹¦æˆªå™¨ä¸­å¢åŠ header"></a>æ‹¦æˆªå™¨ä¸­å¢åŠ header</h4><p>æ“ä½œchainä¸­çš„requestã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-comment">// æ·»åŠ ä¸€äº›å…¬å…±å‚æ•°</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">Interceptor</span> <span class="hljs-variable">RustDroneInterceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Interceptor</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Response <span class="hljs-title function_">intercept</span><span class="hljs-params">(Chain chain)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">Request</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> chain.request().newBuilder()<br>                .addHeader(<span class="hljs-string">&quot;token&quot;</span>, UserCenter.getToken())<br>                .build();<br>        <span class="hljs-keyword">return</span> chain.proceed(request);<br>    &#125;<br>&#125;;<br></code></pre></td></tr></table></figure><p>æ›´å¤šè¯·å‚è€ƒï¼š</p><p><a href="https://rustfisher.com/2018/08/22/Android/Android-OkHttp_Retrofit_use_intro/">Android OkHttp + Retrofit ä½¿ç”¨ç¤ºä¾‹</a></p><p><a href="https://rustfisher.com/2019/06/26/Android/Android-OkHttp_Retrofit_cancel_request/">Android OkHttp + Retrofit å–æ¶ˆè¯·æ±‚çš„æ–¹æ³•</a></p><p><a href="https://rustfisher.com/2019/10/18/Android/Android-OkHttp_Retrofit_download_file/">Android OkHttp + Retrofit ä¸‹è½½æ–‡ä»¶ä¸è¿›åº¦ç›‘å¬</a></p><p><a href="https://rustfisher.com/2019/10/18/Android/Android-OkHttp_Retrofit_download_file_partial/">Android OkHttp + Retrofit æ–­ç‚¹ç»­ä¼ </a></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>network</tag>
      
      <tag>OkHttp</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Œdroneã€å¼€å‘è®°å½•</title>
    <link href="/2018/07/29/Dev-note/dev-note-app-drone/"/>
    <url>/2018/07/29/Dev-note/dev-note-app-drone/</url>
    
    <content type="html"><![CDATA[<h2 id="æ–œä½“æ–‡å­—è¢«åˆ‡æ‰äº†ä¸€å—"><a href="#æ–œä½“æ–‡å­—è¢«åˆ‡æ‰äº†ä¸€å—" class="headerlink" title="æ–œä½“æ–‡å­—è¢«åˆ‡æ‰äº†ä¸€å—"></a>æ–œä½“æ–‡å­—è¢«åˆ‡æ‰äº†ä¸€å—</h2><p>TextView.setTextçš„æ—¶å€™åœ¨å³è¾¹åŠ ä¸Šä¸€ä¸ªç©ºæ ¼ã€‚</p><p>æˆ–è€…<code>string.xml</code>ä¸­æ·»åŠ <code>&amp;#x200A;</code>æ¥å ä½ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">string</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dp_page_ready&quot;</span>&gt;</span>READY<span class="hljs-symbol">&amp;#x200A;</span><span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…åœ¨TextView.setTextçš„æ—¶å€™åŠ ä¸Šä¸€ä¸ªç©ºæ ¼ã€‚</p><h2 id="åŠ¨æ€ç»™LinearLayoutæ·»åŠ å­View"><a href="#åŠ¨æ€ç»™LinearLayoutæ·»åŠ å­View" class="headerlink" title="åŠ¨æ€ç»™LinearLayoutæ·»åŠ å­View"></a>åŠ¨æ€ç»™LinearLayoutæ·»åŠ å­View</h2><p>ä¸€åˆ—27ä¸ªè‡ªå®šä¹‰viewï¼Œå¦‚æœè¦å†™åˆ°xmlé‡Œå°±å¤ªéº»çƒ¦äº†ã€‚<br>åœ¨Javaä»£ç ä¸­æ–°å»ºå­Viewï¼Œè®¾ç½®LayoutParamsï¼Œç„¶åæ·»åŠ åˆ°LinearLayouté‡Œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initGrids</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">bigGridHeightPx</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) dpToPx(<span class="hljs-number">10</span>);<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">bigGrid2MarginVerticalPx</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) dpToPx(<span class="hljs-number">3</span>);<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">smallGridHeightPx</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) dpToPx(<span class="hljs-number">6</span>); <span class="hljs-comment">// è¿™é‡Œæœ‰27ä¸ªæ ¼ç‚¹</span><br>    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">smallGridMarginBotPx</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) dpToPx(<span class="hljs-number">1</span>);<br><br>    <span class="hljs-type">LinearLayout</span> <span class="hljs-variable">linearLayoutLeft1</span> <span class="hljs-operator">=</span> findViewById(R.id.dp_page_g_field_left1);<br>    <span class="hljs-type">LinearLayout</span> <span class="hljs-variable">linearLayoutLeft2</span> <span class="hljs-operator">=</span> findViewById(R.id.dp_page_g_field_left2);<br>    mLeftGridList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-type">GridsHorView</span> <span class="hljs-variable">g1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GridsHorView</span>(<span class="hljs-built_in">this</span>);<br>    <span class="hljs-type">GridsHorView</span> <span class="hljs-variable">g2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GridsHorView</span>(<span class="hljs-built_in">this</span>);<br>    <span class="hljs-type">GridsHorView</span> <span class="hljs-variable">g3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GridsHorView</span>(<span class="hljs-built_in">this</span>);<br><br>    LinearLayout.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">p1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearLayout</span>.LayoutParams(LinearLayout.LayoutParams.MATCH_PARENT, bigGridHeightPx);<br>    LinearLayout.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">p2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearLayout</span>.LayoutParams(LinearLayout.LayoutParams.MATCH_PARENT, bigGridHeightPx);<br>    p2.setMargins(<span class="hljs-number">0</span>, bigGrid2MarginVerticalPx, <span class="hljs-number">0</span>, bigGrid2MarginVerticalPx);<br>    linearLayoutLeft1.addView(g1, p1);<br>    linearLayoutLeft1.addView(g2, p2);<br>    linearLayoutLeft1.addView(g3, p1);<br>    mLeftGridList.addAll(Arrays.asList(g1, g2, g3));<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">27</span>; i++) &#123;<br>        <span class="hljs-type">GridsHorView</span> <span class="hljs-variable">smallGrid</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">GridsHorView</span>(<span class="hljs-built_in">this</span>);<br>        smallGrid.setAlphaValue((<span class="hljs-type">int</span>) (<span class="hljs-number">255</span> * (<span class="hljs-number">1</span> - <span class="hljs-number">0.02</span> * i)));<br>        LinearLayout.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">sp</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearLayout</span>.LayoutParams(LinearLayout.LayoutParams.MATCH_PARENT, smallGridHeightPx);<br>        sp.setMargins(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, smallGridMarginBotPx);<br>        mLeftGridList.add(smallGrid);<br>        linearLayoutLeft2.addView(smallGrid, sp);<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (GridsHorView g : mLeftGridList) &#123;<br>        g.setOri(GridsHorView.Ori.RIGHT_TO_LEFT);<br>        g.disableMode();<br>        g.setCubeCount(<span class="hljs-number">1</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// åˆå§‹åŒ–å³è¾¹ï¼ˆP2ï¼‰çš„æ ¼å­...</span><br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-type">float</span> <span class="hljs-title function_">dpToPx</span><span class="hljs-params">(<span class="hljs-type">float</span> dp)</span> &#123;<br>    <span class="hljs-keyword">return</span> dp * getResources().getDisplayMetrics().density;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è·å–å½“å‰WiFiçš„åå­—"><a href="#è·å–å½“å‰WiFiçš„åå­—" class="headerlink" title="è·å–å½“å‰WiFiçš„åå­—"></a>è·å–å½“å‰WiFiçš„åå­—</h2><p>éœ€è¦å®šä½æƒé™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getWiFiName</span><span class="hljs-params">(Context context)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">wifiId</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;WIFI_NAME_NOT_FOUND&quot;</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">WifiManager</span> <span class="hljs-variable">wifiMgr</span> <span class="hljs-operator">=</span> (WifiManager) context.getSystemService(Context.WIFI_SERVICE);<br>        <span class="hljs-type">WifiInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> wifiMgr.getConnectionInfo();<br>        wifiId = info != <span class="hljs-literal">null</span> ? info.getSSID() : <span class="hljs-literal">null</span>;<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!TextUtils.isEmpty(wifiId) &amp;&amp; wifiId.startsWith(<span class="hljs-string">&quot;\&quot;&quot;</span>)) &#123;<br>        wifiId = wifiId.substring(<span class="hljs-number">1</span>); <span class="hljs-comment">// åˆ å»å‰é¢é‚£ä¸ªå¼•å·</span><br>    &#125;<br>    <span class="hljs-keyword">return</span> wifiId;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºåˆ¤æ–­WiFiåç§°çš„å‰ç¼€ã€‚</p><h2 id="æ£€æŸ¥æƒé™çš„æ–¹æ³•"><a href="#æ£€æŸ¥æƒé™çš„æ–¹æ³•" class="headerlink" title="æ£€æŸ¥æƒé™çš„æ–¹æ³•"></a>æ£€æŸ¥æƒé™çš„æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkPermission</span><span class="hljs-params">(String[] permissions, <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> reqCode)</span> &#123;<br>    List&lt;String&gt; perList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">for</span> (String p : permissions) &#123;<br>        <span class="hljs-keyword">if</span> (PackageManager.PERMISSION_GRANTED != ContextCompat.checkSelfPermission(<span class="hljs-built_in">this</span>, p)) &#123;<br>            LL.e(<span class="hljs-string">&quot;æ²¡æœ‰æƒé™: &quot;</span> + p);<br>            perList.add(p);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!perList.isEmpty()) &#123;<br>        String[] per = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[perList.size()];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; per.length; i++) &#123;<br>            per[i] = perList.get(i);<br>        &#125;<br>        ActivityCompat.requestPermissions(<span class="hljs-built_in">this</span>, per, reqCode);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è®¾ç½®Clickç›‘å¬å™¨"><a href="#è®¾ç½®Clickç›‘å¬å™¨" class="headerlink" title="è®¾ç½®Clickç›‘å¬å™¨"></a>è®¾ç½®Clickç›‘å¬å™¨</h2><p>åº”ç”¨åœ¨Activityä¸­ï¼Œç»™ä¸€å †viewè®¾ç½®åŒä¸€ä¸ªç›‘å¬å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è®¾ç½®ç‚¹å‡»ç›‘å¬å™¨</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOnClickListeners</span><span class="hljs-params">(View.OnClickListener l, View... views)</span> &#123;<br>    <span class="hljs-keyword">for</span> (View v : views) &#123;<br>        v.setOnClickListener(l);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setOnClickListeners</span><span class="hljs-params">(View.OnClickListener l, <span class="hljs-type">int</span>... resIds)</span> &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> r : resIds) &#123;<br>        findViewById(r).setOnClickListener(l);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è®¾ç½®å­—ä½“"><a href="#è®¾ç½®å­—ä½“" class="headerlink" title="è®¾ç½®å­—ä½“"></a>è®¾ç½®å­—ä½“</h2><p>å…ˆæŠŠå­—ä½“åŠ è½½å¥½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTvPangMenAndItalic</span><span class="hljs-params">(<span class="hljs-type">int</span>... tvResIds)</span> &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i : tvResIds) &#123;<br>        ((TextView) findViewById(i)).setTypeface(AppControl.getPangMenTf(), Typeface.ITALIC);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTvPangMenAndItalic</span><span class="hljs-params">(TextView... tvs)</span> &#123;<br>    <span class="hljs-keyword">for</span> (TextView t : tvs) &#123;<br>        t.setTypeface(AppControl.getPangMenTf(), Typeface.ITALIC);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ”¶èµ·è½¯é”®ç›˜"><a href="#æ”¶èµ·è½¯é”®ç›˜" class="headerlink" title="æ”¶èµ·è½¯é”®ç›˜"></a>æ”¶èµ·è½¯é”®ç›˜</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">hideSoftKeyboard</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">InputMethodManager</span> <span class="hljs-variable">inputMgr</span> <span class="hljs-operator">=</span> (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);<br>        inputMgr.hideSoftInputFromWindow(getCurrentFocus().getWindowToken(), InputMethodManager.HIDE_NOT_ALWAYS);<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        LL.e(<span class="hljs-string">&quot;rustApp&quot;</span>, e);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="åˆ¤æ–­ç½‘ç»œæ˜¯å¦æœ‰è¿æ¥"><a href="#åˆ¤æ–­ç½‘ç»œæ˜¯å¦æœ‰è¿æ¥" class="headerlink" title="åˆ¤æ–­ç½‘ç»œæ˜¯å¦æœ‰è¿æ¥"></a>åˆ¤æ–­ç½‘ç»œæ˜¯å¦æœ‰è¿æ¥</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isNetworkAvailable</span><span class="hljs-params">(Context context)</span> &#123;<br>    <span class="hljs-type">ConnectivityManager</span> <span class="hljs-variable">connectivity</span> <span class="hljs-operator">=</span> (ConnectivityManager) context.getSystemService(Context.CONNECTIVITY_SERVICE);<br><br>    <span class="hljs-keyword">if</span> (connectivity == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        NetworkInfo[] info = connectivity.getAllNetworkInfo();<br>        <span class="hljs-keyword">if</span> (info != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">for</span> (NetworkInfo anInfo : info) &#123;<br>                <span class="hljs-keyword">if</span> (anInfo.getState() == NetworkInfo.State.CONNECTED) &#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="åˆ¤æ–­æŸä¸ªAppæ˜¯å¦å®‰è£…"><a href="#åˆ¤æ–­æŸä¸ªAppæ˜¯å¦å®‰è£…" class="headerlink" title="åˆ¤æ–­æŸä¸ªAppæ˜¯å¦å®‰è£…"></a>åˆ¤æ–­æŸä¸ªAppæ˜¯å¦å®‰è£…</h2><p>è·å–PackageManageré€šè¿‡åŒ…åæ¥åˆ¤æ–­æŸä¸ªAppæ˜¯å¦å®‰è£…ã€‚<br>ä½†æ˜¯æœ‰çš„æ‰‹æœºåœ¨è·å–PackageManagerçš„æ—¶å€™å°±èƒ½æŠ›å‡ºå¼‚å¸¸ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">appInstalledOrNot</span><span class="hljs-params">(String uri)</span> &#123;<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">PackageManager</span> <span class="hljs-variable">pm</span> <span class="hljs-operator">=</span> getPackageManager();<br>        pm.getPackageInfo(uri, PackageManager.GET_ACTIVITIES);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>        LL.e(<span class="hljs-string">&quot;appInstalledOrNot: &quot;</span> + uri, e);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>æ€»è€Œè¨€ä¹‹è¿™å¹¶ä¸æ˜¯ä¸ªå¾ˆå¥½çš„åŠæ³•ã€‚</p><h2 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h2><p>ä¸€äº›æ€§èƒ½ä¼˜åŒ–çš„å¤„ç†æªæ–½å’Œæ€è€ƒã€‚</p><h3 id="ç»™UIçº¿ç¨‹æ›´å¤šçš„CPUèµ„æº"><a href="#ç»™UIçº¿ç¨‹æ›´å¤šçš„CPUèµ„æº" class="headerlink" title="ç»™UIçº¿ç¨‹æ›´å¤šçš„CPUèµ„æº"></a>ç»™UIçº¿ç¨‹æ›´å¤šçš„CPUèµ„æº</h3><p>æ•°æ®åº“çš„æ“ä½œæ”¾åœ¨å­çº¿ç¨‹ä¸­è¿›è¡Œã€‚æ•°æ®åº“çº¿ç¨‹ä¹Ÿå¯èƒ½ä¼šå’ŒUIçº¿ç¨‹äº‰æŠ¢CPUçš„æ—¶é—´ç‰‡ã€‚<br>å‡è®¾æ•°æ®åº“è¦åˆ é™¤å¤§é‡æ•°æ®ï¼ˆæ¯”å¦‚1ä¸‡æ¡ï¼‰ã€‚<br>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•åœ¨æ•°æ®åº“å¤„ç†äº†æŸä¸ªæ•°é‡ï¼ˆä¾‹å¦‚1åƒï¼‰çš„æ“ä½œåï¼Œsleepä¸€ä¸‹ï¼Œç»™UIçº¿ç¨‹è®©å‡ºCPUæ—¶é—´ã€‚<br>ä½†ç°åœ¨ä¸€èˆ¬éƒ½æ˜¯å¤šæ ¸æ‰‹æœºï¼Œå…·ä½“æ•ˆæœæœ‰å¾…è€ƒé‡ã€‚</p><h2 id="logè®°å½•å·¥å…·"><a href="#logè®°å½•å·¥å…·" class="headerlink" title="logè®°å½•å·¥å…·"></a>logè®°å½•å·¥å…·</h2><p>æŠŠlogå†™åˆ°æ–‡ä»¶é‡Œã€‚ç”¨RandomAccessFileä¸MappedByteBufferå†™æ—¥å¿—åˆ°æ–‡ä»¶ä¸­ã€‚ä»»åŠ¡å¤„ç†æ”¾åœ¨å­çº¿ç¨‹ä¸­ï¼Œç”±HandlerThreadæ¥ç®¡ç†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LL</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Level</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">D</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;D&quot;</span>; <span class="hljs-comment">// æ™®é€šdebug</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">W</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;W&quot;</span>; <span class="hljs-comment">// è­¦å‘Š</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">E</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;E&quot;</span>; <span class="hljs-comment">// é”™è¯¯</span><br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">defTag</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;App&quot;</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">showLogcat</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">writeFile</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br><br>    <span class="hljs-comment">// æ³¨æ„ç”³è¯·SDå¡è¯»å†™æƒé™</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">logFileDir</span> <span class="hljs-operator">=</span> Environment.getExternalStorageDirectory().getAbsolutePath() +<br>            File.separator + <span class="hljs-string">&quot;rust&quot;</span> + File.separator + <span class="hljs-string">&quot;logs&quot;</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String fileName;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;LogListener&gt; listenerList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> HandlerThread handlerThread;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Handler writerHandler;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">LOG_FILE_GROW_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">1024</span> * <span class="hljs-number">10</span>; <span class="hljs-comment">// logæ–‡ä»¶æ¯æ¬¡å¢é•¿çš„å¤§å°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-variable">gCurrentLogPos</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;                  <span class="hljs-comment">// logæ–‡ä»¶å½“å‰å†™åˆ°çš„ä½ç½® - æ³¨æ„è¦å•çº¿ç¨‹å¤„ç†</span><br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä½¿ç”¨å‰å¿…é¡»è°ƒç”¨æ­¤æ–¹æ³•è¿›è¡Œå‡†å¤‡</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> context å»ºè®®ä¼ å…¥applicationContext</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> fileDir å­˜æ”¾logæ–‡ä»¶çš„ç›®å½•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepare</span><span class="hljs-params">(Context context, <span class="hljs-meta">@NonNull</span> String fileDir, String logFilePrefix)</span> &#123;<br>        gCurrentLogPos = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">if</span> (TextUtils.isEmpty(fileDir)) &#123;<br>            <span class="hljs-keyword">if</span> (Environment.getExternalStorageState().equals(<br>                    Environment.MEDIA_MOUNTED)) &#123;<br>                logFileDir = Environment.getExternalStorageDirectory().getAbsolutePath() +<br>                        File.separator + <span class="hljs-string">&quot;rust&quot;</span> + File.separator + <span class="hljs-string">&quot;logs&quot;</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                logFileDir = context.getFilesDir().getAbsolutePath() +<br>                        File.separator + <span class="hljs-string">&quot;rust&quot;</span> + File.separator + <span class="hljs-string">&quot;logs&quot;</span>;<br>            &#125;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            logFileDir = fileDir;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == handlerThread) &#123;<br>            handlerThread = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HandlerThread</span>(<span class="hljs-string">&quot;LL&quot;</span>);<br>            handlerThread.start();<br>        &#125;<br>        writerHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(handlerThread.getLooper());<br>        fileName = logFilePrefix + <span class="hljs-string">&quot;_&quot;</span> + System.currentTimeMillis() + <span class="hljs-string">&quot;.txt&quot;</span>;<br>        Log.d(defTag, <span class="hljs-string">&quot;[prepare] file: &quot;</span> + fileName);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getLogFileDir</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> logFileDir;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">getFileName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> fileName;<br>    &#125;<br><br>    <span class="hljs-comment">// é€€å‡º</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quit</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (writerHandler != <span class="hljs-literal">null</span>) &#123;<br>            writerHandler.removeCallbacksAndMessages(<span class="hljs-literal">null</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (handlerThread != <span class="hljs-literal">null</span>) &#123;<br>            handlerThread.quit();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDefTag</span><span class="hljs-params">(String t)</span> &#123;<br>        LL.defTag = t;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setWriteFile</span><span class="hljs-params">(<span class="hljs-type">boolean</span> w)</span> &#123;<br>        LL.writeFile = w;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">d</span><span class="hljs-params">(String content)</span> &#123;<br>        d(defTag, content, writeFile);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">d</span><span class="hljs-params">(String tag, String content)</span> &#123;<br>        d(tag, content, writeFile);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dn</span><span class="hljs-params">(String content)</span> &#123;<br>        d(defTag, content, <span class="hljs-literal">false</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// ä¸å†™åˆ°æ–‡ä»¶ä¸­</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dn</span><span class="hljs-params">(String tag, String content)</span> &#123;<br>        d(tag, content, <span class="hljs-literal">false</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">d</span><span class="hljs-params">(String tag, String content, <span class="hljs-type">boolean</span> write)</span> &#123;<br>        <span class="hljs-keyword">if</span> (showLogcat) &#123;<br>            Log.d(tag, content);<br>        &#125;<br>        tellLog(Level.D, tag, content);<br>        <span class="hljs-keyword">if</span> (write) &#123;<br>            <span class="hljs-keyword">if</span> (writerHandler != <span class="hljs-literal">null</span>) &#123;<br>                writerHandler.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WriteRunnable</span>(tag, content));<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// logçº§åˆ« WARN - w</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">w</span><span class="hljs-params">(String content)</span> &#123;<br>        w(defTag, content, writeFile);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">w</span><span class="hljs-params">(String tag, String content)</span> &#123;<br>        w(tag, content, writeFile);<br>    &#125;<br><br>    <span class="hljs-comment">// ä¸å†™åˆ°æ–‡ä»¶ä¸­</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">wn</span><span class="hljs-params">(String content)</span> &#123;<br>        w(defTag, content, <span class="hljs-literal">false</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// ä¸å†™åˆ°æ–‡ä»¶ä¸­</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">wn</span><span class="hljs-params">(String tag, String content)</span> &#123;<br>        w(tag, content, <span class="hljs-literal">false</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">w</span><span class="hljs-params">(String tag, String content, <span class="hljs-type">boolean</span> write)</span> &#123;<br>        <span class="hljs-keyword">if</span> (showLogcat) &#123;<br>            Log.w(tag, content);<br>        &#125;<br>        tellLog(Level.W, tag, content);<br>        <span class="hljs-keyword">if</span> (write) &#123;<br>            <span class="hljs-keyword">if</span> (writerHandler != <span class="hljs-literal">null</span>) &#123;<br>                writerHandler.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WriteRunnable</span>(tag, content));<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">e</span><span class="hljs-params">(String content)</span> &#123;<br>        e(defTag, content);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">e</span><span class="hljs-params">(String tag, String content)</span> &#123;<br>        e(tag, content, writeFile);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">e</span><span class="hljs-params">(String tag, Exception e)</span> &#123;<br>        e(tag, e.getMessage(), writeFile);<br>    &#125;<br><br>    <span class="hljs-comment">// åªæ‰“log  ä¸å†™æ–‡ä»¶</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">en</span><span class="hljs-params">(String tag, String content)</span> &#123;<br>        e(tag, content, <span class="hljs-literal">false</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">e</span><span class="hljs-params">(String tag, String content, <span class="hljs-type">boolean</span> write)</span> &#123;<br>        <span class="hljs-keyword">if</span> (showLogcat) &#123;<br>            Log.e(tag, content);<br>        &#125;<br>        tellLog(Level.E, tag, content);<br>        <span class="hljs-keyword">if</span> (write) &#123;<br>            <span class="hljs-keyword">if</span> (writerHandler != <span class="hljs-literal">null</span>) &#123;<br>                writerHandler.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WriteRunnable</span>(tag, content));<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">tellLog</span><span class="hljs-params">(String level, String tag, String content)</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != listenerList) &#123;<br>            <span class="hljs-keyword">for</span> (LogListener l : listenerList) &#123;<br>                l.onLog(level, tag, content);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addListener</span><span class="hljs-params">(LogListener l)</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == listenerList) &#123;<br>            listenerList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        &#125;<br>        listenerList.add(l);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeListener</span><span class="hljs-params">(LogListener l)</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != listenerList) &#123;<br>            listenerList.remove(l);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WriteRunnable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br>        String mmTag;<br>        String mmContent;<br><br>        WriteRunnable(String tag, String content) &#123;<br>            <span class="hljs-built_in">this</span>.mmTag = tag;<br>            <span class="hljs-built_in">this</span>.mmContent = content;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">logTimeFormat</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;HH:mm:ss.SSS&quot;</span>, Locale.CHINA);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">logContent</span> <span class="hljs-operator">=</span> logTimeFormat.format(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()) + <span class="hljs-string">&quot; [&quot;</span> + mmTag + <span class="hljs-string">&quot;] &quot;</span> + mmContent + <span class="hljs-string">&quot;\r\n&quot;</span>;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-type">File</span> <span class="hljs-variable">dir</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(logFileDir);<br>                <span class="hljs-keyword">if</span> (!dir.exists()) &#123;<br>                    <span class="hljs-type">boolean</span> <span class="hljs-variable">mk</span> <span class="hljs-operator">=</span> dir.mkdirs();<br>                    Log.d(defTag, <span class="hljs-string">&quot;make dir &quot;</span> + mk);<br>                &#125;<br>                <span class="hljs-type">File</span> <span class="hljs-variable">eFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(logFileDir + File.separator + fileName);<br>                <span class="hljs-type">byte</span>[] strBytes = logContent.getBytes();<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">RandomAccessFile</span> <span class="hljs-variable">randomAccessFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RandomAccessFile</span>(eFile, <span class="hljs-string">&quot;rw&quot;</span>);<br>                    MappedByteBuffer mappedByteBuffer;<br>                    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">inputLen</span> <span class="hljs-operator">=</span> strBytes.length;<br>                    <span class="hljs-keyword">if</span> (!eFile.exists()) &#123;<br>                        <span class="hljs-type">boolean</span> <span class="hljs-variable">nf</span> <span class="hljs-operator">=</span> eFile.createNewFile();<br>                        Log.d(defTag, <span class="hljs-string">&quot;new log file &quot;</span> + nf);<br>                        mappedByteBuffer = randomAccessFile.getChannel().map(FileChannel.MapMode.READ_WRITE, gCurrentLogPos, LOG_FILE_GROW_SIZE);<br>                    &#125; <span class="hljs-keyword">else</span> &#123;<br>                        mappedByteBuffer = randomAccessFile.getChannel().map(FileChannel.MapMode.READ_WRITE, gCurrentLogPos, inputLen);<br>                    &#125;<br>                    <span class="hljs-keyword">if</span> (mappedByteBuffer.remaining() &lt; inputLen) &#123;<br>                        mappedByteBuffer = randomAccessFile.getChannel().map(FileChannel.MapMode.READ_WRITE, gCurrentLogPos, LOG_FILE_GROW_SIZE + inputLen);<br><span class="hljs-comment">//                        Log.d(defTag, &quot;run: grow size &quot;);</span><br>                    &#125;<br><span class="hljs-comment">//                    Log.d(defTag, &quot;run: gCurrentLogPos: &quot; + gCurrentLogPos + &quot;, pos: &quot; + mappedByteBuffer.position() + &quot;, remaining: &quot; + mappedByteBuffer.remaining());</span><br>                    mappedByteBuffer.put(strBytes);<br>                    gCurrentLogPos += inputLen;<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    Log.e(defTag, <span class="hljs-string">&quot;WriteRunnable run: &quot;</span>, e);<br>                    <span class="hljs-keyword">if</span> (!eFile.exists()) &#123;<br>                        <span class="hljs-type">boolean</span> <span class="hljs-variable">nf</span> <span class="hljs-operator">=</span> eFile.createNewFile();<br>                        Log.d(defTag, <span class="hljs-string">&quot;new log file &quot;</span> + nf);<br>                    &#125;<br>                    <span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(eFile, <span class="hljs-literal">true</span>);<br>                    os.write(logContent.getBytes());<br>                    os.flush();<br>                    os.close();<br>                &#125;<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>                Log.e(defTag, <span class="hljs-string">&quot;å†™logæ–‡ä»¶å‡ºé”™: &quot;</span>, e);<br>            &#125;<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>ç›‘å¬å™¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogListener</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLog</span><span class="hljs-params">(String level, String tag, String content)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è‡ªå®šä¹‰View"><a href="#è‡ªå®šä¹‰View" class="headerlink" title="è‡ªå®šä¹‰View"></a>è‡ªå®šä¹‰View</h2><p>ä¸€äº›è‡ªå®šä¹‰çš„viewï¼Œæ¯”å¦‚ä¸€äº›æŠ˜çº¿å›¾ï¼Œæ¡å½¢å›¾ã€‚</p><h3 id="æŠ˜çº¿å›¾-ColorAutoLineChart"><a href="#æŠ˜çº¿å›¾-ColorAutoLineChart" class="headerlink" title="æŠ˜çº¿å›¾ ColorAutoLineChart"></a>æŠ˜çº¿å›¾ ColorAutoLineChart</h3><p>å•ç‹¬ä¸€æ¡æŠ˜çº¿ï¼Œå¯è‡ªåŠ¨ç¼©æ”¾Yè½´é«˜åº¦ã€‚ä½¿ç”¨FloatBufferæ¥å­˜å‚¨æ•°æ®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ColorAutoLineChart</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">View</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;AppColorAutoLineChart&quot;</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> <span class="hljs-variable">yMax</span> <span class="hljs-operator">=</span> <span class="hljs-number">1856f</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> <span class="hljs-variable">yMin</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1024f</span>;<br><br>    <span class="hljs-comment">// å›¾è¡¨çº¿æ¡åœ¨viewé¡¶éƒ¨ç•™å‡ºçš„é—´è·</span><br>    <span class="hljs-type">float</span> <span class="hljs-variable">viewYStart</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-type">float</span> <span class="hljs-variable">axisTextSize</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">onShowPointsCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">256</span>;  <span class="hljs-comment">// å½“å‰æ˜¾ç¤ºçš„æ•°æ®ä¸ªæ•°</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">cacheMaxPoint</span> <span class="hljs-operator">=</span> <span class="hljs-number">9000</span>;     <span class="hljs-comment">// æ•°æ®å­˜å‚¨æœ€å¤§ä¸ªæ•°</span><br><br>    <span class="hljs-type">float</span> <span class="hljs-variable">axisLineWid</span> <span class="hljs-operator">=</span> <span class="hljs-number">1f</span>; <span class="hljs-comment">// åæ ‡è½´çº¿æ¡å®½åº¦</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">dataLineWid</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br><br>    <span class="hljs-comment">// æ•°æ®çº¿é¢œè‰²</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">dataColor</span> <span class="hljs-operator">=</span> Color.WHITE;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> <span class="hljs-variable">xStep</span> <span class="hljs-operator">=</span> <span class="hljs-number">1.0f</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> viewWidth;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> viewHeight;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> <span class="hljs-variable">botLeftXOnView</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// å›¾è¡¨å·¦ä¸‹ç‚¹åœ¨viewä¸­çš„xåæ ‡</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> <span class="hljs-variable">botLeftYOnView</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> <span class="hljs-variable">originYToBottom</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>; <span class="hljs-comment">// å›¾è¡¨åŸç‚¹è·ç¦»viewåº•éƒ¨çš„è·ç¦»</span><br><br>    <span class="hljs-keyword">private</span> FloatBuffer dataBuffer;<br><br>    <span class="hljs-keyword">private</span> Paint bgPaint;<br>    <span class="hljs-keyword">private</span> Paint linePaint;<br>    <span class="hljs-keyword">private</span> Paint wavePaint;<br>    <span class="hljs-type">Path</span> <span class="hljs-variable">wavePath</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(); <span class="hljs-comment">// ç”¨æ¥ç”»æ¸å˜è‰²</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">waveTopColor</span> <span class="hljs-operator">=</span> Color.parseColor(<span class="hljs-string">&quot;#f65212&quot;</span>);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ColorAutoLineChart</span><span class="hljs-params">(Context context)</span> &#123;<br>        <span class="hljs-built_in">this</span>(context, <span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ColorAutoLineChart</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> &#123;<br>        <span class="hljs-built_in">this</span>(context, attrs, <span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ColorAutoLineChart</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> &#123;<br>        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);<br>        init(context);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addData</span><span class="hljs-params">(<span class="hljs-type">int</span>[] data)</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i : data) &#123;<br>            addData(i);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addData</span><span class="hljs-params">(<span class="hljs-type">float</span> data)</span> &#123;<br>        dataBuffer.put(data);<br>        <span class="hljs-keyword">if</span> (dataBuffer.position() &gt; (dataBuffer.capacity() * <span class="hljs-number">2</span> / <span class="hljs-number">3</span>)) &#123;<br>            <span class="hljs-type">float</span>[] bufferArr = dataBuffer.array();<br>            System.arraycopy(bufferArr, dataBuffer.position() - cacheMaxPoint, bufferArr, <span class="hljs-number">0</span>, cacheMaxPoint);<br>            dataBuffer.position(cacheMaxPoint);<br><span class="hljs-comment">//            Log.d(TAG, &quot;æŠŠå½“å‰æ•°æ®ç§»åŠ¨åˆ°bufferèµ·å§‹ä½ç½® &quot; + dataBuffer);</span><br>        &#125;<br>        invalidate();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(Context context)</span> &#123;<br>        dataBuffer = FloatBuffer.allocate(<span class="hljs-number">3</span> * cacheMaxPoint); <span class="hljs-comment">// åˆ†é…3å€çš„ç©ºé—´</span><br>        bgPaint = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paint</span>(Paint.ANTI_ALIAS_FLAG);<br>        linePaint = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paint</span>(Paint.ANTI_ALIAS_FLAG);<br>        wavePaint = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paint</span>(Paint.ANTI_ALIAS_FLAG);<br>        bgPaint.setStrokeWidth(axisLineWid);<br>        bgPaint.setStyle(Paint.Style.STROKE);<br>        linePaint.setStrokeWidth(dataLineWid);<br>        linePaint.setStyle(Paint.Style.STROKE);<br>        linePaint.setColor(dataColor);<br><br>        botLeftXOnView = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, <span class="hljs-number">0</span>, context.getResources().getDisplayMetrics());<br>        originYToBottom = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, <span class="hljs-number">20</span>, context.getResources().getDisplayMetrics());<br>        viewYStart = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, <span class="hljs-number">20</span>, context.getResources().getDisplayMetrics());<br>        axisLineWid = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_DIP, <span class="hljs-number">1</span>, context.getResources().getDisplayMetrics());<br>        axisTextSize = TypedValue.applyDimension(TypedValue.COMPLEX_UNIT_SP, <span class="hljs-number">8</span>, context.getResources().getDisplayMetrics());<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSizeChanged</span><span class="hljs-params">(<span class="hljs-type">int</span> w, <span class="hljs-type">int</span> h, <span class="hljs-type">int</span> oldw, <span class="hljs-type">int</span> oldh)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onSizeChanged(w, h, oldw, oldh);<br>        viewWidth = getWidth();<br>        viewHeight = getHeight();<br>        botLeftYOnView = viewHeight - originYToBottom;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDraw</span><span class="hljs-params">(Canvas canvas)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onDraw(canvas);<br>        canvas.drawColor(Color.TRANSPARENT);<br>        xStep = (viewWidth - botLeftXOnView) / (onShowPointsCount - <span class="hljs-number">1</span>);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">dataStartIndexInBuffer</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// æ•°æ®åœ¨bufferä¸­çš„èµ·å§‹ä¸‹æ ‡</span><br>        <span class="hljs-keyword">if</span> (dataBuffer.position() &gt; onShowPointsCount) &#123;<br>            dataStartIndexInBuffer = dataBuffer.position() - onShowPointsCount;<br>        &#125;<br>        <span class="hljs-type">float</span>[] bufferArr = dataBuffer.array();<br>        <span class="hljs-type">float</span> <span class="hljs-variable">maxData</span> <span class="hljs-operator">=</span> bufferArr[<span class="hljs-number">0</span>];<br>        <span class="hljs-type">float</span> <span class="hljs-variable">minData</span> <span class="hljs-operator">=</span> bufferArr[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> dataStartIndexInBuffer; i &lt; dataBuffer.position(); i++) &#123;<br>            <span class="hljs-type">float</span> <span class="hljs-variable">cur</span> <span class="hljs-operator">=</span> bufferArr[i];<br>            <span class="hljs-keyword">if</span> (cur &lt; minData) &#123;<br>                minData = cur;<br>            &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cur &gt; maxData) &#123;<br>                maxData = cur;<br>            &#125;<br>        &#125;<br><br>        drawWave(canvas, dataStartIndexInBuffer);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drawWave</span><span class="hljs-params">(Canvas canvas, <span class="hljs-type">int</span> dataStartIndexInBuffer)</span> &#123;<br>        wavePath.reset();<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> <span class="hljs-variable">yDataRange</span> <span class="hljs-operator">=</span> yMax - yMin;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> <span class="hljs-variable">yAxisRangeOnView</span> <span class="hljs-operator">=</span> botLeftYOnView - viewYStart;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">float</span> <span class="hljs-variable">yDataStep</span> <span class="hljs-operator">=</span> yAxisRangeOnView / yDataRange;<br><br>        <span class="hljs-type">float</span>[] dataArr = dataBuffer.array();<br>        <span class="hljs-type">float</span> <span class="hljs-variable">maxData</span> <span class="hljs-operator">=</span> dataArr[dataStartIndexInBuffer];<br><br>        <span class="hljs-type">float</span> <span class="hljs-variable">waveStartX</span> <span class="hljs-operator">=</span> botLeftXOnView;<br>        <span class="hljs-type">float</span> <span class="hljs-variable">waveStartY</span> <span class="hljs-operator">=</span> getYL(dataArr[dataStartIndexInBuffer], yDataStep);<br>        wavePath.moveTo(waveStartX, waveStartY);<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> dataStartIndexInBuffer; i &lt; dataBuffer.position() - <span class="hljs-number">1</span>; i++) &#123;<br>            <span class="hljs-type">float</span> <span class="hljs-variable">curData</span> <span class="hljs-operator">=</span> dataArr[i];<br>            <span class="hljs-type">float</span> <span class="hljs-variable">nextData</span> <span class="hljs-operator">=</span> dataArr[i + <span class="hljs-number">1</span>];<br>            wavePath.lineTo(botLeftXOnView + (i - dataStartIndexInBuffer + <span class="hljs-number">1</span>) * xStep, getYL(nextData, yDataStep));<br>            canvas.drawLine(botLeftXOnView + (i - dataStartIndexInBuffer) * xStep, getYL(curData, yDataStep),<br>                    botLeftXOnView + (i - dataStartIndexInBuffer + <span class="hljs-number">1</span>) * xStep, getYL(nextData, yDataStep),<br>                    linePaint);<br>            maxData = Math.max(maxData, nextData);<br>        &#125;<br>        wavePath.lineTo(viewWidth, viewHeight);<br>        wavePath.lineTo(botLeftXOnView, viewHeight);<br>        wavePath.lineTo(waveStartX, waveStartY);<br>        wavePath.close();<br>        wavePaint.setShader(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LinearGradient</span>(<span class="hljs-number">0</span>, getYL(maxData, yDataStep), <span class="hljs-number">0</span>, viewHeight, waveTopColor, Color.TRANSPARENT, Shader.TileMode.CLAMP));<br>        canvas.drawPath(wavePath, wavePaint);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">float</span> <span class="hljs-title function_">getYL</span><span class="hljs-params">(<span class="hljs-keyword">final</span> <span class="hljs-type">float</span> yData, <span class="hljs-type">float</span> yDataStep)</span> &#123;<br>        <span class="hljs-keyword">return</span> botLeftYOnView - (yData - yMin) * yDataStep;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="åå°ç”¨æˆ·è¡Œä¸ºè®°å½•"><a href="#åå°ç”¨æˆ·è¡Œä¸ºè®°å½•" class="headerlink" title="åå°ç”¨æˆ·è¡Œä¸ºè®°å½•"></a>åå°ç”¨æˆ·è¡Œä¸ºè®°å½•</h2><p>æœ€å¼€å§‹è®¾è®¡åå°æœåŠ¡çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åˆ°å¤ªå¤šçš„è®°å½•åŠŸèƒ½ã€‚ä»…ä»…è®°å½•äº†ç”¨æˆ·ç™»å½•è¡Œä¸ºã€‚<br>ä»Šååº”è¯¥è®°å½•æ›´è¯¦ç»†çš„ã€‚ä¾‹å¦‚è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæ—¶é—´ï¼Œå®¢æˆ·ç«¯ç±»å‹ï¼ŒuserIDç­‰ç­‰ã€‚è·å–ç”¨æˆ·ä¿¡æ¯æ˜¯å¦æˆåŠŸï¼Œå¯ä½œä¸ºç¼“å­˜ç™»å½•çš„ä¾æ®ã€‚</p><p>åå°å¯ä»¥è®°å½•çš„ç”¨æˆ·è¡Œä¸ºï¼Œä¾‹å¦‚è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œç”¨æˆ·æŸ¥çœ‹é£è¡Œè®°å½•åˆ—è¡¨ï¼Œç”¨æˆ·æŸ¥çœ‹é£è¡Œè®°å½•è¯¦æƒ…ï¼Œç”¨æˆ·ç‚¹èµã€‚</p><h2 id="WebViewè®¾ç½®"><a href="#WebViewè®¾ç½®" class="headerlink" title="WebViewè®¾ç½®"></a>WebViewè®¾ç½®</h2><p>webviewä¸æ˜¾ç¤ºå›¾ç‰‡çš„é—®é¢˜ã€‚LLååŠ è½½httpsçš„ç½‘é¡µï¼Œé»˜è®¤ä¼šä¸åŠ è½½httpçš„èµ„æºã€‚éœ€è¦è®¾ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">webSettings.setBlockNetworkImage(<span class="hljs-literal">false</span>);<br>webSettings.setMixedContentMode(WebSettings.MIXED_CONTENT_ALWAYS_ALLOW);<br></code></pre></td></tr></table></figure><h2 id="æ–¹æ³•è°ƒç”¨è®°å½•è°ƒç”¨åŸå› "><a href="#æ–¹æ³•è°ƒç”¨è®°å½•è°ƒç”¨åŸå› " class="headerlink" title="æ–¹æ³•è°ƒç”¨è®°å½•è°ƒç”¨åŸå› "></a>æ–¹æ³•è°ƒç”¨è®°å½•è°ƒç”¨åŸå› </h2><p>è°ƒç”¨æŸä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œæ¯”å¦‚ä¸­æ­¢æŸé¡¹åŠŸèƒ½ã€‚å¯ä»¥åœ¨logä¸Šè®°å½•ä¸€äº›åŸå› ï¼Œæ–¹ä¾¿debugã€‚</p><h2 id="Glide"><a href="#Glide" class="headerlink" title="Glide"></a>Glide</h2><h3 id="è®¾å®šæ’­æ”¾gifçš„æ¬¡æ•°"><a href="#è®¾å®šæ’­æ”¾gifçš„æ¬¡æ•°" class="headerlink" title="è®¾å®šæ’­æ”¾gifçš„æ¬¡æ•°"></a>è®¾å®šæ’­æ”¾gifçš„æ¬¡æ•°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">Glide.get(getApplicationContext()).setMemoryCategory(MemoryCategory.NORMAL);<br>Glide.with(<span class="hljs-built_in">this</span>).asGif().listener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestListener</span>&lt;GifDrawable&gt;() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onLoadFailed</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> GlideException e, Object model, Target&lt;GifDrawable&gt; target, <span class="hljs-type">boolean</span> isFirstResource)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">onResourceReady</span><span class="hljs-params">(GifDrawable resource, Object model, Target&lt;GifDrawable&gt; target, DataSource dataSource, <span class="hljs-type">boolean</span> isFirstResource)</span> &#123;<br>        resource.setLoopCount(<span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>&#125;).load(R.drawable.app_start_up).into(imageView);<br>imageView.setOnApplyWindowInsetsListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnApplyWindowInsetsListener() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> WindowInsets <span class="hljs-title function_">onApplyWindowInsets</span><span class="hljs-params">(View v, WindowInsets insets)</span> &#123;<br>        MyAppControl.setPhoneStatusBarHeight(insets.getSystemWindowInsetTop());<br>        <span class="hljs-keyword">return</span> insets;<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€å‘è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Flutter International å›½é™…åŒ–ï¼ŒLocalization æœ¬åœ°åŒ–ï¼Œ ä½¿ç”¨å­—ç¬¦ä¸²Map</title>
    <link href="/2018/07/16/Flutter/Flutter-International_localization_with_string_map/"/>
    <url>/2018/07/16/Flutter/Flutter-International_localization_with_string_map/</url>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸€ç§ç®€å•çš„æ–¹å¼å®ç°å­—ç¬¦ä¸²çš„å›½é™…åŒ–ã€‚</p><p>è¿™é‡Œæ²¡æœ‰ç”¨åˆ°<code>Intl</code>åŒ…ï¼Œè€Œæ˜¯å°†æ‰€éœ€çš„å­—ç¬¦ä¸²å­˜æ”¾åœ¨ä¸€ä¸ªmapä¸­ã€‚</p><p>æ­¥éª¤ï¼š</p><ul><li><code>MaterialApp</code>ä¸­æ·»åŠ æœ¬åœ°åŒ–ä»£ç†å’Œè¯­è¨€ç±»å‹</li><li>åˆ›å»ºæ–‡å­—èµ„æºæ–‡ä»¶</li><li>æ–°å»ºä¸€ä¸ªç±»ç»§æ‰¿<code>LocalizationsDelegate</code>ï¼Œå’Œæ–‡å­—èµ„æºæ–‡ä»¶è”ç³»èµ·æ¥</li><li>ä½¿ç”¨ä»£ç†è·å–æƒ³è¦çš„æ–‡å­—èµ„æº</li></ul><p>æ–°å»ºé¡¹ç›®<code>international_demo</code>ï¼Œå¾—åˆ°ä¸€ä¸ªå¸¦æŒ‰é’®ç¤ºä¾‹å·¥ç¨‹ã€‚æ”¹é€ ä¸€ä¸‹<code>MaterialApp</code>ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MaterialApp(<br>      title: <span class="hljs-string">&#x27;Flutter Demo&#x27;</span>,<br>      theme: <span class="hljs-keyword">new</span> ThemeData(<br>        primarySwatch: Colors.blue,<br>      ),<br>      localizationsDelegates: [<span class="hljs-comment">// æ·»åŠ åŒºåŸŸ</span><br>        <span class="hljs-comment">// å‡†å¤‡åœ¨è¿™é‡Œæ·»åŠ æˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„ä»£ç†</span><br>        GlobalMaterialLocalizations.delegate,<br>        GlobalWidgetsLocalizations.delegate,<br>      ],<br>      supportedLocales: [ <span class="hljs-comment">// æ·»åŠ åŒºåŸŸ</span><br>        <span class="hljs-keyword">const</span> Locale(<span class="hljs-string">&#x27;en&#x27;</span>, <span class="hljs-string">&#x27;US&#x27;</span>), <span class="hljs-comment">// English</span><br>        <span class="hljs-keyword">const</span> Locale(<span class="hljs-string">&#x27;he&#x27;</span>, <span class="hljs-string">&#x27;IL&#x27;</span>), <span class="hljs-comment">// Hebrew</span><br>        <span class="hljs-comment">// å¯ä»¥ç»§ç»­æ·»åŠ æˆ‘ä»¬æƒ³è¦æ”¯æŒçš„è¯­è¨€ç±»å‹</span><br>      ],<br>      home: <span class="hljs-keyword">new</span> MyHomePage(title: <span class="hljs-string">&#x27;Flutter Demo Home Page&#x27;</span>),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="åˆ›å»ºèµ„æºæ–‡ä»¶"><a href="#åˆ›å»ºèµ„æºæ–‡ä»¶" class="headerlink" title="åˆ›å»ºèµ„æºæ–‡ä»¶"></a>åˆ›å»ºèµ„æºæ–‡ä»¶</h3><p>æ–°å»º<code>localization_src.dart</code>ï¼Œå°†å­—ç¬¦ä¸²å­˜å…¥ä¸€ä¸ªmapä¸­ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DemoLocalizations</span> </span>&#123;<br>  DemoLocalizations(<span class="hljs-keyword">this</span>.locale);<br><br>  <span class="hljs-keyword">final</span> Locale locale;<br><br>  <span class="hljs-keyword">static</span> DemoLocalizations of(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Localizations.of&lt;DemoLocalizations&gt;(context, DemoLocalizations);<br>  &#125;<br><br>  <span class="hljs-keyword">static</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt;&gt; _localizedValues = &#123;<br>    <span class="hljs-string">&#x27;en&#x27;</span>: &#123;<br>      <span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;Hello World&#x27;</span>,<br>    &#125;,<br>    <span class="hljs-string">&#x27;es&#x27;</span>: &#123;<br>      <span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;Hola Mundo&#x27;</span>,<br>    &#125;,<br>    <span class="hljs-string">&#x27;zh&#x27;</span>: &#123;<br>      <span class="hljs-string">&#x27;title&#x27;</span>: <span class="hljs-string">&#x27;ä½ å¥½å‘€&#x27;</span>,<br>    &#125;,<br>  &#125;;<br><br>  <span class="hljs-built_in">String</span> <span class="hljs-keyword">get</span> title &#123;<br>    <span class="hljs-keyword">return</span> _localizedValues[locale.languageCode][<span class="hljs-string">&#x27;title&#x27;</span>];<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br>è¿™é‡Œä»…ä»¥<code>title</code>ä¸ºä¾‹ï¼Œæœ‰è‹±è¯­ã€è¥¿ç­ç‰™è¯­å’Œä¸­æ–‡ä¸‰ç§ã€‚</p><h3 id="åˆ›å»ºä»£ç†"><a href="#åˆ›å»ºä»£ç†" class="headerlink" title="åˆ›å»ºä»£ç†"></a>åˆ›å»ºä»£ç†</h3><p>æ–°å»ºä¸€ä¸ªç±»ç»§æ‰¿<code>LocalizationsDelegate</code>ï¼Œå¤å†™3ä¸ªæ–¹æ³•ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;dart:async&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/foundation.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:international_demo/localization_src.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DemoLocalizationsDelegate</span></span><br><span class="hljs-class">    <span class="hljs-keyword">extends</span> <span class="hljs-title">LocalizationsDelegate</span>&lt;<span class="hljs-title">DemoLocalizations</span>&gt; </span>&#123;<br>  <span class="hljs-keyword">const</span> DemoLocalizationsDelegate();<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-built_in">bool</span> isSupported(Locale locale) =&gt;<br>      [<span class="hljs-string">&#x27;en&#x27;</span>, <span class="hljs-string">&#x27;es&#x27;</span>, <span class="hljs-string">&#x27;zh&#x27;</span>].contains(locale.languageCode);<br><br>  <span class="hljs-meta">@override</span><br>  Future&lt;DemoLocalizations&gt; load(Locale locale) &#123;<br>    <span class="hljs-keyword">return</span> SynchronousFuture&lt;DemoLocalizations&gt;(DemoLocalizations(locale));<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-built_in">bool</span> shouldReload(DemoLocalizationsDelegate old) =&gt; <span class="hljs-keyword">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><br>å¤å†™çš„loadæ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†<code>SynchronousFuture</code>ã€‚</p><h3 id="ä½¿ç”¨ä»£ç†"><a href="#ä½¿ç”¨ä»£ç†" class="headerlink" title="ä½¿ç”¨ä»£ç†"></a>ä½¿ç”¨ä»£ç†</h3><p>å›åˆ°<code>main.dart</code>ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MaterialApp(<br>      title: <span class="hljs-string">&#x27;Flutter Demo&#x27;</span>,<br>      theme: <span class="hljs-keyword">new</span> ThemeData(<br>        primarySwatch: Colors.blue,<br>      ),<br>      localizationsDelegates: [<br>        DemoLocalizationsDelegate(),<span class="hljs-comment">// è¿™æ˜¯æˆ‘ä»¬æ–°å»ºçš„ä»£ç†</span><br>        GlobalMaterialLocalizations.delegate,<br>        GlobalWidgetsLocalizations.delegate,<br>      ],<br>      supportedLocales: [<br>        <span class="hljs-keyword">const</span> Locale(<span class="hljs-string">&#x27;en&#x27;</span>, <span class="hljs-string">&#x27;US&#x27;</span>), <span class="hljs-comment">// English</span><br>        <span class="hljs-keyword">const</span> Locale(<span class="hljs-string">&#x27;he&#x27;</span>, <span class="hljs-string">&#x27;IL&#x27;</span>), <span class="hljs-comment">// Hebrew</span><br>        <span class="hljs-keyword">const</span> Locale(<span class="hljs-string">&#x27;zh&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>),   <span class="hljs-comment">// æ–°æ·»ä¸­æ–‡ï¼Œåé¢çš„countryCodeæš‚æ—¶ä¸æŒ‡å®š</span><br>      ],<br>      home: <span class="hljs-keyword">new</span> MyHomePage(title: <span class="hljs-string">&#x27;Flutter Demo Home Page&#x27;</span>),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>åœ¨<code>_MyHomePageState</code>ä¸­è°ƒç”¨<code>DemoLocalizations</code>ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart">DemoLocalizations localizations = DemoLocalizations.of(context);<br><span class="hljs-built_in">print</span>(localizations); <span class="hljs-comment">// æ‰“å°å‡º I/flutter (25535): Instance of &#x27;DemoLocalizations&#x27;</span><br></code></pre></td></tr></table></figure><br>è§‚å¯Ÿlogcatï¼Œå¯çŸ¥æˆ‘ä»¬è·å¾—äº†DemoLocalizationsçš„å®ä¾‹ã€‚</p><p>è·å–<code>title</code><br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart">DemoLocalizations.of(context).title<br></code></pre></td></tr></table></figure></p><p>å¦‚æœéœ€è¦æ›´å¤šçš„å­—ç¬¦ä¸²ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åœ¨èµ„æºæ–‡ä»¶çš„mapä¸­æ·»åŠ ã€‚<br>è¿™é‡Œä»…ä»¥titleä¸ºä¾‹ã€‚</p><p><img src="http://rustblogres.rustfisher.com/flutter-string-map-demo-proj.png" alt="æ–‡ä»¶"></p><p>å‚è€ƒï¼š</p><ul><li>å®˜æ–¹æ–‡æ¡£ <a href="https://flutter.io/tutorials/internationalization/">https://flutter.io/tutorials/internationalization/</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Flutter_note</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Flutter International å›½é™…åŒ–ï¼ŒLocalization æœ¬åœ°åŒ–ï¼Œ ä½¿ç”¨Intl</title>
    <link href="/2018/07/16/Flutter/Flutter-International_localization_with_Intl/"/>
    <url>/2018/07/16/Flutter/Flutter-International_localization_with_Intl/</url>
    
    <content type="html"><![CDATA[<p>æ–°å»ºé¡¹ç›®ï¼Œå¾—åˆ°ä¸€ä¸ªç¤ºä¾‹å·¥ç¨‹ã€‚æœ¬ä¾‹ä¸­ä½¿ç”¨intlåŒ…æ¥ç®¡ç†æ–‡å­—èµ„æºã€‚</p><p>é¡¹ç›®åœ°å€ï¼š <a href="https://github.com/RustFisher/localization_demo">https://github.com/RustFisher/localization_demo</a></p><p>æ­¥éª¤ï¼š</p><ul><li>æ·»åŠ ä¾èµ–é¡¹ - intl</li><li>åˆ›å»ºæ–‡å­—èµ„æºæ–‡ä»¶</li><li>ç”Ÿæˆ<code>arb</code>æ–‡ä»¶<ul><li>æ–°å¢å’Œä¿®æ”¹<code>arb</code>æ–‡ä»¶</li></ul></li><li>æ ¹æ®<code>arb</code>ç”Ÿæˆ<code>dart</code>æ–‡ä»¶</li><li>åˆ›å»ºlocalizationä»£ç†ï¼Œæ–°å»ºä¸€ä¸ªç±»ç»§æ‰¿<code>LocalizationsDelegate</code>ï¼Œå’Œæ–‡å­—èµ„æºæ–‡ä»¶è”ç³»èµ·æ¥</li><li><code>MaterialApp</code>ä¸­æ·»åŠ æœ¬åœ°åŒ–ä»£ç†å’Œè¯­è¨€ç±»å‹</li><li>ä½¿ç”¨æ–‡å­—èµ„æº</li></ul><h3 id="æ·»åŠ ä¾èµ–é¡¹"><a href="#æ·»åŠ ä¾èµ–é¡¹" class="headerlink" title="æ·»åŠ ä¾èµ–é¡¹"></a>æ·»åŠ ä¾èµ–é¡¹</h3><p><code>pubspec.yaml</code>æ·»åŠ ä¾èµ–é¡¹<code>flutter_localizations</code>ï¼Œç„¶åè¿è¡Œä¸€ä¸‹<code>flutter packages get</code>ã€‚<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">dependencies:</span><br><span class="hljs-symbol">  flutter:</span><br><span class="hljs-symbol">    sdk:</span> flutter<br><span class="hljs-meta"># æ·»åŠ ä¸‹é¢çš„ä¾èµ–é¡¹</span><br><span class="hljs-symbol">  flutter_localizations:</span><br><span class="hljs-symbol">    sdk:</span> flutter<br><span class="hljs-symbol">  intl:</span> <span class="hljs-number">0.15</span><span class="hljs-number">.6</span><br><span class="hljs-symbol">  intl_translation:</span> <span class="hljs-number">0.16</span><span class="hljs-number">.7</span><br></code></pre></td></tr></table></figure></p><h3 id="ç¼–è¾‘dartæ–‡ä»¶"><a href="#ç¼–è¾‘dartæ–‡ä»¶" class="headerlink" title="ç¼–è¾‘dartæ–‡ä»¶"></a>ç¼–è¾‘dartæ–‡ä»¶</h3><p>æ–°å»º<code>app_strings.dart</code>æ–‡ä»¶ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;dart:async&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:intl/intl.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/widgets.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppStrings</span> </span>&#123;<br>  AppStrings(Locale locale) : _localeName = locale.toString();<br><br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> _localeName;<br><br>  <span class="hljs-keyword">static</span> Future&lt;AppStrings&gt; load(Locale locale) &#123;<br>    <span class="hljs-keyword">return</span> initializeMessages(locale.toString())<br>        .then((<span class="hljs-built_in">Object</span> _) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> AppStrings(locale);<br>    &#125;);<br>  &#125;<br><br>  <span class="hljs-keyword">static</span> AppStrings of(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> Localizations.of&lt;AppStrings&gt;(context, AppStrings);<br>  &#125;<br><br>  <span class="hljs-built_in">String</span> title() &#123;<br>    <span class="hljs-keyword">return</span> Intl.message(<br>      <span class="hljs-string">&#x27;Localization Demo&#x27;</span>,<br>      name: <span class="hljs-string">&#x27;title&#x27;</span>,<br>      desc: <span class="hljs-string">&#x27;åº”ç”¨æ ‡é¢˜&#x27;</span>,<br>      locale: _localeName,<br>    );<br>  &#125;<br><br>  <span class="hljs-built_in">String</span> click() =&gt; Intl.message(<br>    <span class="hljs-string">&#x27;Click&#x27;</span>,<br>    name: <span class="hljs-string">&#x27;click&#x27;</span>,<br>    desc: <span class="hljs-string">&#x27;ç‚¹å‡»&#x27;</span>,<br>    locale: _localeName,<br>  );<br><br>  <span class="hljs-built_in">String</span> helloFromDemo() =&gt; Intl.message(<br>    <span class="hljs-string">&#x27;Hello~&#x27;</span>,<br>    name: <span class="hljs-string">&#x27;helloFromDemo&#x27;</span>,<br>    desc: <span class="hljs-string">&#x27;ä¸€å¥é—®å€™&#x27;</span>,<br>    locale: _localeName,<br>  );<br>&#125;<br></code></pre></td></tr></table></figure><br>æ­¤æ—¶<code>initializeMessages</code>æ–¹æ³•ä¼šæ˜¾ç¤ºè­¦å‘Šï¼Œæš‚æ—¶ä¸ç”¨ç®¡ï¼Œç”Ÿæˆarbæ–‡ä»¶åå†æ·»åŠ å¼•ç”¨ã€‚</p><h3 id="ç”Ÿæˆarbæ–‡ä»¶"><a href="#ç”Ÿæˆarbæ–‡ä»¶" class="headerlink" title="ç”Ÿæˆarbæ–‡ä»¶"></a>ç”Ÿæˆ<code>arb</code>æ–‡ä»¶</h3><p>è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œè¿è¡Œ<code>intl</code>çš„å‘½ä»¤ã€‚<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/e/</span>ws/localization_demo<br>$ flutter pub pub run intl_translation:extract_to_arb --output-dir=lib<span class="hljs-regexp">/l10n lib/</span>app_strings.dart<br></code></pre></td></tr></table></figure></p><p>ç”Ÿæˆ<code>l10n/intl_messages.arb</code>ï¼Œå†…å®¹å¦‚ä¸‹ã€‚å¯ä»¥çœ‹å‡ºæ˜¯JSONæ ¼å¼çš„æ–‡æœ¬ã€‚<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs perl">&#123;<br>  <span class="hljs-string">&quot;@@last_modified&quot;</span>: <span class="hljs-string">&quot;2018-07-15T22:13:19.218221&quot;</span>,<br>  <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;Localization Demo&quot;</span>,<br>  <span class="hljs-string">&quot;@title&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;åº”ç”¨æ ‡é¢˜&quot;</span>,<br>    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>    <span class="hljs-string">&quot;placeholders&quot;</span>: &#123;&#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;click&quot;</span>: <span class="hljs-string">&quot;Click&quot;</span>,<br>  <span class="hljs-string">&quot;@click&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;ç‚¹å‡»&quot;</span>,<br>    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>    <span class="hljs-string">&quot;placeholders&quot;</span>: &#123;&#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;helloFromDemo&quot;</span>: <span class="hljs-string">&quot;Hello~&quot;</span>,<br>  <span class="hljs-string">&quot;@helloFromDemo&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;ä¸€å¥é—®å€™&quot;</span>,<br>    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>    <span class="hljs-string">&quot;placeholders&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><h4 id="æ–°å¢å’Œä¿®æ”¹arbæ–‡ä»¶"><a href="#æ–°å¢å’Œä¿®æ”¹arbæ–‡ä»¶" class="headerlink" title="æ–°å¢å’Œä¿®æ”¹arbæ–‡ä»¶"></a>æ–°å¢å’Œä¿®æ”¹<code>arb</code>æ–‡ä»¶</h4><p>å‰é¢ç”Ÿæˆäº†<code>l10n/intl_messages.arb</code>ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒå½“æˆæ¨¡æ¿ã€‚å¤åˆ¶ç²˜è´´ä¸€ä¸‹ï¼ŒåŒç›®å½•ä¸‹å¾—åˆ°<code>intl_en.arb</code>å’Œ<code>intl_zh.arb</code>ã€‚æ–‡ä»¶åè§„åˆ™å¯ä»¥è‡ªå·±å®šã€‚<br>ä»¥<code>intl_zh.arb</code>ä¸ºä¾‹ï¼š<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs dart">&#123;<br>  <span class="hljs-string">&quot;@@last_modified&quot;</span>: <span class="hljs-string">&quot;2018-07-15T22:13:19.218221&quot;</span>,<br>  <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;å›½é™…åŒ–ç¤ºä¾‹App&quot;</span>,<br>  <span class="hljs-string">&quot;@title&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;åº”ç”¨æ ‡é¢˜&quot;</span>,<br>    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>    <span class="hljs-string">&quot;placeholders&quot;</span>: &#123;&#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;click&quot;</span>: <span class="hljs-string">&quot;ç‚¹å‡»&quot;</span>,<br>  <span class="hljs-string">&quot;@click&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;ç‚¹å‡»&quot;</span>,<br>    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>    <span class="hljs-string">&quot;placeholders&quot;</span>: &#123;&#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;helloFromDemo&quot;</span>: <span class="hljs-string">&quot;ä½ å¥½å‘€~&quot;</span>,<br>  <span class="hljs-string">&quot;@helloFromDemo&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;ä¸€å¥é—®å€™&quot;</span>,<br>    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>,<br>    <span class="hljs-string">&quot;placeholders&quot;</span>: &#123;&#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br><em>è¿™é‡Œä¹Ÿå¯ä»¥æŠŠ<code>intl_messages.arb</code>åˆ æ‰ã€‚æœ¬ä¾‹ä¿ç•™è¿™ä¸ªæ–‡ä»¶ã€‚</em></p><h3 id="æ ¹æ®arbç”Ÿæˆdartæ–‡ä»¶"><a href="#æ ¹æ®arbç”Ÿæˆdartæ–‡ä»¶" class="headerlink" title="æ ¹æ®arbç”Ÿæˆdartæ–‡ä»¶"></a>æ ¹æ®<code>arb</code>ç”Ÿæˆ<code>dart</code>æ–‡ä»¶</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ flutter pub pub run intl_translation:generate_from_arb <span class="hljs-comment">--output-dir=lib/l10n \</span><br>   <span class="hljs-comment">--no-use-deferred-loading lib/app_strings.dart lib/l10n/intl_*.arb</span><br><br><span class="hljs-keyword">No</span> @@locale <span class="hljs-keyword">or</span> _locale field <span class="hljs-built_in">found</span> <span class="hljs-keyword">in</span> intl_en, assuming <span class="hljs-string">&#x27;en&#x27;</span> based <span class="hljs-keyword">on</span> the file <span class="hljs-type">name</span>.<br><span class="hljs-keyword">No</span> @@locale <span class="hljs-keyword">or</span> _locale field <span class="hljs-built_in">found</span> <span class="hljs-keyword">in</span> intl_messages, assuming <span class="hljs-string">&#x27;messages&#x27;</span> based <span class="hljs-keyword">on</span> the file <span class="hljs-type">name</span>.<br><span class="hljs-keyword">No</span> @@locale <span class="hljs-keyword">or</span> _locale field <span class="hljs-built_in">found</span> <span class="hljs-keyword">in</span> intl_zh, assuming <span class="hljs-string">&#x27;zh&#x27;</span> based <span class="hljs-keyword">on</span> the file <span class="hljs-type">name</span>.<br></code></pre></td></tr></table></figure><p>æš‚æ—¶æ— è§†è­¦å‘Šã€‚<br>æ­¤æ—¶åœ¨<code>app_strings.dart</code>ä¸­æ·»åŠ å¯¹<code>l10n/intl_messages.arb</code>çš„å¼•ç”¨ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:localization_demo/l10n/messages_all.dart&#x27;</span>;<br></code></pre></td></tr></table></figure><br>è­¦å‘Šæ¶ˆå¤±~</p><p><img src="http://rustblogres.rustfisher.com/flutter-arb-dart.png" alt="ç”Ÿæˆçš„æ–‡ä»¶"></p><p>æ›´æ–°äº†arbæ–‡ä»¶åï¼Œéœ€è¦é‡æ–°ç”Ÿæˆdartæ–‡ä»¶ã€‚</p><h3 id="åˆ›å»ºlocalizationä»£ç†"><a href="#åˆ›å»ºlocalizationä»£ç†" class="headerlink" title="åˆ›å»ºlocalizationä»£ç†"></a>åˆ›å»ºlocalizationä»£ç†</h3><p>åˆ›å»º<code>localizations_delegate.dart</code>ã€‚æ–°å»º<code>AppLocalizationsDelegate</code>ç±»ç»§æ‰¿<code>LocalizationsDelegate</code>ï¼Œå¤å†™æ–¹æ³•ã€‚<br>æ³›å‹æŒ‡å®šä¸ºå‰é¢çš„<code>AppStrings</code>ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;dart:async&#x27;</span>;<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/widgets.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:localization_demo/app_strings.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppLocalizationsDelegate</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">LocalizationsDelegate</span>&lt;<span class="hljs-title">AppStrings</span>&gt; </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Future&lt;AppStrings&gt; load(Locale locale) &#123;<br>    <span class="hljs-keyword">return</span> AppStrings.load(locale);<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-built_in">bool</span> isSupported(Locale locale) =&gt;<br>      [<span class="hljs-string">&#x27;zh&#x27;</span>, <span class="hljs-string">&#x27;en&#x27;</span>].contains(locale.languageCode); <span class="hljs-comment">// æ”¯æŒçš„ç±»å‹è¦åŒ…å«Appä¸­æ³¨å†Œçš„ç±»å‹</span><br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-built_in">bool</span> shouldReload(AppLocalizationsDelegate old) =&gt; <span class="hljs-keyword">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="MaterialAppä¸­æ·»åŠ æœ¬åœ°åŒ–ä»£ç†å’Œè¯­è¨€ç±»å‹"><a href="#MaterialAppä¸­æ·»åŠ æœ¬åœ°åŒ–ä»£ç†å’Œè¯­è¨€ç±»å‹" class="headerlink" title="MaterialAppä¸­æ·»åŠ æœ¬åœ°åŒ–ä»£ç†å’Œè¯­è¨€ç±»å‹"></a><code>MaterialApp</code>ä¸­æ·»åŠ æœ¬åœ°åŒ–ä»£ç†å’Œè¯­è¨€ç±»å‹</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MaterialApp(<br>      title: <span class="hljs-string">&#x27;Flutter Demo&#x27;</span>,<br>      theme: <span class="hljs-keyword">new</span> ThemeData(<br>        primarySwatch: Colors.blue,<br>      ),<br>      localizationsDelegates: [<br>        AppLocalizationsDelegate(), <span class="hljs-comment">// æˆ‘ä»¬å®šä¹‰çš„ä»£ç†</span><br>        GlobalMaterialLocalizations.delegate,<br>        GlobalWidgetsLocalizations.delegate,<br>      ],<br>      supportedLocales: [ <span class="hljs-comment">// æ”¯æŒçš„è¯­è¨€ç±»å‹</span><br>        <span class="hljs-keyword">const</span> Locale(<span class="hljs-string">&#x27;en&#x27;</span>, <span class="hljs-string">&#x27;US&#x27;</span>), <span class="hljs-comment">// English</span><br>        <span class="hljs-keyword">const</span> Locale(<span class="hljs-string">&#x27;zh&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>),<br>      ],<br>      home: <span class="hljs-keyword">new</span> MyHomePage(title: <span class="hljs-string">&#x27;Flutter Demo Home Page&#x27;</span>),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨æ–‡å­—èµ„æº"><a href="#ä½¿ç”¨æ–‡å­—èµ„æº" class="headerlink" title="ä½¿ç”¨æ–‡å­—èµ„æº"></a>ä½¿ç”¨æ–‡å­—èµ„æº</h3><p>è·å–åˆ°AppStringsçš„å®ä¾‹ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dart">AppStrings appStrings = AppStrings.of(context);<br><span class="hljs-built_in">print</span>(appStrings); <span class="hljs-comment">// logcat:  I/flutter ( 7478): Instance of &#x27;AppStrings&#x27;</span><br></code></pre></td></tr></table></figure></p><p><img src="http://rustblogres.rustfisher.com/flutter-international-demo-project.png" alt="ç¤ºä¾‹å·¥ç¨‹ç»“æ„"></p><p>æ³¨æ„ï¼Œåœ¨MaterialAppä¸­ä½¿ç”¨æ–‡å­—èµ„æºæ—¶ï¼Œå› ä¸ºcontextçš„å…³ç³»ï¼Œè¦ä½¿ç”¨<code>onGenerateTitle</code>ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">onGenerateTitle: (context) &#123;<br>  <span class="hljs-keyword">return</span> AppStrings.of(context).title();<br>&#125;,<br></code></pre></td></tr></table></figure></p><h3 id="æ”¯æŒè¯­è¨€çš„ç±»å‹"><a href="#æ”¯æŒè¯­è¨€çš„ç±»å‹" class="headerlink" title="æ”¯æŒè¯­è¨€çš„ç±»å‹"></a>æ”¯æŒè¯­è¨€çš„ç±»å‹</h3><p>ä»£ç†<code>isSupported</code>æ–¹æ³•ä¸­çš„è¯­è¨€ç±»å‹æœ€å¥½æ˜¯å’ŒAppä¸­<code>supportedLocales</code>çš„ä¸€è‡´<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs dart">  <span class="hljs-meta">@override</span><br>  <span class="hljs-built_in">bool</span> isSupported(Locale locale) =&gt;<br>      [<span class="hljs-string">&#x27;zh&#x27;</span>, <span class="hljs-string">&#x27;en&#x27;</span>].contains(locale.languageCode);<br><br><span class="hljs-comment">// Appä¸­`supportedLocales`</span><br>      supportedLocales: [<br>        <span class="hljs-keyword">const</span> Locale(<span class="hljs-string">&#x27;en&#x27;</span>, <span class="hljs-string">&#x27;US&#x27;</span>), <span class="hljs-comment">// English</span><br>        <span class="hljs-keyword">const</span> Locale(<span class="hljs-string">&#x27;zh&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>),<br>      ],<br></code></pre></td></tr></table></figure><br>å¦åˆ™å¯èƒ½å‡ºç°è·å–ä¸åˆ°AppStringsçš„å¼‚å¸¸ã€‚</p><p>å‚è€ƒï¼š</p><ul><li><a href="https://flutter.io/tutorials/internationalization/">https://flutter.io/tutorials/internationalization/</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Flutter_note</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Flutter Drawer æŠ½å±‰è§†å›¾ä¸è‡ªå®šä¹‰header</title>
    <link href="/2018/07/03/Flutter/Flutter-Drawer_and_custom_header/"/>
    <url>/2018/07/03/Flutter/Flutter-Drawer_and_custom_header/</url>
    
    <content type="html"><![CDATA[<p>ç§»åŠ¨å¼€å‘ä¸­ï¼ŒdrawerLayoutæŠ½å±‰è§†å›¾æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ç§æ§ä»¶ã€‚ä¸€èˆ¬å°†ç”¨æˆ·çš„å¤´åƒï¼Œç”¨æˆ·åç­‰ä¿¡æ¯åœ¨æŠ½å±‰è§†å›¾ä¸­å‘ˆç°ã€‚<br>drawerä¸­ä¹Ÿå¯ä»¥æä¾›ä¸€äº›é€‰é¡¹ï¼Œæ¯”å¦‚è·³è½¬å»è®¾ç½®é¡µï¼Œè·³è½¬å»ç”¨æˆ·èµ„æ–™é¡µé¢ç­‰ç­‰ã€‚</p><p>Flutteræä¾›äº†<code>Drawer</code>ç»„ä»¶ï¼›ç»“åˆ<code>ListView</code>ç­‰ç»„ä»¶ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€Ÿåœ°åˆ¶ä½œå‡ºæŠ½å±‰è§†å›¾ã€‚</p><h3 id="ä½¿ç”¨materialä¸­çš„UserAccountsDrawerHeader"><a href="#ä½¿ç”¨materialä¸­çš„UserAccountsDrawerHeader" class="headerlink" title="ä½¿ç”¨materialä¸­çš„UserAccountsDrawerHeader"></a>ä½¿ç”¨materialä¸­çš„<code>UserAccountsDrawerHeader</code></h3><p>ä½¿ç”¨materialä¸­çš„<code>UserAccountsDrawerHeader</code>ï¼Œè®¾ç½®<code>accountName</code>å’Œ<code>currentAccountPicture</code>ã€‚</p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyHomePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> _MyHomePageState();<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MyHomePageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MyHomePage</span>&gt; </span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    Widget userHeader = UserAccountsDrawerHeader(<br>      accountName: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;Tom&#x27;</span>),<br>      accountEmail: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;tom@xxx.com&#x27;</span>),<br>      currentAccountPicture: <span class="hljs-keyword">new</span> CircleAvatar(<br>        backgroundImage: AssetImage(<span class="hljs-string">&#x27;images/pic1.jpg&#x27;</span>), radius: <span class="hljs-number">35.0</span>,),);<br><br>    <span class="hljs-keyword">return</span> Scaffold(appBar: AppBar(title: Text(<span class="hljs-string">&quot;Home&quot;</span>),),<br>      body: <span class="hljs-keyword">new</span> Center(child: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;Home page&#x27;</span>),),<br>      drawer: Drawer(<br>        child: ListView(<br>          padding: EdgeInsets.zero,<br>          children: &lt;Widget&gt;[<br>            userHeader , <span class="hljs-comment">// å¯åœ¨è¿™é‡Œæ›¿æ¢è‡ªå®šä¹‰çš„header</span><br>            ListTile(title: Text(<span class="hljs-string">&#x27;Item 1&#x27;</span>),<br>              leading: <span class="hljs-keyword">new</span> CircleAvatar(child: <span class="hljs-keyword">new</span> Icon(Icons.school),),<br>              onTap: () &#123;<br>                Navigator.pop(context);<br>              &#125;,),<br>            ListTile(title: Text(<span class="hljs-string">&#x27;Item 2&#x27;</span>),<br>              leading: <span class="hljs-keyword">new</span> CircleAvatar(child: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;B2&#x27;</span>),),<br>              onTap: () &#123;<br>                Navigator.pop(context);<br>              &#125;,),<br>            ListTile(title: Text(<span class="hljs-string">&#x27;Item 3&#x27;</span>),<br>              leading: <span class="hljs-keyword">new</span> CircleAvatar(<br>                child: <span class="hljs-keyword">new</span> Icon(Icons.list),),<br>              onTap: () &#123;<br>                Navigator.pop(context);<br>              &#125;,),<br>          ],<br>        ),<br>      ),);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨UserAccountsDrawerHeaderæ•ˆæœå¦‚ä¸‹</p><p><img src="http://rustblogres.rustfisher.com/flutter-userAccountsDrawerHeader.webp" alt="ä½¿ç”¨UserAccountsDrawerHeaderæ•ˆæœ"></p><p><code>UserAccountsDrawerHeader</code>æ–‡æ¡£è¯·è§ <a href="https://docs.flutter.io/flutter/material/UserAccountsDrawerHeader-class.html">https://docs.flutter.io/flutter/material/UserAccountsDrawerHeader-class.html</a></p><h3 id="è‡ªå®šä¹‰header"><a href="#è‡ªå®šä¹‰header" class="headerlink" title="è‡ªå®šä¹‰header"></a>è‡ªå®šä¹‰header</h3><p>Flutteræœ‰<code>DrawerHeader</code>ï¼Œæˆ‘ä»¬å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰ã€‚</p><ul><li><code>DrawerHeader</code>è®¾ç½®paddingä¸º0ï¼Œå……æ»¡æ•´ä¸ªé¡¶éƒ¨</li><li><code>DrawerHeader</code>çš„childä½¿ç”¨<code>Stack</code>ï¼Œç›®çš„æ˜¯æ”¾ç½®èƒŒæ™¯å›¾ç‰‡</li><li>åœ¨<code>Stack</code>åå·¦ä¸‹çš„ä½ç½®æ”¾ç½®å¤´åƒå’Œç”¨æˆ·å<ul><li>å…ˆç”¨<code>Align</code>ç¡®å®šå¯¹é½æ–¹å¼ä¸º<code>FractionalOffset.bottomLeft</code></li><li><code>Align</code>çš„childä¸º<code>Container</code>ï¼Œå¹¶è®¾å®šä¸€ä¸ªå…·ä½“é«˜åº¦</li><li>å¤´åƒä¸æ–‡å­—çš„<code>Container</code>ä»¿ç…§<code>ListTile</code>çš„é£æ ¼ï¼Œå·¦è¾¹æ˜¯ä¸€ä¸ªå¤´åƒï¼Œå³è¾¹æ˜¯æ–‡å­—ï¼›ä½¿ç”¨<code>Row</code>æ¥åˆ†éš”å¤´åƒå’Œæ–‡å­—</li><li>æ–‡å­—éƒ¨åˆ†å…ˆç”¨<code>Container</code>çš„marginåšå‡ºé—´éš”ï¼Œå†æ”¾å…¥ä¸€ä¸ª<code>Column</code>æ¥å­˜æ”¾<code>Text</code></li><li>æ–‡å­—<code>Column</code>è®¾ç½®æ°´å¹³æ–¹å‘å·¦å¯¹é½ä¸ç«–ç›´æ–¹å‘å±…ä¸­</li></ul></li></ul><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget header = DrawerHeader(<br>  padding: EdgeInsets.zero, <span class="hljs-comment">/* paddingç½®ä¸º0 */</span><br>  child: <span class="hljs-keyword">new</span> Stack(children: &lt;Widget&gt;[ <span class="hljs-comment">/* ç”¨stackæ¥æ”¾èƒŒæ™¯å›¾ç‰‡ */</span><br>    <span class="hljs-keyword">new</span> Image.asset(<br>      <span class="hljs-string">&#x27;images/p_h_r_600.png&#x27;</span>, fit: BoxFit.fill, width: <span class="hljs-built_in">double</span>.infinity,),<br>    <span class="hljs-keyword">new</span> Align(<span class="hljs-comment">/* å…ˆæ”¾ç½®å¯¹é½ */</span><br>      alignment: FractionalOffset.bottomLeft,<br>      child: Container(<br>        height: <span class="hljs-number">70.0</span>,<br>        margin: EdgeInsets.only(left: <span class="hljs-number">12.0</span>, bottom: <span class="hljs-number">12.0</span>),<br>        child: <span class="hljs-keyword">new</span> Row(<br>          mainAxisSize: MainAxisSize.min, <span class="hljs-comment">/* å®½åº¦åªç”¨åŒ…ä½å­ç»„ä»¶å³å¯ */</span><br>          crossAxisAlignment: CrossAxisAlignment.start,<br>          mainAxisAlignment: MainAxisAlignment.start,<br>          children: &lt;Widget&gt;[<br>            <span class="hljs-keyword">new</span> CircleAvatar(<br>              backgroundImage: AssetImage(<span class="hljs-string">&#x27;images/pic1.jpg&#x27;</span>),<br>              radius: <span class="hljs-number">35.0</span>,),<br>            <span class="hljs-keyword">new</span> Container(<br>              margin: EdgeInsets.only(left: <span class="hljs-number">6.0</span>),<br>              child: <span class="hljs-keyword">new</span> Column(<br>                crossAxisAlignment: CrossAxisAlignment.start, <span class="hljs-comment">// æ°´å¹³æ–¹å‘å·¦å¯¹é½</span><br>                mainAxisAlignment: MainAxisAlignment.center, <span class="hljs-comment">// ç«–ç›´æ–¹å‘å±…ä¸­</span><br>                children: &lt;Widget&gt;[<br>                  <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&quot;Tom&quot;</span>, style: <span class="hljs-keyword">new</span> TextStyle(<br>                      fontSize: <span class="hljs-number">20.0</span>,<br>                      fontWeight: FontWeight.w400,<br>                      color: Colors.white),),<br>                  <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&quot;What&#x27;s up&quot;</span>, style: <span class="hljs-keyword">new</span> TextStyle(<br>                      fontSize: <span class="hljs-number">14.0</span>, color: Colors.white),),<br>                ],<br>              ),<br>            ),<br>          ],),<br>      ),<br>    ),<br>  ]),);<br></code></pre></td></tr></table></figure><p>è‡ªå®šä¹‰headerçš„æ•ˆæœå›¾</p><p><img src="http://rustblogres.rustfisher.com/flutter-custom-header-cat.webp" alt="è‡ªå®šä¹‰headerçš„æ•ˆæœå›¾"></p><p>åœ¨è‡ªå®šä¹‰headerçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»„åˆä½¿ç”¨äº†å¤šç§widgetï¼›</p><p>æœ‰å±‚å çš„<code>Stack</code>ï¼Œç”¨äºå¯¹é½çš„<code>Align</code>ï¼Œè®¾å®šå…·ä½“å°ºå¯¸å’Œmarginçš„<code>Container</code>ï¼Œæ°´å¹³æ”¾ç½®çš„<code>Row</code>ä»¥åŠç«–ç›´æ”¾ç½®çš„<code>Column</code>ã€‚</p><p>è¿™äº›widgetçš„å„æœ‰ç‰¹ç‚¹ï¼Œæ ¹æ®å…·ä½“æƒ…å†µæ¥ç»„åˆä½¿ç”¨ã€‚åŒä¸€ä¸ªUIæ•ˆæœï¼Œåšæ³•ä¹Ÿä¸æ­¢ä¸€ç§ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Flutter_note</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Flutter widgetåŠ¨ç”»æ•ˆæœä¹‹CurvedAnimation</title>
    <link href="/2018/06/26/Flutter/Flutter-CurvedAnimation/"/>
    <url>/2018/06/26/Flutter/Flutter-CurvedAnimation/</url>
    
    <content type="html"><![CDATA[<p>åœ¨Androidä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨XMLæ¥æŒ‡å®šåŠ¨ç”»æ ·å¼ï¼Œæˆ–è€…è°ƒç”¨Viewçš„<code>animate()</code>æ–¹æ³•ã€‚åœ¨Flutterä¸­ï¼Œwidgetçš„åŠ¨ç”»æ•ˆæœåˆ©ç”¨<code>animated</code>åŠ¨ç”»åŒ–ç»„ä»¶çš„åŠ¨ç”»åº“æ¥å®ç°ã€‚</p><p>Flutterä¸­ï¼Œä½¿ç”¨<code>AnimationController</code>æ¥æ§åˆ¶åŠ¨ç”»æš‚åœã€è°ƒæ•´è¿›åº¦ã€åœæ­¢å’Œå€’é€€ã€‚<code>AnimationController</code>ç»§æ‰¿è‡ª<code>Animation&lt;double&gt;</code>ã€‚</p><p>åœ¨vsyncä¿¡å·å‘å‡ºæ—¶ï¼Œéœ€è¦ä¸€ä¸ªè§¦å‘å™¨æ¥é€šçŸ¥å®ƒï¼Œä»è€Œåœ¨æ¯å¸§ä¸­äº§ç”Ÿä¸€ä¸ª0åˆ°1çš„çº¿æ€§å·®å€¼ã€‚</p><p>ä¸€ä¸ªControllerå¯ä»¥ä¸å¤šä¸ªåŠ¨ç”»è¿›è¡Œå…³è”ã€‚</p><blockquote><p>å½“æ•´ä¸ªå±å¹•åˆ·æ–°å®Œæ¯•ï¼Œå³ä¸€ä¸ªå‚ç›´åˆ·æ–°å‘¨æœŸå®Œæˆï¼Œä¼šæœ‰çŸ­æš‚çš„ç©ºç™½æœŸï¼Œæ­¤æ—¶å‘å‡º VSync ä¿¡å·ã€‚</p></blockquote><h2 id="åŠ¨ç”»æ ·å¼ç¤ºä¾‹-CurvedAnimationä¸FadeTransition"><a href="#åŠ¨ç”»æ ·å¼ç¤ºä¾‹-CurvedAnimationä¸FadeTransition" class="headerlink" title="åŠ¨ç”»æ ·å¼ç¤ºä¾‹ - CurvedAnimationä¸FadeTransition"></a>åŠ¨ç”»æ ·å¼ç¤ºä¾‹ - CurvedAnimationä¸FadeTransition</h2><p>ç”¨<code>CurvedAnimation</code>å®ç°ä¸€ä¸ªåŠ¨ç”»æ•ˆæœã€‚<br>ç»™widgetæŒ‡å®šåŠ¨ç”»æ•ˆæœï¼Œç”¨Controlleræ¥æ§åˆ¶åŠ¨ç”»çš„æ’­æ”¾ã€‚<br>ä¸‹é¢è¿™ä¸ªä¾‹å­æ˜¯å…³äºFadeTransitionçš„ã€‚ç”¨ä¸€ä¸ªFloatingActionButtonæ¥æ§åˆ¶åŠ¨ç”»æ’­æ”¾ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() =&gt; runApp(<span class="hljs-keyword">new</span> AnimationApp());<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnimationApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MaterialApp(<br>      title: <span class="hljs-string">&#x27;Animation&#x27;</span>,<br>      theme: <span class="hljs-keyword">new</span> ThemeData(primarySwatch: Colors.blue),<br>      home: <span class="hljs-keyword">new</span> HomePage(<br>        title: <span class="hljs-string">&#x27;åŠ¨ç”»ç¤ºä¾‹&#x27;</span>,<br>      ),<br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> title;<br><br>  HomePage(&#123;Key key, <span class="hljs-keyword">this</span>.title&#125;) : <span class="hljs-keyword">super</span>(key: key);<br><br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; <span class="hljs-keyword">new</span> _HomePageState();<br>&#125;<br><br><span class="hljs-comment">// éœ€è¦Ticker</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_HomePageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">HomePage</span>&gt; <span class="hljs-title">with</span> <span class="hljs-title">TickerProviderStateMixin</span> </span>&#123;<br>  AnimationController controller;<br>  CurvedAnimation curveEaseIn, bounceIn, linear, decelerate;<br>  <span class="hljs-built_in">bool</span> _animationFlag = <span class="hljs-keyword">true</span>;<br><br>  <span class="hljs-meta">@override</span><br>  <span class="hljs-keyword">void</span> initState() &#123;<br>    <span class="hljs-keyword">super</span>.initState();<br>    controller = <span class="hljs-keyword">new</span> AnimationController(<br>        duration: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">2000</span>), vsync: <span class="hljs-keyword">this</span>);<br>    curveEaseIn = <span class="hljs-keyword">new</span> CurvedAnimation(parent: controller, curve: Curves.easeIn);<br>    bounceIn = <span class="hljs-keyword">new</span> CurvedAnimation(parent: controller, curve: Curves.bounceIn);<br>    linear = <span class="hljs-keyword">new</span> CurvedAnimation(parent: controller, curve: Curves.linear);<br>    decelerate =<br>        <span class="hljs-keyword">new</span> CurvedAnimation(parent: controller, curve: Curves.decelerate);<br>  &#125;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    buildItemWidget(<br>        CurvedAnimation animation, MaterialColor color, <span class="hljs-built_in">String</span> itemText) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Column(<br>        children: &lt;Widget&gt;[<br>          <span class="hljs-keyword">new</span> FadeTransition(<br>            opacity: animation,<br>            child: <span class="hljs-keyword">new</span> FlutterLogo(<br>              size: <span class="hljs-number">100.0</span>,<br>              colors: color,<br>            ),<br>          ),<br>          <span class="hljs-keyword">new</span> Text(itemText)<br>        ],<br>      );<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Scaffold(<br>      appBar: <span class="hljs-keyword">new</span> AppBar(<br>        title: <span class="hljs-keyword">new</span> Text(widget.title),<br>      ),<br>      floatingActionButton: <span class="hljs-keyword">new</span> FloatingActionButton(<br>        onPressed: () &#123;<br>          <span class="hljs-keyword">if</span> (_animationFlag) &#123;<br>            controller.forward();<br>          &#125; <span class="hljs-keyword">else</span> &#123;<br>            controller.reverse();<br>          &#125;<br>          _animationFlag = !_animationFlag;<br>        &#125;,<br>        child: <span class="hljs-keyword">new</span> Icon(Icons.star),<br>      ),<br>      body: <span class="hljs-keyword">new</span> Center(<br>        child: <span class="hljs-keyword">new</span> GridView.extent(<br>          maxCrossAxisExtent: <span class="hljs-number">170.0</span>,<br>          padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">12.0</span>),<br>          children: &lt;Widget&gt;[<br>            buildItemWidget(curveEaseIn, Colors.blue, <span class="hljs-string">&#x27;Curves.easeIn&#x27;</span>),<br>            buildItemWidget(bounceIn, Colors.amber, <span class="hljs-string">&#x27;Curves.bounceIn&#x27;</span>),<br>            buildItemWidget(linear, Colors.red, <span class="hljs-string">&#x27;Curves.linear&#x27;</span>),<br>            buildItemWidget(decelerate, Colors.indigo, <span class="hljs-string">&#x27;Curves.decelerate&#x27;</span>),<br>            buildItemWidget(<br>                <span class="hljs-keyword">new</span> CurvedAnimation(<br>                    parent: controller, curve: Curves.elasticIn),<br>                Colors.pink,<br>                <span class="hljs-string">&#x27;Curves.elasticIn&#x27;</span>),<br>            buildItemWidget(<br>                <span class="hljs-keyword">new</span> CurvedAnimation(parent: controller, curve: Curves.ease),<br>                Colors.purple,<br>                <span class="hljs-string">&#x27;Curves.ease&#x27;</span>),<br>          ],<br>        ),<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br><img src="http://rustblogres.rustfisher.com/flutter-CurvedAnimation-demo-6-icons.webp" alt="æ•ˆæœå›¾1"></p>]]></content>
    
    
    <categories>
      
      <category>Flutter_note</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Flutter åŠ è½½ç½‘ç»œå›¾ç‰‡çš„å‡ ç§æ–¹å¼</title>
    <link href="/2018/06/26/Flutter/Flutter-Load_image_from_network/"/>
    <url>/2018/06/26/Flutter/Flutter-Load_image_from_network/</url>
    
    <content type="html"><![CDATA[<p>å¯¹å¾ˆå¤šç§»åŠ¨åº”ç”¨æ¥è¯´ï¼ŒåŠ è½½ç½‘ç»œå›¾ç‰‡æ˜¯å¾ˆå¸¸è§çš„åŸºæœ¬åŠŸèƒ½ã€‚Androidä¸­å¸¸ç”¨Glideç­‰å›¾ç‰‡åº“ã€‚Flutteræä¾›äº†Imageç»„ä»¶æ¥å±•ç¤ºä¸åŒç±»å‹çš„å›¾ç‰‡ã€‚</p><p>åŠ è½½ç½‘ç»œå›¾ç‰‡æœ‰å‡ ç§æ–¹å¼ï¼š</p><ul><li><code>Image.network</code></li><li><code>FadeInImage.memoryNetwork</code></li><li>ä½¿ç”¨<code>cached_network_image</code>ä¸­çš„<code>CachedNetworkImage</code></li></ul><h2 id="ä½¿ç”¨Image-networkåŠ è½½å›¾ç‰‡"><a href="#ä½¿ç”¨Image-networkåŠ è½½å›¾ç‰‡" class="headerlink" title="ä½¿ç”¨Image.networkåŠ è½½å›¾ç‰‡"></a>ä½¿ç”¨<code>Image.network</code>åŠ è½½å›¾ç‰‡</h2><p>æ ¹æ®URLåŠ è½½å›¾ç‰‡ï¼Œä½¿ç”¨<code>Image.network</code>æ„é€ å™¨<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">Image.network(<br>  <span class="hljs-string">&#x27;https://raw.githubusercontent.com/flutter/website/master/_includes/code/layout/lakes/images/lake.jpg&#x27;</span>,<br>)<br></code></pre></td></tr></table></figure></p><h3 id="Imageç»„ä»¶ä¹Ÿæ”¯æŒGIFæ ¼å¼çš„å›¾ç‰‡"><a href="#Imageç»„ä»¶ä¹Ÿæ”¯æŒGIFæ ¼å¼çš„å›¾ç‰‡" class="headerlink" title="Imageç»„ä»¶ä¹Ÿæ”¯æŒGIFæ ¼å¼çš„å›¾ç‰‡"></a>Imageç»„ä»¶ä¹Ÿæ”¯æŒGIFæ ¼å¼çš„å›¾ç‰‡</h3><p>ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼Œå’Œä¸Šé¢çš„ç”¨æ³•ä¸€æ ·<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">Image.network(<br>  <span class="hljs-string">&#x27;https://github.com/flutter/plugins/raw/master/packages/video_player/doc/demo_ipod.gif?raw=true&#x27;</span>,<br>);<br></code></pre></td></tr></table></figure></p><h3 id="Image-networkçš„ä¾‹å­"><a href="#Image-networkçš„ä¾‹å­" class="headerlink" title="Image.networkçš„ä¾‹å­"></a><code>Image.network</code>çš„ä¾‹å­</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() =&gt; runApp(<span class="hljs-keyword">new</span> ImageDemoApp());<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageDemoApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MaterialApp(<br>      title: <span class="hljs-string">&#x27;Image Demo&#x27;</span>,<br>      home: <span class="hljs-keyword">new</span> HomePage(),<br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; <span class="hljs-keyword">new</span> _HomePageState();<br><br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_HomePageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">HomePage</span>&gt; </span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Scaffold(<br>      appBar: <span class="hljs-keyword">new</span> AppBar(title: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;Web Image Demo Page&#x27;</span>),),<br>      body: <span class="hljs-keyword">new</span> ListView(children: &lt;Widget&gt;[<br>        Container(<br>          margin: EdgeInsets.only(bottom: <span class="hljs-number">12.0</span>),<br>          decoration: BoxDecoration(color: Colors.grey),<br>          child: Column(children: &lt;Widget&gt;[<br>            Image.network(<br>              <span class="hljs-string">&#x27;https://raw.githubusercontent.com/flutter/website/master/_includes/code/layout/lakes/images/lake.jpg&#x27;</span>,<br>            ),<br>            Text(<span class="hljs-string">&#x27;Image.network&#x27;</span>)<br>          ],),<br>        ),<br>        Container(<br>          margin: EdgeInsets.only(bottom: <span class="hljs-number">12.0</span>),<br>          decoration: BoxDecoration(color: Colors.grey),<br>          child: Column(children: &lt;Widget&gt;[<br>            Image.network(<br>              <span class="hljs-string">&#x27;https://github.com/flutter/plugins/raw/master/packages/video_player/doc/demo_ipod.gif?raw=true&#x27;</span>,<br>            ),<br>            Text(<span class="hljs-string">&#x27;Image.network  Animated Gifs&#x27;</span>)<br>          ],),<br>        ),<br>      ],),<br>    );<br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><img src="http://rustblogres.rustfisher.com/flutter-load-img-Image-network.webp" alt="Image.networkåŠ è½½å›¾ç‰‡"></p><h2 id="æœ‰é»˜è®¤å ä½å›¾å’Œæ·¡å…¥æ•ˆæœ"><a href="#æœ‰é»˜è®¤å ä½å›¾å’Œæ·¡å…¥æ•ˆæœ" class="headerlink" title="æœ‰é»˜è®¤å ä½å›¾å’Œæ·¡å…¥æ•ˆæœ"></a>æœ‰é»˜è®¤å ä½å›¾å’Œæ·¡å…¥æ•ˆæœ</h2><p>åœ¨å›¾ç‰‡åŠ è½½è¿‡ç¨‹ä¸­ï¼Œç»™ç”¨æˆ·å±•ç¤ºä¸€å¼ é»˜è®¤çš„å›¾ç‰‡ï¼Œèƒ½æé«˜ç”¨æˆ·ä½“éªŒã€‚<br>ä½¿ç”¨<code>FadeInImage</code>ç»„ä»¶æ¥è¾¾åˆ°è¿™ä¸ªåŠŸèƒ½ã€‚<code>FadeInImage</code>èƒ½å¤„ç†å†…å­˜ä¸­ï¼ŒAppèµ„æºæˆ–è€…ç½‘ç»œä¸Šçš„å›¾ç‰‡ã€‚</p><h3 id="åŠ è½½ç½‘ç»œå›¾ç‰‡"><a href="#åŠ è½½ç½‘ç»œå›¾ç‰‡" class="headerlink" title="åŠ è½½ç½‘ç»œå›¾ç‰‡"></a>åŠ è½½ç½‘ç»œå›¾ç‰‡</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:transparent_image/transparent_image.dart&#x27;</span>;<br><br>FadeInImage.memoryNetwork(<br>  placeholder: kTransparentImage,<br>  image: <span class="hljs-string">&#x27;https://github.com/flutter/website/blob/master/_includes/code/layout/lakes/images/lake.jpg?raw=true&#x27;</span>,<br>);<br></code></pre></td></tr></table></figure><h4 id="ç¤ºä¾‹æ•ˆæœ"><a href="#ç¤ºä¾‹æ•ˆæœ" class="headerlink" title="ç¤ºä¾‹æ•ˆæœ"></a>ç¤ºä¾‹æ•ˆæœ</h4><p>ä½¿ç”¨<code>FadeInImage.memoryNetwork</code><br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:transparent_image/transparent_image.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() =&gt; runApp(<span class="hljs-keyword">new</span> FadeInImageDemoApp());<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FadeInImageDemoApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MaterialApp(<br>      title: <span class="hljs-string">&#x27;Image Demo&#x27;</span>,<br>      home: <span class="hljs-keyword">new</span> HomePage(),<br>    );<br>  &#125;<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; <span class="hljs-keyword">new</span> _HomePageState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_HomePageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">HomePage</span>&gt; </span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Scaffold(<br>      appBar: <span class="hljs-keyword">new</span> AppBar(title: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;Fade In Image Demo Page&#x27;</span>),),<br>      body: Stack(<br>        children: &lt;Widget&gt;[<br>          Center(child: CircularProgressIndicator()),<br>          Center(child: FadeInImage.memoryNetwork(<br>            image: <span class="hljs-string">&#x27;https://raw.githubusercontent.com/flutter/website/master/_includes/code/layout/lakes/images/lake.jpg&#x27;</span>,<br>            placeholder: kTransparentImage<span class="hljs-comment">/* é€æ˜å›¾ç‰‡ */</span>,)),<br>        ],<br>      ),<br>    );<br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><br><img src="http://rustblogres.rustfisher.com/flutter-load-img-place-holder.webp" alt="å ä½å›¾ä¸æ·¡å…¥æ•ˆæœ"></p><h3 id="ä½¿ç”¨åº”ç”¨å†…çš„å›¾ç‰‡æ¥åšå ä½å›¾"><a href="#ä½¿ç”¨åº”ç”¨å†…çš„å›¾ç‰‡æ¥åšå ä½å›¾" class="headerlink" title="ä½¿ç”¨åº”ç”¨å†…çš„å›¾ç‰‡æ¥åšå ä½å›¾"></a>ä½¿ç”¨åº”ç”¨å†…çš„å›¾ç‰‡æ¥åšå ä½å›¾</h3><p>ä½¿ç”¨<code>FadeInImage.assetNetwork</code></p><p>ä»£ç <br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_HomePageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">HomePage</span>&gt; </span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Scaffold(<br>      appBar: <span class="hljs-keyword">new</span> AppBar(title: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;Fade In Image Demo Page&#x27;</span>),),<br>      body: Center(child: FadeInImage.assetNetwork(<br>        image: <span class="hljs-string">&#x27;https://raw.githubusercontent.com/flutter/website/master/_includes/code/layout/lakes/images/lake.jpg&#x27;</span>,<br>        placeholder: <span class="hljs-string">&#x27;images/birds.gif&#x27;</span> <span class="hljs-comment">/* æŒ‡å®šgif */</span>,)),<br>    );<br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></p><p><img src="http://rustblogres.rustfisher.com/flutter-load-img-show-gif.webp" alt="ä½¿ç”¨è‡ªå®šçš„gifå›¾ç‰‡"></p><h2 id="ä½¿ç”¨ç¼“å­˜å›¾ç‰‡"><a href="#ä½¿ç”¨ç¼“å­˜å›¾ç‰‡" class="headerlink" title="ä½¿ç”¨ç¼“å­˜å›¾ç‰‡"></a>ä½¿ç”¨ç¼“å­˜å›¾ç‰‡</h2><p>ä½¿ç”¨<code>cached_network_image</code>åŒ…ã€‚å‚è§ <a href="https://pub.dartlang.org/packages/cached_network_image">https://pub.dartlang.org/packages/cached_network_image</a> ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dart">CachedNetworkImage(<br>  imageUrl: <span class="hljs-string">&#x27;https://github.com/flutter/website/blob/master/_includes/code/layout/lakes/images/lake.jpg?raw=true&#x27;</span>,<br>);<br></code></pre></td></tr></table></figure></p><p>æ·»åŠ placeholder<br><code>cached_network_image</code>çš„placeholderæ”¯æŒä»»æ„ç»„ä»¶ï¼Œæ¯”å¦‚<code>CircularProgressIndicator</code><br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dart">CachedNetworkImage(<br>  placeholder: CircularProgressIndicator(),<br>  imageUrl: <span class="hljs-string">&#x27;https://github.com/flutter/website/blob/master/_includes/code/layout/lakes/images/lake.jpg?raw=true&#x27;</span>,<br>);<br></code></pre></td></tr></table></figure></p><h3 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:cached_network_image/cached_network_image.dart&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() =&gt; runApp(<span class="hljs-keyword">new</span> MyApp());<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> MaterialApp(<br>      title: <span class="hljs-string">&#x27;Cached image load&#x27;</span>,<br>      home: Scaffold(appBar: AppBar(title: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;Cache Image Load&#x27;</span>),),<br>        body: Center(child: CachedNetworkImage(<br>            placeholder: CircularProgressIndicator(),<br>            imageUrl: <span class="hljs-string">&#x27;https://github.com/flutter/website/blob/master/_includes/code/layout/lakes/images/lake.jpg?raw=true&#x27;</span>),),),<br>    );<br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Flutter_note</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Flutter å¸ƒå±€å¸¸ç”¨çš„ widgetsï¼ˆCommon layout widgetsï¼‰</title>
    <link href="/2018/06/26/Flutter/Flutter-Layout_common_widgets/"/>
    <url>/2018/06/26/Flutter/Flutter-Layout_common_widgets/</url>
    
    <content type="html"><![CDATA[<p>ç®€å•åˆ—ä¸¾æ€»ç»“ä¸€ä¸‹å¸¸ç”¨çš„å¸ƒå±€widgetã€‚<br>Flutteræœ‰ä¸°å¯Œçš„layoutç»„ä»¶åº“ã€‚å…¶ä¸­æœ‰ä¸€äº›æ˜¯å¸¸ç”¨åº“ã€‚<br>ä¸‹é¢çš„widgetåˆ†ä¸ºä¸¤ç±»ï¼šæ ‡å‡†ç»„ä»¶å’Œæ¥è‡ªMaterial Componentsçš„ç‰¹æ®Šç»„ä»¶ã€‚<br>åªæœ‰Material Appèƒ½å¤Ÿä½¿ç”¨Material Componentsçš„ç»„ä»¶ã€‚</p><p>æ ‡å‡†ç»„ä»¶ - Standard widgets</p><ul><li>Container<ul><li>ç»™ä¸€ä¸ªç»„ä»¶æ·»åŠ  padding, margins, è¾¹ç•Œï¼ˆbordersï¼‰, èƒŒæ™¯é¢œè‰²æˆ–å…¶å®ƒè£…é¥°ï¼ˆdecorationsï¼‰ã€‚</li></ul></li><li>GridView<ul><li>å°†å¤šä¸ªwidgetæ”¾åœ¨ä¸€ä¸ªå¯æ»‘åŠ¨çš„è¡¨æ ¼ä¸­ã€‚</li></ul></li><li>ListView<ul><li>å°†å¤šä¸ªwidgetæ”¾åœ¨ä¸€ä¸ªå¯æ»‘åŠ¨çš„åˆ—è¡¨ä¸­ã€‚</li></ul></li><li>Stack<ul><li>åœ¨ä¸€ä¸ªwidgetä¸Šé¢ç›–ä¸Šå¦ä¸€ä¸ªwidgetã€‚</li></ul></li></ul><p>Material Components</p><ul><li>Card<ul><li>å°†ä¸€äº›ç›¸è¿‘çš„ä¿¡æ¯è£…è¿›ä¸€ä¸ªæœ‰åœ†è§’å’Œé˜´å½±çš„ç›’å­é‡Œã€‚</li></ul></li><li>ListTile<ul><li>ä¸€ä¸ªRowä¸­è£…è½½æœ€å¤š3è¡Œæ–‡å­—ï¼›å¯é€‰åˆ™åœ¨å‰é¢æˆ–å°¾éƒ¨æ·»åŠ å›¾æ ‡ã€‚</li></ul></li></ul><h2 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h2><p><code>Container</code>ç”¨æ³•æ¯”è¾ƒè‡ªç”±ã€‚å¯ä»¥æŠŠæ•´ä¸ªlayoutæ”¾è¿›containeré‡Œé¢ï¼Œç„¶åæ”¹å˜èƒŒæ™¯é¢œè‰²æˆ–å›¾ç‰‡ã€‚</p><p>Container å°ç»“:</p><ul><li>æ·»åŠ  padding, margins, å’Œè¾¹ç•Œï¼ˆbordersï¼‰</li><li>èƒ½å¤Ÿæ›´å¥½èƒŒæ™¯é¢œè‰²å’Œå›¾ç‰‡</li><li>åŒ…å«ä¸€ä¸ªå•ç‹¬çš„å­widgetï¼Œè¿™ä¸ªå­widgetå¯ä»¥æ˜¯Rowã€Columnæˆ–ä¸€ä¸ªwidgetæ ‘çš„æ ¹widget</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/1630262-d20671411ff400eb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="containerç»“æ„"></p><p>æµ‹è¯•ä»£ç <code>widgetdemo/container_page.dart</code><br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:demo_flutter/widgetdemo/container_page.dart&#x27;</span>;<br><span class="hljs-comment">// å¼•å…¥è‡ªå®šä¹‰çš„åŒ…......</span><br><br><span class="hljs-keyword">void</span> main() =&gt; runApp(<span class="hljs-keyword">new</span> MyApp());<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> MaterialApp(<br>      title: <span class="hljs-string">&#x27;Container demo 1&#x27;</span>,<br>      theme: <span class="hljs-keyword">new</span> ThemeData(primarySwatch: Colors.brown),<br>      home: <span class="hljs-keyword">new</span> ContainerDemoPage(), <span class="hljs-comment">// è¿™é‡Œæ¢ä¸Šæƒ³è¦æµ‹è¯•çš„ç•Œé¢</span><br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p><code>widgetdemo/container_page.dart</code>ä»£ç <br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-comment">/// <span class="language-markdown">containerç¤ºä¾‹ç•Œé¢</span></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ContainerDemoPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; <span class="hljs-keyword">new</span> _ContainerDemoPageState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_ContainerDemoPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">ContainerDemoPage</span>&gt; </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    Expanded imageExpanded(<span class="hljs-built_in">String</span> img) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Expanded(child: <span class="hljs-keyword">new</span> Container(<br>        decoration: <span class="hljs-keyword">new</span> BoxDecoration(<br>            border: <span class="hljs-keyword">new</span> Border.all(width: <span class="hljs-number">10.0</span>, color: Colors.black38),<br>            borderRadius: <span class="hljs-keyword">const</span> BorderRadius.all(<br>                <span class="hljs-keyword">const</span> Radius.circular(<span class="hljs-number">8.0</span>))),<br>        margin: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">4.0</span>),<br>        child: <span class="hljs-keyword">new</span> Image.asset(img),<br>      ));<br>    &#125;<br><br>    <span class="hljs-keyword">var</span> container = <span class="hljs-keyword">new</span> Container(<br>      decoration: <span class="hljs-keyword">new</span> BoxDecoration(color: Colors.black26),<br>      child: <span class="hljs-keyword">new</span> Column(<br>        children: &lt;Widget&gt;[<br>          <span class="hljs-keyword">new</span> Row(children: &lt;Widget&gt;[<br>            imageExpanded(<span class="hljs-string">&#x27;images/c1.jpg&#x27;</span>),<br>            imageExpanded(<span class="hljs-string">&#x27;images/c2.jpg&#x27;</span>),<br>          ],),<br>          <span class="hljs-keyword">new</span> Row(children: &lt;Widget&gt;[<br>            imageExpanded(<span class="hljs-string">&#x27;images/d1.jpg&#x27;</span>),<br>            imageExpanded(<span class="hljs-string">&#x27;images/d2.jpg&#x27;</span>),<br>          ],),<br>          <span class="hljs-keyword">new</span> Row(children: &lt;Widget&gt;[<br>            imageExpanded(<span class="hljs-string">&#x27;images/p1.jpg&#x27;</span>),<br>          ],)<br>        ],<br>      ),<br>    );<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Scaffold(<br>      appBar: <span class="hljs-keyword">new</span> AppBar(title: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;Container Page demo&#x27;</span>),),<br>      body: <span class="hljs-keyword">new</span> Center(<br>        child: container,<br>      ),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br><img src="https://upload-images.jianshu.io/upload_images/1630262-09b60b9be8d21d64.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="containerç¤ºä¾‹"></p><h2 id="GridView"><a href="#GridView" class="headerlink" title="GridView"></a>GridView</h2><p>ç”¨GridViewæ¥å°†widgetæ”¾å…¥ä¸€ä¸ª2ç»´çš„åˆ—è¡¨ä¸­ã€‚<br>GridViewæä¾›äº†2ä¸ªé¢„è£…é…å¥½çš„åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å»ºç«‹è‡ªå®šä¹‰åˆ—è¡¨ã€‚<br>GridViewæ”¯æŒæ»šåŠ¨ã€‚</p><p>GridView å°ç»“:</p><ul><li>å°†å¤šä¸ªwidgetæ”¾è¿›ä¸€ä¸ªè¡¨æ ¼ä¸­</li><li>å½“è¶…å‡ºæ¸²æŸ“èŒƒå›´æ—¶ï¼Œè‡ªåŠ¨æä¾›æ»šåŠ¨åŠŸèƒ½</li><li>å¯è‡ªå®šä¹‰æ ¼å­ï¼Œä¹Ÿå¯ç”¨ä¸‹é¢æä¾›çš„2ç§<ul><li>GridView.count æŒ‡å®šåˆ—çš„æ•°ç›®</li><li>GridView.extent å…è®¸æŒ‡å®šå­é¡¹çš„æœ€å¤§åƒç´ å®½åº¦</li></ul></li></ul><h3 id="ç¤ºä¾‹1-ç”¨GridView-extent"><a href="#ç¤ºä¾‹1-ç”¨GridView-extent" class="headerlink" title="ç¤ºä¾‹1 - ç”¨GridView.extent"></a>ç¤ºä¾‹1 - ç”¨<code>GridView.extent</code></h3><p><code>GridView.extent</code>æŒ‡å®šå­é¡¹å æ®çš„æœ€å¤§å®½åº¦<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-comment">/// <span class="language-markdown">gridViewç¤ºä¾‹ç•Œé¢1</span></span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GridDemo1Page</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; <span class="hljs-keyword">new</span> _GridDemo1PageState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_GridDemo1PageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">GridDemo1Page</span>&gt; </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Scaffold(<br>      appBar: <span class="hljs-keyword">new</span> AppBar(title: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;Grid Page 1 demo&#x27;</span>),),<br>      body: <span class="hljs-keyword">new</span> Center(<br>        child: buildGrid(),<br>      ),<br>    );<br>  &#125;<br><br>  <span class="hljs-built_in">List</span>&lt;Container&gt; _buildGridTileList(<span class="hljs-built_in">int</span> count) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">List</span>&lt;Container&gt;.generate(count, (<span class="hljs-built_in">int</span> index) =&gt;<br>    <span class="hljs-keyword">new</span> Container(child: <span class="hljs-keyword">new</span> Image.asset(<span class="hljs-string">&#x27;images/pic<span class="hljs-subst">$&#123;index + <span class="hljs-number">1</span>&#125;</span>.jpg&#x27;</span>),));<br>  &#125;<br><br>  Widget buildGrid() &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> GridView.extent(<br>      maxCrossAxisExtent: <span class="hljs-number">150.0</span>,<br>      padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">4.0</span>),<br>      mainAxisSpacing: <span class="hljs-number">4.0</span>,<br>      crossAxisSpacing: <span class="hljs-number">4.0</span>,<br>      children: _buildGridTileList(<span class="hljs-number">30</span>),);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br><img src="https://upload-images.jianshu.io/upload_images/1630262-a4b3065259a460b8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ç”¨GridView.extent"></p><h3 id="ç¤ºä¾‹2-ç”¨GridView-count"><a href="#ç¤ºä¾‹2-ç”¨GridView-count" class="headerlink" title="ç¤ºä¾‹2 - ç”¨GridView.count"></a>ç¤ºä¾‹2 - ç”¨<code>GridView.count</code></h3><p><code>crossAxisCount</code>è®¾ä¸º2ï¼Œåˆ†æˆ2åˆ—ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs dart">Widget buildGrid() &#123;<br>  <span class="hljs-keyword">var</span> countGrid = GridView.count(<br>    crossAxisCount: <span class="hljs-number">2</span>,<br>    mainAxisSpacing: <span class="hljs-number">4.0</span>,<br>    crossAxisSpacing: <span class="hljs-number">4.0</span>,<br>    padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">4.0</span>),<br>    childAspectRatio: <span class="hljs-number">1.3</span>,<br>    children: _buildGridTileList(<span class="hljs-number">30</span>),<br>  );<br>  <span class="hljs-keyword">return</span> countGrid;<br>&#125;<br></code></pre></td></tr></table></figure><br><img src="https://upload-images.jianshu.io/upload_images/1630262-1e5ec7ea72e1d8ea.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="GridView.countç¤ºä¾‹"></p><h2 id="ListView"><a href="#ListView" class="headerlink" title="ListView"></a>ListView</h2><p><a href="https://docs.flutter.io/flutter/widgets/ListView-class.html">ListView</a>èƒ½ä»¥åˆ—çš„å½¢å¼å±•ç¤ºæ•°æ®ã€‚å½“å†…å®¹è¶…è¿‡æ¸²æŸ“èŒƒå›´æ—¶ï¼Œè‡ªåŠ¨æä¾›æ»šåŠ¨çš„åŠŸèƒ½ã€‚</p><h4 id="ListView-å°ç»“"><a href="#ListView-å°ç»“" class="headerlink" title="ListView å°ç»“"></a>ListView å°ç»“</h4><ul><li>æŠŠå­è§†å›¾è£…è¿›åˆ—è¡¨ä¸­</li><li>æ°´å¹³æˆ–ç«–ç›´éƒ½å¯ä»¥</li><li>æ”¯æŒæ»‘åŠ¨</li><li>ç›¸æ¯”äºColumnï¼Œå¯é€‰é…ç½®æ¯”è¾ƒå°‘ï¼Œä½†æ›´æ˜“ç”¨å¹¶ä¸”æ”¯æŒæ»‘åŠ¨</li></ul><p>å’ŒAndroidä¸­çš„ListViewå·®åˆ«ä¸å¤§</p><h3 id="ç¤ºä¾‹1"><a href="#ç¤ºä¾‹1" class="headerlink" title="ç¤ºä¾‹1"></a>ç¤ºä¾‹1</h3><p>æŠŠ<code>ListTile</code>å½“åšå­é¡¹æ¥è£…è½½æ•°æ®ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ListViewPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; <span class="hljs-keyword">new</span> _ListViewPageState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_ListViewPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">ListViewPage</span>&gt; </span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-built_in">List</span>&lt;Widget&gt; list = &lt;Widget&gt;[];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">30</span>; i++) &#123;<br>      list.add(<span class="hljs-keyword">new</span> ListTile(<br>        title: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;title<span class="hljs-subst">$i</span>&#x27;</span>, style: _itemTextStyle,),<br>        subtitle: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;A&#x27;</span>),<br>        leading: i % <span class="hljs-number">3</span> == <span class="hljs-number">0</span><br>            ? <span class="hljs-keyword">new</span> Icon(Icons.theaters, color: Colors.blue,)<br>            : <span class="hljs-keyword">new</span> Icon(Icons.restaurant, color: Colors.blue,),<br>      ));<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Scaffold(<br>      appBar: <span class="hljs-keyword">new</span> AppBar(title: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;ListView Demo&#x27;</span>),),<br>      body: <span class="hljs-keyword">new</span> Center(child: <span class="hljs-keyword">new</span> ListView(children: list,),),<br>    );<br>  &#125;<br>&#125;<br><br>TextStyle _itemTextStyle = <span class="hljs-keyword">new</span> TextStyle(<br>    fontWeight: FontWeight.w500, fontSize: <span class="hljs-number">14.0</span>);<br></code></pre></td></tr></table></figure><br><img src="https://upload-images.jianshu.io/upload_images/1630262-a93fcfd8a54f8ce2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ListViewå‚è€ƒæ•ˆæœå›¾1"></p><p>å¦å¤–å¯ä»¥å‚è€ƒ <a href="https://github.com/flutter/flutter/blob/master/examples/flutter_gallery/lib/demo/colors_demo.dart">https://github.com/flutter/flutter/blob/master/examples/flutter_gallery/lib/demo/colors_demo.dart</a></p><h2 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h2><p>ä½¿ç”¨<a href="https://docs.flutter.io/flutter/widgets/Stack-class.html">Stack</a>åœ¨widgetä¹‹ä¸Šæ˜¾ç¤ºå¦ä¸€äº›widgetï¼Œé€šå¸¸ç”¨æ¥æ˜¾ç¤ºå›¾ç‰‡ã€‚<br>æ˜¾ç¤ºçš„widgetå¯ä»¥å®Œå…¨åœ°æŠŠåº•éƒ¨widgetç›–ä½ã€‚</p><h4 id="Stack-å°ç»“"><a href="#Stack-å°ç»“" class="headerlink" title="Stack å°ç»“:"></a>Stack å°ç»“:</h4><ul><li>ç”¨æ¥åœ¨å½“å‰widgetä¸Šé¢å†ç›–ä¸Šä¸€å±‚widget</li><li>Stack childrenä¸­çš„ç¬¬ä¸€ä¸ªwidgetæ”¾åœ¨æœ€ä¸‹ï¼Œåé¢çš„widgetä¼šä¸€å±‚å±‚ç›–ä¸Šå»</li><li>Stackçš„å†…å®¹ä¸æ”¯æŒæ»šåŠ¨</li><li>å¯ä»¥è£å‰ªè¶…å‡ºèŒƒå›´çš„å­widget</li></ul><h3 id="Stackç¤ºä¾‹1"><a href="#Stackç¤ºä¾‹1" class="headerlink" title="Stackç¤ºä¾‹1"></a>Stackç¤ºä¾‹1</h3><p>æ˜¾ç¤ºä¸€ä¸ª<code>CircleAvatar</code><br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StackPage1</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; <span class="hljs-keyword">new</span> _StackPage1State();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_StackPage1State</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">StackPage1</span>&gt; </span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-keyword">var</span> stack = <span class="hljs-keyword">new</span> Stack(<br>      alignment: <span class="hljs-keyword">const</span> Alignment(<span class="hljs-number">0.6</span>, <span class="hljs-number">0.6</span>),<br>      children: &lt;Widget&gt;[<br>        <span class="hljs-keyword">new</span> CircleAvatar(<br>          backgroundImage: <span class="hljs-keyword">new</span> AssetImage(<span class="hljs-string">&#x27;images/android_1.jpg&#x27;</span>),<br>          radius: <span class="hljs-number">100.0</span>,),<br>        <span class="hljs-keyword">new</span> Container(decoration: <span class="hljs-keyword">new</span> BoxDecoration(color: Colors.black45),<br>          child: <span class="hljs-keyword">new</span> Text(<br>            <span class="hljs-string">&#x27;Android Avatar&#x27;</span>, style: <span class="hljs-keyword">new</span> TextStyle(color: Colors.white70),),),<br>        <span class="hljs-keyword">new</span> Container(decoration: <span class="hljs-keyword">new</span> BoxDecoration(color: Colors.transparent),<br>          padding: <span class="hljs-keyword">const</span> EdgeInsets.fromLTRB(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">100.0</span>, <span class="hljs-number">0.0</span>),<br>          child: <span class="hljs-keyword">new</span> CircleAvatar(<br>            backgroundImage: <span class="hljs-keyword">new</span> AssetImage(<span class="hljs-string">&#x27;images/p_box1.png&#x27;</span>),<br>            backgroundColor: Colors.transparent,<br>            radius: <span class="hljs-number">10.0</span>,),),<br>      ],<br>    );<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Scaffold(<br>      appBar: <span class="hljs-keyword">new</span> AppBar(title: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;Stack Demo 1&#x27;</span>),),<br>      body: <span class="hljs-keyword">new</span> Center(child: stack,),<br>    );<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br><img src="https://upload-images.jianshu.io/upload_images/1630262-3c747578f43bf9b6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Stackç¤ºä¾‹1"></p><h2 id="Card"><a href="#Card" class="headerlink" title="Card"></a>Card</h2><p>Cardæ¥è‡ªMaterialç»„ä»¶åº“ï¼Œå¯åŒ…å«ä¸€äº›æ•°æ®ï¼Œé€šå¸¸ç”¨ListTileæ¥ç»„è£…ã€‚Cardåªæœ‰ä¸€ä¸ªå­widgetï¼Œå¯ä»¥æ˜¯columnã€rowã€listã€gridæˆ–å…¶å®ƒç»„åˆwidgetã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼ŒCardæŠŠè‡ªå·±çš„å°ºå¯¸ç¼©å°ä¸º0åƒç´ ã€‚å¯ä»¥ç”¨<a href="https://docs.flutter.io/flutter/widgets/SizedBox-class.html">SizedBox</a>æ¥æŒ‡å®šcardçš„å°ºå¯¸ã€‚</p><p>Flutterä¸­çš„Cardæœ‰åœ†è§’å’Œé˜´å½±æ•ˆæœã€‚ä¿®æ”¹<code>elevation</code>å¯æ”¹å˜é˜´å½±æ•ˆæœã€‚</p><p><code>elevation</code>å–å€¼èŒƒå›´ï¼Œå‚è€ƒ <a href="https://material.io/guidelines/material-design/elevation-shadows.html">Elevation and Shadows</a></p><p>è‹¥è®¾ç½®çš„èŒƒå›´å¤–çš„å€¼ï¼Œé˜´å½±æ•ˆæœä¼šæ¶ˆå¤±ã€‚</p><h4 id="Card-å°ç»“"><a href="#Card-å°ç»“" class="headerlink" title="Card å°ç»“:"></a>Card å°ç»“:</h4><ul><li>å®ç°äº†<a href="https://material.io/guidelines/components/cards.html">Material Design card</a></li><li>ç”¨äºå±•ç¤ºç›¸å…³çš„æ•°æ®</li><li>æœ‰ä¸€ä¸ªå­é¡¹ï¼ˆchildï¼‰ï¼Œå¯ä»¥æ˜¯columnã€rowã€listã€gridæˆ–å…¶å®ƒç»„åˆwidget</li><li>æœ‰åœ†è§’å’Œé˜´å½±æ•ˆæœ</li><li>ä¸æ”¯æŒæ»šåŠ¨</li></ul><h3 id="Cardç¤ºä¾‹1"><a href="#Cardç¤ºä¾‹1" class="headerlink" title="Cardç¤ºä¾‹1"></a>Cardç¤ºä¾‹1</h3><p>å°†å‰é¢çš„ListViewç¤ºä¾‹ä¿®æ”¹ä¸€ä¸‹<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ListViewPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; <span class="hljs-keyword">new</span> _ListViewPageState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_ListViewPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">ListViewPage</span>&gt; </span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    <span class="hljs-built_in">List</span>&lt;Widget&gt; list = &lt;Widget&gt;[];<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">30</span>; i++) &#123;<br>      list.add(<span class="hljs-keyword">new</span> Card(child: <span class="hljs-keyword">new</span> Column(<br>        children: &lt;Widget&gt;[<br>          <span class="hljs-keyword">new</span> Image.asset(<br>            <span class="hljs-string">&#x27;images/pic<span class="hljs-subst">$&#123;i + <span class="hljs-number">1</span>&#125;</span>.jpg&#x27;</span>,),<br>          <span class="hljs-keyword">new</span> ListTile(<br>            title: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;title<span class="hljs-subst">$i</span>&#x27;</span>, style: _itemTextStyle,),<br>            subtitle: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;A&#x27;</span>),<br>            leading: i % <span class="hljs-number">3</span> == <span class="hljs-number">0</span><br>                ? <span class="hljs-keyword">new</span> Icon(Icons.theaters, color: Colors.blue,)<br>                : <span class="hljs-keyword">new</span> Icon(Icons.restaurant, color: Colors.blue,),<br>          ),<br>        ],<br>      ),));<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Scaffold(<br>      appBar: <span class="hljs-keyword">new</span> AppBar(title: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;ListView Demo&#x27;</span>),),<br>      body: <span class="hljs-keyword">new</span> Center(child: <span class="hljs-keyword">new</span> ListView(children: list,),),<br>    );<br>  &#125;<br>&#125;<br><br>TextStyle _itemTextStyle = <span class="hljs-keyword">new</span> TextStyle(<br>    fontWeight: FontWeight.w500, fontSize: <span class="hljs-number">14.0</span>);<br></code></pre></td></tr></table></figure><br><img src="https://upload-images.jianshu.io/upload_images/1630262-46044fb55e1e989c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Cardç¤ºä¾‹1"></p><h2 id="ListTile"><a href="#ListTile" class="headerlink" title="ListTile"></a>ListTile</h2><p>æ¥è‡ªMaterialç»„ä»¶åº“çš„æ¨ªå‘ç»„ä»¶ã€‚å¯è‡ªå®šä¹‰3è¡Œæ–‡å­—åŠå…¶å¯é€‰çš„å¤´å°¾å›¾æ ‡ã€‚<br>æ­¤æ§ä»¶å¸¸ä¸Cardæˆ–ListViewä¸€èµ·ç”¨ã€‚</p><h4 id="ListTile-å°ç»“"><a href="#ListTile-å°ç»“" class="headerlink" title="ListTile å°ç»“:"></a>ListTile å°ç»“:</h4><ul><li>å¯å®šåˆ¶3è¡Œå¸¦å›¾æ ‡çš„æ–‡å­—</li><li>ç›¸æ¯”äºRowï¼Œé…ç½®æ›´å°‘ï¼Œä½†æ›´æ˜“ç”¨</li></ul><h2 id="åŠ ä¸€ä¸ªä¸»ç•Œé¢"><a href="#åŠ ä¸€ä¸ªä¸»ç•Œé¢" class="headerlink" title="åŠ ä¸€ä¸ªä¸»ç•Œé¢"></a>åŠ ä¸€ä¸ªä¸»ç•Œé¢</h2><p>æ”¾ç½®ä¸€äº›æŒ‰é’®ï¼Œç‚¹å‡»è·³è½¬åˆ°ç›¸åº”çš„ç•Œé¢ã€‚<br>ä½¿ç”¨<code>Navigator.of(context).pushNamed(routeName)</code>æ¥è·³è½¬ã€‚<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:flutter/material.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:demo_flutter/widgetdemo/container_page.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:demo_flutter/widgetdemo/grid_page.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:demo_flutter/widgetdemo/listview_demo.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:demo_flutter/widgetdemo/stack_page1.dart&#x27;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;package:demo_flutter/widgetdemo/button_page.dart&#x27;</span>;<br><br><span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> CONTAINER_DEMO_PAGE = <span class="hljs-string">&#x27;/a&#x27;</span>;<br><br><span class="hljs-keyword">void</span> main() &#123;<br>  runApp(<span class="hljs-keyword">new</span> MaterialApp(<br>    home: <span class="hljs-keyword">new</span> HomePage(),<br>    routes: &#123;<br>      CONTAINER_DEMO_PAGE: (BuildContext context) =&gt; <span class="hljs-keyword">new</span> ContainerDemoPage(),<br>      <span class="hljs-string">&#x27;/b&#x27;</span>: (BuildContext context) =&gt; <span class="hljs-keyword">new</span> GridDemo1Page(),<br>      <span class="hljs-string">&#x27;/c&#x27;</span>: (BuildContext context) =&gt; <span class="hljs-keyword">new</span> ListViewPage(),<br>      <span class="hljs-string">&#x27;/d&#x27;</span>: (BuildContext context) =&gt; <span class="hljs-keyword">new</span> StackPage1(),<br>      <span class="hljs-string">&#x27;/e&#x27;</span>: (BuildContext context) =&gt; <span class="hljs-keyword">new</span> ButtonPage(),<br>    &#125;,<br>  ));<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomePage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>&#123;<br>  <span class="hljs-meta">@override</span><br>  State&lt;StatefulWidget&gt; createState() =&gt; <span class="hljs-keyword">new</span> _HomePageState();<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_HomePageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">HomePage</span>&gt; </span>&#123;<br><br>  <span class="hljs-meta">@override</span><br>  Widget build(BuildContext context) &#123;<br>    getGestureDetector(<span class="hljs-built_in">String</span> routeName, <span class="hljs-built_in">String</span> content) &#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> GestureDetector (<br>        onTap: () &#123;<br>          Navigator.of(context).pushNamed(routeName);<br>        &#125;,<br>        child: <span class="hljs-keyword">new</span> Container (<br>            padding: EdgeInsets.all(<span class="hljs-number">20.0</span>),<br>            child: <span class="hljs-keyword">new</span> Center(child: <span class="hljs-keyword">new</span> Text (content),)),<br>      );<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Scaffold(<br>      appBar: <span class="hljs-keyword">new</span> AppBar(title: <span class="hljs-keyword">new</span> Text(<span class="hljs-string">&#x27;Home&#x27;</span>),),<br>      body: <span class="hljs-keyword">new</span> Column(children: &lt;Widget&gt;[<br>        getGestureDetector(CONTAINER_DEMO_PAGE, <span class="hljs-string">&#x27;Container Demo&#x27;</span>),<br>        getGestureDetector(<span class="hljs-string">&#x27;/b&#x27;</span>, <span class="hljs-string">&#x27;Grid Demo 1&#x27;</span>),<br>        getGestureDetector(<span class="hljs-string">&#x27;/c&#x27;</span>, <span class="hljs-string">&#x27;ListView Demo&#x27;</span>),<br>        getGestureDetector(<span class="hljs-string">&#x27;/d&#x27;</span>, <span class="hljs-string">&#x27;Stack Demo&#x27;</span>),<br>        getGestureDetector(<span class="hljs-string">&#x27;/e&#x27;</span>, <span class="hljs-string">&#x27;Button Page&#x27;</span>),<br>      ],),<br>    );<br>  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>Flutter_note</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Flutterå·¥ç¨‹å¸¸è§é—®é¢˜é›†åˆ</title>
    <link href="/2018/06/24/Flutter/Flutter-project_common_questions/"/>
    <url>/2018/06/24/Flutter/Flutter-project_common_questions/</url>
    
    <content type="html"><![CDATA[<p>åœ¨å­¦ä¹ ä½¿ç”¨flutterçš„è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ä¸€äº›å·¥ç¨‹ä¸Šçš„é—®é¢˜ã€‚æ¯”å¦‚flutterçš„é…ç½®ï¼ŒIDEçš„è®¾ç½®ç­‰ç­‰ã€‚</p><h2 id="flutter-doctor-éœ€è¦jdk1-8"><a href="#flutter-doctor-éœ€è¦jdk1-8" class="headerlink" title="flutter doctor éœ€è¦jdk1.8"></a>flutter doctor éœ€è¦jdk1.8</h2><p>éœ€è¦jdk1.8ï¼›å¦‚æœè£…çš„æ˜¯jdk9åŠä»¥åçš„ç‰ˆæœ¬ï¼Œflutter doctorä¼šä¸€ç›´æç¤ºä½ éœ€è¦å‡çº§android SDK</p><p><a href="https://flutter.io/flutter-for-android/#views">https://flutter.io/flutter-for-android/#views</a></p><h2 id="flutterå‡çº§é‡åˆ°ç½‘ç»œé”™è¯¯-Got-socket-error"><a href="#flutterå‡çº§é‡åˆ°ç½‘ç»œé”™è¯¯-Got-socket-error" class="headerlink" title="flutterå‡çº§é‡åˆ°ç½‘ç»œé”™è¯¯ - Got socket error"></a>flutterå‡çº§é‡åˆ°ç½‘ç»œé”™è¯¯ - Got socket error</h2><p>win7åŒå‡»æ‰“å¼€<code>flutter_console.bat</code>ï¼Œå°è¯•ç”¨<code>flutter upgrade</code>å‡çº§æ—¶ï¼Œé‡åˆ°é”™è¯¯ã€‚<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">E:\sdk_flutter\flutter&gt;flutter upgrade<br>Checking Dart SDK <span class="hljs-built_in">version</span>...<br>Downloading Dart SDK <span class="hljs-built_in">from</span> Flutter engine <span class="hljs-number">09</span>d05a38912a3c1a906e95099cac9a7e14fae85<br>f...<br>Unzipping Dart SDK...<br>Updating flutter tool...<br>Got <span class="hljs-built_in">socket</span> error trying <span class="hljs-built_in">to</span> find package mockito <span class="hljs-keyword">at</span> <span class="hljs-keyword">https</span>://pub.dartlang.org.<br>Error: Unable <span class="hljs-built_in">to</span> <span class="hljs-string">&#x27;pub upgrade&#x27;</span> flutter tool. Retrying <span class="hljs-keyword">in</span> <span class="hljs-literal">five</span> <span class="hljs-built_in">seconds</span>...<br></code></pre></td></tr></table></figure><br>æŠ¥é”™ï¼šè¿æ¥ä¸ä¸Š<a href="https://pub.dartlang.org">https://pub.dartlang.org</a></p><p>ç”¨æ¢¯å­å’Œä¸ç”¨æ¢¯å­éƒ½ä¼šæŠ¥è¿™ä¸ªé”™è¯¯ã€‚æŸ¥é˜…å®˜ç½‘<a href="https://flutter.io/get-started/install/">https://flutter.io/get-started/install/</a></p><p><img src="http://rustblogres.rustfisher.com/flutter-install-note.webp" alt="https://flutter.io/get-started/install"></p><p>å®˜ç½‘è¯´ä¸­å›½ç”¨æˆ·è¯·å‚è€ƒ<a href="https://github.com/flutter/flutter/wiki/Using-Flutter-in-China">https://github.com/flutter/flutter/wiki/Using-Flutter-in-China</a></p><p>å‚è€ƒæ–‡ç« å»ºè®®è®¾ç½®2ä¸ªç¯å¢ƒå˜é‡<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">export PUB_HOSTED_URL=[https:<span class="hljs-regexp">//</span>pub.flutter-io.cn](https:<span class="hljs-regexp">//</span>pub.flutter-io.cn/)Â <br>export FLUTTER_STORAGE_BASE_URL=[https:<span class="hljs-regexp">//</span>storage.flutter-io.cn](https:<span class="hljs-regexp">//</span>storage.flutter-io.cn/)<br></code></pre></td></tr></table></figure><br>æˆ‘ç”¨çš„æ˜¯win7ï¼Œåœ¨ç¯å¢ƒå˜é‡ -&gt; ç”¨æˆ·å˜é‡ä¸­æ·»åŠ äº†è¿™2ä¸ªå˜é‡<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">FLUTTER_STORAGE_BASE_URL  https:<span class="hljs-regexp">//</span>storage.flutter-io.cn<br>PUB_HOSTED_URL   https:<span class="hljs-regexp">//</span>pub.flutter-io.cn  <br></code></pre></td></tr></table></figure><br>å†é‡æ–°æ‰§è¡Œ<code>flutter upgrade</code>å³å¯</p><p>ä½¿ç”¨<code>flutter_console.bat</code>æ—¶ï¼Œåº”è¯¥<strong>ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ</strong></p><h2 id="Android-Studio-3-0-1-çš„flutteré¡¹ç›®æ‰¾ä¸åˆ°è®¾å¤‡-no-connected-device"><a href="#Android-Studio-3-0-1-çš„flutteré¡¹ç›®æ‰¾ä¸åˆ°è®¾å¤‡-no-connected-device" class="headerlink" title="Android Studio 3.0.1 çš„flutteré¡¹ç›®æ‰¾ä¸åˆ°è®¾å¤‡ - no connected device"></a>Android Studio 3.0.1 çš„flutteré¡¹ç›®æ‰¾ä¸åˆ°è®¾å¤‡ - no connected device</h2><p>å°è¯•è¿è¡Œflutteré¡¹ç›®æ—¶ï¼Œå‡ºç°æç¤ºæ¡†</p><p><img src="http://rustblogres.rustfisher.com/flutter-no-connect-device.webp" alt="no connected device"></p><p>æ­¤æ—¶æ³¨æ„åˆ°asé¡¶éƒ¨å·¥å…·æ çš„å³è¾¹å°‘äº†è®¾å¤‡æ¡†ã€Flutter Device Selectionã€‘</p><p><img src="http://rustblogres.rustfisher.com/flutter-as-top-bar.webp" alt="asé¡¶éƒ¨æ "><br>çº¢åœˆçš„ä½ç½®æœ¬åº”è¯¥æ˜¾ç¤ºå½“å‰è¿æ¥çš„è®¾å¤‡ï¼Œä½†æ˜¯åœ¨ä»£ç å†™é”™ä¸€æ¬¡åï¼Œè¿™ä¸€æ å°±æ¶ˆå¤±äº†ã€‚</p><h3 id="é”™è¯¯æ’æŸ¥"><a href="#é”™è¯¯æ’æŸ¥" class="headerlink" title="é”™è¯¯æ’æŸ¥"></a>é”™è¯¯æ’æŸ¥</h3><p>å°è¯•æ¸…ç¼“å­˜å¹¶é‡å¯asï¼Œé‚£ä¸€æ ä»ç„¶æœªå‡ºç°</p><p><img src="http://rustblogres.rustfisher.com/clear-and-restart-as.webp" alt="æ¸…ç¼“å­˜å¹¶é‡å¯as"></p><p>flutterå·²ç»å‡çº§åˆ°å½“å‰æœ€æ–°ç‰ˆæœ¬ã€‚<br>åœ¨git-bashä¸­è¿è¡Œ<code>flutter doctor</code>ï¼Œå¹¶æ²¡æœ‰å‘ç°ä»€ä¹ˆé—®é¢˜ã€‚<br><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">$ flutter doctor<br>Doctor <span class="hljs-keyword">summary</span> (<span class="hljs-keyword">to</span> see <span class="hljs-keyword">all</span> details, run flutter doctor -v):<br>[âˆš] Flutter (Channel beta, v0<span class="hljs-number">.5</span><span class="hljs-number">.1</span>, <span class="hljs-keyword">on</span> Microsoft Windows [<span class="hljs-keyword">Version</span> <span class="hljs-number">6.1</span><span class="hljs-number">.7601</span>], locale zh-CN)<br>[âˆš] Android toolchain - develop <span class="hljs-keyword">for</span> Android devices (Android SDK <span class="hljs-number">27.0</span><span class="hljs-number">.3</span>)<br>[âˆš] Android Studio (<span class="hljs-keyword">version</span> <span class="hljs-number">3.0</span>)<br>[âˆš] Connected devices (<span class="hljs-number">1</span> available)<br><br>â€¢ <span class="hljs-keyword">No</span> issues <span class="hljs-built_in">found</span>!<br></code></pre></td></tr></table></figure><br>ç”±æ­¤çŒœæµ‹æ˜¯Android Studioçš„é—®é¢˜ã€‚æ–°å»ºä¸€ä¸ªflutterå·¥ç¨‹ï¼Œè§‚å¯Ÿåˆ°è®¾å¤‡æ¡†åˆæ­£å¸¸äº†</p><p><img src="http://rustblogres.rustfisher.com/flutter-as-device-box.webp" alt="æ–°å»ºçš„flutterå·¥ç¨‹"><br>é‚£ä¹ˆåŸæ¥å·¥ç¨‹é‡Œé¢ä¸ºä½•æ€»æ˜¯è¯´æ‰¾ä¸åˆ°è®¾å¤‡ï¼Ÿ</p><p>ä»”ç»†å›æƒ³äº†ä¸€ä¸‹ï¼Œå‚è€ƒflutteræ•™ç¨‹æ—¶ï¼Œæ·»åŠ äº†ä¸€ä¸ª<code>images</code>ç›®å½•ï¼Œå¹¶ä¸”ä¿®æ”¹äº†<code>pubspec.yaml</code>æ–‡ä»¶ã€‚æ£€æŸ¥å‘ç°assetsçš„ç¼©è¿›å¼„é”™äº†ã€‚æŠŠç¼©è¿›æ”¹æˆ2ä¸ªç©ºæ ¼åï¼Œè®¾å¤‡æ¡†å°±å‡ºç°äº†ã€‚<br><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs llvm"># To <span class="hljs-keyword">add</span> assets <span class="hljs-keyword">to</span> your application<span class="hljs-punctuation">,</span> <span class="hljs-keyword">add</span> an assets <span class="hljs-keyword">section</span><span class="hljs-punctuation">,</span> like this:<br><span class="hljs-symbol">assets:</span><br>  - images/lake.jpg<br></code></pre></td></tr></table></figure><br>ç”±æ­¤å¯è§ï¼Œaså¯¹<code>pubspec.yaml</code>æ–‡ä»¶ååˆ†æ•æ„Ÿã€‚</p><h2 id="Flutter-ç¤ºä¾‹å·¥ç¨‹flutter-galleryé‡åˆ°çš„ç½‘ç»œé—®é¢˜"><a href="#Flutter-ç¤ºä¾‹å·¥ç¨‹flutter-galleryé‡åˆ°çš„ç½‘ç»œé—®é¢˜" class="headerlink" title="Flutter ç¤ºä¾‹å·¥ç¨‹flutter_galleryé‡åˆ°çš„ç½‘ç»œé—®é¢˜"></a>Flutter ç¤ºä¾‹å·¥ç¨‹<code>flutter_gallery</code>é‡åˆ°çš„ç½‘ç»œé—®é¢˜</h2><p>betaåˆ†æ”¯çš„<code>flutter_gallery</code>æŠŠèµ„æºæ–‡ä»¶éƒ½æ”¾åœ¨äº† <a href="https://flutter.googlesource.com/gallery-assets/">https://flutter.googlesource.com/gallery-assets/</a></p><p>è¿™ä¸ªç”¨æµè§ˆå™¨æ˜¯å¯ä»¥æ‰“å¼€çš„ï¼Œä½†æ˜¯asè¿è¡Œçš„æ—¶å€™ä¼šæŠ¥ fatal: not a git repository ï¼›</p><p>å‚è€ƒ <a href="https://github.com/flutter/flutter/issues/13763">https://github.com/flutter/flutter/issues/13763</a> ï¼Œå†³å®šæŠŠchannelåˆ‡æ¢åˆ°master</p><p>åˆ‡æ¢åˆ°master channelåï¼ŒæŠŠflutterä¸­çš„binç›®å½•æ•´ä¸ªåˆ æ‰ï¼›è¿è¡Œflutter doctoré‡æ–°ä¸‹è½½ä¸€æ¬¡dartçš„SDKã€‚å¯è¿è¡Œmasterä¸­çš„demoã€‚</p><h2 id="Android-Studioæ‰¾ä¸åˆ°Flutter-SDK"><a href="#Android-Studioæ‰¾ä¸åˆ°Flutter-SDK" class="headerlink" title="Android Studioæ‰¾ä¸åˆ°Flutter SDK"></a>Android Studioæ‰¾ä¸åˆ°Flutter SDK</h2><p>è¿è¡Œäº†<code>flutter upgrade</code>åï¼Œæ‰“å¼€aså‘ç°æ‰¾ä¸åˆ°SDKäº†ã€‚<br>å¼€å‘ç¯å¢ƒæ˜¯win7ï¼Œè¿›è¡Œæ£€æŸ¥ï¼š</p><ul><li>ç¯å¢ƒå˜é‡æ˜¯æ­£å¸¸çš„</li><li>ä½¿ç”¨cmdè¿è¡Œflutter doctoræ­£å¸¸</li><li>asèƒ½è·‘æ™®é€šçš„å®‰å“å·¥ç¨‹</li></ul><p>æ£€æŸ¥flutter sdk git ä»“åº“çš„æƒ…å†µï¼Œå‘ç°æœ‰äº›æ–‡ä»¶è¢«ä¿®æ”¹äº†ã€‚ä½¿ç”¨gitå°†å…¶æ›´æ–°ã€‚è¿è¡Œ<code>flutter doctor</code>é‡æ–°ç¼–è¯‘SDKã€‚<br>æ‰“å¼€aså‘ç°é—®é¢˜è§£å†³ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Flutter_note</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Android Intent ä¼ é€’æ•°æ®å¤§å°é™åˆ¶</title>
    <link href="/2018/06/01/Android/Android-Intent_extra_size_limit/"/>
    <url>/2018/06/01/Android/Android-Intent_extra_size_limit/</url>
    
    <content type="html"><![CDATA[<p>åœ¨<code>sendBroadcast</code>ï¼Œ<code>startActivity</code>æ—¶ï¼Œæˆ‘ä»¬ä¼šç”¨åˆ°Intentã€‚<br>Intentå¯ä»¥æºå¸¦ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚åŸºæœ¬ç±»å‹æ•°æ®intã€Booleanï¼Œæˆ–æ˜¯Stringï¼Œæˆ–æ˜¯åºåˆ—åŒ–å¯¹è±¡ï¼ŒParcelableä¸Serializableã€‚</p><p>Intentä¼ é€’æ•°æ®æ—¶ï¼Œå¦‚æœæ•°æ®å¤ªå¤§ï¼Œå¯èƒ½ä¼šå‡ºç°å¼‚å¸¸ã€‚æ¯”å¦‚Appé—ªé€€ï¼Œæˆ–æ˜¯Intentå‘é€ä¸æˆåŠŸï¼ŒlogcatæŠ¥é”™ç­‰ç­‰ã€‚</p><p>è¿™å°±ç‰µæ¶‰åˆ°ä¸€ä¸ªé—®é¢˜ï¼šIntent ä¼ é€’æ•°æ®å¤§å°é™åˆ¶ã€‚</p><p>Intentåˆ°åº•èƒ½å¤Ÿæºå¸¦å¤šå°‘æ•°æ®å‘¢ï¼Ÿ</p><h2 id="ä½¿ç”¨Intentä¼ é€æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å¼‚å¸¸"><a href="#ä½¿ç”¨Intentä¼ é€æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å¼‚å¸¸" class="headerlink" title="ä½¿ç”¨Intentä¼ é€æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å¼‚å¸¸"></a>ä½¿ç”¨Intentä¼ é€æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å¼‚å¸¸</h2><p>åœ¨Intentä¸­ä¼ å…¥ä¸€ä¸ªParcelableå¯¹è±¡ï¼›ä¾‹å¦‚ä¼ å…¥ä¸€ä¸ªbitmapå¯¹è±¡ã€‚</p><p>ä»£ç å‚è€ƒï¼š <a href="https://github.com/AnRFDev/android-Basic4">https://github.com/AnRFDev/android-Basic4</a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Bitmap</span> <span class="hljs-variable">b1</span> <span class="hljs-operator">=</span> Bitmap.createScaledBitmap(srcBmp, dstWid, dstHeight, <span class="hljs-literal">false</span>);<br><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(MSG_INTENT);<br>intent.putExtra(K_PIC, b1);<br></code></pre></td></tr></table></figure><br>é€‰æ‹©bitmapçš„åŸå› æ˜¯ï¼ŒBitmapå®ç°äº†<code>Parcelable</code>æ¥å£ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡<code>getByteCount()</code>å¾—çŸ¥æ‰€å å†…å­˜å¤§å°ã€‚</p><p><code>sendBroadcast</code>æ—¶ï¼ŒæŠ¥å‡ºå¦‚ä¸‹ä¿¡æ¯<br><figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs roboconf">V/ActivityManager: Broadcast: Intent &#123; <span class="hljs-attribute">act=intent_bi flg=0x10 (has extras) &#125; ordered=false userid=0 callerApp=ProcessRecord&#123;27aeaaf5 31217</span>:com<span class="hljs-variable">.rustfisher</span><span class="hljs-variable">.basic</span>4/u0a113&#125;<br>E/JavaBinder: !!! FAILED BINDER TRANSACTION !!!<br>W/BroadcastQueue: Failure sending broadcast Intent &#123; act=intent_bi flg=0x10 (has extras) &#125;<br>       android<span class="hljs-variable">.os</span><span class="hljs-variable">.TransactionTooLargeException</span><br>           at android<span class="hljs-variable">.os</span><span class="hljs-variable">.BinderProxy</span><span class="hljs-variable">.transactNative</span>(Native Method)<br>           at android<span class="hljs-variable">.os</span><span class="hljs-variable">.BinderProxy</span><span class="hljs-variable">.transact</span>(Binder<span class="hljs-variable">.java</span>:504)<br>           at android<span class="hljs-variable">.app</span><span class="hljs-variable">.ApplicationThreadProxy</span><span class="hljs-variable">.scheduleRegisteredReceiver</span>(ApplicationThreadNative<span class="hljs-variable">.java</span>:1170)<br>           at com<span class="hljs-variable">.android</span><span class="hljs-variable">.server</span><span class="hljs-variable">.am</span><span class="hljs-variable">.BroadcastQueue</span><span class="hljs-variable">.performReceiveLocked</span>(BroadcastQueue<span class="hljs-variable">.java</span>:576)<br>           at com<span class="hljs-variable">.android</span><span class="hljs-variable">.server</span><span class="hljs-variable">.am</span><span class="hljs-variable">.BroadcastQueue</span><span class="hljs-variable">.deliverToRegisteredReceiverLocked</span>(BroadcastQueue<span class="hljs-variable">.java</span>:848)<br>           at com<span class="hljs-variable">.android</span><span class="hljs-variable">.server</span><span class="hljs-variable">.am</span><span class="hljs-variable">.BroadcastQueue</span><span class="hljs-variable">.processNextBroadcast</span>(BroadcastQueue<span class="hljs-variable">.java</span>:917)<br>           at com<span class="hljs-variable">.android</span><span class="hljs-variable">.server</span><span class="hljs-variable">.am</span><span class="hljs-variable">.BroadcastQueue</span>$BroadcastHandler<span class="hljs-variable">.handleMessage</span>(BroadcastQueue<span class="hljs-variable">.java</span>:254)<br>           at android<span class="hljs-variable">.os</span><span class="hljs-variable">.Handler</span><span class="hljs-variable">.dispatchMessage</span>(Handler<span class="hljs-variable">.java</span>:111)<br>           at android<span class="hljs-variable">.os</span><span class="hljs-variable">.Looper</span><span class="hljs-variable">.loop</span>(Looper<span class="hljs-variable">.java</span>:194)<br>           at android<span class="hljs-variable">.os</span><span class="hljs-variable">.HandlerThread</span><span class="hljs-variable">.run</span>(HandlerThread<span class="hljs-variable">.java</span>:61)<br>           at com<span class="hljs-variable">.android</span><span class="hljs-variable">.server</span><span class="hljs-variable">.ServiceThread</span><span class="hljs-variable">.run</span>(ServiceThread<span class="hljs-variable">.java</span>:46)<br></code></pre></td></tr></table></figure></p><p>æŸ¥çœ‹å¼‚å¸¸ç±»<code>TransactionTooLargeException</code>ï¼Œå®ƒç»§æ‰¿äº†<code>RemoteException</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> android.os;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionTooLargeException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RemoteException</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TransactionTooLargeException</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">TransactionTooLargeException</span><span class="hljs-params">(String msg)</span> &#123;<br>        <span class="hljs-built_in">super</span>(msg);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>ä»æŠ¥é”™ä¿¡æ¯<code>FAILED BINDER TRANSACTION</code>å¯ä»¥çœ‹å‡ºï¼Œbinderä¼ é€æ•°æ®å¤±è´¥äº†ã€‚<br>è¿½è¸ªåˆ°<code>Binder</code>ï¼Œå®ƒçš„<code>transactNative</code>æ–¹æ³•æŠ¥å‡º<code>RemoteException</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">transactNative</span><span class="hljs-params">(<span class="hljs-type">int</span> code, Parcel data, Parcel reply,</span><br><span class="hljs-params">            <span class="hljs-type">int</span> flags)</span> <span class="hljs-keyword">throws</span> RemoteException;<br></code></pre></td></tr></table></figure><br>æŠ›å‡ºçš„å¼‚å¸¸ä¸Binderæœ‰å…³ã€‚</p><h2 id="Intentæºå¸¦ä¿¡æ¯çš„å¤§å°å—Binderé™åˆ¶"><a href="#Intentæºå¸¦ä¿¡æ¯çš„å¤§å°å—Binderé™åˆ¶" class="headerlink" title="Intentæºå¸¦ä¿¡æ¯çš„å¤§å°å—Binderé™åˆ¶"></a>Intentæºå¸¦ä¿¡æ¯çš„å¤§å°å—Binderé™åˆ¶</h2><p>Intentæºå¸¦ä¿¡æ¯çš„å¤§å°å…¶å®æ˜¯å—Binderé™åˆ¶ã€‚æœ¬æ–‡æ ‡é¢˜ä¹Ÿå¯ä»¥æ”¹ä¸ºâ€œBinderä¼ é€’æ•°æ®å¤§å°é™åˆ¶â€ã€‚</p><p>æ•°æ®ä»¥<code>Parcel</code>å¯¹è±¡çš„å½¢å¼å­˜æ”¾åœ¨Binderä¼ é€’ç¼“å­˜ä¸­ã€‚<br>å¦‚æœæ•°æ®æˆ–è¿”å›å€¼æ¯”ä¼ é€’bufferå¤§ï¼Œåˆ™æ­¤æ¬¡ä¼ é€’è°ƒç”¨å¤±è´¥å¹¶æŠ›å‡º<code>TransactionTooLargeException</code>å¼‚å¸¸ã€‚</p><p>Binderä¼ é€’ç¼“å­˜æœ‰ä¸€ä¸ªé™å®šå¤§å°ï¼Œé€šå¸¸æ˜¯1Mbã€‚ä½†åŒä¸€ä¸ªè¿›ç¨‹ä¸­æ‰€æœ‰çš„ä¼ è¾“å…±äº«ç¼“å­˜ç©ºé—´ã€‚</p><p>å¤šä¸ªåœ°æ–¹åœ¨è¿›è¡Œä¼ è¾“æ—¶ï¼Œå³æ—¶å®ƒä»¬å„è‡ªä¼ è¾“çš„æ•°æ®ä¸è¶…å‡ºå¤§å°é™åˆ¶ï¼Œ<code>TransactionTooLargeException</code>å¼‚å¸¸ä¹Ÿå¯èƒ½ä¼šè¢«æŠ›å‡ºã€‚</p><p>åœ¨ä½¿ç”¨Intentä¼ é€’æ•°æ®æ—¶ï¼Œ1Mbå¹¶ä¸æ˜¯å®‰å…¨ä¸Šé™ã€‚å› ä¸ºBinderä¸­å¯èƒ½æ­£åœ¨å¤„ç†å…¶å®ƒçš„ä¼ è¾“å·¥ä½œã€‚<br>ä¸åŒçš„æœºå‹å’Œç³»ç»Ÿç‰ˆæœ¬ï¼Œè¿™ä¸ªä¸Šé™å€¼ä¹Ÿå¯èƒ½ä¼šä¸åŒã€‚</p><p>åœ¨å…¶å®ƒåœ°æ–¹ï¼Œä¾‹å¦‚<code>onSaveInstanceState(@NonNull Bundle outState)</code>ï¼Œä¹Ÿå¯èƒ½ä¼šé‡åˆ°ä¸Binderæœ‰å…³çš„<a href="https://medium.com/@mdmasudparvez/android-os-transactiontoolargeexception-on-nougat-solved-3b6e30597345">ç±»ä¼¼é—®é¢˜</a>ã€‚</p><h2 id="ä¸ºä»€ä¹ˆBinderè¦é™åˆ¶ä¼ è¾“æ•°æ®çš„å¤§å°"><a href="#ä¸ºä»€ä¹ˆBinderè¦é™åˆ¶ä¼ è¾“æ•°æ®çš„å¤§å°" class="headerlink" title="ä¸ºä»€ä¹ˆBinderè¦é™åˆ¶ä¼ è¾“æ•°æ®çš„å¤§å°"></a>ä¸ºä»€ä¹ˆBinderè¦é™åˆ¶ä¼ è¾“æ•°æ®çš„å¤§å°</h2><p>ä¸ªäººæ¨æµ‹ï¼Œä½œä¸ºä¸€ç§IPCçš„æ–¹å¼ï¼ŒBinderå¹¶ä¸æ˜¯ä¸ºä¼ è¾“å¤§é‡æ•°æ®è€Œè®¾è®¡ã€‚</p><p>ä¼ è¾“å¤§é‡æ•°æ®ï¼Œå¯ä»¥è€ƒè™‘URLä¹‹ç±»çš„æ–¹æ³•ã€‚</p><p>å‚è€ƒ</p><ul><li><a href="https://stackoverflow.com/questions/8434423/android-remote-method-data-limit">https://stackoverflow.com/questions/8434423/android-remote-method-data-limit</a></li><li><a href="https://developer.android.com/reference/android/os/TransactionTooLargeException">https://developer.android.com/reference/android/os/TransactionTooLargeException</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Android NDK Makefileç›¸å…³ä¸ç¤ºä¾‹</title>
    <link href="/2018/05/21/Android/NDK-Makefile_example/"/>
    <url>/2018/05/21/Android/NDK-Makefile_example/</url>
    
    <content type="html"><![CDATA[<h2 id="Android-mkä¸Application-mk"><a href="#Android-mkä¸Application-mk" class="headerlink" title="Android.mkä¸Application.mk"></a><code>Android.mk</code>ä¸<code>Application.mk</code></h2><p>Android Studio 3ä¹‹å‰ï¼Œéœ€è¦ç¼–å†™<code>Android.mk</code>å’Œ<code>Application.mk</code>æ–‡ä»¶ã€‚</p><p>ä½¿ç”¨jdk8æˆ–jdk7ä¸­æä¾›çš„<code>javah</code>æ¥ç”Ÿæˆå¤´æ–‡ä»¶ã€‚</p><h3 id="build-gradleè®¾å®šjni"><a href="#build-gradleè®¾å®šjni" class="headerlink" title="build.gradleè®¾å®šjni"></a><code>build.gradle</code>è®¾å®šjni</h3><p>ä»¥ä¸‹æ˜¯æŸæ¨¡å—çš„<code>build.gradle</code>æ–‡ä»¶<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus">android &#123;<br>    <span class="hljs-comment">// ....</span><br>    sourceSets<span class="hljs-selector-class">.main</span> &#123;<br>        jni<span class="hljs-selector-class">.srcDirs</span> = <span class="hljs-selector-attr">[]</span> <span class="hljs-comment">// ç¦æ­¢è‡ªåŠ¨æ‰§è¡Œndk-build</span><br>        jniLibs<span class="hljs-selector-class">.srcDirs</span> = <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;src/main/libs&#x27;</span>]</span> <span class="hljs-comment">// è®¾å®šæˆsoæ–‡ä»¶ç”Ÿæˆçš„ç›®å½•</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="æŒ‡å®šæ¨¡å—çš„åå­—"><a href="#æŒ‡å®šæ¨¡å—çš„åå­—" class="headerlink" title="æŒ‡å®šæ¨¡å—çš„åå­—"></a>æŒ‡å®šæ¨¡å—çš„åå­—</h3><p>åœ¨<code>Android.mk</code>æ–‡ä»¶ä¸­æŒ‡å®šæ¨¡å—çš„åå­—<br><figure class="highlight fix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">LOCAL_MODULE :</span>=<span class="hljs-string"> modname</span><br></code></pre></td></tr></table></figure><br>ç¼–è¯‘å¾—åˆ°<code>libmodname.so</code>æ–‡ä»¶</p><p>åŠ è½½åº“æ–‡ä»¶<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> &#123;<br>    System.loadLibrary(<span class="hljs-string">&quot;modname&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="åˆ©ç”¨-TARGET-ARCH-ABI-åˆ¤æ–­ç›®æ ‡æ¶æ„ç±»åˆ«"><a href="#åˆ©ç”¨-TARGET-ARCH-ABI-åˆ¤æ–­ç›®æ ‡æ¶æ„ç±»åˆ«" class="headerlink" title="åˆ©ç”¨$(TARGET_ARCH_ABI)åˆ¤æ–­ç›®æ ‡æ¶æ„ç±»åˆ«"></a>åˆ©ç”¨<code>$(TARGET_ARCH_ABI)</code>åˆ¤æ–­ç›®æ ‡æ¶æ„ç±»åˆ«</h3><p>Android Studio 3ä¹‹å‰ï¼Œéœ€è¦ç¼–å†™<code>Android.mk</code>å’Œ<code>Application.mk</code>æ–‡ä»¶ã€‚ä½¿ç”¨jdk8æˆ–jdk7ã€‚</p><p>ä¸€ä¸ªå…¸å‹<code>Application.mk</code><br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs makefile">APP_ABI := arm64-v8a armeabi-v7a<br>APP_PLATFORM := android-19<br>APP_STL := gnustl_static<br>APP_CPPFLAGS += -std=c++11<br></code></pre></td></tr></table></figure><br>æŒ‡å®šäº†2ç§æ¶æ„</p><p>åœ¨<code>Android.mk</code>ä¸­ï¼Œå¯ä»¥ç”¨<code>$(TARGET_ARCH_ABI)</code>åˆ¤æ–­ç›®æ ‡æ¶æ„ç±»åˆ«ï¼›<br>ä¾‹å¦‚jniç›®å½•ä¸­æœ‰å¦‚ä¸‹çš„æ–‡ä»¶<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">jni<br>|<span class="hljs-string">-- Android.mk</span><br><span class="hljs-string"></span>|<span class="hljs-string">-- Application.mk</span><br><span class="hljs-string"></span>|<span class="hljs-string">-- something.cpp</span><br><span class="hljs-string"></span>|<span class="hljs-string">-- include</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- something.h</span><br><span class="hljs-string"></span>|<span class="hljs-string">-- lib</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- arm64-v8a</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   `-- libcustom.a</span><br><span class="hljs-string"></span>|<span class="hljs-string">   `-- armeabi-v7a</span><br><span class="hljs-string"></span>|<span class="hljs-string">       `-- libcustom.a</span><br></code></pre></td></tr></table></figure></p><p><code>Android.mk</code>ä¸­åˆ¤æ–­å½“å‰ç¼–è¯‘çš„ç›®æ ‡æ¶æ„è€ŒåŠ è½½åº“æ–‡ä»¶<code>libcustom.a</code><br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs makefile">LOCAL_LDFLAGS := <span class="hljs-variable">$(LOCAL_PATH)</span>/lib/<span class="hljs-variable">$(TARGET_ARCH_ABI)</span>/libcustom.a<br></code></pre></td></tr></table></figure></p><h3 id="å¼•ç”¨OpenCVæ¨¡å—"><a href="#å¼•ç”¨OpenCVæ¨¡å—" class="headerlink" title="å¼•ç”¨OpenCVæ¨¡å—"></a>å¼•ç”¨OpenCVæ¨¡å—</h3><p>å‡è®¾å·²ç»ä¸‹è½½å¥½<code>opencv-3.2.0</code>SDKï¼Œ<code>Android.mk</code>ä¸­å¼•ç”¨<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gradle">OPENCVROOT:=$(LOCAL_PATH)<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>opencv-<span class="hljs-number">3.2</span>.<span class="hljs-number">0</span>-android-sdk/OpenCV-android-sdk<br>OPENCV_CAMERA_MODULES:=off<br>OPENCV_INSTALL_MODULES:=on<br>OPENCV_LIB_TYPE:=<span class="hljs-keyword">STATIC</span><br><br><span class="hljs-keyword">include</span> $&#123;OPENCVROOT&#125;<span class="hljs-regexp">/sdk/</span><span class="hljs-keyword">native</span><span class="hljs-regexp">/jni/</span>OpenCV.mk<br></code></pre></td></tr></table></figure><br>ä½¿ç”¨ç›¸å¯¹è·¯å¾„æ‰¾åˆ°sdkï¼Œå¼•å…¥OpenCVçš„mkæ–‡ä»¶</p><h2 id="Android-NDK-é€šç”¨-makefile-ä¸ç›¸å…³é…ç½®"><a href="#Android-NDK-é€šç”¨-makefile-ä¸ç›¸å…³é…ç½®" class="headerlink" title="Android NDK é€šç”¨ makefile ä¸ç›¸å…³é…ç½®"></a>Android NDK é€šç”¨ makefile ä¸ç›¸å…³é…ç½®</h2><p><code>Android.mk</code><br><figure class="highlight mk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mk">LOCAL_PATH:= <span class="hljs-variable">$(<span class="hljs-built_in">call</span> my-<span class="hljs-built_in">dir</span>)</span><br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(CLEAR_VARS)</span><br>LOCAL_MODULE := waveExtract<br>TARGET_ARCH_ABI := all<br><br>LOCAL_SRC_FILES := src/wave_display.c src/FFT.c<br><br>LOCAL_LDLIBS+= -L<span class="hljs-variable">$(SYSROOT)</span>/usr/lib -llog<br><br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(BUILD_SHARED_LIBRARY)</span><br></code></pre></td></tr></table></figure></p><hr><p><code>Application.mk</code><br><figure class="highlight mk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mk">APP_PLATFORM := android-19<br>APP_MODULES := waveExtract<br>APP_ABI := armeabi-v7a arm64-v8a<br>APP_STL := stlport_static<br>APP_CPPFLAGS += -fexceptions<br><span class="hljs-comment"># for using c++ features,you need to enable these in your Makefile</span><br>APP_CPP_FEATURES += exceptions rtti<br></code></pre></td></tr></table></figure></p><hr><p><code>build.gradle</code><br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs stylus">apply plugin: <span class="hljs-string">&#x27;com.android.library&#x27;</span><br><br>android &#123;<br>    compileSdkVersion <span class="hljs-number">28</span><br><br>    defaultConfig &#123;<br>        minSdkVersion <span class="hljs-number">19</span><br>        targetSdkVersion <span class="hljs-number">28</span><br>        versionCode <span class="hljs-number">1</span><br>        versionName <span class="hljs-string">&quot;1.0&quot;</span><br><br>        testInstrumentationRunner <span class="hljs-string">&quot;android.support.test.runner.AndroidJUnitRunner&quot;</span><br><br>    &#125;<br><br>    buildTypes &#123;<br>        release &#123;<br>            minifyEnabled false<br>            proguardFiles <span class="hljs-built_in">getDefaultProguardFile</span>(<span class="hljs-string">&#x27;proguard-android.txt&#x27;</span>), <span class="hljs-string">&#x27;proguard-rules.pro&#x27;</span><br>        &#125;<br>    &#125;<br><br>    sourceSets &#123;<br>        <span class="hljs-selector-tag">main</span> &#123;<br>            jni<span class="hljs-selector-class">.srcDirs</span> = <span class="hljs-selector-attr">[]</span><br>            jniLibs<span class="hljs-selector-class">.srcDirs</span> = <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;src/main/libs&#x27;</span>]</span><br>        &#125;<br>    &#125;<br><br>&#125;<br><br>dependencies &#123;<br>    implementation <span class="hljs-built_in">fileTree</span>(dir: <span class="hljs-string">&#x27;libs&#x27;</span>, include: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;*.jar&#x27;</span>]</span>)<br><br>    implementation <span class="hljs-string">&#x27;com.android.support:appcompat-v7:28.+&#x27;</span><br>    testImplementation <span class="hljs-string">&#x27;junit:junit:4.12&#x27;</span><br>    androidTestImplementation <span class="hljs-string">&#x27;com.android.support.test:runner:1.0.2&#x27;</span><br>    androidTestImplementation <span class="hljs-string">&#x27;com.android.support.test.espresso:espresso-core:3.0.2&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Activityä¸­è·å–Viewçš„å®½é«˜</title>
    <link href="/2018/04/19/Android/Android-Activity_View_get_size/"/>
    <url>/2018/04/19/Android/Android-Activity_View_get_size/</url>
    
    <content type="html"><![CDATA[<p>æœ‰äº›æ—¶å€™æˆ‘ä»¬éœ€è¦è·å–åˆ°Viewçš„å®½é«˜ä¿¡æ¯ã€‚åœ¨onCreateå’ŒonResumeä¸­å°è¯•view.getWidth()æˆ–æ˜¯view.getHeiht()æ—¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°è·å–åˆ°çš„æ˜¯0ã€‚<br>Activityè§†å›¾åœ¨åˆ›å»ºå®Œæˆåï¼Œå„ä¸ªå­viewå¹¶ä¸ä¸€å®šè¢«åŠ è½½å®Œæˆã€‚<br>è·å–å®½é«˜æ­£ç¡®çš„æ–¹æ³•æœ‰å“ªäº›å‘¢ï¼Ÿ</p><h2 id="æ–¹æ³•1-åœ¨Activityçš„onWindowFocusChangedè·å–å®½é«˜"><a href="#æ–¹æ³•1-åœ¨Activityçš„onWindowFocusChangedè·å–å®½é«˜" class="headerlink" title="æ–¹æ³•1 - åœ¨Activityçš„onWindowFocusChangedè·å–å®½é«˜"></a>æ–¹æ³•1 - åœ¨Activityçš„<code>onWindowFocusChanged</code>è·å–å®½é«˜</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onWindowFocusChanged</span><span class="hljs-params">(<span class="hljs-type">boolean</span> hasFocus)</span> &#123;<br>    <span class="hljs-built_in">super</span>.onWindowFocusChanged(hasFocus);<br>    <span class="hljs-comment">// åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°Viewçš„çœŸå®å®½é«˜</span><br>    Log.d(TAG, <span class="hljs-string">&quot;onWindowFocusChanged: mBtn1.getWidth == &quot;</span> + mBtn1.getWidth());<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ–¹æ³•2-ä½¿ç”¨ViewTreeObserverçš„OnGlobalLayoutListenerå›è°ƒ"><a href="#æ–¹æ³•2-ä½¿ç”¨ViewTreeObserverçš„OnGlobalLayoutListenerå›è°ƒ" class="headerlink" title="æ–¹æ³•2 - ä½¿ç”¨ViewTreeObserverçš„OnGlobalLayoutListenerå›è°ƒ"></a>æ–¹æ³•2 - ä½¿ç”¨ViewTreeObserverçš„<code>OnGlobalLayoutListener</code>å›è°ƒ</h2><p>è·å–Viewçš„ViewTreeObserverï¼Œæ·»åŠ å›è°ƒ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">ViewTreeObserver</span> <span class="hljs-variable">vto</span> <span class="hljs-operator">=</span> mBtn1.getViewTreeObserver();<br>vto.addOnGlobalLayoutListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewTreeObserver</span>.OnGlobalLayoutListener() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onGlobalLayout</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">height</span> <span class="hljs-operator">=</span> mBtn1.getHeight();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">width</span> <span class="hljs-operator">=</span> mBtn1.getWidth();<br>        Log.d(TAG, <span class="hljs-string">&quot;onGlobalLayout: mBtn1 &quot;</span> + width + <span class="hljs-string">&quot;, &quot;</span> + height);<br>        mBtn1.getViewTreeObserver().removeOnGlobalLayoutListener(<span class="hljs-built_in">this</span>);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure></p><h2 id="æ–¹æ³•3-ä½¿ç”¨View-post-Runnable-action-æ–¹æ³•"><a href="#æ–¹æ³•3-ä½¿ç”¨View-post-Runnable-action-æ–¹æ³•" class="headerlink" title="æ–¹æ³•3 - ä½¿ç”¨View.post(Runnable action)æ–¹æ³•"></a>æ–¹æ³•3 - ä½¿ç”¨<code>View.post(Runnable action)</code>æ–¹æ³•</h2><p>ä¾‹å¦‚æˆ‘ä»¬åœ¨onCreateä¸­postä¸€ä¸ªRunnable<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        mBtn1 = findViewById(R.id.btn1);<br>        Log.d(TAG, <span class="hljs-string">&quot;mBtn1 post runnable&quot;</span>);<br>        mBtn1.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                Log.d(TAG, <span class="hljs-string">&quot;mBtn1: &quot;</span> + mBtn1.getWidth() + <span class="hljs-string">&quot;, &quot;</span> + mBtn1.getHeight());<br>            &#125;<br>        &#125;);<br>    &#125;<br><br><span class="hljs-comment">/* log</span><br><span class="hljs-comment">06-19 11:54:17.865 28009-28009/com.rustfisher.basic4 D/rustApp: mBtn1 post runnable</span><br><span class="hljs-comment">06-19 11:54:17.867 28009-28009/com.rustfisher.basic4 D/rustApp: [act2] onResume</span><br><span class="hljs-comment">06-19 11:54:17.899 28009-28009/com.rustfisher.basic4 D/rustApp: mBtn1: 355, 144</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><br>å¯ä»¥è·å–åˆ°viewçš„å®½é«˜ã€‚ä»logçš„æ—¶é—´ä¸Šå¯ä»¥çœ‹å‡ºï¼Œåœ¨viewåŠ è½½å®Œæ¯•åï¼Œæ‰§è¡Œçš„Runnableã€‚</p><h2 id="åº”ç”¨-åŠ¨æ€è°ƒæ•´ImageViewçš„å®½é«˜"><a href="#åº”ç”¨-åŠ¨æ€è°ƒæ•´ImageViewçš„å®½é«˜" class="headerlink" title="åº”ç”¨ - åŠ¨æ€è°ƒæ•´ImageViewçš„å®½é«˜"></a>åº”ç”¨ - åŠ¨æ€è°ƒæ•´ImageViewçš„å®½é«˜</h2><p>è·å–åˆ°viewçš„å®½é«˜åï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨æ€åœ°è°ƒæ•´ImageViewçš„é«˜åº¦ã€‚<br>å‡è®¾å›¾ç‰‡å®½é«˜ä¸º704 * 440ã€‚xmlä¸­è®¾ç½®scaleTypeä¸ºfitXYã€‚å·²çŸ¥ImageViewçš„å®½åº¦æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒæ•´é«˜åº¦ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">ImageView</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">&quot;match_parent&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">&quot;wrap_content&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:scaleType</span>=<span class="hljs-string">&quot;fitXY&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><p>æ ¹æ®å›¾ç‰‡çœŸå®å¤§å°æ¥é‡è®¾ImageViewçš„é«˜åº¦ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onWindowFocusChanged</span><span class="hljs-params">(<span class="hljs-type">boolean</span> hasFocus)</span> &#123;<br>    <span class="hljs-built_in">super</span>.onWindowFocusChanged(hasFocus);<br>    resetIntroIvParams();<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">resetIntroIvParams</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">height</span> <span class="hljs-operator">=</span> mIntroIv.getHeight(); <span class="hljs-comment">// 704 * 440</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">wid</span> <span class="hljs-operator">=</span> mIntroIv.getWidth();<br>    <span class="hljs-keyword">if</span> (height &gt; <span class="hljs-number">0</span> &amp;&amp; wid &gt; <span class="hljs-number">0</span>) &#123;<br>        ViewGroup.<span class="hljs-type">LayoutParams</span> <span class="hljs-variable">layoutParams</span> <span class="hljs-operator">=</span> mIntroIv.getLayoutParams();<br>        layoutParams.height = (<span class="hljs-type">int</span>) (wid * <span class="hljs-number">440.0</span> / <span class="hljs-number">704.0</span>);<br>        mIntroIv.setLayoutParams(layoutParams);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android_View</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android ä½¿ç”¨ MediaExtractor å’Œ MediaMuxer è§£æå’Œå°è£… mp4 æ–‡ä»¶</title>
    <link href="/2018/03/01/Android/Android-MediaMuxer_MediaExtractor_mp4/"/>
    <url>/2018/03/01/Android/Android-MediaMuxer_MediaExtractor_mp4/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ç›®çš„ï¼šä½¿ç”¨ MediaExtractor å’Œ MediaMuxer è§£æå’Œå°è£… mp4 æ–‡ä»¶</p><h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>MP4æˆ–ç§°MPEG-4ç¬¬14éƒ¨åˆ†ï¼ˆè‹±è¯­ï¼šMPEG-4 Part 14ï¼‰æ˜¯ä¸€ç§æ ‡å‡†çš„æ•°å­—å¤šåª’ä½“å®¹å™¨æ ¼å¼ã€‚</p><p>MP4ä¸­çš„éŸ³é¢‘æ ¼å¼é€šå¸¸ä¸ºAAC(audio/mp4a-latm)</p><h4 id="MediaExtractor"><a href="#MediaExtractor" class="headerlink" title="MediaExtractor"></a>MediaExtractor</h4><p><a href="https://developer.android.com/reference/android/media/MediaExtractor.html">MediaExtractor</a> å¯ç”¨äºåˆ†ç¦»å¤šåª’ä½“å®¹å™¨ä¸­è§†é¢‘trackå’ŒéŸ³é¢‘track</p><p><code>setDataSource()</code> è®¾ç½®æ•°æ®æºï¼Œæ•°æ®æºå¯ä»¥æ˜¯æœ¬åœ°æ–‡ä»¶åœ°å€ï¼Œä¹Ÿå¯ä»¥æ˜¯ç½‘ç»œåœ°å€</p><p><code>getTrackFormat(int index)</code> æ¥è·å–å„ä¸ªtrackçš„<code>MediaFormat</code>ï¼Œé€šè¿‡<code>MediaFormat</code>æ¥è·å–trackçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ï¼šMimeTypeã€åˆ†è¾¨ç‡ã€é‡‡æ ·é¢‘ç‡ã€å¸§ç‡ç­‰ç­‰</p><p><code>selectTrack(int index)</code> é€šè¿‡ä¸‹æ ‡é€‰æ‹©æŒ‡å®šçš„é€šé“</p><p><code>readSampleData(ByteBuffer buffer, int offset)</code> è·å–å½“å‰ç¼–ç å¥½çš„æ•°æ®å¹¶å­˜åœ¨æŒ‡å®šå¥½åç§»é‡çš„bufferä¸­</p><h4 id="MediaMuxer"><a href="#MediaMuxer" class="headerlink" title="MediaMuxer"></a>MediaMuxer</h4><p><a href="https://developer.android.com/reference/android/media/MediaMuxer.html">MediaMuxer</a> å¯ç”¨äºæ··åˆåŸºæœ¬ç æµã€‚å°†æ‰€æœ‰çš„ä¿¡é“çš„ä¿¡æ¯åˆæˆä¸€ä¸ªè§†é¢‘ã€‚<br>ç›®å‰è¾“å‡ºæ ¼å¼æ”¯æŒMP4ï¼ŒWebmï¼Œ3GPã€‚ä»Android Nougatå¼€å§‹æ”¯æŒå‘MP4ä¸­æ··å…¥B-framesã€‚</p><h3 id="æå–å¹¶è¾“å‡ºMP4æ–‡ä»¶ä¸­çš„è§†é¢‘éƒ¨åˆ†"><a href="#æå–å¹¶è¾“å‡ºMP4æ–‡ä»¶ä¸­çš„è§†é¢‘éƒ¨åˆ†" class="headerlink" title="æå–å¹¶è¾“å‡ºMP4æ–‡ä»¶ä¸­çš„è§†é¢‘éƒ¨åˆ†"></a>æå–å¹¶è¾“å‡ºMP4æ–‡ä»¶ä¸­çš„è§†é¢‘éƒ¨åˆ†</h3><p>ä»ä¸€ä¸ªMP4æ–‡ä»¶ä¸­æå–å‡ºè§†é¢‘ï¼Œå¾—åˆ°ä¸å«éŸ³é¢‘çš„MP4æ–‡ä»¶ã€‚</p><p>å®ç°æµç¨‹ï¼Œé¦–å…ˆæ˜¯ä½¿ç”¨<code>MediaExtractor</code>æå–ï¼Œç„¶åä½¿ç”¨<code>MediaMuxer</code>è¾“å‡ºMP4æ–‡ä»¶ã€‚</p><ul><li><code>MediaExtractor</code>è®¾ç½®æ•°æ®æºï¼Œæ‰¾åˆ°å¹¶é€‰æ‹©è§†é¢‘è½¨é“çš„æ ¼å¼å’Œä¸‹æ ‡</li><li><code>MediaMuxer</code>è®¾ç½®è¾“å‡ºæ ¼å¼ä¸º<code>MUXER_OUTPUT_MPEG_4</code>ï¼Œæ·»åŠ å‰é¢é€‰å®šçš„æ ¼å¼ï¼Œè°ƒç”¨<code>start()</code>å¯åŠ¨</li><li><code>MediaExtractor</code>è¯»å–å¸§æ•°æ®ï¼Œä¸åœåœ°å°†å¸§æ•°æ®å’Œç›¸å…³ä¿¡æ¯ä¼ å…¥<code>MediaMuxer</code></li><li>æœ€ååœæ­¢å¹¶é‡Šæ”¾<code>MediaMuxer</code>å’Œ<code>MediaExtractor</code><br>æœ€å¥½æ”¾åœ¨å­çº¿ç¨‹ä¸­æ“ä½œã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æå–è§†é¢‘</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> sourceVideoPath åŸå§‹è§†é¢‘æ–‡ä»¶</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> Exception å‡ºé”™</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">extractVideo</span><span class="hljs-params">(String sourceVideoPath, String outVideoPath)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">MediaExtractor</span> <span class="hljs-variable">sourceMediaExtractor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaExtractor</span>();<br>    sourceMediaExtractor.setDataSource(sourceVideoPath);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">numTracks</span> <span class="hljs-operator">=</span> sourceMediaExtractor.getTrackCount();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">sourceVideoTrackIndex</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>; <span class="hljs-comment">// åŸå§‹è§†é¢‘æ–‡ä»¶è§†é¢‘è½¨é“å‚æ•°</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; numTracks; ++i) &#123;<br>        <span class="hljs-type">MediaFormat</span> <span class="hljs-variable">format</span> <span class="hljs-operator">=</span> sourceMediaExtractor.getTrackFormat(i);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">mime</span> <span class="hljs-operator">=</span> format.getString(MediaFormat.KEY_MIME);<br>        Log.d(TAG, <span class="hljs-string">&quot;MediaFormat: &quot;</span> + mime);<br>        <span class="hljs-keyword">if</span> (mime.startsWith(<span class="hljs-string">&quot;video/&quot;</span>)) &#123;<br>            sourceMediaExtractor.selectTrack(i);<br>            sourceVideoTrackIndex = i;<br>            Log.d(TAG, <span class="hljs-string">&quot;selectTrack index=&quot;</span> + i + <span class="hljs-string">&quot;; format: &quot;</span> + mime);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-type">MediaMuxer</span> <span class="hljs-variable">outputMediaMuxer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaMuxer</span>(outVideoPath,<br>            MediaMuxer.OutputFormat.MUXER_OUTPUT_MPEG_4);<br>    outputMediaMuxer.addTrack(sourceMediaExtractor.getTrackFormat(sourceVideoTrackIndex));<br>    outputMediaMuxer.start();<br><br>    <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">inputBuffer</span> <span class="hljs-operator">=</span> ByteBuffer.allocate(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">2</span>); <span class="hljs-comment">// åˆ†é…çš„å†…å­˜è¦å°½é‡å¤§ä¸€äº›</span><br>    MediaCodec.<span class="hljs-type">BufferInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaCodec</span>.BufferInfo();<br>    <span class="hljs-type">int</span> sampleSize;<br>    <span class="hljs-keyword">while</span> ((sampleSize = sourceMediaExtractor.readSampleData(inputBuffer, <span class="hljs-number">0</span>)) &gt;= <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">presentationTimeUs</span> <span class="hljs-operator">=</span> sourceMediaExtractor.getSampleTime();<br>        info.offset = <span class="hljs-number">0</span>;<br>        info.size = sampleSize;<br>        info.flags = MediaCodec.BUFFER_FLAG_SYNC_FRAME;<br>        info.presentationTimeUs = presentationTimeUs;<br>        outputMediaMuxer.writeSampleData(sourceVideoTrackIndex, inputBuffer, info);<br>        sourceMediaExtractor.advance();<br>    &#125;<br><br>    outputMediaMuxer.stop();<br>    outputMediaMuxer.release();    <span class="hljs-comment">// åœæ­¢å¹¶é‡Šæ”¾ MediaMuxer</span><br>    sourceMediaExtractor.release();<br>    sourceMediaExtractor = <span class="hljs-literal">null</span>;   <span class="hljs-comment">// é‡Šæ”¾ MediaExtractor</span><br>&#125;<br></code></pre></td></tr></table></figure>å¦‚æœä¸Šé¢çš„<code>ByteBuffer</code>åˆ†é…çš„ç©ºé—´å¤ªå°ï¼Œ<code>readSampleData(inputBuffer, 0)</code>å¯èƒ½ä¼šå‡ºç°<code>IllegalArgumentException</code>å¼‚å¸¸ã€‚</li></ul><h3 id="æå–MP4æ–‡ä»¶ä¸­çš„éŸ³é¢‘éƒ¨åˆ†ï¼Œè·å–éŸ³é¢‘æ–‡ä»¶"><a href="#æå–MP4æ–‡ä»¶ä¸­çš„éŸ³é¢‘éƒ¨åˆ†ï¼Œè·å–éŸ³é¢‘æ–‡ä»¶" class="headerlink" title="æå–MP4æ–‡ä»¶ä¸­çš„éŸ³é¢‘éƒ¨åˆ†ï¼Œè·å–éŸ³é¢‘æ–‡ä»¶"></a>æå–MP4æ–‡ä»¶ä¸­çš„éŸ³é¢‘éƒ¨åˆ†ï¼Œè·å–éŸ³é¢‘æ–‡ä»¶</h3><h4 id="åŸºäºJava-MP4-Parseræå–å‡ºAACæ–‡ä»¶çš„æ–¹æ³•"><a href="#åŸºäºJava-MP4-Parseræå–å‡ºAACæ–‡ä»¶çš„æ–¹æ³•" class="headerlink" title="åŸºäºJava MP4 Parseræå–å‡ºAACæ–‡ä»¶çš„æ–¹æ³•"></a>åŸºäº<code>Java MP4 Parser</code>æå–å‡ºAACæ–‡ä»¶çš„æ–¹æ³•</h4><p><code>Java MP4 Parser</code> - <a href="https://github.com/sannies/mp4parser">https://github.com/sannies/mp4parser</a><br>Javaå®ç°è¯»ã€å†™å’Œåˆ›å»ºMP4å®¹å™¨ã€‚ä½†æ˜¯å’Œç¼–è§£ç éŸ³è§†é¢‘æœ‰åŒºåˆ«ã€‚è¿™é‡Œä¸»è¦æ˜¯æå–ä¸å†åˆæˆã€‚</p><p>ä¸‹è½½<code>isoparser-1.1.22.jar</code>å¹¶æ·»åŠ è¿›å·¥ç¨‹ä¸­ï¼›å°è¯•è¿‡gradleç›´æ¥å¯¼å…¥ï¼Œä½†ä¸æˆåŠŸ</p><p>æ‰¾åˆ°è§†é¢‘æ–‡ä»¶ä¸­æ‰€æœ‰çš„éŸ³è½¨ï¼Œå°†å®ƒä»¬æå–å‡ºæ¥å†™å…¥æ–°çš„æ–‡ä»¶ä¸­<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">extractAudioFromMP4</span><span class="hljs-params">(String outAudioPath, String sourceMP4Path)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>    <span class="hljs-type">Movie</span> <span class="hljs-variable">movie</span> <span class="hljs-operator">=</span> MovieCreator.build(sourceMP4Path);<br>    List&lt;Track&gt; audioTracks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">for</span> (Track t : movie.getTracks()) &#123;<br>        <span class="hljs-keyword">if</span> (t.getHandler().equals(<span class="hljs-string">&quot;soun&quot;</span>)) &#123;<br>            audioTracks.add(t);<br>        &#125;<br>    &#125;<br>    <span class="hljs-type">Movie</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Movie</span>();<br>    <span class="hljs-keyword">if</span> (audioTracks.size() &gt; <span class="hljs-number">0</span>) &#123;<br>        result.addTrack(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AppendTrack</span>(audioTracks.toArray(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Track</span>[audioTracks.size()])));<br>    &#125;<br>    <span class="hljs-type">Container</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMp4Builder</span>().build(result);<br>    <span class="hljs-type">FileChannel</span> <span class="hljs-variable">fc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RandomAccessFile</span>(outAudioPath, <span class="hljs-string">&quot;rw&quot;</span>).getChannel();<br>    out.writeContainer(fc);<br>    fc.close();<br>&#125;<br></code></pre></td></tr></table></figure><br>åœ¨çº¢ç±³æ‰‹æœºä¸Šæµ‹è¯•æˆåŠŸã€‚ä»MP4æ–‡ä»¶ï¼ˆæ—¶é•¿çº¦2åˆ†20ç§’ï¼‰ä¸­æå–å‡ºçš„AACæ–‡ä»¶å¯åœ¨æ‰‹æœºä¸Šç›´æ¥æ’­æ”¾ã€‚</p><h3 id="å°†AACéŸ³è½¨æ¢åˆ°å¦ä¸€ä¸ªMP4æ–‡ä»¶"><a href="#å°†AACéŸ³è½¨æ¢åˆ°å¦ä¸€ä¸ªMP4æ–‡ä»¶" class="headerlink" title="å°†AACéŸ³è½¨æ¢åˆ°å¦ä¸€ä¸ªMP4æ–‡ä»¶"></a>å°†AACéŸ³è½¨æ¢åˆ°å¦ä¸€ä¸ªMP4æ–‡ä»¶</h3><p>MediaExtractorå¯ä»¥ç›´æ¥ä»æå–AACæ–‡ä»¶æˆ–MP4æ–‡ä»¶ä¸­æå–ACCéŸ³è½¨ï¼ŒMediaMuxeræ¥å†™å…¥æ–°çš„MP4æ–‡ä»¶ã€‚</p><p>æä¾›éŸ³é¢‘çš„æ–‡ä»¶å¯ä»¥æ˜¯MP4æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯AACæ–‡ä»¶ï¼›å¦ä¸€ä¸ªæä¾›è§†é¢‘ï¼Œæ··åˆè¾“å‡ºæ–°çš„MP4æ–‡ä»¶ã€‚</p><p>ç”Ÿæˆçš„è§†é¢‘çš„é•¿åº¦ç”±æä¾›è§†é¢‘çš„æ–‡ä»¶å†³å®šã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> outputVideoFilePath è¾“å‡ºè§†é¢‘æ–‡ä»¶è·¯å¾„</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> videoProviderPath   æä¾›è§†é¢‘çš„MP4æ–‡ä»¶ æ—¶é•¿ä»¥æ­¤ä¸ºå‡†</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> audioProviderPath   æä¾›éŸ³é¢‘çš„æ–‡ä»¶</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@throws</span> Exception è¿è¡Œå¼‚å¸¸  ä¾‹å¦‚è¯»å†™æ–‡ä»¶å¼‚å¸¸</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">replaceAudioForMP4File</span><span class="hljs-params">(String outputVideoFilePath, String videoProviderPath,</span><br><span class="hljs-params">                                          String audioProviderPath)</span><br>        <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">MediaMuxer</span> <span class="hljs-variable">mediaMuxer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaMuxer</span>(outputVideoFilePath,<br>            MediaMuxer.OutputFormat.MUXER_OUTPUT_MPEG_4);<br><br>    <span class="hljs-comment">// è§†é¢‘ MediaExtractor</span><br>    <span class="hljs-type">MediaExtractor</span> <span class="hljs-variable">mVideoExtractor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaExtractor</span>();<br>    mVideoExtractor.setDataSource(videoProviderPath);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">videoTrackIndex</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; mVideoExtractor.getTrackCount(); i++) &#123;<br>        <span class="hljs-type">MediaFormat</span> <span class="hljs-variable">format</span> <span class="hljs-operator">=</span> mVideoExtractor.getTrackFormat(i);<br>        <span class="hljs-keyword">if</span> (format.getString(MediaFormat.KEY_MIME).startsWith(<span class="hljs-string">&quot;video/&quot;</span>)) &#123;<br>            mVideoExtractor.selectTrack(i);<br>            videoTrackIndex = mediaMuxer.addTrack(format);<br>            Log.d(TAG, <span class="hljs-string">&quot;Video: format:&quot;</span> + format);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// éŸ³é¢‘ MediaExtractor</span><br>    <span class="hljs-type">MediaExtractor</span> <span class="hljs-variable">audioExtractor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaExtractor</span>();<br>    audioExtractor.setDataSource(audioProviderPath);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">audioTrackIndex</span> <span class="hljs-operator">=</span> -<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; audioExtractor.getTrackCount(); i++) &#123;<br>        <span class="hljs-type">MediaFormat</span> <span class="hljs-variable">format</span> <span class="hljs-operator">=</span> audioExtractor.getTrackFormat(i);<br>        <span class="hljs-keyword">if</span> (format.getString(MediaFormat.KEY_MIME).startsWith(<span class="hljs-string">&quot;audio/&quot;</span>)) &#123;<br>            audioExtractor.selectTrack(i);<br>            audioTrackIndex = mediaMuxer.addTrack(format);<br>            Log.d(TAG, <span class="hljs-string">&quot;Audio: format:&quot;</span> + format);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    mediaMuxer.start(); <span class="hljs-comment">// æ·»åŠ å®Œæ‰€æœ‰è½¨é“åstart</span><br><br>    <span class="hljs-type">long</span> <span class="hljs-variable">videoEndPreTimeUs</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">// å°è£…è§†é¢‘track</span><br>    <span class="hljs-keyword">if</span> (-<span class="hljs-number">1</span> != videoTrackIndex) &#123;<br>        MediaCodec.<span class="hljs-type">BufferInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaCodec</span>.BufferInfo();<br>        info.presentationTimeUs = <span class="hljs-number">0</span>;<br>        <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ByteBuffer.allocate(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);<br>        <span class="hljs-type">int</span> sampleSize;<br>        <span class="hljs-keyword">while</span> ((sampleSize = mVideoExtractor.readSampleData(buffer, <span class="hljs-number">0</span>)) &gt;= <span class="hljs-number">0</span>) &#123;<br>            info.offset = <span class="hljs-number">0</span>;<br>            info.size = sampleSize;<br>            info.flags = MediaCodec.BUFFER_FLAG_SYNC_FRAME;<br>            info.presentationTimeUs = mVideoExtractor.getSampleTime();<br>            videoEndPreTimeUs = info.presentationTimeUs;<br>            mediaMuxer.writeSampleData(videoTrackIndex, buffer, info);<br>            mVideoExtractor.advance();<br>        &#125;<br>    &#125;<br>    Log.d(TAG, <span class="hljs-string">&quot;è§†é¢‘ videoEndPreTimeUs &quot;</span> + videoEndPreTimeUs);<br><br>    <span class="hljs-comment">// å°è£…éŸ³é¢‘track</span><br>    <span class="hljs-keyword">if</span> (-<span class="hljs-number">1</span> != audioTrackIndex) &#123;<br>        MediaCodec.<span class="hljs-type">BufferInfo</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaCodec</span>.BufferInfo();<br>        info.presentationTimeUs = <span class="hljs-number">0</span>;<br>        <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ByteBuffer.allocate(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);<br>        <span class="hljs-type">int</span> sampleSize;<br>        <span class="hljs-keyword">while</span> ((sampleSize = audioExtractor.readSampleData(buffer, <span class="hljs-number">0</span>)) &gt;= <span class="hljs-number">0</span> &amp;&amp;<br>                audioExtractor.getSampleTime() &lt;= videoEndPreTimeUs) &#123;<br>            info.offset = <span class="hljs-number">0</span>;<br>            info.size = sampleSize;<br>            info.flags = MediaCodec.BUFFER_FLAG_SYNC_FRAME;<br>            info.presentationTimeUs = audioExtractor.getSampleTime();<br>            mediaMuxer.writeSampleData(audioTrackIndex, buffer, info);<br>            audioExtractor.advance();<br>        &#125;<br>    &#125;<br>    mVideoExtractor.release(); <span class="hljs-comment">// é‡Šæ”¾MediaExtractor</span><br>    audioExtractor.release();<br>    mediaMuxer.stop();<br>    mediaMuxer.release();     <span class="hljs-comment">// é‡Šæ”¾MediaMuxer</span><br>&#125;<br></code></pre></td></tr></table></figure></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Video: format:&#123;<span class="hljs-attribute">csd-1</span>=java.nio.ByteArrayBuffer[<span class="hljs-attribute">position</span>=0,limit=9,capacity=9], <span class="hljs-attribute">mime</span>=video/avc, <span class="hljs-attribute">frame-rate</span>=30, <span class="hljs-attribute">height</span>=1080, <span class="hljs-attribute">width</span>=1920, <span class="hljs-attribute">max-input-size</span>=1572864, <span class="hljs-attribute">isDMCMMExtractor</span>=1, <span class="hljs-attribute">durationUs</span>=12425577, <span class="hljs-attribute">csd-0</span>=java.nio.ByteArrayBuffer[<span class="hljs-attribute">position</span>=0,limit=20,capacity=20]&#125;<br>Audio: format:&#123;<span class="hljs-attribute">max-input-size</span>=5532, <span class="hljs-attribute">aac-profile</span>=2, <span class="hljs-attribute">mime</span>=audio/mp4a-latm, <span class="hljs-attribute">durationUs</span>=340101875, <span class="hljs-attribute">csd-0</span>=java.nio.ByteArrayBuffer[<span class="hljs-attribute">position</span>=0,limit=2,capacity=2], <span class="hljs-attribute">channel-count</span>=2, <span class="hljs-attribute">sample-rate</span>=44100&#125;<br></code></pre></td></tr></table></figure><h3 id="MP3è½¬æ¢ä¸ºAAC"><a href="#MP3è½¬æ¢ä¸ºAAC" class="headerlink" title="MP3è½¬æ¢ä¸ºAAC"></a>MP3è½¬æ¢ä¸ºAAC</h3><h4 id="ä½¿ç”¨-AndroidAudioConverter"><a href="#ä½¿ç”¨-AndroidAudioConverter" class="headerlink" title="ä½¿ç”¨ AndroidAudioConverter"></a>ä½¿ç”¨ AndroidAudioConverter</h4><p>AndroidAudioConverter - <a href="https://github.com/adrielcafe/AndroidAudioConverter">https://github.com/adrielcafe/AndroidAudioConverter</a></p><p>åŸºäºFFmpegçš„ç¬¬ä¸‰æ–¹åº“ã€‚æ”¯æŒæ ¼å¼æœ‰AAC, MP3, M4A, WMA, WAV å’Œ FLAC</p><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><p><code>app/build.gradle</code><br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">repositories</span> &#123;<br>  maven &#123;<br>    url <span class="hljs-string">&quot;https://jitpack.io&quot;</span><br>  &#125;<br>&#125;<br><br><span class="hljs-keyword">dependencies</span> &#123;<br>  <span class="hljs-keyword">compile</span> <span class="hljs-string">&#x27;com.github.adrielcafe:AndroidAudioConverter:0.0.8&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure></p><p>ç”³è¯·è¯»å†™å¤–éƒ¨å­˜å‚¨æƒé™<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><br>åœ¨<code>Application</code>ç±»ä¸­åŠ è½½åº“<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MuxerApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Application</span> &#123;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate();<br>        AndroidAudioConverter.load(<span class="hljs-built_in">this</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ILoadCallback</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">()</span> &#123;<br>                <span class="hljs-comment">// Great!</span><br>            &#125;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">(Exception error)</span> &#123;<br>                <span class="hljs-comment">// FFmpeg is not supported by device</span><br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br>ä½¿ç”¨è½¬æ¢åŠŸèƒ½<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">sourceMP3Path</span> <span class="hljs-operator">=</span> SOURCE_PATH + File.separator + <span class="hljs-string">&quot;music1.mp3&quot;</span>;<br>Log.d(TAG, <span class="hljs-string">&quot;è½¬æ¢å¼€å§‹ &quot;</span> + sourceMP3Path);<br><span class="hljs-type">File</span> <span class="hljs-variable">srcFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(sourceMP3Path);<br><span class="hljs-type">IConvertCallback</span> <span class="hljs-variable">callback</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IConvertCallback</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(File convertedFile)</span> &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;onSuccess: &quot;</span> + convertedFile);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">(Exception error)</span> &#123;<br>        Log.e(TAG, <span class="hljs-string">&quot;onFailure: &quot;</span>, error);<br>    &#125;<br>&#125;;<br>AndroidAudioConverter.with(getApplicationContext())<br>        <span class="hljs-comment">// Your current audio file</span><br>        .setFile(srcFile)<br><br>        <span class="hljs-comment">// Your desired audio format</span><br>        .setFormat(AudioFormat.AAC)<br><br>        <span class="hljs-comment">// An callback to know when conversion is finished</span><br>        .setCallback(callback)<br><br>        <span class="hljs-comment">// Start conversion</span><br>        .convert();<br></code></pre></td></tr></table></figure></p><p>åœ¨ä¸‰æ˜ŸNote4ä¸Šæµ‹è¯•ï¼Œè½¬æ¢13MBçš„MP3æ–‡ä»¶ç”¨äº†å¤§çº¦3åˆ†18ç§’ã€‚</p><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><ul><li><a href="https://developer.android.com/reference/android/media/MediaExtractor.html">MediaExtractor - Android Developer</a></li><li><a href="https://developer.android.com/reference/android/media/MediaMuxer.html">MediaMuxer - Android Developer</a></li><li><a href="https://github.com/sannies/mp4parser">Java MP4 Parser</a></li></ul><p><a href="https://rustfisher.com/tags/Android-Media/">AndroidéŸ³è§†é¢‘ç›¸å…³æ–‡ç« </a><br><a href="https://rustfisher.com/2019/12/08/Android_tutorial_2020/Android-tutorial_2020_a_menu/">Android tutorial 2020</a></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android_Media</tag>
      
      <tag>Media</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»</title>
    <link href="/2018/02/05/Android/adb_mock_touch_and_monkeyrunner/"/>
    <url>/2018/02/05/Android/adb_mock_touch_and_monkeyrunner/</url>
    
    <content type="html"><![CDATA[<p>Androidæ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»ã€‚åœ¨è‡ªåŠ¨åŒ–æµ‹è¯•ä¸­å¯ä½¿ç”¨çš„å·¥å…·ã€‚<br>å¯ä»¥åˆ©ç”¨adbå‘½ä»¤ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Android SDKä¸­çš„<code>monkeyrunner</code>å·¥å…·ã€‚</p><ul><li>win7-64</li><li>gitbash</li></ul><h1 id="ä½¿ç”¨adbå‘½ä»¤"><a href="#ä½¿ç”¨adbå‘½ä»¤" class="headerlink" title="ä½¿ç”¨adbå‘½ä»¤"></a>ä½¿ç”¨adbå‘½ä»¤</h1><p>ä¸»è¦ä½¿ç”¨inputå‘½ä»¤<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vim">usage: <span class="hljs-built_in">input</span> ...<br><br>       <span class="hljs-built_in">input</span> text <span class="hljs-symbol">&lt;string&gt;</span><br>       <span class="hljs-built_in">input</span> keyevent &lt;key code <span class="hljs-keyword">number</span> <span class="hljs-built_in">or</span> name&gt;<br>       <span class="hljs-built_in">input</span> tap <span class="hljs-symbol">&lt;x&gt;</span> <span class="hljs-symbol">&lt;y&gt;</span><br>       <span class="hljs-built_in">input</span> swipe <span class="hljs-symbol">&lt;x1&gt;</span> <span class="hljs-symbol">&lt;y1&gt;</span> <span class="hljs-symbol">&lt;x2&gt;</span> <span class="hljs-symbol">&lt;y2&gt;</span><br></code></pre></td></tr></table></figure><br>keyeventæŒ‡çš„æ˜¯androidå¯¹åº”çš„keycodeï¼Œæ¯”å¦‚homeé”®çš„keycode=3ï¼Œbacké”®çš„keycode=4</p><p>tapæ˜¯touchå±å¹•çš„äº‹ä»¶ï¼Œåªéœ€ç»™å‡ºxã€yåæ ‡å³å¯</p><p>swipeæ¨¡æ‹Ÿæ»‘åŠ¨çš„äº‹ä»¶ï¼Œç»™å‡ºèµ·ç‚¹å’Œç»ˆç‚¹çš„åæ ‡å³å¯</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bat"># æ¨¡æ‹Ÿç‚¹å‡»ä½ç½® (<span class="hljs-number">100</span>,<span class="hljs-number">100</span>)<br>adb shell input tap <span class="hljs-number">100</span> <span class="hljs-number">100</span><br><br># æ¨¡æ‹Ÿæ»‘åŠ¨ ä»(<span class="hljs-number">650</span>, <span class="hljs-number">250</span>)åˆ°(<span class="hljs-number">200</span>,<span class="hljs-number">300</span>)<br>adb shell input swipe <span class="hljs-number">650</span> <span class="hljs-number">250</span> <span class="hljs-number">200</span> <span class="hljs-number">300</span><br></code></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ªbatè„šæœ¬ï¼Œæ¨¡æ‹Ÿç”¨æˆ·æ»‘åŠ¨<br><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bat">@<span class="hljs-built_in">echo</span> off<br><span class="hljs-built_in">echo</span> --------- Mock <span class="hljs-built_in">start</span> ----------<br><br>:tag_start<br><span class="hljs-built_in">echo</span> running...<br>adb shell input swipe <span class="hljs-number">650</span> <span class="hljs-number">250</span> <span class="hljs-number">200</span> <span class="hljs-number">666</span><br>@<span class="hljs-built_in">ping</span> <span class="hljs-number">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span> -n <span class="hljs-number">8</span> &gt;<span class="hljs-built_in">nul</span><br><span class="hljs-keyword">goto</span> tag_start<br><br><span class="hljs-built_in">echo</span> --------- Mock finish ---------<br><span class="hljs-built_in">pause</span><br></code></pre></td></tr></table></figure></p><p>æ­»å¾ªç¯å‘é€æ»‘åŠ¨å‘½ä»¤ï¼Œå»¶æ—¶è¯­å¥<br><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bat">@<span class="hljs-built_in">ping</span> <span class="hljs-number">127</span>.<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span> -n <span class="hljs-number">8</span> &gt;<span class="hljs-built_in">nul</span><br></code></pre></td></tr></table></figure></p><h1 id="monkeyrunner"><a href="#monkeyrunner" class="headerlink" title="monkeyrunner"></a>monkeyrunner</h1><p>ç¯å¢ƒé…ç½®ï¼Œé…ç½®å¥½Javaä¸Android SDKçš„ç¯å¢ƒå˜é‡ã€‚æ‰‹æœºè¿æ¥åˆ°ç”µè„‘ã€‚<br>ç³»ç»Ÿå˜é‡ä¸­åŠ å…¥<code>ANDROID_SWT</code>ï¼Œæ­¤ä¾‹ä¸­è·¯å¾„ä¸º<code>G:\SDK\tools\lib\x86_64</code></p><p>ä¿®æ”¹åçš„è„šæœ¬<code>rustmonkeyrunner.bat</code>ï¼ŒWindowsç¯å¢ƒä¸‹éœ€è¦åœ¨gitbashæˆ–CMDé‡Œè¿è¡Œ</p><p>æ¥è‡ª<a href="https://stackoverflow.com/questions/44666939/unable-to-access-jarfile-framework-monkeyrunner-25-3-2-jar">unable-to-access-jarfile-framework-monkeyrunner-25-3-2-jar</a><br><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs bat">@<span class="hljs-built_in">echo</span> off<br><span class="hljs-comment">rem Copyright (C) 2010 The Android Open Source Project</span><br><span class="hljs-comment">rem</span><br><span class="hljs-comment">rem Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span><br><span class="hljs-comment">rem you may not use this file except in compliance with the License.</span><br><span class="hljs-comment">rem You may obtain a copy of the License at</span><br><span class="hljs-comment">rem</span><br><span class="hljs-comment">rem      http://www.apache.org/licenses/LICENSE-2.0</span><br><span class="hljs-comment">rem</span><br><span class="hljs-comment">rem Unless required by applicable law or agreed to in writing, software</span><br><span class="hljs-comment">rem distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span><br><span class="hljs-comment">rem WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span><br><span class="hljs-comment">rem See the License for the specific language governing permissions and</span><br><span class="hljs-comment">rem limitations under the License.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">rem don&#x27;t modify the caller&#x27;s environment</span><br><span class="hljs-built_in">setlocal</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">rem Set up prog to be the path of this script, including following symlinks,</span><br><span class="hljs-comment">rem and set up progdir to be the fully-qualified pathname of its directory.</span><br><span class="hljs-built_in">set</span> prog=%~f0<br><span class="hljs-comment"></span><br><span class="hljs-comment">rem Change current directory and drive to where the script is, to avoid</span><br><span class="hljs-comment">rem issues with directories containing whitespaces.</span><br><span class="hljs-built_in">cd</span> /d %~dp0<br><span class="hljs-comment"></span><br><span class="hljs-comment">rem Check we have a valid Java.exe in the path.</span><br><span class="hljs-built_in">set</span> java_exe=<br><span class="hljs-keyword">call</span> ..\lib\find_java.bat<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">defined</span> java_exe <span class="hljs-keyword">goto</span> :EOF<br><span class="hljs-keyword">for</span> /f <span class="hljs-variable">%%a</span> <span class="hljs-keyword">in</span> (&quot;<span class="hljs-variable">%APP_HOME%</span>\lib\monkeyrunner-<span class="hljs-number">25</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span>.jar&quot;) <span class="hljs-keyword">do</span> <span class="hljs-built_in">set</span> jarfile=<span class="hljs-variable">%%~</span>nxa<br><span class="hljs-built_in">set</span> frameworkdir=.<br><span class="hljs-built_in">set</span> libdir=<br><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">exist</span> <span class="hljs-variable">%frameworkdir%</span>\<span class="hljs-variable">%jarfile%</span> <span class="hljs-keyword">goto</span> JarFileOk<br>    <span class="hljs-built_in">set</span> frameworkdir=..\lib<br><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">exist</span> <span class="hljs-variable">%frameworkdir%</span>\<span class="hljs-variable">%jarfile%</span> <span class="hljs-keyword">goto</span> JarFileOk<br>    <span class="hljs-built_in">set</span> frameworkdir=..\framework<br><br>:JarFileOk<br><br><span class="hljs-built_in">set</span> jarpath=<span class="hljs-variable">%frameworkdir%</span>\<span class="hljs-variable">%jarfile%</span><br><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">defined</span> ANDROID_SWT <span class="hljs-keyword">goto</span> QueryArch<br>    <span class="hljs-built_in">set</span> swt_path=<span class="hljs-variable">%ANDROID_SWT%</span><br>    <span class="hljs-keyword">goto</span> SwtDone<br><br>:QueryArch<br><br>    <span class="hljs-keyword">for</span> /f &quot;delims=&quot; <span class="hljs-variable">%%a</span> <span class="hljs-keyword">in</span> (&#x27;<span class="hljs-variable">%frameworkdir%</span>\..\bin\archquery&#x27;) <span class="hljs-keyword">do</span> <span class="hljs-built_in">set</span> swt_path=<span class="hljs-variable">%frameworkdir%</span>\<span class="hljs-variable">%%a</span><br><br>:SwtDone<br><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">exist</span> &quot;<span class="hljs-variable">%swt_path%</span>&quot; <span class="hljs-keyword">goto</span> SetPath<br>    <span class="hljs-built_in">echo</span> SWT folder &#x27;<span class="hljs-variable">%swt_path%</span>&#x27; does <span class="hljs-keyword">not</span> <span class="hljs-keyword">exist</span>.<br>    <span class="hljs-built_in">echo</span> Please <span class="hljs-built_in">set</span> ANDROID_SWT to point to the folder containing swt.jar <span class="hljs-keyword">for</span> your platform.<br>    <span class="hljs-keyword">exit</span> /B<br><br>:SetPath<br><br><span class="hljs-keyword">call</span> &quot;<span class="hljs-variable">%java_exe%</span>&quot; -Xmx512m &quot;-Djava.ext.dirs=<span class="hljs-variable">%frameworkdir%</span>;<span class="hljs-variable">%swt_path%</span>&quot; -Dcom.android.monkeyrunner.bindir=..\..\platform-tools -jar <span class="hljs-variable">%jarpath%</span> %*<br></code></pre></td></tr></table></figure></p><p>è¿è¡Œè„šæœ¬<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">Administrator@rust-PC ~<br>$ <span class="hljs-regexp">/cygdrive/g</span><span class="hljs-regexp">/SDK/</span>tools<span class="hljs-regexp">/bin/</span>rustmonkeyrunner.bat<br>Jython <span class="hljs-number">2.5</span>.<span class="hljs-number">3</span> (<span class="hljs-number">2.5</span>:c56500f08d34+, Aug <span class="hljs-number">13</span> <span class="hljs-number">2012</span>, <span class="hljs-number">14</span>:<span class="hljs-number">54</span>:<span class="hljs-number">35</span>)<br>[Java HotSpot(TM) <span class="hljs-number">64</span>-Bit Server VM (Oracle Corporation)] on java1.<span class="hljs-number">8.0</span>_77<br></code></pre></td></tr></table></figure></p><p>é¦–æ¬¡è¿è¡Œæ—¶importæ¨¡å—è¿Ÿè¿Ÿæ²¡æœ‰ååº”<br><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">from</span> com.android.monkeyrunner <span class="hljs-keyword">import</span> MonkeyRunner, MonkeyDevice, MonkeyImage</span><br></code></pre></td></tr></table></figure></p><p>å°è¯•è¿è¡Œè„šæœ¬<code>an_test2.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;importing module...&quot;</span>)<br><span class="hljs-keyword">from</span> com.android.monkeyrunner <span class="hljs-keyword">import</span> MonkeyRunner, MonkeyDevice, MonkeyImage<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;waiting for connection...&quot;</span>)<br>device = MonkeyRunner.waitForConnection()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;device found!&quot;</span>)<br><br>s_wid = <span class="hljs-built_in">int</span>(device.getProperty(<span class="hljs-string">&quot;display.width&quot;</span>))     <span class="hljs-comment"># è·å–å±å¹•å®½åº¦åƒç´ </span><br>s_height = <span class="hljs-built_in">int</span>(device.getProperty(<span class="hljs-string">&quot;display.height&quot;</span>)) <span class="hljs-comment"># è·å–å±å¹•é«˜åº¦åƒç´ </span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;build.version.sdk &quot;</span> + <span class="hljs-built_in">str</span>(device.getProperty(<span class="hljs-string">&quot;build.version.sdk&quot;</span>)))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;display.width     &quot;</span> + <span class="hljs-built_in">str</span>(s_wid))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;display.height    &quot;</span> + <span class="hljs-built_in">str</span>(s_height))<br><br>drag_point_left_x = <span class="hljs-number">20</span><br>drag_point_right_x = s_wid - <span class="hljs-number">20</span><br>drag_point_y = s_height / <span class="hljs-number">2</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;current loop is &quot;</span> + <span class="hljs-built_in">str</span>(i))<br>    device.drag((drag_point_right_x, drag_point_y), (drag_point_left_x, drag_point_y), <span class="hljs-number">1.0</span>, <span class="hljs-number">50</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;waiting...&quot;</span>)<br>    MonkeyRunner.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;continue&quot;</span>)<br>    device.drag((drag_point_left_x, drag_point_y), (drag_point_right_x, drag_point_y), <span class="hljs-number">0.5</span>, <span class="hljs-number">3</span>)<br>    MonkeyRunner.sleep(<span class="hljs-number">3</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;-------- finish --------&quot;</span>)<br></code></pre></td></tr></table></figure><p>å‘½ä»¤è¡Œç›´æ¥æ‰§è¡Œï¼Œå¯ä»¥çœ‹åˆ°æ‰§è¡Œç»“æœå’Œç›¸åº”çš„æŠ¥é”™ä¿¡æ¯<br><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs gams">C:\Users\Administrator&gt;G:\SDK\tools\bin\rustmonkeyrunner.bat H:\fisher_p\py_ws\an_test2.py<br><span class="hljs-function"><span class="hljs-title">importing</span></span> module...<br><span class="hljs-function"><span class="hljs-title">waiting</span></span> <span class="hljs-keyword">for</span> connection...<br>device found!<br>build.version.sdk <span class="hljs-number">23</span><br><span class="hljs-keyword">display</span>.width     <span class="hljs-number">1440</span><br><span class="hljs-keyword">display</span>.height    <span class="hljs-number">2560</span><br>current <span class="hljs-keyword">loop</span> is <span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-title">waiting</span></span>...<br>continue<br>current <span class="hljs-keyword">loop</span> is <span class="hljs-number">1</span><br># .....<br>-------- finish --------<br></code></pre></td></tr></table></figure><br>æµ‹è¯•ä¸­å‘ç°ï¼Œè„šæœ¬å¯ä»¥è¿è¡Œåœ¨ç³»ç»Ÿappã€‚è‹¥å½“å‰æ‰“å¼€çš„æ˜¯ç¬¬ä¸‰æ–¹appï¼Œä¼šç›´æ¥æŠ¥é”™ï¼Œè·å–ä¸åˆ°ç›¸åº”ä¿¡æ¯</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul><li><a href="https://stackoverflow.com/questions/15935622/getproperty-getsystemproperty-in-monkeyrunner-return-none">monkeyrunner è·å–ç³»ç»Ÿä¿¡æ¯</a></li><li><a href="https://developer.android.com/studio/test/monkeyrunner/MonkeyDevice.html">Android MonkeyDevice - Google</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Android MediaCodec ç¼–è§£ç </title>
    <link href="/2017/12/20/Android/Android-MediaCodec_use_demo/"/>
    <url>/2017/12/20/Android/Android-MediaCodec_use_demo/</url>
    
    <content type="html"><![CDATA[<h2 id="Android-MediaCodec-ä½¿ç”¨æ–¹å¼"><a href="#Android-MediaCodec-ä½¿ç”¨æ–¹å¼" class="headerlink" title="Android MediaCodec ä½¿ç”¨æ–¹å¼"></a>Android MediaCodec ä½¿ç”¨æ–¹å¼</h2><p>ä½¿ç”¨MediaCodecè¿›è¡Œç¼–è§£ç ã€‚è¾“å…¥H.264æ ¼å¼çš„æ•°æ®ï¼Œè¾“å‡ºå¸§æ•°æ®å¹¶å‘é€ç»™ç›‘å¬å™¨ã€‚  </p><h4 id="H-264çš„é…ç½®"><a href="#H-264çš„é…ç½®" class="headerlink" title="H.264çš„é…ç½®"></a>H.264çš„é…ç½®</h4><p>åˆ›å»ºå¹¶é…ç½®codecã€‚é…ç½®codecæ—¶ï¼Œè‹¥æ‰‹åŠ¨åˆ›å»ºMediaFormatå¯¹è±¡çš„è¯ï¼Œä¸€å®šè¦è®°å¾—<strong>è®¾ç½®â€csd-0â€å’Œâ€csd-1â€è¿™ä¸¤ä¸ªå‚æ•°</strong>ã€‚<br>â€œcsd-0â€å’Œâ€csd-1â€è¿™ä¸¤ä¸ªå‚æ•°ä¸€å®šè¦å’Œæ¥æ”¶åˆ°çš„å¸§å¯¹åº”ä¸Šã€‚  </p><h4 id="è¾“å…¥æ•°æ®"><a href="#è¾“å…¥æ•°æ®" class="headerlink" title="è¾“å…¥æ•°æ®"></a>è¾“å…¥æ•°æ®</h4><p>ç»™codecè¾“å…¥æ•°æ®æ—¶ï¼Œå¦‚æœå¯¹è¾“å…¥æ•°æ®è¿›è¡Œæ’é˜Ÿï¼Œéœ€è¦æ£€æŸ¥æ’é˜Ÿé˜Ÿåˆ—çš„æƒ…å†µã€‚<br>ä¾‹å¦‚ä¸€å¸§æ•°æ®æš‚ç”¨1Må†…å­˜ï¼Œ1ç§’30å¸§ï¼Œæ’é˜Ÿé˜Ÿåˆ—æœ‰å¯èƒ½ä¼šæš‚ç”¨30Mçš„å†…å­˜ã€‚å½“å†…å­˜æš‚ç”¨è¿‡é«˜ï¼Œæˆ‘ä»¬éœ€è¦é‡‡å–ä¸€å®šçš„æªæ–½æ¥å‡å°å†…å­˜å ç”¨ã€‚<br>codecç¡¬è§£ç æ—¶ä¼šå—åˆ°æ‰‹æœºç¡¬ä»¶çš„å½±å“ã€‚è‹¥æ‰‹æœºæ€§èƒ½ä¸ä½³ï¼Œç¼–è§£ç çš„é€Ÿåº¦æœ‰å¯èƒ½æ…¢äºåŸå§‹æ•°æ®è¾“å…¥ã€‚ä¸å¾—å·²çš„æƒ…å†µæˆ‘ä»¬å¯ä»¥å°†æ’é˜Ÿä¸­çš„æ—§æ•°æ®æŠ›å¼ƒï¼Œè¾“å…¥æ–°æ•°æ®ã€‚  </p><h4 id="è§£ç å™¨æ€§èƒ½"><a href="#è§£ç å™¨æ€§èƒ½" class="headerlink" title="è§£ç å™¨æ€§èƒ½"></a>è§£ç å™¨æ€§èƒ½</h4><p>å¯¹è§†é¢‘å®æ—¶æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼Œcodecæ²¡æœ‰å¯ç”¨çš„è¾“å…¥ç¼“å†²åŒºï¼Œ<code>mCodec.dequeueInputBuffer</code>è¿”å›-1ã€‚<br>ä¸ºäº†å®æ—¶æ€§ï¼Œè¿™é‡Œä¼šå¼ºåˆ¶é‡Šæ”¾æ‰è¾“å…¥è¾“å‡ºç¼“å†²åŒº<code>mCodec.flush()</code>ã€‚  </p><h4 id="é—®é¢˜1-MediaCodecè¾“å…¥æ•°æ®å’Œè¾“å‡ºæ•°æ®æ•°é‡ä¹‹é—´æœ‰æ²¡æœ‰ç‰¹å®šçš„å…³ç³»"><a href="#é—®é¢˜1-MediaCodecè¾“å…¥æ•°æ®å’Œè¾“å‡ºæ•°æ®æ•°é‡ä¹‹é—´æœ‰æ²¡æœ‰ç‰¹å®šçš„å…³ç³»" class="headerlink" title="é—®é¢˜1 - MediaCodecè¾“å…¥æ•°æ®å’Œè¾“å‡ºæ•°æ®æ•°é‡ä¹‹é—´æœ‰æ²¡æœ‰ç‰¹å®šçš„å…³ç³»"></a>é—®é¢˜1 - MediaCodecè¾“å…¥æ•°æ®å’Œè¾“å‡ºæ•°æ®æ•°é‡ä¹‹é—´æœ‰æ²¡æœ‰ç‰¹å®šçš„å…³ç³»</h4><p>å¯¹äºMediaCodecï¼Œè¾“å…¥æ•°æ®å’Œè¾“å‡ºæ•°æ®æ•°é‡ä¹‹é—´æœ‰æ²¡æœ‰ç‰¹å®šçš„å…³ç³»ï¼Ÿå‡è®¾è¾“å…¥10å¸§çš„æ•°æ®ï¼Œå¯ä»¥å¾—åˆ°å¤šå°‘æ¬¡è¾“å‡ºï¼Ÿ</p><p>å®æµ‹å‘ç°ï¼Œä¸èƒ½ç™¾åˆ†ç™¾ä¿è¯è¾“å…¥è¾“å‡ºæ¬¡æ•°æ˜¯ç›¸ç­‰çš„ã€‚ä¾‹å¦‚vivo x6 plusï¼Œè¾“å…¥30å¸§ï¼Œèƒ½å¾—åˆ°28å¸§ç»“æœã€‚æˆ–è€…300æ¬¡è¾“å…¥ï¼Œå¾—åˆ°298æ¬¡è¾“å‡ºã€‚</p><h4 id="å¼‚å¸¸1-dequeueInputBuffer-0-ä¸€ç›´è¿”å›-1"><a href="#å¼‚å¸¸1-dequeueInputBuffer-0-ä¸€ç›´è¿”å›-1" class="headerlink" title="å¼‚å¸¸1 - dequeueInputBuffer(0)ä¸€ç›´è¿”å›-1"></a>å¼‚å¸¸1 - dequeueInputBuffer(0)ä¸€ç›´è¿”å›-1</h4><p>æŸäº›æ‰‹æœºé•¿æ—¶é—´ç¼–è§£ç åï¼Œå¯èƒ½ä¼šå‡ºç°å°è¯•è·å–codecè¾“å…¥ç¼“å†²åŒºæ—¶ä¸‹æ ‡ä¸€ç›´è¿”å›-1ã€‚<br>ä¾‹å¦‚vivo x6 plusï¼Œè¿è¡Œçº¦20åˆ†é’Ÿåï¼Œ<code>mCodec.dequeueInputBuffer(0)</code>ä¸€ç›´è¿”å›-1ã€‚</p><p>å¤„ç†æ–¹æ³•ï¼šå¦‚æœä¸€ç›´è¿”å›-1ï¼ŒåŒæ­¥æ–¹å¼ä¸‹å°è¯•è°ƒç”¨<code>codec.flush()</code>æ–¹æ³•ï¼Œå¼‚æ­¥æ–¹å¼ä¸‹å°è¯•<code>codec.flush()</code>åå†è°ƒç”¨<code>codec.start()</code>æ–¹æ³•ã€‚</p><p>æœ‰ä¸€äº›æ‰‹æœºè§£ç é€Ÿåº¦å¤ªæ…¢ï¼Œæœ‰å¯èƒ½ä¼šç»å¸¸è¿”å›-1ã€‚ä¸è¦é¢‘ç¹è°ƒç”¨<code>codec.flush()</code>ï¼Œä»¥å…æ˜¾ç¤ºä¸æ­£å¸¸ã€‚</p><h3 id="ä»£ç ç¤ºä¾‹-åŒæ­¥æ–¹å¼è¿›è¡Œç¼–è§£ç "><a href="#ä»£ç ç¤ºä¾‹-åŒæ­¥æ–¹å¼è¿›è¡Œç¼–è§£ç " class="headerlink" title="ä»£ç ç¤ºä¾‹ - åŒæ­¥æ–¹å¼è¿›è¡Œç¼–è§£ç "></a>ä»£ç ç¤ºä¾‹ - åŒæ­¥æ–¹å¼è¿›è¡Œç¼–è§£ç </h3><p>è¿™ä¸€ä¸ªä¾‹å­ä½¿ç”¨åŒæ­¥æ–¹å¼è¿›è¡Œç¼–è§£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è§£ç å™¨</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CodecDecoder</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;CodecDecoder&quot;</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">MIME_TYPE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;video/avc&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CSD0</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;csd-0&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CSD1</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;csd-1&quot;</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">TIME_INTERNAL</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">DECODER_TIME_INTERNAL</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">private</span> MediaCodec mCodec;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">mCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// åª’ä½“è§£ç å™¨MediaCodecç”¨çš„</span><br><br>    <span class="hljs-comment">// é€å…¥ç¼–è§£ç å™¨å‰çš„ç¼“å†²é˜Ÿåˆ—</span><br>    <span class="hljs-comment">// éœ€è¦å®æ—¶ç›‘æ§è¿™ä¸ªé˜Ÿåˆ—æ‰€æš‚ç”¨çš„å†…å­˜æƒ…å†µ  åœ¨è¿™é‡Œå µå¡çš„è¯å¾ˆå®¹æ˜“å¼•èµ·OOM</span><br>    <span class="hljs-keyword">private</span> Queue&lt;<span class="hljs-type">byte</span>[]&gt; data = <span class="hljs-literal">null</span>;<br><br>    <span class="hljs-keyword">private</span> DecoderThread decoderThread;<br>    <span class="hljs-keyword">private</span> CodecListener listener; <span class="hljs-comment">// è‡ªå®šä¹‰çš„ç›‘å¬å™¨  å½“è§£ç å¾—åˆ°å¸§æ•°æ®æ—¶é€šè¿‡å®ƒå‘é€å‡ºå»</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CodecDecoder</span><span class="hljs-params">()</span> &#123;<br>        data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentLinkedQueue</span>&lt;&gt;();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCodecCreated</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> mCodec!=<span class="hljs-literal">null</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">createCodec</span><span class="hljs-params">(CodecListener listener, <span class="hljs-type">byte</span>[] spsBuffer, <span class="hljs-type">byte</span>[] ppsBuffer, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> &#123;<br>        <span class="hljs-built_in">this</span>.listener = listener;<br>        <span class="hljs-keyword">try</span> &#123;<br>            mCodec = MediaCodec.createDecoderByType(Constants.MIME_TYPE);<br>            <span class="hljs-type">MediaFormat</span> <span class="hljs-variable">mediaFormat</span> <span class="hljs-operator">=</span> createVideoFormat(spsBuffer, ppsBuffer, width, height);<br>            mCodec.configure(mediaFormat, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>);<br>            mCodec.start();<br><br>            Log.d(TAG, <span class="hljs-string">&quot;decoderThread mediaFormat in:&quot;</span> + mediaFormat);<br><br>            decoderThread = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DecoderThread</span>();<br>            decoderThread.start();<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>            Log.e(TAG, <span class="hljs-string">&quot;MediaCodec create error:&quot;</span> + e.getMessage());<br><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> MediaFormat <span class="hljs-title function_">createVideoFormat</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] spsBuffer, <span class="hljs-type">byte</span>[] ppsBuffer, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> &#123;<br>        MediaFormat mediaFormat;<br>        mediaFormat = MediaFormat.createVideoFormat(MIME_TYPE, width, height);<br>        mediaFormat.setByteBuffer(CSD0, ByteBuffer.wrap(spsBuffer));<br>        mediaFormat.setByteBuffer(CSD1, ByteBuffer.wrap(ppsBuffer));<br>        mediaFormat.setInteger(MediaFormat.KEY_COLOR_FORMAT,<br>                MediaCodecInfo.CodecCapabilities.COLOR_FormatYUV420Flexible);<br><br>        <span class="hljs-keyword">return</span> mediaFormat;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">lastInQueueTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-comment">// è¾“å…¥H.264å¸§æ•°æ®  è¿™é‡Œä¼šç›‘æ§æ’é˜Ÿæƒ…å†µ</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addData</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] dataBuffer)</span> &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">timeDiff</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - lastInQueueTime;<br>        <span class="hljs-keyword">if</span> (timeDiff &gt; <span class="hljs-number">1</span>) &#123;<br>            lastInQueueTime = System.currentTimeMillis();<br>            <span class="hljs-type">int</span> <span class="hljs-variable">queueSize</span> <span class="hljs-operator">=</span> data.size(); <span class="hljs-comment">// ConcurrentLinkedQueueæŸ¥è¯¢é•¿åº¦æ—¶ä¼šéå†ä¸€æ¬¡ åœ¨æ•°æ®é‡å·¨å¤§çš„æƒ…å†µä¸‹å°½é‡å°‘ç”¨è¿™ä¸ªæ–¹æ³•</span><br>            <span class="hljs-keyword">if</span> (queueSize &gt; <span class="hljs-number">30</span>) &#123;<br>                data.clear();<br>                LogInFile.getLogger().e(<span class="hljs-string">&quot;frame queue å¸§æ•°æ®é˜Ÿåˆ—è¶…å‡ºä¸Šé™ï¼Œè‡ªåŠ¨æ¸…é™¤æ•°æ® &quot;</span> + queueSize);<br>            &#125;<br>            data.add(dataBuffer.clone());<br>            Log.e(TAG, <span class="hljs-string">&quot;frame queue æ·»åŠ ä¸€å¸§æ•°æ®&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            LogInFile.getLogger().e(<span class="hljs-string">&quot;frame queue æ·»åŠ é€Ÿåº¦å¤ªå¿«,è·³è¿‡æ­¤å¸§. timeDiff=&quot;</span> + timeDiff);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroyCodec</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (mCodec != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                mCount = <span class="hljs-number">0</span>;<br><br>                <span class="hljs-keyword">if</span>(data!=<span class="hljs-literal">null</span>) &#123;<br>                    data.clear();<br>                    data = <span class="hljs-literal">null</span>;<br>                &#125;<br><br>                <span class="hljs-keyword">if</span>(decoderThread!=<span class="hljs-literal">null</span>) &#123;<br>                    decoderThread.stopThread();<br>                    decoderThread = <span class="hljs-literal">null</span>;<br>                &#125;<br><br>                mCodec.release();<br>                mCodec = <span class="hljs-literal">null</span>;<br>            &#125;<br>            <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                e.printStackTrace();<br>                Log.d(TAG, <span class="hljs-string">&quot;destroyCodec exception:&quot;</span> + e.toString());<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DecoderThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">INPUT_BUFFER_FULL_COUNT_MAX</span> <span class="hljs-operator">=</span> <span class="hljs-number">50</span>;<br>        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> isRunning;<br>        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">inputBufferFullCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// è¾“å…¥ç¼“å†²åŒºæ»¡äº†å¤šå°‘æ¬¡</span><br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stopThread</span><span class="hljs-params">()</span> &#123;<br>            isRunning = <span class="hljs-literal">false</span>;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            setName(<span class="hljs-string">&quot;CodecDecoder_DecoderThread-&quot;</span> + getId());<br>            isRunning = <span class="hljs-literal">true</span>;<br>            <span class="hljs-keyword">while</span> (isRunning) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-keyword">if</span> (data != <span class="hljs-literal">null</span> &amp;&amp; !data.isEmpty()) &#123;<br>                        <span class="hljs-type">int</span> <span class="hljs-variable">inputBufferIndex</span> <span class="hljs-operator">=</span> mCodec.dequeueInputBuffer(<span class="hljs-number">0</span>);<br>                        <span class="hljs-keyword">if</span> (inputBufferIndex &gt;= <span class="hljs-number">0</span>) &#123;<br>                            <span class="hljs-type">byte</span>[] buf = data.poll();<br>                            <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">inputBuffer</span> <span class="hljs-operator">=</span> mCodec.getInputBuffer(inputBufferIndex);<br>                            <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != inputBuffer) &#123;<br>                                inputBuffer.clear();<br>                                inputBuffer.put(buf, <span class="hljs-number">0</span>, buf.length);<br>                                mCodec.queueInputBuffer(inputBufferIndex, <span class="hljs-number">0</span>,<br>                                        buf.length, mCount * TIME_INTERNAL, <span class="hljs-number">0</span>);<br>                                mCount++;<br>                            &#125;<br>                            inputBufferFullCount = <span class="hljs-number">0</span>; <span class="hljs-comment">// è¿˜æœ‰ç¼“å†²åŒºå¯ä»¥ç”¨çš„æ—¶å€™é‡ç½®è®¡æ•°</span><br>                        &#125; <span class="hljs-keyword">else</span> &#123;<br>                            inputBufferFullCount++;<br>                            LogInFile.getLogger().e(TAG, <span class="hljs-string">&quot;decoderThread inputBuffer full.  inputBufferFullCount=&quot;</span> + inputBufferFullCount);<br>                            <span class="hljs-keyword">if</span> (inputBufferFullCount &gt; INPUT_BUFFER_FULL_COUNT_MAX) &#123;<br>                                mCount = <span class="hljs-number">0</span>;<br>                                mCodec.flush(); <span class="hljs-comment">// åœ¨è¿™é‡Œæ¸…é™¤æ‰€æœ‰ç¼“å†²åŒº</span><br>                                LogInFile.getLogger().e(TAG, <span class="hljs-string">&quot;mCodec.flush()...&quot;</span>);<br>                            &#125;<br>                        &#125;<br>                    &#125;<br><br>                    <span class="hljs-comment">// Get output buffer index</span><br>                    MediaCodec.<span class="hljs-type">BufferInfo</span> <span class="hljs-variable">bufferInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaCodec</span>.BufferInfo();<br>                    <span class="hljs-type">int</span> <span class="hljs-variable">outputBufferIndex</span> <span class="hljs-operator">=</span> mCodec.dequeueOutputBuffer(bufferInfo, <span class="hljs-number">0</span>);<br>                    <span class="hljs-keyword">while</span> (outputBufferIndex &gt;= <span class="hljs-number">0</span>) &#123;<br>                        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> outputBufferIndex;<br>                        Log.d(TAG, <span class="hljs-string">&quot;releaseOutputBuffer &quot;</span> + Thread.currentThread().toString());<br>                        <span class="hljs-keyword">final</span> <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">outputBuffer</span> <span class="hljs-operator">=</span> byteBufferClone(mCodec.getOutputBuffer(index));<br>                        <span class="hljs-type">Image</span> <span class="hljs-variable">image</span> <span class="hljs-operator">=</span> mCodec.getOutputImage(index);<br>                        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != image) &#123;<br>                            <span class="hljs-comment">// è·å–NV21æ ¼å¼çš„æ•°æ®</span><br>                            <span class="hljs-keyword">final</span> <span class="hljs-type">byte</span>[] nv21 = ImageUtil.getDataFromImage(image, FaceDetectUtil.COLOR_FormatNV21);<br>                            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">imageWid</span> <span class="hljs-operator">=</span> image.getWidth();<br>                            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">imageHei</span> <span class="hljs-operator">=</span> image.getHeight();<br>                            <span class="hljs-comment">// è¿™é‡Œé€‰æ‹©åˆ›å»ºæ–°çš„çº¿ç¨‹å»å‘é€æ•°æ® - è¿™æ˜¯å¯ä¼˜åŒ–çš„åœ°æ–¹</span><br>                            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>                                <span class="hljs-meta">@Override</span><br>                                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                                    listener.onDataDecoded(outputBuffer,<br>                                            mCodec.getOutputFormat().getInteger(MediaFormat.KEY_COLOR_FORMAT),<br>                                            nv21, imageWid, imageHei);<br>                                &#125;<br>                            &#125;).start();<br>                        &#125; <span class="hljs-keyword">else</span> &#123;<br>                            listener.onDataDecoded(outputBuffer,<br>                                    mCodec.getOutputFormat().getInteger(MediaFormat.KEY_COLOR_FORMAT),<br>                                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[]&#123;<span class="hljs-number">0</span>&#125;, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>                        &#125;<br><br>                        <span class="hljs-keyword">try</span> &#123;<br>                            mCodec.releaseOutputBuffer(index, <span class="hljs-literal">false</span>);<br>                        &#125; <span class="hljs-keyword">catch</span> (IllegalStateException ex) &#123;<br>                            android.util.Log.e(TAG, <span class="hljs-string">&quot;releaseOutputBuffer ERROR&quot;</span>, ex);<br>                        &#125;<br>                        outputBufferIndex = mCodec.dequeueOutputBuffer(bufferInfo, <span class="hljs-number">0</span>);<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    e.printStackTrace();<br>                    Log.e(TAG, <span class="hljs-string">&quot;decoderThread exception:&quot;</span> + e.getMessage());<br>                &#125;<br><br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(DECODER_TIME_INTERNAL);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// deep clone byteBuffer</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ByteBuffer <span class="hljs-title function_">byteBufferClone</span><span class="hljs-params">(ByteBuffer buffer)</span> &#123;<br>        <span class="hljs-keyword">if</span> (buffer.remaining() == <span class="hljs-number">0</span>)<br>            <span class="hljs-keyword">return</span> ByteBuffer.wrap(<span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[]&#123;<span class="hljs-number">0</span>&#125;);<br><br>        <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">clone</span> <span class="hljs-operator">=</span> ByteBuffer.allocate(buffer.remaining());<br><br>        <span class="hljs-keyword">if</span> (buffer.hasArray()) &#123;<br>            System.arraycopy(buffer.array(), buffer.arrayOffset() + buffer.position(), clone.array(), <span class="hljs-number">0</span>, buffer.remaining());<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            clone.put(buffer.duplicate());<br>            clone.flip();<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> clone;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></p><h3 id="ä»£ç ç¤ºä¾‹-å·¥å…·å‡½æ•°"><a href="#ä»£ç ç¤ºä¾‹-å·¥å…·å‡½æ•°" class="headerlink" title="ä»£ç ç¤ºä¾‹ - å·¥å…·å‡½æ•°"></a>ä»£ç ç¤ºä¾‹ - å·¥å…·å‡½æ•°</h3><p>ä¸€äº›å·¥å…·å‡½æ•°ã€‚æ¯”å¦‚ä»imageä¸­å–å‡ºNV21æ ¼å¼çš„æ•°æ®ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] getDataFromImage(Image image) &#123;<br>    <span class="hljs-keyword">return</span> getDataFromImage(image, COLOR_FormatNV21);<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å°†Imageæ ¹æ®colorFormatç±»å‹çš„byteæ•°æ®</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">byte</span>[] getDataFromImage(Image image, <span class="hljs-type">int</span> colorFormat) &#123;<br>    <span class="hljs-keyword">if</span> (colorFormat != COLOR_FormatI420 &amp;&amp; colorFormat != COLOR_FormatNV21) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;only support COLOR_FormatI420 &quot;</span> + <span class="hljs-string">&quot;and COLOR_FormatNV21&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (!isImageFormatSupported(image)) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;can&#x27;t convert Image to byte array, format &quot;</span> + image.getFormat());<br>    &#125;<br>    <span class="hljs-type">Rect</span> <span class="hljs-variable">crop</span> <span class="hljs-operator">=</span> image.getCropRect();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">format</span> <span class="hljs-operator">=</span> image.getFormat();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">width</span> <span class="hljs-operator">=</span> crop.width();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">height</span> <span class="hljs-operator">=</span> crop.height();<br>    Image.Plane[] planes = image.getPlanes();<br>    <span class="hljs-type">byte</span>[] data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[width * height * ImageFormat.getBitsPerPixel(format) / <span class="hljs-number">8</span>];<br>    <span class="hljs-type">byte</span>[] rowData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[planes[<span class="hljs-number">0</span>].getRowStride()];<br>    <span class="hljs-type">int</span> <span class="hljs-variable">channelOffset</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">outputStride</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; planes.length; i++) &#123;<br>        <span class="hljs-keyword">switch</span> (i) &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">0</span>:<br>                channelOffset = <span class="hljs-number">0</span>;<br>                outputStride = <span class="hljs-number">1</span>;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>                <span class="hljs-keyword">if</span> (colorFormat == COLOR_FormatI420) &#123;<br>                    channelOffset = width * height;<br>                    outputStride = <span class="hljs-number">1</span>;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (colorFormat == COLOR_FormatNV21) &#123;<br>                    channelOffset = width * height + <span class="hljs-number">1</span>;<br>                    outputStride = <span class="hljs-number">2</span>;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>                <span class="hljs-keyword">if</span> (colorFormat == COLOR_FormatI420) &#123;<br>                    channelOffset = (<span class="hljs-type">int</span>) (width * height * <span class="hljs-number">1.25</span>);<br>                    outputStride = <span class="hljs-number">1</span>;<br>                &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (colorFormat == COLOR_FormatNV21) &#123;<br>                    channelOffset = width * height;<br>                    outputStride = <span class="hljs-number">2</span>;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> planes[i].getBuffer();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">rowStride</span> <span class="hljs-operator">=</span> planes[i].getRowStride();<br>        <span class="hljs-type">int</span> <span class="hljs-variable">pixelStride</span> <span class="hljs-operator">=</span> planes[i].getPixelStride();<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">shift</span> <span class="hljs-operator">=</span> (i == <span class="hljs-number">0</span>) ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">w</span> <span class="hljs-operator">=</span> width &gt;&gt; shift;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> height &gt;&gt; shift;<br>        buffer.position(rowStride * (crop.top &gt;&gt; shift) + pixelStride * (crop.left &gt;&gt; shift));<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">row</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; row &lt; h; row++) &#123;<br>            <span class="hljs-type">int</span> length;<br>            <span class="hljs-keyword">if</span> (pixelStride == <span class="hljs-number">1</span> &amp;&amp; outputStride == <span class="hljs-number">1</span>) &#123;<br>                length = w;<br>                buffer.get(data, channelOffset, length);<br>                channelOffset += length;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                length = (w - <span class="hljs-number">1</span>) * pixelStride + <span class="hljs-number">1</span>;<br>                buffer.get(rowData, <span class="hljs-number">0</span>, length);<br>                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">col</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; col &lt; w; col++) &#123;<br>                    data[channelOffset] = rowData[col * pixelStride];<br>                    channelOffset += outputStride;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (row &lt; h - <span class="hljs-number">1</span>) &#123;<br>                buffer.position(buffer.position() + rowStride - length);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> data;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ˜¯å¦æ˜¯æ”¯æŒçš„æ•°æ®ç±»å‹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isImageFormatSupported</span><span class="hljs-params">(Image image)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-variable">format</span> <span class="hljs-operator">=</span> image.getFormat();<br>    <span class="hljs-keyword">switch</span> (format) &#123;<br>        <span class="hljs-keyword">case</span> ImageFormat.YUV_420_888:<br>        <span class="hljs-keyword">case</span> ImageFormat.NV21:<br>        <span class="hljs-keyword">case</span> ImageFormat.YV12:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure><br>â€œcsd-0â€å’Œâ€csd-1â€æ˜¯ä»€ä¹ˆï¼Œå¯¹äºH264è§†é¢‘çš„è¯ï¼Œå®ƒå¯¹åº”çš„æ˜¯spså’Œppsï¼Œå¯¹äºAACéŸ³é¢‘çš„è¯ï¼Œå¯¹åº”çš„æ˜¯ADTSï¼ŒåšéŸ³è§†é¢‘å¼€å‘çš„äººåº”è¯¥éƒ½çŸ¥é“ï¼Œå®ƒä¸€èˆ¬å­˜åœ¨äºç¼–ç å™¨ç”Ÿæˆçš„IDRå¸§ä¹‹ä¸­ã€‚</p><p>å¾—åˆ°çš„mediaFormat<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">mediaFormat <span class="hljs-keyword">in</span>:&#123;<span class="hljs-attribute">height</span>=720, <span class="hljs-attribute">width</span>=1280, <span class="hljs-attribute">csd-1</span>=java.nio.ByteArrayBuffer[<span class="hljs-attribute">position</span>=0,limit=7,capacity=7], <span class="hljs-attribute">mime</span>=video/avc, <span class="hljs-attribute">csd-0</span>=java.nio.ByteArrayBuffer[<span class="hljs-attribute">position</span>=0,limit=13,capacity=13], <span class="hljs-attribute">color-format</span>=2135033992&#125;<br></code></pre></td></tr></table></figure></p><h3 id="å­˜å‚¨å›¾ç‰‡çš„æ–¹æ³•"><a href="#å­˜å‚¨å›¾ç‰‡çš„æ–¹æ³•" class="headerlink" title="å­˜å‚¨å›¾ç‰‡çš„æ–¹æ³•"></a>å­˜å‚¨å›¾ç‰‡çš„æ–¹æ³•</h3><p>Imageç±»åœ¨Android API21åŠä»¥ååŠŸèƒ½ååˆ†å¼ºå¤§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dumpFile</span><span class="hljs-params">(String fileName, <span class="hljs-type">byte</span>[] data)</span> &#123;<br>    FileOutputStream outStream;<br>    <span class="hljs-keyword">try</span> &#123;<br>        outStream = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(fileName);<br>    &#125; <span class="hljs-keyword">catch</span> (IOException ioe) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Unable to create output file &quot;</span> + fileName, ioe);<br>    &#125;<br>    <span class="hljs-keyword">try</span> &#123;<br>        outStream.write(data);<br>        outStream.close();<br>    &#125; <span class="hljs-keyword">catch</span> (IOException ioe) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;failed writing data to file &quot;</span> + fileName, ioe);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">compressToJpeg</span><span class="hljs-params">(String fileName, Image image)</span> &#123;<br>    FileOutputStream outStream;<br>    <span class="hljs-keyword">try</span> &#123;<br>        outStream = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(fileName);<br>    &#125; <span class="hljs-keyword">catch</span> (IOException ioe) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Unable to create output file &quot;</span> + fileName, ioe);<br>    &#125;<br>    <span class="hljs-type">Rect</span> <span class="hljs-variable">rect</span> <span class="hljs-operator">=</span> image.getCropRect();<br>    <span class="hljs-type">YuvImage</span> <span class="hljs-variable">yuvImage</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">YuvImage</span>(getDataFromImage(image, COLOR_FormatNV21), ImageFormat.NV21, rect.width(), rect.height(), <span class="hljs-literal">null</span>);<br>    yuvImage.compressToJpeg(rect, <span class="hljs-number">100</span>, outStream);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="NV21è½¬bitmapçš„æ–¹æ³•"><a href="#NV21è½¬bitmapçš„æ–¹æ³•" class="headerlink" title="NV21è½¬bitmapçš„æ–¹æ³•"></a>NV21è½¬bitmapçš„æ–¹æ³•</h3><p>ç›´æ¥å­˜å…¥æ–‡ä»¶<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// in try catch</span><br><span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(Environment.getExternalStorageDirectory() + <span class="hljs-string">&quot;/imagename.jpg&quot;</span>);<br><span class="hljs-type">YuvImage</span> <span class="hljs-variable">yuvImage</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">YuvImage</span>(nv21bytearray, ImageFormat.NV21, width, height, <span class="hljs-literal">null</span>);<br>yuvImage.compressToJpeg(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Rect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height), <span class="hljs-number">100</span>, fos);<br>fos.close();<br></code></pre></td></tr></table></figure></p><p>è·å¾—Bitmapå¯¹è±¡çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•è€—æ—¶è€—å†…å­˜<br>NV21 -&gt; yuvImage -&gt; jpeg -&gt; bitmap<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// in try catch</span><br><span class="hljs-type">YuvImage</span> <span class="hljs-variable">yuvImage</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">YuvImage</span>(nv21bytearray, ImageFormat.NV21, width, height, <span class="hljs-literal">null</span>);<br><span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>yuvImage.compressToJpeg(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Rect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height), <span class="hljs-number">100</span>, os);<br><span class="hljs-type">byte</span>[] jpegByteArray = os.toByteArray();<br><span class="hljs-type">Bitmap</span> <span class="hljs-variable">bitmap</span> <span class="hljs-operator">=</span> BitmapFactory.decodeByteArray(jpegByteArray, <span class="hljs-number">0</span>, jpegByteArray.length);<br>os.close();<br></code></pre></td></tr></table></figure></p><p>å‚è€ƒ <a href="https://stackoverflow.com/questions/32276522/convert-nv21-byte-array-into-bitmap-readable-format">https://stackoverflow.com/questions/32276522/convert-nv21-byte-array-into-bitmap-readable-format</a></p><h3 id="codecé€‰æ‹©YUV420æ ¼å¼è¾“å‡ºOutputBufferçš„é—®é¢˜"><a href="#codecé€‰æ‹©YUV420æ ¼å¼è¾“å‡ºOutputBufferçš„é—®é¢˜" class="headerlink" title="codecé€‰æ‹©YUV420æ ¼å¼è¾“å‡ºOutputBufferçš„é—®é¢˜"></a>codecé€‰æ‹©YUV420æ ¼å¼è¾“å‡ºOutputBufferçš„é—®é¢˜</h3><p>å‡è®¾codecé€‰æ‹©çš„æ ¼å¼æ˜¯<code>COLOR_FormatYUV420Flexible</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">mediaFormat.setInteger(MediaFormat.KEY_COLOR_FORMAT, MediaCodecInfo.CodecCapabilities.COLOR_FormatYUV420Flexible);<br></code></pre></td></tr></table></figure><br>è§£ç åï¼Œå¾—åˆ°çš„æ ¼å¼æ˜¯<code>COLOR_QCOM_FormatYUV420SemiPlanar32m // 0x7FA30C04</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">mCodec.getOutputFormat().getInteger(MediaFormat.KEY_COLOR_FORMAT)<br></code></pre></td></tr></table></figure><br>è§£ç å‡ºæ¥çš„<code>ByteBuffer oBuffer = mCodec.getOutputBuffer(index);</code>åŒ…å«å…ƒç´ ä¸ªæ•°ä¸º1413120ï¼›è®°ä¸º<code>nv21Codec</code><br>è€Œé€šè¿‡<code>mCodec.getOutputImage(index)</code>å¾—åˆ°çš„imageå¯¹è±¡è·å–åˆ°çš„nv21æ•°ç»„å…ƒç´ ä¸ªæ•°ä¸º1382400ï¼›è®°ä¸º<code>nv21</code>ï¼Œè¿™äº›æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•°æ®</p><p>å¯¹æ¯”è¿™2ä¸ªæ•°ç»„æˆ‘ä»¬å‘ç°ï¼Œå‰é¢çš„yéƒ¨åˆ†æ˜¯ç›¸åŒçš„ã€‚<code>nv21</code>å‰921600ä¸ªå…ƒç´ æ˜¯yæ•°æ®ï¼Œå460800ä¸ªå…ƒç´ æ˜¯uvæ•°æ®ã€‚<br><code>nv21Codec</code>å‰921600ä¸ªå…ƒç´ æ˜¯yæ•°æ®ï¼Œä¹‹åçš„20480ä¸ªå­—èŠ‚éƒ½æ˜¯0ï¼Œå†æ¥ä¸‹æ¥çš„460800ä¸ªå…ƒç´ æ˜¯uvæ•°æ®ã€‚æœ€åçš„10240ä¸ªå­—èŠ‚æ˜¯0</p><p><code>nv21</code>å’Œ<code>nv21Codec</code>çš„uvéƒ¨åˆ†å­˜å‚¨é¡ºåºæ˜¯ç›¸åçš„ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://www.polarxiong.com/archives/Android-MediaCodec%E8%A7%86%E9%A2%91%E6%96%87%E4%BB%B6%E7%A1%AC%E4%BB%B6%E8%A7%A3%E7%A0%81-%E9%AB%98%E6%95%88%E7%8E%87%E5%BE%97%E5%88%B0YUV%E6%A0%BC%E5%BC%8F%E5%B8%A7-%E5%BF%AB%E9%80%9F%E4%BF%9D%E5%AD%98JPEG%E5%9B%BE%E7%89%87-%E4%B8%8D%E4%BD%BF%E7%94%A8OpenGL.html">Android: MediaCodecè§†é¢‘æ–‡ä»¶ç¡¬ä»¶è§£ç ,é«˜æ•ˆç‡å¾—åˆ°YUVæ ¼å¼å¸§,å¿«é€Ÿä¿å­˜JPEGå›¾ç‰‡(ä¸ä½¿ç”¨OpenGL)(é™„Demo)</a></li><li><a href="https://www.polarxiong.com/archives/Android-Image%E7%B1%BB%E6%B5%85%E6%9E%90-%E7%BB%93%E5%90%88YUV_420_888.html">Android: Imageç±»æµ…æ(ç»“åˆYUV_420_888)</a></li><li><a href="http://bigflake.com/mediacodec/">Android MediaCodec stuff</a></li><li><a href="http://blog.csdn.net/leixiaohua1020/">é›·éœ„éª…(leixiaohua1020)çš„ä¸“æ </a></li><li><a href="http://blog.csdn.net/leixiaohua1020/article/details/15811977">[æ€»ç»“]FFMPEGè§†éŸ³é¢‘ç¼–è§£ç é›¶åŸºç¡€å­¦ä¹ æ–¹æ³• - é›·éœ„éª…</a></li><li><a href="https://github.com/Bilibili/ijkplayer">Bilibili/ijkplayer - Github</a></li></ul><p>AndroidéŸ³è§†é¢‘ç›¸å…³æ–‡ç« è¯·å‚è€ƒ <a href="https://rustfisher.com/tags/Android-Media/">https://rustfisher.com/tags/Android-Media/</a></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android_Media</tag>
      
      <tag>Media</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PyQt QFileDialog æ–‡ä»¶é€‰æ‹©å¼¹çª—</title>
    <link href="/2017/11/23/PyQt_note/PyQt-QFileDialog_use/"/>
    <url>/2017/11/23/PyQt_note/PyQt-QFileDialog_use/</url>
    
    <content type="html"><![CDATA[<p>å¼¹å‡ºæ–‡ä»¶é€‰æ‹©æ¡†ã€‚å¯ä»¥è‡ªå®šä¹‰é€‰æ‹©æ¡†çš„æ ‡é¢˜ï¼Œé»˜è®¤ä½ç½®ï¼Œç›®æ ‡æ–‡ä»¶åç¼€</p><p>é€‰æ‹©æ¡†å¼¹å‡ºåï¼Œä¼šé˜»å¡UIçº¿ç¨‹ã€‚</p><h2 id="PyQt5æ–‡ä»¶é€‰æ‹©æ¡†çš„ä¾‹å­"><a href="#PyQt5æ–‡ä»¶é€‰æ‹©æ¡†çš„ä¾‹å­" class="headerlink" title="PyQt5æ–‡ä»¶é€‰æ‹©æ¡†çš„ä¾‹å­"></a>PyQt5æ–‡ä»¶é€‰æ‹©æ¡†çš„ä¾‹å­</h2><p>è¿™é‡Œåªé€‰æ‹©ä¸€ä¸ªbatæ–‡ä»¶ã€‚å¦‚æœé»˜è®¤ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™æŸ¥æ‰¾å½“å‰ç›®å½•<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_click_tu_choose_file_path_btn1</span>(<span class="hljs-params">self</span>):<br>    default_path = <span class="hljs-string">&#x27;C:\MY&#x27;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(default_path):<br>        default_path = os.getcwd()<br>    dlg = QFileDialog(<span class="hljs-literal">None</span>, <span class="hljs-string">&quot;choose_bat_file&quot;</span>, default_path, <span class="hljs-string">&#x27;All Files(*.bat)&#x27;</span>)<br>    dlg.setFileMode(QFileDialog.AnyFile)<br>    <span class="hljs-keyword">if</span> dlg.exec_():<br>        selected_name = dlg.selectedFiles()[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">if</span> selected_name:<br>            self.ma.tu_filePathTv1.setText(self.tr(selected_name))<br><br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>PyQt</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Python logging åŸºæœ¬ç”¨æ³•</title>
    <link href="/2017/11/21/Python/Python-logging-use/"/>
    <url>/2017/11/21/Python/Python-logging-use/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡è®°å½•<strong>logging</strong>æ¨¡å—çš„ç”¨æ³•</p><p>åˆ›å»ºæ–‡ä»¶<code>logger.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> logging<br><br>LOG_FILE = <span class="hljs-string">&#x27;app_history.log&#x27;</span><br><br>logging.basicConfig(level=logging.INFO,<br>                    <span class="hljs-built_in">format</span>=<span class="hljs-string">&#x27;%(asctime)s - %(filename)s[line:%(lineno)d] %(levelname)s %(message)s&#x27;</span>,<br>                    <span class="hljs-comment"># datefmt=&#x27;%Y_%m_%d_%H:%M:%S&#x27;,</span><br>                    filename=LOG_FILE,<br>                    filemode=<span class="hljs-string">&#x27;a&#x27;</span>)<br><br>console = logging.StreamHandler()<br>console.setLevel(logging.INFO)<br>formatter = logging.Formatter(<span class="hljs-string">&#x27;%(name)-12s: %(levelname)-8s %(message)s&#x27;</span>)<br>console.setFormatter(formatter)<br>logging.getLogger(LOG_FILE).addHandler(console)<br></code></pre></td></tr></table></figure><p>è°ƒç”¨<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">logger.logging.info(<span class="hljs-string">&quot;%-13s connected: %r&quot;</span> % (ip_address, connected))<br></code></pre></td></tr></table></figure></p><p><code>%(asctime)s</code> è¡¨ç¤ºè¿™ä¸ªä½ç½®ä¸Šæ˜¯å­—ç¬¦ä¸²å½¢å¼çš„å½“å‰æ—¶é—´<br><code>datefmt=&#39;%Y_%m_%d_%H:%M:%S&#39;</code> æŒ‡å®šäº†æ—¶é—´æ ¼å¼ï¼›æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸æŒ‡å®šæ—¶é—´æ ¼å¼</p><p>æŸ¥çœ‹å†™å‡ºçš„logæ–‡ä»¶<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">2017</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">13</span>:<span class="hljs-number">39</span>:<span class="hljs-number">35</span>,<span class="hljs-number">295</span> - xxx.py[line:<span class="hljs-number">122</span>] INFO<span class="hljs-meta"> [MainWindow] --------- App Starts ---------</span><br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>PyQt5 å®‰è£…å•†ä¸šç‰ˆ</title>
    <link href="/2017/10/25/PyQt_note/PyQt-Install_licensed_PyQt/"/>
    <url>/2017/10/25/PyQt_note/PyQt-Install_licensed_PyQt/</url>
    
    <content type="html"><![CDATA[<p>å¯¹äºWindows7ä¸Šçš„Python2ï¼Œéœ€è¦å¦‚ä¸‹å·¥å…·ï¼š</p><ul><li>visual studio</li><li>sip</li><li>Qt(SDK)</li></ul><p>å¦‚æœç”µè„‘ä¸Šå·²ç»è£…æœ‰äº†PyQt4ï¼Œå»ºè®®å†è£…ä¸€ä»½Pythonã€‚ä¸åŸæ¥çš„åˆ†å¼€ã€‚</p><h2 id="win7å®‰è£…ç¤¾åŒºç‰ˆVisual-Studio"><a href="#win7å®‰è£…ç¤¾åŒºç‰ˆVisual-Studio" class="headerlink" title="win7å®‰è£…ç¤¾åŒºç‰ˆVisual Studio"></a>win7å®‰è£…ç¤¾åŒºç‰ˆVisual Studio</h2><p>ä½¿ç”¨Visual Studioæ˜¯ä¸ºäº†å®ƒçš„ç¼–è¯‘å·¥å…·å’Œç›¸å…³åº“ã€‚å®‰è£…æ—¶é€‰ä¸ŠWindows SDKã€‚</p><p>å¯¹äºVS2017æ¥è¯´ï¼Œä½¿ç”¨çš„æ˜¯è¿™ä¸ªå·¥å…· â€œD:\Microsoft Visual Studio\2017\Community\Common7\Tools\VsDevCmd.batâ€<br>å¼€å§‹-æ‰€æœ‰ç¨‹åº-Visual Studio 2017-Visual Studio Tools</p><p>vså®‰è£…è·¯å¾„ <code>D:\Microsoft Visual Studio</code><br>ç¯å¢ƒå˜é‡<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">D</span>:\Microsoft Visual Studio\<span class="hljs-number">2017</span>\Community\VC\Tools\MSVC\<span class="hljs-number">14</span>.<span class="hljs-number">11</span>.<span class="hljs-number">25503</span>\bin\Hostx64\x64;<br><span class="hljs-attribute">D</span>:\Microsoft Visual Studio\<span class="hljs-number">2017</span>\Community\VC\Tools\MSVC\<span class="hljs-number">14</span>.<span class="hljs-number">11</span>.<span class="hljs-number">25503</span>\lib;<br></code></pre></td></tr></table></figure></p><h2 id="Python2-7å®‰è£…sip"><a href="#Python2-7å®‰è£…sip" class="headerlink" title="Python2.7å®‰è£…sip"></a>Python2.7å®‰è£…sip</h2><p>win7 64ä½ç³»ç»Ÿï¼Œä½†Python2.7æ˜¯32ä½</p><p>ä¸‹è½½sipæºç åŒ…ï¼ˆä¾‹å¦‚sip-4.19.3ï¼‰ï¼Œè§£å‹åˆ°ä»»æ„ä½ç½®ã€‚è¿›å…¥sipæºç åŒ…ï¼Œæ‰§è¡Œ<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-keyword">python</span> configure.<span class="hljs-keyword">py</span><br></code></pre></td></tr></table></figure><br>è¿™é‡ŒPython2.7å®‰è£…åœ¨<code>D:\python27</code>ï¼›äºæ˜¯sipä½ç½®åœ¨<code>D:\python27\Lib\site-packages\sip-4.19.3</code><br>æ‰“å¼€vsçš„å‘½ä»¤è¡Œï¼Œè¿›å…¥sipåœ¨Pythonä¸­çš„ç›®å½•ï¼Œæ‰§è¡Œ<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cmake">nmake<br>nmake <span class="hljs-keyword">install</span><br></code></pre></td></tr></table></figure></p><h2 id="win7å®‰è£…Qt5"><a href="#win7å®‰è£…Qt5" class="headerlink" title="win7å®‰è£…Qt5"></a>win7å®‰è£…Qt5</h2><p>åˆ°Qtå®˜ç½‘ä¸‹è½½å®‰è£…åŒ…ã€‚ä¸ºäº†ç…§é¡¾32ä½çš„Python2.7ï¼Œè¿™é‡Œé€‰æ‹©Qt 5.6.3 for Windows 32-bit (VS 2015, 869 MB)</p><p>æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­<br><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs moonscript"><span class="hljs-name">D</span>:\Qt\Qt5\<span class="hljs-number">5.6</span><span class="hljs-number">.3</span>\msvc2015\bin;<span class="hljs-name">D</span>:\Qt\Qt5\Tools\QtCreator\bin<br></code></pre></td></tr></table></figure></p><h2 id="win7ç¼–è¯‘å®‰è£…å•†ä¸šç‰ˆPyQt5"><a href="#win7ç¼–è¯‘å®‰è£…å•†ä¸šç‰ˆPyQt5" class="headerlink" title="win7ç¼–è¯‘å®‰è£…å•†ä¸šç‰ˆPyQt5"></a>win7ç¼–è¯‘å®‰è£…å•†ä¸šç‰ˆPyQt5</h2><p>Python2.7</p><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mel"><span class="hljs-keyword">python</span> configure.py --<span class="hljs-keyword">disable</span> QtNfc<br>nmake<br>nmake install<br></code></pre></td></tr></table></figure><p>å‚è€ƒPyQt5çš„README<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">COMMERCIAL VERSION<br><br>If you have <span class="hljs-keyword">the</span> Commercial <span class="hljs-built_in">version</span> <span class="hljs-keyword">of</span> PyQt5 <span class="hljs-keyword">then</span> you should also have <span class="hljs-keyword">a</span><br>license <span class="hljs-built_in">file</span> that you downloaded separately.  The license <span class="hljs-built_in">file</span> must be copied<br><span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> <span class="hljs-string">&quot;sip&quot;</span> <span class="hljs-built_in">directory</span> <span class="hljs-keyword">before</span> starting <span class="hljs-built_in">to</span> build PyQt5.<br></code></pre></td></tr></table></figure><br>æˆ‘ä»¬æŠŠä¹°æ¥çš„licenseæ–‡ä»¶å¤åˆ¶åˆ°sipç›®å½•ä¸‹ã€‚</p><p>åœ¨<code>E:\ws\doc\PyQtCommercial\PyQt5_commercial-5.9</code>ä¸­ï¼ŒæŠŠä»˜è´¹åå¾—åˆ°çš„<code>pyqt-commercial.sip</code>å¤åˆ¶åˆ°sipç›®å½•ä¸‹</p><p>ä½¿ç”¨vs2017çš„å‘½ä»¤è¡Œå·¥å…·ï¼</p><p><code>python configure.py</code>å‡ºç°é”™è¯¯<br><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">Error: </span>Use the --qmake argument to explicitly specify a working Qt qmake.<br></code></pre></td></tr></table></figure><br>ç½‘ä¸Šè¯´æ˜¯å› ä¸ºæ²¡æœ‰é…ç½®å¥½Qt SDKçš„åŸå› <br>å¯å‚è€ƒ <a href="https://stackoverflow.com/questions/7854599/pyqt-setup-for-qt-4-7-4">PyQt setup for Qt 4.7.4</a><br>è§£å†³é”™è¯¯åï¼Œä¼šæç¤ºæ˜¯å¦æ¥å—licenseã€‚æ ¹æ®æç¤ºè¾“å…¥yesã€‚</p><p>æ‰§è¡Œ<code>python configure.py --disable QtNfc</code><br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Querying</span> qmake about your Qt installation...<br><span class="hljs-attribute">Determining</span> the details of your Qt installation...<br><span class="hljs-attribute">This</span> is the commercial version of PyQt <span class="hljs-number">5</span>.<span class="hljs-number">9</span> (licensed under the PyQt Commercial<br><span class="hljs-attribute">License</span>) for Python <span class="hljs-number">2</span>.<span class="hljs-number">7</span>.<span class="hljs-number">13</span> <span class="hljs-literal">on</span> win32.<br></code></pre></td></tr></table></figure></p><h3 id="nmakeæŠ¥é”™-cannot-open-file-â€œmsvcprt-libâ€"><a href="#nmakeæŠ¥é”™-cannot-open-file-â€œmsvcprt-libâ€" class="headerlink" title="nmakeæŠ¥é”™ cannot open file â€œmsvcprt.libâ€"></a>nmakeæŠ¥é”™ cannot open file â€œmsvcprt.libâ€</h3><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata">fatal <span class="hljs-keyword">error</span> LNK1104: cannot <span class="hljs-keyword">open</span> <span class="hljs-keyword">file</span> â€œmsvcprt.libâ€<br></code></pre></td></tr></table></figure><p>æŠŠlibè·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ <code>D:\Microsoft Visual Studio\2017\Community\VC\Tools\MSVC\14.11.25503\lib;</code></p><h3 id="nmakeæŠ¥é”™-QtNfc-dll-fatal-error-LNK1169-one-or-more-multiply-defined-symbols-found"><a href="#nmakeæŠ¥é”™-QtNfc-dll-fatal-error-LNK1169-one-or-more-multiply-defined-symbols-found" class="headerlink" title="nmakeæŠ¥é”™ QtNfc.dll : fatal error LNK1169: one or more multiply defined symbols found"></a>nmakeæŠ¥é”™ QtNfc.dll : fatal error LNK1169: one or more multiply defined symbols found</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros">release\QtNfc.dll : fatal <span class="hljs-built_in">error</span> LNK1169: æ‰¾åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå¤šé‡å®šä¹‰çš„ç¬¦å·<br>NMAKE : fatal <span class="hljs-built_in">error</span> U1077: â€œ<span class="hljs-string">&quot;D:\Microsoft Visual Studio\2017\Community\VC\Tools</span><br><span class="hljs-string">\MSVC\14.11.25503\bin\HostX86\x86\link.EXE&quot;</span>â€: è¿”å›ä»£ç â€œ0x491â€<br>Stop.<br>NMAKE : fatal <span class="hljs-built_in">error</span> U1077: â€œ<span class="hljs-string">&quot;D:\Microsoft Visual Studio\2017\Community\VC\Tools</span><br><span class="hljs-string">\MSVC\14.11.25503\bin\HostX86\x86\nmake.exe&quot;</span>â€: è¿”å›ä»£ç â€œ0x2â€<br>Stop.<br>NMAKE : fatal <span class="hljs-built_in">error</span> U1077: â€œcdâ€: è¿”å›ä»£ç â€œ0x2â€<br>Stop.<br></code></pre></td></tr></table></figure><p>ç½‘ä¸Šæœ‰ç›¸å…³çš„å»ºè®®ï¼ŒæŠŠQtNfcâ€œå–æ¶ˆâ€æ‰ï¼Œå…¶å®å°±æ˜¯ä¸ç¼–è¯‘QtNfcã€‚</p><p><code>E:\ws\doc\PyQtCommercial\PyQt5_commercial-5.9&gt;python configure.py --disable QtNfc</code></p><blockquote><p><a href="http://python.6.x6.nabble.com/error-building-QtNfc-td5185657.html">http://python.6.x6.nabble.com/error-building-QtNfc-td5185657.html</a></p></blockquote><p><code>nmake</code> éœ€è¦ä¸€æ®µæ—¶é—´ã€‚ç”µè„‘æ¯”è¾ƒå·®çš„è¯ï¼Œå¤§æ¦‚è¦1ä¸ªå°æ—¶ã€‚<br><code>nmake install</code> è€—æ—¶çº¦5åˆ†é’Ÿ</p><h3 id="è¯•è¿è¡ŒPyQt5"><a href="#è¯•è¿è¡ŒPyQt5" class="headerlink" title="è¯•è¿è¡ŒPyQt5"></a>è¯•è¿è¡ŒPyQt5</h3><p>å¯¼å…¥PyQt5æ¨¡å—è¯•ä¸€è¯•<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PyQt5.QtCore <span class="hljs-keyword">import</span> QTranslator<br><span class="hljs-keyword">from</span> PyQt5.QtGui <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> *<br></code></pre></td></tr></table></figure></p><p>å¯¹äºPython2.7 PyQt5ï¼Œä½¿ç”¨pyinstalleræ¥æ‰“åŒ…æˆexeæ–‡ä»¶<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">pyinstaller</span> ui_main.py<br></code></pre></td></tr></table></figure><br>å¾—åˆ°ç›¸åº”çš„æ–‡ä»¶ç›®å½•</p><h4 id="è¿è¡Œexeå¼¹çª—æŠ¥é”™Qt-platform-plugin"><a href="#è¿è¡Œexeå¼¹çª—æŠ¥é”™Qt-platform-plugin" class="headerlink" title="è¿è¡Œexeå¼¹çª—æŠ¥é”™Qt platform plugin"></a>è¿è¡Œexeå¼¹çª—æŠ¥é”™<code>Qt platform plugin</code></h4><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">this application failed <span class="hljs-built_in">to</span> <span class="hljs-built_in">start</span> because <span class="hljs-keyword">it</span> could <span class="hljs-keyword">not</span> find <span class="hljs-keyword">or</span> <span class="hljs-built_in">load</span> <span class="hljs-keyword">the</span> Qt <span class="hljs-built_in">platform</span> plugin <span class="hljs-string">&quot;windows&quot;</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;&quot;</span><br>Reinstalling <span class="hljs-keyword">the</span> application may fix this problem.<br></code></pre></td></tr></table></figure><p>æŠ¥é”™åŸå› æ˜¯æ‰¾ä¸åˆ° <code>Qt platform plugin</code><br>åœ¨Qt5ï¼Œåœ¨å®‰è£…ç›®å½•ä¸‹å¯æ‰¾åˆ° <code>D:\Qt\Qt5\Tools\QtCreator\bin\plugins\platforms</code><br>å¯¹äºPython3ï¼Œå®‰è£…äº†GPLçš„PyQt5ï¼Œå¯ä»¥æ‰¾åˆ° <code>D:\python35\Lib\site-packages\PyQt5\Qt\plugins\platforms</code></p><p>å¤„ç†æ–¹æ³•ï¼š<br>ä¸æ‰“åŒ…æˆä¸€ä¸ªå•ä¸€çš„exeæ–‡ä»¶ï¼Œä½¿ç”¨<code>pyinstaller ui_main.py</code>ç”Ÿæˆæ–‡ä»¶ç›®å½•<br>åœ¨distä¸­ï¼Œä¸exeæ–‡ä»¶åŒçº§çš„ç›®å½•<code>PyQt5/qt/plugins</code>ä¸­ï¼Œæœ‰platformsç›®å½•<br>æŠŠplatformsæ–‡ä»¶å¤¹å¤åˆ¶åˆ°ä¸exeæ–‡ä»¶åŒçº§çš„ä½ç½®å³å¯  </p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://stackoverflow.com/questions/25589103/how-to-install-pyqt5-on-windows-for-python-2">How to install PyQt5 on Windows for Python 2?</a></p><p><a href="http://python.6.x6.nabble.com/PyQT-Sip-installation-td1923578.html">ç¼–è¯‘å®‰è£…PyQt5çš„è¿‡ç¨‹</a></p><p><a href="https://riverbankcomputing.com/pipermail/pyqt/2012-July/031691.html">å®‰è£…sipçš„å»ºè®®</a></p>]]></content>
    
    
    <categories>
      
      <category>PyQt</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>findçš„ä½¿ç”¨</title>
    <link href="/2017/10/10/Linux/find-use/"/>
    <url>/2017/10/10/Linux/find-use/</url>
    
    <content type="html"><![CDATA[<p>æ¯”å¦‚åˆ é™¤ï½ç»“å°¾çš„æ–‡ä»¶<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find . -name <span class="hljs-string">&quot;*~&quot;</span> -<span class="hljs-built_in">type</span> f -<span class="hljs-built_in">print</span> -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> -rf &#123;&#125; \;<br></code></pre></td></tr></table></figure></p><p>åˆ é™¤æ–‡ä»¶åæœ‰ç‰¹å®šå­—ç¬¦çš„æ–‡ä»¶<br><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-built_in">find</span> . -<span class="hljs-built_in">name</span> <span class="hljs-string">&quot;*abcd*&quot;</span> -<span class="hljs-built_in">exec</span> rm -f &#123;&#125; \;<br></code></pre></td></tr></table></figure></p><p>ä¿®æ”¹æ‰§è¡Œå‘½ä»¤å’Œæ–‡ä»¶ç±»å‹ï¼Œå®‰è£…ç›®å½•ä¸‹æ‰€æœ‰apkæ–‡ä»¶<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">find</span> . -name <span class="hljs-string">&quot;*.apk&quot;</span> -type f -<span class="hljs-built_in">print</span> -exec adb install &#123;&#125; \;<br></code></pre></td></tr></table></figure></p><p>æ‰¾åˆ°æ‰€æœ‰çš„jsonæ–‡ä»¶å¹¶ä¸”åˆ é™¤<br><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sqf"><span class="hljs-built_in">find</span> . -<span class="hljs-built_in">name</span> <span class="hljs-string">&quot;*.json&quot;</span> -<span class="hljs-built_in">exec</span> rm &#123;&#125; \;<br></code></pre></td></tr></table></figure></p><p>åˆ é™¤æŒ‡å®šç›®å½•ï¼Œæ¯”å¦‚åˆ é™¤æ‰€æœ‰çš„gitç›®å½•<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find . -<span class="hljs-built_in">type</span> d -iname <span class="hljs-string">&quot;.git&quot;</span> -<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> -rf &#123;&#125; \;<br></code></pre></td></tr></table></figure></p><p>æ‰¾åˆ°å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„apkå¹¶å®‰è£…<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find . -name <span class="hljs-string">&quot;*.apk&quot;</span> -<span class="hljs-built_in">exec</span> adb install &#123;&#125; \;<br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>Linux_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PyQt é€‚é…ä¸åŒå±å¹•åˆ†è¾¨ç‡</title>
    <link href="/2017/09/26/PyQt_note/PyQt-Adjust_screen_resolution/"/>
    <url>/2017/09/26/PyQt_note/PyQt-Adjust_screen_resolution/</url>
    
    <content type="html"><![CDATA[<p>åœ¨å®½é«˜ä¸º<code>1366*768</code>ä¸‹è®¾è®¡å¼€å‘çš„ç•Œé¢ï¼Œåˆ°äº†<code>2860*1620</code>å±å¹•ä¸‹ä¼šæ˜¾ç¤ºä¸æ­£å¸¸ã€‚<br>å› ä¸ºåƒç´ å¯†åº¦ä¸åŒï¼Œ<code>2860*1620</code>å±å¹•æ˜¾ç¤ºå‡ºæ¥çš„æ§ä»¶å¾ˆå°ã€‚</p><h2 id="é€‚é…æ–¹æ³•-æ ¹æ®å½“å‰å±å¹•è°ƒæ•´æ§ä»¶å¤§å°å’Œä½ç½®"><a href="#é€‚é…æ–¹æ³•-æ ¹æ®å½“å‰å±å¹•è°ƒæ•´æ§ä»¶å¤§å°å’Œä½ç½®" class="headerlink" title="é€‚é…æ–¹æ³• - æ ¹æ®å½“å‰å±å¹•è°ƒæ•´æ§ä»¶å¤§å°å’Œä½ç½®"></a>é€‚é…æ–¹æ³• - æ ¹æ®å½“å‰å±å¹•è°ƒæ•´æ§ä»¶å¤§å°å’Œä½ç½®</h2><p>åˆå§‹åŒ–æ—¶è·å–åˆ°å½“å‰å±å¹•çš„å®½é«˜åƒç´ å€¼ã€‚<br>ä¸åŸåƒç´ å€¼ç›¸æ¯”æ±‚å‡ºæ¯”ä¾‹<code>self.ratio_wid</code>ï¼Œ<code>self.ratio_height</code>ã€‚</p><p>æ‰¾å‡ºæ‰€æœ‰çš„QWidget <code>self.findChildren(QWidget)</code>ï¼Œéå†æ¥æ”¹å˜å¤§å°å’Œä½ç½®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PyQt4.QtGui <span class="hljs-keyword">import</span> QMainWindow, QApplication, QWidget<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ReMainWindow</span>(<span class="hljs-title class_ inherited__">QMainWindow</span>):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, parent=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-comment"># ...........</span><br>        self.app = QApplication.instance()  <span class="hljs-comment"># Calculate the ratio. Design screen is [1366, 768]</span><br>        screen_resolution = self.app.desktop().screenGeometry()<br>        self.hw_ratio = <span class="hljs-number">768</span> / <span class="hljs-number">1366</span>  <span class="hljs-comment"># height / width</span><br>        self.ratio_wid = screen_resolution.width() / <span class="hljs-number">1366</span><br>        <span class="hljs-keyword">if</span> self.ratio_wid &lt; <span class="hljs-number">1</span>:<br>            self.ratio_wid = <span class="hljs-number">1</span><br>        self.ratio_height = screen_resolution.height() / <span class="hljs-number">768</span><br>        <span class="hljs-keyword">if</span> self.ratio_height &lt; <span class="hljs-number">1</span>:<br>            self.ratio_height = <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_init_ui_size</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-string">&quot;&quot;&quot; Travel all the widgets and resize according to the ratio &quot;&quot;&quot;</span><br>        self._resize_with_ratio(self)<br>        <span class="hljs-keyword">for</span> q_widget <span class="hljs-keyword">in</span> self.findChildren(QWidget):<br>            <span class="hljs-comment"># print q_widget.objectName()</span><br>            self._resize_with_ratio(q_widget)<br>            self._move_with_ratio(q_widget)<br><br>            <span class="hljs-comment"># Don&#x27;t deal with the text browser</span><br>            <span class="hljs-comment"># for q_widget in self.findChildren(QAbstractScrollArea):</span><br>            <span class="hljs-comment">#     print q_widget.objectName()</span><br>            <span class="hljs-comment">#     self._resize_with_ratio(q_widget)</span><br>            <span class="hljs-comment">#     self._move_with_ratio(q_widget)</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_resize_with_ratio</span>(<span class="hljs-params">self, input_ui</span>):<br>        input_ui.resize(input_ui.width() * self.ratio_wid, input_ui.height() * self.ratio_height)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_move_with_ratio</span>(<span class="hljs-params">self, input_ui</span>):<br>        input_ui.move(input_ui.x() * self.ratio_wid, input_ui.y() * self.ratio_height)<br><br></code></pre></td></tr></table></figure><p>å®è·µå‘ç°ï¼Œä¸éœ€è¦å¯¹QTextBrowseræ‰€å±çš„<code>QAbstractScrollArea</code>å¤„ç†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>PyQt</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>PyQt è¯­è¨€å›½é™…åŒ–</title>
    <link href="/2017/09/20/PyQt_note/PyQt-Locale/"/>
    <url>/2017/09/20/PyQt_note/PyQt-Locale/</url>
    
    <content type="html"><![CDATA[<h2 id="PyQt4-è¯­è¨€å›½é™…åŒ–"><a href="#PyQt4-è¯­è¨€å›½é™…åŒ–" class="headerlink" title="PyQt4 è¯­è¨€å›½é™…åŒ–"></a>PyQt4 è¯­è¨€å›½é™…åŒ–</h2><p>ä½¿ç”¨<code>pylupdate4</code>å°†ç•Œé¢çš„pyæ–‡ä»¶è½¬æˆtsæ–‡ä»¶ã€‚</p><p>è¿›å…¥pyæ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œæ‰§è¡Œè½¬æ¢å‘½ä»¤ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">/d/python27/Lib/site-packages/PyQt4/pylupdate4 ui_main.py -ts zh_CN.ts<br></code></pre></td></tr></table></figure></p><p>å¾—åˆ°<code>zh_CN.ts</code>æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯xmlæ–‡ä»¶ã€‚<br>å½“ç•Œé¢çš„pyæ–‡ä»¶ä¿®æ”¹æ—¶ï¼Œè¿è¡Œ<code>pylupdate4</code>ç”Ÿæˆtsä¸ä¼šç ´ååŸtsçš„ç¿»è¯‘ã€‚</p><p>ç”¨Qtè¯­è¨€å®¶ï¼ˆLinguistï¼‰æ‰“å¼€<code>zh_CN.ts</code>æ–‡ä»¶ã€‚å¯ä»¥å¯¹ç›¸åº”çš„å­—ç¬¦ä¸²è¿›è¡Œç¿»è¯‘ã€‚<br>ç‚¹å‡»â€œå‘å¸ƒâ€å¯è·å¾—<code>zh_CN.qm</code>æ–‡ä»¶ã€‚è¿™å°±æ˜¯qtçš„è¯­è¨€èµ„æºæ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><p>åˆ›å»ºappæ—¶ï¼Œå…ˆåŠ è½½è¯­è¨€èµ„æºæ–‡ä»¶<code>zh_CN.qm</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    configs.init_configs()  <span class="hljs-comment"># ç¡®å®šè¯­è¨€é…ç½®</span><br>    app = QApplication(sys.argv)<br>    trans = QTranslator()  <span class="hljs-comment"># Setup locale, we need .qm files</span><br>    <span class="hljs-keyword">if</span> configs.g_locale_type == configs.LOCALE_ZH_CH:<br>        trans.load(<span class="hljs-string">&quot;res/locale/zh_CN&quot;</span>)  <span class="hljs-comment"># No need suffix .qm</span><br>        app.installTranslator(trans)<br><br>    main_d = FAMainWindow()<br>    main_d.show()<br>    sys.exit(app.exec_())<br><br></code></pre></td></tr></table></figure></p><h2 id="Appè¿è¡Œä¸­åˆ‡æ¢è¯­è¨€"><a href="#Appè¿è¡Œä¸­åˆ‡æ¢è¯­è¨€" class="headerlink" title="Appè¿è¡Œä¸­åˆ‡æ¢è¯­è¨€"></a>Appè¿è¡Œä¸­åˆ‡æ¢è¯­è¨€</h2><p>åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©å½“å‰æ˜¾ç¤ºçš„è¯­è¨€ã€‚ä¸éœ€è¦é‡æ–°å¯åŠ¨ç¨‹åºå³å¯å®Œæˆåˆ‡æ¢ã€‚</p><h3 id="å‡†å¤‡è¯­è¨€èµ„æºæ–‡ä»¶"><a href="#å‡†å¤‡è¯­è¨€èµ„æºæ–‡ä»¶" class="headerlink" title="å‡†å¤‡è¯­è¨€èµ„æºæ–‡ä»¶"></a>å‡†å¤‡è¯­è¨€èµ„æºæ–‡ä»¶</h3><p>ä»¥è‹±æ–‡å’Œç®€ä½“ä¸­æ–‡ä¸ºä¾‹ï¼Œæƒ³è¦åˆ‡æ¢è¯­è¨€ï¼Œéœ€è¦è¿™2ç§è¯­è¨€åŒ…<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ <span class="hljs-regexp">/d/</span>python27<span class="hljs-regexp">/Lib/</span>site-packages<span class="hljs-regexp">/PyQt4/</span>pylupdate4 ui_main.py -ts zh_CN.ts<br>$ <span class="hljs-regexp">/d/</span>python27<span class="hljs-regexp">/Lib/</span>site-packages<span class="hljs-regexp">/PyQt4/</span>pylupdate4 ui_main.py -ts en.ts<br></code></pre></td></tr></table></figure><br>å€ŸåŠ©Qtè¯­è¨€å®¶å‘å¸ƒå¾—åˆ°<code>en.qm</code>å’Œ<code>zh_CN.qm</code>è¿™2ä¸ªæ–‡ä»¶ï¼Œæ”¾åœ¨<code>res/locale</code>ç›®å½•é‡Œ</p><h3 id="åœ¨UIä¸Šè®¾ç½®è§¦å‘åˆ‡æ¢è¯­è¨€"><a href="#åœ¨UIä¸Šè®¾ç½®è§¦å‘åˆ‡æ¢è¯­è¨€" class="headerlink" title="åœ¨UIä¸Šè®¾ç½®è§¦å‘åˆ‡æ¢è¯­è¨€"></a>åœ¨UIä¸Šè®¾ç½®è§¦å‘åˆ‡æ¢è¯­è¨€</h3><p>ç•Œé¢ä¸Šéœ€è¦æŒ‰é’®æˆ–èœå•æ çš„actionï¼›éœ€è¦æŒæœ‰<code>QTranslator</code>ï¼›</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python">    self.trans = QTranslator()  <span class="hljs-comment"># åˆå§‹åŒ–æ—¶è·å– QTranslator</span><br>    self._init_trans()<br>    <span class="hljs-comment"># æ·»åŠ äº†actionæ¥è§¦å‘åˆ‡æ¢åŠ¨ä½œ</span><br>    self.connect(self.ma.actionEnglish, SIGNAL(<span class="hljs-string">&quot;triggered()&quot;</span>), self._trigger_english)<br>    self.ma.action_ZhCN.triggered.connect(self._trigger_zh_cn)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_init_trans</span>(<span class="hljs-params">self</span>):<br>    ctx.read_locale_config()  <span class="hljs-comment"># è‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œç”¨æ¥è¯»å–jsonæ–‡ä»¶ä¸­çš„é…ç½®</span><br>    <span class="hljs-keyword">if</span> ctx.g_locale_type == ctx.LOCALE_ZH_CH:<br>        self._trigger_zh_cn()<br>    <span class="hljs-keyword">elif</span> ctx.g_locale_type == ctx.LOCALE_EN:<br>        self._trigger_english()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_trigger_english</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[MainWindow] Change to English&quot;</span><br>    self.trans.load(<span class="hljs-string">&quot;res/locale/en&quot;</span>)<br>    _app = QApplication.instance()  <span class="hljs-comment"># è·å–appå®ä¾‹</span><br>    _app.installTranslator(self.trans)<br>    self.ma.retranslateUi(self)<br>    ctx.change_to_en()  <span class="hljs-comment"># å°†æ–°çš„é…ç½®æ›´æ–°å…¥jsonæ–‡ä»¶ä¸­</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_trigger_zh_cn</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;[MainWindow] Change to zh_CN&quot;</span><br>    self.trans.load(<span class="hljs-string">&quot;res/locale/zh_CN&quot;</span>)<br>    _app = QApplication.instance()<br>    _app.installTranslator(self.trans)<br>    self.ma.retranslateUi(self)<br>    ctx.change_to_zh_cn()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>PyQt</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>PyQt æ‹–å…¥</title>
    <link href="/2017/09/19/PyQt_note/PyQt-Drag_and_drop/"/>
    <url>/2017/09/19/PyQt_note/PyQt-Drag_and_drop/</url>
    
    <content type="html"><![CDATA[<p>PyQtæ”¯æŒæ‹–å…¥åŠŸèƒ½ã€‚æ¯”å¦‚æ‹–å…¥æ–‡ä»¶æˆ–è€…ä¸€æ®µæ–‡æœ¬ã€‚</p><h3 id="æ‹–å…¥æ–‡æœ¬"><a href="#æ‹–å…¥æ–‡æœ¬" class="headerlink" title="æ‹–å…¥æ–‡æœ¬"></a>æ‹–å…¥æ–‡æœ¬</h3><p>å®šä¹‰äº†ä¸€ä¸ªlabelç»§æ‰¿è‡ª<code>QLabel</code>ï¼Œåˆå§‹åŒ–æ—¶è®¾ç½®å…è®¸æ‹–å…¥ã€‚</p><p>å‚è§<a href="https://pythonspot.com/en/pyqt5-drag-and-drop/">pyqt5-drag-and-drop</a><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PyQt5 <span class="hljs-keyword">import</span> QtCore<br><span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> QMainWindow, QApplication, QListWidget, QAbstractItemView<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomLabel</span>(<span class="hljs-title class_ inherited__">QLabel</span>):<br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, title, parent</span>):<br>        <span class="hljs-built_in">super</span>().__init__(title, parent)<br>        self.setAcceptDrops(<span class="hljs-literal">True</span>)<br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dragEnterEvent</span>(<span class="hljs-params">self, e</span>):<br>        <span class="hljs-keyword">if</span> e.mimeData().hasFormat(<span class="hljs-string">&#x27;text/plain&#x27;</span>):<br>            e.accept()<br>        <span class="hljs-keyword">else</span>:<br>            e.ignore()<br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dropEvent</span>(<span class="hljs-params">self, e</span>):<br>        self.setText(e.mimeData().text())<br></code></pre></td></tr></table></figure><br>ç›´æ¥è°ƒç”¨è¿™ä¸ªç±»ï¼Œå°†å®ƒæ·»åŠ åˆ°ç•Œé¢ä¸Šå»ã€‚</p><h3 id="æ‹–å…¥æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶è·¯å¾„"><a href="#æ‹–å…¥æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶è·¯å¾„" class="headerlink" title="æ‹–å…¥æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶è·¯å¾„"></a>æ‹–å…¥æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶è·¯å¾„</h3><p>è¿™é‡Œç»§æ‰¿äº†QLabelã€‚<code>Ui_MainWindow</code>æ˜¯ç”¨designerç”»å‡ºæ¥çš„ç•Œé¢ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PyQt5 <span class="hljs-keyword">import</span> QtCore<br><span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> QMainWindow, QApplication, QListWidget, QAbstractItemView<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LabMainWindow</span>(<span class="hljs-title class_ inherited__">QMainWindow</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(LabMainWindow, self).__init__()<br>        self.ma = Ui_MainWindow()<br>        self.ma.setupUi(self)<br>        self.drag_in_widget = DragInWidget(<span class="hljs-string">&quot;Drag in&quot;</span>, self)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_init_ui</span>(<span class="hljs-params">self</span>):<br>        self.drag_in_widget.move(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DragInWidget</span>(<span class="hljs-title class_ inherited__">QLabel</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, title, parent</span>):<br>        <span class="hljs-built_in">super</span>().__init__(title, parent)<br>        self.setAcceptDrops(<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dragEnterEvent</span>(<span class="hljs-params">self, e</span>):<br>        <span class="hljs-keyword">if</span> e.mimeData().hasUrls():<br>            e.accept()<br>        <span class="hljs-keyword">else</span>:<br>            e.ignore()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dropEvent</span>(<span class="hljs-params">self, e</span>):<br>        <span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> e.mimeData().urls():<br>            path = url.toLocalFile()<br>            <span class="hljs-keyword">if</span> os.path.isfile(path):<br>                <span class="hljs-built_in">print</span>(path)<br><br></code></pre></td></tr></table></figure><h3 id="QtWidgets-QFrameç›‘å¬æ‹–å…¥äº‹ä»¶"><a href="#QtWidgets-QFrameç›‘å¬æ‹–å…¥äº‹ä»¶" class="headerlink" title="QtWidgets.QFrameç›‘å¬æ‹–å…¥äº‹ä»¶"></a>QtWidgets.QFrameç›‘å¬æ‹–å…¥äº‹ä»¶</h3><p>ç›‘å¬åˆ°æœ‰æ•ˆæ‹–åŠ¨äº‹ä»¶åï¼Œåˆ©ç”¨<code>QtCore.pyqtSignal</code>æŠŠä¿¡æ¯ä¼ é€’å‡ºå»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PyQt5 <span class="hljs-keyword">import</span> QtCore<br><span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> QMainWindow, QApplication, QListWidget, QAbstractItemView<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DragInWidget</span>(QtWidgets.QFrame):<br>    <span class="hljs-string">&quot;&quot;&quot; Drag files to this widget &quot;&quot;&quot;</span><br>    s_content = QtCore.pyqtSignal(<span class="hljs-built_in">str</span>)  <span class="hljs-comment"># emit file path</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, parent</span>):<br>        <span class="hljs-built_in">super</span>(DragInWidget, self).__init__(parent)<br>        self.setAcceptDrops(<span class="hljs-literal">True</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dragEnterEvent</span>(<span class="hljs-params">self, e</span>):<br>        <span class="hljs-keyword">if</span> e.mimeData().hasUrls():<br>            e.accept()<br>        <span class="hljs-keyword">else</span>:<br>            e.ignore()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dropEvent</span>(<span class="hljs-params">self, e</span>):<br>        <span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> e.mimeData().urls():<br>            path = url.toLocalFile()<br>            <span class="hljs-keyword">if</span> os.path.isfile(path):<br>                self.s_content.emit(path)<br>                <span class="hljs-built_in">print</span>(path)<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªFrameå¯ä»¥è¦†ç›–åœ¨å…¶ä»–æ§ä»¶ä¸Šé¢æ—¶ï¼Œä¼šæ‹¦æˆªæ“ä½œ</p><h3 id="QListWidgetæ‹–å…¥äº‹ä»¶"><a href="#QListWidgetæ‹–å…¥äº‹ä»¶" class="headerlink" title="QListWidgetæ‹–å…¥äº‹ä»¶"></a>QListWidgetæ‹–å…¥äº‹ä»¶</h3><p>å‘<code>QListWidget</code>æ‹–å…¥æ–‡ä»¶ï¼Œè·å–æ–‡ä»¶è·¯å¾„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PyQt5 <span class="hljs-keyword">import</span> QtCore<br><span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> QMainWindow, QApplication, QListWidget, QAbstractItemView<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DragInWidget</span>(<span class="hljs-title class_ inherited__">QListWidget</span>):<br>    <span class="hljs-string">&quot;&quot;&quot; Drag files to this widget &quot;&quot;&quot;</span><br>    s_content = QtCore.pyqtSignal(<span class="hljs-built_in">str</span>)  <span class="hljs-comment"># emit file path</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, parent</span>):<br>        <span class="hljs-built_in">super</span>(DragInWidget, self).__init__(parent)<br>        self.setAcceptDrops(<span class="hljs-literal">True</span>)<br>        self.setDragDropMode(QAbstractItemView.InternalMove)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dragEnterEvent</span>(<span class="hljs-params">self, e</span>):<br>        <span class="hljs-keyword">if</span> e.mimeData().hasUrls():<br>            e.accept()<br>        <span class="hljs-keyword">else</span>:<br>            e.ignore()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dropEvent</span>(<span class="hljs-params">self, e</span>):<br>        <span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> e.mimeData().urls():<br>            path = url.toLocalFile()<br>            <span class="hljs-keyword">if</span> os.path.isfile(path):<br>                self.s_content.emit(path)<br>                <span class="hljs-built_in">print</span>(path)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>PyQt</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>PyQt æ‰“åŒ…</title>
    <link href="/2017/09/18/PyQt_note/PyQt-Pack_app/"/>
    <url>/2017/09/18/PyQt_note/PyQt-Pack_app/</url>
    
    <content type="html"><![CDATA[<h2 id="py2exe"><a href="#py2exe" class="headerlink" title="py2exe"></a>py2exe</h2><h3 id="PyQt4-ä¸­æ‰“åŒ…æˆEXEæ–‡ä»¶"><a href="#PyQt4-ä¸­æ‰“åŒ…æˆEXEæ–‡ä»¶" class="headerlink" title="PyQt4 ä¸­æ‰“åŒ…æˆEXEæ–‡ä»¶"></a>PyQt4 ä¸­æ‰“åŒ…æˆEXEæ–‡ä»¶</h3><p>å°†æŸä¸ªGUIç¨‹åºæ‰“åŒ…æˆEXEæ–‡ä»¶ã€‚</p><p>Python2.7ï¼Œåœ¨PyCharmä¸­ç›´æ¥æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">from</span> distutils.core <span class="hljs-keyword">import</span> setup<br><span class="hljs-keyword">import</span> py2exe<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">import</span> main_window_re<br><br><span class="hljs-comment"># this allows to run it with a simple double click.</span><br>sys.argv.append(<span class="hljs-string">&#x27;py2exe&#x27;</span>)<br><br>py2exe_options = &#123;<br>    <span class="hljs-string">&quot;includes&quot;</span>: [<span class="hljs-string">&quot;sip&quot;</span>],<br>    <span class="hljs-string">&quot;dll_excludes&quot;</span>: [<span class="hljs-string">&quot;MSVCP90.dll&quot;</span>, ],<br>    <span class="hljs-string">&quot;compressed&quot;</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-string">&quot;optimize&quot;</span>: <span class="hljs-number">2</span>,<br>    <span class="hljs-string">&quot;ascii&quot;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&quot;bundle_files&quot;</span>: <span class="hljs-number">1</span>,<br>&#125;<br><br>setup(<br>    name=<span class="hljs-string">&#x27;Reliability_test&#x27;</span>,<br>    version=main_window_re.VERSION_NAME,<br>    windows=[<span class="hljs-string">&#x27;main_window_re.py&#x27;</span>, ],<br>    zipfile=<span class="hljs-literal">None</span>,<br>    options=&#123;<span class="hljs-string">&#x27;py2exe&#x27;</span>: py2exe_options&#125;<br>)<br></code></pre></td></tr></table></figure><p>å°è¯•è¿‡3.6å’Œ3.5ç‰ˆæœ¬ï¼Œpy2exeéƒ½ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚</p><h2 id="pyinstaller"><a href="#pyinstaller" class="headerlink" title="pyinstaller"></a>pyinstaller</h2><p><a href="https://github.com/pyinstaller/pyinstaller/wiki/FAQ">https://github.com/pyinstaller/pyinstaller/wiki/FAQ</a></p><p>ç”±äºç”µè„‘ä¸Šå®‰è£…äº†å¤šä¸ªç‰ˆæœ¬çš„Pythonï¼Œç¯å¢ƒå˜é‡åˆ¶å®šäº†Python2ã€‚<br>è¿™é‡Œä½¿ç”¨3.5ç‰ˆæœ¬çš„pyinstalleræ¥æ‰“åŒ…ã€‚<br>æ³¨æ„<code>--paths</code>æŒ‡å®šäº†è·¯å¾„ã€‚ç¯å¢ƒå˜é‡ä¸­å¹¶æ²¡æœ‰è®¾ç½®è¿™ä¸ªè·¯å¾„ã€‚æˆ‘ä»¬æŒ‡å®šå»æ‰¾PyQt5çš„ä¾èµ–dllã€‚</p><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vbnet">-p DIR, --paths DIR   A path <span class="hljs-keyword">to</span> search <span class="hljs-keyword">for</span> <span class="hljs-keyword">imports</span> (<span class="hljs-built_in">like</span> <span class="hljs-keyword">using</span> PYTHONPATH).<br>                      Multiple paths are allowed, separated <span class="hljs-keyword">by</span> <span class="hljs-comment">&#x27;;&#x27;, or use</span><br>                      this <span class="hljs-keyword">option</span> multiple times<br></code></pre></td></tr></table></figure><p>è·¯å¾„æœ€å¥½æ˜¯åŠ ä¸Šå¼•å·ï¼Œæ¯”å¦‚è¿™é‡ŒæŒ‡å®šQt5å’ŒPyQt5çš„è·¯å¾„<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">pyinstaller -<span class="hljs-selector-tag">p</span> <span class="hljs-string">&quot;D:\Qt\Qt5\5.6.3\msvc2015\bin&quot;</span> -<span class="hljs-selector-tag">p</span> <span class="hljs-string">&quot;D:\Python27_qt5\Lib\site-packages\PyQt5&quot;</span> main_lab.py<br></code></pre></td></tr></table></figure></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ <span class="hljs-regexp">/d/</span>python35<span class="hljs-regexp">/Scripts/</span>pyinstaller --paths <span class="hljs-regexp">/d/</span>python35<span class="hljs-regexp">/Lib/</span>site-packages<span class="hljs-regexp">/PyQt5/</span>Qt/bin --onefile main_lab.py<br><span class="hljs-number">106</span> INFO: PyInstaller: <span class="hljs-number">3.2</span>.<span class="hljs-number">1</span><br><span class="hljs-number">106</span> INFO: Python: <span class="hljs-number">3.5</span>.<span class="hljs-number">4</span>rc1<br><span class="hljs-number">106</span> INFO: Platform: Windows-<span class="hljs-number">7</span>-<span class="hljs-number">6.1</span>.<span class="hljs-number">7601</span>-SP1<br><span class="hljs-number">108</span> INFO: wrote E:\ws\eslab\lab\main_lab.spec<br><span class="hljs-number">109</span> INFO: UPX is not available.<br><span class="hljs-number">110</span> INFO: Extending PYTHONPATH with paths<br>[<span class="hljs-string">&#x27;E:\\ws\\eslab\\lab&#x27;</span>,<br> <span class="hljs-string">&#x27;D:\\python35\\Lib\\site-packages\\PyQt5\\Qt\\bin&#x27;</span>,<br> <span class="hljs-string">&#x27;E:\\ws\\eslab\\lab&#x27;</span>]<br>......<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆå•ä¸ªçª—å£EXEæ–‡ä»¶ã€‚<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ <span class="hljs-regexp">/d/</span>python35<span class="hljs-regexp">/Scripts/</span>pyinstaller --paths <span class="hljs-regexp">/d/</span>python35<span class="hljs-regexp">/Lib/</span>site-packages<span class="hljs-regexp">/PyQt5/</span>Qt/bin -F -w main_lab.py<br></code></pre></td></tr></table></figure></p><p>ç”Ÿæˆexeæ–‡ä»¶åï¼ŒæŠ¥äº†ä¸€ä¸ªæ‰¾ä¸åˆ°<code>lab</code>æ¨¡å—çš„é”™è¯¯ã€‚<br>è¿™ä¸ªæ¨¡å—åˆšå¥½å°±æ˜¯æˆ‘ä»¬ä¸»ç•Œé¢æ‰€åœ¨çš„æ¨¡å—ã€‚<br>å°†å¼•ç”¨çš„æ¨¡å—å<code>lab</code>åˆ æ‰ã€‚é‡æ–°ç”Ÿæˆexeæ–‡ä»¶ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> lab.file_utils <span class="hljs-keyword">import</span> FileUtils<br><span class="hljs-keyword">from</span> lab.mainwindow <span class="hljs-keyword">import</span> Ui_MainWindow<br><span class="hljs-comment">####################################</span><br><span class="hljs-keyword">from</span> file_utils <span class="hljs-keyword">import</span> FileUtils<br><span class="hljs-keyword">from</span> mainwindow <span class="hljs-keyword">import</span> Ui_MainWindow<br></code></pre></td></tr></table></figure></p><h3 id="è¿è¡Œexeæ‰¾ä¸åˆ°æ¨¡å—æŠ¥é”™"><a href="#è¿è¡Œexeæ‰¾ä¸åˆ°æ¨¡å—æŠ¥é”™" class="headerlink" title="è¿è¡Œexeæ‰¾ä¸åˆ°æ¨¡å—æŠ¥é”™"></a>è¿è¡Œexeæ‰¾ä¸åˆ°æ¨¡å—æŠ¥é”™</h3><p>ä½¿ç”¨é»˜è®¤æ–¹å¼æ‰“åŒ…ï¼Œå¾—åˆ°exeä¸æ–‡ä»¶ç›®å½•<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">pyinstaller</span> main_lab.py<br></code></pre></td></tr></table></figure><br>å°†distä¸­çš„ç›®å½•å¤åˆ¶åˆ°å¦ä¸€å°ç”µè„‘ï¼Œç‚¹å‡»è¿è¡Œexeæ–‡ä»¶ï¼›æç¤ºæ‰¾ä¸åˆ°æ¨¡å—<br>åœ¨ä¸»uiæ–‡ä»¶ä¸­ï¼Œæ·»åŠ è·¯å¾„<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> os<br><br>sys.path.append(os.getcwd())  <span class="hljs-comment"># Prepare path</span><br></code></pre></td></tr></table></figure></p><p>æ‰¾ä¸åˆ°æ¨¡å—ï¼Œä¸€èˆ¬ä¼šæŠ¥ <code>ImportError: No module named &#39;xxx&#39;</code> é”™è¯¯<br>æ­¤æ—¶ä¸€èˆ¬æ˜¯æ‰¾ä¸åˆ°æˆ‘ä»¬è‡ªå·±å†™çš„æ¨¡å—ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> my_package.ui_main <span class="hljs-keyword">import</span> Ui_MainWindow  <span class="hljs-comment"># æ˜¾ç¤ºæŒ‡å®šäº†my_package æ‰“åŒ…å¾—åˆ°çš„exeä¼šæ‰¾ä¸åˆ°è¿™ä¸ªåŒ…</span><br><span class="hljs-keyword">from</span> my_widget <span class="hljs-keyword">import</span> DragInWidget  <span class="hljs-comment"># ä¸æ˜¾ç¤ºæŒ‡å®špackage  å¦åˆ™æ‰“åŒ…å¾—åˆ°çš„exeä¼šæ‰¾ä¸åˆ°åŒ…è€Œæ— æ³•è¿è¡Œ</span><br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>PyQt</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Python è·å–å½“å‰è·¯å¾„çš„æ–¹æ³•</title>
    <link href="/2017/07/31/Python/Python-get-path/"/>
    <url>/2017/07/31/Python/Python-get-path/</url>
    
    <content type="html"><![CDATA[<p><a href="https://rustfisher.com/2017/07/31/Python/Python-get-path/">æœ¬æ–‡é“¾æ¥</a></p><h1 id="Python2-7-ä¸­è·å–è·¯å¾„çš„å„ç§æ–¹æ³•"><a href="#Python2-7-ä¸­è·å–è·¯å¾„çš„å„ç§æ–¹æ³•" class="headerlink" title="Python2.7 ä¸­è·å–è·¯å¾„çš„å„ç§æ–¹æ³•"></a>Python2.7 ä¸­è·å–è·¯å¾„çš„å„ç§æ–¹æ³•</h1><h2 id="sys-path"><a href="#sys-path" class="headerlink" title="sys.path"></a><code>sys.path</code></h2><p>æ¨¡å—æœç´¢è·¯å¾„çš„å­—ç¬¦ä¸²åˆ—è¡¨ã€‚ç”±ç¯å¢ƒå˜é‡PYTHONPATHåˆå§‹åŒ–å¾—åˆ°ã€‚<br>sys.path[0]æ˜¯è°ƒç”¨Pythonè§£é‡Šå™¨çš„å½“å‰è„šæœ¬æ‰€åœ¨çš„ç›®å½•ã€‚</p><h2 id="sys-argv"><a href="#sys-argv" class="headerlink" title="sys.argv"></a><code>sys.argv</code></h2><p>ä¸€ä¸ªä¼ ç»™Pythonè„šæœ¬çš„æŒ‡ä»¤å‚æ•°åˆ—è¡¨ã€‚<br>sys.argv[0]æ˜¯è„šæœ¬çš„åå­—ï¼ˆç”±ç³»ç»Ÿå†³å®šæ˜¯å¦æ˜¯å…¨åï¼‰<br>å‡è®¾æ˜¾ç¤ºè°ƒç”¨pythonæŒ‡ä»¤ï¼Œå¦‚<code>python demo.py</code>ï¼Œä¼šå¾—åˆ°ç»å¯¹è·¯å¾„ï¼›<br>è‹¥ç›´æ¥æ‰§è¡Œè„šæœ¬ï¼Œå¦‚<code>./demo.py</code>ï¼Œä¼šå¾—åˆ°ç›¸å¯¹è·¯å¾„ã€‚</p><h2 id="os-getcwd"><a href="#os-getcwd" class="headerlink" title="os.getcwd()"></a><code>os.getcwd()</code></h2><p>è·å–å½“å‰å·¥ä½œè·¯å¾„ã€‚åœ¨è¿™é‡Œæ˜¯ç»å¯¹è·¯å¾„ã€‚<br><a href="https://docs.python.org/2/library/os.html#os.getcwd">https://docs.python.org/2/library/os.html#os.getcwd</a></p><h2 id="file"><a href="#file" class="headerlink" title="__file__"></a><code>__file__</code></h2><p>è·å¾—æ¨¡å—æ‰€åœ¨çš„è·¯å¾„ï¼Œå¯èƒ½å¾—åˆ°ç›¸å¯¹è·¯å¾„ã€‚<br>å¦‚æœæ˜¾ç¤ºæ‰§è¡ŒPythonï¼Œä¼šå¾—åˆ°ç»å¯¹è·¯å¾„ã€‚<br>è‹¥æŒ‰ç›¸å¯¹è·¯å¾„æ¥ç›´æ¥æ‰§è¡Œè„šæœ¬<code>./pyws/path_demo.py</code>ï¼Œä¼šå¾—åˆ°ç›¸å¯¹è·¯å¾„ã€‚<br>ä¸ºäº†è·å–ç»å¯¹è·¯å¾„ï¼Œå¯è°ƒç”¨<code>os.path.abspath()</code></p><h1 id="os-path-ä¸­çš„ä¸€äº›æ–¹æ³•"><a href="#os-path-ä¸­çš„ä¸€äº›æ–¹æ³•" class="headerlink" title="os.path ä¸­çš„ä¸€äº›æ–¹æ³•"></a>os.path ä¸­çš„ä¸€äº›æ–¹æ³•</h1><h2 id="os-path-split-path"><a href="#os-path-split-path" class="headerlink" title="os.path.split(path)"></a><code>os.path.split(path)</code></h2><p>å°†è·¯å¾„åç§°åˆ†æˆå¤´å’Œå°¾ä¸€å¯¹ã€‚å°¾éƒ¨æ°¸è¿œä¸ä¼šå¸¦æœ‰æ–œæ ã€‚å¦‚æœè¾“å…¥çš„è·¯å¾„ä»¥æ–œæ ç»“å°¾ï¼Œé‚£ä¹ˆå¾—åˆ°çš„ç©ºçš„å°¾éƒ¨ã€‚<br>å¦‚æœè¾“å…¥è·¯å¾„æ²¡æœ‰æ–œæ ï¼Œé‚£ä¹ˆå¤´éƒ¨ä½ä¸ºç©ºã€‚å¦‚æœè¾“å…¥è·¯å¾„ä¸ºç©ºï¼Œé‚£ä¹ˆå¾—åˆ°çš„å¤´å’Œå°¾éƒ½æ˜¯ç©ºã€‚<br><a href="https://docs.python.org/2/library/os.path.html#os.path.split">https://docs.python.org/2/library/os.path.html#os.path.split</a></p><h2 id="os-path-realpath-path"><a href="#os-path-realpath-path" class="headerlink" title="os.path.realpath(path)"></a><code>os.path.realpath(path)</code></h2><p>è¿”å›ç‰¹å®šæ–‡ä»¶åçš„ç»å¯¹è·¯å¾„ã€‚<br><a href="https://docs.python.org/2/library/os.path.html#os.path.realpath">https://docs.python.org/2/library/os.path.html#os.path.realpath</a></p><h1 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h1><p>ç¯å¢ƒ Win7, Python2.7<br>ä»¥<code>/e/pyws/path_demo.py</code>ä¸ºä¾‹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;sys.path[0] =&quot;</span>, sys.path[<span class="hljs-number">0</span>]<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;sys.argv[0] =&quot;</span>, sys.argv[<span class="hljs-number">0</span>]<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;__file__ =&quot;</span>, __file__<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;os.path.abspath(__file__) =&quot;</span>, os.path.abspath(__file__)<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;os.path.realpath(__file__) = &quot;</span>, os.path.realpath(__file__)<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;os.path.dirname(os.path.realpath(__file__)) =&quot;</span>, os.path.dirname(os.path.realpath(__file__))<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;os.path.split(os.path.realpath(__file__)) =&quot;</span>, os.path.split(os.path.realpath(__file__))<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;os.getcwd() =&quot;</span>, os.getcwd()<br></code></pre></td></tr></table></figure></p><p>åœ¨<code>/d</code>ä¸­è¿è¡Œï¼Œè¾“å‡ºä¸º<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus">$ python /e/pyws/path_demo<span class="hljs-selector-class">.py</span><br>sys<span class="hljs-selector-class">.path</span><span class="hljs-selector-attr">[0]</span> = E:\pyws<br>sys<span class="hljs-selector-class">.argv</span><span class="hljs-selector-attr">[0]</span> = E:/pyws/path_demo<span class="hljs-selector-class">.py</span><br>__file__ = E:/pyws/path_demo<span class="hljs-selector-class">.py</span><br>os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.abspath</span>(__file__) = E:\pyws\path_demo<span class="hljs-selector-class">.py</span><br>os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.realpath</span>(__file__) =  E:\pyws\path_demo<span class="hljs-selector-class">.py</span><br>os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.dirname</span>(os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.realpath</span>(__file__)) = E:\pyws<br>os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.split</span>(os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.realpath</span>(__file__)) = (<span class="hljs-string">&#x27;E:\\pyws&#x27;</span>, <span class="hljs-string">&#x27;path_demo.py&#x27;</span>)<br>os<span class="hljs-selector-class">.getcwd</span>() = D:\<br></code></pre></td></tr></table></figure></p><p>åœ¨eç›˜ä¸­ç”¨å‘½ä»¤è¡Œç›´æ¥æ‰§è¡Œè„šæœ¬<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs stylus">$ ./pyws/path_demo<span class="hljs-selector-class">.py</span><br>sys<span class="hljs-selector-class">.path</span><span class="hljs-selector-attr">[0]</span> = E:\pyws<br>sys<span class="hljs-selector-class">.argv</span><span class="hljs-selector-attr">[0]</span> = ./pyws/path_demo<span class="hljs-selector-class">.py</span><br>__file__ = ./pyws/path_demo<span class="hljs-selector-class">.py</span><br>os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.abspath</span>(__file__) = E:\pyws\path_demo<span class="hljs-selector-class">.py</span><br>os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.realpath</span>(__file__) =  E:\pyws\path_demo<span class="hljs-selector-class">.py</span><br>os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.dirname</span>(os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.realpath</span>(__file__)) = E:\pyws<br>os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.split</span>(os<span class="hljs-selector-class">.path</span><span class="hljs-selector-class">.realpath</span>(__file__)) = (<span class="hljs-string">&#x27;E:\\pyws&#x27;</span>, <span class="hljs-string">&#x27;path_demo.py&#x27;</span>)<br>os<span class="hljs-selector-class">.getcwd</span>() = E:\<br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>PyQt çº¿ç¨‹ç±» QThread</title>
    <link href="/2017/07/11/PyQt_note/PyQt-QThread/"/>
    <url>/2017/07/11/PyQt_note/PyQt-QThread/</url>
    
    <content type="html"><![CDATA[<p>PyQtä¸­çš„çº¿ç¨‹ç±» <code>QtCore.QThread</code>ï¼Œä½¿ç”¨æ—¶ç»§æ‰¿QThreadç±»</p><p>å¯åŠ¨ç•Œé¢çš„çº¿ç¨‹æš‚ç§°ä¸ºUIçº¿ç¨‹ã€‚ç•Œé¢æ‰§è¡Œå‘½ä»¤æ—¶éƒ½åœ¨è‡ªå·±çš„UIçº¿ç¨‹ä¸­ã€‚<br>å¦‚æœåœ¨UIçº¿ç¨‹ä¸­æ‰§è¡Œç½‘ç»œè¿æ¥å’Œæ•°æ®åº“æ“ä½œç­‰è€—æ—¶çš„æ“ä½œï¼Œç•Œé¢ä¼šè¢«å¡ä½ï¼ŒWindowsä¸‹æœ‰å¯èƒ½ä¼šå‡ºç°â€œæ— å“åº”â€çš„è­¦å‘Šã€‚<br>é˜»å¡UIçº¿ç¨‹ä¼šé™ä½ç”¨æˆ·ä½“éªŒå’Œåº”ç”¨ç¨³å®šæ€§ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥æŠŠè€—æ—¶æ“ä½œæ”¾åœ¨çº¿ç¨‹ä¸­å»æ‰§è¡Œã€‚</p><p>QThreadä»£è¡¨ä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å¤å†™runå‡½æ•°æ¥æ‰§è¡Œæˆ‘ä»¬è¦çš„æ“ä½œã€‚<br>QThreadå¯ä»¥ä½¿ç”¨<code>QtCore.pyqtSignal</code>æ¥ä¸ç•Œé¢äº¤äº’å’Œä¼ è¾“æ•°æ®ã€‚</p><h2 id="PyQt4-QThread-ä»£ç ç¤ºä¾‹"><a href="#PyQt4-QThread-ä»£ç ç¤ºä¾‹" class="headerlink" title="PyQt4 QThread ä»£ç ç¤ºä¾‹"></a>PyQt4 QThread ä»£ç ç¤ºä¾‹</h2><ul><li>Python2.7</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">from</span> PyQt4 <span class="hljs-keyword">import</span> QtCore<br><span class="hljs-keyword">from</span> PyQt4.QtCore <span class="hljs-keyword">import</span> QCoreApplication<br><span class="hljs-keyword">from</span> PyQt4.QtGui <span class="hljs-keyword">import</span> QWidget, QPushButton, QApplication, QTextBrowser<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeThread</span>(QtCore.QThread):<br>    signal_time = QtCore.pyqtSignal(<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>)  <span class="hljs-comment"># ä¿¡å·</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, parent=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-built_in">super</span>(TimeThread, self).__init__(parent)<br>        self.working = <span class="hljs-literal">True</span><br>        self.num = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">start_timer</span>(<span class="hljs-params">self</span>):<br>        self.num = <span class="hljs-number">0</span><br>        self.start()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">while</span> self.working:<br>            <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Working&quot;</span>, self.thread()<br>            self.signal_time.emit(<span class="hljs-string">&quot;Running time:&quot;</span>, self.num)  <span class="hljs-comment"># å‘é€ä¿¡å·</span><br>            self.num += <span class="hljs-number">1</span><br>            self.sleep(<span class="hljs-number">1</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TimeDialog</span>(<span class="hljs-title class_ inherited__">QWidget</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(TimeDialog, self).__init__()<br>        self.timer_tv = QTextBrowser(self)<br>        self.init_ui()<br>        self.timer_t = TimeThread()<br>        self.timer_t.signal_time.connect(self.update_timer_tv)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">init_ui</span>(<span class="hljs-params">self</span>):<br>        self.resize(<span class="hljs-number">300</span>, <span class="hljs-number">200</span>)<br>        self.setWindowTitle(<span class="hljs-string">&#x27;TimeDialog&#x27;</span>)<br>        self.timer_tv.setText(<span class="hljs-string">&quot;Wait&quot;</span>)<br>        self.timer_tv.setGeometry(QtCore.QRect(<span class="hljs-number">10</span>, <span class="hljs-number">145</span>, <span class="hljs-number">198</span>, <span class="hljs-number">26</span>))<br>        self.timer_tv.move(<span class="hljs-number">0</span>, <span class="hljs-number">15</span>)<br><br>        btn1 = QPushButton(<span class="hljs-string">&#x27;Quit&#x27;</span>, self)<br>        btn1.setToolTip(<span class="hljs-string">&#x27;Click to quit&#x27;</span>)<br>        btn1.resize(btn1.sizeHint())<br>        btn1.move(<span class="hljs-number">200</span>, <span class="hljs-number">150</span>)<br>        btn1.clicked.connect(QCoreApplication.instance().quit)<br><br>        start_btn = QPushButton(<span class="hljs-string">&#x27;Start&#x27;</span>, self)<br>        start_btn.setToolTip(<span class="hljs-string">&quot;Click to start&quot;</span>)<br>        start_btn.move(<span class="hljs-number">50</span>, <span class="hljs-number">150</span>)<br>        self.connect(start_btn, QtCore.SIGNAL(<span class="hljs-string">&quot;clicked()&quot;</span>), self.click_start_btn)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">click_start_btn</span>(<span class="hljs-params">self</span>):<br>        self.timer_t.start_timer()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_timer_tv</span>(<span class="hljs-params">self, text, number</span>):<br>        self.timer_tv.setText(self.tr(text + <span class="hljs-string">&quot; &quot;</span> + <span class="hljs-built_in">str</span>(number)))<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app = QApplication(sys.argv)<br>    time_dialog = TimeDialog()<br>    time_dialog.show()<br><br>    sys.exit(app.exec_())<br></code></pre></td></tr></table></figure><p>QThreadä¸­ä½¿ç”¨çš„ä¿¡å·<code>signal_time = QtCore.pyqtSignal(str, int)</code> æŒ‡å®šäº†å‚æ•°strå’Œint<br>å‘é€ä¿¡å·<code>self.signal_time.emit(&quot;Running time:&quot;, self.num)</code></p><p>å¤–éƒ¨æ¥æ”¶ä¿¡å·<code>self.timer_t.signal_time.connect(self.update_timer_tv)</code><br>ä¿¡å·è¿æ¥åˆ°æ–¹æ³•<code>update_timer_tv(self, text, number)</code>ï¼Œæ³¨æ„ä¿¡å·ä¸æ–¹æ³•çš„å‚æ•°è¦ä¸€ä¸€å¯¹åº”</p><p>ä½¿ç”¨ä¸­æˆ‘ä»¬å¯ä»¥å®šä¹‰å¤šç§ä¸åŒçš„ä¿¡å·<code>QtCore.pyqtSignal</code></p><p>å¯åŠ¨çº¿ç¨‹ï¼Œè°ƒç”¨<code>start()</code></p>]]></content>
    
    
    <categories>
      
      <category>PyQt</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Python è°ƒç”¨adbå‘½ä»¤</title>
    <link href="/2017/07/05/Python/Python-adb-use/"/>
    <url>/2017/07/05/Python/Python-adb-use/</url>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨Pythoné€šè¿‡subprocessè°ƒç”¨adbå‘½ä»¤ã€‚</p><p>subprocessåŒ…ä¸»è¦åŠŸèƒ½æ˜¯æ‰§è¡Œå¤–éƒ¨å‘½ä»¤ï¼ˆç›¸å¯¹Pythonè€Œè¨€ï¼‰ã€‚å’Œshellç±»ä¼¼ã€‚</p><p>æ¢è¨€ä¹‹é™¤äº†adbå‘½ä»¤å¤–ï¼Œåˆ©ç”¨subprocesså¯ä»¥æ‰§è¡Œå…¶ä»–çš„å‘½ä»¤ï¼Œæ¯”å¦‚lsï¼Œcdç­‰ç­‰ã€‚</p><p>subprocess å¯å‚è€ƒï¼š <a href="https://docs.python.org/2/library/subprocess.html">https://docs.python.org/2/library/subprocess.html</a></p><p>åœ¨ç”µè„‘ä¸Šè£…å¥½adbå·¥å…·ï¼Œé…ç½®å¥½adbçš„ç¯å¢ƒå˜é‡ï¼Œå…ˆç¡®ä¿shellä¸­å¯ä»¥è°ƒç”¨adbå‘½ä»¤ã€‚</p><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><ul><li>Python2.7</li></ul><p>ç±» <code>Adb</code>ï¼Œå°è£…äº†ä¸€äº›adbçš„æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> subprocess<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Adb</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-string">&quot;&quot;&quot; Provides some adb methods &quot;&quot;&quot;</span><br><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">adb_devices</span>():<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        Do adb devices</span><br><span class="hljs-string">        :return The first connected device ID</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        cmd = <span class="hljs-string">&quot;adb devices&quot;</span><br>        c_line = subprocess.Popen(cmd, shell=<span class="hljs-literal">True</span>, stdout=subprocess.PIPE, stderr=subprocess.PIPE).communicate()[<span class="hljs-number">0</span>]<br>        <span class="hljs-keyword">if</span> c_line.find(<span class="hljs-string">&quot;List of devices attached&quot;</span>) &lt; <span class="hljs-number">0</span>:  <span class="hljs-comment"># adb is not working</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>        <span class="hljs-keyword">return</span> c_line.split(<span class="hljs-string">&quot;\t&quot;</span>)[<span class="hljs-number">0</span>].split(<span class="hljs-string">&quot;\r\n&quot;</span>)[-<span class="hljs-number">1</span>]  <span class="hljs-comment"># This line may have different format</span><br><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pull_sd_dcim</span>(<span class="hljs-params">device, target_dir=<span class="hljs-string">&#x27;E:/files&#x27;</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot; Pull DCIM files from device &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Pulling files&quot;</span><br>        des_path = os.path.join(target_dir, device)<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(des_path):<br>            os.makedirs(des_path)<br>        <span class="hljs-built_in">print</span> des_path<br>        cmd = <span class="hljs-string">&quot;adb pull /sdcard/DCIM/ &quot;</span> + des_path<br>        result = subprocess.Popen(cmd, shell=<span class="hljs-literal">True</span>, stdout=subprocess.PIPE, stderr=subprocess.PIPE).communicate()<br>        <span class="hljs-built_in">print</span> result<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Finish!&quot;</span><br>        <span class="hljs-keyword">return</span> des_path<br><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">some_adb_cmd</span>():<br>        p = subprocess.Popen(<span class="hljs-string">&#x27;adb shell cd sdcard&amp;&amp;ls&amp;&amp;cd ../sys&amp;&amp;ls&#x27;</span>,<br>                             stdout=subprocess.PIPE, stderr=subprocess.PIPE)<br>        return_code = p.poll()<br>        <span class="hljs-keyword">while</span> return_code <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>            line = p.stdout.readline()<br>            return_code = p.poll()<br>            line = line.strip()<br>            <span class="hljs-keyword">if</span> line:<br>                <span class="hljs-built_in">print</span> line<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Done&quot;</span><br><br></code></pre></td></tr></table></figure><p><code>some_adb_cmd</code>æ–¹æ³•æ‰§è¡Œä¸€è¿ä¸²çš„å‘½ä»¤ã€‚å„ä¸ªå‘½ä»¤ä¹‹é—´ç”¨<code>&amp;&amp;</code>è¿æ¥ã€‚<br>æ¥ç€æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œå°†æ‰§è¡Œç»“æœæ‰“å°å‡ºæ¥ã€‚</p><h2 id="subprocess-è¯´æ˜"><a href="#subprocess-è¯´æ˜" class="headerlink" title="subprocess è¯´æ˜"></a>subprocess è¯´æ˜</h2><p><code>creationflags=CREATE_NEW_CONSOLE</code>åœ¨æ‰§è¡ŒæŒ‡ä»¤æ—¶å¼¹å‡ºä¸€ä¸ªæ–°çš„cmdçª—å£</p><p>å¯ä»¥æ‰§è¡ŒæŒ‡å®šçš„batè„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> _subprocess <span class="hljs-keyword">import</span> CREATE_NEW_CONSOLE<br><span class="hljs-keyword">from</span> subprocess <span class="hljs-keyword">import</span> Popen<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_click_new_cmd_window_btn</span>(<span class="hljs-params">self</span>):<br>        self.log.info(<span class="hljs-string">&quot;click_new_cmd_window_btn&quot;</span>)<br>        Popen(<span class="hljs-string">&#x27;cmd&#x27;</span>, creationflags=CREATE_NEW_CONSOLE)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_click_exe_bat_btn1</span>(<span class="hljs-params">self</span>):<br>        self.log.info(<span class="hljs-string">&quot;run bat&quot;</span>)<br>        Popen(<span class="hljs-string">&#x27;C:\MYDIR\_debug.bat&#x27;</span>, creationflags=CREATE_NEW_CONSOLE)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Python æŸ¥çœ‹ç›®å½•ä¸­çš„æ–‡ä»¶</title>
    <link href="/2017/07/01/Python/Python-scan-file/"/>
    <url>/2017/07/01/Python/Python-scan-file/</url>
    
    <content type="html"><![CDATA[<p>ä¸€äº›å…³äºæ–‡ä»¶çš„æ“ä½œ<br>ä¾‹å¦‚ï¼Œå®ç°æŸ¥çœ‹ç›®å½•å†…å®¹çš„åŠŸèƒ½ã€‚ç±»ä¼¼Linuxä¸‹çš„<code>tree</code>å‘½ä»¤ã€‚<br>ç»Ÿè®¡ç›®å½•ä¸‹æŒ‡å®šåç¼€æ–‡ä»¶çš„è¡Œæ•°ã€‚</p><p>åŠŸèƒ½æ˜¯å°†ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶è·¯å¾„å­˜å…¥listä¸­ã€‚<br>å¯ä»¥åŠ å…¥åç¼€åˆ¤æ–­åŠŸèƒ½ï¼Œæœç´¢æŒ‡å®šçš„åç¼€åæ–‡ä»¶ã€‚<br>ä¸»è¦åˆ©ç”¨é€’å½’çš„æ–¹æ³•æ¥æ£€ç´¢æ–‡ä»¶ã€‚</p><h3 id="ä»¿é€ -tree-åŠŸèƒ½ç¤ºä¾‹ä»£ç "><a href="#ä»¿é€ -tree-åŠŸèƒ½ç¤ºä¾‹ä»£ç " class="headerlink" title="ä»¿é€  tree åŠŸèƒ½ç¤ºä¾‹ä»£ç "></a>ä»¿é€  tree åŠŸèƒ½ç¤ºä¾‹ä»£ç </h3><ul><li>Python2.7</li></ul><p>åˆ—å‡ºç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶<br>é€’å½’æ³•<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">tree_dir</span>(<span class="hljs-params">path, c_path=<span class="hljs-string">&#x27;&#x27;</span>, is_root=<span class="hljs-literal">True</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    Get file list under path. Like &#x27;tree&#x27;</span><br><span class="hljs-string">    :param path Root dir</span><br><span class="hljs-string">    :param c_path Child dir</span><br><span class="hljs-string">    :param is_root Current is root dir</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    res = []<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(path):<br>        <span class="hljs-keyword">return</span> res<br>    <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> os.listdir(path):<br>        <span class="hljs-keyword">if</span> os.path.isfile(os.path.join(path, f)):<br>            <span class="hljs-keyword">if</span> is_root:<br>                res.append(f)<br>            <span class="hljs-keyword">else</span>:<br>                res.append(os.path.join(c_path, f))<br>        <span class="hljs-keyword">else</span>:<br>            res.extend(tree_dir(os.path.join(path, f), f, is_root=<span class="hljs-literal">False</span>))<br>    <span class="hljs-keyword">return</span> res<br></code></pre></td></tr></table></figure></p><p>ä¸‹é¢æ˜¯åŠ å…¥åç¼€åˆ¤æ–­çš„æ–¹æ³•ã€‚åœ¨æ‰¾åˆ°æ–‡ä»¶åï¼Œåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦ç¬¦åˆåç¼€è¦æ±‚ã€‚ä¸ç¬¦åˆè¦æ±‚çš„æ–‡ä»¶å°±è·³è¿‡ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">tree_dir_sur</span>(<span class="hljs-params">path, c_path=<span class="hljs-string">&#x27;&#x27;</span>, is_root=<span class="hljs-literal">True</span>, suffix=<span class="hljs-string">&#x27;&#x27;</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot; Get file list under path. Like &#x27;tree&#x27;</span><br><span class="hljs-string">    :param path Root dir</span><br><span class="hljs-string">    :param c_path Child dir</span><br><span class="hljs-string">    :param is_root Current is root dir</span><br><span class="hljs-string">    :param suffix Suffix of file</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    res = []<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(path) <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> os.path.isdir(path):<br>        <span class="hljs-keyword">return</span> res<br>    <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> os.listdir(path):<br>        <span class="hljs-keyword">if</span> os.path.isfile(os.path.join(path, f)) <span class="hljs-keyword">and</span> <span class="hljs-built_in">str</span>(f).endswith(suffix):<br>            <span class="hljs-keyword">if</span> is_root:<br>                res.append(f)<br>            <span class="hljs-keyword">else</span>:<br>                res.append(os.path.join(c_path, f))<br>        <span class="hljs-keyword">else</span>:<br>            res.extend(tree_dir_sur(os.path.join(path, f), f, is_root=<span class="hljs-literal">False</span>, suffix=suffix))<br>    <span class="hljs-keyword">return</span> res<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> tree_dir_sur(os.path.join(<span class="hljs-string">&#x27;E:\ws&#x27;</span>, <span class="hljs-string">&#x27;rnote&#x27;</span>, <span class="hljs-string">&#x27;Python_note&#x27;</span>), suffix=<span class="hljs-string">&#x27;md&#x27;</span>):<br>        <span class="hljs-built_in">print</span> p<br></code></pre></td></tr></table></figure></p><h3 id="ç»Ÿè®¡ç›®å½•ä¸‹æŒ‡å®šåç¼€æ–‡ä»¶çš„è¡Œæ•°"><a href="#ç»Ÿè®¡ç›®å½•ä¸‹æŒ‡å®šåç¼€æ–‡ä»¶çš„è¡Œæ•°" class="headerlink" title="ç»Ÿè®¡ç›®å½•ä¸‹æŒ‡å®šåç¼€æ–‡ä»¶çš„è¡Œæ•°"></a>ç»Ÿè®¡ç›®å½•ä¸‹æŒ‡å®šåç¼€æ–‡ä»¶çš„è¡Œæ•°</h3><p>ä»…é€‚ç”¨osä¸­çš„æ–¹æ³•ï¼Œä»…æ£€ç´¢ç›®å½•ä¸­å›ºå®šä½ç½®çš„æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> os<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">count_by_categories</span>(<span class="hljs-params">path</span>):<br>    <span class="hljs-string">&quot;&quot;&quot; Find all target files and count the lines &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(path):<br>        <span class="hljs-keyword">return</span><br>    c_l_dict = <span class="hljs-built_in">dict</span>()  <span class="hljs-comment"># e.g. &#123;category: lines&#125;</span><br>    category_list = [cate <span class="hljs-keyword">for</span> cate <span class="hljs-keyword">in</span> os.listdir(path) <span class="hljs-keyword">if</span><br>                     os.path.isdir(os.path.join(path, cate)) <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> cate.startswith(<span class="hljs-string">&#x27;.&#x27;</span>)]<br>    <span class="hljs-keyword">for</span> category_dir <span class="hljs-keyword">in</span> category_list:<br>        line_count = _sum_total_line(os.path.join(path, category_dir), <span class="hljs-string">&#x27;.md&#x27;</span>)<br>        <span class="hljs-keyword">if</span> line_count &gt; <span class="hljs-number">0</span>:<br>            c_l_dict[category_dir] = line_count<br>    <span class="hljs-keyword">return</span> c_l_dict<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_sum_total_line</span>(<span class="hljs-params">path, endswith=<span class="hljs-string">&#x27;.md&#x27;</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot; Get the total lines of target files &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(path) <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> os.path.isdir(path):<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    total_lines = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> os.listdir(path):<br>        <span class="hljs-keyword">if</span> f.endswith(endswith):<br>            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(os.path.join(path, f)) <span class="hljs-keyword">as</span> cur_f:<br>                total_lines += <span class="hljs-built_in">len</span>(cur_f.readlines())<br>    <span class="hljs-keyword">return</span> total_lines<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    note_dir = <span class="hljs-string">&#x27;E:/ws/rnote&#x27;</span><br>    ca_l_dict = count_by_categories(note_dir)<br>    all_lines = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> ca_l_dict.keys():<br>        all_lines += ca_l_dict[k]<br><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;all lines:&#x27;</span>, <span class="hljs-built_in">str</span>(all_lines)<br>    <span class="hljs-built_in">print</span> ca_l_dict<br></code></pre></td></tr></table></figure><p>ä»¥ç¬”è®°æ–‡ä»¶å¤¹ä¸ºä¾‹ï¼Œåˆ†åˆ«ç»Ÿè®¡åˆ†ç±»ç›®å½•ä¸‹æ–‡ä»¶çš„æ€»è¡Œæ•°ï¼Œæµ‹è¯•è¾“å‡º<br><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">all lines:</span> <span class="hljs-number">25433</span><br>&#123;<span class="hljs-attr">&#x27;flash_compile_git_note&#x27;:</span> <span class="hljs-number">334</span>, <span class="hljs-attr">&#x27;Linux_note&#x27;:</span> <span class="hljs-number">387</span>, <span class="hljs-attr">&#x27;Algorithm_note&#x27;:</span> <span class="hljs-number">3637</span>, <span class="hljs-attr">&#x27;Comprehensive&#x27;:</span> <span class="hljs-number">216</span>, <span class="hljs-attr">&#x27;advice&#x27;:</span> <span class="hljs-number">137</span>, <span class="hljs-attr">&#x27;Java_note&#x27;:</span> <span class="hljs-number">3013</span>, <span class="hljs-attr">&#x27;Android_note&#x27;:</span> <span class="hljs-number">11552</span>, <span class="hljs-attr">&#x27;DesignPattern&#x27;:</span> <span class="hljs-number">2646</span>, <span class="hljs-attr">&#x27;Python_note&#x27;:</span> <span class="hljs-number">787</span>, <span class="hljs-attr">&#x27;kotlin&#x27;:</span> <span class="hljs-number">184</span>, <span class="hljs-attr">&#x27;cpp_note&#x27;:</span> <span class="hljs-number">279</span>, <span class="hljs-attr">&#x27;PyQt_note&#x27;:</span> <span class="hljs-number">439</span>, <span class="hljs-attr">&#x27;reading&#x27;:</span> <span class="hljs-number">686</span>, <span class="hljs-attr">&#x27;backend&#x27;:</span> <span class="hljs-number">1136</span>&#125;<br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Android AsyncTask ä½¿ç”¨ä¸åˆ†æ</title>
    <link href="/2017/06/22/Android/Android-AsyncTask_use_and_RTFSC/"/>
    <url>/2017/06/22/Android/Android-AsyncTask_use_and_RTFSC/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ç®€å•ä»‹ç»Androidä¸­çš„AsyncTaskï¼Œå¹¶ä»æºç è§’åº¦åˆ†æå®ƒçš„æµç¨‹å’Œç‰¹ç‚¹ã€‚  </p><p>AsyncTaskæœ‰åŠ©äºä½¿ç”¨UIçº¿ç¨‹ã€‚<br>è¿™ä¸ªç±»èƒ½è®©ä½ ä¸ä¸»åŠ¨ä½¿ç”¨å¤šçº¿ç¨‹æˆ–Handlerï¼Œåœ¨UIçº¿ç¨‹è¿›è¡Œåå°æ“ä½œå¹¶å‘å¸ƒç»“æœã€‚<br>æ˜¯ä¸€ä¸ªåœ¨ä¸ç”¨å¤šçº¿ç¨‹å’ŒHandlerçš„æƒ…å†µä¸‹çš„å¸®åŠ©ç±»ã€‚AsyncTaské€‚ç”¨äºçŸ­æ—¶é—´çš„æ“ä½œï¼ˆæœ€å¤šå‡ ç§’ï¼‰ã€‚<br>å¦‚éœ€é•¿æ—¶é—´çš„çº¿ç¨‹æ“ä½œï¼Œå»ºè®®ä½¿ç”¨å¤šçº¿ç¨‹åŒ…<code>java.util.concurrent</code>ä¸­çš„APIï¼Œæ¯”å¦‚<code>Executor</code>ï¼Œ<code>ThreadPoolExecutor</code> å’Œ <code>FutureTask</code></p><p>AsyncTaskä»»åŠ¡çš„æ„æˆï¼š</p><ul><li>3ç§æ³›å‹ï¼š<code>Params</code>ï¼Œ <code>Progress</code> å’Œ <code>Result</code></li><li>4ä¸ªæ­¥éª¤ï¼š<code>onPreExecute</code>, <code>doInBackground</code>, <code>onProgressUpdate</code> å’Œ <code>onPostExecute</code></li></ul><p><a href="https://developer.android.com/reference/android/os/AsyncTask.html">Googleæ–‡æ¡£</a></p><h3 id="ç”¨æ³•ç®€ä»‹"><a href="#ç”¨æ³•ç®€ä»‹" class="headerlink" title="ç”¨æ³•ç®€ä»‹"></a>ç”¨æ³•ç®€ä»‹</h3><p>è™šæ„ä¸€ä¸ªè®¡ç®—ä»»åŠ¡<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java">    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è™šæ‹Ÿçš„è®¡ç®—ä»»åŠ¡</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CalculationTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AsyncTask</span>&lt;Float, Integer, Float&gt; &#123;<br>        <span class="hljs-keyword">protected</span> Float <span class="hljs-title function_">doInBackground</span><span class="hljs-params">(Float... inputs)</span> &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;doInBackground thread ID = &quot;</span> + Thread.currentThread().getId());<br>            <span class="hljs-type">long</span> <span class="hljs-variable">step</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-type">float</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">float</span> f : inputs) &#123;<br>                <span class="hljs-comment">// å‡è®¾è¿™é‡Œæœ‰ä¸€äº›è€—æ—¶çš„æ“ä½œ</span><br>                result += f;<br>            &#125;<br>            <span class="hljs-keyword">while</span> (step &lt; <span class="hljs-number">5</span>) &#123;<br>                result += step;<br>                step++;<br>                publishProgress((<span class="hljs-type">int</span>) step);<br>            &#125;<br>            <span class="hljs-keyword">return</span> result;<br>        &#125;<br><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onProgressUpdate</span><span class="hljs-params">(Integer... progress)</span> &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;onProgressUpdate thread ID = &quot;</span> + Thread.currentThread().getId());<br>            Log.d(TAG, <span class="hljs-string">&quot;onProgressUpdate: &quot;</span> + progress[<span class="hljs-number">0</span>]);<br>        &#125;<br><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onPostExecute</span><span class="hljs-params">(Float result)</span> &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;onPostExecute thread ID = &quot;</span> + Thread.currentThread().getId());<br>            Log.d(TAG, <span class="hljs-string">&quot;ä»»åŠ¡æ‰§è¡Œå®Œæ¯•&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// æ‰§è¡Œä»»åŠ¡</span><br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">CalculationTask</span>().execute(<span class="hljs-number">1.2f</span>, <span class="hljs-number">2.3f</span>, <span class="hljs-number">6.3f</span>);<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">logcat</span><br><span class="hljs-comment">Main thread ID = 1</span><br><span class="hljs-comment">doInBackground thread ID = 8089</span><br><span class="hljs-comment">onProgressUpdate thread ID = 1</span><br><span class="hljs-comment">onProgressUpdate: 1</span><br><span class="hljs-comment">...</span><br><span class="hljs-comment">onProgressUpdate thread ID = 1</span><br><span class="hljs-comment">onProgressUpdate: 5</span><br><span class="hljs-comment">onPostExecute thread ID = 1</span><br><span class="hljs-comment">ä»»åŠ¡æ‰§è¡Œå®Œæ¯•</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure></p><h3 id="AsyncTask-ä½¿ç”¨çš„çš„æ³›å‹"><a href="#AsyncTask-ä½¿ç”¨çš„çš„æ³›å‹" class="headerlink" title="AsyncTask ä½¿ç”¨çš„çš„æ³›å‹"></a>AsyncTask ä½¿ç”¨çš„çš„æ³›å‹</h3><p>AsyncTaskä½¿ç”¨çš„3ç§æ³›å‹</p><ul><li>Params é€å»æ‰§è¡Œçš„ç±»å‹</li><li>Progress åå°è®¡ç®—çš„è¿›åº¦ç±»å‹</li><li>Result åå°è®¡ç®—çš„ç»“æœ</li></ul><p>ä¸ç”¨çš„æ³›å‹å¯ä»¥ç”¨<code>Void</code>è¡¨ç¤ºã€‚ä¾‹å¦‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AsyncTask</span>&lt;Void, Void, Void&gt; &#123; ... &#125;<br></code></pre></td></tr></table></figure></p><h3 id="å¼‚æ­¥ä»»åŠ¡çš„4ä¸ªæ­¥éª¤"><a href="#å¼‚æ­¥ä»»åŠ¡çš„4ä¸ªæ­¥éª¤" class="headerlink" title="å¼‚æ­¥ä»»åŠ¡çš„4ä¸ªæ­¥éª¤"></a>å¼‚æ­¥ä»»åŠ¡çš„4ä¸ªæ­¥éª¤</h3><p>å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œæ—¶ç»è¿‡4ä¸ªæ­¥éª¤</p><ul><li><code>onPreExecute()</code> UIçº¿ç¨‹åœ¨ä»»åŠ¡å¼€å§‹å‰è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚æ­¤æ–¹æ³•å¸¸ç”¨æ¥è®¾ç½®ä»»åŠ¡ï¼Œæ¯”å¦‚åœ¨å±å¹•ä¸Šæ˜¾ç¤ºä¸€ä¸ªè¿›åº¦æ¡ã€‚</li><li><code>doInBackground(Params...)</code> <code>onPreExecute()</code>æ‰§è¡Œå®Œæ¯•åç«‹å³åœ¨åå°çº¿ç¨‹ä¸­æ‰§è¡Œã€‚è¿™ä¸€æ­¥ç”¨æ¥æ‰§è¡Œè€—æ—¶çš„åå°è®¡ç®—ã€‚<br>è¿™ä¸ªæ–¹æ³•æ¥å—å¼‚æ­¥ä»»åŠ¡çš„å‚æ•°ï¼Œè¿”å›æœ€åçš„ä»»åŠ¡ç»“æœã€‚è¿™ä¸€æ­¥å¯ä»¥è°ƒç”¨<code>publishProgress(Progress...)</code>é€šçŸ¥å‡ºå»ä¸€ä¸ªæˆ–å¤šä¸ªè¿›åº¦ã€‚è¿™äº›è¿›åº¦å€¼ä¼šè¢«<code>onProgressUpdate(Progress...)</code>åœ¨UIçº¿ç¨‹æ”¶åˆ°ã€‚</li><li><code>onProgressUpdate(Progress...)</code>  è°ƒç”¨<code>publishProgress(Progress...)</code>åä¼šåœ¨UIçº¿ç¨‹ä¸­æ‰§è¡Œã€‚ç”¨æ¥æ˜¾ç¤ºæ‰§è¡Œä¸­ä»»åŠ¡çš„UIã€‚</li><li><code>onPostExecute(Result)</code> åå°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ—¶è¢«è°ƒç”¨ã€‚æœ€ç»ˆç»“æœä¼šè¢«ä¼ å…¥è¿™ä¸ªæ–¹æ³•ã€‚</li></ul><h3 id="å–æ¶ˆä»»åŠ¡"><a href="#å–æ¶ˆä»»åŠ¡" class="headerlink" title="å–æ¶ˆä»»åŠ¡"></a>å–æ¶ˆä»»åŠ¡</h3><p>è°ƒç”¨<code>cancel(boolean)</code>å¯éšæ—¶å–æ¶ˆä»»åŠ¡ã€‚å–æ¶ˆä»»åŠ¡å<code>isCancelled()</code>ä¼šè¿”å›trueã€‚<br>è°ƒç”¨è¿™ä¸ªæ–¹æ³•åï¼Œåå°ä»»åŠ¡<code>doInBackground(Object[])</code>æ‰§è¡Œå®Œæ¯•åä¼šè°ƒç”¨<code>onCancelled(Object)</code>è€Œä¸å†æ˜¯<code>onPostExecute(Object)</code>ã€‚<br>ä¸ºä¿è¯ä»»åŠ¡èƒ½è¢«åŠæ—¶åœ°å–æ¶ˆï¼Œåœ¨<code>doInBackground(Object[])</code>ä¸­åº”è¯¥ç»å¸¸æ£€æŸ¥<code>isCancelled()</code>è¿”å›å€¼</p><h3 id="çº¿ç¨‹è§„åˆ™-Threading-rules"><a href="#çº¿ç¨‹è§„åˆ™-Threading-rules" class="headerlink" title="çº¿ç¨‹è§„åˆ™ Threading rules"></a>çº¿ç¨‹è§„åˆ™ Threading rules</h3><p>ä¸€äº›çº¿ç¨‹è§„åˆ™</p><ul><li>å¼‚æ­¥ä»»åŠ¡å¿…é¡»ä»UIçº¿ç¨‹å¯åŠ¨</li><li>å¿…é¡»åœ¨UIçº¿ç¨‹å®ä¾‹åŒ–AsyncTaskç±»</li><li>å¿…é¡»åœ¨UIçº¿ç¨‹è°ƒç”¨<code>execute(Params...)</code></li><li>ä¸è¦æ‰‹åŠ¨è°ƒç”¨<code>onPreExecute(), onPostExecute(Result), doInBackground(Params...), onProgressUpdate(Progress...)</code></li><li>åŒä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å®ä¾‹åªèƒ½è¢«æ‰§è¡Œä¸€æ¬¡ã€‚é‡å¤æ‰§è¡ŒåŒä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å®ä¾‹ä¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆ<code>IllegalStateException</code>ï¼‰ã€‚</li></ul><h2 id="æºç ç®€æ"><a href="#æºç ç®€æ" class="headerlink" title="æºç ç®€æ"></a>æºç ç®€æ</h2><p>éœ€è¦è§£å†³çš„é—®é¢˜ï¼š<br>AsyncTaskæ˜¯å¦‚ä½•è°ƒç”¨åå°çº¿ç¨‹å®Œæˆä»»åŠ¡çš„ï¼Ÿçº¿ç¨‹æ˜¯å¦‚ä½•è°ƒåº¦çš„ï¼Ÿ</p><p>AsyncTaskä½¿ç”¨<code>Executor</code>ï¼Œåˆ©ç”¨<code>WorkerRunnable</code>å’Œ<code>FutureTask</code>æ¥æ‰§è¡Œåå°ä»»åŠ¡<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WorkerRunnable&lt;Params, Result&gt; mWorker; <span class="hljs-comment">// å®ç°äº† Callable</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> FutureTask&lt;Result&gt; mFuture;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WorkerRunnable</span>&lt;Params, Result&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Callable</span>&lt;Result&gt; &#123;<br>    Params[] mParams;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>ä½¿ç”¨<code>Handler</code>æ¥è¿›è¡Œçº¿ç¨‹è°ƒåº¦ã€‚å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªç±»<code>InternalHandler</code>ã€‚</p><h3 id="ä»execute-Params-params-æ–¹æ³•åˆ‡å…¥"><a href="#ä»execute-Params-params-æ–¹æ³•åˆ‡å…¥" class="headerlink" title="ä»execute(Params... params)æ–¹æ³•åˆ‡å…¥"></a>ä»<code>execute(Params... params)</code>æ–¹æ³•åˆ‡å…¥</h3><p>å…ˆçœ‹æ–¹æ³•<code>execute(Params... params)</code>ï¼Œä½¿ç”¨é»˜è®¤æ‰§è¡Œå™¨ï¼Œå¹¶ä¼ å…¥å‚æ•°<br>è°ƒç”¨<code>xecuteOnExecutor(Executor exec, Params... params)</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@MainThread</span> <span class="hljs-comment">// æŒ‡å®šåœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> AsyncTask&lt;Params, Progress, Result&gt; <span class="hljs-title function_">execute</span><span class="hljs-params">(Params... params)</span> &#123;<br>    <span class="hljs-keyword">return</span> executeOnExecutor(sDefaultExecutor, params);<br>&#125;<br></code></pre></td></tr></table></figure></p><p>å…ˆåˆ¤æ–­å½“å‰çŠ¶æ€ï¼Œå¦‚æœçŠ¶æ€ä¸æ˜¯<code>Status.PENDING</code>ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚<br>å¦åˆ™è¿›å…¥<code>Status.RUNNING</code>çŠ¶æ€ï¼Œæ‰§è¡Œ<code>onPreExecute()</code>ï¼Œå†ç”±æ‰§è¡Œå™¨å¯åŠ¨ä»»åŠ¡ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@MainThread</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> AsyncTask&lt;Params, Progress, Result&gt; <span class="hljs-title function_">executeOnExecutor</span><span class="hljs-params">(Executor exec,</span><br><span class="hljs-params">        Params... params)</span> &#123;<br>    <span class="hljs-keyword">if</span> (mStatus != Status.PENDING) &#123;<br>        <span class="hljs-keyword">switch</span> (mStatus) &#123;<br>            <span class="hljs-keyword">case</span> RUNNING:<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;Cannot execute task:&quot;</span><br>                        + <span class="hljs-string">&quot; the task is already running.&quot;</span>);<br>            <span class="hljs-keyword">case</span> FINISHED: <span class="hljs-comment">// åŒä¸€ä¸ªä»»åŠ¡å®ä¾‹åªèƒ½å¤Ÿæ‰§è¡Œä¸€æ¬¡</span><br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;Cannot execute task:&quot;</span><br>                        + <span class="hljs-string">&quot; the task has already been executed &quot;</span><br>                        + <span class="hljs-string">&quot;(a task can be executed only once)&quot;</span>);<br>        &#125;<br>    &#125;<br>    mStatus = Status.RUNNING;<br>    onPreExecute();<br>    mWorker.mParams = params;<br>    exec.execute(mFuture); <span class="hljs-comment">// å¼€å§‹è¿›å…¥åå°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><p><code>mWorker</code>å¸¦ç€ä¼ è¿›æ¥çš„å‚æ•°ï¼Œ<code>mFuture</code>å®ä¾‹åŒ–æ—¶å·²ç»å°†<code>mWorker</code>æ³¨å…¥ã€‚å‚çœ‹æ„é€ å‡½æ•°<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">AsyncTask</span><span class="hljs-params">()</span> &#123;<br>    mWorker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WorkerRunnable</span>&lt;Params, Result&gt;() &#123;<br>        <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            mTaskInvoked.set(<span class="hljs-literal">true</span>);<br><br>            Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);<br>            <span class="hljs-comment">// åœ¨åå°çº¿ç¨‹è¿›è¡Œè‡ªå®šä¹‰çš„æ“ä½œ  è¿™é‡Œé¢å¯ä»¥è°ƒç”¨publishProgressæ–¹æ³•</span><br>            <span class="hljs-type">Result</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> doInBackground(mParams); <br>            Binder.flushPendingCommands();<br>            <span class="hljs-keyword">return</span> postResult(result); <span class="hljs-comment">// å‘é€æœ€ç»ˆç»“æœ</span><br>        &#125;<br>    &#125;;<br><br>    mFuture = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;Result&gt;(mWorker) &#123; <span class="hljs-comment">// ä¾èµ– mWorker</span><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">done</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                postResultIfNotInvoked(get());<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                android.util.Log.w(LOG_TAG, e);<br>            &#125; <span class="hljs-keyword">catch</span> (ExecutionException e) &#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;An error occurred while executing doInBackground()&quot;</span>,<br>                        e.getCause());<br>            &#125; <span class="hljs-keyword">catch</span> (CancellationException e) &#123;<br>                postResultIfNotInvoked(<span class="hljs-literal">null</span>);<br>            &#125;<br>        &#125;<br>    &#125;;<br>&#125;<br></code></pre></td></tr></table></figure></p><p><code>publishProgress</code>æ–¹æ³•é€šè¿‡ä¸»çº¿ç¨‹çš„Handlerå‘å¤–é€šçŸ¥è¿›åº¦<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@WorkerThread</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">publishProgress</span><span class="hljs-params">(Progress... values)</span> &#123;<br>    <span class="hljs-keyword">if</span> (!isCancelled()) &#123;<br>        getHandler().obtainMessage(MESSAGE_POST_PROGRESS,<br>                <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncTaskResult</span>&lt;Progress&gt;(<span class="hljs-built_in">this</span>, values)).sendToTarget();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>åå°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œ<code>postResult</code>å‘é€æœ€ç»ˆç»“æœ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Result <span class="hljs-title function_">postResult</span><span class="hljs-params">(Result result)</span> &#123;<br>    <span class="hljs-meta">@SuppressWarnings(&quot;unchecked&quot;)</span><br>    <span class="hljs-type">Message</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> getHandler().obtainMessage(MESSAGE_POST_RESULT,<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncTaskResult</span>&lt;Result&gt;(<span class="hljs-built_in">this</span>, result));<br>    message.sendToTarget(); <span class="hljs-comment">// ä¼šèµ°åˆ°finishæ–¹æ³•</span><br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">finish</span><span class="hljs-params">(Result result)</span> &#123;<br>    <span class="hljs-keyword">if</span> (isCancelled()) &#123;<br>        onCancelled(result); <span class="hljs-comment">// å¦‚æœä»»åŠ¡å·²ç»è¢«å–æ¶ˆäº†</span><br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        onPostExecute(result); <span class="hljs-comment">// é€šçŸ¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•</span><br>    &#125;<br>    mStatus = Status.FINISHED;<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="å…³äºé»˜è®¤æ‰§è¡Œå™¨-sDefaultExecutor-å’Œçº¿ç¨‹æ± "><a href="#å…³äºé»˜è®¤æ‰§è¡Œå™¨-sDefaultExecutor-å’Œçº¿ç¨‹æ± " class="headerlink" title="å…³äºé»˜è®¤æ‰§è¡Œå™¨ sDefaultExecutor å’Œçº¿ç¨‹æ± "></a>å…³äºé»˜è®¤æ‰§è¡Œå™¨ <code>sDefaultExecutor</code> å’Œçº¿ç¨‹æ± </h3><p>æºç ä¸­æ„å»ºäº†ä¸€ä¸ªçº¿ç¨‹æ± å’Œä¸€ä¸ªè‡ªå®šä¹‰çš„æ‰§è¡Œå™¨<code>SerialExecutor</code>ã€‚é å®ƒä»¬æ¥æ‰§è¡Œåå°ä»»åŠ¡ã€‚</p><p>å‚è€ƒæºä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncTask</span>&lt;Params, Progress, Result&gt; &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CPU_COUNT</span> <span class="hljs-operator">=</span> Runtime.getRuntime().availableProcessors();<br>    <span class="hljs-comment">// æ ¸å¿ƒçº¿ç¨‹è‡³å°‘2ä¸ªï¼Œæœ€å¤š4ä¸ª</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">CORE_POOL_SIZE</span> <span class="hljs-operator">=</span> Math.max(<span class="hljs-number">2</span>, Math.min(CPU_COUNT - <span class="hljs-number">1</span>, <span class="hljs-number">4</span>));<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAXIMUM_POOL_SIZE</span> <span class="hljs-operator">=</span> CPU_COUNT * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">KEEP_ALIVE_SECONDS</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Executor</span> <span class="hljs-variable">SERIAL_EXECUTOR</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SerialExecutor</span>();<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">Executor</span> <span class="hljs-variable">sDefaultExecutor</span> <span class="hljs-operator">=</span> SERIAL_EXECUTOR;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ThreadFactory</span> <span class="hljs-variable">sThreadFactory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadFactory</span>() &#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">mCount</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">1</span>);<br><br>        <span class="hljs-keyword">public</span> Thread <span class="hljs-title function_">newThread</span><span class="hljs-params">(Runnable r)</span> &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r, <span class="hljs-string">&quot;AsyncTask #&quot;</span> + mCount.getAndIncrement());<br>        &#125;<br>    &#125;;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> BlockingQueue&lt;Runnable&gt; sPoolWorkQueue =<br>            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;(<span class="hljs-number">128</span>);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Executor THREAD_POOL_EXECUTOR; <span class="hljs-comment">// å®é™…æ‰§è¡Œè€…</span><br><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-type">ThreadPoolExecutor</span> <span class="hljs-variable">threadPoolExecutor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<br>                CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, KEEP_ALIVE_SECONDS, TimeUnit.SECONDS,<br>                sPoolWorkQueue, sThreadFactory);<br>        threadPoolExecutor.allowCoreThreadTimeOut(<span class="hljs-literal">true</span>);<br>        THREAD_POOL_EXECUTOR = threadPoolExecutor;<br>    &#125;<br><br>    <span class="hljs-comment">// é»˜è®¤æ‰§è¡Œå™¨çš„ç±»</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerialExecutor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Executor</span> &#123;<br>        <span class="hljs-keyword">final</span> ArrayDeque&lt;Runnable&gt; mTasks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;Runnable&gt;();<br>        Runnable mActive;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Runnable r)</span> &#123;<br>            mTasks.offer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                    <span class="hljs-keyword">try</span> &#123;<br>                        r.run();<br>                    &#125; <span class="hljs-keyword">finally</span> &#123;<br>                        scheduleNext();<br>                    &#125;<br>                &#125;<br>            &#125;);<br>            <span class="hljs-keyword">if</span> (mActive == <span class="hljs-literal">null</span>) &#123;<br>                scheduleNext();<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scheduleNext</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">if</span> ((mActive = mTasks.poll()) != <span class="hljs-literal">null</span>) &#123;<br>                THREAD_POOL_EXECUTOR.execute(mActive);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Thread</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android IntentService åˆ†æå’Œç”¨æ³•</title>
    <link href="/2017/06/09/Android/Android-IntentService-intro1/"/>
    <url>/2017/06/09/Android/Android-IntentService-intro1/</url>
    
    <content type="html"><![CDATA[<p>IntentServiceçš„åˆ†æå’Œç”¨æ³•ï¼Œå®ç”¨æ€§ä»‹ç»ã€‚</p><h2 id="IntentService-ç®€ä»‹"><a href="#IntentService-ç®€ä»‹" class="headerlink" title="IntentService ç®€ä»‹"></a>IntentService ç®€ä»‹</h2><ul><li>IntentServiceç»§æ‰¿è‡ªServiceï¼Œå¯ç”¨<code>startService</code>å¯åŠ¨ï¼Œä¹Ÿéœ€è¦åœ¨<code>AndroidManifest.xml</code>ä¸­æ³¨å†Œ</li><li>IntentServiceåœ¨ä¸€ä¸ªå•ç‹¬çš„workerçº¿ç¨‹ä¸­å¤„ç†ä»»åŠ¡</li><li>ä»»åŠ¡å®Œæˆåï¼Œä¼šè‡ªåŠ¨åœæ­¢</li><li>å¯å¤šæ¬¡å¯åŠ¨åŒä¸€ä¸ªIntentServiceï¼Œå®ƒä»¬ä¼šè‡ªä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ’é˜Ÿå¤„ç†</li></ul><h2 id="IntentService-ä¸-Service"><a href="#IntentService-ä¸-Service" class="headerlink" title="IntentService ä¸ Service"></a>IntentService ä¸ Service</h2><p>è€—æ—¶ä»»åŠ¡å¯ä»¥ä¸ç”¨åœ¨Serviceä¸­æ‰‹åŠ¨å¼€å¯çº¿ç¨‹ã€‚<br>å½“æ“ä½œå®Œæˆæ—¶ï¼Œæˆ‘ä»¬ä¸ç”¨æ‰‹åŠ¨åœæ­¢IntentServiceï¼Œå®ƒä¼šè‡ªåŠ¨åˆ¤å®šåœæ­¢ã€‚  </p><h3 id="IntentService-è‡ªåŠ¨åœæ­¢"><a href="#IntentService-è‡ªåŠ¨åœæ­¢" class="headerlink" title="IntentService è‡ªåŠ¨åœæ­¢"></a>IntentService è‡ªåŠ¨åœæ­¢</h3><p>å‚è€ƒIntentServiceæºç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> ServiceHandler mServiceHandler;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ServiceHandler</span><span class="hljs-params">(Looper looper)</span> &#123;<br>        <span class="hljs-built_in">super</span>(looper);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> &#123;<br>        onHandleIntent((Intent)msg.obj);<br>        stopSelf(msg.arg1); <span class="hljs-comment">// ä¼ å…¥startID</span><br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-built_in">super</span>.onCreate();<br>    <span class="hljs-type">HandlerThread</span> <span class="hljs-variable">thread</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HandlerThread</span>(<span class="hljs-string">&quot;IntentService[&quot;</span> + mName + <span class="hljs-string">&quot;]&quot;</span>);<br>    thread.start();<br><br>    mServiceLooper = thread.getLooper();<br>    mServiceHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceHandler</span>(mServiceLooper);<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onStart</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Intent intent, <span class="hljs-type">int</span> startId)</span> &#123;<br>    <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> mServiceHandler.obtainMessage();<br>    msg.arg1 = startId; <span class="hljs-comment">// è¿™ä¸ªæ˜¯åœæ­¢æœåŠ¡çš„ä¾æ®</span><br>    msg.obj = intent;<br>    mServiceHandler.sendMessage(msg);<br>&#125;<br></code></pre></td></tr></table></figure><br>åˆ©ç”¨<code>ServiceHandler</code>æ¥æ§åˆ¶ç”Ÿå‘½å‘¨æœŸã€‚onCreateæ–¹æ³•ä¸­å¼€å¯äº†ä¸€ä¸ª<code>HandlerThread</code>æ¥å¤„ç†è¯·æ±‚ã€‚<br>åœ¨<code>onStart</code>ä¸­è·å–åˆ°<code>startId</code>ã€‚åœ¨<code>ServiceHandler</code>ä¸­æ¯æ¬¡å¤„ç†å®Œä¸€ä¸ªå‘½ä»¤éƒ½ä¼šè°ƒç”¨<code>stopSelf(int startId)</code>æ–¹æ³•æ¥åœæ­¢æœåŠ¡ã€‚<br>IntentServiceç›´åˆ°å‘½ä»¤é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å‘½ä»¤è¢«æ‰§è¡Œå®Œåæ‰ä¼šåœæ­¢æœåŠ¡ã€‚</p><h2 id="ç”¨æ³•ç¤ºä¾‹"><a href="#ç”¨æ³•ç¤ºä¾‹" class="headerlink" title="ç”¨æ³•ç¤ºä¾‹"></a>ç”¨æ³•ç¤ºä¾‹</h2><p>æ–°å»ºä¸€ä¸ªæ¨¡æ‹Ÿè®¡ç®—çš„åå°æœåŠ¡<code>CalIntentService</code>ç»§æ‰¿<code>IntentService</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * æ¨¡æ‹Ÿè®¡ç®—çš„åå°æœåŠ¡</span><br><span class="hljs-comment"> * Created by Rust on 2017/6/9.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CalIntentService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IntentService</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;rustApp&quot;</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">mStartId</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¸€å®šè¦ä¸€ä¸ªæ— å‚æ„é€ å™¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CalIntentService</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">this</span>(<span class="hljs-string">&quot;cal_intent_service_name&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * Creates an IntentService.  Invoked by your subclass&#x27;s constructor.</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> name Used to name the worker thread, important only for debugging.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CalIntentService</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">super</span>(name);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onStart</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Intent intent, <span class="hljs-type">int</span> startId)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onStart(intent, startId);<br>        mStartId = startId;<br>        Log.d(TAG, <span class="hljs-string">&quot;[CalIntentService] onStart, startId=&quot;</span> + mStartId); <span class="hljs-comment">// å¤å†™è¿™ä¸ªæ–¹æ³•æ¥çœ‹startId</span><br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-built_in">super</span>.onDestroy(); <span class="hljs-comment">// è§‚å¯Ÿç”Ÿå‘½å‘¨æœŸ</span><br>        Log.d(TAG, <span class="hljs-string">&quot;[CalIntentService] onDestroy. StartId=&quot;</span> + mStartId);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onHandleIntent</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> Intent intent)</span> &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != intent) &#123;<br>            <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> intent.getStringExtra(<span class="hljs-string">&quot;name&quot;</span>);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> intent.getStringExtra(<span class="hljs-string">&quot;msg&quot;</span>);<br>            Log.d(TAG, <span class="hljs-string">&quot;[CalIntentService] æ”¶åˆ° name:&quot;</span> + name + <span class="hljs-string">&quot;, msg:&quot;</span> + msg + <span class="hljs-string">&quot;, at &quot;</span><br>                    + Thread.currentThread().toString());<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            Thread.sleep(<span class="hljs-number">1000</span>); <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        Log.d(TAG, <span class="hljs-string">&quot;[CalIntentService] è®¡ç®—ç»“æŸ.  mStartId=&quot;</span> + mStartId);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></p><p>AndroidManifestä¸­æ³¨å†Œè¿™ä¸ªæœåŠ¡ã€‚ç›®å‰åªå…è®¸æœ¬Appä½¿ç”¨<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">service</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;com.rustfisher.service.CalIntentService&quot;</span></span><br><span class="hljs-tag">    <span class="hljs-attr">android:exported</span>=<span class="hljs-string">&quot;false&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure></p><p>Activityä¸­å¯åŠ¨è¿™ä¸ªæœåŠ¡<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">btn2.setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">calIntent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(getApplicationContext(), CalIntentService.class);<br>        calIntent.putExtra(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;Rust&quot;</span>);<br>        calIntent.putExtra(<span class="hljs-string">&quot;msg&quot;</span>, <span class="hljs-string">&quot;Click event: &quot;</span> + mClickCount++);<br>        startService(calIntent);<br>    &#125;<br>&#125;);<br></code></pre></td></tr></table></figure></p><p>åœ¨æ‰‹æœºä¸Šè¿è¡Œï¼Œå¿«é€Ÿç‚¹å‡»å‡ æ¬¡æŒ‰é’®ï¼Œå¯åŠ¨IntentServiceï¼Œlogcatè¾“å‡º<br><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs inform7"><span class="hljs-comment">[CalIntentService]</span> onStart, startId=1<br><span class="hljs-comment">[CalIntentService]</span> æ”¶åˆ° name:Rust, msg:Click event: 0, at Thread<span class="hljs-comment">[IntentService<span class="hljs-comment">[cal_intent_service_name]</span>,5,main]</span><br><span class="hljs-comment">[CalIntentService]</span> onStart, startId=2<br><span class="hljs-comment">[CalIntentService]</span> onStart, startId=3<br><span class="hljs-comment">[CalIntentService]</span> onStart, startId=4<br><span class="hljs-comment">[CalIntentService]</span> è®¡ç®—ç»“æŸ.  æœ€æ–°StartId=4<br><span class="hljs-comment">[CalIntentService]</span> æ”¶åˆ° name:Rust, msg:Click event: 1, at Thread<span class="hljs-comment">[IntentService<span class="hljs-comment">[cal_intent_service_name]</span>,5,main]</span><br><span class="hljs-comment">[CalIntentService]</span> è®¡ç®—ç»“æŸ.  æœ€æ–°StartId=4<br><span class="hljs-comment">[CalIntentService]</span> æ”¶åˆ° name:Rust, msg:Click event: 2, at Thread<span class="hljs-comment">[IntentService<span class="hljs-comment">[cal_intent_service_name]</span>,5,main]</span><br><span class="hljs-comment">[CalIntentService]</span> è®¡ç®—ç»“æŸ.  æœ€æ–°StartId=4<br><span class="hljs-comment">[CalIntentService]</span> æ”¶åˆ° name:Rust, msg:Click event: 3, at Thread<span class="hljs-comment">[IntentService<span class="hljs-comment">[cal_intent_service_name]</span>,5,main]</span><br><span class="hljs-comment">[CalIntentService]</span> è®¡ç®—ç»“æŸ.  æœ€æ–°StartId=4<br><span class="hljs-comment">[CalIntentService]</span> onDestroy. StartId=4<br></code></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹å‡ºï¼Œå…ˆæ‰§è¡Œ<code>onStart</code>ï¼Œç„¶åæ’é˜Ÿæ‰§è¡Œ<code>onHandleIntent</code>ã€‚ä»»åŠ¡å…¨éƒ¨ç»“æŸåè‡ªè¡Œåœæ­¢ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android_service</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android Handlerï¼ŒLooper ä¸ MessageQueue ä½¿ç”¨ä¸åˆ†æ</title>
    <link href="/2017/06/07/Android/Android-Handler_src_note/"/>
    <url>/2017/06/07/Android/Android-Handler_src_note/</url>
    
    <content type="html"><![CDATA[<h2 id="Handler-ç®€ä»‹"><a href="#Handler-ç®€ä»‹" class="headerlink" title="Handler ç®€ä»‹"></a>Handler ç®€ä»‹</h2><p>ä¸€ä¸ªHandlerå…è®¸å‘é€å’Œå¤„ç†Messageï¼Œé€šè¿‡å…³è”çº¿ç¨‹çš„ MessageQueue æ‰§è¡Œ Runnable å¯¹è±¡ã€‚<br>æ¯ä¸ªHandlerå®ä¾‹éƒ½å’Œä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹åŠå…¶æ¶ˆæ¯é˜Ÿåˆ—ç»‘å®šã€‚<br>å¯ä»¥å°†ä¸€ä¸ªä»»åŠ¡åˆ‡æ¢åˆ°Handleræ‰€åœ¨çš„çº¿ç¨‹ä¸­å»æ‰§è¡Œã€‚ä¸€ä¸ªç”¨æ³•å°±æ˜¯å­çº¿ç¨‹é€šè¿‡Handleræ›´æ–°UIã€‚</p><p>Handlerä¸»è¦æœ‰2ç§ç”¨æ³•ï¼š</p><ul><li>åšå‡ºè®¡åˆ’ï¼Œåœ¨æœªæ¥æŸä¸ªæ—¶é—´ç‚¹æ‰§è¡Œæ¶ˆæ¯å’ŒRunnable</li><li>çº¿ç¨‹è°ƒåº¦ï¼Œåœ¨å…¶ä»–çº¿ç¨‹è§„åˆ’å¹¶æ‰§è¡Œä»»åŠ¡</li></ul><p>è¦ä½¿ç”¨å¥½Handlerï¼Œéœ€è¦äº†è§£ä¸å…¶ç›¸å…³çš„ <code>MessageQueue</code>ï¼Œ <code>Message</code>å’Œ<code>Looper</code>ï¼›ä¸èƒ½å­¤ç«‹çš„çœ‹Handlerã€‚<br>Handlerå°±åƒä¸€ä¸ªæ“ä½œè€…ï¼ˆæˆ–è€…åƒä¸€ä¸ªå¯¹å¼€å‘è€…å¼€æ”¾çš„çª—å£ï¼‰ï¼Œåˆ©ç”¨<code>MessageQueue</code>å’Œ<code>Looper</code>æ¥å®ç°ä»»åŠ¡è°ƒåº¦å’Œå¤„ç†ã€‚  </p><p><strong>HandleræŒæœ‰ Looper çš„å®ä¾‹ï¼Œç›´æ¥æŒæœ‰looperçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</strong></p><h3 id="å±æ€§ä¸æ„é€ å™¨"><a href="#å±æ€§ä¸æ„é€ å™¨" class="headerlink" title="å±æ€§ä¸æ„é€ å™¨"></a>å±æ€§ä¸æ„é€ å™¨</h3><p>Handlerç±»ä¸­æŒæœ‰çš„å®ä¾‹ï¼ŒæŒæœ‰looperï¼ŒmessageQueueç­‰ç­‰ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">final</span> Looper mLooper; <span class="hljs-comment">// HandleræŒæœ‰Looperå®ä¾‹</span><br><span class="hljs-keyword">final</span> MessageQueue mQueue; <span class="hljs-comment">// HandleræŒæœ‰æ¶ˆæ¯é˜Ÿåˆ—</span><br><span class="hljs-keyword">final</span> Callback mCallback;<br></code></pre></td></tr></table></figure></p><p>åœ¨Handlerçš„æ„é€ å™¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Handlerè·å–äº†Looperçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">Handler</span><span class="hljs-params">(Callback callback, <span class="hljs-type">boolean</span> async)</span> &#123;<br>    <span class="hljs-comment">// å¤„ç†å¼‚å¸¸</span><br>    mLooper = Looper.myLooper();<br>    <span class="hljs-comment">// å¤„ç†ç‰¹æ®Šæƒ…å†µ...</span><br>    mQueue = mLooper.mQueue; <span class="hljs-comment">// è·å–çš„æ˜¯Looperçš„æ¶ˆæ¯é˜Ÿåˆ—</span><br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">Handler</span><span class="hljs-params">(Looper looper, Callback callback, <span class="hljs-type">boolean</span> async)</span> &#123;<br>    mLooper = looper;<br>    mQueue = looper.mQueue; <span class="hljs-comment">// è·å–çš„æ˜¯Looperçš„æ¶ˆæ¯é˜Ÿåˆ—</span><br>    mCallback = callback;<br>    mAsynchronous = async;<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="Handlerçš„ä½¿ç”¨æ–¹æ³•"><a href="#Handlerçš„ä½¿ç”¨æ–¹æ³•" class="headerlink" title="Handlerçš„ä½¿ç”¨æ–¹æ³•"></a>Handlerçš„ä½¿ç”¨æ–¹æ³•</h3><p>Handlerå‘é€å’Œå¤„ç†æ¶ˆæ¯çš„å‡ ä¸ªæ–¹æ³•</p><ul><li>void handleMessage( Message  msg):å¤„ç†æ¶ˆæ¯çš„æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é€šå¸¸è¢«é‡å†™ã€‚</li><li>final boolean hasMessage(int  what):æ£€æŸ¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ˜¯å¦åŒ…å«æœ‰whatå±æ€§ä¸ºæŒ‡å®šå€¼çš„æ¶ˆæ¯</li><li>final boolean hasMessage(int what ,Object object) :æ£€æŸ¥æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ˜¯å¦åŒ…å«æœ‰whatå¥½objectå±æ€§æŒ‡å®šå€¼çš„æ¶ˆæ¯</li><li>sendEmptyMessage(int what):å‘é€ç©ºæ¶ˆæ¯</li><li>final Boolean send EmptyMessageDelayed(int what ,long delayMillis):æŒ‡å®šå¤šå°‘æ¯«ç§’å‘é€ç©ºæ¶ˆæ¯</li><li>final  boolean sendMessage(Message msg):ç«‹å³å‘é€æ¶ˆæ¯</li><li>final boolean sendMessageDelayed(Message msg,long delayMillis):å¤šå°‘ç§’ä¹‹åå‘é€æ¶ˆæ¯</li></ul><h4 id="Handler-sendEmptyMessage-int-what-æµç¨‹è§£æ"><a href="#Handler-sendEmptyMessage-int-what-æµç¨‹è§£æ" class="headerlink" title="Handler.sendEmptyMessage(int what) æµç¨‹è§£æ"></a>Handler.sendEmptyMessage(int what) æµç¨‹è§£æ</h4><p>è·å–ä¸€ä¸ªMessageå®ä¾‹ï¼Œå¹¶ç«‹å³å°†Messageå®ä¾‹æ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­å»ã€‚<br>ç®€è¦æµç¨‹å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ç«‹åˆ»å‘é€ä¸€ä¸ªemptyæ¶ˆæ¯</span><br>sendEmptyMessage(<span class="hljs-type">int</span> what) <br><br><span class="hljs-comment">// å‘é€å»¶è¿Ÿä¸º0çš„emptyæ¶ˆæ¯  è¿™ä¸ªæ–¹æ³•é‡Œé€šè¿‡Message.obtain()è·å–ä¸€ä¸ªMessageå®ä¾‹</span><br>sendEmptyMessageDelayed(what, <span class="hljs-number">0</span>) <br><br><span class="hljs-comment">// è®¡ç®—æ¶ˆæ¯çš„è®¡åˆ’æ‰§è¡Œæ—¶é—´ï¼Œè¿›å…¥ä¸‹ä¸€é˜¶æ®µ</span><br>sendMessageDelayed(Message msg, <span class="hljs-type">long</span> delayMillis)<br><br><span class="hljs-comment">// åœ¨è¿™é‡Œåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºnull  è‹¥ä¸ºnullåˆ™ç›´æ¥è¿”å›false</span><br>sendMessageAtTime(Message msg, <span class="hljs-type">long</span> uptimeMillis)<br><br><span class="hljs-comment">// å°†æ¶ˆæ¯æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­</span><br>enqueueMessage(MessageQueue queue, Message msg, <span class="hljs-type">long</span> uptimeMillis)<br><br><span class="hljs-comment">// æ¥ä¸‹æ¥æ˜¯MessageQueueæ·»åŠ æ¶ˆæ¯</span><br><span class="hljs-comment">// MessageQueue.java</span><br><span class="hljs-type">boolean</span> <span class="hljs-title function_">enqueueMessage</span><span class="hljs-params">(Message msg, <span class="hljs-type">long</span> when)</span><br></code></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°ï¼Œæœ€åæ˜¯æŠŠmessageæ·»åŠ åˆ°äº†messageQueueä¸­ã€‚</p><h4 id="Handler-å–æ¶ˆä»»åŠ¡"><a href="#Handler-å–æ¶ˆä»»åŠ¡" class="headerlink" title="Handler å–æ¶ˆä»»åŠ¡"></a>Handler å–æ¶ˆä»»åŠ¡</h4><p>è¦å–æ¶ˆä»»åŠ¡æ—¶ï¼Œè°ƒç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•<code>removeCallbacksAndMessages(Object token)</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeCallbacksAndMessages</span><span class="hljs-params">(Object token)</span> &#123;<br>    mQueue.removeCallbacksAndMessages(<span class="hljs-built_in">this</span>, token);<br>&#125;<br></code></pre></td></tr></table></figure><br>é€šè¿‡è°ƒç”¨<code>Message.recycleUnchecked()</code>æ–¹æ³•ï¼Œå–æ¶ˆæ‰ä¸æ­¤Handlerç›¸å…³è”çš„Messageã€‚</p><p>ç›¸å…³çš„æ¶ˆæ¯é˜Ÿåˆ—ä¼šæ‰§è¡Œå–æ¶ˆæŒ‡ä»¤<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">void</span> <span class="hljs-title function_">removeCallbacksAndMessages</span><span class="hljs-params">(Handler h, Object object)</span><br></code></pre></td></tr></table></figure></p><h3 id="æ¶ˆæ¯é©±åŠ¨ä¸Handler"><a href="#æ¶ˆæ¯é©±åŠ¨ä¸Handler" class="headerlink" title="æ¶ˆæ¯é©±åŠ¨ä¸Handler"></a>æ¶ˆæ¯é©±åŠ¨ä¸Handler</h3><p>Androidæ˜¯æ¶ˆæ¯é©±åŠ¨çš„ï¼Œå®ç°æ¶ˆæ¯é©±åŠ¨æœ‰å‡ ä¸ªè¦ç´ </p><ul><li>æ¶ˆæ¯çš„è¡¨ç¤ºï¼šMessage</li><li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šMessageQueue</li><li>æ¶ˆæ¯å¾ªç¯ï¼Œç”¨äºå¾ªç¯å–å‡ºæ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼šLooper</li><li>æ¶ˆæ¯å¤„ç†ï¼Œæ¶ˆæ¯å¾ªç¯ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–å‡ºæ¶ˆæ¯åè¦å¯¹æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼šHandler</li></ul><h4 id="åˆå§‹åŒ–æ¶ˆæ¯é˜Ÿåˆ—"><a href="#åˆå§‹åŒ–æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="åˆå§‹åŒ–æ¶ˆæ¯é˜Ÿåˆ—"></a>åˆå§‹åŒ–æ¶ˆæ¯é˜Ÿåˆ—</h4><p>åœ¨Looperæ„é€ å™¨ä¸­å³åˆ›å»ºäº†ä¸€ä¸ªMessageQueueï¼Œ<strong>LooperæŒæœ‰æ¶ˆæ¯é˜Ÿåˆ—çš„å®ä¾‹</strong>ã€‚</p><h4 id="å‘é€æ¶ˆæ¯"><a href="#å‘é€æ¶ˆæ¯" class="headerlink" title="å‘é€æ¶ˆæ¯"></a>å‘é€æ¶ˆæ¯</h4><p>é€šè¿‡Looper.prepareåˆå§‹åŒ–å¥½æ¶ˆæ¯é˜Ÿåˆ—åå°±å¯ä»¥è°ƒç”¨Looper.loopè¿›å…¥æ¶ˆæ¯å¾ªç¯äº†ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥å‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼Œ<br>æ¶ˆæ¯å¾ªç¯å°±ä¼šå–å‡ºæ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œåœ¨çœ‹æ¶ˆæ¯å¤„ç†ä¹‹å‰ï¼Œå…ˆçœ‹ä¸€ä¸‹æ¶ˆæ¯æ˜¯æ€ä¹ˆè¢«æ·»åŠ åˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„ã€‚</p><h4 id="æ¶ˆæ¯å¾ªç¯"><a href="#æ¶ˆæ¯å¾ªç¯" class="headerlink" title="æ¶ˆæ¯å¾ªç¯"></a>æ¶ˆæ¯å¾ªç¯</h4><p>Javaå±‚çš„æ¶ˆæ¯éƒ½ä¿å­˜åœ¨äº†Javaå±‚MessageQueueçš„æˆå‘˜mMessagesä¸­ï¼ŒNativeå±‚çš„æ¶ˆæ¯éƒ½ä¿å­˜åœ¨äº†Native Looperçš„<br>mMessageEnvelopesä¸­ï¼Œè¿™å°±å¯ä»¥è¯´æœ‰ä¸¤ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œä¸”éƒ½æ˜¯æŒ‰æ—¶é—´æ’åˆ—çš„ã€‚</p><h2 id="Message-å’Œ-MessageQueue-ç®€ä»‹"><a href="#Message-å’Œ-MessageQueue-ç®€ä»‹" class="headerlink" title="Message å’Œ MessageQueue ç®€ä»‹"></a>Message å’Œ MessageQueue ç®€ä»‹</h2><p>ä¸Handlerå·¥ä½œçš„å‡ ä¸ªç»„ä»¶Looperã€MessageQueueå„è‡ªçš„ä½œç”¨ï¼š</p><ul><li>1.Handlerï¼šå®ƒæŠŠæ¶ˆæ¯å‘é€ç»™Looperç®¡ç†çš„MessageQueue,å¹¶è´Ÿè´£å¤„ç†Looperåˆ†ç»™å®ƒçš„æ¶ˆæ¯</li><li>2.MessageQueueï¼šç®¡ç†Messageï¼Œç”±Looperç®¡ç†</li><li>3.Looperï¼šæ¯ä¸ªçº¿ç¨‹åªæœ‰ä¸€ä¸ªLooperï¼Œæ¯”å¦‚UIçº¿ç¨‹ä¸­ï¼Œç³»ç»Ÿä¼šé»˜è®¤çš„åˆå§‹åŒ–ä¸€ä¸ªLooperå¯¹è±¡ï¼Œå®ƒè´Ÿè´£ç®¡ç†MessageQueueï¼Œä¸æ–­çš„ä»MessageQueueä¸­å–æ¶ˆæ¯ï¼Œå¹¶å°†ç›¸å¯¹åº”çš„æ¶ˆæ¯åˆ†ç»™Handlerå¤„ç†ã€‚</li></ul><h3 id="Message"><a href="#Message" class="headerlink" title="Message"></a>Message</h3><p>Message å±äºè¢«ä¼ é€’ï¼Œè¢«ä½¿ç”¨çš„è§’è‰²ã€‚Message æ˜¯åŒ…å«æè¿°å’Œä»»æ„æ•°æ®å¯¹è±¡çš„â€œæ¶ˆæ¯â€ï¼Œèƒ½è¢«å‘é€ç»™<code>Handler</code>ã€‚MessageåŒ…å«2ä¸ªintå±æ€§å’Œä¸€ä¸ªé¢å¤–çš„å¯¹è±¡ã€‚<br>è™½ç„¶æ„é€ å™¨æ˜¯å…¬å¼€çš„ï¼Œä½†è·å–å®ä¾‹æœ€å¥½çš„åŠæ³•æ˜¯è°ƒç”¨<code>Message.obtain()</code>æˆ–<code>Handler.obtainMessage()</code>ã€‚è¿™æ ·å¯ä»¥ä»ä»–ä»¬çš„å¯å›æ”¶å¯¹è±¡æ± ä¸­è·å–åˆ°æ¶ˆæ¯å®ä¾‹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ¯ä¸ªMessageå®ä¾‹æŒæœ‰ä¸€ä¸ªHandlerã€‚</p><p>Messageéƒ¨åˆ†å±æ€§å€¼<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/*package*/</span> Handler target; <span class="hljs-comment">// æŒ‡å®šçš„Handler</span><br><br><span class="hljs-comment">/*package*/</span> Runnable callback;<br><br><span class="hljs-comment">// å¯ä»¥ç»„æˆé“¾è¡¨</span><br><span class="hljs-comment">// sometimes we store linked lists of these things</span><br><span class="hljs-comment">/*package*/</span> Message next;<br></code></pre></td></tr></table></figure><br>ä»è¿™é‡Œä¹Ÿä¸éš¾çœ‹å‡ºï¼Œæ¯ä¸ªMessageéƒ½æŒæœ‰Handlerå®ä¾‹ã€‚å¦‚æœHandleræŒæœ‰Activityçš„å¼•ç”¨ï¼ŒActivity onDestroyåMessageå´ä»ç„¶åœ¨é˜Ÿåˆ—ä¸­ï¼Œå› ä¸ºHandlerä¸Activityçš„å¼ºå…³è”ï¼Œä¼šé€ æˆActivityæ— æ³•è¢«GCå›æ”¶ï¼Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚<br>å› æ­¤åœ¨Activity onDestroy æ—¶ï¼Œä¸Activityå…³è”çš„Handleråº”æ¸…é™¤å®ƒçš„é˜Ÿåˆ—ç”±Activityäº§ç”Ÿçš„ä»»åŠ¡ï¼Œé¿å…å†…å­˜æ³„éœ²ã€‚</p><p>é‡ç½®è‡ªèº«çš„æ–¹æ³•ï¼Œå°†å±æ€§å…¨éƒ¨é‡ç½®<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recycle</span><span class="hljs-params">()</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">recycleUnchecked</span><span class="hljs-params">()</span><br></code></pre></td></tr></table></figure></p><p>è·å–Messageå®ä¾‹çš„å¸¸ç”¨æ–¹æ³•ï¼Œå¾—åˆ°çš„å®ä¾‹ä¸ä¼ å…¥çš„Handlerç»‘å®š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Same as &#123;<span class="hljs-doctag">@link</span> #obtain()&#125;, but sets the value for the &lt;em&gt;target&lt;/em&gt; member on the Message returned.</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> h  Handler to assign to the returned Message object&#x27;s &lt;em&gt;target&lt;/em&gt; member.</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> A Message object from the global pool.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Message <span class="hljs-title function_">obtain</span><span class="hljs-params">(Handler h)</span> &#123;<br>    <span class="hljs-type">Message</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> obtain();<br>    m.target = h;<br><br>    <span class="hljs-keyword">return</span> m;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>å°†æ¶ˆæ¯å‘é€ç»™Handler<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Sends this Message to the Handler specified by &#123;<span class="hljs-doctag">@link</span> #getTarget&#125;.</span><br><span class="hljs-comment"> * Throws a null pointer exception if this field has not been set.</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendToTarget</span><span class="hljs-params">()</span> &#123;<br>    target.sendMessage(<span class="hljs-built_in">this</span>); <span class="hljs-comment">// target å°±æ˜¯ä¸æ¶ˆæ¯ç»‘å®šçš„Handler</span><br>&#125;<br></code></pre></td></tr></table></figure><br>è°ƒç”¨è¿™ä¸ªæ–¹æ³•åï¼ŒHandlerä¼šå°†æ¶ˆæ¯æ·»åŠ è¿›å®ƒçš„æ¶ˆæ¯é˜Ÿåˆ—<code>MessageQueue</code>ä¸­ã€‚</p><h3 id="MessageQueue"><a href="#MessageQueue" class="headerlink" title="MessageQueue"></a>MessageQueue</h3><p>æŒæœ‰ä¸€åˆ—å¯ä»¥è¢«Looperåˆ†å‘çš„Messageã€‚ä¸€èˆ¬æ¥è¯´ç”±Handlerå°†Messageæ·»åŠ åˆ°MessageQueueä¸­ã€‚<br>è·å–å½“å‰çº¿ç¨‹çš„MessageQueueæ–¹æ³•æ˜¯<code>Looper.myQueue()</code>ã€‚é€šè¿‡<code>Looper.getMainLooper()</code>è·å–åˆ°ä¸»çº¿ç¨‹çš„looperã€‚</p><h2 id="Looper-ç®€ä»‹"><a href="#Looper-ç®€ä»‹" class="headerlink" title="Looper ç®€ä»‹"></a>Looper ç®€ä»‹</h2><p>Looperä¸MessageQueueç´§å¯†å…³è”ã€‚åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œçš„æ¶ˆæ¯å¾ªç¯ã€‚çº¿ç¨‹é»˜è®¤æƒ…å†µä¸‹æ˜¯æ²¡æœ‰ä¸ä¹‹ç®¡ç†çš„æ¶ˆæ¯å¾ªç¯çš„ã€‚<br>è¦åˆ›å»ºä¸€ä¸ªæ¶ˆæ¯å¾ªç¯ï¼Œåœ¨çº¿ç¨‹ä¸­è°ƒç”¨prepareï¼Œç„¶åè°ƒç”¨loopã€‚å³å¼€å§‹å¤„ç†æ¶ˆæ¯ï¼Œç›´åˆ°å¾ªç¯åœæ­¢ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹é€šè¿‡Handleræ¥ä¸æ¶ˆæ¯å¾ªç¯äº’åŠ¨ã€‚</p><p>Handlerä¸Looperåœ¨çº¿ç¨‹ä¸­äº¤äº’çš„å…¸å‹ä¾‹å­<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LooperThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> &#123;<br>    <span class="hljs-keyword">public</span> Handler mHandler;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        Looper.prepare(); <span class="hljs-comment">// ä¸ºå½“å‰çº¿ç¨‹å‡†å¤‡ä¸€ä¸ªLooper</span><br>        <span class="hljs-comment">// åˆ›å»ºHandlerå®ä¾‹ï¼ŒHandlerä¼šè·å–å½“å‰çº¿ç¨‹çš„Looper</span><br>        <span class="hljs-comment">// å¦‚æœå®ä¾‹åŒ–Handleræ—¶å½“å‰çº¿ç¨‹æ²¡æœ‰Looperï¼Œä¼šæŠ¥å¼‚å¸¸ RuntimeException</span><br>        mHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>() &#123;<br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> &#123;<br>                <span class="hljs-comment">// process incoming messages here</span><br>            &#125;<br>        &#125;;<br>        Looper.loop(); <span class="hljs-comment">// Looperå¼€å§‹è¿è¡Œ</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>è°ƒç”¨äº†<code>Looper.loop()</code>ä¹‹åï¼Œlooperå¼€å§‹è¿è¡Œã€‚å½“looperçš„messageQueueä¸­æ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œç›¸å…³çš„çº¿ç¨‹å¤„äºä»€ä¹ˆçŠ¶æ€å‘¢ï¼Ÿ<br>æŸ¥çœ‹looperçš„æºç ï¼Œçœ‹åˆ°loopæ–¹æ³•é‡Œé¢æœ‰ä¸€ä¸ªæ­»å¾ªç¯ã€‚queue.next()æ–¹æ³•æ˜¯å¯èƒ½ä¼šé˜»å¡çº¿ç¨‹çš„ã€‚å¦‚æœä»queueä¸­è·å–åˆ°nullï¼Œåˆ™è¡¨æ˜æ­¤æ¶ˆæ¯é˜Ÿåˆ—æ­£åœ¨é€€å‡ºã€‚æ­¤æ—¶looperçš„æ­»å¾ªç¯ä¹Ÿä¼šè¢«è¿”å›ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span> (;;) &#123;<br>    <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> queue.next(); <span class="hljs-comment">// might block</span><br>    <span class="hljs-keyword">if</span> (msg == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// No message indicates that the message queue is quitting.</span><br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><br>è°ƒç”¨looperçš„quitæ–¹æ³•ï¼Œå®é™…ä¸Šè°ƒç”¨äº†<code>mQueue.quit(false)</code>ã€‚æ¶ˆæ¯é˜Ÿåˆ—é€€å‡ºåï¼Œlooperçš„loopæ­»å¾ªç¯ä¹Ÿè¢«é€€å‡ºäº†ã€‚</p><p>è¿›å…¥MessageQueueçš„nextæ–¹æ³•å»çœ‹ï¼Œå‘ç°é‡Œé¢ä¹Ÿæœ‰ä¸€ä¸ªæ­»å¾ªç¯ã€‚æ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œè¿™ä¸ªæ­»å¾ªç¯ä¼šé˜»å¡åœ¨<code>nativePollOnce</code>è¿™ä¸ªæ–¹æ³•ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Message <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-keyword">for</span> (;;) &#123;<br>        <span class="hljs-comment">// ...</span><br>        nativePollOnce(ptr, nextPollTimeoutMillis);<br>        <span class="hljs-comment">// å¤„ç†messageå¯¹è±¡</span><br></code></pre></td></tr></table></figure></p><p>æˆ‘ä»¬çŸ¥é“Threadæœ‰Newï¼ˆæ–°å»ºï¼Œæœªè¿è¡Œï¼‰ï¼ŒRUNNABLEï¼ˆæ­£å¸¸è¿è¡Œï¼‰ï¼ŒBLOCKEDï¼ŒWAITINGï¼ˆçº¿ç¨‹æ‹¥æœ‰äº†æŸä¸ªé”ä¹‹å, è°ƒç”¨äº†ä»–çš„waitæ–¹æ³•, ç­‰å¾…å…¶ä»–çº¿ç¨‹/é”æ‹¥æœ‰è€…è°ƒç”¨ notify / notifyAllï¼‰ï¼ŒTIMED_WAITINGï¼ŒTERMINATEDï¼ˆå·²ç»æ‰§è¡Œå®Œæ¯•ï¼‰è¿™å‡ ç§çŠ¶æ€ã€‚æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯ï¼Œåœ¨nativePollOnceæ–¹æ³•ä¸­â€œç­‰å¾…â€ã€‚ç›¸å…³çº¿ç¨‹åˆ™å¤„äºRUNNABLEçŠ¶æ€ã€‚</p><p>å‚è€ƒï¼š<a href="https://stackoverflow.com/questions/38818642/android-what-is-message-queue-native-poll-once-in-android">https://stackoverflow.com/questions/38818642/android-what-is-message-queue-native-poll-once-in-android</a></p><h3 id="Looperä¸­çš„å±æ€§"><a href="#Looperä¸­çš„å±æ€§" class="headerlink" title="Looperä¸­çš„å±æ€§"></a>Looperä¸­çš„å±æ€§</h3><p>LooperæŒæœ‰MessageQueueï¼›å”¯ä¸€çš„ä¸»çº¿ç¨‹Looper <code>sMainLooper</code>ï¼›Looperå½“å‰çº¿ç¨‹ <code>mThread</code>ï¼›<br>å­˜å‚¨Looperçš„<code>sThreadLocal</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// sThreadLocal.get() will return null unless you&#x27;ve called prepare().</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;Looper&gt; sThreadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;Looper&gt;();<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Looper sMainLooper;  <span class="hljs-comment">// guarded by Looper.class</span><br><br><span class="hljs-keyword">final</span> MessageQueue mQueue; <span class="hljs-comment">// Handlerä¼šè·å–è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å®ä¾‹ï¼ˆå‚è€ƒHandleræ„é€ å™¨ï¼‰</span><br><span class="hljs-keyword">final</span> Thread mThread; <span class="hljs-comment">// Looperå½“å‰çº¿ç¨‹</span><br></code></pre></td></tr></table></figure></p><p>ThreadLocalå¹¶ä¸æ˜¯çº¿ç¨‹ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¯ä»¥åœ¨æ¯ä¸ªçº¿ç¨‹ä¸­å­˜å‚¨æ•°æ®ã€‚</p><h3 id="Looper-æ–¹æ³•"><a href="#Looper-æ–¹æ³•" class="headerlink" title="Looper æ–¹æ³•"></a>Looper æ–¹æ³•</h3><p>å‡†å¤‡æ–¹æ³•ï¼Œå°†å½“å‰çº¿ç¨‹åˆå§‹åŒ–ä¸ºLooperã€‚é€€å‡ºæ—¶è¦è°ƒç”¨quit<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepare</span><span class="hljs-params">()</span> &#123;<br>    prepare(<span class="hljs-literal">true</span>);<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepare</span><span class="hljs-params">(<span class="hljs-type">boolean</span> quitAllowed)</span> &#123;<br>    <span class="hljs-keyword">if</span> (sThreadLocal.get() != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;Only one Looper may be created per thread&quot;</span>);<br>    &#125;<br>    sThreadLocal.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Looper</span>(quitAllowed)); <span class="hljs-comment">// Looperå®ä¾‹å­˜å…¥äº†sThreadLocal</span><br>&#125;<br></code></pre></td></tr></table></figure></p><p><code>prepare</code>æ–¹æ³•æ–°å»º Looper å¹¶å­˜å…¥ sThreadLocal <code>sThreadLocal.set(new Looper(quitAllowed))</code><br><code>ThreadLocal&lt;T&gt;</code>ç±»<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> &#123;<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>)<br>        map.set(<span class="hljs-built_in">this</span>, value);<br>    <span class="hljs-keyword">else</span><br>        createMap(t, value);<br>&#125;<br><br><span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();<br>    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);<br>    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) &#123;<br>        ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);<br>        <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>)<br>            <span class="hljs-keyword">return</span> (T)e.value;<br>    &#125;<br>    <span class="hljs-keyword">return</span> setInitialValue();<br>&#125;<br></code></pre></td></tr></table></figure></p><p>å½“è¦è·å–Looperå¯¹è±¡æ—¶ï¼Œä»<code>sThreadLocal</code>è·å–<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// è·å–ä¸å½“å‰çº¿ç¨‹å…³è”çš„Looperï¼Œè¿”å›å¯ä»¥ä¸ºnull</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-meta">@Nullable</span> Looper <span class="hljs-title function_">myLooper</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> sThreadLocal.get();<br>&#125;<br></code></pre></td></tr></table></figure></p><p>åœ¨å½“å‰çº¿ç¨‹è¿è¡Œä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ã€‚ç»“æŸåè¦è°ƒç”¨é€€å‡ºæ–¹æ³•<code>quit()</code><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loop</span><span class="hljs-params">()</span><br></code></pre></td></tr></table></figure></p><p>å‡†å¤‡ä¸»çº¿ç¨‹Looperã€‚Androidç¯å¢ƒä¼šåˆ›å»ºä¸»çº¿ç¨‹Looperï¼Œå¼€å‘è€…ä¸åº”è¯¥è‡ªå·±è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚<br>UIçº¿ç¨‹ï¼Œå®ƒå°±æ˜¯ActivityThreadï¼ŒActivityThreadè¢«åˆ›å»ºæ—¶å°±ä¼šåˆå§‹åŒ–Looperï¼Œè¿™ä¹Ÿæ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­é»˜è®¤å¯ä»¥ä½¿ç”¨Handlerçš„åŸå› ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepareMainLooper</span><span class="hljs-params">()</span> &#123;<br>    prepare(<span class="hljs-literal">false</span>); <span class="hljs-comment">// è¿™é‡Œè¡¨ç¤ºäº†ä¸»çº¿ç¨‹Looperä¸èƒ½ç”±å¼€å‘è€…æ¥é€€å‡º</span><br>    <span class="hljs-keyword">synchronized</span> (Looper.class) &#123;<br>        <span class="hljs-keyword">if</span> (sMainLooper != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">&quot;The main Looper has already been prepared.&quot;</span>);<br>        &#125;<br>        sMainLooper = myLooper();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>è·å–ä¸»çº¿ç¨‹çš„Looperã€‚æˆ‘ä»¬å¼€å‘è€…æƒ³æ“ä½œä¸»çº¿ç¨‹æ—¶ï¼Œå¯è°ƒç”¨æ­¤æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Looper <span class="hljs-title function_">getMainLooper</span><span class="hljs-params">()</span><br></code></pre></td></tr></table></figure></p><h3 id="åŒä¸€ä¸ªThreadçš„ä¸åŒHandler"><a href="#åŒä¸€ä¸ªThreadçš„ä¸åŒHandler" class="headerlink" title="åŒä¸€ä¸ªThreadçš„ä¸åŒHandler"></a>åŒä¸€ä¸ªThreadçš„ä¸åŒHandler</h3><p>ä¸UIçº¿ç¨‹å¯¹åº”çš„MainLooperï¼Œå¯ä»¥å…³è”å¤šä¸ªHandlerã€‚<br>å¤šä¸ªHandlerä¹‹é—´çš„è®¡åˆ’ä»»åŠ¡ä¸ä¼šäº’ç›¸å½±å“ã€‚æ¯”å¦‚æœ‰2ä¸ªå…³è”äº†UIçº¿ç¨‹çš„handlerã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">Handler mMainHandler1;<br>Handler mMainHandler2;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initUtils</span><span class="hljs-params">()</span> &#123;<br>    mMainHandler1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(Looper.getMainLooper());<br>    mMainHandler2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(Looper.getMainLooper());<br>    Log.d(TAG, <span class="hljs-string">&quot;mMainHandler1 post ä»»åŠ¡&quot;</span>);<br>    mMainHandler1.postDelayed(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;mMainHandler1çš„æ¼”ç¤ºä»»åŠ¡å·²æ‰§è¡Œ&quot;</span>);<br>        &#125;<br>    &#125;, <span class="hljs-number">1500</span>);<br>    mMainHandler2.removeCallbacksAndMessages(<span class="hljs-literal">null</span>);<br>&#125;<br></code></pre></td></tr></table></figure><br>mMainHandler2å–æ¶ˆå®ƒçš„ä»»åŠ¡å¹¶ä¸ä¼šå½±å“mMainHandler1ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Androidæºç </tag>
      
      <tag>Handler</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python æ“ä½œ MySQL</title>
    <link href="/2017/05/25/Python/Python-mysql_use/"/>
    <url>/2017/05/25/Python/Python-mysql_use/</url>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡é“¾æ¥<a href="https://rustfisher.com/2017/05/25/Python/Python-mysql_use/">Python æ“ä½œ MySQL</a></p><p>å¼€å‘ç¯å¢ƒä¸é…ç½®</p><ul><li>win_x64</li><li>Ubuntu14.04</li><li>Python3.x</li></ul><h3 id="pipå®‰è£…pymysqlæ¨¡å—"><a href="#pipå®‰è£…pymysqlæ¨¡å—" class="headerlink" title="pipå®‰è£…pymysqlæ¨¡å—"></a>pipå®‰è£…pymysqlæ¨¡å—</h3><p>ç›´æ¥ä½¿ç”¨pipå®‰è£… <code>pip install pymysql</code><br>win64ä¸Šç›´æ¥åœ¨cmdä¸­æ‰§è¡Œ</p><h3 id="è¿æ¥æœ¬åœ°æ•°æ®åº“"><a href="#è¿æ¥æœ¬åœ°æ•°æ®åº“" class="headerlink" title="è¿æ¥æœ¬åœ°æ•°æ®åº“"></a>è¿æ¥æœ¬åœ°æ•°æ®åº“</h3><p>ä½¿ç”¨æ¨¡å—<code>pymysql</code>è¿æ¥æ•°æ®åº“<br>æœ¬åœ°æ•°æ®åº“ç›¸å…³é…ç½®è¯·å‚é˜…ï¼š </p><ul><li><a href="https://rustfisher.com/2019/02/26/Database/MySQL-install_and_config_Mac/">https://rustfisher.com/2019/02/26/Database/MySQL-install_and_config_Mac/</a></li><li><a href="https://rustfisher.com/2017/02/25/Database/MySQL-install_and_config_Windows/">https://rustfisher.com/2017/02/25/Database/MySQL-install_and_config_Windows/</a></li></ul><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># coding=utf-8</span><br><span class="hljs-keyword">import</span> pymysql<br><br><span class="hljs-comment"># è¿æ¥æœ¬åœ°æ•°æ®åº“</span><br>conn = pymysql.connect(host=<span class="hljs-string">&#x27;localhost&#x27;</span>, port=<span class="hljs-number">3306</span>, user=<span class="hljs-string">&#x27;root&#x27;</span>, passwd=<span class="hljs-string">&#x27;yourpwd&#x27;</span>, db=<span class="hljs-string">&#x27;samp_db1&#x27;</span>, charset=<span class="hljs-string">&#x27;utf8&#x27;</span>)<br>cursor = conn.cursor()<br>cursor.execute(<span class="hljs-string">&#x27;select * from bigstu&#x27;</span>)<br><span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> cursor.fetchall():<br>    <span class="hljs-built_in">print</span>(row)<br><br><span class="hljs-comment"># æŸ¥</span><br>cursor.execute(<span class="hljs-string">&#x27;select id, name from bigstu where age &gt; 22&#x27;</span>)<br><span class="hljs-keyword">for</span> res <span class="hljs-keyword">in</span> cursor.fetchall():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>(res[<span class="hljs-number">0</span>]) + <span class="hljs-string">&quot;, &quot;</span> + res[<span class="hljs-number">1</span>])<br><br>cursor.close()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-- end --&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">(<span class="hljs-number">1</span>, <span class="hljs-string">&#x27;å¼ ä¸‰&#x27;</span>, <span class="hljs-string">&#x27;ç”·&#x27;</span>, <span class="hljs-number">24</span>, datetime.<span class="hljs-built_in">date</span>(<span class="hljs-number">2017</span>, <span class="hljs-number">3</span>, <span class="hljs-number">29</span>), <span class="hljs-string">&#x27;13666665555&#x27;</span>)<br>(<span class="hljs-number">6</span>, <span class="hljs-string">&#x27;å°åˆš&#x27;</span>, <span class="hljs-string">&#x27;ç”·&#x27;</span>, <span class="hljs-number">23</span>, datetime.<span class="hljs-built_in">date</span>(<span class="hljs-number">2017</span>, <span class="hljs-number">3</span>, <span class="hljs-number">11</span>), <span class="hljs-string">&#x27;778899888&#x27;</span>)<br>(<span class="hljs-number">8</span>, <span class="hljs-string">&#x27;å°éœ&#x27;</span>, <span class="hljs-string">&#x27;å¥³&#x27;</span>, <span class="hljs-number">20</span>, datetime.<span class="hljs-built_in">date</span>(<span class="hljs-number">2017</span>, <span class="hljs-number">3</span>, <span class="hljs-number">13</span>), <span class="hljs-string">&#x27;13712345678&#x27;</span>)<br>(<span class="hljs-number">12</span>, <span class="hljs-string">&#x27;å°æ™º&#x27;</span>, <span class="hljs-string">&#x27;ç”·&#x27;</span>, <span class="hljs-number">21</span>, datetime.<span class="hljs-built_in">date</span>(<span class="hljs-number">2017</span>, <span class="hljs-number">3</span>, <span class="hljs-number">7</span>), <span class="hljs-string">&#x27;13787654321&#x27;</span>)<br><span class="hljs-number">1</span>, å¼ ä¸‰<br><span class="hljs-number">6</span>, å°åˆš<br><span class="hljs-comment">-- end --</span><br></code></pre></td></tr></table></figure></p><p>å¯ä»¥ç›´æ¥æ‰§è¡Œsqlè¯­å¥ã€‚è·å¾—çš„ç»“æœæ˜¯å…ƒç»„ã€‚</p><p>sqlç›¸ä¼¼æ¡ä»¶æŸ¥è¯¢</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> anindex.subject_basic_table <span class="hljs-keyword">where</span> season_id <span class="hljs-keyword">having</span> <span class="hljs-string">&#x27;2018&#x27;</span>;<br></code></pre></td></tr></table></figure><h3 id="å¢"><a href="#å¢" class="headerlink" title="å¢"></a>å¢</h3><h4 id="æ’å…¥æ•°æ®"><a href="#æ’å…¥æ•°æ®" class="headerlink" title="æ’å…¥æ•°æ®"></a>æ’å…¥æ•°æ®</h4><p>æ’å…¥ä¸€æ¡æ•°æ®ï¼Œæ¥ä¸Šé¢çš„ä»£ç </p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py">insertSql = <span class="hljs-string">&quot;insert into bigstu (name, sex, age,  mobile) values (&#x27;%s&#x27;,&#x27;%s&#x27;,%d,&#x27;%s&#x27;) &quot;</span><br>xiuji = (<span class="hljs-string">&#x27;ç§€å‰&#x27;</span>, <span class="hljs-string">&#x27;ç”·&#x27;</span>, <span class="hljs-number">15</span>, <span class="hljs-string">&#x27;13400001111&#x27;</span>)<br>cursor.execute(insertSql % xiuji)<br>conn.commit() <span class="hljs-comment"># åˆ«å¿˜äº†æäº¤</span><br></code></pre></td></tr></table></figure><h4 id="æ·»åŠ åˆ—"><a href="#æ·»åŠ åˆ—" class="headerlink" title="æ·»åŠ åˆ—"></a>æ·»åŠ åˆ—</h4><p>åœ¨mobileåé¢æ·»åŠ ä¸€åˆ—cash<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">addCo = <span class="hljs-string">&quot;alter table bigstu add cash int after mobile&quot;</span><br>cursor.execute(addCo)<br></code></pre></td></tr></table></figure></p><p>å¦‚æœè¦è®¾ç½®é»˜è®¤å€¼<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">addCo = <span class="hljs-string">&quot;alter table bigstu add cash int default 0 after mobile&quot;</span><br>cursor.execute(addCo)<br></code></pre></td></tr></table></figure></p><h3 id="åˆ "><a href="#åˆ " class="headerlink" title="åˆ "></a>åˆ </h3><h4 id="åˆ é™¤æ•°æ®"><a href="#åˆ é™¤æ•°æ®" class="headerlink" title="åˆ é™¤æ•°æ®"></a>åˆ é™¤æ•°æ®</h4><p>åˆ é™¤ name=ç§€å‰ çš„æ•°æ®<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">deleteSql = <span class="hljs-string">&quot;delete from bigstu where name = &#x27;%s&#x27;&quot;</span><br>cursor.execute(deleteSql % <span class="hljs-string">&#x27;ç§€å‰&#x27;</span>)<br></code></pre></td></tr></table></figure></p><h4 id="åˆ é™¤åˆ—"><a href="#åˆ é™¤åˆ—" class="headerlink" title="åˆ é™¤åˆ—"></a>åˆ é™¤åˆ—</h4><p>åˆ é™¤cashåˆ—<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs py">dropCo = <span class="hljs-string">&quot;alter table bigstu drop cash&quot;</span><br>cursor.execute(dropCo)<br></code></pre></td></tr></table></figure></p><h3 id="æ”¹"><a href="#æ”¹" class="headerlink" title="æ”¹"></a>æ”¹</h3><h4 id="ä¿®æ”¹æ•°æ®"><a href="#ä¿®æ”¹æ•°æ®" class="headerlink" title="ä¿®æ”¹æ•°æ®"></a>ä¿®æ”¹æ•°æ®</h4><p>æ›´æ–°ç¬¦åˆæ¡ä»¶çš„æ•°æ®</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs py">updateSql = <span class="hljs-string">&quot;update bigstu set sex = &#x27;%s&#x27; where name = &#x27;%s&#x27;&quot;</span><br>updateXiuji = (<span class="hljs-string">&#x27;ç§€å‰&#x27;</span>, <span class="hljs-string">&#x27;ç§€å‰&#x27;</span>) <span class="hljs-comment"># ç§€å‰çš„æ€§åˆ«æ˜¯ç§€å‰</span><br>cursor.execute(updateSql % updateXiuji)<br>conn.commit()<br></code></pre></td></tr></table></figure><h3 id="äº‹ç‰©å¤„ç†"><a href="#äº‹ç‰©å¤„ç†" class="headerlink" title="äº‹ç‰©å¤„ç†"></a>äº‹ç‰©å¤„ç†</h3><p>ç»™æŸä¸ªè®°å½•çš„cashå¢åŠ <br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs py">table = <span class="hljs-string">&quot;bigstu&quot;</span><br>addCash = <span class="hljs-string">&quot;update &quot;</span> + table + <span class="hljs-string">&quot; set cash = cash + &#x27;%d&#x27; where name = &#x27;%s&#x27;&quot;</span><br>lucky = (<span class="hljs-number">1000</span>, <span class="hljs-string">&quot;ç§€å‰&quot;</span>)<br><br><span class="hljs-keyword">try</span>:<br>    cursor.execute(addCash % lucky)<br><span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>    conn.rollback()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åŠ é’±å¤±è´¥äº†&quot;</span>)<br><span class="hljs-keyword">else</span>:<br>    conn.commit()<br></code></pre></td></tr></table></figure></p><p>ç›´æ¥æ‰§è¡ŒSQLè¯­å¥ï¼Œååˆ†æ–¹ä¾¿</p><h2 id="ä»£ç ç‰‡æ®µ"><a href="#ä»£ç ç‰‡æ®µ" class="headerlink" title="ä»£ç ç‰‡æ®µ"></a>ä»£ç ç‰‡æ®µ</h2><h3 id="ç»™æ•°æ®åº“æ·»åŠ åˆ—"><a href="#ç»™æ•°æ®åº“æ·»åŠ åˆ—" class="headerlink" title="ç»™æ•°æ®åº“æ·»åŠ åˆ—"></a>ç»™æ•°æ®åº“æ·»åŠ åˆ—</h3><p>ä»jsonä¸­è¯»å–éœ€è¦æ·»åŠ çš„åˆ—åï¼Œè·å–å½“å‰2ä¸ªè¡¨ä¸­æ‰€æœ‰çš„åˆ—å<br>æ•´ç†å¾—å‡ºéœ€è¦æ’å…¥çš„åˆ—åï¼Œç„¶åå°†åˆ—æ’å…¥åˆ°ç›¸åº”çš„è¡¨ä¸­</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> pymysql<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> secureUtils<br><br>mapping_keys = json.load(<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;key_mapping_db.json&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>))<br>db_keys = []  <span class="hljs-comment"># jsonä¸­æ‰€æœ‰çš„key</span><br><br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> mapping_keys.values():<br>    db_keys.append(k)<br><br>conn = pymysql.connect(host=<span class="hljs-string">&#x27;localhost&#x27;</span>, port=<span class="hljs-number">3306</span>, user=<span class="hljs-string">&#x27;root&#x27;</span>,<br>                       passwd=<span class="hljs-string">&#x27;*****&#x27;</span>, db=<span class="hljs-string">&#x27;db_name&#x27;</span>, charset=<span class="hljs-string">&#x27;utf8&#x27;</span>)<br><br>cursor = conn.cursor()<br>table_main = <span class="hljs-string">&quot;table_main&quot;</span><br>main_table_keys = []  <span class="hljs-comment"># ä¸»è¡¨çš„åˆ—å</span><br>cursor.execute(<span class="hljs-string">&quot;show columns from &quot;</span> + table_main)<br><span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> cursor.fetchall():<br>    main_table_keys.append(row[<span class="hljs-number">0</span>])<br><br>staff_table_keys = []<br>cursor.execute(<span class="hljs-string">&quot;show columns from table_second&quot;</span>)<br><span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> cursor.fetchall():<br>    staff_table_keys.append(row[<span class="hljs-number">0</span>])<br><br>need_to_insert_keys = []<br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> db_keys:<br>    <span class="hljs-keyword">if</span> k <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> staff_table_keys <span class="hljs-keyword">and</span> k <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> main_table_keys <span class="hljs-keyword">and</span> k <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> need_to_insert_keys:<br>        need_to_insert_keys.append(k)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;need to insert &quot;</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(need_to_insert_keys)))<br><span class="hljs-built_in">print</span>(need_to_insert_keys)<br><span class="hljs-keyword">for</span> kn <span class="hljs-keyword">in</span> need_to_insert_keys:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;add key to db &quot;</span> + kn)<br>    cursor.execute(<span class="hljs-string">&quot;alter table staff_table add &quot;</span> + kn +<span class="hljs-string">&quot; text&quot;</span>)<br><br>conn.close()<br></code></pre></td></tr></table></figure><h3 id="å°†å­—æ®µå­—ç¬¦æ”¹å˜"><a href="#å°†å­—æ®µå­—ç¬¦æ”¹å˜" class="headerlink" title="å°†å­—æ®µå­—ç¬¦æ”¹å˜"></a>å°†å­—æ®µå­—ç¬¦æ”¹å˜</h3><p>è¿™é‡Œå°†main_table_keysä¸­çš„æ‰€æœ‰å­—æ®µæ”¹ä¸ºutf8<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># change column character set to utf8</span><br><span class="hljs-keyword">for</span> co <span class="hljs-keyword">in</span> main_table_keys:<br>    change_sql = <span class="hljs-string">&quot;alter table &quot;</span> + table_main + <span class="hljs-string">&quot; modify &quot;</span> + co + <span class="hljs-string">&quot; text character set utf8&quot;</span><br>    <span class="hljs-built_in">print</span>(change_sql)<br>    cursor.execute(change_sql)<br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python3 Dictionaryä¸JSON</title>
    <link href="/2017/05/05/Python/Python-dictionary-JSON-file/"/>
    <url>/2017/05/05/Python/Python-dictionary-JSON-file/</url>
    
    <content type="html"><![CDATA[<h2 id="JSONä¸Dictionaryç®€ä»‹"><a href="#JSONä¸Dictionaryç®€ä»‹" class="headerlink" title="JSONä¸Dictionaryç®€ä»‹"></a>JSONä¸Dictionaryç®€ä»‹</h2><ul><li>Python3</li><li>PyCharm CE</li></ul><h3 id="JSONç®€ä»‹"><a href="#JSONç®€ä»‹" class="headerlink" title="JSONç®€ä»‹"></a>JSONç®€ä»‹</h3><p>JSON(JavaScript Object Notation)æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚<br>å®ƒæ˜¯ä¸€ç§<strong>æ–‡æœ¬æ ¼å¼</strong>ã€‚å®ƒçš„ç»“æ„ä¸»è¦ç”±é”®å€¼å¯¹æ¥æ„æˆã€‚<br>ä¸€ä¸ªé”®ï¼ˆkeyï¼‰å¯¹åº”ä¸€ä¸ªå€¼ï¼ˆvalueï¼‰ã€‚æœ€å¤–å›´ç”¨å¤§æ‹¬å·<code>&#123; &#125;</code>åŒ…å›´èµ·æ¥ã€‚<br>ä¾‹å¦‚<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;firstName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Rust&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;lastName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Fisher&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></p><p>å¤§æ‹¬å·æ‹¬èµ·æ¥çš„å«åš<strong>å¯¹è±¡ç»“æ„</strong>ã€‚</p><p>JSONé‡Œä¹Ÿå¯ä»¥æ”¾æ•°ç»„ã€‚ç”¨ä¸­æ‹¬å·<code>[ ]</code>æ‹¬èµ·æ¥ã€‚å«åš<strong>æ•°ç»„ç»“æ„</strong>ã€‚<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;desc&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;è¿™ä¸ªæ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;userInfo&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;firstName&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;Rust&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;lastName&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;Fisher&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;books&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>        <span class="hljs-string">&quot;Pythonå…¥é—¨&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;Pythonè¿›é˜¶&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;æ•°æ®åˆ†æ&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-string">&quot;å¯è§†åŒ–&quot;</span><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></p><p>å¯¹è±¡ç»“æ„å’Œæ•°ç»„ç»“æ„å¯ä»¥åŒæ—¶å­˜åœ¨ï¼Œåªè¦æ»¡è¶³é”®å€¼å¯¹çš„è¦æ±‚å³å¯ã€‚</p><p>æœ€å¤–å±‚ä¹Ÿå¯ä»¥æ˜¯ä¸­æ‹¬å·æ‹¬èµ·æ¥çš„ï¼Œé‡Œé¢å­˜æ”¾ç€å¤šä¸ªå¯¹è±¡ã€‚<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;firstName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Tom&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;lastName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Hanks&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;movies&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;Cast Away&quot;</span><span class="hljs-punctuation">]</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;userInfo&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;firstName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Rust&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;lastName&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Fisher&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;books&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;Pythonå…¥é—¨&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;Pythonè¿›é˜¶&quot;</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;desc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªkey-valueè¿›å»&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br></code></pre></td></tr></table></figure></p><h3 id="Pythonçš„Dictionaryï¼ˆå­—å…¸ï¼‰ç®€ä»‹"><a href="#Pythonçš„Dictionaryï¼ˆå­—å…¸ï¼‰ç®€ä»‹" class="headerlink" title="Pythonçš„Dictionaryï¼ˆå­—å…¸ï¼‰ç®€ä»‹"></a>Pythonçš„Dictionaryï¼ˆå­—å…¸ï¼‰ç®€ä»‹</h3><p>Dictionaryï¼ˆä»¥ä¸‹ç®€ç§°ä¸ºdictæˆ–å­—å…¸ï¼‰æ˜¯ä¸€ç§é”®å€¼å¯¹æ•°æ®ç»“æ„ã€‚<br>æœ‰ç‚¹åƒJavaé‡Œçš„Mapå’ŒSetã€‚</p><p>åˆå§‹åŒ–ä¸€ä¸ªdictå¯ä»¥ç›´æ¥ç”¨å¤§æ‹¬å·ã€‚é‡Œé¢å†™ä¸Škeyå’Œvalueã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">use_dict</span>():<br>    user_info = &#123;<span class="hljs-string">&#x27;firstName&#x27;</span>: <span class="hljs-string">&#x27;Rust&#x27;</span>, <span class="hljs-string">&#x27;lastName&#x27;</span>: <span class="hljs-string">&#x27;Fisher&#x27;</span>&#125;<br>    books = [<span class="hljs-string">&#x27;Pythonå…¥é—¨&#x27;</span>]<br>    books.append(<span class="hljs-string">&#x27;Pythonè¿›é˜¶&#x27;</span>)<br>    result = &#123;<span class="hljs-string">&#x27;userInfo&#x27;</span>: user_info, <span class="hljs-string">&#x27;books&#x27;</span>: books&#125;<br>    result[<span class="hljs-string">&#x27;desc&#x27;</span>] = <span class="hljs-string">&#x27;å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªkey-valueè¿›å»&#x27;</span><br>    <span class="hljs-built_in">print</span>(result)<br><br><span class="hljs-comment"># è¿è¡Œç»“æœ</span><br><span class="hljs-comment"># &#123;&#x27;userInfo&#x27;: &#123;&#x27;firstName&#x27;: &#x27;Rust&#x27;, &#x27;lastName&#x27;: &#x27;Fisher&#x27;&#125;, &#x27;books&#x27;: [&#x27;Pythonå…¥é—¨&#x27;, &#x27;Pythonè¿›é˜¶&#x27;], &#x27;desc&#x27;: &#x27;å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªkey-valueè¿›å»&#x27;&#125;</span><br></code></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°ï¼Œdictå’ŒJSONæœ‰äº›ç±»ä¼¼ã€‚éƒ½æ˜¯é”®å€¼å¯¹ï¼Œéƒ½æœ‰æ•°ç»„ç»“æ„ã€‚<br>ä»Pythonè¯­æ³•ä¸Šæ¥çœ‹ï¼Œdictæ“ä½œèµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ã€‚æ‰¾åˆ°ç¡®å®šçš„keyåï¼Œå¯ä»¥ç›´æ¥èµ‹å€¼ã€‚</p><h2 id="Dictionary-è½¬ä¸ºJSON"><a href="#Dictionary-è½¬ä¸ºJSON" class="headerlink" title="Dictionary è½¬ä¸ºJSON"></a>Dictionary è½¬ä¸ºJSON</h2><p>Pythonä¸­çš„dictæ˜¯ä¸€ç§é”®å€¼å¯¹çš„æ•°æ®ç»“æ„ã€‚<br>JSONæ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ï¼Œå®ƒæ˜¯ä¸€ç§<strong>æ–‡æœ¬æ ¼å¼</strong>ã€‚<br>å®ƒä»¬éƒ½æ˜¯ä»¥é”®å€¼å¯¹ä¸ºåŸºç¡€ã€‚é‚£ä¹ˆå®ƒä»¬åº”è¯¥èƒ½ç›¸äº’è½¬æ¢ã€‚</p><p>å°†dictè½¬ä¸ºJSONï¼Œè¿™é‡Œåˆ©ç”¨<code>json</code>åŒ…é‡Œæä¾›çš„<code>dumps</code>æ–¹æ³•ã€‚</p><p><code>dumps</code>æ–¹æ³•å°†ä¼ å…¥çš„dictè½¬æ¢æˆJSONæ ¼å¼çš„æ–‡æœ¬ã€‚</p><p>å¼•å…¥<code>json</code>åŒ…<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br></code></pre></td></tr></table></figure></p><p>æˆ‘ä»¬å†™å‡ºäº†ç¬¬ä¸€ä¸ªdictè½¬JSONçš„æ–¹æ³•<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">to_json1</span>(<span class="hljs-params">input_dict</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;input:&#x27;</span>, input_dict)<br>    jsonTxt = json.dumps(input_dict)<br>    <span class="hljs-built_in">print</span>(jsonTxt)<br></code></pre></td></tr></table></figure></p><p>è¾“å‡ºï¼š<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-tag">input</span>: &#123;<span class="hljs-string">&#x27;userInfo&#x27;</span>: &#123;<span class="hljs-string">&#x27;firstName&#x27;</span>: <span class="hljs-string">&#x27;Rust&#x27;</span>, <span class="hljs-string">&#x27;lastName&#x27;</span>: <span class="hljs-string">&#x27;Fisher&#x27;</span>&#125;, <span class="hljs-string">&#x27;books&#x27;</span>: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;Pythonå…¥é—¨&#x27;</span>, <span class="hljs-string">&#x27;Pythonè¿›é˜¶&#x27;</span>]</span>, <span class="hljs-string">&#x27;desc&#x27;</span>: <span class="hljs-string">&#x27;å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªkey-valueè¿›å»&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&quot;userInfo&quot;</span>: &#123;<span class="hljs-string">&quot;firstName&quot;</span>: <span class="hljs-string">&quot;Rust&quot;</span>, <span class="hljs-string">&quot;lastName&quot;</span>: <span class="hljs-string">&quot;Fisher&quot;</span>&#125;, <span class="hljs-string">&quot;books&quot;</span>: <span class="hljs-selector-attr">[<span class="hljs-string">&quot;Python\u5165\u95e8&quot;</span>, <span class="hljs-string">&quot;Python\u8fdb\u9636&quot;</span>]</span>, <span class="hljs-string">&quot;desc&quot;</span>: <span class="hljs-string">&quot;\u53ef\u4ee5\u76f4\u63a5\u6dfb\u52a0\u4e00\u4e2akey-value\u8fdb\u53bb&quot;</span>&#125;<br></code></pre></td></tr></table></figure></p><p>ä¸­æ–‡å­—ç¬¦éƒ½å˜æˆäº†å­—æ¯å’Œæ•°å­—ç¬¦å·ã€‚è¿™æœ‰ç‚¹å‡ºä¹æˆ‘ä»¬æ„æ–™ã€‚</p><p>æ¶‰åŠåˆ°ä¸­æ–‡å­—ç¬¦çš„æ—¶å€™ï¼Œéœ€è¦<code>dumps</code>æ–¹æ³•é‡ŒæŒ‡å®š<code>ensure_ascii=False</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">to_json2</span>(<span class="hljs-params">input_dict</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;input:&#x27;</span>, input_dict)<br>    jsonTxt = json.dumps(input_dict, ensure_ascii=<span class="hljs-literal">False</span>)<br>    <span class="hljs-built_in">print</span>(jsonTxt)<br></code></pre></td></tr></table></figure><p>è¾“å‡º:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-selector-tag">input</span>: &#123;<span class="hljs-string">&#x27;userInfo&#x27;</span>: &#123;<span class="hljs-string">&#x27;firstName&#x27;</span>: <span class="hljs-string">&#x27;Rust&#x27;</span>, <span class="hljs-string">&#x27;lastName&#x27;</span>: <span class="hljs-string">&#x27;Fisher&#x27;</span>&#125;, <span class="hljs-string">&#x27;books&#x27;</span>: <span class="hljs-selector-attr">[<span class="hljs-string">&#x27;Pythonå…¥é—¨&#x27;</span>, <span class="hljs-string">&#x27;Pythonè¿›é˜¶&#x27;</span>]</span>, <span class="hljs-string">&#x27;desc&#x27;</span>: <span class="hljs-string">&#x27;å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªkey-valueè¿›å»&#x27;</span>&#125;<br>&#123;<span class="hljs-string">&quot;userInfo&quot;</span>: &#123;<span class="hljs-string">&quot;firstName&quot;</span>: <span class="hljs-string">&quot;Rust&quot;</span>, <span class="hljs-string">&quot;lastName&quot;</span>: <span class="hljs-string">&quot;Fisher&quot;</span>&#125;, <span class="hljs-string">&quot;books&quot;</span>: <span class="hljs-selector-attr">[<span class="hljs-string">&quot;Pythonå…¥é—¨&quot;</span>, <span class="hljs-string">&quot;Pythonè¿›é˜¶&quot;</span>]</span>, <span class="hljs-string">&quot;desc&quot;</span>: <span class="hljs-string">&quot;å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªkey-valueè¿›å»&quot;</span>&#125;<br></code></pre></td></tr></table></figure><br>è¿™æ ·ä¸­æ–‡å­—ç¬¦å°±okäº†ã€‚</p><h2 id="listè½¬ä¸ºJSON"><a href="#listè½¬ä¸ºJSON" class="headerlink" title="listè½¬ä¸ºJSON"></a>listè½¬ä¸ºJSON</h2><p>listä¸­å­˜å‚¨ç€å¤šä¸ªdictã€‚å¯ä»¥ç›´æ¥æŠŠlistè½¬ä¸ºJSONã€‚</p><p>æ¥ä¸Šé¢çš„ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">list_json_demo</span>():<br>    tom_hanks = &#123;<span class="hljs-string">&#x27;firstName&#x27;</span>: <span class="hljs-string">&#x27;Tom&#x27;</span>, <span class="hljs-string">&#x27;lastName&#x27;</span>: <span class="hljs-string">&#x27;Hanks&#x27;</span>, <span class="hljs-string">&#x27;movies&#x27;</span>: [<span class="hljs-string">&#x27;Cast Away&#x27;</span>]&#125;<br>    info = use_dict()<br>    <span class="hljs-built_in">list</span> = [tom_hanks, info]<br>    jsonTxt = json.dumps(<span class="hljs-built_in">list</span>, ensure_ascii=<span class="hljs-literal">False</span>)<br>    <span class="hljs-built_in">print</span>(jsonTxt)<br>    <span class="hljs-keyword">return</span> jsonTxt<br></code></pre></td></tr></table></figure><p>è¾“å‡ºçš„JSONéƒ¨åˆ†ï¼š<br><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs prolog">[&#123;<span class="hljs-string">&quot;firstName&quot;</span>: <span class="hljs-string">&quot;Tom&quot;</span>, <span class="hljs-string">&quot;lastName&quot;</span>: <span class="hljs-string">&quot;Hanks&quot;</span>, <span class="hljs-string">&quot;movies&quot;</span>: [<span class="hljs-string">&quot;Cast Away&quot;</span>]&#125;, &#123;<span class="hljs-string">&quot;userInfo&quot;</span>: &#123;<span class="hljs-string">&quot;firstName&quot;</span>: <span class="hljs-string">&quot;Rust&quot;</span>, <span class="hljs-string">&quot;lastName&quot;</span>: <span class="hljs-string">&quot;Fisher&quot;</span>&#125;, <span class="hljs-string">&quot;books&quot;</span>: [<span class="hljs-string">&quot;Pythonå…¥é—¨&quot;</span>, <span class="hljs-string">&quot;Pythonè¿›é˜¶&quot;</span>], <span class="hljs-string">&quot;desc&quot;</span>: <span class="hljs-string">&quot;å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªkey-valueè¿›å»&quot;</span>&#125;]<br></code></pre></td></tr></table></figure></p><h2 id="è¯»å–JSONæ–‡æœ¬"><a href="#è¯»å–JSONæ–‡æœ¬" class="headerlink" title="è¯»å–JSONæ–‡æœ¬"></a>è¯»å–JSONæ–‡æœ¬</h2><p>ç”¨<code>json.loads</code>æ–¹æ³•å°†è¾“å…¥çš„JSONæ–‡æœ¬è½¬ä¸ºå¯¹è±¡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">json_to_dict1</span>(<span class="hljs-params">jsonTxt</span>):<br>    obj1 = json.loads(jsonTxt)<br>    <span class="hljs-built_in">print</span>(obj1)<br></code></pre></td></tr></table></figure><p>å¾—åˆ°çš„å¯¹è±¡å¯èƒ½æ˜¯æ•°ç»„æˆ–è€…æ˜¯dictã€‚</p><h3 id="è¯»å–JSONæ–‡ä»¶"><a href="#è¯»å–JSONæ–‡ä»¶" class="headerlink" title="è¯»å–JSONæ–‡ä»¶"></a>è¯»å–JSONæ–‡ä»¶</h3><p>å…ˆæ‰“å¼€æ–‡ä»¶ï¼Œç”¨<code>json.load</code>æ–¹æ³•ï¼Œè¯»å–JSONå†…å®¹<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(json_file_path) <span class="hljs-keyword">as</span> json_file:<br>    json_content = json.load(json_file) <span class="hljs-comment"># è¯»å–å‡ºæ¥çš„æ˜¯dict</span><br>    <span class="hljs-comment"># ...</span><br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>pip ç›¸å…³</title>
    <link href="/2017/04/29/Python/Python-pip-solution/"/>
    <url>/2017/04/29/Python/Python-pip-solution/</url>
    
    <content type="html"><![CDATA[<ul><li>Ubuntu 14.04</li></ul><h2 id="pip-ä½¿ç”¨å›½å†…é•œåƒæº"><a href="#pip-ä½¿ç”¨å›½å†…é•œåƒæº" class="headerlink" title="pip ä½¿ç”¨å›½å†…é•œåƒæº"></a>pip ä½¿ç”¨å›½å†…é•œåƒæº</h2><p>ä½¿ç”¨pip install çš„æ—¶å€™æ€»æ˜¯å‡ºç°read timeout ä¹‹ç±»çš„é”™è¯¯</p><p>ä½¿ç”¨å›½å†…é•œåƒ  <code>https://pypi.tuna.tsinghua.edu.cn/simple</code><br>ä¾‹å¦‚æˆ‘è¦å®‰è£… scrapy<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">pip install -i https:<span class="hljs-regexp">//</span>pypi.tuna.tsinghua.edu.cn/simple scrapy<br></code></pre></td></tr></table></figure></p><p>æ·»åŠ æºçš„é…ç½®</p><p>Linuxä¸‹ï¼Œä¿®æ”¹ ~/.pip/pip.conf (æ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ª)ï¼Œ ä¿®æ”¹ index-urlè‡³tunaï¼Œå†…å®¹å¦‚ä¸‹ï¼š<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[global]</span><br><span class="hljs-attr">index-url</span> = https://pypi.tuna.tsinghua.edu.cn/simple<br></code></pre></td></tr></table></figure></p><p>windowsä¸‹ï¼Œç›´æ¥åœ¨userç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªpipç›®å½•ï¼Œå¦‚ï¼šC:\Users\xx\pipï¼Œæ–°å»ºæ–‡ä»¶pip.iniï¼Œå†…å®¹å¦‚ä¸‹<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[global]</span><br><span class="hljs-attr">index-url</span> = https://pypi.tuna.tsinghua.edu.cn/simple<br></code></pre></td></tr></table></figure></p><h2 id="pip-install-å‡ºé”™"><a href="#pip-install-å‡ºé”™" class="headerlink" title="pip install å‡ºé”™"></a><code>pip install</code> å‡ºé”™</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ pip install pycairo<br>Collecting pycairo<br>  Downloading https://files.pythonhosted.org/packages/e8/9d/c8be300fc6b1298559d37a071c3833b0b251e0fff334d2e4c408d5789162/pycairo-1.19.1.tar.gz (205kB)<br>    100% |â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 215kB 644kB/s <br>Installing collected packages: pycairo<br>  Running setup.py install <span class="hljs-keyword">for</span> pycairo ... error<br>    Complete output from <span class="hljs-built_in">command</span> /Users/rustfisher/Desktop/intGo/studySR/venv/bin/python -u -c <span class="hljs-string">&quot;import setuptools, tokenize;__file__=&#x27;/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-jhvl5plj/pycairo/setup.py&#x27;;f=getattr(tokenize, &#x27;open&#x27;, open)(__file__);code=f.read().replace(&#x27;\r\n&#x27;, &#x27;\n&#x27;);f.close();exec(compile(code, __file__, &#x27;exec&#x27;))&quot;</span> install --record /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-record-dqg8zbp0/install-record.txt --single-version-externally-managed --compile --install-headers /Users/rustfisher/Desktop/intGo/studySR/venv/include/site/python3.7/pycairo:<br>    running install<br>    running build<br>    running build_py<br>    creating build<br>    creating build/lib.macosx-10.9-x86_64-3.7<br>    creating build/lib.macosx-10.9-x86_64-3.7/cairo<br>    copying cairo/__init__.py -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo<br>    copying cairo/__init__.pyi -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo<br>    copying cairo/py.typed -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo<br>    running build_ext<br>    [Errno 20] Not a directory: <span class="hljs-string">&#x27;pkg-config&#x27;</span><br>    <br>    ----------------------------------------<br>Command <span class="hljs-string">&quot;/Users/rustfisher/Desktop/intGo/studySR/venv/bin/python -u -c &quot;</span>import setuptools, tokenize;__file__=<span class="hljs-string">&#x27;/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-jhvl5plj/pycairo/setup.py&#x27;</span>;f=getattr(tokenize, <span class="hljs-string">&#x27;open&#x27;</span>, open)(__file__);code=f.read().replace(<span class="hljs-string">&#x27;\r\n&#x27;</span>, <span class="hljs-string">&#x27;\n&#x27;</span>);f.close();<span class="hljs-built_in">exec</span>(compile(code, __file__, <span class="hljs-string">&#x27;exec&#x27;</span>))<span class="hljs-string">&quot; install --record /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-record-dqg8zbp0/install-record.txt --single-version-externally-managed --compile --install-headers /Users/rustfisher/Desktop/intGo/studySR/venv/include/site/python3.7/pycairo&quot;</span> failed with error code 1 <span class="hljs-keyword">in</span> /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-jhvl5plj/pycairo/<br>You are using pip version 10.0.1, however version 20.2.2 is available.<br>You should consider upgrading via the <span class="hljs-string">&#x27;pip install --upgrade pip&#x27;</span> <span class="hljs-built_in">command</span>.<br></code></pre></td></tr></table></figure><p>ç”¨brewå®‰è£…<code>pkg-config</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"> $ brew install pkg-config<br>==&gt; Downloading https://mirrors.ustc.edu.cn/homebrew-bottles/bottles/pkg-config-0.29.2_3.mojave.bottle.tar.g<br><span class="hljs-comment">######################################################################## 100.0%</span><br>==&gt; Pouring pkg-config-0.29.2_3.mojave.bottle.tar.gz<br>ğŸº  /usr/local/Cellar/pkg-config/0.29.2_3: 11 files, 623.6KB<br></code></pre></td></tr></table></figure></p><p>ç„¶åå†è¿è¡Œ<code>pip install pycairo</code>ã€‚<br>å‡ºç°é”™è¯¯</p><blockquote><p>Collecting pycairo<br>  Using cached pycairo-1.19.1.tar.gz (205 kB)<br>Using legacy setup.py install for pycairo, since package â€˜wheelâ€™ is not installed.<br>Installing collected packages: pycairo<br>    Running setup.py install for pycairo â€¦ error<br>    ERROR: Command errored out with exit status 1:<br>     command: /Library/Frameworks/Python.framework/Versions/3.7/bin/python3.7 -u -c â€˜import sys, setuptools, tokenize; sys.argv[0] = â€˜â€œâ€˜â€œâ€˜/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-_fvz20yx/pycairo/setup.pyâ€™â€â€˜â€œâ€˜; <strong>file</strong>=â€™â€â€˜â€œâ€˜/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-_fvz20yx/pycairo/setup.pyâ€™â€â€˜â€œâ€˜;f=getattr(tokenize, â€˜â€œâ€˜â€œâ€˜openâ€™â€â€˜â€œâ€˜, open)(<strong>file</strong>);code=f.read().replace(â€˜â€œâ€˜â€œâ€˜\r\nâ€™â€â€˜â€œâ€˜, â€˜â€œâ€˜â€œâ€˜\nâ€™â€â€˜â€œâ€˜);f.close();exec(compile(code, <strong>file</strong>, â€˜â€œâ€˜â€œâ€˜execâ€™â€â€˜â€œâ€˜))â€™ install â€“record /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-record-0xkj4in4/install-record.txt â€“single-version-externally-managed â€“compile â€“install-headers /Library/Frameworks/Python.framework/Versions/3.7/include/python3.7m/pycairo<br>         cwd: /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-_fvz20yx/pycairo/<br>    Complete output (15 lines):<br>    running install<br>    running build<br>    running build_py<br>    creating build<br>    creating build/lib.macosx-10.9-x86_64-3.7<br>    creating build/lib.macosx-10.9-x86_64-3.7/cairo<br>    copying cairo/<strong>init</strong>.py -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo<br>    copying cairo/<strong>init</strong>.pyi -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo<br>    copying cairo/py.typed -&gt; build/lib.macosx-10.9-x86_64-3.7/cairo<br>    running build_ext<br>    Package cairo was not found in the pkg-config search path.<br>    Perhaps you should add the directory containing `cairo.pcâ€™<br>    to the PKG_CONFIG_PATH environment variable<br>    No package â€˜cairoâ€™ found</p></blockquote><pre><code class="hljs">Command &apos;[&apos;pkg-config&apos;, &apos;--print-errors&apos;, &apos;--exists&apos;, &apos;cairo &gt;= 1.13.1&apos;]&apos; returned non-zero exit status 1.----------------------------------------</code></pre><p>ERROR: Command errored out with exit status 1: /Library/Frameworks/Python.framework/Versions/3.7/bin/python3.7 -u -c â€˜import sys, setuptools, tokenize; sys.argv[0] = â€˜â€œâ€˜â€œâ€˜/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-_fvz20yx/pycairo/setup.pyâ€™â€â€˜â€œâ€˜; <strong>file</strong>=â€™â€â€˜â€œâ€˜/private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-install-_fvz20yx/pycairo/setup.pyâ€™â€â€˜â€œâ€˜;f=getattr(tokenize, â€˜â€œâ€˜â€œâ€˜openâ€™â€â€˜â€œâ€˜, open)(<strong>file</strong>);code=f.read().replace(â€˜â€œâ€˜â€œâ€˜\r\nâ€™â€â€˜â€œâ€˜, â€˜â€œâ€˜â€œâ€˜\nâ€™â€â€˜â€œâ€˜);f.close();exec(compile(code, <strong>file</strong>, â€˜â€œâ€˜â€œâ€˜execâ€™â€â€˜â€œâ€˜))â€™ install â€“record /private/var/folders/ds/b1cvbdm97dz7bynp0xzr3f7c0000gn/T/pip-record-0xkj4in4/install-record.txt â€“single-version-externally-managed â€“compile â€“install-headers /Library/Frameworks/Python.framework/Versions/3.7/include/python3.7m/pycairo Check the logs for full command output.</p><p>æ‰§è¡Œ<code>brew install cairo pkg-config freetype harfbuzz</code>ï¼ŒæŠŠè¿™å‡ ä¸ªåŒ…å®‰è£…ä¸€ä¸‹ã€‚<br>ç„¶åå†<code>pip install pycairo</code>ï¼Œå®‰è£…æˆåŠŸã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>é€‚é…å™¨æ¨¡å¼ Adapter Pattern - Javaå®ç°</title>
    <link href="/2017/03/26/DesignPattern/Adapter-Pattern/"/>
    <url>/2017/03/26/DesignPattern/Adapter-Pattern/</url>
    
    <content type="html"><![CDATA[<h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>å°†ä¸€ä¸ªç±»çš„æ¥å£å˜æ¢æˆå®¢æˆ·ç«¯é”æœŸå¾…çš„å¦ä¸€ç§æ¥å£ï¼Œä»è€Œä½¿åŸæœ¬å› æ¥å£ä¸åŒ¹é…è€Œæ— æ³•å·¥ä½œåœ¨ä¸€èµ·çš„ä¸¤ä¸ªç±»èƒ½å¤Ÿåœ¨ä¸€èµ·å·¥ä½œã€‚<br>ä¹Ÿå«ä½œå˜å‹å™¨æ¨¡å¼ï¼Œäº¦ç§°åŒ…è£…æ¨¡å¼ï¼Œä½†åŒ…è£…æ¨¡å¼ä¸æ­¢ä¸€ä¸ªã€‚<br>ç®€å•è€Œè¨€ï¼Œé€‚é…å™¨æ¨¡å¼å°±æ˜¯æŠŠä¸€ä¸ªæ¥å£æˆ–ç±»è½¬æ¢æˆå…¶ä»–çš„æ¥å£æˆ–ç±»ã€‚</p><h2 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h2><p>ä¼˜ç‚¹ï¼š</p><ul><li>å¯ä»¥è®©æ²¡æœ‰ä»»ä½•å…³ç³»çš„ç±»åœ¨ä¸€èµ·è¿è¡Œ</li><li>å¢åŠ äº†ç±»çš„é€æ˜æ€§</li><li>æé«˜äº†ç±»çš„å¤ç”¨åº¦</li><li>çµæ´»åº¦å¥½</li></ul><p>æ³¨æ„äº‹é¡¹ï¼šåœ¨è¯¦ç»†é˜¶æ®µä¸è¦è€ƒè™‘é€‚é…å™¨æ¨¡å¼ï¼Œå®ƒä¸»è¦æ˜¯ç”¨æ¥è§£å†³æ­£åœ¨æœå½¹çš„é¡¹ç›®é—®é¢˜</p><h2 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h2><h3 id="å‘å·²è¿è¡Œçš„ç³»ç»Ÿæ·»åŠ æ–°å¢çš„ç”¨æˆ·ç±»å‹"><a href="#å‘å·²è¿è¡Œçš„ç³»ç»Ÿæ·»åŠ æ–°å¢çš„ç”¨æˆ·ç±»å‹" class="headerlink" title="å‘å·²è¿è¡Œçš„ç³»ç»Ÿæ·»åŠ æ–°å¢çš„ç”¨æˆ·ç±»å‹"></a>å‘å·²è¿è¡Œçš„ç³»ç»Ÿæ·»åŠ æ–°å¢çš„ç”¨æˆ·ç±»å‹</h3><p>æ–‡ä»¶ç›®å½•å¦‚ä¸‹<br><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">adapter/<br>â”œâ”€â”€ sadapter  <span class="hljs-comment">// æ–°å¢çš„é€‚é…å™¨ä»£ç </span><br>â”‚Â Â  â”œâ”€â”€ <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SecondUserAdapter</span>.</span></span>java<br>â”‚Â Â  â”œâ”€â”€ <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SecondUserAddress</span>.</span></span>java<br>â”‚Â Â  â””â”€â”€ <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">SecondUser</span>.</span></span>java<br>â”œâ”€â”€ stable    <span class="hljs-comment">// å·²ç»åœ¨è¿è¡Œçš„ä»£ç ï¼Œä¸å¯å˜</span><br>â”‚Â Â  â”œâ”€â”€ <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">FirstUser</span>.</span></span>java<br>â”‚Â Â  â””â”€â”€ <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">IFirstUser</span>.</span></span>java<br>â”œâ”€â”€ <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">TestAdapter</span>.</span></span>java <span class="hljs-comment">// æµ‹è¯•ä»£ç </span><br>â””â”€â”€ updated   <span class="hljs-comment">// ç¬¬ä¸‰æ–¹æä¾›çš„æ¥å£ï¼Œä¸å¯å˜</span><br>    â”œâ”€â”€ <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ISecondUserAddress</span>.</span></span>java<br>    â””â”€â”€ <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ISecondUser</span>.</span></span>java<br></code></pre></td></tr></table></figure></p><p>é¦–å…ˆçœ‹å·²ç»åœ¨è¿è¡Œçš„éƒ¨åˆ† ï¼ˆstableï¼‰<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IFirstUser</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">printInfo</span><span class="hljs-params">()</span>;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FirstUser</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IFirstUser</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String username;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FirstUser</span><span class="hljs-params">(String username)</span> &#123;<br>        <span class="hljs-built_in">this</span>.username = username;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printInfo</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-built_in">this</span>.username);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>å†çœ‹æŒ‰éœ€æ±‚æ·»åŠ çš„éƒ¨åˆ† ï¼ˆupdatedï¼‰<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ISecondUser</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">printUsername</span><span class="hljs-params">()</span>;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ISecondUserAddress</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">printAddress</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>ä¸ºæ­¤æ–°å»ºçš„é€‚é…å™¨ ï¼ˆsadapterï¼‰<br>åˆ†åˆ«æ–°å»º2ä¸ªç±»æ¥å®ç°æ¥å£<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecondUser</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ISecondUser</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String username;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SecondUser</span><span class="hljs-params">(String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.username = name;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printUsername</span><span class="hljs-params">()</span> &#123;<br>        System.out.print(username + <span class="hljs-string">&quot; &quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecondUserAddress</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ISecondUserAddress</span> &#123;<br><br>    <span class="hljs-keyword">private</span> String addr;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SecondUserAddress</span><span class="hljs-params">(String address)</span> &#123;<br>        <span class="hljs-built_in">this</span>.addr = address;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printAddress</span><span class="hljs-params">()</span> &#123;<br>        System.out.print(<span class="hljs-built_in">this</span>.addr);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>é€‚é…å™¨æŒæœ‰è¿™ä¸¤ä¸ªæ¥å£çš„å¼•ç”¨ï¼Œå¹¶å®ç°åŸæœ‰çš„æ¥å£<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecondUserAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IFirstUser</span> &#123;<br><br>    <span class="hljs-keyword">private</span> ISecondUser iSecondUser;<br>    <span class="hljs-keyword">private</span> ISecondUserAddress iSecondUserAddress;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SecondUserAdapter</span><span class="hljs-params">(ISecondUser iSecondUser, ISecondUserAddress iSecondUserAddress)</span> &#123;<br>        <span class="hljs-built_in">this</span>.iSecondUser = iSecondUser;<br>        <span class="hljs-built_in">this</span>.iSecondUserAddress = iSecondUserAddress;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printInfo</span><span class="hljs-params">()</span> &#123;<br>        iSecondUser.printUsername();<br>        iSecondUserAddress.printAddress();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>é€‚é…å™¨æ„å»ºå®Œæ¯•ï¼Œæµ‹è¯•ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">IFirstUser</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FirstUser</span>(<span class="hljs-string">&quot;User1&quot;</span>);<br>user1.printInfo();<br><span class="hljs-type">SecondUserAdapter</span> <span class="hljs-variable">userAdapter</span> <span class="hljs-operator">=</span> <br>    <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecondUserAdapter</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SecondUser</span>(<span class="hljs-string">&quot;SUser2&quot;</span>),<span class="hljs-keyword">new</span> <span class="hljs-title class_">SecondUserAddress</span>(<span class="hljs-string">&quot;5 street&quot;</span>));<br>userAdapter.printInfo();<br></code></pre></td></tr></table></figure><br>output<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">User1</span><br><span class="hljs-attribute">SUser2</span> <span class="hljs-number">5</span> street<br></code></pre></td></tr></table></figure><br>æœ€å¸å¼•äººçš„åœ°æ–¹å°±æ˜¯é€‚é…å™¨å®ç°äº†åŸæœ‰çš„æ¥å£ã€‚éœ€æ±‚å˜åŒ–æ—¶ï¼Œå¯å°½é‡å°‘çš„æ”¹åŠ¨å·²æœ‰ä»£ç ã€‚</p><p>å‚è€ƒï¼šã€Šè®¾è®¡æ¨¡å¼ä¹‹ç¦…ã€‹  ç§¦å°æ³¢</p>]]></content>
    
    
    <categories>
      
      <category>Design_pattern</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android NDK è¯»å†™æ–‡ä»¶</title>
    <link href="/2017/03/16/Android/NDK-read_write_file/"/>
    <url>/2017/03/16/Android/NDK-read_write_file/</url>
    
    <content type="html"><![CDATA[<p>å¼€å‘ç¯å¢ƒä¸å·¥å…·ï¼š win7_x64ï¼ŒAndroid Studio 2.2.3, Cygwin</p><p>ä½¿ç”¨NDKï¼Œå°±è¿›å…¥äº†Linuxçš„ä¸–ç•Œã€‚ç†è§£äº†è¿™ä¸€ç‚¹ï¼Œå¾ˆå¤šäº‹æƒ…å°±å¥½åŠäº†ã€‚éœ€è¦ç†Ÿæ‚‰Cè¯­è¨€æ“ä½œæ–‡ä»¶çš„æ–¹å¼ã€‚</p><h2 id="å‡†å¤‡äº‹é¡¹"><a href="#å‡†å¤‡äº‹é¡¹" class="headerlink" title="å‡†å¤‡äº‹é¡¹"></a>å‡†å¤‡äº‹é¡¹</h2><h3 id="ç”³è¯·æƒé™"><a href="#ç”³è¯·æƒé™" class="headerlink" title="ç”³è¯·æƒé™"></a>ç”³è¯·æƒé™</h3><p>ç”³è¯·SDå¡çš„è¯»å†™æƒé™<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.READ_EXTERNAL_STORAGE&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure></p><p>6.0å¼€å§‹éœ€è¦åŠ¨æ€ç”³è¯·æƒé™ã€‚</p><h3 id="ä½¿ç”¨Linuxä¸­çš„æ–‡ä»¶ç»å¯¹è·¯å¾„"><a href="#ä½¿ç”¨Linuxä¸­çš„æ–‡ä»¶ç»å¯¹è·¯å¾„" class="headerlink" title="ä½¿ç”¨Linuxä¸­çš„æ–‡ä»¶ç»å¯¹è·¯å¾„"></a>ä½¿ç”¨Linuxä¸­çš„æ–‡ä»¶ç»å¯¹è·¯å¾„</h3><p>æ‰‹æœºsdå¡ä¸­å­˜æ”¾ç€æ–‡ä»¶ã€‚ç›®å½•ä¸º <code>/sdcard/hello.txt</code>å’Œ<code>/sdcard/egdir/csv/eg_data.csv</code>ã€‚</p><h2 id="è¯»å†™ç¤ºä¾‹"><a href="#è¯»å†™ç¤ºä¾‹" class="headerlink" title="è¯»å†™ç¤ºä¾‹"></a>è¯»å†™ç¤ºä¾‹</h2><h3 id="æ–‡ä»¶ç›®å½•"><a href="#æ–‡ä»¶ç›®å½•" class="headerlink" title="æ–‡ä»¶ç›®å½•"></a>æ–‡ä»¶ç›®å½•</h3><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ada">jni/<br>|<span class="hljs-comment">-- Android.mk</span><br>|<span class="hljs-comment">-- com_rustfisher_ndkalgo_RWFile.h</span><br>`<span class="hljs-comment">-- RWFile.c</span><br></code></pre></td></tr></table></figure><h3 id="Javaæ–‡ä»¶"><a href="#Javaæ–‡ä»¶" class="headerlink" title="Javaæ–‡ä»¶"></a>Javaæ–‡ä»¶</h3><p><code>RWFile.java</code> é‡Œé¢å†™äº†å¤šä¸ªnativeæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RWFile</span> &#123;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        System.loadLibrary(<span class="hljs-string">&quot;NDKMan&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">readIn</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> nativeRead();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">writeToFile</span><span class="hljs-params">(String msg)</span> &#123;<br>        <span class="hljs-keyword">return</span> nativeWrite(msg);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">readSDFile</span><span class="hljs-params">(String fileName)</span> &#123;<br>        <span class="hljs-keyword">return</span> nativeReadSDFile(fileName);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> String <span class="hljs-title function_">nativeRead</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> fileName e.g. FolderName/textFile.txt</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> String <span class="hljs-title function_">nativeReadSDFile</span><span class="hljs-params">(String fileName)</span>;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> String <span class="hljs-title function_">nativeWrite</span><span class="hljs-params">(String msg)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><code>RWFile.c</code>ç¼–è¯‘å‡º<code>.h</code>æ–‡ä»¶åï¼Œé‡Œé¢çš„æ–¹æ³•åã€‚å¯ä»¥çœ‹å‡ºç¼–è¯‘åçš„æ–¹æ³•åå’ŒåŸæ¥çš„nativeæ–¹æ³•æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">join</span><span class="hljs-params">(<span class="hljs-type">char</span> *s1, <span class="hljs-type">char</span> *s2,<span class="hljs-type">char</span> *result)</span>          <span class="hljs-comment">// æ‹¼æ¥charçš„å‡½æ•°</span><br>Java_com_rustfisher_ndkalgo_RWFile_nativeRead       <span class="hljs-comment">// è¯»å–å›ºå®šæ–‡ä»¶çš„å†…å®¹</span><br>Java_com_rustfisher_ndkalgo_RWFile_nativeReadSDFile <span class="hljs-comment">// æ ¹æ®æ–‡ä»¶åè¯»å–æ–‡ä»¶å†…å®¹</span><br>Java_com_rustfisher_ndkalgo_RWFile_nativeWrite      <span class="hljs-comment">// å°†å†…å®¹å†™å…¥æ–‡ä»¶</span><br></code></pre></td></tr></table></figure></p><h3 id="Cæ–‡ä»¶"><a href="#Cæ–‡ä»¶" class="headerlink" title="Cæ–‡ä»¶"></a>Cæ–‡ä»¶</h3><p>Cæ–‡ä»¶æ˜¯æˆ‘ä»¬å…·ä½“å®ç°åŠŸèƒ½çš„åœ°æ–¹ã€‚<code>RWFile.c</code>ä»£ç å¦‚ä¸‹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;com_rustfisher_ndkalgo_RWFile.h&quot;</span></span><br><br><span class="hljs-type">const</span> <span class="hljs-type">char</span> *sdcardDir = <span class="hljs-string">&quot;/sdcard/&quot;</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">join</span><span class="hljs-params">(<span class="hljs-type">char</span> *s1, <span class="hljs-type">char</span> *s2,<span class="hljs-type">char</span> *result)</span> &#123;<br>    result = (<span class="hljs-type">char</span> *) <span class="hljs-built_in">malloc</span>(<span class="hljs-built_in">strlen</span>(s1)+<span class="hljs-built_in">strlen</span>(s2)+<span class="hljs-number">1</span>);<span class="hljs-comment">// +1 for the zero-terminator</span><br>    <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-built_in">strcpy</span>(result, s1);<br>    <span class="hljs-built_in">strcat</span>(result, s2);<br>&#125;<br><br>JNIEXPORT jstring JNICALL <span class="hljs-title function_">Java_com_rustfisher_ndkalgo_RWFile_nativeRead</span><br><span class="hljs-params">(JNIEnv *env, jobject jObj)</span> &#123;<br>    FILE* file = fopen(<span class="hljs-string">&quot;/sdcard/hello.txt&quot;</span>,<span class="hljs-string">&quot;r+&quot;</span>);<br>    <span class="hljs-type">char</span> myStr[<span class="hljs-number">128</span>];<br>    <span class="hljs-keyword">if</span> (file != <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-type">char</span>* readInPtr = fgets(myStr, <span class="hljs-number">128</span>, file);<br>        fclose(file);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">NULL</span> != readInPtr) &#123;<br>            <span class="hljs-keyword">return</span> (*env)-&gt;NewStringUTF(env, myStr);<br>        &#125;<br>        <span class="hljs-keyword">return</span> (*env)-&gt;NewStringUTF(env, <span class="hljs-string">&quot;JNI read file fail!&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> (*env)-&gt;NewStringUTF(env, <span class="hljs-string">&quot;JNI read file fail!&quot;</span>);<br>&#125;<br><br>JNIEXPORT jstring JNICALL <span class="hljs-title function_">Java_com_rustfisher_ndkalgo_RWFile_nativeReadSDFile</span><br><span class="hljs-params">(JNIEnv *env, jobject jObj, jstring fileName)</span> &#123;<br>    <span class="hljs-type">char</span> *fileNamePtr = (*env)-&gt;GetStringUTFChars(env, fileName, <span class="hljs-number">0</span>);<br>    <span class="hljs-type">char</span> * result;<br>    join(sdcardDir,fileNamePtr,result);<br><br>    FILE* file = fopen(result,<span class="hljs-string">&quot;r+&quot;</span>);<br><br>    <span class="hljs-keyword">if</span> (file != <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-type">char</span> myStr[<span class="hljs-number">128</span>];<br>        <span class="hljs-type">char</span>* readInPtr = fgets(myStr, <span class="hljs-number">128</span>, file);<br>        fclose(file);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-literal">NULL</span> != readInPtr) &#123;<br>            <span class="hljs-keyword">return</span> (*env)-&gt;NewStringUTF(env, myStr);<br>        &#125;<br>        <span class="hljs-keyword">return</span> (*env)-&gt;NewStringUTF(env, <span class="hljs-string">&quot;JNI read fail - NULL == readInPtr&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> (*env)-&gt;NewStringUTF(env, <span class="hljs-string">&quot;JNI read file fail! - file is NULL &quot;</span>);<br>&#125;<br><br><br>JNIEXPORT jstring JNICALL <span class="hljs-title function_">Java_com_rustfisher_ndkalgo_RWFile_nativeWrite</span><br><span class="hljs-params">(JNIEnv *env, jobject jObj, jstring msg)</span> &#123;<br><br>    FILE* file = fopen(<span class="hljs-string">&quot;/sdcard/hello.txt&quot;</span>,<span class="hljs-string">&quot;w+&quot;</span>);<br>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *nativeMsg = (*env)-&gt;GetStringUTFChars(env, msg, <span class="hljs-number">0</span>);<br><br>    <span class="hljs-keyword">if</span> (file != <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">fputs</span>(nativeMsg, file);<br>        fflush(file);<br>        fclose(file);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> (*env)-&gt;NewStringUTF(env, <span class="hljs-string">&quot;Write finished.&quot;</span>);<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="éœ€å…³æ³¨çš„å‡½æ•°"><a href="#éœ€å…³æ³¨çš„å‡½æ•°" class="headerlink" title="éœ€å…³æ³¨çš„å‡½æ•°"></a>éœ€å…³æ³¨çš„å‡½æ•°</h2><p>è¦ç‰¹åˆ«å…³å¿ƒå‡½æ•°çš„è¿”å›å€¼ï¼Œè¿”å›å€¼å¾€å¾€ä»£è¡¨ç€è°ƒç”¨çš„ç»“æœã€‚</p><h3 id="æ‰“å¼€æ–‡ä»¶-fopen"><a href="#æ‰“å¼€æ–‡ä»¶-fopen" class="headerlink" title="æ‰“å¼€æ–‡ä»¶ fopen"></a>æ‰“å¼€æ–‡ä»¶ <code>fopen</code></h3><p><code>FILE * fopen(const char * path,const char * mode);</code><br>modeæ¨¡å¼é€‰æ‹©ï¼Œä¾‹å¦‚<code>&quot;r&quot;</code>  </p><ul><li>r(read): è¯»</li><li>w(write): å†™</li><li>a(append): è¿½åŠ </li><li>t(text): æ–‡æœ¬æ–‡ä»¶ï¼Œå¯çœç•¥ä¸å†™</li><li>b(banary): äºŒè¿›åˆ¶æ–‡ä»¶</li><li>+: è¯»å’Œå†™</li></ul><p>å‡¡ç”¨â€œrâ€æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œè¯¥æ–‡ä»¶å¿…é¡»å·²ç»å­˜åœ¨ï¼Œä¸”åªèƒ½ä»è¯¥æ–‡ä»¶è¯»å‡ºã€‚</p><p>ç”¨â€œwâ€æ‰“å¼€çš„æ–‡ä»¶åªèƒ½å‘è¯¥æ–‡ä»¶å†™å…¥ã€‚è‹¥æ‰“å¼€çš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä»¥æŒ‡å®šçš„æ–‡ä»¶åå»ºç«‹è¯¥æ–‡ä»¶ï¼Œè‹¥æ‰“å¼€çš„æ–‡ä»¶å·²<br>ç»å­˜åœ¨ï¼Œåˆ™å°†è¯¥æ–‡ä»¶åˆ å»ï¼Œé‡å»ºä¸€ä¸ªæ–°æ–‡ä»¶ã€‚è¿™ä¸ªæ–¹æ³•ä¿è¯ç›®æ ‡æ–‡ä»¶é‡Œå†™å…¥çš„åªæœ‰æˆ‘ä»¬è¦çš„æ•°æ®ã€‚</p><p>è‹¥è¦å‘ä¸€ä¸ªå·²å­˜åœ¨çš„æ–‡ä»¶è¿½åŠ æ–°çš„ä¿¡æ¯ï¼Œåªèƒ½ç”¨â€œaâ€æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚ä½†æ­¤æ—¶è¯¥æ–‡ä»¶å¿…é¡»æ˜¯å­˜åœ¨çš„ï¼Œå¦åˆ™å°†ä¼šå‡ºé”™ã€‚</p><p>åœ¨æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå¦‚æœå‡ºé”™ï¼Œfopenå°†è¿”å›ä¸€ä¸ªç©ºæŒ‡é’ˆå€¼NULLã€‚åœ¨ç¨‹åºä¸­å¯ä»¥ç”¨è¿™ä¸€ä¿¡æ¯æ¥åˆ¤åˆ«æ˜¯å¦å®Œæˆ<br>æ‰“å¼€æ–‡ä»¶çš„å·¥ä½œï¼Œå¹¶ä½œç›¸åº”çš„å¤„ç†ã€‚</p><p>å¦‚æœæˆåŠŸçš„æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶, fopen()å‡½æ•°è¿”å›æ–‡ä»¶æŒ‡é’ˆ, å¦åˆ™è¿”å›ç©ºæŒ‡é’ˆ</p><h3 id="ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®-fgets"><a href="#ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®-fgets" class="headerlink" title="ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ® fgets"></a>ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ® <code>fgets</code></h3><p><code>char *fgets(char *s, int n, FILE *stream);</code><br>ä»æ–‡ä»¶æŒ‡é’ˆstreamä¸­è¯»å–n-1ä¸ªå­—ç¬¦ï¼Œå­˜åˆ°ä»¥sä¸ºèµ·å§‹åœ°å€çš„ç©ºé—´é‡Œï¼Œç›´åˆ°è¯»å®Œä¸€è¡Œï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›sçš„æŒ‡<br>é’ˆï¼Œå¦åˆ™è¿”å›NULLã€‚</p><h3 id="NDKä¸­ç”Ÿæˆjstringçš„å‡½æ•°-env-gt-NewStringUTF-env-char"><a href="#NDKä¸­ç”Ÿæˆjstringçš„å‡½æ•°-env-gt-NewStringUTF-env-char" class="headerlink" title="NDKä¸­ç”Ÿæˆjstringçš„å‡½æ•°  (*env)-&gt;NewStringUTF(env, char *);"></a>NDKä¸­ç”Ÿæˆjstringçš„å‡½æ•°  <code>(*env)-&gt;NewStringUTF(env, char *);</code></h3><p><code>(*env)-&gt;NewStringUTF(env, char *);</code><br>å¦‚æœä¼ å…¥çš„char*æ˜¯ä¸€ä¸ªç©ºå€¼ï¼Œåœ¨ä¸€äº›å¹³å°ä¸Šä¼šæŠ¥é”™ã€‚<br>æ¯”å¦‚çº¢ç±³æ‰‹æœºä¼šç›´æ¥å´©æºƒï¼Œè€Œé­…æ—æ‰‹æœºèƒ½å¾—åˆ°ä¸€ä¸ªç©ºçš„Stringã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL å¢åˆ æŸ¥æ”¹</title>
    <link href="/2017/02/25/Database/MySQL-use_add_del_check_update/"/>
    <url>/2017/02/25/Database/MySQL-use_add_del_check_update/</url>
    
    <content type="html"><![CDATA[<p>ç¯å¢ƒï¼š win7_x64ï¼Œ Navicat for MySQL</p><p><a href="https://rustfisher.com/2017/02/25/Database/MySQL-use_add_del_check_update/">æœ¬æ–‡é“¾æ¥</a></p><h2 id="æ“ä½œæ•°æ®åº“"><a href="#æ“ä½œæ•°æ®åº“" class="headerlink" title="æ“ä½œæ•°æ®åº“"></a>æ“ä½œæ•°æ®åº“</h2><p>å‰é¢å·²ç»å°†MySQLæœåŠ¡è·‘èµ·æ¥äº†ã€‚</p><ul><li><a href="https://rustfisher.com/2019/02/26/Database/MySQL-install_and_config_Mac/">Macå®‰è£…MySQL</a></li><li><a href="https://rustfisher.com/2017/02/25/Database/MySQL-install_and_config_Windows/">Windowså®‰è£…MySQL</a></li></ul><p>ç°åœ¨æˆ‘ä»¬ä»¥rootèº«ä»½è¿›è¡ŒMySQLæ“ä½œ<br>è¿›å…¥MySQL<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">C:</span>\Users\Administrator&gt;mysql -uroot -p<br></code></pre></td></tr></table></figure></p><h3 id="æ–°å»ºæ•°æ®åº“"><a href="#æ–°å»ºæ•°æ®åº“" class="headerlink" title="æ–°å»ºæ•°æ®åº“"></a>æ–°å»ºæ•°æ®åº“</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mysql&gt; <span class="hljs-keyword">create</span> <span class="hljs-keyword">database</span> samp_db1 <span class="hljs-type">character</span> <span class="hljs-keyword">set</span> gbk;<br>Query OK, <span class="hljs-number">1</span> <span class="hljs-keyword">row</span> affected (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure><p>æ•°æ®åº“å­—ç¬¦ç¼–ç æŒ‡å®šä¸º gbk</p><h3 id="é€‰æ‹©è¦æ“ä½œçš„æ•°æ®åº“"><a href="#é€‰æ‹©è¦æ“ä½œçš„æ•°æ®åº“" class="headerlink" title="é€‰æ‹©è¦æ“ä½œçš„æ•°æ®åº“"></a>é€‰æ‹©è¦æ“ä½œçš„æ•°æ®åº“</h3><p>å·²ç»ç™»å½•åå¯ä»¥ç›´æ¥é€‰æ‹©æ•°æ®åº“</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">mysql&gt; use samp_db1<span class="hljs-comment">;</span><br>Database changed<br></code></pre></td></tr></table></figure><h4 id="åˆ›å»ºæ•°æ®è¡¨"><a href="#åˆ›å»ºæ•°æ®è¡¨" class="headerlink" title="åˆ›å»ºæ•°æ®è¡¨"></a>åˆ›å»ºæ•°æ®è¡¨</h4><p>ä»¥å»ºç«‹person_tæ•°æ®è¡¨ä¸ºä¾‹<br><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mysql&gt; <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> person_t (<br>    -&gt; id <span class="hljs-type">int</span> unsigned <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment <span class="hljs-keyword">primary key</span>,<br>    -&gt; <span class="hljs-type">name</span> <span class="hljs-type">char</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>    -&gt; sex <span class="hljs-type">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>    -&gt; age tinyint unsigned <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>    -&gt; tell <span class="hljs-type">char</span>(<span class="hljs-number">13</span>) <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> &quot;-&quot;<br>    -&gt; );<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected (<span class="hljs-number">0.22</span> sec)<br></code></pre></td></tr></table></figure><br>æ‰“å¼€Navicat for MySQLï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ–°å»ºçš„è¡¨</p><p>è¾“å…¥è¿™ä¹ˆé•¿çš„æ–‡æœ¬å¾ˆå®¹æ˜“å‡ºé”™ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å…ˆå†™å¥½SQLè¯­å¥ï¼Œå†å¯¼è¿›æ¥</p><p>æ–°å»ºæ–‡ä»¶<code>create_student_table.sql</code>ï¼Œè¾“å…¥SQLè¯­å¥</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> student (<br>id <span class="hljs-type">int</span> unsigned <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> auto_increment <span class="hljs-keyword">primary key</span>,<br><span class="hljs-type">name</span> <span class="hljs-type">char</span>(<span class="hljs-number">14</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>sex <span class="hljs-type">char</span>(<span class="hljs-number">4</span>) <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>age tinyint unsigned <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span>,<br>tell <span class="hljs-type">char</span>(<span class="hljs-number">13</span>) <span class="hljs-keyword">null</span> <span class="hljs-keyword">default</span> &quot;-&quot;<br>);<br></code></pre></td></tr></table></figure><p>ç›´æ¥æ‰§è¡ŒSQLæ–‡ä»¶ï¼Œæ“ä½œsamp_db1æ•°æ®åº“<br><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-built_in">C</span><span class="hljs-operator">:</span>\<span class="hljs-variable">Users</span>\<span class="hljs-variable">Administrator</span><span class="hljs-operator">&gt;</span><span class="hljs-variable">mysql</span> <span class="hljs-operator">-</span><span class="hljs-built_in">D</span> <span class="hljs-type">samp_db1</span> <span class="hljs-operator">-</span><span class="hljs-variable">u</span> <span class="hljs-variable">root</span> <span class="hljs-operator">-</span><span class="hljs-variable">p</span> <span class="hljs-operator">&lt;</span> <span class="hljs-variable">H</span><span class="hljs-operator">:</span>\<span class="hljs-type">create_student</span><span class="hljs-type">_table</span><span class="hljs-operator">.</span><span class="hljs-variable">sq</span><br><span class="hljs-variable">l</span><br><span class="hljs-built_in">Enter</span> <span class="hljs-variable">password</span><span class="hljs-operator">:</span> <span class="hljs-operator">****</span><br></code></pre></td></tr></table></figure></p><h4 id="æ“ä½œæ•°æ®åº“-1"><a href="#æ“ä½œæ•°æ®åº“-1" class="headerlink" title="æ“ä½œæ•°æ®åº“"></a>æ“ä½œæ•°æ®åº“</h4><p>é€‰å®šè¦æ“ä½œçš„æ•°æ®åº“<code>use samp_db1;</code></p><h5 id="å¢-æ’å…¥æ•°æ®"><a href="#å¢-æ’å…¥æ•°æ®" class="headerlink" title="å¢ - æ’å…¥æ•°æ®"></a>å¢ - æ’å…¥æ•°æ®</h5><p>insert [into] è¡¨å [(åˆ—å1, åˆ—å2, åˆ—å3, â€¦)] values (å€¼1, å€¼2, å€¼3, â€¦);</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mysql&gt; <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student <span class="hljs-keyword">values</span>(<span class="hljs-keyword">null</span>,&quot;å¼ ä¸‰&quot;,&quot;ç”·&quot;,<span class="hljs-number">23</span>,&quot;13666665555&quot;);<br>mysql&gt; <span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> student (<span class="hljs-type">name</span>,sex,age) <span class="hljs-keyword">values</span>(&quot;æå››&quot;,&quot;å¥³&quot;,<span class="hljs-number">20</span>);<br></code></pre></td></tr></table></figure><h5 id="æŸ¥-æŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®"><a href="#æŸ¥-æŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®" class="headerlink" title="æŸ¥ - æŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®"></a>æŸ¥ - æŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®</h5><p>select åˆ—åç§° from è¡¨åç§° [æŸ¥è¯¢æ¡ä»¶];</p><p>å¤šæ’å…¥äº†ä¸€äº›æ•°æ®å</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">mysql&gt; select name, age from student;</span><br><span class="hljs-section">+-------+-----+</span><br><span class="hljs-section">| name  | age |</span><br><span class="hljs-section">+-------+-----+</span><br>| å¼ ä¸‰  |  23 |<br>| æå››  |  20 |<br>| Tom   |  13 |<br>| Jerry |  12 |<br><span class="hljs-section">| ç‹äº”  |  32 |</span><br><span class="hljs-section">+-------+-----+</span><br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h6 id="ä½¿ç”¨é€šé…ç¬¦-æ¥æŸ¥è¯¢"><a href="#ä½¿ç”¨é€šé…ç¬¦-æ¥æŸ¥è¯¢" class="headerlink" title="ä½¿ç”¨é€šé…ç¬¦*æ¥æŸ¥è¯¢"></a>ä½¿ç”¨é€šé…ç¬¦*æ¥æŸ¥è¯¢</h6><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; select <span class="hljs-symbol">*</span> from student;<br>+----+-------+-----+-----+-------------+<br>|<span class="hljs-string"> id </span>|<span class="hljs-string"> name  </span>|<span class="hljs-string"> sex </span>|<span class="hljs-string"> age </span>|<span class="hljs-string"> tell        </span>|<br>+----+-------+-----+-----+-------------+<br>|<span class="hljs-string">  1 </span>|<span class="hljs-string"> å¼ ä¸‰  </span>|<span class="hljs-string"> ç”·  </span>|<span class="hljs-string">  23 </span>|<span class="hljs-string"> 13666665555 </span>|<br>|<span class="hljs-string">  2 </span>|<span class="hljs-string"> æå››  </span>|<span class="hljs-string"> å¥³  </span>|<span class="hljs-string">  20 </span>|<span class="hljs-string"> -           </span>|<br>|<span class="hljs-string">  3 </span>|<span class="hljs-string"> Tom   </span>|<span class="hljs-string"> ç”·  </span>|<span class="hljs-string">  13 </span>|<span class="hljs-string"> 13111115555 </span>|<br>|<span class="hljs-string">  4 </span>|<span class="hljs-string"> Jerry </span>|<span class="hljs-string"> ç”·  </span>|<span class="hljs-string">  12 </span>|<span class="hljs-string"> 2333333     </span>|<br>|<span class="hljs-string">  5 </span>|<span class="hljs-string"> ç‹äº”  </span>|<span class="hljs-string"> ç”·  </span>|<span class="hljs-string">  32 </span>|<span class="hljs-string"> 666666666   </span>|<br>+----+-------+-----+-----+-------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h6 id="ç‰¹å®šæ¡ä»¶æŸ¥è¯¢"><a href="#ç‰¹å®šæ¡ä»¶æŸ¥è¯¢" class="headerlink" title="ç‰¹å®šæ¡ä»¶æŸ¥è¯¢"></a>ç‰¹å®šæ¡ä»¶æŸ¥è¯¢</h6><p>where å…³é”®è¯ç”¨äºæŒ‡å®šæŸ¥è¯¢æ¡ä»¶, ç”¨æ³•å½¢å¼ä¸º: select åˆ—åç§° from è¡¨åç§° where æ¡ä»¶;</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-comment">// æŸ¥è¯¢æ‰€æœ‰æ€§åˆ«ä¸ºå¥³çš„è®°å½•</span><br><span class="hljs-section">mysql&gt; select * from student where sex=&quot;å¥³&quot;;</span><br><span class="hljs-section">+----+------+-----+-----+------+</span><br><span class="hljs-section">| id | name | sex | age | tell |</span><br><span class="hljs-section">+----+------+-----+-----+------+</span><br><span class="hljs-section">|  2 | æå›› | å¥³  |  20 | -    |</span><br><span class="hljs-section">+----+------+-----+-----+------+</span><br>1 row in set (0.04 sec)<br><br><span class="hljs-comment">// ageå¤§äº20çš„è®°å½•</span><br><span class="hljs-section">mysql&gt; select * from student where age&gt;20;</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br><span class="hljs-section">| id | name | sex | age | tell        |</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br>|  1 | å¼ ä¸‰ | ç”·  |  23 | 13666665555 |<br><span class="hljs-section">|  5 | ç‹äº” | ç”·  |  32 | 666666666   |</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br>2 rows in set (0.00 sec)<br><br><span class="hljs-comment">// ageå°äºç­‰äº20çš„è®°å½•</span><br><span class="hljs-section">mysql&gt; select * from student where age&lt;=20;</span><br><span class="hljs-section">+----+-------+-----+-----+-------------+</span><br><span class="hljs-section">| id | name  | sex | age | tell        |</span><br><span class="hljs-section">+----+-------+-----+-----+-------------+</span><br>|  2 | æå››  | å¥³  |  20 | -           |<br>|  3 | Tom   | ç”·  |  13 | 13111115555 |<br><span class="hljs-section">|  4 | Jerry | ç”·  |  12 | 2333333     |</span><br><span class="hljs-section">+----+-------+-----+-----+-------------+</span><br>3 rows in set (0.00 sec)<br><br><span class="hljs-comment">// ageå°äºç­‰äº20å¹¶ä¸”idå¤§äºç­‰äº3çš„è®°å½•</span><br><span class="hljs-section">mysql&gt; select * from student where age&lt;=20 and id &gt;=3;</span><br><span class="hljs-section">+----+-------+-----+-----+-------------+</span><br><span class="hljs-section">| id | name  | sex | age | tell        |</span><br><span class="hljs-section">+----+-------+-----+-----+-------------+</span><br>|  3 | Tom   | ç”·  |  13 | 13111115555 |<br><span class="hljs-section">|  4 | Jerry | ç”·  |  12 | 2333333     |</span><br><span class="hljs-section">+----+-------+-----+-----+-------------+</span><br>2 rows in set (0.03 sec)<br><br><span class="hljs-comment">// æŒ‰åå­—ç‰¹å¾æŸ¥è¯¢</span><br><span class="hljs-section">mysql&gt; select * from student where name like &quot;%ä¸‰%&quot;;</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br><span class="hljs-section">| id | name | sex | age | tell        |</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br><span class="hljs-section">|  1 | å¼ ä¸‰ | ç”·  |  23 | 13666665555 |</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br>1 row in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; select * from student where name like &quot;%o%&quot;;</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br><span class="hljs-section">| id | name | sex | age | tell        |</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br><span class="hljs-section">|  3 | Tom  | ç”·  |  13 | 13111115555 |</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br>1 row in set (0.00 sec)<br><br><span class="hljs-comment">// tell ä»¥5ç»“å°¾çš„è®°å½•</span><br><span class="hljs-section">mysql&gt; select * from student where tell like &quot;%5&quot;;</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br><span class="hljs-section">| id | name | sex | age | tell        |</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br>|  1 | å¼ ä¸‰ | ç”·  |  23 | 13666665555 |<br><span class="hljs-section">|  3 | Tom  | ç”·  |  13 | 13111115555 |</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br>2 rows in set (0.00 sec)<br><br><span class="hljs-section">mysql&gt; select * from student where tell like &quot;131%&quot;;</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br><span class="hljs-section">| id | name | sex | age | tell        |</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br><span class="hljs-section">|  3 | Tom  | ç”·  |  13 | 13111115555 |</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>æŒ‰æ¡ä»¶æŸ¥è¯¢éå¸¸çš„çµæ´»ï¼Œè¿ç”¨å¾—å½“ä¼šèŠ‚çœè¿è¡Œæ—¶é—´</p><h5 id="æ”¹-ä¿®æ”¹è¡¨ä¸­çš„æ•°æ®"><a href="#æ”¹-ä¿®æ”¹è¡¨ä¸­çš„æ•°æ®" class="headerlink" title="æ”¹ - ä¿®æ”¹è¡¨ä¸­çš„æ•°æ®"></a>æ”¹ - ä¿®æ”¹è¡¨ä¸­çš„æ•°æ®</h5><p>åŸºæœ¬çš„ä½¿ç”¨å½¢å¼ä¸º:</p><p>update è¡¨åç§° set åˆ—åç§°=æ–°å€¼ where æ›´æ–°æ¡ä»¶;</p><p>æˆ‘ä»¬ç»ˆäºæ‹¿åˆ°äº†æå››çš„è”ç³»æ–¹å¼ï¼Œå°†æ•°æ®åº“ä¸­çš„tellæ›´æ–°</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">mysql&gt; update student set tell=&quot;13900001111&quot; where name=&quot;æå››&quot;;<br>Query OK, 1 row affected (0.05 sec)<br>Rows matched: 1  Changed: 1  Warnings: 0<br><br><span class="hljs-section">mysql&gt; select * from student where name=&quot;æå››&quot;;</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br><span class="hljs-section">| id | name | sex | age | tell        |</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br><span class="hljs-section">|  2 | æå›› | å¥³  |  20 | 13900001111 |</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br>1 row in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>è¿‡äº†ä¸€å¹´ï¼Œå¤§å®¶éƒ½é•¿äº†ä¸€å²ï¼Œä¿®æ”¹è¡¨ä¸­çš„ageå€¼</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; update student set age=age+1;<br>Query OK, 5 rows affected (0.05 sec)<br>Rows matched: 5  Changed: 5  Warnings: 0<br><br>mysql&gt; select <span class="hljs-symbol">*</span> from student;<br>+----+-------+-----+-----+-------------+<br>|<span class="hljs-string"> id </span>|<span class="hljs-string"> name  </span>|<span class="hljs-string"> sex </span>|<span class="hljs-string"> age </span>|<span class="hljs-string"> tell        </span>|<br>+----+-------+-----+-----+-------------+<br>|<span class="hljs-string">  1 </span>|<span class="hljs-string"> å¼ ä¸‰  </span>|<span class="hljs-string"> ç”·  </span>|<span class="hljs-string">  24 </span>|<span class="hljs-string"> 13666665555 </span>|<br>|<span class="hljs-string">  2 </span>|<span class="hljs-string"> æå››  </span>|<span class="hljs-string"> å¥³  </span>|<span class="hljs-string">  21 </span>|<span class="hljs-string"> 13900001111 </span>|<br>|<span class="hljs-string">  3 </span>|<span class="hljs-string"> Tom   </span>|<span class="hljs-string"> ç”·  </span>|<span class="hljs-string">  14 </span>|<span class="hljs-string"> 13111115555 </span>|<br>|<span class="hljs-string">  4 </span>|<span class="hljs-string"> Jerry </span>|<span class="hljs-string"> ç”·  </span>|<span class="hljs-string">  13 </span>|<span class="hljs-string"> 2333333     </span>|<br>|<span class="hljs-string">  5 </span>|<span class="hljs-string"> ç‹äº”  </span>|<span class="hljs-string"> ç”·  </span>|<span class="hljs-string">  33 </span>|<span class="hljs-string"> 666666666   </span>|<br>+----+-------+-----+-----+-------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹å¤šä¸ªä¿¡æ¯ï¼ŒJerryæœ‰äº†ä¸­æ–‡åâ€œèµµå…­â€ï¼Œæ¢äº†tell</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; update student set name=<span class="hljs-string">&quot;èµµå…­&quot;</span>,tell=<span class="hljs-string">&quot;10001-1001&quot;</span> where name=<span class="hljs-string">&quot;Jerry&quot;</span>;<br>Query OK, 1 row affected (0.05 sec)<br>Rows matched: 1  Changed: 1  Warnings: 0<br><br>mysql&gt; select <span class="hljs-symbol">*</span> from student;<br>+----+------+-----+-----+-------------+<br>|<span class="hljs-string"> id </span>|<span class="hljs-string"> name </span>|<span class="hljs-string"> sex </span>|<span class="hljs-string"> age </span>|<span class="hljs-string"> tell        </span>|<br>+----+------+-----+-----+-------------+<br>|<span class="hljs-string">  1 </span>|<span class="hljs-string"> å¼ ä¸‰ </span>|<span class="hljs-string"> ç”·  </span>|<span class="hljs-string">  24 </span>|<span class="hljs-string"> 13666665555 </span>|<br>|<span class="hljs-string">  2 </span>|<span class="hljs-string"> æå›› </span>|<span class="hljs-string"> å¥³  </span>|<span class="hljs-string">  21 </span>|<span class="hljs-string"> 13900001111 </span>|<br>|<span class="hljs-string">  3 </span>|<span class="hljs-string"> Tom  </span>|<span class="hljs-string"> ç”·  </span>|<span class="hljs-string">  14 </span>|<span class="hljs-string"> 13111115555 </span>|<br>|<span class="hljs-string">  4 </span>|<span class="hljs-string"> èµµå…­ </span>|<span class="hljs-string"> ç”·  </span>|<span class="hljs-string">  13 </span>|<span class="hljs-string"> 10001-1001  </span>|<br>|<span class="hljs-string">  5 </span>|<span class="hljs-string"> ç‹äº” </span>|<span class="hljs-string"> ç”·  </span>|<span class="hljs-string">  33 </span>|<span class="hljs-string"> 666666666   </span>|<br>+----+------+-----+-----+-------------+<br>5 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h5 id="åˆ -åˆ é™¤è¡¨ä¸­çš„æ•°æ®"><a href="#åˆ -åˆ é™¤è¡¨ä¸­çš„æ•°æ®" class="headerlink" title="åˆ  - åˆ é™¤è¡¨ä¸­çš„æ•°æ®"></a>åˆ  - åˆ é™¤è¡¨ä¸­çš„æ•°æ®</h5><p>åŸºæœ¬ç”¨æ³•ä¸º:</p><p>delete from è¡¨åç§° where åˆ é™¤æ¡ä»¶;</p><p>å¹´é¾„å¤ªå°ä¸èƒ½å…¥å­¦</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">mysql&gt; delete from student where age &lt; 18;<br>Query OK, 2 rows affected (0.04 sec)<br><br><span class="hljs-section">mysql&gt; select * from student;</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br><span class="hljs-section">| id | name | sex | age | tell        |</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br>|  1 | å¼ ä¸‰ | ç”·  |  24 | 13666665555 |<br>|  2 | æå›› | å¥³  |  21 | 13900001111 |<br><span class="hljs-section">|  5 | ç‹äº” | ç”·  |  33 | 666666666   |</span><br><span class="hljs-section">+----+------+-----+-----+-------------+</span><br>3 rows in set (0.00 sec)<br></code></pre></td></tr></table></figure><h4 id="ä¿®æ”¹ç°æœ‰çš„è¡¨"><a href="#ä¿®æ”¹ç°æœ‰çš„è¡¨" class="headerlink" title="ä¿®æ”¹ç°æœ‰çš„è¡¨"></a>ä¿®æ”¹ç°æœ‰çš„è¡¨</h4><p>alter table è¯­å¥ç”¨äºä¿®æ”¹ç°æœ‰è¡¨</p><h5 id="æ·»åŠ åˆ—"><a href="#æ·»åŠ åˆ—" class="headerlink" title="æ·»åŠ åˆ—"></a>æ·»åŠ åˆ—</h5><p>alter table è¡¨å add åˆ—å åˆ—æ•°æ®ç±»å‹ [after æ’å…¥ä½ç½®];</p><p>åœ¨è¡¨çš„æœ€åæ·»åŠ addressåˆ—<br><code>mysql&gt; alter table student add address char(70);</code>   </p><p>åœ¨åä¸º age çš„åˆ—åæ’å…¥åˆ— birthday<br><code>mysql&gt; alter table student add birthday date after age;</code></p><p>æ­¤æ—¶çš„è¡¨<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">mysql&gt; select <span class="hljs-symbol">*</span> from student;<br>+----+------+-----+-----+----------+-------------+---------+<br>|<span class="hljs-string"> id </span>|<span class="hljs-string"> name </span>|<span class="hljs-string"> sex </span>|<span class="hljs-string"> age </span>|<span class="hljs-string"> birthday </span>|<span class="hljs-string"> tell        </span>|<span class="hljs-string"> address </span>|<br>+----+------+-----+-----+----------+-------------+---------+<br>|<span class="hljs-string">  1 </span>|<span class="hljs-string"> å¼ ä¸‰ </span>|<span class="hljs-string"> ç”·  </span>|<span class="hljs-string">  24 </span>|<span class="hljs-string"> NULL     </span>|<span class="hljs-string"> 13666665555 </span>|<span class="hljs-string"> NULL    </span>|<br>|<span class="hljs-string">  2 </span>|<span class="hljs-string"> æå›› </span>|<span class="hljs-string"> å¥³  </span>|<span class="hljs-string">  21 </span>|<span class="hljs-string"> NULL     </span>|<span class="hljs-string"> 13900001111 </span>|<span class="hljs-string"> NULL    </span>|<br>|<span class="hljs-string">  5 </span>|<span class="hljs-string"> ç‹äº” </span>|<span class="hljs-string"> ç”·  </span>|<span class="hljs-string">  33 </span>|<span class="hljs-string"> NULL     </span>|<span class="hljs-string"> 666666666   </span>|<span class="hljs-string"> NULL    </span>|<br>+----+------+-----+-----+----------+-------------+---------+<br></code></pre></td></tr></table></figure></p><p>åˆ—çš„åå­—ä¸èƒ½æ˜¯mysqlçš„å…³é”®å­—ï¼Œæ¯”å¦‚ä¸èƒ½æ˜¯<code>index</code></p><h5 id="ä¿®æ”¹åˆ—"><a href="#ä¿®æ”¹åˆ—" class="headerlink" title="ä¿®æ”¹åˆ—"></a>ä¿®æ”¹åˆ—</h5><p>åŸºæœ¬å½¢å¼: alter table è¡¨å change åˆ—åç§° åˆ—æ–°åç§° æ–°æ•°æ®ç±»å‹;</p><p>å°†tellåˆ—åä¿®æ”¹ä¸ºmobile<br><code>alter table student change tell mobile char(13) default &quot;-&quot;;</code></p><p>ä¿®æ”¹nameåˆ—çš„ç±»å‹ä¸º<code>char(11) not null</code></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; alter table student change name name char(<span class="hljs-number">11</span>) not null;<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">3</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">54</span> sec)<br><span class="hljs-attribute">Records</span>: <span class="hljs-number">3</span>  Duplicates: <span class="hljs-number">0</span>  Warnings: <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h5 id="åˆ é™¤åˆ—"><a href="#åˆ é™¤åˆ—" class="headerlink" title="åˆ é™¤åˆ—"></a>åˆ é™¤åˆ—</h5><p>alter table è¡¨å drop åˆ—åç§°;</p><p>åˆ é™¤addressåˆ— <code>alter table student drop address;</code></p><h5 id="é‡å‘½åè¡¨"><a href="#é‡å‘½åè¡¨" class="headerlink" title="é‡å‘½åè¡¨"></a>é‡å‘½åè¡¨</h5><p>alter table è¡¨å rename æ–°è¡¨å;</p><p>é‡å‘½åè¡¨student -&gt; bigstu  <code>alter table student rename bigstu;</code></p><h5 id="åˆ é™¤æ•´å¼ è¡¨"><a href="#åˆ é™¤æ•´å¼ è¡¨" class="headerlink" title="åˆ é™¤æ•´å¼ è¡¨"></a>åˆ é™¤æ•´å¼ è¡¨</h5><p>drop table è¡¨å;<br>åˆ æ‰å‰é¢æˆ‘ä»¬åˆ›å»ºçš„<code>person_t</code><br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; drop table person_t;<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">0</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">12</span> sec)<br></code></pre></td></tr></table></figure></p><h5 id="åˆ é™¤æ•´ä¸ªæ•°æ®åº“"><a href="#åˆ é™¤æ•´ä¸ªæ•°æ®åº“" class="headerlink" title="åˆ é™¤æ•´ä¸ªæ•°æ®åº“"></a>åˆ é™¤æ•´ä¸ªæ•°æ®åº“</h5><p>drop database æ•°æ®åº“å;</p><p>æ–°å»ºä¸€ä¸ªæ•°æ®åº“samp_4_deleteï¼Œå†åˆ é™¤å®ƒ<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">mysql</span>&gt; create database samp_4_delete;<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">1</span> row affected (<span class="hljs-number">0</span>.<span class="hljs-number">00</span> sec)<br><br><span class="hljs-attribute">mysql</span>&gt; drop database samp_4_delete;<br><span class="hljs-attribute">Query</span> OK, <span class="hljs-number">0</span> rows affected (<span class="hljs-number">0</span>.<span class="hljs-number">01</span> sec)<br></code></pre></td></tr></table></figure></p><h2 id="å¤åˆ¶schema"><a href="#å¤åˆ¶schema" class="headerlink" title="å¤åˆ¶schema"></a>å¤åˆ¶schema</h2><p>æ²¡æœ‰ç‰¹å®šçš„å¤åˆ¶å‘½ä»¤ã€‚æ€è·¯æ˜¯æ–°å»ºä¸€ä¸ªç›®æ ‡schemaï¼Œç„¶åæŠŠåŸæ•°æ®åº“ä¸­çš„è¡¨å…¨éƒ¨å¤åˆ¶åˆ°æ–°å»ºçš„åº“ä¸­å»ã€‚</p><p>å‚è€ƒï¼š</p><ul><li><a href="https://stackoverflow.com/questions/67093/how-do-i-quickly-rename-a-mysql-database-change-schema-name">https://stackoverflow.com/questions/67093/how-do-i-quickly-rename-a-mysql-database-change-schema-name</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MySQL Windows å®‰è£…ä¸ç®€å•é…ç½®</title>
    <link href="/2017/02/25/Database/MySQL-install_and_config_Windows/"/>
    <url>/2017/02/25/Database/MySQL-install_and_config_Windows/</url>
    
    <content type="html"><![CDATA[<p>è®°å½•ä¸€äº›æ“ä½œã€‚</p><h2 id="win7-x64-ä¸‹å®‰è£…é…ç½®MySQL"><a href="#win7-x64-ä¸‹å®‰è£…é…ç½®MySQL" class="headerlink" title="win7_x64 ä¸‹å®‰è£…é…ç½®MySQL"></a>win7_x64 ä¸‹å®‰è£…é…ç½®MySQL</h2><h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><p>ä¸‹è½½äº†ç»¿è‰²å…å®‰è£…ç‰ˆæœ¬ï¼Œç›®å½•ä¸º<code>E:\mysql-5.7.17-winx64</code></p><h3 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h3><p>æ–°å»ºdataç›®å½•  <code>E:\mysql-5.7.17-winx64\data</code></p><p>æŠŠ<code>E:\mysql-5.7.17-winx64\bin</code>æ·»åŠ åˆ°ç¯å¢ƒå˜é‡</p><h4 id="é…ç½®æ–‡ä»¶my-ini"><a href="#é…ç½®æ–‡ä»¶my-ini" class="headerlink" title="é…ç½®æ–‡ä»¶my.ini"></a>é…ç½®æ–‡ä»¶my.ini</h4><p>æ–°å»ºé…ç½®æ–‡ä»¶<code>my.ini</code>æ”¾åœ¨<code>E:\mysql-5.7.17-winx64</code>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[mysqld]</span><br><span class="hljs-attr">basedir</span>=E:/mysql-<span class="hljs-number">5.7</span>.<span class="hljs-number">17</span>-winx64<br><span class="hljs-attr">datadir</span>=E:/mysql-<span class="hljs-number">5.7</span>.<span class="hljs-number">17</span>-winx64/data<br><span class="hljs-attr">tmpdir</span>=E:/mysql-<span class="hljs-number">5.7</span>.<span class="hljs-number">17</span>-winx64/data<br><span class="hljs-attr">port</span> = <span class="hljs-number">3306</span><br></code></pre></td></tr></table></figure></p><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><p>æ‰“å¼€CMDï¼Œè¿›å…¥ç›®å½•<code>E:\mysql-5.7.17-winx64\bin&gt;</code>ï¼Œæ‰§è¡Œåˆå§‹åŒ–å‘½ä»¤ï¼Œå¦‚ä¸‹</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">E:\mysql<span class="hljs-number">-5.7</span><span class="hljs-number">.17</span>-winx64\bin&gt;mysqld <span class="hljs-comment">--initialize --user=mysql --console</span><br>// *******<br><span class="hljs-number">2017</span><span class="hljs-number">-02</span><span class="hljs-number">-25</span>T07:<span class="hljs-number">35</span>:<span class="hljs-number">47.155727</span>Z <span class="hljs-number">1</span> [Note] A <span class="hljs-keyword">temporary</span> <span class="hljs-keyword">password</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">generated</span> <span class="hljs-keyword">for</span> root@<br>localhost: s/KKIaag+<span class="hljs-number">3</span><span class="hljs-keyword">iS</span><br></code></pre></td></tr></table></figure><p>è·å¾—äº†ä¸€ä¸ªéšæœºå¯†ç <code>s/KKIaag+3iS</code></p><p>æ‰“å¼€å¦ä¸€ä¸ªCMDï¼Œæ‰§è¡Œ<code>C:\Users\Administrator&gt;mysqld --console</code>ï¼Œç›®çš„æ˜¯è®©MySQLè·‘èµ·æ¥</p><p>å›åˆ°åˆšæ‰çš„CMDï¼Œè¿˜åœ¨<code>E:\mysql-5.7.17-winx64\bin&gt;</code><br>ç™»å½•root <code>mysql -uroot -p</code> ï¼Œç”¨çš„æ˜¯ä¸Šé¢ç”Ÿæˆçš„å¯†ç </p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs smali">E:\mysql-5.7.17-winx64\bin&gt;mysql -uroot -p<br>Enter password: ************<br>Welcome to the MySQ<span class="hljs-class">L monitor.  Commands end with ;</span><span class="hljs-built_in"> or </span>\g.<br>Your MySQL connection id is 3<br>Server version: 5.7.17<br><br>Copyright (c) 2000, 2016, Oracle<span class="hljs-built_in"> and/or </span>its affiliates. All rights reserved.<br><br>Oracle is a registered trademark of Oracle Corporation<span class="hljs-built_in"> and/or </span>its<br>affiliates. Other names may be trademarks of their respective<br>owners.<br><br>Type &#x27;help;&#x27;<span class="hljs-built_in"> or </span>&#x27;\h&#x27; for help. Type &#x27;\c&#x27; to clear the current input statement.<br><br>mysql&gt;<br></code></pre></td></tr></table></figure><p>åœ¨MySQLçš„å‘½ä»¤è¡Œé‡Œä¿®æ”¹rootçš„å¯†ç ï¼Œè®°å¾—æ‰“åˆ†å·</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">mysql&gt; set password = password(<span class="hljs-string">&#x27;youPwd&#x27;</span>);<br>Query OK, <span class="hljs-number">0</span> rows affected, <span class="hljs-number">1</span> warning (<span class="hljs-number">0.00</span> sec)<br><br>mysql&gt; <span class="hljs-keyword">exit</span><br>Bye<br></code></pre></td></tr></table></figure><p>é€€å‡ºç”¨æ–°å¯†ç é‡æ–°ç™»å½•ã€‚å¯ä»¥å‘ç°å¯†ç å·²ç»ä¿®æ”¹æˆåŠŸã€‚<br>åœ¨è¿™æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¦ä¸€ä¸ªCMDä¸€ç›´åœ¨è¿è¡ŒMySQLã€‚</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">2017</span>-<span class="hljs-number">02</span>-<span class="hljs-number">25</span>T07:<span class="hljs-number">37</span>:<span class="hljs-number">41</span>.<span class="hljs-number">643275</span>Z <span class="hljs-number">0</span><span class="hljs-meta"> [Note] mysqld: ready for connections.</span><br><span class="hljs-meta">Version: &#x27;5.7.17&#x27;  socket: &#x27;&#x27;  port: 3306  MySQL Community Server (GPL)</span><br></code></pre></td></tr></table></figure><h3 id="å¯åŠ¨ä¸åœæ­¢æœåŠ¡"><a href="#å¯åŠ¨ä¸åœæ­¢æœåŠ¡" class="headerlink" title="å¯åŠ¨ä¸åœæ­¢æœåŠ¡"></a>å¯åŠ¨ä¸åœæ­¢æœåŠ¡</h3><h4 id="å¯åŠ¨æœåŠ¡"><a href="#å¯åŠ¨æœåŠ¡" class="headerlink" title="å¯åŠ¨æœåŠ¡"></a>å¯åŠ¨æœåŠ¡</h4><p>æ€æ‰CMDé‡Œé¢çš„MySQLè¿›ç¨‹ã€‚å®‰è£…å¹¶å¼€å¯æœåŠ¡ã€‚</p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ldif"><span class="hljs-attribute">E</span>:\mysql-5.7.17-winx64\bin&gt;mysqld install MySQL --defaults-file=&quot;E:\mysql-5.7.17<br><span class="hljs-literal">-</span>winx64\my.ini&quot;<br>Service successfully installed.<br><br><span class="hljs-attribute">E</span>:\mysql-5.7.17-winx64\bin&gt;net start mysql<br>MySQL æœåŠ¡æ­£åœ¨å¯åŠ¨ .<br>MySQL æœåŠ¡å·²ç»å¯åŠ¨æˆåŠŸã€‚<br></code></pre></td></tr></table></figure><h4 id="åœæ­¢æœåŠ¡"><a href="#åœæ­¢æœåŠ¡" class="headerlink" title="åœæ­¢æœåŠ¡"></a>åœæ­¢æœåŠ¡</h4><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">C:</span>\Users\Administrator&gt;net <span class="hljs-keyword">stop</span> MySQL<br>MySQL æœåŠ¡æ­£åœ¨åœæ­¢.<br>MySQL æœåŠ¡å·²æˆåŠŸåœæ­¢ã€‚<br></code></pre></td></tr></table></figure><h4 id="æŸ¥çœ‹æ‰€æœ‰WindowsæœåŠ¡"><a href="#æŸ¥çœ‹æ‰€æœ‰WindowsæœåŠ¡" class="headerlink" title="æŸ¥çœ‹æ‰€æœ‰WindowsæœåŠ¡"></a>æŸ¥çœ‹æ‰€æœ‰WindowsæœåŠ¡</h4><p>åœ¨CMDä¸­ä½¿ç”¨netå‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹æ‰€æœ‰æœåŠ¡</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">C:\Users\Administrator&gt;net start<br>å·²ç»å¯åŠ¨ä»¥ä¸‹ Windows æœåŠ¡:<br><br><span class="hljs-regexp">//</span> ****<br>IPsec Policy Agent<br>MySQL<br>Network Connections<br><span class="hljs-regexp">//</span> ****<br></code></pre></td></tr></table></figure><h4 id="åˆ é™¤æœåŠ¡"><a href="#åˆ é™¤æœåŠ¡" class="headerlink" title="åˆ é™¤æœåŠ¡"></a>åˆ é™¤æœåŠ¡</h4><p>sc delete æœåŠ¡å</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stata">C:\Users\Administrator&gt;<span class="hljs-keyword">sc</span> delete mysql<br>[<span class="hljs-keyword">SC</span>] DeleteService æˆåŠŸ<br><br>C:\Users\Administrator&gt;<span class="hljs-keyword">net</span> start mysql<br>æœåŠ¡åæ— æ•ˆã€‚<br><br>è¯·é”®å…¥ <span class="hljs-keyword">NET</span> HELPMSG 2185 ä»¥è·å¾—æ›´å¤šçš„å¸®åŠ©ã€‚<br></code></pre></td></tr></table></figure><h3 id="åˆ é™¤æœåŠ¡åï¼Œé‡æ–°åˆå§‹åŒ–å¹¶å»ºç«‹æœåŠ¡"><a href="#åˆ é™¤æœåŠ¡åï¼Œé‡æ–°åˆå§‹åŒ–å¹¶å»ºç«‹æœåŠ¡" class="headerlink" title="åˆ é™¤æœåŠ¡åï¼Œé‡æ–°åˆå§‹åŒ–å¹¶å»ºç«‹æœåŠ¡"></a>åˆ é™¤æœåŠ¡åï¼Œé‡æ–°åˆå§‹åŒ–å¹¶å»ºç«‹æœåŠ¡</h3><p>å‰é¢å·²ç»åˆ é™¤æœåŠ¡ï¼Œæ­¤æ—¶ç›´æ¥å»ºç«‹æœåŠ¡å¹¶å¯åŠ¨ä¼šæŠ¥é”™<br><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs livescript">C:<span class="hljs-string">\Users\Administrator&gt;mysqld</span> install MySQL --defaults-file=<span class="hljs-string">&quot;E:\mysql-5.7.17-win</span><br><span class="hljs-string">x64\my.ini&quot;</span><br>Service successfully installed.<br><br>C:<span class="hljs-string">\Users\Administrator&gt;net</span> start mysql<br>å‘ç”Ÿç³»ç»Ÿé”™è¯¯ <span class="hljs-number">2</span>ã€‚<br><br>ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶ã€‚<br></code></pre></td></tr></table></figure></p><p>æ­¤æ—¶è¦æŠŠmysqlè¿™ä¸ªæœåŠ¡åˆ é™¤<code>sc delete mysql</code></p><p>ç„¶åæŠŠdataç›®å½•å†…çš„æ–‡ä»¶å…¨éƒ¨åˆ é™¤ï¼Œå›åˆ°binç›®å½•é‡æ–°åˆå§‹åŒ–ä¸€æ¬¡ã€‚åˆè·å¾—äº†ä¸€ä¸ªéšæœºå¯†ç ã€‚<br>å†æ–°å»ºæœåŠ¡å¹¶å¯åŠ¨å³å¯ã€‚</p><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ldif"><span class="hljs-attribute">E</span>:\mysql-5.7.17-winx64\bin&gt;mysqld --initialize --user=mysql --console<br>// **********<br>2017-02-25T08:11:51.156501Z 1 [Note] A temporary password is generated for root@<br><span class="hljs-attribute">localhost</span>: gp/L/3<span class="hljs-comment">#ayeo/</span><br><br><span class="hljs-attribute">E</span>:\mysql-5.7.17-winx64\bin&gt;mysqld install MySQL --defaults-file=&quot;E:\mysql-5.7.17<br><span class="hljs-literal">-</span>winx64\my.ini&quot;<br>Service successfully installed.<br><br><span class="hljs-attribute">E</span>:\mysql-5.7.17-winx64\bin&gt;net start mysql<br>MySQL æœåŠ¡æ­£åœ¨å¯åŠ¨ .<br>MySQL æœåŠ¡å·²ç»å¯åŠ¨æˆåŠŸã€‚<br></code></pre></td></tr></table></figure><p>MySQLçš„æœåŠ¡æ­£åœ¨è¿è¡Œï¼Œæ­¤æ—¶å°†éšæœºå¯†ç ä¿®æ”¹æˆè‡ªå·±çš„å¯†ç youPwd</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">E:\mysql<span class="hljs-number">-5.7</span><span class="hljs-number">.17</span>-winx64\bin&gt;mysql -uroot -p<br>Enter <span class="hljs-keyword">password</span>: ************<br>Welcome <span class="hljs-keyword">to</span> the MySQL monitor.  Commands <span class="hljs-keyword">end</span> <span class="hljs-keyword">with</span> ; <span class="hljs-keyword">or</span> \g.<br>// ******<br>mysql&gt; <span class="hljs-keyword">set</span> <span class="hljs-keyword">password</span> = <span class="hljs-keyword">password</span>(<span class="hljs-string">&#x27;youPwd&#x27;</span>);<br>Query OK, <span class="hljs-number">0</span> <span class="hljs-keyword">rows</span> affected, <span class="hljs-number">1</span> <span class="hljs-built_in">warning</span> (<span class="hljs-number">0.00</span> sec)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Database</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MySQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gradle æ„å»ºå¤šç§ç‰ˆæœ¬</title>
    <link href="/2017/01/19/Android/Gradle_for_android_Creating_Build_Variants/"/>
    <url>/2017/01/19/Android/Gradle_for_android_Creating_Build_Variants/</url>
    
    <content type="html"><![CDATA[<p>æœ¬ç« ç›®çš„</p><ul><li>Build types æ„å»ºç±»å‹</li><li>Product flavors</li><li>Build variants æ„å»ºä¸åŒç§ç±»</li><li>Signing configurations</li></ul><p>å¼€å‘APPæ—¶ï¼Œä¼šæœ‰ç”Ÿæˆä¸åŒç‰ˆæœ¬çš„éœ€æ±‚ã€‚æ¯”å¦‚æµ‹è¯•ç‰ˆæœ¬å’Œå‘å¸ƒç‰ˆæœ¬ã€‚ä¸åŒç‰ˆæœ¬ä¹‹é—´é€šå¸¸æœ‰ä¸åŒçš„è®¾ç½®ã€‚</p><h2 id="Build-types"><a href="#Build-types" class="headerlink" title="Build types"></a>Build types</h2><p>å®šä¹‰APPæˆ–è€…æ¨¡å—è¯¥è¢«å¦‚ä½•æ„å»ºã€‚</p><p>å¯ä»¥ç”¨<code>buildTypes</code>æ¥å®šä¹‰æ„å»ºç±»å‹ã€‚ä¾‹å¦‚ï¼š<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs groovy">buildTypes &#123;<br>    release &#123;<br>        minifyEnabled <span class="hljs-literal">false</span><br>        proguardFiles getDefaultProguardFile(<span class="hljs-string">&#x27;proguard-android.txt&#x27;</span>), <span class="hljs-string">&#x27;proguard-rules.pro&#x27;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>é»˜è®¤çš„<code>build.gradle</code>æ–‡ä»¶ä¼šåŒ…å«ä¸€ä¸ª<code>release</code>æ„å»ºç±»å‹</p><h3 id="åˆ›å»ºæ„å»ºç±»å‹"><a href="#åˆ›å»ºæ„å»ºç±»å‹" class="headerlink" title="åˆ›å»ºæ„å»ºç±»å‹"></a>åˆ›å»ºæ„å»ºç±»å‹</h3><p>æ¯”å¦‚åˆ›å»ºä¸€ä¸ª<code>staging</code>æ„å»ºç±»å‹<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs groovy">buildTypes &#123;<br>    <span class="hljs-comment">// staging æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰åå­—</span><br>    <span class="hljs-comment">// ç”Ÿæˆsigned Appæ—¶å¯ä»¥é€‰æ‹©è¿™ä¸ªç±»å‹</span><br>    staging.initWith(buildTypes.debug)<br>    staging &#123;<br>        applicationIdSuffix <span class="hljs-string">&quot;.staging&quot;</span><br>        versionNameSuffix <span class="hljs-string">&quot;-staging&quot;</span><br>        buildConfigField(<span class="hljs-string">&quot;String&quot;</span>, <span class="hljs-string">&quot;BASE_URL&quot;</span>, <span class="hljs-string">&quot;\&quot;http://www.staging.com\&quot;&quot;</span>)<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br>è¿™é‡Œå®šä¹‰äº†<code>applicationIdSuffix</code>ï¼Œè®©stagingç‰ˆæœ¬çš„applicationIdå’Œreleaseç‰ˆæœ¬çš„ä¸åŒã€‚</p><p><code>initWith()</code>åˆ›å»ºä¸€ä¸ªæ–°çš„æ„å»ºç±»å‹å¹¶å¤åˆ¶ç°æœ‰çš„æ„å»ºç±»å‹ã€‚ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥å¤å†™å·²æœ‰çš„æ„å»ºç±»å‹ã€‚</p><h3 id="èµ„æºç›®å½•"><a href="#èµ„æºç›®å½•" class="headerlink" title="èµ„æºç›®å½•"></a>èµ„æºç›®å½•</h3><p>åˆ›å»ºäº†æ–°çš„æ„å»ºç±»å‹åï¼Œå¯ä»¥å»ºç«‹æ–°çš„èµ„æºæ–‡ä»¶ã€‚ä¾‹å¦‚æˆ‘ä»¬å·²ç»æœ‰äº†stagingæ„å»ºç±»å‹</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-attribute">src</span><br>â”œâ”€â”€ androidTest<br>â”œâ”€â”€ debug<br>â”œâ”€â”€ greenRelease<br>â”œâ”€â”€ <span class="hljs-selector-tag">main</span><br>â”œâ”€â”€ redDebug<br>â”œâ”€â”€ staging<span class="hljs-comment">// å¯ä»¥æ–°å»ºèµ„æºç›®å½•</span><br>â””â”€â”€ test<br></code></pre></td></tr></table></figure><p>ä¸åŒèµ„æºç›®å½•é‡Œçš„æ–‡ä»¶å¯ä»¥ç”¨ç›¸åŒçš„æ–‡ä»¶åã€‚</p><p>mainç›®å½•é‡Œçš„strings.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">string</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;app_name&quot;</span>&gt;</span>GDemo<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br></code></pre></td></tr></table></figure></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- staging strings.xml --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">string</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;app_name&quot;</span>&gt;</span>GStaging<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ç”Ÿæˆä¸åŒç‰ˆæœ¬çš„appæ—¶ï¼Œä¼šè‡ªåŠ¨å»æ‰¾ç›¸åº”çš„èµ„æºæ–‡ä»¶</p><h3 id="ä¾èµ–åŒ…ç®¡ç†"><a href="#ä¾èµ–åŒ…ç®¡ç†" class="headerlink" title="ä¾èµ–åŒ…ç®¡ç†"></a>ä¾èµ–åŒ…ç®¡ç†</h3><p>æ¯ä¸€ç§æ„å»ºç±»å‹å¯ä»¥æœ‰è‡ªå·±çš„ä¾èµ–ã€‚Gradleè‡ªåŠ¨ä¸ºæ¯ä¸ªç±»å‹åˆ›å»ºä¾èµ–é…ç½®ã€‚<br>ä¸‹é¢å°±æ˜¯å•ç‹¬ä¸ºdebugç‰ˆæœ¬æ·»åŠ loggingæ¨¡å—çš„ä¾èµ–</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs groovy">dependencies &#123;<br>    compile fileTree(<span class="hljs-attr">dir:</span> <span class="hljs-string">&#x27;libs&#x27;</span>, <span class="hljs-attr">include:</span> [<span class="hljs-string">&#x27;*.jar&#x27;</span>])<br>    androidTestCompile(<span class="hljs-string">&#x27;com.android.support.test.espresso:espresso-core:2.2.2&#x27;</span>, &#123;<br>        exclude <span class="hljs-attr">group:</span> <span class="hljs-string">&#x27;com.android.support&#x27;</span>, <span class="hljs-attr">module:</span> <span class="hljs-string">&#x27;support-annotations&#x27;</span><br>    &#125;)<br>    compile <span class="hljs-string">&#x27;com.android.support:appcompat-v7:25.1.1&#x27;</span><br>    testCompile <span class="hljs-string">&#x27;junit:junit:4.12&#x27;</span><br><br>    debugCompile <span class="hljs-string">&#x27;de.mindpipe.android:android-logging-log4j:1.0.3&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Product-flavors-äº§å“ç‰¹å¾"><a href="#Product-flavors-äº§å“ç‰¹å¾" class="headerlink" title="Product flavors äº§å“ç‰¹å¾"></a>Product flavors äº§å“ç‰¹å¾</h2><p>product flavorsç”¨äºåˆ›å»ºåŒä¸€ä¸ªAPPçš„ä¸åŒç‰ˆæœ¬ã€‚æœ€ç›´æ¥çš„ä¾‹å­å°±æ˜¯å…è´¹å’Œä»˜è´¹ç‰ˆAPPã€‚</p><p>å½“æˆ‘ä»¬è¦å‘å¸ƒAPPæ—¶ï¼Œå¯ä»¥é€‰æ‹©releaseæˆ–è€…stagingï¼ˆä¸Šé¢çš„ä¾‹å­ï¼‰ç‰ˆã€‚ä½†æ˜¯å¯¹åŒä¸€ä¸ªæ„å»ºç±»å‹ï¼Œæ¯”å¦‚å¯¹<br>äºreleaseç‰ˆï¼Œæˆ‘ä»¬å¯ä»¥ç”¨Product flavorsæ‰“åŒ…å‡ºæœ‰å„è‡ªç‰¹å¾çš„APPã€‚æ¯”å¦‚ï¼š</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">// å¤šæ¸ é“æ‰“åŒ…å¯ä»¥ç”¨åœ¨è¿™é‡Œé…ç½®</span><br><span class="hljs-comment">// ä¸€æ—¦é…ç½®äº†productFlavorsï¼Œç”Ÿæˆapkæ—¶ä¼šé»˜è®¤é€‰å…¶ä¸­ä¸€ä¸ªé€‰é¡¹</span><br>productFlavors &#123;<br>    red &#123;<br>        versionName <span class="hljs-string">&quot;1.0-red&quot;</span><br>    &#125;<br>    green &#123;<br>        applicationId <span class="hljs-string">&quot;com.rustfisher.gradletest.green&quot;</span> <span class="hljs-comment">// ä½¿ç”¨å¦ä¸€ä¸ªç­¾å</span><br>        versionNameSuffix <span class="hljs-string">&quot;-green&quot;</span><span class="hljs-comment">// ç‰ˆæœ¬åæ·»åŠ åç¼€</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="èµ„æºæ–‡ä»¶"><a href="#èµ„æºæ–‡ä»¶" class="headerlink" title="èµ„æºæ–‡ä»¶"></a>èµ„æºæ–‡ä»¶</h3><p>æ–°å»ºäº†productFlavorsç±»å‹åï¼Œæˆ‘ä»¬å¯ä»¥æ–°å»ºç›¸åº”çš„èµ„æºç›®å½•ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">src<br>â”œâ”€â”€ androidTest<br>â”œâ”€â”€ debug<br>â”œâ”€â”€ greenRelease <span class="hljs-regexp">//</span> releaseç‰ˆæœ¬  é‡‡ç”¨green<br>â”œâ”€â”€ main<br>â”œâ”€â”€ redDebug <span class="hljs-regexp">//</span> debugç‰ˆæœ¬   é‡‡ç”¨red<br>â”œâ”€â”€ staging<br>â””â”€â”€ test<br></code></pre></td></tr></table></figure><h3 id="å¤šç§ç‰¹ç§çš„å˜é‡-Multiflavor-variants"><a href="#å¤šç§ç‰¹ç§çš„å˜é‡-Multiflavor-variants" class="headerlink" title="å¤šç§ç‰¹ç§çš„å˜é‡ Multiflavor variants"></a>å¤šç§ç‰¹ç§çš„å˜é‡ Multiflavor variants</h3><p>åœ¨Product flavorsä¸­å¯ä»¥è¿›è¡Œç»„åˆï¼Œä¾‹å¦‚</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs groovy">android &#123;<br><br>    flavorDimensions(<span class="hljs-string">&quot;color&quot;</span>, <span class="hljs-string">&quot;price&quot;</span>) <span class="hljs-comment">// æ–°å»ºäº†2ç§ç±»å‹</span><br><br>    <span class="hljs-comment">// å¤šæ¸ é“æ‰“åŒ…å¯ä»¥ç”¨åœ¨è¿™é‡Œé…ç½®</span><br>    <span class="hljs-comment">// ä¸€æ—¦é…ç½®äº†productFlavorsï¼Œdebugæ—¶ä¼šé»˜è®¤é€‰ä¸€ä¸ªé€‰é¡¹</span><br>    productFlavors &#123;<br>        red &#123;<br>            versionName <span class="hljs-string">&quot;1.0-red&quot;</span><br>            dimension <span class="hljs-string">&quot;color&quot;</span><br>        &#125;<br>        green &#123;<br>            applicationId <span class="hljs-string">&quot;com.rustfisher.gradletest.green&quot;</span> <span class="hljs-comment">// ä½¿ç”¨å¦ä¸€ä¸ªç­¾å</span><br>            versionNameSuffix <span class="hljs-string">&quot;-green&quot;</span><br>            dimension <span class="hljs-string">&quot;color&quot;</span><br>        &#125;<br>        freeApp &#123;<br>            dimension <span class="hljs-string">&quot;price&quot;</span><br>        &#125;<br>        paidApp &#123;<br>            dimension <span class="hljs-string">&quot;price&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>é‚£ä¹ˆåœ¨æ‰“åŒ…apkæ—¶ï¼Œå¯ä»¥æœ‰å¦‚ä¸‹4ç§ç‰ˆæœ¬  </p><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-built_in">green</span>-freeApp <br><span class="hljs-built_in">green</span>-paidApp <br><span class="hljs-built_in">red</span>-freeApp <br><span class="hljs-built_in">red</span>-paidApp<br></code></pre></td></tr></table></figure><p>ä¸€æ—¦æ·»åŠ flavorDimensionsï¼Œå°±å¿…é¡»ä¸ºæ¯ä¸€ä¸ªflavoråˆ¶å®šdimensionã€‚<br>å°±åƒä¸Šé¢çš„<code>color</code>å’Œ<code>price</code>å¿…é¡»å‡ºç°åœ¨ä¸‹é¢4ç§productFlavorsä¹‹ä¸­ã€‚å¦åˆ™ä¼šæŠ¥é”™ã€‚</p><h2 id="Build-Variants"><a href="#Build-Variants" class="headerlink" title="Build Variants"></a>Build Variants</h2><p>Android Studioå·¦ä¸‹è§’å¯ä»¥æ‰“å¼€Build Variantsçª—å£ã€‚é€‰æ‹©æ¨¡å—å’Œ<code>Build Variants</code>ã€‚<br>å‰é¢é…ç½®çš„æ„å»ºç±»å‹éƒ½ä¼šåœ¨è¿™ä¸ªåˆ—è¡¨ä¸­å‡ºç°ã€‚</p><h3 id="Tasks-ä»»åŠ¡"><a href="#Tasks-ä»»åŠ¡" class="headerlink" title="Tasks ä»»åŠ¡"></a>Tasks ä»»åŠ¡</h3><p>Android plugin for Gradle ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªé…ç½®çš„æ„å»ºç±»å‹åˆ›å»ºä»»åŠ¡ã€‚<br>æ–°å»ºé¡¹ç›®æ—¶ï¼Œä¼šæœ‰é»˜è®¤çš„assembleDebug å’Œ assembleReleaseã€‚<br>ç»è¿‡ä¸Šé¢çš„é…ç½®ä»¥åï¼Œä¼šæœ‰äº§ç”Ÿç›¸å¯¹åº”çš„ä»»åŠ¡<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">assemble</span><br><span class="hljs-attribute">assembleAndroidTest</span><br><span class="hljs-attribute">assembleDebug</span><br><span class="hljs-attribute">assembleFreeApp</span><br><span class="hljs-attribute">assembleGreen</span><br><span class="hljs-attribute">assembleGreenFreeApp</span><br><span class="hljs-attribute">assembleGreenPaidApp</span><br><span class="hljs-attribute">assemblePaidApp</span><br><span class="hljs-attribute">assembleRed</span><br><span class="hljs-attribute">assembleRedFreeApp</span><br><span class="hljs-attribute">assembleRedPaidApp</span><br><span class="hljs-attribute">assembleRelease</span><br><span class="hljs-attribute">assembleStaging</span><br></code></pre></td></tr></table></figure></p><h3 id="Resource-and-manifest-merging"><a href="#Resource-and-manifest-merging" class="headerlink" title="Resource and manifest merging"></a>Resource and manifest merging</h3><p>Androidçš„Gradleæ’ä»¶ä¼šåœ¨æ‰“åŒ…appå‰å°†ä¸»è¦èµ„æºå’Œæ„å»ºç±»å‹èµ„æºåˆåœ¨ä¸€èµ·ã€‚å¦å¤–ï¼Œlibå·¥ç¨‹ä¹Ÿå¯ä»¥æä¾›<br>é¢å¤–å¯è¢«åˆå¹¶çš„èµ„æºæ–‡ä»¶ã€‚manifestæ–‡ä»¶ä¹Ÿå¯è¢«åˆå¹¶ã€‚æ¯”å¦‚åœ¨debugç‰ˆæœ¬ä¸­ç”³è¯·æ­£å¼ç‰ˆä¸­ä¸éœ€è¦çš„æƒé™ã€‚</p><h3 id="å®šä¹‰æ„å»ºå˜é‡"><a href="#å®šä¹‰æ„å»ºå˜é‡" class="headerlink" title="å®šä¹‰æ„å»ºå˜é‡"></a>å®šä¹‰æ„å»ºå˜é‡</h3><p>ç»™productFlavorsä¸­çš„ç±»å‹æ·»åŠ èµ„æº</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs fsharp"><span class="hljs-keyword">productFlavors</span> &#123;<br>    <span class="hljs-keyword">red</span> &#123;<br>        versionName <span class="hljs-string">&quot;1.0-red&quot;</span><br>        dimension <span class="hljs-string">&quot;color&quot;</span><br>        resValue(<span class="hljs-string">&quot;color&quot;</span>, <span class="hljs-string">&quot;flavor_color&quot;</span>, <span class="hljs-string">&quot;#ff0000&quot;</span>)<br>    &#125;<br>    <span class="hljs-keyword">green</span> &#123;<br>        applicationId <span class="hljs-string">&quot;com.rustfisher.gradletest.green&quot;</span> <span class="hljs-comment">// ä½¿ç”¨å¦ä¸€ä¸ªç­¾å</span><br>        versionNameSuffix <span class="hljs-string">&quot;-green&quot;</span><br>        resValue(<span class="hljs-string">&quot;color&quot;</span>, <span class="hljs-string">&quot;flavor_color&quot;</span>, <span class="hljs-string">&quot;#00ff00&quot;</span>)<br>        dimension <span class="hljs-string">&quot;color&quot;</span><br>    &#125;<br><span class="hljs-comment">// ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„flavor_colorå¯ä»¥åœ¨ä»£ç ä¸­é€šè¿‡Ræ–‡ä»¶æ‰¾åˆ°<code>R.color.flavor_color</code></p><p>å‚è€ƒï¼š<em>Gradle for Android</em>  Kevin Pelgrims</p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gradle åŸºç¡€è‡ªå®šä¹‰æ„å»º</title>
    <link href="/2017/01/19/Android/Gradle_for_android_Basic_Build_Customization/"/>
    <url>/2017/01/19/Android/Gradle_for_android_Basic_Build_Customization/</url>
    
    <content type="html"><![CDATA[<p>win7  Android Studio 2.1.3</p><p>åŸºç¡€è‡ªå®šä¹‰æ„å»º Basic Build Customization</p><p>æœ¬ç« ç›®çš„</p><ul><li>ç†è§£Gradleæ–‡ä»¶</li><li>build taskså…¥é—¨</li><li>è‡ªå®šä¹‰æ„å»º</li></ul><h2 id="ç†è§£Gradleæ–‡ä»¶"><a href="#ç†è§£Gradleæ–‡ä»¶" class="headerlink" title="ç†è§£Gradleæ–‡ä»¶"></a>ç†è§£Gradleæ–‡ä»¶</h2><p>åœ¨Android Studioä¸­æ–°å»ºä¸€ä¸ªé¡¹ç›®åï¼Œä¼šè‡ªåŠ¨åˆ›å»º3ä¸ªGradleæ–‡ä»¶ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">MyApp<br>â”œâ”€â”€ build<span class="hljs-selector-class">.gradle</span><br>â”œâ”€â”€ settings<span class="hljs-selector-class">.gradle</span><br>â””â”€â”€ app<br>    â””â”€â”€ build.gradle<br></code></pre></td></tr></table></figure><p>æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰è‡ªå·±çš„ä½œç”¨</p><h3 id="settings-gradleæ–‡ä»¶"><a href="#settings-gradleæ–‡ä»¶" class="headerlink" title="settings.gradleæ–‡ä»¶"></a>settings.gradleæ–‡ä»¶</h3><p>æ–°å»ºå·¥ç¨‹çš„settingsæ–‡ä»¶ç±»ä¼¼ä¸‹é¢è¿™æ ·</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs groovy">include <span class="hljs-string">&#x27;:app&#x27;</span><br></code></pre></td></tr></table></figure><p>Gradleä¸ºæ¯ä¸ªsettingsæ–‡ä»¶åˆ›å»º<code>Settings</code>å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶ä¸­çš„æ–¹æ³•ã€‚</p><h3 id="The-top-level-build-file-æœ€å¤–å±‚çš„æ„å»ºæ–‡ä»¶"><a href="#The-top-level-build-file-æœ€å¤–å±‚çš„æ„å»ºæ–‡ä»¶" class="headerlink" title="The top-level build file æœ€å¤–å±‚çš„æ„å»ºæ–‡ä»¶"></a>The top-level build file æœ€å¤–å±‚çš„æ„å»ºæ–‡ä»¶</h3><p>èƒ½å¯¹å·¥ç¨‹ä¸­æ‰€æœ‰æ¨¡å—è¿›è¡Œé…ç½®ã€‚å¦‚ä¸‹</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs groovy">buildscript &#123;<br>    repositories &#123;<br>        jcenter()<br>    &#125;<br>    dependencies &#123;<br>        classpath <span class="hljs-string">&#x27;com.android.tools.build:gradle:2.1.3&#x27;</span><br><br>        <span class="hljs-comment">// <span class="hljs-doctag">NOTE:</span> Do not place your application dependencies here; they belong</span><br>        <span class="hljs-comment">// in the individual module build.gradle files</span><br>    &#125;<br>&#125;<br><br>allprojects &#123;<br>    repositories &#123;<br>        jcenter()<br>        maven &#123; url <span class="hljs-string">&quot;https://jitpack.io&quot;</span> &#125;<br>    &#125;<br>&#125;<br><br>task clean(<span class="hljs-attr">type:</span> Delete) &#123;<br>    delete rootProject.buildDir<br>&#125;<br></code></pre></td></tr></table></figure><p><code>buildscript</code>ä»£ç å—æ˜¯å…·ä½“é…ç½®çš„åœ°æ–¹ï¼Œå¼•ç”¨JCenterä»“åº“ã€‚<br>æœ¬ä¾‹ä¸­ï¼Œä¸€ä¸ªä»“åº“ä»£è¡¨ç€ä¾èµ–åº“ï¼Œæ¢å¥è¯è¯´æ˜¯appå¯ä»¥ä»ä¸­ä¸‹è½½ä½¿ç”¨åº“æ–‡ä»¶ã€‚<br>JCenteræ˜¯ä¸€ä¸ªæœ‰åçš„ Maven ä»“åº“ã€‚</p><p><code>dependencies</code>ä»£ç å—ç”¨æ¥é…ç½®ä¾èµ–ã€‚ä¸Šé¢æ³¨é‡Šè¯´æ˜äº†ï¼Œä¸è¦åœ¨æ­¤æ·»åŠ ä¾èµ–ï¼Œè€Œåº”è¯¥åˆ°ç‹¬ç«‹çš„æ¨¡å—<br>ä¸­å»é…ç½®ä¾èµ–ã€‚</p><p><code>allprojects</code>èƒ½å¯¹æ‰€æœ‰æ¨¡å—è¿›è¡Œé…ç½®ã€‚</p><h3 id="æ¨¡å—ä¸­çš„buildæ–‡ä»¶"><a href="#æ¨¡å—ä¸­çš„buildæ–‡ä»¶" class="headerlink" title="æ¨¡å—ä¸­çš„buildæ–‡ä»¶"></a>æ¨¡å—ä¸­çš„buildæ–‡ä»¶</h3><p>æ¨¡å—ä¸­çš„ç‹¬ç«‹é…ç½®æ–‡ä»¶ï¼Œä¼šè¦†ç›–æ‰top-levelçš„<code>build.gradle</code>æ–‡ä»¶</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs groovy">apply <span class="hljs-attr">plugin:</span> <span class="hljs-string">&#x27;com.android.application&#x27;</span><br><br>android &#123;<br>    compileSdkVersion <span class="hljs-number">25</span><br>    buildToolsVersion <span class="hljs-string">&quot;25.0.2&quot;</span><br><br>    defaultConfig &#123;<br>        applicationId <span class="hljs-string">&quot;com.xxx.rust.newproj&quot;</span><br>        minSdkVersion <span class="hljs-number">18</span><br>        targetSdkVersion <span class="hljs-number">25</span><br>        versionCode <span class="hljs-number">1</span><br>        versionName <span class="hljs-string">&quot;1.0&quot;</span><br>    &#125;<br>    buildTypes &#123;<br>        release &#123;<br>            minifyEnabled <span class="hljs-literal">false</span><br>            proguardFiles getDefaultProguardFile(<span class="hljs-string">&#x27;proguard-android.txt&#x27;</span>), <span class="hljs-string">&#x27;proguard-rules.pro&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;<br><br>dependencies &#123;<br>    compile fileTree(<span class="hljs-attr">dir:</span> <span class="hljs-string">&#x27;libs&#x27;</span>, <span class="hljs-attr">include:</span> [<span class="hljs-string">&#x27;*.jar&#x27;</span>])<br>    testCompile <span class="hljs-string">&#x27;junit:junit:4.12&#x27;</span><br>    compile <span class="hljs-string">&#x27;com.android.support:appcompat-v7:25.1.0&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ¥çœ‹3ä¸ªä¸»è¦çš„ä»£ç å—ã€‚</p><h4 id="plugin"><a href="#plugin" class="headerlink" title="plugin"></a>plugin</h4><p>ç¬¬ä¸€è¡Œåº”ç”¨äº†Android åº”ç”¨æ’ä»¶ã€‚Androidæ’ä»¶ç”±Googleå›¢é˜Ÿå¼€å‘ç»´æŠ¤ã€‚è¯¥æ’ä»¶æä¾›æ„å»ºï¼Œæµ‹è¯•ï¼Œæ‰“åŒ…åº”ç”¨å’Œæ¨¡å—éœ€è¦çš„æ‰€æœ‰çš„taskã€‚</p><h4 id="android"><a href="#android" class="headerlink" title="android"></a>android</h4><p>æœ€å¤§çš„ä¸€ä¸ªåŒºåŸŸã€‚defaultConfigåŒºåŸŸå¯¹appæ ¸å¿ƒè¿›è¡Œé…ç½®ï¼Œä¼šé…ç½®è¦†ç›–AndroidManifest.xmlä¸­çš„é…ç½®ã€‚</p><p>applicationIdå¤å†™æ‰manifestæ–‡ä»¶ä¸­çš„åŒ…åã€‚ä½†applicationIdå’ŒåŒ…åæœ‰åŒºåˆ«ã€‚<br>manifestä¸­çš„åŒ…åï¼Œåœ¨æºä»£ç å’ŒRæ–‡ä»¶ä¸­ä½¿ç”¨ã€‚æ‰€ä»¥package nameåœ¨android studioä¸­ç†è§£ä¸ºä¸€ä¸ªæŸ¥è¯¢ç±»çš„è·¯å¾„æ¯”è¾ƒåˆç†ã€‚<br>applicationIdåœ¨Androidç³»ç»Ÿä¸­æ˜¯ä½œä¸ºåº”ç”¨çš„å”¯ä¸€æ ‡è¯†ï¼Œå³åœ¨ä¸€ä¸ªAndroidè®¾å¤‡ä¸­æ‰€æœ‰çš„åº”ç”¨ç¨‹åºçš„applicationIdéƒ½æ˜¯å”¯ä¸€çš„ã€‚</p><h4 id="dependencies"><a href="#dependencies" class="headerlink" title="dependencies"></a>dependencies</h4><p>æ˜¯Gradleæ ‡å‡†é…ç½®çš„ä¸€éƒ¨åˆ†ã€‚<br>Androidä¸­ç”¨æ¥é…ç½®ä½¿ç”¨åˆ°çš„åº“ã€‚</p><h2 id="å®šåˆ¶åŒ–æ„å»º-Customizing-the-build"><a href="#å®šåˆ¶åŒ–æ„å»º-Customizing-the-build" class="headerlink" title="å®šåˆ¶åŒ–æ„å»º Customizing the build"></a>å®šåˆ¶åŒ–æ„å»º Customizing the build</h2><h3 id="BuildConfig-and-resources"><a href="#BuildConfig-and-resources" class="headerlink" title="BuildConfig and resources"></a>BuildConfig and resources</h3><p>è‡ªä»SDK17ä»¥æ¥ï¼Œæ„å»ºå·¥å…·ä¼šç”Ÿæˆä¸€ä¸ªBuildConfigç±»ï¼ŒåŒ…å«ç€é™æ€å˜é‡DEBUGå’Œä¸€äº›ä¿¡æ¯ã€‚<br>å¦‚æœä½ æƒ³åœ¨åŒºåˆ†debugå’Œæ­£å¼ç‰ˆï¼Œæ¯”å¦‚æ‰“logï¼Œè¿™ä¸ªBuildConfigç±»å¾ˆæœ‰ç”¨ã€‚<br>å¯ä»¥é€šè¿‡Gradleæ¥æ‰©å±•è¿™ä¸ªç±»ï¼Œè®©å®ƒæ‹¥æœ‰æ›´å¤šçš„é™æ€å˜é‡ã€‚</p><p>ä»¥NewProjå·¥ç¨‹ä¸ºä¾‹ï¼Œ<code>app\build.gradle</code></p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs groovy">android &#123;<br>    compileSdkVersion <span class="hljs-number">25</span><br>    buildToolsVersion <span class="hljs-string">&quot;25.0.2&quot;</span><br><br>    defaultConfig &#123;<br>        applicationId <span class="hljs-string">&quot;com.xxx.rust.newproj&quot;</span><br>        minSdkVersion <span class="hljs-number">18</span><br>        targetSdkVersion <span class="hljs-number">25</span><br>        versionCode <span class="hljs-number">1</span><br>        versionName <span class="hljs-string">&quot;1.0&quot;</span><br>    &#125;<br>    buildTypes &#123;<br>        debug &#123;<br>            buildConfigField(<span class="hljs-string">&quot;String&quot;</span>, <span class="hljs-string">&quot;BASE_URL&quot;</span>, <span class="hljs-string">&quot;\&quot;http://www.baidu.com\&quot;&quot;</span>)<br>            buildConfigField(<span class="hljs-string">&quot;String&quot;</span>, <span class="hljs-string">&quot;A_CONTENT&quot;</span>, <span class="hljs-string">&quot;\&quot;debug content\&quot;&quot;</span>)<br>            resValue(<span class="hljs-string">&quot;string&quot;</span>, <span class="hljs-string">&quot;str_version&quot;</span>, <span class="hljs-string">&quot;debug_ver&quot;</span>)<br>        &#125;<br>        release &#123;<br>            buildConfigField(<span class="hljs-string">&quot;String&quot;</span>, <span class="hljs-string">&quot;BASE_URL&quot;</span>, <span class="hljs-string">&quot;\&quot;http://www.qq.com\&quot;&quot;</span>)<br>            buildConfigField(<span class="hljs-string">&quot;String&quot;</span>, <span class="hljs-string">&quot;A_CONTENT&quot;</span>, <span class="hljs-string">&quot;\&quot;release content\&quot;&quot;</span>)<br>            resValue(<span class="hljs-string">&quot;string&quot;</span>, <span class="hljs-string">&quot;str_version&quot;</span>, <span class="hljs-string">&quot;release_ver&quot;</span>)<br><br>            minifyEnabled <span class="hljs-literal">false</span><br>            proguardFiles getDefaultProguardFile(<span class="hljs-string">&#x27;proguard-android.txt&#x27;</span>), <span class="hljs-string">&#x27;proguard-rules.pro&#x27;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„<code>buildConfigField</code>å’Œ<code>resValue</code>åœ¨ç¼–è¯‘åï¼Œèƒ½åœ¨æºä»£ç ä¸­ä½¿ç”¨<br>æ³¨æ„ä¸Šé¢é‚£ä¸ªè½¬ä¹‰çš„åˆ†å·ä¸å¯å°‘ï¼›æ³¨æ„é‡Œé¢çš„å¤§å°å†™ï¼Œè¿™é‡Œä¼ å…¥çš„å‚æ•°å°±åƒæ˜¯ç›´æ¥å¡«å…¥çš„ä»£ç ä¸€æ ·</p><p>ä¸‹é¢æ˜¯ç¼–è¯‘åç”Ÿæˆçš„BuildConfigæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°buildConfigFieldçš„ä¸œè¥¿å·²ç»åœ¨é‡Œé¢äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BuildConfig</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">DEBUG</span> <span class="hljs-operator">=</span> Boolean.parseBoolean(<span class="hljs-string">&quot;true&quot;</span>);<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">APPLICATION_ID</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;com.xxx.rust.newproj&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">BUILD_TYPE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;debug&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">FLAVOR</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">VERSION_CODE</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">VERSION_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;1.0&quot;</span>;<br>  <span class="hljs-comment">// Fields from build type: debug</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">A_CONTENT</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;debug content&quot;</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">BASE_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;http://www.baidu.com&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>resValueä¼šè¢«æ·»åŠ åˆ°èµ„æºæ–‡ä»¶ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">mTv2.setText(R.string.str_version);<br></code></pre></td></tr></table></figure><h3 id="é€šè¿‡-build-gradle-å¢åŠ è·å–-applicationId-çš„æ–¹å¼"><a href="#é€šè¿‡-build-gradle-å¢åŠ è·å–-applicationId-çš„æ–¹å¼" class="headerlink" title="é€šè¿‡ build.gradle å¢åŠ è·å– applicationId çš„æ–¹å¼"></a>é€šè¿‡ build.gradle å¢åŠ è·å– applicationId çš„æ–¹å¼</h3><p>æ¨¡å—<code>build.gradle</code>ä¸­æ·»åŠ å±æ€§<code>applicationId</code>ï¼Œä¼šè¢«ç¼–è¯‘åˆ°BuildConfigä¸­<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">project.afterEvaluate &#123;<br>    project.android.applicationVariants.all &#123; variant -&gt;<br>        <span class="hljs-keyword">def</span> applicationId = [variant.mergedFlavor.applicationId, variant.buildType.applicationIdSuffix].findAll().join()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>åœ¨ä»£ç ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">String</span> <span class="hljs-variable">appID</span> <span class="hljs-operator">=</span> BuildConfig.APPLICATION_ID;<br></code></pre></td></tr></table></figure></p><h3 id="è·å–æ—¶é—´çš„æ–¹æ³•"><a href="#è·å–æ—¶é—´çš„æ–¹æ³•" class="headerlink" title="è·å–æ—¶é—´çš„æ–¹æ³•"></a>è·å–æ—¶é—´çš„æ–¹æ³•</h3><p>æ¨¡å—<code>build.gradle</code>ä¸­æ·»åŠ æ–¹æ³•<code>getTime()</code>ï¼Œå¹¶åœ¨<code>buildTypes</code>ä¸­æ·»åŠ åŸŸã€‚<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-comment">// è·å–å½“å‰æ—¶é—´</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">def</span> getTime() &#123;<br>    String timeNow = <span class="hljs-keyword">new</span> Date().format(<span class="hljs-string">&#x27;YYYYMMdd-HHmmss&#x27;</span>)<br>    <span class="hljs-keyword">return</span> timeNow<br>&#125;<br><br>android &#123;<br>    <span class="hljs-comment">// ...</span><br>    buildTypes &#123;<br>        debug &#123;<br>            buildConfigField <span class="hljs-string">&quot;String&quot;</span>, <span class="hljs-string">&quot;BUILD_TIME&quot;</span>, <span class="hljs-string">&quot;\&quot;&quot;</span> + getTime() + <span class="hljs-string">&quot;\&quot;&quot;</span><br>        &#125;<br>        release &#123;<br>            buildConfigField <span class="hljs-string">&quot;String&quot;</span>, <span class="hljs-string">&quot;BUILD_TIME&quot;</span>, <span class="hljs-string">&quot;\&quot;&quot;</span> + getTime() + <span class="hljs-string">&quot;\&quot;&quot;</span><br>            <span class="hljs-comment">// ...</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p><code>BuildConfig.java</code>ä¸­å¾—åˆ°è¿™ä¸ªåŸŸã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// Fields from build type: debug</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">BUILD_TIME</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;20180912-100335&quot;</span>;<br></code></pre></td></tr></table></figure></p><h3 id="ä¿®æ”¹release-apkæ–‡ä»¶åçš„æ–¹æ³•"><a href="#ä¿®æ”¹release-apkæ–‡ä»¶åçš„æ–¹æ³•" class="headerlink" title="ä¿®æ”¹release apkæ–‡ä»¶åçš„æ–¹æ³•"></a>ä¿®æ”¹release apkæ–‡ä»¶åçš„æ–¹æ³•</h3><p>gradleç‰ˆæœ¬3.1.4ã€‚ä½¿ç”¨äº†ä¸Šé¢çš„æ–¹æ³•<code>getTime()</code>ã€‚</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs groovy">android &#123;<br>    <span class="hljs-comment">// ...</span><br>    <span class="hljs-comment">// ä¿®æ”¹releaseçš„apkåå­—</span><br>    applicationVariants.all &#123; variant -&gt;<br>        variant.outputs.all &#123;<br>            <span class="hljs-keyword">if</span> (variant.buildType.name == <span class="hljs-string">&#x27;release&#x27;</span>) &#123;<br>                outputFileName = <span class="hljs-string">&quot;xxx_release_$&#123;defaultConfig.versionName&#125;_$&#123;getTime()&#125;.apk&quot;</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥å‰çš„æ–¹æ³•å¯èƒ½ä¼šé‡åˆ°é—®é¢˜ï¼š<code>Cannot set the value of read-only property &#39;outputFile&#39; for ApkVariantOutputImpl_Decorated</code>ã€‚<br>å‚è€ƒï¼š<a href="https://stackoverflow.com/questions/44239235/android-gradle-3-0-0-alpha2-plugin-cannot-set-the-value-of-read-only-property">https://stackoverflow.com/questions/44239235/android-gradle-3-0-0-alpha2-plugin-cannot-set-the-value-of-read-only-property</a></p><h3 id="å·¥ç¨‹èŒƒå›´çš„è®¾ç½®"><a href="#å·¥ç¨‹èŒƒå›´çš„è®¾ç½®" class="headerlink" title="å·¥ç¨‹èŒƒå›´çš„è®¾ç½®"></a>å·¥ç¨‹èŒƒå›´çš„è®¾ç½®</h3><p>å¦‚æœä¸€ä¸ªå·¥ç¨‹ä¸­æœ‰å¤šä¸ªæ¨¡å—ï¼Œå¯ä»¥å¯¹æ•´ä¸ªå·¥ç¨‹åº”ç”¨è®¾ç½®ï¼Œè€Œä¸ç”¨å»ä¿®æ”¹æ¯ä¸€ä¸ªæ¨¡å—ã€‚</p><p><code>NewProj\build.gradle</code><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs groovy">allprojects &#123;<br>    repositories &#123;<br>        jcenter()<br>    &#125;<br>&#125;<br><br>ext &#123;<br>    compileSDKVersion = <span class="hljs-number">25</span><br>    local = <span class="hljs-string">&#x27;Hello from the top-level build&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure></p><p>æ¯ä¸€ä¸ª<code>build.gradle</code>æ–‡ä»¶éƒ½èƒ½å®šä¹‰é¢å¤–çš„å±æ€§ï¼Œåœ¨extä»£ç å—ä¸­ã€‚</p><p>åœ¨ä¸€ä¸ªæ¨¡å—çš„<code>libmodule\build.gradle</code>æ–‡ä»¶ä¸­ï¼Œå¯ä»¥å¼•ç”¨rootProjectçš„extå±æ€§</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs groovy">android &#123;<br>    compileSdkVersion rootProject.ext.compileSDKVersion<br>    buildToolsVersion <span class="hljs-string">&quot;25.0.2&quot;</span><br>    <span class="hljs-comment">// ....</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å·¥ç¨‹å±æ€§-Project-properties"><a href="#å·¥ç¨‹å±æ€§-Project-properties" class="headerlink" title="å·¥ç¨‹å±æ€§ Project properties"></a>å·¥ç¨‹å±æ€§ Project properties</h3><p>å®šä¹‰propertiesçš„åœ°æ–¹</p><ul><li>extä»£ç å—</li><li>gradle.propertiesæ–‡ä»¶</li><li>å‘½ä»¤è¡Œ -P å‚æ•°</li></ul><p>å·¥ç¨‹<code>build.gradle</code>æ–‡ä»¶<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs groovy">ext &#123;<br>    compileSDKVersion = <span class="hljs-number">25</span><br>    local = <span class="hljs-string">&#x27;Hello from the top-level build&#x27;</span><br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Print properties info</span><br><span class="hljs-comment"> */</span><br>task aPrintSomeInfo &#123;<br>    println(local)<br>    println(<span class="hljs-string">&#x27;project dir: &#x27;</span> + projectDir)<br>    println(projectPropertiesFileText)<br>&#125;<br><br>task aPrintAllProperites() &#123;<br>    println(<span class="hljs-string">&#x27;\nthis is aPrintAllProperites task\n&#x27;</span>)<br>    Iterator pIt = properties.iterator()<br>    <span class="hljs-keyword">while</span> (pIt.hasNext()) &#123;<br>        println(pIt.next())<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>gradle.propertiesæ–‡ä»¶ä¸­å¢åŠ <br><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">projectPropertiesFileText</span> <span class="hljs-operator">=</span> Hello there from gradle.properties<br></code></pre></td></tr></table></figure></p><p>åœ¨asçš„Gradleæ ä¸ŠåŒå‡»æ‰§è¡ŒaPrintSomeInfoï¼Œä¼šè¿å¸¦ä¸‹ä¸€ä¸ªtaskä¹Ÿæ‰§è¡Œ</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-number">13</span>:<span class="hljs-number">08</span>:<span class="hljs-number">10</span>: Executing external <span class="hljs-keyword">task</span> <span class="hljs-string">&#x27;aPrintSomeInfo&#x27;</span>...<br>Hello <span class="hljs-keyword">from</span> the top-level build<br><span class="hljs-keyword">project</span> dir: G:\openSourceProject\NewProj<br>Hello there <span class="hljs-keyword">from</span> gradle.properties<br><br><span class="hljs-keyword">this</span> is aPrintAllProperites <span class="hljs-keyword">task</span><br>......<br>BUILD SUCCESSFUL<br><br>Total time: <span class="hljs-number">1.025</span> secs<br><span class="hljs-number">13</span>:<span class="hljs-number">08</span>:<span class="hljs-number">11</span>: External <span class="hljs-keyword">task</span> execution finished <span class="hljs-string">&#x27;aPrintSomeInfo&#x27;</span>.<br></code></pre></td></tr></table></figure><p>å‚è€ƒï¼š<em>Gradle for Android</em>  Kevin Pelgrims</p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gradle for Android å¼€å§‹</title>
    <link href="/2017/01/19/Android/Gradle_for_android_Start/"/>
    <url>/2017/01/19/Android/Gradle_for_android_Start/</url>
    
    <content type="html"><![CDATA[<h1 id="Gradle-for-Androidå¼€å§‹"><a href="#Gradle-for-Androidå¼€å§‹" class="headerlink" title="Gradle for Androidå¼€å§‹"></a>Gradle for Androidå¼€å§‹</h1><p>Googleåœ¨Gradleä¸­çš„ç›®æ ‡ï¼šèƒ½å¤ç”¨ä»£ç ï¼Œåˆ›å»ºæ„å»ºå˜é‡ï¼Œèƒ½é…ç½®å’Œå®šåˆ¶æ„å»ºè¿‡ç¨‹ã€‚</p><h2 id="GradleåŸºç¡€"><a href="#GradleåŸºç¡€" class="headerlink" title="GradleåŸºç¡€"></a>GradleåŸºç¡€</h2><p>Gradleæ„å»ºè„šæœ¬å¹¶ä¸æ˜¯ç”¨XMLæ¥å†™çš„ï¼Œè€Œæ˜¯åŸºäºGroovyçš„ä¸€ç§ï¼ˆdomain-specifc languageï¼‰<br>DSLè¯­è¨€ã€‚è¿™æ˜¯ä¸€ç§è¿è¡Œåœ¨JVMä¸Šçš„åŠ¨æ€è¯­è¨€ã€‚</p><p>å¦‚æœè¦æ„å»ºæ–°çš„ä»»åŠ¡å’Œæ’ä»¶ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£è¿™é—¨è¯­è¨€ã€‚</p><h2 id="Projects-and-tasks"><a href="#Projects-and-tasks" class="headerlink" title="Projects and tasks"></a>Projects and tasks</h2><p>è¿™æ˜¯Gradleç§æœ€é‡è¦çš„ä¸¤ä¸ªæ¦‚å¿µã€‚æ¯ä¸ªæ„å»ºï¼ˆbuildï¼‰è‡³å°‘åŒ…å«ä¸€ä¸ªprojectï¼Œæ¯ä¸€ä¸ªprojectåŒ…å«<br>ä¸€ä¸ªæˆ–å¤šä¸ªtaskã€‚æ¯ä¸ª<code>build.gradle</code>ä»£è¡¨ä¸€ä¸ªprojectã€‚taskè¢«å®šä¹‰åœ¨è¿™ä¸ªæ„å»ºè„šæœ¬ä¸­ã€‚<br>ä¸€ä¸ªtaskå¯¹è±¡åŒ…å«ä¸€åˆ—éœ€è¦è¢«æ‰§è¡Œçš„Actionå¯¹è±¡ã€‚ä¸€ä¸ªActionå¯¹è±¡å°±æ˜¯ä¸€å—è¢«æ‰§è¡Œçš„ä»£ç ï¼Œå°±åƒ<br>Javaä¸­çš„æ–¹æ³•ã€‚</p><p>å½“åˆå§‹åŒ–æ„å»ºè¿›ç¨‹æ—¶ï¼ŒGradleæ”¶é›†buildæ–‡ä»¶ä¸­çš„projectå’Œtaskå¯¹è±¡ã€‚</p><h2 id="æ„å»ºçš„ç”Ÿå‘½å‘¨æœŸï¼ˆThe-build-lifecycleï¼‰"><a href="#æ„å»ºçš„ç”Ÿå‘½å‘¨æœŸï¼ˆThe-build-lifecycleï¼‰" class="headerlink" title="æ„å»ºçš„ç”Ÿå‘½å‘¨æœŸï¼ˆThe build lifecycleï¼‰"></a>æ„å»ºçš„ç”Ÿå‘½å‘¨æœŸï¼ˆThe build lifecycleï¼‰</h2><p>ä¸ºç®€åŒ–æ„å»ºè¿‡ç¨‹ï¼Œæ„å»ºå·¥å…·åˆ›é€ äº†ä¸€ç§å·¥ä½œæµçš„åŠ¨æ€æ¨¡å‹DAGï¼ˆDirected Acyclic Graphï¼‰ã€‚<br>è¿™æ„å‘³ç€æ‰€æœ‰çš„ä»»åŠ¡ä¼šä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ‰§è¡Œï¼Œä¸ä¼šå‡ºç°å¾ªç¯çš„æƒ…å†µã€‚<br>ä¸€ä¸ªä»»åŠ¡ä¸€æ—¦è¢«æ‰§è¡Œå°±ä¸ä¼šå†è¢«è°ƒç”¨ã€‚æ²¡æœ‰ä¾èµ–çš„ä»»åŠ¡æ°¸è¿œæ˜¯æœ€ä¼˜å…ˆæ‰§è¡Œçš„ã€‚<br>åœ¨é…ç½®è¿‡ç¨‹ä¸­ç”Ÿæˆä¾èµ–å…³ç³»ã€‚</p><p>ä¸€ä¸ªGradleæ„å»ºè¿‡ç¨‹æœ‰3ä¸ªæ­¥éª¤ï¼š</p><ul><li>åˆå§‹åŒ–ï¼šå·¥ç¨‹å®ä¾‹è¢«åˆ›å»ºæ—¶åˆå§‹åŒ–ã€‚å¦‚æœæœ‰å¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—æœ‰è‡ªå·±çš„<code>build.gradle</code>æ–‡ä»¶ï¼Œ<br>å¤šä¸ªprojectè¢«åˆ›å»ºã€‚</li><li>é…ç½®ï¼šè¿™ä¸€æ­¥æ‰§è¡Œbuildè„šæœ¬ï¼Œåˆ›å»ºå¹¶é…ç½®æ¯ä¸ªprojectçš„taskã€‚</li><li>æ‰§è¡Œï¼šGradleå†³å®šæ‰§è¡Œé‚£äº›ä»»åŠ¡ã€‚æ ¹æ®å½“å‰ç›®å½•å’Œä¼ å…¥å‚æ•°æ‰§è¡Œtaskã€‚</li></ul><h2 id="buildé…ç½®æ–‡ä»¶"><a href="#buildé…ç½®æ–‡ä»¶" class="headerlink" title="buildé…ç½®æ–‡ä»¶"></a>buildé…ç½®æ–‡ä»¶</h2><p><code>build.gradle</code>æ–‡ä»¶ã€‚é…ç½®buildçš„åœ°æ–¹ã€‚</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs groovy">buildscript &#123;<br>    repositories &#123;<br>        jcenter()<br>    &#125;<br>    dependencies &#123;<br>        classpath <span class="hljs-string">&#x27;com.android.tools.build:gradle:2.2.2&#x27;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>repositorieså—ä¸­ï¼ŒæŒ‡å®šJCenterä½œä¸ºä¾èµ–ä»“åº“ã€‚<br>è¿™ä¸ªè„šæœ¬è·å–äº†Androidæ„å»ºå·¥å…·ã€‚è¿™ä¸ªAndroidæ’ä»¶æä¾›äº†æ„å»ºå’Œæµ‹è¯•åº”ç”¨æ‰€éœ€çš„åŠŸèƒ½ã€‚</p><p>æ’ä»¶è¢«ç”¨æ¥æ‰©å±•Gradleæ„å»ºè„šæœ¬çš„åŠŸèƒ½ã€‚åœ¨projectä¸­ä½¿ç”¨æ’ä»¶ï¼Œå°±å¯ä»¥å®šä¹‰å±æ€§å’Œä»»åŠ¡ã€‚</p><h2 id="Gradle-Wrapperåˆæ­¥"><a href="#Gradle-Wrapperåˆæ­¥" class="headerlink" title="Gradle Wrapperåˆæ­¥"></a>Gradle Wrapperåˆæ­¥</h2><p>Gradleæ˜¯ä¸€ä¸ªå¼€å‘ä¸­çš„å·¥å…·ã€‚ä½¿ç”¨Gradle Wrapperå¯ä»¥é¿å…ä¸€äº›é—®é¢˜ï¼Œç¡®ä¿èƒ½æ„å»ºé¡ºåˆ©ã€‚<br>Gradleåœ¨Windowsç³»ç»Ÿä¸Šæä¾›äº†batchæ–‡ä»¶ï¼Œåœ¨å…¶ä»–ç³»ç»Ÿä¸Šæä¾›äº†shellè„šæœ¬ã€‚è¯•å›¾è¿è¡Œè„šæœ¬æ—¶ï¼Œä¼š<br>è‡ªåŠ¨æ£€æŸ¥å¹¶ä¸‹è½½Gradleã€‚ä½†åœ¨æˆ‘ä»¬çš„ç½‘ç»œæ¯”è¾ƒä»¤äººç€æ€¥ã€‚å¯ä»¥å°è¯•åœ¨ç½‘ç»œä¸Šæ‰¾èµ„æºã€‚</p><p>æ¯”å¦‚æˆ‘ä¸‹è½½äº†ä¸€ä¸ª<code>gradle-2.14.1-all.zip</code>ï¼Œå°†å…¶æ”¾åˆ°Androidå·¥ç¨‹çš„gradle/wrapperä¸‹</p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ada">gradle<br>`<span class="hljs-comment">-- wrapper</span><br>    |<span class="hljs-comment">-- gradle-2.14.1-all.zip</span><br>    |<span class="hljs-comment">-- gradle-wrapper.jar</span><br>    `<span class="hljs-comment">-- gradle-wrapper.properties</span><br></code></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹<code>gradle-wrapper.properties</code>æ–‡ä»¶ï¼ŒæŠŠUrlä¿®æ”¹æˆ<br><code>distributionUrl=gradle-2.14.1-all.zip</code></p><p>åœ¨Android Studioæä¾›çš„Terminalä¸­è¿è¡Œ<code>grawdlew</code>ï¼Œå…ˆunzippingï¼Œç„¶åå¼€å§‹ä¸‹è½½ä¾èµ–æ–‡ä»¶ã€‚<br>è¿™äº›æ–‡ä»¶åœ¨windowsä¸­é»˜è®¤å­˜æ”¾åˆ°<br><code>C:\Users\UserName\.gradle\wrapper\dists\gradle-2.14.1-all</code>ï¼Œè¿˜æ˜¯å¾ˆå ç©ºé—´çš„ã€‚<br>æ­¤æ—¶ä½ å¯ä»¥åœ¨é¡¹ç›®ä¸‹çš„å‘½ä»¤è¡Œä¸­ä½¿ç”¨grawdlewå‘½ä»¤ã€‚æ¯”å¦‚æŸ¥çœ‹ç‰ˆæœ¬ã€‚</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc">G:\rust_proj\NDKProj&gt;gradlew -v<br><br><span class="hljs-code">------------------------------------------------------------</span><br><span class="hljs-code">Gradle 2.14.1</span><br><span class="hljs-code">------------------------------------------------------------</span><br><br>Build time:   2016-07-18 06:38:37 UTC<br>Revision:     d9e2113d9fb05a5caabba61798bdb8dfdca83719<br><br>Groovy:       2.4.4<br>Ant:          Apache Ant(TM) version 1.9.6 compiled on June 29 2015<br>JVM:          1.8.0_77 (Oracle Corporation 25.77-b03)<br>OS:           Windows 7 6.1 amd64<br></code></pre></td></tr></table></figure><p>å¦‚æœåœ¨å¦ä¸€ä¸ªAndroidé¡¹ç›®ä¸‹åŒæ ·å¤åˆ¶äº†<code>gradle-2.14.1-all.zip</code>ï¼Œå¹¶ä¸”å°è¯•è¿è¡Œgradlewï¼Œ<br>Cç›˜é‡Œç›¸åº”ç›®å½•ä¸‹åˆä¼šå¤šä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚</p><h2 id="è·å–Gradle-Wrapper"><a href="#è·å–Gradle-Wrapper" class="headerlink" title="è·å–Gradle Wrapper"></a>è·å–Gradle Wrapper</h2><p>æ‰“å¼€Windows CMDï¼Œè¿›å…¥å‰é¢é…ç½®å¥½çš„Androidå·¥ç¨‹ç›®å½•ï¼ŒåŒæ ·å¯ä»¥è¿è¡Œgradlewã€‚</p><p>æ­¤æ—¶æˆ‘ä»¬çš„Cç›˜é‡Œå·²ç»æœ‰<code>gradle-2.14.1-all.zip</code>äº†ã€‚æ‰¾åˆ°<code>gradle.bat</code>çš„è·¯å¾„ï¼Œå°†å…¶æ·»åŠ åˆ°<br>ç”µè„‘PATHä¸­ã€‚è¿™é‡Œæ·»åŠ åˆ°ç”¨æˆ·çš„ç¯å¢ƒå˜é‡ä¸­ã€‚</p><p>åœ¨Gç›˜æ–°å»ºä¸€ä¸ªç›®å½•<code>gradleTest</code>ï¼Œç„¶ååˆ›å»ºä¸€ä¸ª<code>build.gradle</code>æ–‡ä»¶ï¼›å…¶ä¸­å¡«å†™å¦‚ä¸‹ä»£ç </p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">task <span class="hljs-keyword">wrapper</span>(<span class="hljs-keyword">type</span>: <span class="hljs-keyword">Wrapper</span>) &#123;<br>    gradleVersion = <span class="hljs-string">&#x27;2.4&#x27;</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿›å…¥åˆšæ‰çš„ç›®å½•ï¼Œåœ¨CMDä¸­ç›´æ¥è¿è¡Œgradle</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs routeros">G:\gradleTest&gt;gradle<br>:help<br>Welcome <span class="hljs-keyword">to</span> Gradle 2.14.1.<br><span class="hljs-keyword">To</span> <span class="hljs-built_in">run</span> a build, <span class="hljs-built_in">run</span> gradle &lt;task&gt; <span class="hljs-built_in">..</span>.<br><span class="hljs-keyword">To</span> see a list of available tasks, <span class="hljs-built_in">run</span> gradle tasks<br><span class="hljs-keyword">To</span> see a list of command-line options, <span class="hljs-built_in">run</span> gradle --help<br><span class="hljs-keyword">To</span> see more detail about a task, <span class="hljs-built_in">run</span> gradle help --task &lt;task&gt;<br>BUILD SUCCESSFUL<br>Total time: 1.714 secs<br></code></pre></td></tr></table></figure><p>æ­¤æ—¶ç›®å½•ä¸‹ç”Ÿæˆäº†ä¸€ä¸ª<code>.gradle</code>ç›®å½•</p><p>å¦‚æœå½“å‰ç›®å½•ä¸‹æ²¡æœ‰<code>build.gradle</code>æ–‡ä»¶ï¼Œgradleä¹Ÿä¼šæ‰§è¡Œå¹¶ç”Ÿæˆ<code>.gradle</code>ç›®å½•ã€‚</p><p>æˆ‘ä»¬æ¥è§‚å¯ŸAndroidé¡¹ç›®é‡ŒGradle Wrapperçš„æƒ…å†µ<br><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">NDKProj/<br>â”œâ”€â”€ gradlew<br>â”œâ”€â”€ gradlew.bat<br>â””â”€â”€ gradle/<span class="hljs-keyword">wrapper</span>/<br>    â”œâ”€â”€ gradle-<span class="hljs-keyword">wrapper</span>.jar<br>    â””â”€â”€ gradle-<span class="hljs-keyword">wrapper</span>.properties<br></code></pre></td></tr></table></figure><br>Gradle WrapperåŒ…å«3ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>MSå¯æ‰§è¡Œçš„gradlew.batå’ŒLinuxï¼Œ Mac OS Xå¯æ‰§è¡Œçš„gradlew</li><li>è„šæœ¬éœ€è¦çš„Jaræ–‡ä»¶</li><li>ä¸€ä¸ªpropertiesæ–‡ä»¶</li></ul><p>åœ¨å‰é¢æˆ‘ä»¬å·²ç»æŠŠpropertiesæ–‡ä»¶ä¿®æ”¹æˆäº†è¿™æ ·ï¼š<br><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-meta">#Mon Aug 29 19:26:36 CST 2016</span><br>distributionBase=GRADLE_USER_HOME<br>distributionPath=<span class="hljs-keyword">wrapper</span>/dists<br>zipStoreBase=GRADLE_USER_HOME<br>zipStorePath=<span class="hljs-keyword">wrapper</span>/dists<br>distributionUrl=gradle<span class="hljs-number">-2.14</span><span class="hljs-number">.1</span>-<span class="hljs-keyword">all</span>.zip<br></code></pre></td></tr></table></figure></p><p>åŸdistributionUrlå¦‚ä¸‹ï¼š<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">distributionUrl</span>=https\://services.gradle.org/distributions/gradle-<span class="hljs-number">2</span>.<span class="hljs-number">14</span>.<span class="hljs-number">1</span>-<span class="hljs-literal">all</span>.zip<br></code></pre></td></tr></table></figure></p><p>è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸åŒçš„URLå’ŒGradleã€‚æˆ‘ä»¬å‰é¢å·²ç»è¿™ä¹ˆåšäº†ã€‚</p><h2 id="è¿è¡ŒåŸºæœ¬çš„æ„å»ºä»»åŠ¡ï¼ˆtaskï¼‰"><a href="#è¿è¡ŒåŸºæœ¬çš„æ„å»ºä»»åŠ¡ï¼ˆtaskï¼‰" class="headerlink" title="è¿è¡ŒåŸºæœ¬çš„æ„å»ºä»»åŠ¡ï¼ˆtaskï¼‰"></a>è¿è¡ŒåŸºæœ¬çš„æ„å»ºä»»åŠ¡ï¼ˆtaskï¼‰</h2><p>è¿›å…¥Androidå·¥ç¨‹ç›®å½•ä¸‹ï¼Œç”¨å‘½ä»¤è¡Œæ‰§è¡Œgradlew<br><code>gradlew tasks</code>ä¼šæ‰“å°å‡ºä»»åŠ¡åˆ—è¡¨ï¼›<code>gradlew tasks --all</code>æ‰“å°å‡ºæ‰€æœ‰çš„ä»»åŠ¡</p><p><code>gradlew assembleDebug</code>ç¼–è¯‘å½“å‰é¡¹ç›®ï¼Œåˆ›å»ºä¸€ä¸ªdebugç‰ˆæœ¬çš„apk</p><p><code>gradlew clean</code>æ¸…ç†å½“å‰é¡¹ç›®çš„output</p><p><code>gradlew check</code>è¿è¡Œæ‰€æœ‰çš„æ£€æŸ¥ï¼Œé€šå¸¸æ˜¯åœ¨çœŸæœºæˆ–è€…æ¨¡æ‹Ÿå™¨ä¸Šè¿è¡Œæµ‹è¯•</p><p><code>gradlew build</code>è§¦å‘assemble å’Œ check</p><p>è¿™äº›åŠŸèƒ½åœ¨Android Studioä¸Šéƒ½æœ‰ç›¸åº”æŒ‰é”®</p><p>å‚è€ƒï¼š<em>Gradle for Android</em>  Kevin Pelgrims</p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gradle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PyQt QMainWindow ç®€å•ä½¿ç”¨</title>
    <link href="/2016/12/28/PyQt_note/PyQt-QMainWindow_simple_practice/"/>
    <url>/2016/12/28/PyQt_note/PyQt-QMainWindow_simple_practice/</url>
    
    <content type="html"><![CDATA[<p>QMainWindowç»§æ‰¿è‡ªQWidget<br>QMainWindowç›¸å½“äºç¨‹åºçš„ä¸»ç•Œé¢ï¼Œå†…ç½®äº†menuå’ŒtoolBarã€‚<br>ä½¿ç”¨ Qt Designer å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ·»åŠ menué€‰é¡¹ã€‚</p><p>å¯¹äºè¾ƒå¤§å‹çš„ç•Œé¢ï¼Œç”¨Qt Designeræ¯”è¾ƒæ–¹ä¾¿ã€‚<code>.ui</code>æ–‡ä»¶å°±åƒAndroidä¸­ä½¿ç”¨xmlä¸€æ ·ã€‚<br>ç”»å‡ºçš„uiæ–‡ä»¶å¯ä»¥ç”¨PyQtä¸­çš„PyUICè½¬æ¢æˆpyæ–‡ä»¶ã€‚è½¬æ¢åçš„pyæ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªclassã€‚<br>æ–°å»ºä¸€ä¸ªç»§æ‰¿è‡ªQMainWindowçš„ç±»ï¼Œæ¥è°ƒç”¨ç”Ÿæˆçš„è¿™ä¸ªç±»ã€‚</p><p>ä¸»çª—å£å…³é—­æ—¶ï¼Œä¼šè°ƒç”¨<code>closeEvent(self, *args, **kwargs)</code>ï¼Œå¯å¤å†™è¿™ä¸ªæ–¹æ³•ï¼ŒåŠ ä¸Šä¸€äº›å…³é—­æ—¶çš„æ“ä½œã€‚<br>æ¯”å¦‚ç»ˆæ­¢å­çº¿ç¨‹ï¼Œå…³é—­æ•°æ®åº“æ¥å£ï¼Œé‡Šæ”¾èµ„æºç­‰ç­‰æ“ä½œã€‚</p><h2 id="PyQt5-æ‰‹å†™-QMainWindow-ç¤ºä¾‹"><a href="#PyQt5-æ‰‹å†™-QMainWindow-ç¤ºä¾‹" class="headerlink" title="PyQt5 æ‰‹å†™ QMainWindow ç¤ºä¾‹"></a>PyQt5 æ‰‹å†™ QMainWindow ç¤ºä¾‹</h2><p>Win7  PyCharm  Python3.5.1  PyQt5</p><p>æ‰‹å†™ä¸€ä¸ªmain windowï¼Œä¸»è¦ä½¿ç”¨äº†èœå•æ ã€æ–‡æœ¬ç¼–è¾‘æ¡†ã€å·¥å…·æ å’ŒçŠ¶æ€æ <br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ada">|<span class="hljs-comment">-- main.py</span><br>|<span class="hljs-comment">-- res</span><br>|   `<span class="hljs-comment">-- sword.png</span><br>`<span class="hljs-comment">-- ui</span><br>    `<span class="hljs-comment">-- app_main_window.py</span><br></code></pre></td></tr></table></figure></p><p><code>main.py</code>ä¸»æ–‡ä»¶<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> QApplication<br><span class="hljs-keyword">from</span> ui.app_main_window <span class="hljs-keyword">import</span> AppMainWindow<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app = QApplication(sys.argv)<br>    window = AppMainWindow()<br>    window.show()<br>    sys.exit(app.exec_())<br></code></pre></td></tr></table></figure></p><p><code>app_main_window.py</code>çª—å£å®ç°æ–‡ä»¶<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PyQt5.QtCore <span class="hljs-keyword">import</span> QCoreApplication<br><span class="hljs-keyword">from</span> PyQt5.QtGui <span class="hljs-keyword">import</span> QIcon<br><span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> QAction<br><span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> QMainWindow<br><span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> QTextEdit<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AppMainWindow</span>(<span class="hljs-title class_ inherited__">QMainWindow</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    èœå•æ ã€æ–‡æœ¬ç¼–è¾‘æ¡†ã€å·¥å…·æ å’ŒçŠ¶æ€æ </span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__()<br>        self.init_ui()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">init_ui</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># èœå•æ </span><br>        self.statusBar().showMessage(<span class="hljs-string">&#x27;Main window is ready&#x27;</span>)<br>        self.setGeometry(<span class="hljs-number">500</span>, <span class="hljs-number">500</span>, <span class="hljs-number">450</span>, <span class="hljs-number">220</span>)<br>        self.setMinimumSize(<span class="hljs-number">150</span>, <span class="hljs-number">120</span>)<br>        self.setWindowTitle(<span class="hljs-string">&#x27;MainWindow&#x27;</span>)<br><br>        <span class="hljs-comment"># æ–‡æœ¬ç¼–è¾‘æ¡†</span><br>        text_edit = QTextEdit()<br>        self.setCentralWidget(text_edit)  <span class="hljs-comment"># å¡«å……å‰©ä¸‹çš„ä½ç½®</span><br><br>        <span class="hljs-comment"># å®šä¹‰é€€å‡ºåŠ¨ä½œ</span><br>        exit_action = QAction(QIcon(<span class="hljs-string">&#x27;res/sword.png&#x27;</span>), <span class="hljs-string">&#x27;Exit&#x27;</span>, self)<br>        exit_action.setShortcut(<span class="hljs-string">&#x27;Ctrl+Q&#x27;</span>)<br>        exit_action.setStatusTip(<span class="hljs-string">&#x27;Exit App&#x27;</span>)  <span class="hljs-comment"># é¼ æ ‡æŒ‡å‘é€‰é¡¹æ—¶åœ¨çª—å£çŠ¶æ€æ å‡ºç°çš„æç¤º</span><br>        <span class="hljs-comment"># exit_action.triggered.connect(QCoreApplication.instance().quit)</span><br>        exit_action.triggered.connect(self.close)  <span class="hljs-comment"># å…³é—­app</span><br><br>        <span class="hljs-comment"># å®šä¹‰èœå•æ ï¼Œæ·»åŠ ä¸€ä¸ªé€‰é¡¹</span><br>        menu_bar = self.menuBar()<br>        file_menu = menu_bar.addMenu(<span class="hljs-string">&#x27;&amp;File&#x27;</span>)<br>        file_menu.addAction(exit_action)<br><br>        <span class="hljs-comment"># å®šä¹‰å·¥å…·æ ï¼Œæ·»åŠ ä¸€ä¸ªé€€å‡ºåŠ¨ä½œ</span><br>        toolbar = self.addToolBar(<span class="hljs-string">&#x27;&amp;Exit&#x27;</span>)<br>        toolbar.addAction(exit_action)<br><br></code></pre></td></tr></table></figure></p><p>æœ‰çš„æ—¶å€™PyCharmç»™çš„ä»£ç æç¤ºä¸å®Œå…¨ã€‚ç½‘ä¸Šè¯´PyCharmé…åˆvimæ’ä»¶æ¥ä½¿ç”¨èƒ½å¸¦æ¥å¾ˆå¥½çš„ä½“éªŒã€‚<br>ç”Ÿæˆçš„ç•Œé¢ä¸­ï¼Œå·¥å…·æ å¯ä»¥è‡ªç”±çš„æ‹–åŠ¨ï¼Œå¯ä»¥æ”¾åœ¨ä¸Šä¸‹å·¦å³4ä¸ªåœ°æ–¹ã€‚</p><p>åŒæ ·çš„ä»£ç ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç§»æ¤åˆ°PyQt4ä¸­ã€‚</p><h2 id="ä½¿ç”¨designerç”»å‡ºæ¥çš„ç•Œé¢"><a href="#ä½¿ç”¨designerç”»å‡ºæ¥çš„ç•Œé¢" class="headerlink" title="ä½¿ç”¨designerç”»å‡ºæ¥çš„ç•Œé¢"></a>ä½¿ç”¨designerç”»å‡ºæ¥çš„ç•Œé¢</h2><p>Ubuntu</p><p>ä½¿ç”¨designerç»˜åˆ¶å¥½ç•Œé¢åï¼Œè®²uiæ–‡ä»¶è½¬æ¢æˆpyä»£ç ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> QMainWindow, QApplication<br><span class="hljs-keyword">from</span> ui_main_window <span class="hljs-keyword">import</span> Ui_UAppMainWindow<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RustMainWindow</span>(<span class="hljs-title class_ inherited__">QMainWindow</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;ä¸»ç•Œé¢ç±»&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(RustMainWindow, self).__init__()<br>        self.ma = Ui_UAppMainWindow()  <span class="hljs-comment"># designerç”»çš„ç•Œé¢</span><br>        self.ma.setupUi(self)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    app = QApplication(sys.argv)<br>    main_window = RustMainWindow()<br>    main_window.show()<br>    sys.exit(app.exec_())<br><br></code></pre></td></tr></table></figure></p><p>å¤å†™<code>__init__</code>åˆå§‹åŒ–æ–¹æ³•æ—¶éœ€è¦è°ƒç”¨çˆ¶ç±»æ–¹æ³•</p><h2 id="PyQt4æ‰‹å†™çª—å£ä»£ç "><a href="#PyQt4æ‰‹å†™çª—å£ä»£ç " class="headerlink" title="PyQt4æ‰‹å†™çª—å£ä»£ç "></a>PyQt4æ‰‹å†™çª—å£ä»£ç </h2><p>å’Œä¸Šé¢é‚£ä¸ªåŠŸèƒ½ç±»ä¼¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">from</span> PyQt4.QtGui <span class="hljs-keyword">import</span> QMainWindow, QTextEdit, QAction, QIcon, QApplication<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AppMainWindow</span>(<span class="hljs-title class_ inherited__">QMainWindow</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(AppMainWindow, self).__init__()<br>        self.init_ui()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">init_ui</span>(<span class="hljs-params">self</span>):<br>        self.statusBar().showMessage(<span class="hljs-string">&#x27;Main window is ready&#x27;</span>)<br>        self.setGeometry(<span class="hljs-number">500</span>, <span class="hljs-number">500</span>, <span class="hljs-number">450</span>, <span class="hljs-number">220</span>)<br>        self.setMinimumSize(<span class="hljs-number">150</span>, <span class="hljs-number">120</span>)<br>        self.setWindowTitle(<span class="hljs-string">&#x27;MainWindow&#x27;</span>)<br><br>        text_edit = QTextEdit()<br>        self.setCentralWidget(text_edit)<br><br>        exit_action = QAction(QIcon(<span class="hljs-string">&#x27;res/ic_s1.png&#x27;</span>), <span class="hljs-string">&#x27;Exit&#x27;</span>, self)<br>        exit_action.setShortcut(<span class="hljs-string">&#x27;Ctrl+Q&#x27;</span>)<br>        exit_action.setStatusTip(<span class="hljs-string">&#x27;Exit App&#x27;</span>)<br>        exit_action.triggered.connect(self.close)<br><br>        menu_bar = self.menuBar()<br>        file_menu = menu_bar.addMenu(<span class="hljs-string">&#x27;&amp;File&#x27;</span>)<br>        file_menu.addAction(exit_action)<br><br>        toolbar = self.addToolBar(<span class="hljs-string">&#x27;&amp;Exit&#x27;</span>)<br>        toolbar.addAction(exit_action)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app = QApplication(sys.argv)<br>    window = AppMainWindow()<br>    window.show()<br>    sys.exit(app.exec_())<br><br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºï¼ŒPyQt4 å’Œ 5 çš„ä»£ç åŸºæœ¬ä¸Šæ˜¯é€šç”¨çš„ã€‚å¤å†™<code>__init__</code>çš„æ–¹æ³•ä¸åŒã€‚</p>]]></content>
    
    
    <categories>
      
      <category>PyQt</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>PyQt åˆ›å»ºè‡ªå®šä¹‰QWidget</title>
    <link href="/2016/12/28/PyQt_note/PyQt5-Custom_QWidget/"/>
    <url>/2016/12/28/PyQt_note/PyQt5-Custom_QWidget/</url>
    
    <content type="html"><![CDATA[<h2 id="PyQt5-QtWidgets-ç¤ºä¾‹"><a href="#PyQt5-QtWidgets-ç¤ºä¾‹" class="headerlink" title="PyQt5.QtWidgets ç¤ºä¾‹"></a>PyQt5.QtWidgets ç¤ºä¾‹</h2><p>Win7  PyCharm  Python3.5.1  PyQt5</p><p>ä¸»è¦æ–‡ä»¶ï¼š<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ada">|<span class="hljs-comment">-- main.py</span><br>|<span class="hljs-comment">-- res</span><br>|   `<span class="hljs-comment">-- fish.jpg</span><br>`<span class="hljs-comment">-- ui</span><br>    `<span class="hljs-comment">-- app_widget.py</span><br></code></pre></td></tr></table></figure></p><p><code>main.py</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><br><span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> QApplication<br><br><span class="hljs-keyword">from</span> ui.app_widget <span class="hljs-keyword">import</span> AppQWidget<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app = QApplication(sys.argv)<br>    w = AppQWidget()<br>    w.show()<br><br>    sys.exit(app.exec_())<br><br></code></pre></td></tr></table></figure></p><p><code>app_main_window.py</code>è‡ªå®šä¹‰äº†ä¸€ä¸ªå±…ä¸­æ˜¾ç¤ºçš„çª—å£ï¼Œå…³é—­æ—¶å¼¹ç¡®è®¤æ¡†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> PyQt5.QtCore <span class="hljs-keyword">import</span> QCoreApplication<br><span class="hljs-keyword">from</span> PyQt5.QtGui <span class="hljs-keyword">import</span> QIcon<br><span class="hljs-keyword">from</span> PyQt5.QtWidgets <span class="hljs-keyword">import</span> QWidget, QPushButton, QDesktopWidget, QMessageBox<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AppQWidget</span>(<span class="hljs-title class_ inherited__">QWidget</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    A custom QWidget by Rust Fisher</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__()<br>        self.init_ui()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">init_ui</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># self.setGeometry(300, 300, 400, 200)  # ç›¸å½“äºmoveå’Œresize</span><br>        self.resize(<span class="hljs-number">300</span>, <span class="hljs-number">200</span>)<br>        self.move_to_center()<br>        self.setWindowTitle(<span class="hljs-string">&#x27;Demo1&#x27;</span>)<br>        self.setWindowIcon(QIcon(<span class="hljs-string">&#x27;res/fish.jpg&#x27;</span>))<br><br>        btn1 = QPushButton(<span class="hljs-string">&#x27;Quit&#x27;</span>, self)<br>        btn1.setToolTip(<span class="hljs-string">&#x27;Click to quit&#x27;</span>)<br>        btn1.resize(btn1.sizeHint())<br>        btn1.move(<span class="hljs-number">200</span>, <span class="hljs-number">150</span>)<br>        btn1.clicked.connect(QCoreApplication.instance().quit)  <span class="hljs-comment"># cannot locate function connect</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">closeEvent</span>(<span class="hljs-params">self, event</span>):<br>        reply = QMessageBox.question(self, <span class="hljs-string">&#x27;Message&#x27;</span>,<br>                                     <span class="hljs-string">&#x27;Are you sure to quit now?&#x27;</span>,<br>                                     QMessageBox.Yes | QMessageBox.No,<br>                                     QMessageBox.No)<br>        <span class="hljs-keyword">if</span> reply == QMessageBox.Yes:<br>            event.accept()<br>        <span class="hljs-keyword">else</span>:<br>            event.ignore()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">move_to_center</span>(<span class="hljs-params">self</span>):<br>        qr = self.frameGeometry()<br>        cp = QDesktopWidget().availableGeometry().center()  <span class="hljs-comment"># got center info here</span><br>        qr.moveCenter(cp)<br>        self.move(qr.topLeft())  <span class="hljs-comment"># åº”ç”¨çª—å£çš„å·¦ä¸Šæ–¹çš„ç‚¹åˆ°qrçŸ©å½¢çš„å·¦ä¸Šæ–¹çš„ç‚¹ï¼Œå› æ­¤å±…ä¸­æ˜¾ç¤ºåœ¨æˆ‘ä»¬çš„å±å¹•ä¸Š</span><br><br></code></pre></td></tr></table></figure><h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><h3 id="å¤šæ§ä»¶å¯ä»¥å­˜åœ¨listä¸­"><a href="#å¤šæ§ä»¶å¯ä»¥å­˜åœ¨listä¸­" class="headerlink" title="å¤šæ§ä»¶å¯ä»¥å­˜åœ¨listä¸­"></a>å¤šæ§ä»¶å¯ä»¥å­˜åœ¨listä¸­</h3><p>å­˜åœ¨ä¸€èµ·ï¼Œéœ€è¦å¯¹æ•´ä½“æ“ä½œæ—¶ç›´æ¥éå†åˆ—è¡¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python">    <span class="hljs-comment"># åŒç»„çš„æ§ä»¶å¯ä»¥å­˜åœ¨åŒä¸€ä¸ªlistä¸­</span><br>    self.cb_list = [<br>        self.ma.i2cCB,<br>        self.ma.mipiCB,<br>        self.ma.eepromCB,<br>        self.ma.tem_sensorCB,<br>        self.ma.lensCB,<br>        self.ma.vcmCB,<br>        self.ma.mirrorCB,<br>        self.ma.mirrorCaliCB, ]<br><br>    self.test_count_et_list = [<br>        self.ma.i2cCountEt,<br>        self.ma.mipiCountEt,<br>        self.ma.eepromCountEt,<br>        self.ma.tem_sensorCountEt,<br>        self.ma.lensCountEt,<br>        self.ma.vcmCountEt,<br>        self.ma.mirrorCountEt,<br>        self.ma.mirrorCaliCountEt,<br>    ]<br><br><span class="hljs-comment"># éœ€è¦æ“ä½œæŸç»„æ§ä»¶æ—¶  ç›´æ¥éå†åˆ—è¡¨</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">_click_test_item_cb</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-string">&quot;&quot;&quot; Update [choose all checkbox] by all test item state &quot;&quot;&quot;</span><br>    choose_all = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">for</span> cb <span class="hljs-keyword">in</span> self.cb_list:<br>        choose_all = choose_all &amp; cb.isChecked()<br>    self.ma.selecteAllCB.setChecked(choose_all)<br><br></code></pre></td></tr></table></figure><h2 id="QApplicationä¸QWidget"><a href="#QApplicationä¸QWidget" class="headerlink" title="QApplicationä¸QWidget"></a><code>QApplication</code>ä¸<code>QWidget</code></h2><p><code>QApplication</code>æ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œåœ¨<code>QWidget</code>ä¸­å¯ä»¥é€šè¿‡<code>QApplication.instance()</code>è·å–åˆ°å¯¹è±¡</p><p>å®é™…ä¸Šåœ¨å®ä¾‹åŒ–QApplicationå‰å°±ä½¿ç”¨<code>QtGui.QWidget()</code>æ˜¯ä¼šæŠ¥é”™çš„<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>QtGui.QWidget()<br>QWidget: Must construct a QApplication before a QPaintDevice<br></code></pre></td></tr></table></figure><br>å‚è€ƒ <a href="https://stackoverflow.com/questions/17601896/how-qapplication-and-qwidget-objects-are-connected-in-pyside-pyqt">How QApplication() and QWidget() objects are connected in PySide/PyQt?</a></p><p>åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„<code>QMainWindow</code>ä¸­ï¼Œä¹Ÿå¯ä»¥ç›´æ¥è·å–åˆ°<code>QApplication</code>çš„å®ä¾‹ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RustMainWindow</span>(<span class="hljs-title class_ inherited__">QMainWindow</span>):<br>    <span class="hljs-string">&quot;&quot;&quot; This is the main class &quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_trigger_english</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&quot;Change to English&quot;</span>, QApplication.instance()<br><br><span class="hljs-comment"># Change to English &lt;PyQt4.QtGui.QApplication object at 0x02ABE3A0&gt;</span><br></code></pre></td></tr></table></figure></p><h3 id="æ³¨æ„widgetæŒæœ‰å¤–éƒ¨å¯¹è±¡å¼•ç”¨çš„é—®é¢˜"><a href="#æ³¨æ„widgetæŒæœ‰å¤–éƒ¨å¯¹è±¡å¼•ç”¨çš„é—®é¢˜" class="headerlink" title="æ³¨æ„widgetæŒæœ‰å¤–éƒ¨å¯¹è±¡å¼•ç”¨çš„é—®é¢˜"></a>æ³¨æ„widgetæŒæœ‰å¤–éƒ¨å¯¹è±¡å¼•ç”¨çš„é—®é¢˜</h3><p>å¦‚æœåœ¨ç¨‹åºå¯åŠ¨çš„åœ°æ–¹å°†å¼•ç”¨äº¤ç»™widgetï¼Œé€€å‡ºæ—¶ä¼šé€ æˆåº”ç”¨æ— æ³•å…³é—­çš„é—®é¢˜ï¼ˆç±»ä¼¼å†…å­˜æ³„æ¼ï¼‰ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    app = QApplication(sys.argv)<br>    <span class="hljs-comment"># è¿™é‡ŒæŠŠappäº¤ç»™äº†MainWindowï¼ŒMainWindowå…³é—­æ—¶æ˜¯æ— æ³•æ­£å¸¸é€€å‡ºåº”ç”¨çš„</span><br>    main_d = RustMainWindow(app)  <span class="hljs-comment"># ä¸å»ºè®®è¿™ä¹ˆåš</span><br>    main_d.show()<br>    sys.exit(app.exec_())<br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>PyQt</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>PyCharm å®‰è£…å’Œé…ç½®</title>
    <link href="/2016/12/28/PyQt_note/PyCharm-Install_and_config/"/>
    <url>/2016/12/28/PyQt_note/PyCharm-Install_and_config/</url>
    
    <content type="html"><![CDATA[<p>å®‰è£…å’Œé…ç½®PyCharm<br>ä¿®æ”¹é»˜è®¤é…ç½®ï¼Œä¿®æ”¹configå’Œsystemçš„è·¯å¾„ï¼Œé¿å…å æ®Cç›˜å¤ªå¤šçš„ç©ºé—´<br>å°†PyQtä¸­çš„å·¥å…·<code>PyUIC</code>å®‰è£…åˆ°PyCharmä¸­ï¼Œä½¿ç”¨æ›´ä¾¿æ·ï¼ˆWindowså’ŒUbuntuå¹³å°ï¼‰</p><ul><li>win7</li><li>Python3.5.1</li><li>PyQt5-5.6</li></ul><p>PyCharmç‰ˆæœ¬ï¼š JetBrains PyCharm Community Edition 2016.3.1(64)</p><p>å®‰è£…è·¯å¾„ï¼š <code>E:\IntelliJ IDEA Community Edition 2016.1.1</code></p><h2 id="PyCharmé»˜è®¤é…ç½®"><a href="#PyCharmé»˜è®¤é…ç½®" class="headerlink" title="PyCharmé»˜è®¤é…ç½®"></a>PyCharmé»˜è®¤é…ç½®</h2><p>å’ŒAndroid Studioç±»ä¼¼ï¼Œå¯ä»¥è‡ªå®šä¹‰IDEçš„é…ç½®</p><p>åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨å‰ï¼Œæ‰¾åˆ°<code>bin\idea.properties</code>ï¼Œä¿®æ”¹ä¸€ä¸‹è·¯å¾„</p><figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arcade">idea.config.path=E:<span class="hljs-regexp">/IntelliJIDEAPath/</span>config<br><br>idea.system.path=E:<span class="hljs-regexp">/IntelliJIDEAPath/</span>system<br></code></pre></td></tr></table></figure><p>å¯åŠ¨åï¼Œå¯ä»¥å‘ç°configå’Œsysteméƒ½åœ¨<code>E:/IntelliJIDEAPath</code>ä¸‹<br>æ­¤ä¸¾æ˜¯ä¸ºäº†é¿å…Cç›˜æŒ¤çˆ†</p><h2 id="PyCharmå·¥ç¨‹é…ç½®"><a href="#PyCharmå·¥ç¨‹é…ç½®" class="headerlink" title="PyCharmå·¥ç¨‹é…ç½®"></a>PyCharmå·¥ç¨‹é…ç½®</h2><p>æ‰“å¼€Settings<br><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Build</span>, Execution, Deployment<br>    <span class="hljs-attribute">Console</span><br>        <span class="hljs-attribute">Python</span> Console<br>            <span class="hljs-attribute">Python</span> interpreter é€‰æ‹© Python <span class="hljs-number">3</span>.<span class="hljs-number">5</span>.<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></p><p>å‡è®¾æœ‰ä¸€ä¸ªå·¥ç¨‹<code>gui_app</code>ï¼ŒåŒæ ·è¦æ£€æŸ¥ä¸€ä¸‹è®¾ç½®<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">Project</span>: gui_app<br>    <span class="hljs-keyword">Project</span> interpreter<br>        é€‰æ‹©<span class="hljs-number">3.5</span>.<span class="hljs-number">1</span>  åé¢ä¼šæ˜¾ç¤ºè·¯å¾„<br></code></pre></td></tr></table></figure></p><h2 id="å®‰è£…æ‰©å±•å·¥å…·"><a href="#å®‰è£…æ‰©å±•å·¥å…·" class="headerlink" title="å®‰è£…æ‰©å±•å·¥å…·"></a>å®‰è£…æ‰©å±•å·¥å…·</h2><p>æ‰“å¼€Settings &gt; Tools &gt; External Tools</p><p>é€‰æ‹©æ–°å»º<code>+</code>ï¼Œæˆ–è€…ç¼–è¾‘</p><h3 id="å®‰è£…QtDesigner"><a href="#å®‰è£…QtDesigner" class="headerlink" title="å®‰è£…QtDesigner"></a>å®‰è£…QtDesigner</h3><p>Name: QtDesigner<br><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">Tool Settings<br>    <span class="hljs-name">Program</span>: <span class="hljs-name">E</span>:\Python351\Lib\site-packages\PyQt5\designer.exe<br>    ## é€‰æ‹©å®‰è£…å¥½çš„PyQt5\designer.exe<br><br>    Working <span class="hljs-name">directory</span>: $FileDir$<br></code></pre></td></tr></table></figure></p><h3 id="å®‰è£…PyUIC"><a href="#å®‰è£…PyUIC" class="headerlink" title="å®‰è£…PyUIC"></a>å®‰è£…PyUIC</h3><p>å°†designerç”Ÿæˆçš„uiæ–‡ä»¶è½¬ä¸ºpyæ–‡ä»¶çš„å·¥å…·ï¼›è¿™æ˜¯Pythonè‡ªå¸¦çš„å·¥å…·</p><p>Name: PyUIC<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell">Tool Settings<br>    Program: E:\Python351\python.exe<br>    <span class="hljs-comment">## é€‰æ‹©å®‰è£…å¥½çš„python.exe</span><br><br>    Parameters: <span class="hljs-literal">-m</span> PyQt5.uic.pyuic  <span class="hljs-variable">$FileName</span><span class="hljs-variable">$</span> <span class="hljs-literal">-o</span> <span class="hljs-variable">$FileNameWithoutExtension</span><span class="hljs-variable">$</span>.py<br>    Working directory: <span class="hljs-variable">$FileDir</span><span class="hljs-variable">$</span><br></code></pre></td></tr></table></figure></p><h4 id="Ubuntuä¸‹PyCharmé…ç½®"><a href="#Ubuntuä¸‹PyCharmé…ç½®" class="headerlink" title="Ubuntuä¸‹PyCharmé…ç½®"></a>Ubuntuä¸‹PyCharmé…ç½®</h4><p>å°†designerç”Ÿæˆçš„uiæ–‡ä»¶è½¬ä¸ºpyæ–‡ä»¶çš„å·¥å…·<br>éœ€è¦<code>sudo apt-get install pyqt5-dev-tools</code><br>é…ç½®å·¥å…·[Tool Settings]<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">Program: pyuic5<br>Parameters: <span class="hljs-literal">-o</span> <span class="hljs-variable">$FileNameWithoutExtension</span><span class="hljs-variable">$</span>.py <span class="hljs-variable">$FileNameWithoutExtension</span><span class="hljs-variable">$</span>.ui<br>Working directory: <span class="hljs-variable">$FileDir</span><span class="hljs-variable">$</span><br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>PyQt</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Python3.5 PyQt5 å®‰è£…</title>
    <link href="/2016/12/28/PyQt_note/Python-PyQt5_Python351_install/"/>
    <url>/2016/12/28/PyQt_note/Python-PyQt5_Python351_install/</url>
    
    <content type="html"><![CDATA[<p>åœ¨Windowså’ŒUbuntuä¸‹å®‰è£…PyQt5<br>éœ€è¦å…ˆå®‰è£…å¹¶é…ç½®å¥½Pythonï¼ŒWindowsä¸‹éœ€è¦é…ç½®ç¯å¢ƒå˜é‡ã€‚PyQtéœ€è¦å¯¹åº”ä¸ŠPythonç‰ˆæœ¬ã€‚</p><h2 id="Windowsç¯å¢ƒ"><a href="#Windowsç¯å¢ƒ" class="headerlink" title="Windowsç¯å¢ƒ"></a>Windowsç¯å¢ƒ</h2><h3 id="ç”¨pip3å®‰è£…PyQt5"><a href="#ç”¨pip3å®‰è£…PyQt5" class="headerlink" title="ç”¨pip3å®‰è£…PyQt5"></a>ç”¨pip3å®‰è£…PyQt5</h3><p>å…ˆç¡®è®¤Pythonç›¸å…³ç¯å¢ƒå˜é‡å·²ç»é…ç½®å¥½ï¼Œæ¯”å¦‚ï¼š<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">D:\python36;D:\python36\Scripts;D:\python36\libs;<br></code></pre></td></tr></table></figure><br>ç„¶åè¿è¡Œpip3ï¼Œ<a href="https://riverbankcomputing.com/software/pyqt/download5">å‚è€ƒ PyQt5 Download</a><br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip3 <span class="hljs-keyword">install</span> PyQt5<br></code></pre></td></tr></table></figure><br>ä»ç½‘ä¸Šä¸‹è½½ç›¸å…³æ–‡ä»¶å¹¶å®‰è£…ï¼Œç­‰å¾…è¿‡ç¨‹æ¯”è¾ƒé•¿ã€‚</p><h3 id="PyQt5-5-6-gpl-exe-å®‰è£…æ–¹å¼"><a href="#PyQt5-5-6-gpl-exe-å®‰è£…æ–¹å¼" class="headerlink" title="PyQt5-5.6-gpl exe å®‰è£…æ–¹å¼"></a>PyQt5-5.6-gpl exe å®‰è£…æ–¹å¼</h3><p>Win7  Python3.5.1</p><p>PyQt5-5.6-gpl-Py3.5-Qt5.6.0-x64-2.exe  ï¼ˆæœ€æ–°ç‰ˆæœ¬å·²ç»ä¸å†æä¾›exeç‰ˆæœ¬ï¼‰</p><p>å…ˆå®‰è£…Python3.5.1åˆ° <code>E:\Python351</code><br>å†å»å®˜ç½‘ä¸‹è½½PyQt5ï¼Œç¿»å¢™åä¸‹è½½é€Ÿåº¦æ›´å¿«ã€‚åŒå‡»å®‰è£…ï¼ŒPyQt5ä¼šè‡ªåŠ¨æ‰¾åˆ°Python35çš„ç›®å½•ã€‚<br>æœ¬ä¾‹ä¸­PyQt5å®‰è£…åˆ° <code>E:\Python351\Lib\site-packages\PyQt5</code></p><p>ç°åœ¨å°±å¯ä»¥ä½¿ç”¨PyQt5äº†ã€‚</p><p><code>&gt;&gt;&gt; from PyQt5.QtWidgets import *</code></p><p>åœ¨å‘½ä»¤è¡Œæ˜¾ç¤ºä¸€ä¸ªlabelè¯•ä¸€ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> sys<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">from</span> PyQt5 <span class="hljs-keyword">import</span> QtWidgets<br><span class="hljs-meta">&gt;&gt;&gt; </span>app = QtWidgets.QApplication(sys.argv)<br><span class="hljs-meta">&gt;&gt;&gt; </span>label = QtWidgets.QLabel(<span class="hljs-string">&#x27;Label&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>label.resize(<span class="hljs-number">150</span>,<span class="hljs-number">100</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>label.show()<br></code></pre></td></tr></table></figure><h2 id="Ubuntu-16-04"><a href="#Ubuntu-16-04" class="headerlink" title="Ubuntu 16.04"></a>Ubuntu 16.04</h2><p>Python3.5<br>ç›´æ¥å®‰è£…<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sudo apt-<span class="hljs-built_in">get</span> install python3-dev<br>sudo apt-<span class="hljs-built_in">get</span> install python3-pyqt5<br>sudo apt-<span class="hljs-built_in">get</span> install qt5-default qttools5-dev-tools<br>designer # å¯åŠ¨designer<br></code></pre></td></tr></table></figure></p><p>å®‰è£…pyuic5<br><figure class="highlight q"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs q">sudo apt-<span class="hljs-built_in">get</span> install pyqt5-<span class="hljs-built_in">dev</span>-tools<br></code></pre></td></tr></table></figure></p>]]></content>
    
    
    <categories>
      
      <category>PyQt</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Python3 è¯»å†™csvæ–‡ä»¶ä¸­çš„æ•°å­—</title>
    <link href="/2016/12/27/Python/Python-rw_in_csv/"/>
    <url>/2016/12/27/Python/Python-rw_in_csv/</url>
    
    <content type="html"><![CDATA[<p>ç¯å¢ƒä¸å·¥å…·</p><ul><li>Python3</li><li>PyCharm CE</li></ul><h2 id="csvç®€ä»‹"><a href="#csvç®€ä»‹" class="headerlink" title="csvç®€ä»‹"></a>csvç®€ä»‹</h2><p>ä»€ä¹ˆæ˜¯csvï¼Ÿcsvæ˜¯é€—å·åˆ†éš”çš„ä¸€ç§æ–‡ä»¶æ ¼å¼ã€‚<br>ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªcsvæ ¼å¼çš„æ–‡æœ¬ã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs csv">å§“å,å¹´é¾„,æ ‡ç­¾<br>Rust Fisher,18,Python<br>Tom Hanks,29,Java<br></code></pre></td></tr></table></figure></p><p>è¿™æ ·çš„<code>.csv</code>æ–‡ä»¶å¯ä»¥ç”¨Excelæˆ–è€…WPSæ‰“å¼€ï¼Œä¼šç»™å‡ºè¡¨æ ¼çš„å½¢å¼ã€‚</p><p><img src="py_csv_demo1.png" alt=""></p><p>è¦æ³¨æ„çš„æ˜¯ï¼Œcsvæ˜¯æ–‡æœ¬æ ¼å¼ï¼Œå¹¶ä¸æ˜¯Excelçš„æ ¼å¼ã€‚æˆ‘ä»¬ç”¨æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆä¾‹å¦‚xcodeï¼Œè®°äº‹æœ¬ï¼‰æ˜¯å¯ä»¥ç›´æ¥ç¼–è¾‘å®ƒçš„ã€‚</p><h2 id="è¯»å†™csvæ–‡ä»¶"><a href="#è¯»å†™csvæ–‡ä»¶" class="headerlink" title="è¯»å†™csvæ–‡ä»¶"></a>è¯»å†™csvæ–‡ä»¶</h2><p>è¯»æ–‡ä»¶æ—¶å…ˆäº§ç”Ÿstrçš„åˆ—è¡¨ï¼ŒæŠŠæœ€åçš„æ¢è¡Œç¬¦åˆ æ‰ï¼›ç„¶åä¸€ä¸ªä¸ªstrè½¬æ¢æˆint<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">## è¯»å†™csvæ–‡ä»¶</span><br>csv_file = <span class="hljs-string">&#x27;datas.csv&#x27;</span><br><br>csv = <span class="hljs-built_in">open</span>(csv_file,<span class="hljs-string">&#x27;w&#x27;</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">20</span>):<br>    csv.write(<span class="hljs-built_in">str</span>(i) + <span class="hljs-string">&#x27;,&#x27;</span>)<br>    <span class="hljs-keyword">if</span> i % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:<br>        csv.write(<span class="hljs-string">&#x27;\n&#x27;</span>)<br>csv.close()<br><br>result = []<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(csv_file,<span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:<br>        linelist = line.split(<span class="hljs-string">&#x27;,&#x27;</span>)<br>        linelist.pop()<span class="hljs-comment"># delete: \n</span><br>        <span class="hljs-keyword">for</span> index, item <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(linelist):<br>            result.append(<span class="hljs-built_in">int</span>(item))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\nResult is \n&#x27;</span> , result)<br></code></pre></td></tr></table></figure></p><p>è¾“å‡ºï¼š<br><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">Result <span class="hljs-keyword">is</span><br><span class="hljs-string"> [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]</span><br></code></pre></td></tr></table></figure></p><h3 id="æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨"><a href="#æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨" class="headerlink" title="æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨"></a>æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨</h3><p>è‹¥ç›®æ ‡ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™æ–°å»ºä¸€ä¸ªç›®å½•<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> os<br>json_dir = <span class="hljs-string">&quot;../dir_json/2017-04/&quot;</span><br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(json_dir):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;json dir not found&quot;</span>)<br>    os.makedirs(json_dir)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Create dir  &quot;</span> + json_dir)<br></code></pre></td></tr></table></figure></p><h3 id="å†™æ–‡ä»¶æ—¶æŒ‡å®šæ ¼å¼"><a href="#å†™æ–‡ä»¶æ—¶æŒ‡å®šæ ¼å¼" class="headerlink" title="å†™æ–‡ä»¶æ—¶æŒ‡å®šæ ¼å¼"></a>å†™æ–‡ä»¶æ—¶æŒ‡å®šæ ¼å¼</h3><p>å‚è€ƒä¸‹é¢çš„ä»£ç ï¼Œæ‰“å¼€æ–‡ä»¶æ—¶æŒ‡å®šutf8ï¼Œè½¬æ¢æˆjsonæ—¶æŒ‡å®š<code>ensure_ascii=False</code><br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> json<br>json_file = <span class="hljs-built_in">open</span>(json_dir + <span class="hljs-built_in">id</span> + <span class="hljs-string">&#x27;.json&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf8&#x27;</span>)<br>json_file.write(json.dumps(data_dict, ensure_ascii=<span class="hljs-literal">False</span>))<br></code></pre></td></tr></table></figure><br>é¿å…å†™æˆçš„jsonæ–‡ä»¶ä¹±ç </p><h3 id="å‡½æ•°-enumerate-iterable-start-0"><a href="#å‡½æ•°-enumerate-iterable-start-0" class="headerlink" title="å‡½æ•° enumerate(iterable, start=0)"></a>å‡½æ•° enumerate(iterable, start=0)</h3><p>è¿”å›ä¸€ä¸ªenumerateå¯¹è±¡ã€‚iterableå¿…é¡»æ˜¯ä¸€ä¸ªå¥å­ï¼Œè¿­ä»£å™¨æˆ–è€…æ”¯æŒè¿­ä»£çš„å¯¹è±¡ã€‚</p><p>enumerateç¤ºä¾‹1ï¼š<br><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">data = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">for</span> i, item <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(data):</span><br>print(i,item)<br><br><br>0 1<br>1 2<br>2 3<br></code></pre></td></tr></table></figure><br>ç¤ºä¾‹2ï¼š<br><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">line = <span class="hljs-string">&#x27;one&#x27;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">for</span> i, item <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(line,<span class="hljs-number">4</span>):</span><br>print(i,item)<br><br><br>4 o<br>5 n<br>6 e<br></code></pre></td></tr></table></figure><br>å‚è€ƒï¼š <a href="https://docs.python.org/3/library/functions.html?highlight=enumerate#enumerate">https://docs.python.org/3/library/functions.html?highlight=enumerate#enumerate</a></p><h3 id="class-int-x-0"><a href="#class-int-x-0" class="headerlink" title="class int(x=0)"></a>class int(x=0)</h3><p>class int(x, base=10)<br>è¿”å›ä¸€ä¸ªIntegerå¯¹è±¡ã€‚å¯¹äºæµ®ç‚¹æ•°ï¼Œä¼šæˆªå–æˆæ•´æ•°ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;-100&#x27;</span>),<span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;0&#x27;</span>),<span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;3&#x27;</span>))<br>-<span class="hljs-number">100</span> <span class="hljs-number">0</span> <span class="hljs-number">3</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">int</span>(<span class="hljs-number">7788</span>)<br><span class="hljs-number">7788</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">int</span>(<span class="hljs-number">7.98</span>)<br><span class="hljs-number">7</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;2.33&#x27;</span>)<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;pyshell#27&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    <span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;2.33&#x27;</span>)<br>ValueError: invalid literal <span class="hljs-keyword">for</span> <span class="hljs-built_in">int</span>() <span class="hljs-keyword">with</span> base <span class="hljs-number">10</span>: <span class="hljs-string">&#x27;2.33&#x27;</span><br></code></pre></td></tr></table></figure></p><h2 id="è¯»å–binaryæ–‡ä»¶"><a href="#è¯»å–binaryæ–‡ä»¶" class="headerlink" title="è¯»å–binaryæ–‡ä»¶"></a>è¯»å–binaryæ–‡ä»¶</h2><p>é€ä¸ªbyteè¯»å–ï¼Œæ³¨æ„ç”¨<code>b&#39;&#39;</code>æ¥åˆ¤æ–­æ˜¯å¦è¯»åˆ°æ–‡ä»¶å°¾éƒ¨<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@staticmethod</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">convert_bin_to_csv</span>(<span class="hljs-params">bin_file_path, csv_file_path</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(bin_file_path):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Binary file is not exist! &quot;</span> + bin_file_path)<br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(bin_file_path, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> bin_f:<br>        cur_byte = bin_f.read(<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">while</span> cur_byte != <span class="hljs-string">b&#x27;&#x27;</span>:<br>            <span class="hljs-comment"># Do stuff with byte.</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-built_in">int</span>.from_bytes(cur_byte, byteorder=<span class="hljs-string">&#x27;big&#x27;</span>, signed=<span class="hljs-literal">True</span>))<br>            cur_byte = bin_f.read(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure></p><p>è¯»å–åˆ°çš„byteå¯ä»¥è½¬æ¢ä¸ºintï¼Œ<a href="https://docs.python.org/3/library/stdtypes.html#int.from_bytes">å‚è€ƒæ–‡æ¡£</a></p><p>è¿™é‡Œ <code>cur_byte</code> ç±»ä¼¼äº <code>b&#39;\x08&#39;</code><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">int</span>.from_bytes(cur_byte, byteorder=<span class="hljs-string">&#x27;big&#x27;</span>, signed=<span class="hljs-literal">True</span>))<br></code></pre></td></tr></table></figure></p><h3 id="ä»binä¸­è¯»å–æ•°æ®å¹¶å­˜å…¥CSVæ–‡ä»¶ä¸­"><a href="#ä»binä¸­è¯»å–æ•°æ®å¹¶å­˜å…¥CSVæ–‡ä»¶ä¸­" class="headerlink" title="ä»binä¸­è¯»å–æ•°æ®å¹¶å­˜å…¥CSVæ–‡ä»¶ä¸­"></a>ä»binä¸­è¯»å–æ•°æ®å¹¶å­˜å…¥CSVæ–‡ä»¶ä¸­</h3><p>å…ˆä»binä¸­è¯»å–byteï¼Œè§„å®šå¥½å‡ ä¸ªå­—èŠ‚å‡‘æˆ1ä¸ªæ•°å­—ã€‚<br>æŒ‰æ¯è¡Œä¸€ä¸ªæ•°å­—çš„æ ¼å¼å†™å…¥CSVæ–‡ä»¶ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@staticmethod</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">convert_bin_to_csv</span>(<span class="hljs-params">bin_file_path, csv_file_path, byte_count=<span class="hljs-number">1</span>, byte_order=<span class="hljs-string">&#x27;big&#x27;</span>, digit_signed=<span class="hljs-literal">True</span></span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(bin_file_path):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Binary file is not exist! &quot;</span> + bin_file_path)<br>        <span class="hljs-keyword">return</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(csv_file_path, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> csv_f:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(bin_file_path, <span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> bin_f:<br>            cur_byte = bin_f.read(byte_count)<br>            <span class="hljs-keyword">while</span> cur_byte != <span class="hljs-string">b&#x27;&#x27;</span>:<br>                csv_f.write(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>.from_bytes(cur_byte, byteorder=byte_order, signed=digit_signed)) + <span class="hljs-string">&quot;,\n&quot;</span>)<br>                cur_byte = bin_f.read(byte_count)<br><br></code></pre></td></tr></table></figure><p>binå­˜å‚¨çš„æ•°æ®æ ¼å¼ä¸€å®šè¦å•†é‡å¥½ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Android NDK ç¤ºä¾‹-è¿”å›å­—ç¬¦ä¸²ï¼Œæ•°ç»„ï¼ŒJavaå¯¹è±¡ï¼›å…¼å®¹æ€§é—®é¢˜</title>
    <link href="/2016/08/02/Android/NDK-use_sample_1/"/>
    <url>/2016/08/02/Android/NDK-use_sample_1/</url>
    
    <content type="html"><![CDATA[<p>Android Studio 2.2.3 åˆ›å»ºå·¥ç¨‹ NDKProj</p><h3 id="å·¥ç¨‹å‡†å¤‡"><a href="#å·¥ç¨‹å‡†å¤‡" class="headerlink" title="å·¥ç¨‹å‡†å¤‡"></a>å·¥ç¨‹å‡†å¤‡</h3><p>åœ¨<code>SmartAlgorithm.java</code>ä¸­åŠ è½½äº†åº“æ–‡ä»¶<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ada">java<br>`<span class="hljs-comment">-- com</span><br>    `<span class="hljs-comment">-- rustfisher</span><br>        `<span class="hljs-comment">-- ndkproj</span><br>            |<span class="hljs-comment">-- MainActivity.java</span><br>            `<span class="hljs-comment">-- SmartAlgorithm.java</span><br></code></pre></td></tr></table></figure><br>JNIç›®å½•ï¼Œéœ€è¦mkæ–‡ä»¶ï¼Œå¤´æ–‡ä»¶å’Œæºæ–‡ä»¶ã€‚è¿™é‡Œå¤´æ–‡ä»¶å’Œæºæ–‡ä»¶æ•…æ„ä¸ç»Ÿä¸€æ–‡ä»¶åï¼Œä¹Ÿå¯å®ç°æ•ˆæœã€‚<br>ä½†è¿˜æ˜¯å»ºè®®ç”¨åŒæ ·çš„æ–‡ä»¶åï¼Œæ–¹ä¾¿å®šä½ã€‚<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ada">jni/<br>|<span class="hljs-comment">-- Android.mk</span><br>|<span class="hljs-comment">-- Application.mk</span><br>|<span class="hljs-comment">-- com_rustfisher_ndkproj_SmartAlgorithm.h</span><br>`<span class="hljs-comment">-- com_rustfisher_ndkproj_SmartAlgorithm_if_not_the_same.cpp</span><br></code></pre></td></tr></table></figure></p><h3 id="NDKè¿”å›å€¼"><a href="#NDKè¿”å›å€¼" class="headerlink" title="NDKè¿”å›å€¼"></a>NDKè¿”å›å€¼</h3><p>åŠ è½½<code>SmartAlgorithm</code>ï¼›è¿™ä¸ªæ˜¯ç»Ÿä¸€æ ‡ç¤ºã€‚LOCAL_MODULE ä¸ APP_MODULES å‡ä¸ºæ­¤æ ‡ç¤ºã€‚<br>NDKä¸­çš„æ–¹æ³•è¦å£°æ˜ä¸ºnativeã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.rustfisher.ndkproj;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartAlgorithm</span> &#123;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        System.loadLibrary(<span class="hljs-string">&quot;SmartAlgorithm&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> String <span class="hljs-title function_">getMsg</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">int</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> a,<span class="hljs-type">int</span> b)</span>;<br>&#125;<br></code></pre></td></tr></table></figure><br><strong>æ³¨æ„</strong>ï¼ŒJavaæ–‡ä»¶ç”Ÿæˆå¤´æ–‡ä»¶åï¼ŒJavaæ–‡ä»¶çš„è·¯å¾„ä¸èƒ½è½»æ˜“æ”¹åŠ¨ã€‚</p><p>ç¼–å†™Android.mkæ–‡ä»¶ï¼›ABI é€‰æ‹©allï¼Œç¼–è¯‘å‡ºæ”¯æŒå¤šä¸ªå¹³å°çš„soæ–‡ä»¶ã€‚<br>å¡«å…¥æºæ–‡ä»¶çš„æ–‡ä»¶åã€‚<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs makefile">LOCAL_PATH:= <span class="hljs-variable">$(<span class="hljs-built_in">call</span> my-<span class="hljs-built_in">dir</span>)</span><br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(CLEAR_VARS)</span><br>LOCAL_MODULE := SmartAlgorithm<br>TARGET_ARCH_ABI := all<br>LOCAL_SRC_FILES := com_rustfisher_ndkproj_SmartAlgorithm_if_not_the_same.cpp<br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(BUILD_SHARED_LIBRARY)</span><br></code></pre></td></tr></table></figure></p><p>ç¼–å†™Application.mkæ–‡ä»¶ï¼ˆç½‘ä¸Šcopyæ¥çš„ï¼‰ã€‚åŒæ ·ABI é€‰æ‹©allã€‚<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs makefile">APP_PLATFORM := android-16<br>APP_MODULES := SmartAlgorithm<br>APP_ABI := all<br>APP_STL := stlport_static<br>APP_CPPFLAGS += -fexceptions<br><span class="hljs-comment"># for using c++ features,you need to enable these in your Makefile</span><br>APP_CPP_FEATURES += exceptions rtti<br></code></pre></td></tr></table></figure></p><p>ä¿®æ”¹å·¥ç¨‹build.gradleæ–‡ä»¶ï¼Œæ·»åŠ jniçš„é…ç½®ã€‚<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">sourceSets</span> &#123;<br>    main &#123;<br>        jni.srcDirs = []<br>        jniLibs.srcDirs = [<span class="hljs-string">&#x27;src/main/libs&#x27;</span>]<span class="hljs-comment">// æŒ‡å®šsoåº“çš„ä½ç½®</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>ç¼–è¯‘å‡ºå¤´æ–‡ä»¶ï¼Œå¾—åˆ° <code>com_rustfisher_ndkproj_SmartAlgorithm.h</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Administrator@rust-PC /cygdrive/g/rust_proj/NDKProj/app/src/main/java<br>javah com.rustfisher.ndkproj.SmartAlgorithm<br></code></pre></td></tr></table></figure><p>å°†å¤´æ–‡ä»¶æ”¾åˆ°jniç›®å½•ä¸‹ï¼Œä¸æºæ–‡ä»¶ä¸€èµ·ã€‚</p><p>ç”Ÿæˆçš„å¤´æ–‡ä»¶ä¸è¦æ‰‹åŠ¨å»ä¿®æ”¹ï¼Œç›´æ¥ä½¿ç”¨å³å¯ã€‚<br><figure class="highlight h"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs h"><span class="hljs-comment">/* DO NOT EDIT THIS FILE - it is machine generated */</span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;jni.h&gt;</span></span><br><span class="hljs-comment">/* Header for class com_rustfisher_ndkproj_SmartAlgorithm */</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">ifndef</span> _Included_com_rustfisher_ndkproj_SmartAlgorithm</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> _Included_com_rustfisher_ndkproj_SmartAlgorithm</span><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> __cplusplus</span><br><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> &#123;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Class:     com_rustfisher_ndkproj_SmartAlgorithm</span><br><span class="hljs-comment"> * Method:    getMsg</span><br><span class="hljs-comment">* Signature: ()Ljava/lang/String;</span><br><span class="hljs-comment">*/</span><br>JNIEXPORT jstring JNICALL <span class="hljs-title function_">Java_com_rustfisher_ndkproj_SmartAlgorithm_getMsg</span><br>  <span class="hljs-params">(JNIEnv *, jobject)</span>;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * Class:     com_rustfisher_ndkproj_SmartAlgorithm</span><br><span class="hljs-comment"> * Method:    add</span><br><span class="hljs-comment">* Signature: (II)I</span><br><span class="hljs-comment">*/</span><br>JNIEXPORT jint JNICALL <span class="hljs-title function_">Java_com_rustfisher_ndkproj_SmartAlgorithm_add</span><br>  <span class="hljs-params">(JNIEnv *, jobject, jint, jint)</span>;<br><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> __cplusplus</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br></code></pre></td></tr></table></figure></p><p>ç¼–å†™æºæ–‡ä»¶ï¼Œå®ç°å¤´æ–‡ä»¶ä¸­çš„æ–¹æ³•ã€‚ä¸€ä¸ªæ˜¯è¿”å›å­—ç¬¦ä¸²ï¼Œä¸€ä¸ªæ˜¯åŠ æ³•ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;jni.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;android/log.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;com_rustfisher_ndkproj_SmartAlgorithm.h&quot;</span></span><br><br><span class="hljs-comment">/* Already define in com_rustfisher_ndkproj_SmartAlgorithm.h, no need to extern C here.</span><br><span class="hljs-comment">extern &quot;C&quot; &#123;</span><br><span class="hljs-comment">    JNIEXPORT jstring JNICALL Java_com_rustfisher_ndkproj_SmartAlgorithm_getMsg(JNIEnv *env, jobject obj);</span><br><span class="hljs-comment">    JNIEXPORT jint JNICALL Java_com_rustfisher_ndkproj_SmartAlgorithm_add(JNIEnv *env, jobject obj, jint a, jint b);</span><br><span class="hljs-comment">&#125;;*/</span><br><br>JNIEXPORT jstring JNICALL <span class="hljs-title function_">Java_com_rustfisher_ndkproj_SmartAlgorithm_getMsg</span><span class="hljs-params">(JNIEnv *env, jobject obj)</span> &#123;<br><br>    <span class="hljs-keyword">return</span> env-&gt;NewStringUTF(<span class="hljs-string">&quot;Hello from the JNI.&quot;</span>);<br>&#125;<br><br>JNIEXPORT jint JNICALL <span class="hljs-title function_">Java_com_rustfisher_ndkproj_SmartAlgorithm_add</span><span class="hljs-params">(JNIEnv *env, jobject obj, jint a, jint b)</span> &#123;<br>    <span class="hljs-keyword">return</span> a + b;<br>&#125;<span class="hljs-comment">//*</span><br></code></pre></td></tr></table></figure></p><p>ç„¶ååœ¨å‘½ä»¤è¡Œ ndk-buildã€‚è¿™é‡Œæ˜¯win7ä¸‹çš„Cygwinã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">Administrator@rust-PC /cygdrive/g/rust_proj/NDKProj/app/src/main/jni<br>$ ndk-build.cmd<br>[all] Compile++      : SmartAlgorithm &lt;= com_rustfisher_ndkproj_SmartAlgorithm_if_not_the_same.cpp<br>[all] SharedLibrary  : libSmartAlgorithm.so<br>[all] Install        : libSmartAlgorithm.so =&gt; libs/arm64-v8a/libSmartAlgorithm.so<br><span class="hljs-comment"># ...... åé¢è¿˜æœ‰å¾ˆå¤š</span><br></code></pre></td></tr></table></figure></p><p>åœ¨libsç›®å½•ä¸‹å‡ºç°äº†å¯¹åº”çš„soåº“<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">Administrator@rust-PC /cygdrive/g/rust_proj/NDKProj/app/src/main/libs<br>$ tree<br>.<br>|-- arm64-v8a<br>|   `-- libSmartAlgorithm.so<br>|-- armeabi<br>|   `-- libSmartAlgorithm.so<br>|-- armeabi-v7a<br>|   `-- libSmartAlgorithm.so<br>|-- mips<br>|   `-- libSmartAlgorithm.so<br>|-- mips64<br>|   `-- libSmartAlgorithm.so<br>|-- x86<br>|   `-- libSmartAlgorithm.so<br>`-- x86_64<br>    `-- libSmartAlgorithm.so<br><br>7 directories, 7 files<br></code></pre></td></tr></table></figure></p><p>åœ¨MainActivityä¸­è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚<br>è¿è¡Œapkåˆ°æœºå™¨ä¸Šï¼ŒæŸ¥çœ‹logã€‚å‘ç°è°ƒç”¨æˆåŠŸã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">com<span class="hljs-selector-class">.rustfisher</span><span class="hljs-selector-class">.ndkproj</span> D/MainActivity: onCreate: Hello from the JNI.<br>com<span class="hljs-selector-class">.rustfisher</span><span class="hljs-selector-class">.ndkproj</span> D/MainActivity: onCreate: <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h3 id="å¤„ç†æ•°ç»„çš„æ–¹æ³•"><a href="#å¤„ç†æ•°ç»„çš„æ–¹æ³•" class="headerlink" title="å¤„ç†æ•°ç»„çš„æ–¹æ³•"></a>å¤„ç†æ•°ç»„çš„æ–¹æ³•</h3><p>1.ä¸è¦ç›´æ¥æ“ä½œè¾“å…¥çš„æ•°ç»„ï¼›<br>2.æ³¨æ„é‡Šæ”¾æœ¬åœ°å¼•ç”¨ï¼Œé˜²æ­¢æº¢å‡ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-type">short</span>[] getConvertedArray(<span class="hljs-type">short</span>[] data, <span class="hljs-type">int</span> dataLen);<br></code></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">JNIEXPORT jshortArray JNICALL <span class="hljs-title">Java_com_rustfisher_ndkproj_SmartAlgorithm_getConvertedArray</span><span class="hljs-params">(JNIEnv *env, jobject obj, jshortArray input, jint len)</span> </span>&#123;<br>    jshort* inputPtr;<br>    inputPtr = env-&gt;<span class="hljs-built_in">GetShortArrayElements</span>(input,<span class="hljs-number">0</span>);<span class="hljs-comment">// ç›´æ¥æ“ä½œæŒ‡é’ˆä¼šæ”¹å˜Android Dalvikä¸­çš„å€¼</span><br>    jshort* resPtr;<br>    jshortArray result;<br>    result = env-&gt;<span class="hljs-built_in">NewShortArray</span>(len);<span class="hljs-comment">// åˆ›å»ºæ–°çš„æ•°ç»„</span><br>    resPtr = env-&gt;<span class="hljs-built_in">GetShortArrayElements</span>(result,<span class="hljs-number">0</span>);<span class="hljs-comment">// æŒ‡é’ˆ</span><br><br>    <span class="hljs-keyword">for</span>(jint i = <span class="hljs-number">0</span>;i &lt; len;i++) &#123;<br>        resPtr[i] = inputPtr[i] * <span class="hljs-number">2</span>;<br>    &#125;<br>    env-&gt;<span class="hljs-built_in">ReleaseShortArrayElements</span>(input, inputPtr, <span class="hljs-number">0</span>);<span class="hljs-comment">// é‡Šæ”¾æœ¬åœ°å¼•ç”¨</span><br>    env-&gt;<span class="hljs-built_in">SetShortArrayRegion</span>(result,<span class="hljs-number">0</span>,len,resPtr);     <span class="hljs-comment">// å­˜å…¥æ•°æ®</span><br>    env-&gt;<span class="hljs-built_in">ReleaseShortArrayElements</span>(result, resPtr, <span class="hljs-number">0</span>); <span class="hljs-comment">// é‡Šæ”¾æœ¬åœ°å¼•ç”¨</span><br>    <span class="hljs-keyword">return</span> result;<span class="hljs-comment">// è¿”å›ç»“æœ</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="JNIå±‚-unsigned-char-ä¸-jbyte-æ•°ç»„è½¬æ¢"><a href="#JNIå±‚-unsigned-char-ä¸-jbyte-æ•°ç»„è½¬æ¢" class="headerlink" title="JNIå±‚ unsigned char ä¸ jbyte æ•°ç»„è½¬æ¢"></a>JNIå±‚ unsigned char ä¸ jbyte æ•°ç»„è½¬æ¢</h3><p>æœ¬ä¾‹è¯´æ˜çš„æ˜¯unsigned char ä¸ jbyteä¹‹é—´äº’ç›¸è½¬æ¢<br>æ³¨æ„æ–¹æ³•ï¼š<code>(*env)-&gt;SetByteArrayRegion(env, jbyte_arr, 0, len, uc_ptr);</code><br>javaä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] getByteArrayFromJNI() &#123;<br>    <span class="hljs-keyword">return</span> nativeGetByteArray();<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-type">byte</span>[] byteArrayTravelJNI(<span class="hljs-type">byte</span>[] input) &#123;<br>    <span class="hljs-keyword">return</span> nativeSendByteArray(input, input.length);<br>&#125;<br><span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> <span class="hljs-type">byte</span>[] nativeGetByteArray(); <span class="hljs-comment">// ä»JNIä¸­è·å–byteæ•°ç»„</span><br><br><span class="hljs-comment">// è¾“å…¥byteæ•°ç»„ï¼Œåœ¨JNIä¸­è½¬æ¢åå†è·å–å›æ¥</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> <span class="hljs-type">byte</span>[] nativeSendByteArray(<span class="hljs-type">byte</span>[] input, <span class="hljs-type">int</span> len);<br></code></pre></td></tr></table></figure></p><p>JNI Cä»£ç <br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// return byte array from unsigned char array.  jbytes:  1 2 0 7f 80 81 ff 0 1</span><br>JNIEXPORT jbyteArray JNICALL <span class="hljs-title function_">Java_com_rustfisher_ndkalgo_NDKUtils_nativeGetByteArray</span><span class="hljs-params">(JNIEnv *env, jobject jObj)</span><br>&#123;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> uc_arr[] = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">-2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">127</span>, <span class="hljs-number">128</span>, <span class="hljs-number">129</span>, <span class="hljs-number">255</span>, <span class="hljs-number">256</span>, <span class="hljs-number">257</span>&#125;;<br>    <span class="hljs-type">int</span> uc_arr_len = <span class="hljs-keyword">sizeof</span>(uc_arr) / <span class="hljs-keyword">sizeof</span>(uc_arr[<span class="hljs-number">0</span>]);<br>    jbyte byte_array[uc_arr_len];<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(;i &lt; uc_arr_len; i++) &#123;<br>        byte_array[i] = uc_arr[i];<br>    &#125;<br>    jbyteArray jbyte_arr = (*env)-&gt;NewByteArray(env, uc_arr_len);<br>    (*env)-&gt;SetByteArrayRegion(env, jbyte_arr, <span class="hljs-number">0</span>, uc_arr_len, byte_array);<br>    <span class="hljs-keyword">return</span> jbyte_arr;<br>&#125;<br><br><span class="hljs-comment">// jbyte -&gt; unsigned char -&gt; jbyte</span><br>JNIEXPORT jbyteArray JNICALL <span class="hljs-title function_">Java_com_rustfisher_ndkalgo_NDKUtils_nativeSendByteArray</span><br>    <span class="hljs-params">(JNIEnv *env, jobject jObj, jbyteArray input_byte_arr, jint input_len)</span><br>&#123;<br>    <span class="hljs-type">int</span> len = (<span class="hljs-type">int</span>)input_len;<br>    jbyte *jbyte_ptr = (*env)-&gt;GetByteArrayElements(env, input_byte_arr, <span class="hljs-number">0</span>);<br><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *uc_ptr = (<span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> *)jbyte_ptr;<br><br>    jbyteArray jbyte_arr = (*env)-&gt;NewByteArray(env, len);<br>    jbyte byte_array[input_len];<br>    <span class="hljs-type">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span>(;i &lt; input_len; i++) &#123;<br>        byte_array[i] = uc_ptr[i];<br>    &#125;<br>    (*env)-&gt;SetByteArrayRegion(env, jbyte_arr, <span class="hljs-number">0</span>, len, byte_array);<br>    (*env)-&gt;ReleaseByteArrayElements(env, input_byte_arr, jbyte_ptr, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">return</span> jbyte_arr;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>å…³äº<code>SetByteArrayRegion</code>è¿™ä¸ªæ–¹æ³•<br>æ–¹æ³•è¯´æ˜ï¼š<code>void SetXxxArrayRegion(JNIEnv *env, jarray array, jint start, jint length, Xxx elems[])</code><br>å°†Cæ•°ç»„çš„å…ƒç´ å¤åˆ¶åˆ°Javaæ•°ç»„ä¸­ã€‚æ³¨æ„æœ€åä¸€ä¸ªå‚æ•°è¦å’Œå‰é¢çš„å¯¹åº”ä¸Šã€‚</p><p><code>void ReleaseXxxArrayElements(JNIEnv *env, jarray array, Xxx elems[], jint mode)</code><br>é€šçŸ¥è™šæ‹Ÿæœºé€šè¿‡GetXxxArrayElementsè·å¾—çš„ä¸€ä¸ªæŒ‡é’ˆå·²ç»ä¸å†éœ€è¦äº†ã€‚Modeæ˜¯0ï¼Œæ›´æ–°æ•°ç»„<br>å…ƒç´ åé‡Šæ”¾elemsç¼“å­˜ã€‚</p><p>åœ¨è¿™é‡Œé‡åˆ°è¿‡ä¸€ä¸ªbugï¼ŒåŒæ ·çš„ä»£ç åœ¨armeabiä¸Šæ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯åˆ°äº†v7aæˆ–v8aå¹³å°ä¸Šå°±é—ªé€€ã€‚<br>ä½¿ç”¨<code>SetXxxArrayRegion</code>è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ä¸€å®šè¦å’Œæ–¹æ³•åä¸­çš„<code>Xxx</code>å¯¹åº”ä¸Š<br>è¯¦ç»†å¯ä»¥å‚è€ƒ<em>Core Java</em>ä¸­çš„Java Nativeå’ŒAndroid Developä¸Šå…³äºabiçš„è§£é‡Š</p><p>æµ‹è¯•è°ƒç”¨<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">NDKUtils</span> <span class="hljs-variable">ndkUtils</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NDKUtils</span>();<br><span class="hljs-type">byte</span>[] res = ndkUtils.getByteArrayFromJNI(); <span class="hljs-comment">// ä»JNIä¸­è·å–byteæ•°ç»„</span><br>logBytes(res);<br>Log.d(TAG, <span class="hljs-string">&quot;-------------------------------------------------------------&quot;</span>);<br><span class="hljs-type">byte</span>[] inputBytes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">127</span>, (<span class="hljs-type">byte</span>) <span class="hljs-number">128</span>, (<span class="hljs-type">byte</span>) <span class="hljs-number">255</span>, -<span class="hljs-number">120</span>&#125;;<br><span class="hljs-type">byte</span>[] tRes = ndkUtils.byteArrayTravelJNI(inputBytes); <span class="hljs-comment">// è®©byteæ•°ç»„åœ¨JNIä¸­æ—…æ¸¸ä¸€åœˆ</span><br>logBytes(inputBytes);<br>logBytes(tRes);<br></code></pre></td></tr></table></figure></p><p>è¾“å‡º<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-section">bytes:  1 2 0 7f 80 81 ff 0 1 </span><br><span class="hljs-section">-------------------------------------------------------------</span><br>bytes:  1 2 7f 80 ff 88 <br>bytes:  1 2 7f 80 ff 88 <br></code></pre></td></tr></table></figure></p><h3 id="ç›´æ¥æ“ä½œè¾“å…¥çš„æ•°ç»„"><a href="#ç›´æ¥æ“ä½œè¾“å…¥çš„æ•°ç»„" class="headerlink" title="ç›´æ¥æ“ä½œè¾“å…¥çš„æ•°ç»„"></a>ç›´æ¥æ“ä½œè¾“å…¥çš„æ•°ç»„</h3><p>ä»¥intæ•°ç»„ä¸ºä¾‹<br>è¾“å…¥ä¸€ä¸ªæ•°ç»„åï¼Œè·å–æ•°ç»„ç„¶åç›´æ¥æ”¹å˜æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œæœ€åé‡Šæ”¾æ‰æœ¬åœ°å¼•ç”¨</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c">JNIEXPORT <span class="hljs-type">void</span> JNICALL <span class="hljs-title function_">Java_com_rustfisher_ndkalgo_NDKUtils_nativeModifyArray</span><br>  <span class="hljs-params">(JNIEnv *env, jobject jObj, jintArray input_arr, jint input_len)</span> &#123;<br>    <span class="hljs-type">int</span> * input_ptr = (*env)-&gt;GetIntArrayElements(env, input_arr, <span class="hljs-number">0</span>);<br>    input_ptr[input_len - <span class="hljs-number">1</span>] =  input_ptr[input_len - <span class="hljs-number">1</span>] - <span class="hljs-number">1</span>;<br>    (*env)-&gt;ReleaseIntArrayElements(env, input_arr, input_ptr, <span class="hljs-number">0</span>);<br>  &#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">NDKUtils</span> <span class="hljs-variable">moUtil</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NDKUtils</span>();<br><span class="hljs-type">int</span>[] origin = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>&#125;;<br>Log.d(TAG, <span class="hljs-string">&quot;origin before: &quot;</span> + Arrays.toString(origin));<br>moUtil.modifyArray(origin);<br>Log.d(TAG, <span class="hljs-string">&quot;origin after:  &quot;</span> + Arrays.toString(origin));<br></code></pre></td></tr></table></figure><p>è§‚å¯Ÿè¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œè¾“å…¥çš„æ•°ç»„ç›´æ¥è¢«æ”¹å˜äº†<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">origin </span><span class="hljs-keyword">before: </span>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>]<br><span class="hljs-keyword">origin </span>after:  [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>]<br></code></pre></td></tr></table></figure></p><p>æˆ–è€…<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">JNIEXPORT <span class="hljs-type">void</span> JNICALL <span class="hljs-title">Java_com_rustfisher_face_1detect_1lib_CalHelper_cvtNV21</span></span><br><span class="hljs-function">  <span class="hljs-params">(JNIEnv *env, jclass jcls, jbyteArray input_arr,jint in_arr_len,</span></span><br><span class="hljs-params"><span class="hljs-function">   jbyteArray target_arr, jint nv21_size, jint y_size, jint yuv_gap)</span> </span>&#123;<br>    jbyte *in_ptr = env-&gt;<span class="hljs-built_in">GetByteArrayElements</span>(input_arr, <span class="hljs-literal">false</span>);<br>    jbyte *target_ptr = env-&gt;<span class="hljs-built_in">GetByteArrayElements</span>(target_arr, <span class="hljs-literal">false</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = y_size; i &lt; nv21_size; i+=<span class="hljs-number">2</span>)&#123;<br>        target_ptr[i] = in_ptr[i + yuv_gap + <span class="hljs-number">1</span>];<br>        target_ptr[i + <span class="hljs-number">1</span>] = in_ptr[i + yuv_gap];<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure></p><h3 id="è¿”å›Javaå¯¹è±¡"><a href="#è¿”å›Javaå¯¹è±¡" class="headerlink" title="è¿”å›Javaå¯¹è±¡"></a>è¿”å›Javaå¯¹è±¡</h3><p>NDKä¸­å¯ä»¥åˆ›å»ºJavaå¯¹è±¡å¹¶è¿”å›ã€‚<br>ä¾‹å¦‚æˆ‘ä»¬æ–°å»ºä¸€ä¸ª<code>JavaUser</code>ç±»ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JavaUser</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;<br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">JavaUser</span><span class="hljs-params">(<span class="hljs-type">int</span> age, String name)</span> &#123;<br>        <span class="hljs-built_in">this</span>.age = age;<br>        <span class="hljs-built_in">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> name + <span class="hljs-string">&quot;, &quot;</span> + age;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>nativeæ–¹æ³•è¿”å›ä¸€ä¸ªJavaUserå¯¹è±¡<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NDKUtils</span> &#123;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        System.loadLibrary(<span class="hljs-string">&quot;NDKMan&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> JavaUser <span class="hljs-title function_">createUser</span><span class="hljs-params">(<span class="hljs-type">int</span> age, String name)</span> &#123;<br>        <span class="hljs-keyword">return</span> nativeGetUser(age, name);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> JavaUser <span class="hljs-title function_">nativeGetUser</span><span class="hljs-params">(<span class="hljs-type">int</span> age, String name)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure></p><p>cæ–‡ä»¶å®ç°ä»£ç ã€‚æ³¨æ„å‚æ•°ç­¾åçš„å†™æ³•ï¼Œè¦å‚ç…§æ ‡å‡†ã€‚<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">JNIEXPORT jobject JNICALL <span class="hljs-title function_">Java_com_rustfisher_ndkalgo_NDKUtils_nativeGetUser</span><br>    <span class="hljs-params">(JNIEnv *env, jobject jObj, jint age, jstring name)</span><br>&#123;<br>    jclass userClass = (*env)-&gt;FindClass(env, <span class="hljs-string">&quot;com/rustfisher/ndkalgo/JavaUser&quot;</span>);<br>    jmethodID userConstruct = (*env)-&gt;GetMethodID(env, userClass, <span class="hljs-string">&quot;&lt;init&gt;&quot;</span>, <span class="hljs-string">&quot;(ILjava/lang/String;)V&quot;</span>);<br>    <span class="hljs-keyword">return</span> (*env)-&gt;NewObject(env, userClass, userConstruct, age, name);<br>&#125;<br></code></pre></td></tr></table></figure></p><p>è°ƒç”¨nativeæ–¹æ³•ç”Ÿæˆå¯¹è±¡<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testJavaUserNDK</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">NDKUtils</span> <span class="hljs-variable">ndkUtils</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NDKUtils</span>();<br>    <span class="hljs-type">JavaUser</span> <span class="hljs-variable">tom</span> <span class="hljs-operator">=</span> ndkUtils.createUser(<span class="hljs-number">20</span>, <span class="hljs-string">&quot;Tom&quot;</span>);<br>    Log.d(TAG, tom.toString());<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="NDKå…¼å®¹æ€§é—®é¢˜"><a href="#NDKå…¼å®¹æ€§é—®é¢˜" class="headerlink" title="NDKå…¼å®¹æ€§é—®é¢˜"></a>NDKå…¼å®¹æ€§é—®é¢˜</h3><p>Vivo x6plus å…¼å®¹æ€§é—®é¢˜ã€‚Vivo x6plus æ‰“å¼€Parrotç•Œé¢å³å´©æºƒã€‚ä½†æ˜¯Parrotå®˜æ–¹APPèƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ã€‚<br>æˆ‘è‡ªå·±çš„soåº“ä¸Parrotçš„soåº“ä¸å…¼å®¹ï¼Œå‡ºç°</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">java.lang.UnsatisfiedLinkError:<br>dalvik.system.PathClassLoader<span class="hljs-literal">[D<span class="hljs-identifier">exPathList</span>[[<span class="hljs-identifier">zip</span> <span class="hljs-identifier">file</span> &quot;<span class="hljs-operator">/</span><span class="hljs-identifier">data</span><span class="hljs-operator">/</span><span class="hljs-identifier">app</span><span class="hljs-operator">/</span><span class="hljs-identifier">com</span>.<span class="hljs-identifier">xx</span>.<span class="hljs-identifier">xx</span>.<span class="hljs-identifier">xxx</span>-<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-identifier">base</span>.<span class="hljs-identifier">apk</span>&quot;]</span>,nativeLibraryDirectories=<span class="hljs-literal">[<span class="hljs-operator">/</span><span class="hljs-identifier">data</span><span class="hljs-operator">/</span><span class="hljs-identifier">app</span><span class="hljs-operator">/</span><span class="hljs-identifier">com</span>.<span class="hljs-identifier">xx</span>.<span class="hljs-identifier">xx</span>.<span class="hljs-identifier">xxx</span>-<span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-identifier">lib</span><span class="hljs-operator">/</span><span class="hljs-identifier">arm64</span>, <span class="hljs-operator">/</span><span class="hljs-identifier">vendor</span><span class="hljs-operator">/</span><span class="hljs-identifier">lib64</span>, <span class="hljs-operator">/</span><span class="hljs-identifier">system</span><span class="hljs-operator">/</span><span class="hljs-identifier">lib64</span>]</span>]] couldn&#x27;t find <span class="hljs-string">&quot;libjson.so&quot;</span><br>    at java.lang.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Runtime</span>.</span></span>load<span class="hljs-constructor">Library(Runtime.<span class="hljs-params">java</span>:366)</span><br>    at java.lang.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">System</span>.</span></span>load<span class="hljs-constructor">Library(System.<span class="hljs-params">java</span>:988)</span><br>    at com.parrot.arsdk.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">ARSDK</span>.</span></span>load<span class="hljs-constructor">SDKLibs(ARSDK.<span class="hljs-params">java</span>:20)</span><br>    at com.parrot.sdk.activity.DronesListActivity.&lt;clinit&gt;(<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">DronesListActivity</span>.</span></span>java:<span class="hljs-number">44</span>)<br>    at java.lang.reflect.<span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Constructor</span>.</span></span><span class="hljs-keyword">new</span><span class="hljs-constructor">Instance(Native Method)</span><br></code></pre></td></tr></table></figure><h4 id="åˆ†æå¤„ç†å…¼å®¹æ€§é—®é¢˜"><a href="#åˆ†æå¤„ç†å…¼å®¹æ€§é—®é¢˜" class="headerlink" title="åˆ†æå¤„ç†å…¼å®¹æ€§é—®é¢˜"></a>åˆ†æå¤„ç†å…¼å®¹æ€§é—®é¢˜</h4><p>å°†Parrotå®˜æ–¹apkè§£åŒ…åï¼Œæ‰¾åˆ°soåº“æ–‡ä»¶ã€‚å‘ç°åªæœ‰x86ã€mipsã€armeabi_v7aã€armeabi è¿™4ä¸ªã€‚<br>è€Œæˆ‘åŠ è½½äº†æœ‰æ›´å¤šçš„åº“ã€‚</p><p>å°†æˆ‘è‡ªå·±çš„soæ–‡ä»¶åˆ é™¤è‡³åªå‰©ä¸‹Parroté‚£4ä¸ªå³å¯ã€‚</p><p>Android.mk<br><code>TARGET_ARCH_ABI := x86 mips armeabi armeabi-v7a</code></p><h3 id="åŒåsoæ–‡ä»¶å¼•èµ·UnsatisfiedLinkError"><a href="#åŒåsoæ–‡ä»¶å¼•èµ·UnsatisfiedLinkError" class="headerlink" title="åŒåsoæ–‡ä»¶å¼•èµ·UnsatisfiedLinkError"></a>åŒåsoæ–‡ä»¶å¼•èµ·UnsatisfiedLinkError</h3><p>ä¸»å·¥ç¨‹<code>app</code>ä¸­å¸¦æœ‰Cå·¥ç¨‹ä¸soæ–‡ä»¶ã€‚ç°éœ€è¦å°†æ‰€æœ‰çš„Cå·¥ç¨‹ç§»åˆ°æ–°çš„æ¨¡å—<code>mylib</code>ä¸­ã€‚</p><p>æ–°å»ºæ¨¡å—<code>mylib</code>ï¼Œå°†Cå·¥ç¨‹å¤åˆ¶è¿›æ¥ã€‚gradleä¸­é…ç½®jniï¼Œå› ä¸ºä¿®æ”¹äº†æ–‡ä»¶è·¯å¾„ï¼Œé‡æ–°ç”Ÿæˆå¤´æ–‡ä»¶å¹¶ä¿®æ”¹cppæ–‡ä»¶ã€‚<br>åœ¨æ¨¡å—ä¸­è¿›è¡Œndk-buildï¼Œè·å¾—soåº“ã€‚</p><p>å®‰è£…è¿è¡Œappï¼Œå‡ºç°UnsatisfiedLinkErrorï¼š<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.UnsatisfiedLinkError</span>: No implementation found <span class="hljs-keyword">for</span> void com<span class="hljs-selector-class">.xx</span><span class="hljs-selector-class">.jni</span><span class="hljs-selector-class">.MyJNI</span><span class="hljs-selector-class">.init</span>(java<span class="hljs-selector-class">.lang</span>.String) <br>(tried Java_com_xx_jni_MyJNI_init and Java_com_xx_jni_MyJNI_init__Ljava_lang_String_2)<br></code></pre></td></tr></table></figure><br>åˆ†æåŸå› ï¼Œappèƒ½å¤Ÿæ­£å¸¸åŠ è½½åº“æ–‡ä»¶ï¼Œä½†æœªæ‰¾åˆ°å®ç°æ–¹æ³•ã€‚appä½¿ç”¨çš„soåº“ï¼Œç©¶ç«Ÿæ˜¯ä¸æ˜¯æˆ‘ä»¬æŒ‡å®šçš„é‚£ä¸ªã€‚</p><p>å°è¯•è¿›è¡Œä¿®å¤ï¼ŒåŸappå·¥ç¨‹çš„<code>Android.mk</code>ä¸­<br><figure class="highlight fix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">LOCAL_MODULE :</span>=<span class="hljs-string"> main</span><br></code></pre></td></tr></table></figure><br>ç§»åŠ¨åˆ°æ¨¡å—åï¼Œæ–°çš„<code>Android.mk</code>ä¿®æ”¹ä¸º<br><figure class="highlight fix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs fix"><span class="hljs-attr">LOCAL_MODULE :</span>=<span class="hljs-string"> mynewmain</span><br></code></pre></td></tr></table></figure><br>åº“æ”¹äº†åå­—åï¼Œä¿®æ”¹Javaä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> &#123;<br>    System.loadLibrary(<span class="hljs-string">&quot;mynewmain&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><br>é‡è£…appå³å¯æ­£å¸¸ä½¿ç”¨ã€‚</p><p>ç»è¿‡åˆ†æä¸å°è¯•ï¼Œåˆ é™¤åŸappå·¥ç¨‹ä¸­æ‰€æœ‰çš„soæ–‡ä»¶ï¼Œå†æ¬¡é‡è£…appå³å¯æ­£å¸¸è¿è¡Œã€‚ä¸éœ€è¦ä¿®æ”¹soåº“çš„åå­—ã€‚</p><p>é”™è¯¯åŸå› çŒœæƒ³ï¼šappä¸»å·¥ç¨‹ä¸æ¨¡å—<code>mylib</code>ä¸­æœ‰åŒåçš„soæ–‡ä»¶ï¼Œå®‰è£…appæ—¶ä¼šä¼˜å…ˆä½¿ç”¨appä¸»å·¥ç¨‹ä¸­çš„soåº“ã€‚</p><h3 id="jstringè½¬ä¸ºcharçš„æ–¹æ³•-jstring-gt-char"><a href="#jstringè½¬ä¸ºcharçš„æ–¹æ³•-jstring-gt-char" class="headerlink" title="jstringè½¬ä¸ºcharçš„æ–¹æ³• jstring -&gt; char"></a>jstringè½¬ä¸ºcharçš„æ–¹æ³• jstring -&gt; char</h3><p>jstringè½¬ä¸ºcharçš„æ–¹æ³•<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">char</span> *<span class="hljs-title">jstringToChar</span><span class="hljs-params">(JNIEnv *env, jstring jstr)</span> </span>&#123;<br>    <span class="hljs-type">char</span> *rtn = <span class="hljs-literal">NULL</span>;<br>    jclass clsstring = env-&gt;<span class="hljs-built_in">FindClass</span>(<span class="hljs-string">&quot;java/lang/String&quot;</span>);<br>    jstring strencode = env-&gt;<span class="hljs-built_in">NewStringUTF</span>(<span class="hljs-string">&quot;GB2312&quot;</span>);<br>    jmethodID mid = env-&gt;<span class="hljs-built_in">GetMethodID</span>(clsstring, <span class="hljs-string">&quot;getBytes&quot;</span>, <span class="hljs-string">&quot;(Ljava/lang/String;)[B&quot;</span>);<br>    jbyteArray barr = (jbyteArray) env-&gt;<span class="hljs-built_in">CallObjectMethod</span>(jstr, mid, strencode);<br>    jsize alen = env-&gt;<span class="hljs-built_in">GetArrayLength</span>(barr);<br>    jbyte *ba = env-&gt;<span class="hljs-built_in">GetByteArrayElements</span>(barr, JNI_FALSE);<br>    <span class="hljs-keyword">if</span> (alen &gt; <span class="hljs-number">0</span>) &#123;<br>        rtn = (<span class="hljs-type">char</span> *) <span class="hljs-built_in">malloc</span>(alen + <span class="hljs-number">1</span>);<br>        <span class="hljs-built_in">memcpy</span>(rtn, ba, alen);<br>        rtn[alen] = <span class="hljs-number">0</span>;<br>    &#125;<br>    env-&gt;<span class="hljs-built_in">ReleaseByteArrayElements</span>(barr, ba, <span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">return</span> rtn;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>å‚è€ƒ <a href="https://blog.csdn.net/xlxxcc/article/details/51106721">JNIä¸­string ã€ char* å’Œ jstring ä¸¤ç§è½¬æ¢ - CSDN xlxxcc</a></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android NDK åˆæ­¥</title>
    <link href="/2016/06/14/Android/NDK-use_sample_2/"/>
    <url>/2016/06/14/Android/NDK-use_sample_2/</url>
    
    <content type="html"><![CDATA[<ul><li>å¼€å‘ç¯å¢ƒï¼š win7 64ï¼ŒAndroid Studio 2.1</li></ul><p>éœ€è¦å·¥å…·ï¼šNDKï¼ŒCygwin</p><h3 id="ä½¿ç”¨adbæŸ¥çœ‹æ‰‹æœºCPUæ¶æ„ä¿¡æ¯"><a href="#ä½¿ç”¨adbæŸ¥çœ‹æ‰‹æœºCPUæ¶æ„ä¿¡æ¯" class="headerlink" title="ä½¿ç”¨adbæŸ¥çœ‹æ‰‹æœºCPUæ¶æ„ä¿¡æ¯"></a>ä½¿ç”¨adbæŸ¥çœ‹æ‰‹æœºCPUæ¶æ„ä¿¡æ¯</h3><p>å°†æ‰‹æœºé€šè¿‡USBè¿æ¥åˆ°ç”µè„‘ï¼Œadb shellè¿›å…¥æ‰‹æœºæ ¹ç›®å½•ï¼Œæ‰§è¡Œ<code>cat /proc/cpuinfo</code><br><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs tcl">shell@hnCHE-H:/ $ cat /<span class="hljs-keyword">proc</span>/cpuinfo<span class="hljs-title"></span><br><span class="hljs-title">cat</span> /<span class="hljs-keyword">proc</span>/cpuinfo<span class="hljs-title"></span><br><span class="hljs-title">Processor</span>       :<span class="hljs-title"> AArch64</span> Processor<span class="hljs-title"> rev</span> 3 (aarch64)<span class="hljs-title"></span><br><span class="hljs-title">processor</span>       : 0<span class="hljs-title"></span><br><span class="hljs-title">processor</span>       : 1<span class="hljs-title"></span><br><span class="hljs-title">processor</span>       : 2<span class="hljs-title"></span><br><span class="hljs-title">processor</span>       : 3<span class="hljs-title"></span><br><span class="hljs-title">processor</span>       : 4<span class="hljs-title"></span><br><span class="hljs-title">processor</span>       : 5<span class="hljs-title"></span><br><span class="hljs-title">processor</span>       : 6<span class="hljs-title"></span><br><span class="hljs-title">processor</span>       : 7<span class="hljs-title"></span><br><span class="hljs-title">Features</span>        :<span class="hljs-title"> fp</span> asimd<span class="hljs-title"> evtstrm</span> aes<span class="hljs-title"> pmull</span> sha1<span class="hljs-title"> sha2</span> crc32<span class="hljs-title"></span><br><span class="hljs-title">CPU</span> implementer : 0x41<span class="hljs-title"></span><br><span class="hljs-title">CPU</span> architecture:<span class="hljs-title"> AArch64</span><br>CPU<span class="hljs-title"> variant</span>     : 0x0<span class="hljs-title"></span><br><span class="hljs-title">CPU</span> part        : 0xd03<span class="hljs-title"></span><br><span class="hljs-title">CPU</span> revision    : 3<span class="hljs-title"></span><br><span class="hljs-title"></span><br><span class="hljs-title">Hardware</span>        :<span class="hljs-title"> hi6210sft</span><br></code></pre></td></tr></table></figure><br>å¯ä»¥çœ‹åˆ°æ‰‹æœºå¤„ç†å™¨çš„ä¿¡æ¯</p><h3 id="ä½¿ç”¨-SDK-Manager-é…ç½®å®‰è£…-NDK"><a href="#ä½¿ç”¨-SDK-Manager-é…ç½®å®‰è£…-NDK" class="headerlink" title="ä½¿ç”¨ SDK Manager é…ç½®å®‰è£… NDK"></a>ä½¿ç”¨ SDK Manager é…ç½®å®‰è£… NDK</h3><p>æ·»åŠ ç³»ç»Ÿç¯å¢ƒå˜é‡ <code>G:\SDK\ndk-bundle;G:\SDK\platform-tools</code></p><p>ä¸‹è½½å¹¶å®‰è£…Cygwinï¼š<a href="https://cygwin.com/install.html">https://cygwin.com/install.html</a></p><p>Cygwin å®‰è£…NDKéœ€è¦çš„å·¥å…·åŒ…ï¼ˆå¦‚æœç¬¬ä¸€æ¬¡å®‰è£…æ—¶æ²¡æœ‰é€‰æ‹©å·¥å…·åŒ…ï¼Œå¯ä»¥å†æ¬¡å¯åŠ¨å®‰è£…ï¼‰ï¼š<br>make, gcc, gdb, mingw64-x86_64-gcc, binutils<br><img src="https://raw.githubusercontent.com/RustFisher/RustNotes/master/Android_note/pics/Cygwin_tools.png" alt="tools"></p><p>é…ç½®<code>G:\soft\Cygwin\home\Administrator\.bashrc</code>ï¼Œæ·»åŠ ä¸‹é¢çš„æŒ‡ä»¤ï¼Œä½¿ç”¨è‹±æ–‡ç•Œé¢ã€‚<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">export</span> <span class="hljs-attribute">LANG</span>=<span class="hljs-string">&#x27;en_US&#x27;</span><br><span class="hljs-built_in">export</span> <span class="hljs-attribute">LC_ALL</span>=<span class="hljs-string">&#x27;en_US.GBK&#x27;</span><br></code></pre></td></tr></table></figure><br>é…ç½®texté€‰é¡¹ï¼Œåœ¨optioné‡Œçš„textå¯è®¾ç½®ã€‚<br>å¯ä»¥åœ¨<code>G:\soft\Cygwin\home\Administrator\.minttyrc</code>ä¸­çœ‹åˆ°ã€‚</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">Locale</span><span class="hljs-operator">=</span>zh_CN<br><span class="hljs-attribute">Charset</span><span class="hljs-operator">=</span>GBK<br></code></pre></td></tr></table></figure><p>è®¾ç½®å®Œå­—ä½“åå¯ä»¥é¿å…ä¸­æ–‡ä¹±ç ã€‚</p><p>é…ç½® <code>G:\soft\Cygwin\home\Administrator\.bash_profile</code></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">NDK=<span class="hljs-regexp">/cygdrive/</span>G<span class="hljs-regexp">/SDK/</span>ndk-bundle/ndk-build.cmd<br>export NDK<br></code></pre></td></tr></table></figure><p>åœ¨Cygwinä¸­æŸ¥æ‰¾NDKä½ç½®ï¼Œå¯ä»¥çœ‹åˆ°åœ¨SDKç›®å½•é‡Œé¢</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Administrator@rust-PC /cygdrive/g/soft/Cygwin/home/Administrator<br>$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$NDK</span><br>/cygdrive/G/SDK/ndk-bundle/ndk-build.cmd<br></code></pre></td></tr></table></figure><h3 id="æ“ä½œç¤ºä¾‹NDKå·¥ç¨‹"><a href="#æ“ä½œç¤ºä¾‹NDKå·¥ç¨‹" class="headerlink" title="æ“ä½œç¤ºä¾‹NDKå·¥ç¨‹"></a>æ“ä½œç¤ºä¾‹NDKå·¥ç¨‹</h3><p><em>JDK10å·²ç»ä¸æä¾›<code>javah</code>è¿™ä¸ªå·¥å…·äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨asæ”¯æŒc++çš„åŠŸèƒ½ï¼›è¯¦æƒ…è§ä¸‹æ–‡</em></p><p>ç”Ÿæˆä¸€æ¬¡è¯•è¯•ã€‚ä»githubä¸Šè·å–android-ndk-android-mkï¼Œè¿›å…¥hello-jniå·¥ç¨‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Administrator@rust-PC /cygdrive/g/rust_proj/android-ndk-android-mk/hello-jni<br>$ ndk-build.cmd<br><span class="hljs-comment"># è¾“å‡ºå¾ˆå¤šä¿¡æ¯</span><br></code></pre></td></tr></table></figure><p>ç¼–è¯‘æˆåŠŸåï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªlibsç›®å½•ï¼Œç¼–è¯‘ç”Ÿæˆçš„.soæ–‡ä»¶æ”¾åœ¨é‡Œé¢ã€‚</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs awk">Administrator@rust-PC <span class="hljs-regexp">/cygdrive/g</span><span class="hljs-regexp">/rust_proj/</span>NDKTest<span class="hljs-regexp">/app/</span>src/main<br>$ ndk-build.cmd<br>[armeabi] Install        : librust_ndk.so =&gt; libs<span class="hljs-regexp">/armeabi/</span>librust_ndk.so<br><span class="hljs-comment"># è¿›å…¥javaç›®å½•ï¼Œç¼–è¯‘.hæ–‡ä»¶</span><br>Administrator@rust-PC <span class="hljs-regexp">/cygdrive/g</span><span class="hljs-regexp">/rust_proj/</span>NDKTest<span class="hljs-regexp">/app/</span>src<span class="hljs-regexp">/main/</span>java<br>$ javah com.rustfisher.ndktest.HelloJNI<br><span class="hljs-comment"># ä¼šç”Ÿæˆä¸€ä¸ª.hæ–‡ä»¶</span><br></code></pre></td></tr></table></figure><p>å°†å®ƒå¤åˆ¶åˆ°jniæ–‡ä»¶å¤¹ä¸‹ï¼›è¿™ä¸ªå°±æ˜¯JNIå±‚çš„ä»£ç ã€‚</p><p>Ubuntuä¸‹javahæŠ¥é”™ã€‚éœ€è¦æ·»åŠ å‚æ•°</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">javah -cp <span class="hljs-regexp">/home/</span>rust<span class="hljs-regexp">/Android/</span>Sdk<span class="hljs-regexp">/platforms/</span>android-<span class="hljs-number">25</span>/android.jar:. com.example.LibUtil<br></code></pre></td></tr></table></figure><h3 id="ä½¿ç”¨C-C-å®ç°JNI"><a href="#ä½¿ç”¨C-C-å®ç°JNI" class="headerlink" title="ä½¿ç”¨C/C++å®ç°JNI"></a>ä½¿ç”¨C/C++å®ç°JNI</h3><p>é‡åˆ°é”™è¯¯ï¼š Error:Execution failed for task â€˜:app:compileDebugNdkâ€™.</p><blockquote><p>Error: NDK integration is deprecated in the current plugin.  Consider trying the new experimental plugin.  For details, see <a href="http://tools.android.com/tech-docs/new-build-system/gradle-experimental">http://tools.android.com/tech-docs/new-build-system/gradle-experimental</a>.  Set â€œandroid.useDeprecatedNdk=trueâ€ in gradle.properties to continue using the current NDK integration.</p></blockquote><p>è§£å†³åŠæ³•ï¼šåœ¨<code>app\build.gradle</code>æ–‡ä»¶ä¸­æ·»åŠ <br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">sourceSets<span class="hljs-selector-class">.main</span> &#123;<br>    jniLibs<span class="hljs-selector-class">.srcDir</span> <span class="hljs-string">&#x27;src/main/libs&#x27;</span><br>    jni<span class="hljs-selector-class">.srcDirs</span> = <span class="hljs-selector-attr">[]</span> <span class="hljs-comment">//disable automatic ndk-build call</span><br>&#125;<br></code></pre></td></tr></table></figure></p><p>æ–‡ä»¶æœ‰3ç§ï¼šæ¥å£æ–‡ä»¶<code>.h</code>ï¼› å®ç°æ–‡ä»¶<code>.c</code>ï¼Œæ³¨æ„ä¸å‰é¢çš„<code>.h</code>æ–‡ä»¶åŒåï¼› <code>.h</code>ä¸<code>.c</code>ç”Ÿæˆçš„åº“æ–‡ä»¶<code>.so</code></p><h3 id="æ“ä½œæ­¥éª¤å°ç»“"><a href="#æ“ä½œæ­¥éª¤å°ç»“" class="headerlink" title="æ“ä½œæ­¥éª¤å°ç»“"></a>æ“ä½œæ­¥éª¤å°ç»“</h3><p>From Java to C/C++<br>Step 1 å®šä¹‰Javaæ¥å£æ–‡ä»¶ï¼Œé‡Œé¢å®šä¹‰å¥½nativeæ–¹æ³•ã€‚<br>Step 2 javahç”Ÿæˆ.hæ¥å£æ–‡ä»¶ ã€‚<br>Step 3 å¤åˆ¶.hæ–‡ä»¶çš„æ–‡ä»¶åï¼Œç¼–å†™C/C++æ–‡ä»¶ã€‚æ³¨æ„è¦å®ç°.hä¸­çš„æ¥å£ã€‚  </p><h3 id="NDKé‡åˆ°çš„é—®é¢˜ä¸æ³¨æ„äº‹é¡¹"><a href="#NDKé‡åˆ°çš„é—®é¢˜ä¸æ³¨æ„äº‹é¡¹" class="headerlink" title="NDKé‡åˆ°çš„é—®é¢˜ä¸æ³¨æ„äº‹é¡¹"></a>NDKé‡åˆ°çš„é—®é¢˜ä¸æ³¨æ„äº‹é¡¹</h3><h4 id="æ–‡ä»¶å…³è”é—®é¢˜"><a href="#æ–‡ä»¶å…³è”é—®é¢˜" class="headerlink" title="æ–‡ä»¶å…³è”é—®é¢˜"></a>æ–‡ä»¶å…³è”é—®é¢˜</h4><p>å†™cppæºæ–‡ä»¶çš„æ—¶å€™ï¼Œå¿˜è®°includeå¤´æ–‡ä»¶ã€‚äº§ç”Ÿ<code>java.lang.UnsatisfiedLinkError: No implementation found for</code> ä¹‹ç±»çš„é”™è¯¯<br>stackoverflowä¸Šæœ‰å…³äº<code>Android NDK C++ JNI (no implementation found for nativeâ€¦)</code>çš„é—®é¢˜ã€‚</p><h4 id="NDKæœ¬åœ°å¯¹è±¡æ•°é‡æº¢å‡ºé—®é¢˜-Local-ref-table-overflow"><a href="#NDKæœ¬åœ°å¯¹è±¡æ•°é‡æº¢å‡ºé—®é¢˜-Local-ref-table-overflow" class="headerlink" title="NDKæœ¬åœ°å¯¹è±¡æ•°é‡æº¢å‡ºé—®é¢˜ Local ref table overflow"></a>NDKæœ¬åœ°å¯¹è±¡æ•°é‡æº¢å‡ºé—®é¢˜ <code>Local ref table overflow</code></h4><p>NDKæœ¬åœ°åªå…è®¸æŒæœ‰512ä¸ªæœ¬åœ°å¯¹è±¡ï¼Œreturnåä¼šé”€æ¯è¿™äº›å¯¹è±¡ã€‚å¿…é¡»æ³¨æ„ï¼Œåœ¨å¾ªç¯ä¸­åˆ›å»ºçš„æœ¬åœ°å¯¹è±¡è¦åœ¨ä½¿ç”¨åé”€æ¯æ‰ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">env-&gt;<span class="hljs-built_in">DeleteLocalRef</span>(local_ref);<span class="hljs-comment">// local_ref æ˜¯æœ¬åœ°åˆ›å»ºçš„å¯¹è±¡</span><br></code></pre></td></tr></table></figure><h4 id="è°ƒç”¨Javaæ–¹æ³•æ—¶ï¼Œæ³¨æ„æŒ‡å®šè¿”å›å€¼"><a href="#è°ƒç”¨Javaæ–¹æ³•æ—¶ï¼Œæ³¨æ„æŒ‡å®šè¿”å›å€¼" class="headerlink" title="è°ƒç”¨Javaæ–¹æ³•æ—¶ï¼Œæ³¨æ„æŒ‡å®šè¿”å›å€¼"></a>è°ƒç”¨Javaæ–¹æ³•æ—¶ï¼Œæ³¨æ„æŒ‡å®šè¿”å›å€¼</h4><p><code>env-&gt;CallBooleanMethod(resArrayList,arrayList_add, javaObject);</code> ArrayListçš„addæ–¹æ³•è¿”å›Boolean</p><p>å‚è€ƒï¼š<a href="https://www3.ntu.edu.sg/home/ehchua/programming/java/JavaNativeInterface.html">https://www3.ntu.edu.sg/home/ehchua/programming/java/JavaNativeInterface.html</a></p><h4 id="C-è°ƒç”¨Cæ–¹æ³•"><a href="#C-è°ƒç”¨Cæ–¹æ³•" class="headerlink" title="C++è°ƒç”¨Cæ–¹æ³•"></a>C++è°ƒç”¨Cæ–¹æ³•</h4><p>C++æ–‡ä»¶ä¸­ï¼Œéœ€è¦è°ƒç”¨Cé‡Œé¢çš„æ–¹æ³•ã€‚å¦‚æœæœªç»ä»»ä½•å¤„ç†ï¼Œä¼šå‡ºç°æ— å¼•ç”¨é”™è¯¯<br><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs subunit"><span class="hljs-keyword">error: </span>undefined reference to &#x27;......<br></code></pre></td></tr></table></figure></p><p>å› æ­¤åœ¨C++æ–‡ä»¶ä¸­æ¶‰åŠåˆ°Cæ–¹æ³•ï¼Œéœ€è¦å£°æ˜ã€‚<br>ä¾‹å¦‚<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> __cplusplus</span><br><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> &#123;<br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;c_file_header.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">ifdef</span> __cplusplus</span><br>&#125;<br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">endif</span></span><br><span class="hljs-comment">// ___ ç»“æŸå£°æ˜</span><br></code></pre></td></tr></table></figure></p><p>javahç”Ÿæˆçš„JNIå¤´æ–‡ä»¶ä¸­ä¹Ÿæœ‰externï¼Œå¯ä½œä¸ºå‚è€ƒ</p><h3 id="NDKä¸­ä½¿ç”¨logcat"><a href="#NDKä¸­ä½¿ç”¨logcat" class="headerlink" title="NDKä¸­ä½¿ç”¨logcat"></a>NDKä¸­ä½¿ç”¨logcat</h3><p>é…ç½®ï¼šCygwinï¼Œ NDK 14.1â€¦<br>å¯ä»¥åœ¨NDKä¸­ä½¿ç”¨logcatï¼Œæ–¹ä¾¿è°ƒè¯•<br>éœ€è¦åœ¨mkæ–‡ä»¶ä¸­æ·»åŠ <br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">LOCAL_LDLIBS := -L$(SYSROOT)<span class="hljs-regexp">/usr/</span>lib -llog<br></code></pre></td></tr></table></figure></p><p>ä»£ç ä¸­æ·»åŠ å¤´æ–‡ä»¶ï¼Œå³å¯è°ƒç”¨logcatçš„æ–¹æ³•<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;android/log.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG_TAG    <span class="hljs-string">&quot;rustApp&quot;</span></span><br><br>__android_log_write(ANDROID_LOG_VERBOSE, LOG_TAG, <span class="hljs-string">&quot;My Log&quot;</span>);<br></code></pre></td></tr></table></figure></p><p>æ­¤æ—¶ç¼–è¯‘å‡ºç°äº†é”™è¯¯ï¼š<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk">G:<span class="hljs-regexp">/SDK/</span>ndk-bundle<span class="hljs-regexp">/build/</span><span class="hljs-regexp">/../</span>toolchains<span class="hljs-regexp">/x86_64-4.9/</span>prebuilt<span class="hljs-regexp">/windows-x86_64/</span>lib<span class="hljs-regexp">/gcc/</span>x86_64-linux-android<span class="hljs-regexp">/4.9.x/</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>x86_64-linux-android<span class="hljs-regexp">/bin\ld: warning: skipping incompatible G:/</span>SDK<span class="hljs-regexp">/ndk-bundle/</span>build<span class="hljs-regexp">//</span>..<span class="hljs-regexp">/platforms/</span>android-<span class="hljs-number">21</span><span class="hljs-regexp">/arch-x86_64/u</span>sr<span class="hljs-regexp">/lib/</span>libc.a <span class="hljs-keyword">while</span> searching <span class="hljs-keyword">for</span> c<br>G:<span class="hljs-regexp">/SDK/</span>ndk-bundle<span class="hljs-regexp">/build/</span><span class="hljs-regexp">/../</span>toolchains<span class="hljs-regexp">/x86_64-4.9/</span>prebuilt<span class="hljs-regexp">/windows-x86_64/</span>lib<span class="hljs-regexp">/gcc/</span>x86_64-linux-android<span class="hljs-regexp">/4.9.x/</span>..<span class="hljs-regexp">/../</span>..<span class="hljs-regexp">/../</span>x86_64-linux-android/bin\ld: error: treating warnings as errors<br>clang++.exe: error: linker command failed with <span class="hljs-keyword">exit</span> code <span class="hljs-number">1</span> (use -v to see invocation)<br>make: *** [G:<span class="hljs-regexp">/openSourceProject/</span>NDKAlgo<span class="hljs-regexp">/app/</span>src<span class="hljs-regexp">/main/</span>obj<span class="hljs-regexp">/local/</span>x86_64/libNDKMan.so] Error <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure></p><p>å‡ºç°äº†<code>error: treating warnings as errors</code><br>å¤„ç†æ–¹æ³•ï¼Œåœ¨mkæ–‡ä»¶ä¸­æ·»åŠ <code>LOCAL_DISABLE_FATAL_LINKER_WARNINGS=true</code><br>å†æ¬¡ç¼–è¯‘å³å¯</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®å®šä¹‰ç®€åŒ–æ‰“logçš„å†™æ³•<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG_TAG    <span class="hljs-string">&quot;rustApp&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOGV(...) __android_log_write(ANDROID_LOG_VERBOSE, LOG_TAG, __VA_ARGS__)</span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOGD(...) __android_log_print(ANDROID_LOG_DEBUG , LOG_TAG, __VA_ARGS__)  </span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOGI(...) __android_log_print(ANDROID_LOG_INFO , LOG_TAG, __VA_ARGS__)  </span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOGW(...) __android_log_print(ANDROID_LOG_WARN , LOG_TAG, __VA_ARGS__)  </span><br><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOGE(...) __android_log_print(ANDROID_LOG_ERROR , LOG_TAG, __VA_ARGS__)  </span><br><br><span class="hljs-comment">// è°ƒç”¨</span><br>LOGV(<span class="hljs-string">&quot;This is my log&quot;</span>);<br></code></pre></td></tr></table></figure></p><h3 id="Android-Studio-3-ä¸ºlibrary-moduleæ·»åŠ C-æ”¯æŒ"><a href="#Android-Studio-3-ä¸ºlibrary-moduleæ·»åŠ C-æ”¯æŒ" class="headerlink" title="Android Studio 3 ä¸ºlibrary moduleæ·»åŠ C++æ”¯æŒ"></a>Android Studio 3 ä¸ºlibrary moduleæ·»åŠ C++æ”¯æŒ</h3><p>asåœ¨æ–°å»ºprojectçš„æ—¶å€™å¯ä»¥é€‰æ‹©æ”¯æŒC++ï¼Œå¯ä»¥æ–°å»ºä¸€ä¸ªæ”¯æŒC++çš„é¡¹ç›®æ¥å‚è€ƒã€‚<br>å¯ä»¥ä¸ç”¨è‡ªå·±javahæ¥ç”Ÿæˆå¤´æ–‡ä»¶ã€‚</p><p>åœ¨å·¥ç¨‹ä¸­æ–°å»ºandroid libraryï¼Œå°†<code>CMakeLists.txt</code>æ·»åŠ åˆ°æ¨¡å—ä¸­ã€‚è¿™é‡Œæ¨¡å—åæ˜¯<code>native-lib</code><br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">cmake_minimum_required</span>(VERSION <span class="hljs-number">3.4</span>.<span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">add_library</span>( <span class="hljs-comment"># Sets the name of the library.</span><br>             native-lib<br><br>             <span class="hljs-comment"># Sets the library as a shared library.</span><br>             SHARED<br><br>             <span class="hljs-comment"># Provides a relative path to your source file(s).</span><br>             src/main/cpp/native-lib.cpp<br>             src/main/cpp/imagetool.cpp)<br><br><span class="hljs-keyword">find_library</span>( <span class="hljs-comment"># Sets the name of the path variable.</span><br>              log-lib<br><br>              <span class="hljs-comment"># Specifies the name of the NDK library that</span><br>              <span class="hljs-comment"># you want CMake to locate.</span><br>              log )<br><br><span class="hljs-keyword">target_link_libraries</span>( <span class="hljs-comment"># Specifies the target library.</span><br>                       native-lib<br><br>                       <span class="hljs-comment"># Links the target library to the log library</span><br>                       <span class="hljs-comment"># included in the NDK.</span><br>                       <span class="hljs-variable">$&#123;log-lib&#125;</span> )<br></code></pre></td></tr></table></figure></p><p>ä¿®æ”¹æ¨¡å—çš„<code>build.gradle</code><br><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs fsharp"><span class="hljs-keyword">android</span> &#123;<br>    compileSdkVersion <span class="hljs-number">26</span><br>    <span class="hljs-keyword">defaultConfig</span> &#123;<br>        minSdkVersion <span class="hljs-number">19</span><br>        targetSdkVersion <span class="hljs-number">26</span><br>        versionCode <span class="hljs-number">1</span><br>        versionName <span class="hljs-string">&quot;1.0&quot;</span><br><br>        testInstrumentationRunner <span class="hljs-string">&quot;android.support.test.runner.AndroidJUnitRunner&quot;</span><br>        <span class="hljs-comment">// æ·»åŠ </span><br>        <span class="hljs-keyword">externalNativeBuild</span> &#123;<br>            <span class="hljs-keyword">cmake</span> &#123;<br>                cppFlags <span class="hljs-string">&quot;&quot;</span><br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">buildTypes</span> &#123;<br>        <span class="hljs-keyword">release</span> &#123;<br>            minifyEnabled <span class="hljs-literal">false</span><br>            proguardFiles getDefaultProguardFile(<span class="hljs-symbol">&#x27;proguard</span><span class="hljs-operator">-</span>android.txt&#x27;), <span class="hljs-symbol">&#x27;proguard</span><span class="hljs-operator">-</span>rules.pro&#x27;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">// æ·»åŠ </span><br>    <span class="hljs-keyword">externalNativeBuild</span> &#123;<br>        <span class="hljs-keyword">cmake</span> &#123;<br>            path <span class="hljs-string">&quot;CMakeLists.txt&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>æ–°å»ºJavaæ–‡ä»¶å’ŒC++æ–‡ä»¶ï¼Œå¤§è‡´ç›®å½•å¦‚ä¸‹<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs ada">main<br>|<span class="hljs-comment">-- AndroidManifest.xml</span><br>|<span class="hljs-comment">-- cpp</span><br>|   |<span class="hljs-comment">-- imagetool.cpp   // cppæ–‡ä»¶</span><br>|   `<span class="hljs-comment">-- native-lib.cpp</span><br>|<span class="hljs-comment">-- java</span><br>|   `<span class="hljs-comment">-- com</span><br>|       `<span class="hljs-comment">-- example</span><br>|           `<span class="hljs-comment">-- myclib</span><br>|               `<span class="hljs-comment">-- ImageDetect.java // Javaæ–‡ä»¶</span><br>`<span class="hljs-comment">-- res</span><br></code></pre></td></tr></table></figure></p><p>ImageDetect.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageDetect</span> &#123;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        System.loadLibrary(<span class="hljs-string">&quot;native-lib&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">inputPath</span><span class="hljs-params">(String path)</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> String <span class="hljs-title function_">stringFromJNI</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getOne</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>native-lib.cpp<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;jni.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span> &#123;<br><br><span class="hljs-function">JNIEXPORT jstring</span><br><span class="hljs-function">JNICALL</span><br><span class="hljs-function"><span class="hljs-title">Java_com_example_myclib_ImageDetect_stringFromJNI</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        JNIEnv *env,</span></span><br><span class="hljs-params"><span class="hljs-function">        jobject <span class="hljs-comment">/* this */</span>)</span> </span>&#123;<br>    std::string hello = <span class="hljs-string">&quot;In myclib Hello from C++&quot;</span>;<br>    <span class="hljs-keyword">return</span> env-&gt;<span class="hljs-built_in">NewStringUTF</span>(hello.<span class="hljs-built_in">c_str</span>());<br>&#125;<br><br><span class="hljs-function">JNIEXPORT jint</span><br><span class="hljs-function">JNICALL</span><br><span class="hljs-function"><span class="hljs-title">Java_com_example_myclib_ImageDetect_getOne</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        JNIEnv *env,</span></span><br><span class="hljs-params"><span class="hljs-function">        jobject <span class="hljs-comment">/* this */</span>)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">9257</span>;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>imagetool.cpp<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;jni.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-string">&quot;C&quot;</span><br><span class="hljs-function">JNIEXPORT <span class="hljs-type">void</span></span><br><span class="hljs-function"></span><br><span class="hljs-function">JNICALL</span><br><span class="hljs-function"><span class="hljs-title">Java_com_example_myclib_ImageDetect_inputPath</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        JNIEnv *env,</span></span><br><span class="hljs-params"><span class="hljs-function">        jobject <span class="hljs-comment">/* this */</span>jobj, jstring inputPath)</span> </span>&#123;<br>            <span class="hljs-comment">// just test</span><br>    <span class="hljs-keyword">return</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><p>ç¼–è¯‘è¿è¡Œå³å¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç›‘å¬è€…æ¨¡å¼ - åœ¨Javaä¸Androidä¸­çš„ä½¿ç”¨</title>
    <link href="/2016/05/16/DesignPattern/Listener_pattern_practice_in_Java_Android/"/>
    <url>/2016/05/16/DesignPattern/Listener_pattern_practice_in_Java_Android/</url>
    
    <content type="html"><![CDATA[<p>ç›‘å¬è€…æ¨¡å¼ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰èƒ½é™ä½å¯¹è±¡ä¹‹é—´è€¦åˆç¨‹åº¦ã€‚ä¸ºä¸¤ä¸ªç›¸äº’ä¾èµ–è°ƒç”¨çš„ç±»è¿›è¡Œè§£è€¦ã€‚<br>ä¾¿äºè¿›è¡Œæ¨¡å—åŒ–å¼€å‘å·¥ä½œã€‚ä¸åŒæ¨¡å—çš„å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºè‡ªèº«çš„ä»£ç ã€‚<br>ç›‘å¬è€…ç”¨æ¥ç›‘å¬è‡ªå·²æ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Œå½“æ”¶åˆ°è‡ªå·²æ„Ÿå…´è¶£çš„äº‹ä»¶æ—¶æ‰§è¡Œè‡ªå®šä¹‰çš„æ“ä½œã€‚<br>åœ¨æŸäº›æ•°æ®å˜åŒ–æ—¶ï¼Œå…¶ä»–çš„ç±»åšå‡ºä¸€äº›å“åº”ã€‚å¤„ç†æ•°æ®ï¼ˆæˆ–è€…åˆ†å‘äº‹ä»¶ï¼‰çš„ç±»ä¸»åŠ¨æŠ•é€æ¶ˆæ¯ï¼Œæ„Ÿå…´è¶£çš„ç±»ä¸»åŠ¨â€œè®¢é˜…â€æ¶ˆæ¯ã€‚</p><p>ç›‘å¬è€…æ¨¡å¼åœ¨Androidä¸­æœ‰å¤§é‡çš„è¿ç”¨ï¼Œç›¸ä¿¡å¤§å®¶éƒ½ä¸ä¼šæ„Ÿåˆ°é™Œç”Ÿã€‚åœ¨Androidå¼€å‘ä¸­ï¼ŒButtonæ§ä»¶çš„ç‚¹å‡»äº‹ä»¶å°±æ˜¯ç›‘å¬è€…æ¨¡å¼æœ€å¸¸è§çš„ä¾‹å­ã€‚<br>å½“Buttonè¢«ç‚¹å‡»ï¼Œæ‰§è¡Œäº† <code>OnClickListener.onClick</code>ã€‚<br>Activityä¸­ç»™è¿™ä¸ªButtonè®¾ç½®äº†è‡ªå·±å®ç°çš„<code>OnClickListener</code>ï¼Œå¹¶å¤å†™äº†<code>onClick</code>æ–¹æ³•ï¼Œå°±èƒ½æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œäº†ã€‚</p><h3 id="Javaä»£ç å®ä¾‹"><a href="#Javaä»£ç å®ä¾‹" class="headerlink" title="Javaä»£ç å®ä¾‹"></a>Javaä»£ç å®ä¾‹</h3><p>ä¸‹é¢æ¥ç”¨Javaæ¥å®ç°ç›‘å¬è€…æ¨¡å¼ã€‚<br>è¿™ä¸ªä¾‹å­æ˜¯ç»™â€œè®¡ç®—ç±»â€æŒç»­åœ°ä¼ å…¥æ•°æ®ï¼Œå¤„ç†å¥½æ•°æ®åï¼Œå‘å‡ºç»“æœã€‚æ„Ÿå…´è¶£çš„ç±»æ¥æ”¶ç»“æœã€‚<br>2ä¸ªæ–‡ä»¶ï¼š<code>AlgoCalculator.java</code>ï¼›<code>MainUser.java</code>  </p><ul><li><code>AlgoCalculator.java</code>æ˜¯è®¡ç®—éƒ¨åˆ†ï¼Œæ¥æ”¶æ•°æ®å¹¶è¿›è¡Œè®¡ç®—ã€‚å¹¶å°†ç»“æœä¼ é€’å‡ºå»ã€‚</li><li><code>MainUser.java</code>æ˜¯è°ƒç”¨æ–¹ï¼Œå°†åŸºæœ¬æ•°æ®ä¼ å…¥AlgoCalculatorå¹¶ç›‘å¬ç»“æœã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.algo;<br><br><span class="hljs-keyword">import</span> java.util.LinkedList;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlgoCalculator</span> &#123;<br><br>    <span class="hljs-keyword">private</span> List&lt;<span class="hljs-type">short</span>[]&gt; mDataBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AlgoCalculator</span><span class="hljs-params">()</span> &#123;<br><br>    &#125;<br><br>    <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªListeneræ¥å£ï¼›å¯å°†ä¸€ä¸ªbooleanå€¼ä¼ é€’å‡ºå»</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ResultChangeListener</span> &#123;<br>        <span class="hljs-keyword">void</span> <span class="hljs-title function_">onChange</span><span class="hljs-params">(<span class="hljs-type">boolean</span> found)</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> ResultChangeListener resultChangeListener;<br>    <span class="hljs-comment">// è°ƒç”¨æ–¹èƒ½å¤Ÿè®¾ç½®å¹¶å®ç°è¿™ä¸ªæ¥å£</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setResultChangedListener</span><span class="hljs-params">(ResultChangeListener resultChangedListener)</span> &#123;<br>        <span class="hljs-built_in">this</span>.resultChangeListener = resultChangedListener;<br>    &#125;<br>    <span class="hljs-comment">// ä¼ è¾“æ•°æ®</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setDataStream</span><span class="hljs-params">(<span class="hljs-type">short</span>[] data)</span> &#123;<br>        checkData(data);<span class="hljs-comment">// å¤„ç†æ•°æ®æ–¹æ³•</span><br>    &#125;<br><br>    <span class="hljs-comment">// å¤„ç†æ•°æ®ï¼Œå¹¶é€å‡ºç»“æœ</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkData</span><span class="hljs-params">(<span class="hljs-type">short</span>[] data)</span> &#123;<br>        <span class="hljs-keyword">if</span> (data.length == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">short</span> b : data) &#123;<br>            sum += b;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (sum &gt; <span class="hljs-number">40</span>) &#123;<br>            resultChangeListener.onChange(<span class="hljs-literal">true</span>); <span class="hljs-comment">// æ•°æ®å¤„ç†ç»“æœ</span><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            resultChangeListener.onChange(<span class="hljs-literal">false</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸»ç¨‹åºï¼›è°ƒç”¨æ–¹ä¼ å…¥æ•°æ®ï¼Œè·å–ç»“æœ<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.algo.AlgoCalculator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainUser</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">AlgoCalculator</span> <span class="hljs-variable">algoCalculator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlgoCalculator</span>(); <span class="hljs-comment">// åˆå§‹åŒ–</span><br><br>        <span class="hljs-comment">// è®¾ç½®ç›‘å¬å™¨ï¼Œå¹¶åœ¨é‡Œé¢å¢åŠ è¦æ‰§è¡Œçš„åŠ¨ä½œ</span><br>        algoCalculator.setResultChangedListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AlgoCalculator</span>.ResultChangeListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onChange</span><span class="hljs-params">(<span class="hljs-type">boolean</span> found)</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;result: &quot;</span> + found);<br>            &#125;<br>        &#125;);<br>        <span class="hljs-type">short</span>[] data1 = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>,&#125;;<br>        <span class="hljs-type">short</span>[] data2 = &#123;<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>&#125;;<br>        <span class="hljs-type">short</span>[] data3 = &#123;<span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>&#125;;<br>        <span class="hljs-type">short</span>[] data4 = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>&#125;;<br>        <span class="hljs-comment">// ä¼ å…¥æ•°æ®</span><br>        algoCalculator.setDataStream(data1);    <span class="hljs-comment">// output false</span><br>        algoCalculator.setDataStream(data2);    <span class="hljs-comment">// output true</span><br>        algoCalculator.setDataStream(data3);    <span class="hljs-comment">// output false</span><br>        algoCalculator.setDataStream(data4);    <span class="hljs-comment">// output false</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br>åœ¨å¦å¤–çš„ç±»é‡Œï¼Œèƒ½å¤Ÿå¾ˆæ–¹ä¾¿åœ°è°ƒç”¨<code>AlgoCalculator</code>çš„è®¡ç®—èƒ½åŠ›å¹¶è·å–è®¡ç®—ç»“æœã€‚<br>åœ¨è¿™é‡Œï¼Œæ¯ä¼ å…¥ä¸€æ¬¡æ•°æ®ï¼Œå°±èƒ½è·å–ä¸€ä¸ªç»“æœã€‚å¦‚æœæ¯ç§’é’Ÿä¼ å…¥ä¸€æ¬¡æ•°æ®ï¼Œæ¯ç§’é’Ÿå°±èƒ½è·å–ä¸€ä¸ªç»“æœã€‚<br>æˆ‘ä»¬å¯ä»¥æŠŠå¤æ‚çš„ç®—æ³•å°è£…èµ·æ¥ï¼Œå®¢æˆ·ç«¯åªéœ€è¦ä¼ å…¥æ•°æ®ï¼Œå³å¯è·å¾—ï¼ˆç›‘å¬åˆ°ï¼‰ç»“æœã€‚  </p><p>å¾ˆå¤šåœºæ™¯ä¸­éƒ½ä½¿ç”¨äº†ç›‘å¬è€…æ¨¡å¼ã€‚å¼€å‘è€…ä¹Ÿå¯èƒ½åœ¨ä¸çŸ¥ä¸è§‰ä¸­å°±è¿ç”¨äº†è¿™ä¸ªæ¨¡å¼ã€‚</p><h3 id="Androidä¸­ä½¿ç”¨ç›‘å¬å™¨"><a href="#Androidä¸­ä½¿ç”¨ç›‘å¬å™¨" class="headerlink" title="Androidä¸­ä½¿ç”¨ç›‘å¬å™¨"></a>Androidä¸­ä½¿ç”¨ç›‘å¬å™¨</h3><p>æœ€å¸¸è§çš„ä¾‹å­æ˜¯ç»™Buttonè®¾ç½®ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ã€‚<br>ç±»ä¼¼ä¸Šä¸ªä¾‹å­ï¼Œè®¾è®¡ä¸€ä¸ªæ¥å£å½“åšç›‘å¬å™¨ã€‚Androidä¸­å›è°ƒæ—¶å¯ä»¥åˆ©ç”¨handlerï¼Œæ§åˆ¶è°ƒç”¨çš„çº¿ç¨‹ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Handler mMainHandler;<br><br>mMainHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>(Looper.getMainLooper());<span class="hljs-comment">// åœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œ</span><br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">notifySthChange</span><span class="hljs-params">(<span class="hljs-keyword">final</span> <span class="hljs-type">int</span> state)</span> &#123;<br>    mMainHandler.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            ArrayList&lt;SListener&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(mListeners);<br>            <span class="hljs-keyword">for</span> (SListener l : list) &#123;<br>                l.OnSthChanged(state);<br>            &#125;<br>        &#125;<br>    &#125;);<br>&#125;<br></code></pre></td></tr></table></figure><br>åœ¨å›è°ƒä¸­å¯ä»¥ç›´æ¥æ›´æ–°UIã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Design_pattern</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¾è®¡æ¨¡å¼</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>aboutView å¼€å‘è®°å½•</title>
    <link href="/2015/12/25/Dev-note/dev-note-aboutView/"/>
    <url>/2015/12/25/Dev-note/dev-note-aboutView/</url>
    
    <content type="html"><![CDATA[<p>å·¥ç¨‹åœ°å€ <a href="https://github.com/RustFisher/aboutView">https://github.com/RustFisher/aboutView</a></p><h2 id="è™šæ‹Ÿé”®ç›˜-VKeyboard"><a href="#è™šæ‹Ÿé”®ç›˜-VKeyboard" class="headerlink" title="è™šæ‹Ÿé”®ç›˜ - VKeyboard"></a>è™šæ‹Ÿé”®ç›˜ - VKeyboard</h2><p>VKeyboard - Virtual keyboard</p><h3 id="å®šä¹‰æŒ‰é”®ç±»"><a href="#å®šä¹‰æŒ‰é”®ç±»" class="headerlink" title="å®šä¹‰æŒ‰é”®ç±»"></a>å®šä¹‰æŒ‰é”®ç±»</h3><p>å®šä¹‰Keyç±»ï¼Œä»£è¡¨æŒ‰é”®ã€‚å±æ€§æœ‰asciiç ï¼Œæ˜¯å¦ä½¿ç”¨TextViewï¼Œæ˜¯å¦ä½¿ç”¨ImageViewï¼ŒæŒ‰é”®ç±»åˆ«ï¼ˆåŠŸèƒ½é”®ï¼Œæ™®é€šé”®ï¼‰ç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Key</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> keyType; <span class="hljs-comment">// æŒ‰é”®ç§ç±» æ˜¯æ™®é€šæŒ‰é”®æˆ–è€…æ˜¯åŠŸèƒ½æŒ‰é”®</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">uiType</span> <span class="hljs-operator">=</span> UI_TEXT_VIEW; <span class="hljs-comment">// UIä½¿ç”¨çš„Viewç±»å‹</span><br>    <span class="hljs-keyword">private</span> String keyText; <span class="hljs-comment">// æ˜¾ç¤ºçš„æ–‡å­—</span><br>    <span class="hljs-comment">// ....</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="UIæ§åˆ¶å™¨å®ç°"><a href="#UIæ§åˆ¶å™¨å®ç°" class="headerlink" title="UIæ§åˆ¶å™¨å®ç°"></a>UIæ§åˆ¶å™¨å®ç°</h3><p>å®ç°ä¸€ä¸ªè™šæ‹Ÿé”®ç›˜ã€‚é‡‡ç”¨ç»™LinearLayoutæ·»åŠ å­viewçš„æ–¹å¼ã€‚<br>åšä¸€ä¸ªUIæ§åˆ¶å™¨ï¼ˆWidgetï¼‰ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªLinearLayoutä½œä¸ºæ ¹viewã€‚æ ¹æ®è®¾ç½®çš„é”®ç›˜å®½åº¦åŠ¨æ€è°ƒæ•´æ¯ä¸ªæŒ‰é”®çš„å¤§å°ã€‚</p><p>è¿™ç§æ–¹å¼ä¸å¤ªé€‚åˆç»„ä»¶åŒ–ã€‚</p><h3 id="åˆ›å»ºç»„ä»¶çš„æ–¹å¼"><a href="#åˆ›å»ºç»„ä»¶çš„æ–¹å¼" class="headerlink" title="åˆ›å»ºç»„ä»¶çš„æ–¹å¼"></a>åˆ›å»ºç»„ä»¶çš„æ–¹å¼</h3><p>å°†ã€ŒæŒ‰é”®ã€è£…é…åˆ°é”®ç›˜ä¸Šã€‚é‡‡ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œå°†Viewæ·»åŠ åˆ°ViewGroupä¸­ã€‚</p><p>VKeyä»£è¡¨æŒ‰é”®ï¼ŒVKeyboardBodyä»£è¡¨é”®ç›˜ï¼ŒVRowä»£è¡¨é”®ç›˜ä¸Šçš„ä¸€è¡Œï¼ŒVKeyboardListeneræ˜¯ç›‘å¬å™¨ã€‚<br>VKeyboardç»§æ‰¿Framelayoutï¼Œåˆ›å»ºé€‚é…å™¨VKeyboard.Adapterï¼Œå°†ã€ŒæŒ‰é”®ã€è£…é…åˆ°é”®ç›˜ä¸Šã€‚</p><p><img src="https://raw.githubusercontent.com/RustFisher/aboutView/master/pics/vk-1.png" alt="vk"></p><h4 id="VKey-æŒ‰é”®"><a href="#VKey-æŒ‰é”®" class="headerlink" title="VKey - æŒ‰é”®"></a>VKey - æŒ‰é”®</h4><p>ä»£è¡¨æŒ‰é”®ã€‚è£…è½½ç€keyCodeï¼ŒèƒŒæ™¯èµ„æºç­‰ç­‰å±æ€§å€¼ã€‚</p><h4 id="VKeyboardBody-é”®ç›˜"><a href="#VKeyboardBody-é”®ç›˜" class="headerlink" title="VKeyboardBody - é”®ç›˜"></a>VKeyboardBody - é”®ç›˜</h4><p>ä»£è¡¨é”®ç›˜çš„æ˜¾ç¤ºæ ·å¼ã€‚æ¯”å¦‚UIçš„paddingå€¼å’Œmarginå€¼ã€‚</p><h4 id="VRow-è¡Œ"><a href="#VRow-è¡Œ" class="headerlink" title="VRow - è¡Œ"></a>VRow - è¡Œ</h4><p>ä¸€è¡ŒæŒ‰é”®ã€‚å®é™…ä¸Šæ˜¯ä¸€ä¸ªLinearLayoutçš„å±æ€§å€¼åˆé›†ã€‚</p><h4 id="VKeyboardListener-ç›‘å¬å™¨"><a href="#VKeyboardListener-ç›‘å¬å™¨" class="headerlink" title="VKeyboardListener - ç›‘å¬å™¨"></a>VKeyboardListener - ç›‘å¬å™¨</h4><p>äº‹ä»¶ç›‘å¬å™¨ã€‚ä¾‹å¦‚ç‚¹å‡»äº‹ä»¶ç­‰ç­‰ã€‚</p><h4 id="VKeyboard-é”®ç›˜UIç±»"><a href="#VKeyboard-é”®ç›˜UIç±»" class="headerlink" title="VKeyboard - é”®ç›˜UIç±»"></a>VKeyboard - é”®ç›˜UIç±»</h4><p>å®é™…ä¸Šç»§æ‰¿äº†FrameLayoutã€‚é€šè¿‡VKeyboard.Adapterè·å–åˆ°é”®ç›˜çš„æŒ‰é”®é…ç½®ä¿¡æ¯ã€‚<br>åˆ›å»ºå¯¹åº”çš„å­Viewï¼Œå¹¶æ·»åŠ åˆ°FrameLayoutä¸­ã€‚</p><h5 id="VKeyboardæ„é€ å‡½æ•°"><a href="#VKeyboardæ„é€ å‡½æ•°" class="headerlink" title="VKeyboardæ„é€ å‡½æ•°"></a>VKeyboardæ„é€ å‡½æ•°</h5><p>æ„é€ å‡½æ•°ä¸­æœ‰<code>AttributeSet</code>ã€‚attrsé‡Œé¢æœ‰idï¼Œlayout_widthï¼Œlayout_heightç­‰ç­‰ä¿¡æ¯ã€‚</p><p>æƒ³åœ¨Viewçš„æ„é€ å™¨ä¸­è·å–åˆ°å®šä¹‰ä¸­xmlä¸­çš„å±æ€§ï¼Œéœ€è¦ä»AttributeSetä¸­è·å–ã€‚å¯èƒ½ä¼šè·å–åˆ°-1æˆ–-2ï¼Œåˆ†åˆ«ä»£è¡¨MATCH_PARENTå’ŒWRAP_CONTENTã€‚<br>å› æ­¤è¦åˆ¤æ–­è·å–åˆ°çš„æ•°å­—æ˜¯å¦å¤§äº0ï¼Œå¦‚æœå¤§äº0åˆ™è¡¨æ˜æ˜¯ä¸€ä¸ªæŒ‡å®šçš„å®½åº¦ï¼Œç›´æ¥è®°ä¸‹è¿™ä¸ªå®½åº¦å€¼ã€‚<br>è·å–åˆ°xmlä¸­æŒ‡å®šçš„å®½åº¦åï¼Œå†è®¡ç®—å­viewçš„å®½åº¦ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">VKeyboard</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Context context, <span class="hljs-meta">@Nullable</span> AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> &#123;<br>    <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);<br>    <span class="hljs-type">int</span>[] attrsArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<br>            android.R.attr.id, <span class="hljs-comment">// 0</span><br>            android.R.attr.background, <span class="hljs-comment">// 1</span><br>            android.R.attr.layout_width, <span class="hljs-comment">// 2</span><br>            android.R.attr.layout_height <span class="hljs-comment">// 3</span><br>    &#125;;<br>    <span class="hljs-keyword">final</span> <span class="hljs-type">TypedArray</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> context.obtainStyledAttributes(attrs, attrsArray);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">layoutWidth</span> <span class="hljs-operator">=</span> a.getLayoutDimension(<span class="hljs-number">2</span>, ViewGroup.LayoutParams.MATCH_PARENT);<br>    <span class="hljs-keyword">if</span> (layoutWidth &gt; <span class="hljs-number">0</span>) &#123;<br>        keyboardWidthPx = layoutWidth;<br>    &#125;<br>    a.recycle();<br>    initKeyboardUI(context);<br>&#125;<br></code></pre></td></tr></table></figure></p><p>å‚è€ƒ <a href="https://stackoverflow.com/questions/8037101/how-to-get-attributeset-properties">https://stackoverflow.com/questions/8037101/how-to-get-attributeset-properties</a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">MapView</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> &#123;<br>    <span class="hljs-comment">// ...</span><br><br>    <span class="hljs-type">int</span>[] attrsArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] &#123;<br>        android.R.attr.id, <span class="hljs-comment">// 0</span><br>        android.R.attr.background, <span class="hljs-comment">// 1</span><br>        android.R.attr.layout_width, <span class="hljs-comment">// 2</span><br>        android.R.attr.layout_height <span class="hljs-comment">// 3</span><br>    &#125;;<br>    <span class="hljs-type">TypedArray</span> <span class="hljs-variable">ta</span> <span class="hljs-operator">=</span> context.obtainStyledAttributes(attrs, attrsArray);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> ta.getResourceId(<span class="hljs-number">0</span> <span class="hljs-comment">/* index of attribute in attrsArray */</span>, View.NO_ID);<br>    <span class="hljs-type">Drawable</span> <span class="hljs-variable">background</span> <span class="hljs-operator">=</span> ta.getDrawable(<span class="hljs-number">1</span>);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">layout_width</span> <span class="hljs-operator">=</span> ta. getLayoutDimension(<span class="hljs-number">2</span>, ViewGroup.LayoutParams.MATCH_PARENT);<br>    <span class="hljs-type">int</span> <span class="hljs-variable">layout_height</span> <span class="hljs-operator">=</span> ta. getLayoutDimension(<span class="hljs-number">3</span>, ViewGroup.LayoutParams.MATCH_PARENT);<br>    ta.recycle();<br>&#125;<br></code></pre></td></tr></table></figure></p><p>ç»™Keyboardæ·»åŠ æŒ‰é”®ï¼ˆkeyï¼‰ã€‚åœ¨activity onCreateçš„æ—¶å€™ï¼ŒKeyboardå·²ç»æ‰§è¡Œäº†æ„é€ å‡½æ•°ã€‚<br>ä¹‹åæˆ‘ä»¬é€šè¿‡setAdapterçš„æ–¹å¼ç»™å®ƒæ·»åŠ keyã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>å¼€å‘è®°å½•</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>awkå‘½ä»¤çš„ä½¿ç”¨</title>
    <link href="/2015/12/16/Linux/awk-use/"/>
    <url>/2015/12/16/Linux/awk-use/</url>
    
    <content type="html"><![CDATA[<p>Ubuntu14.04</p><h2 id="ç›®çš„ï¼šæƒ³ç”¨awkæ¥ç»Ÿè®¡æŸä¸ªæ–‡æœ¬ä¸­å•è¯å‡ºç°çš„æ¬¡æ•°ï¼Œå¹¶ä»¥ä¸€å®šçš„æ ¼å¼è¾“å‡ºç»“æ„"><a href="#ç›®çš„ï¼šæƒ³ç”¨awkæ¥ç»Ÿè®¡æŸä¸ªæ–‡æœ¬ä¸­å•è¯å‡ºç°çš„æ¬¡æ•°ï¼Œå¹¶ä»¥ä¸€å®šçš„æ ¼å¼è¾“å‡ºç»“æ„" class="headerlink" title="ç›®çš„ï¼šæƒ³ç”¨awkæ¥ç»Ÿè®¡æŸä¸ªæ–‡æœ¬ä¸­å•è¯å‡ºç°çš„æ¬¡æ•°ï¼Œå¹¶ä»¥ä¸€å®šçš„æ ¼å¼è¾“å‡ºç»“æ„"></a>ç›®çš„ï¼šæƒ³ç”¨awkæ¥ç»Ÿè®¡æŸä¸ªæ–‡æœ¬ä¸­å•è¯å‡ºç°çš„æ¬¡æ•°ï¼Œå¹¶ä»¥ä¸€å®šçš„æ ¼å¼è¾“å‡ºç»“æ„</h2><p>é€šå¸¸ï¼Œawké€è¡Œå¤„ç†æ–‡æœ¬ã€‚awkæ¯æ¥æ”¶æ–‡ä»¶çš„ä¸€è¡Œï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„å‘½ä»¤æ¥å¤„ç†ã€‚</p><p>ç”¨legalæ–‡ä»¶æ¥åšç¤ºä¾‹<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql">$ cat <span class="hljs-operator">/</span>etc<span class="hljs-operator">/</span>legal<br><br>The programs included <span class="hljs-keyword">with</span> the Ubuntu <span class="hljs-keyword">system</span> <span class="hljs-keyword">are</span> <span class="hljs-keyword">free</span> software;<br>the exact distribution terms <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> program <span class="hljs-keyword">are</span> described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> <span class="hljs-operator">/</span>usr<span class="hljs-operator">/</span>share<span class="hljs-operator">/</span>doc<span class="hljs-comment">/*/copyright.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by</span><br><span class="hljs-comment">applicable law.</span><br></code></pre></td></tr></table></figure></p><h3 id="æœç´¢ç»Ÿè®¡å•è¯â€œlawâ€çš„ä¸ªæ•°"><a href="#æœç´¢ç»Ÿè®¡å•è¯â€œlawâ€çš„ä¸ªæ•°" class="headerlink" title="æœç´¢ç»Ÿè®¡å•è¯â€œlawâ€çš„ä¸ªæ•°"></a>æœç´¢ç»Ÿè®¡å•è¯â€œlawâ€çš„ä¸ªæ•°</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">$ awk -F : &#x27;/law/&#123;<span class="hljs-built_in">count</span>++&#125; END&#123;print <span class="hljs-string">&quot;the count is &quot;</span>,<span class="hljs-built_in">count</span>&#125;&#x27; /etc/legal<br><span class="hljs-keyword">the</span> <span class="hljs-built_in">count</span> <span class="hljs-keyword">is</span>  <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h3 id="ç»Ÿè®¡å•è¯â€œtheâ€çš„ä¸ªæ•°"><a href="#ç»Ÿè®¡å•è¯â€œtheâ€çš„ä¸ªæ•°" class="headerlink" title="ç»Ÿè®¡å•è¯â€œtheâ€çš„ä¸ªæ•°"></a>ç»Ÿè®¡å•è¯â€œtheâ€çš„ä¸ªæ•°</h3><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs applescript">$ awk -F : &#x27;/<span class="hljs-keyword">the</span>/&#123;<span class="hljs-built_in">count</span>++&#125; END&#123;print <span class="hljs-string">&quot;the count is &quot;</span>,<span class="hljs-built_in">count</span>&#125;&#x27; /etc/legal<br><span class="hljs-keyword">the</span> <span class="hljs-built_in">count</span> <span class="hljs-keyword">is</span>  <span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><p>æ‰¾åˆ°æŒ‡å®šå•è¯ï¼Œè‡ªå®šä¹‰å˜é‡countè‡ªå¢ï¼Œæœ€åè¾“å‡ºè¯­å¥å’Œcountå€¼</p><p>å‘½ä»¤sortï¼ŒæŠŠå„è¡ŒæŒ‰é¦–å­—æ¯æ’åˆ—é¡ºåºé‡æ–°æ’åˆ—èµ·æ¥</p><ul><li>sort -nrï¼Œæ¯è¡Œéƒ½ä»¥æ•°å­—å¼€å¤´ï¼ŒæŒ‰æ•°å­—ä»è¾¾åˆ°å°ï¼Œæ’åˆ—å„è¡Œ</li><li>uniq -cï¼Œç»Ÿè®¡å„è¡Œå‡ºç°çš„æ¬¡æ•°ï¼Œå¹¶æŠŠæ¬¡æ•°æ‰“å°åœ¨æ¯è¡Œå‰ç«¯</li><li>awkå‚æ•° NF - æµè§ˆè®°å½•çš„åŸŸçš„ä¸ªæ•°</li></ul><p>ç»¼åˆèµ·æ¥ï¼Œå‘½ä»¤å°±æ˜¯<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">awk -F<span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;&#123;for(i=1;i&lt;=NF;i=i+1)&#123;print $i&#125;&#125;&#x27;</span> /etc/legal |<br><span class="hljs-built_in">sort</span>|<span class="hljs-built_in">uniq</span> -c|<span class="hljs-built_in">sort</span> -nr|awk -F<span class="hljs-string">&#x27; &#x27;</span> <span class="hljs-string">&#x27;&#123;printf(&quot;%s %s\n&quot;,$2,$1)&#125;&#x27;</span><br></code></pre></td></tr></table></figure><br>ç»Ÿè®¡/etc/legalä¸­å•è¯å‡ºç°æ¬¡æ•°ï¼Œå¹¶ä»¥â€œå•è¯ æ¬¡æ•°â€æ ¼å¼è¾“å‡ºç»“æœ</p>]]></content>
    
    
    <categories>
      
      <category>Linux_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>grep æœç´¢å­—ç¬¦ä¸²</title>
    <link href="/2015/11/29/Linux/grep_note/"/>
    <url>/2015/11/29/Linux/grep_note/</url>
    
    <content type="html"><![CDATA[<h2 id="grep-æœç´¢ï¼Œæ€æ ·æ’é™¤æŸäº›ç›®å½•ï¼Ÿ"><a href="#grep-æœç´¢ï¼Œæ€æ ·æ’é™¤æŸäº›ç›®å½•ï¼Ÿ" class="headerlink" title="grep æœç´¢ï¼Œæ€æ ·æ’é™¤æŸäº›ç›®å½•ï¼Ÿ"></a>grep æœç´¢ï¼Œæ€æ ·æ’é™¤æŸäº›ç›®å½•ï¼Ÿ</h2><p>ä½¿ç”¨ <code>--exclude-dir</code> é€‰é¡¹ã€‚</p><p>è¯­æ³•:<br><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos">--exclude-<span class="hljs-built_in">dir</span>=<span class="hljs-built_in">DIR</span><br></code></pre></td></tr></table></figure></p><blockquote><p>Exclude directories matching the pattern DIR from recursive searches.</p></blockquote><h3 id="å•ä¸ªç›®å½•ç¤ºä¾‹"><a href="#å•ä¸ªç›®å½•ç¤ºä¾‹" class="headerlink" title="å•ä¸ªç›®å½•ç¤ºä¾‹"></a>å•ä¸ªç›®å½•ç¤ºä¾‹</h3><p><code>-R</code>æ˜¯è¡¨ç¤ºå¯ç”¨æ­£åˆ™<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">grep -E <span class="hljs-string">&quot;http&quot;</span>  <span class="hljs-string">./</span> -R <span class="hljs-params">--exclude-dir=</span><span class="hljs-string">.git</span><br></code></pre></td></tr></table></figure></p><h3 id="å¤šä¸ªç›®å½•ç¤ºä¾‹"><a href="#å¤šä¸ªç›®å½•ç¤ºä¾‹" class="headerlink" title="å¤šä¸ªç›®å½•ç¤ºä¾‹"></a>å¤šä¸ªç›®å½•ç¤ºä¾‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grep -E <span class="hljs-string">&quot;http&quot;</span>  . -R --exclude-dir=&#123;.git,res,bin&#125;<br></code></pre></td></tr></table></figure><h3 id="å¤šä¸ªæ–‡ä»¶ç¤ºä¾‹"><a href="#å¤šä¸ªæ–‡ä»¶ç¤ºä¾‹" class="headerlink" title="å¤šä¸ªæ–‡ä»¶ç¤ºä¾‹"></a>å¤šä¸ªæ–‡ä»¶ç¤ºä¾‹</h3><h4 id="æ’é™¤æ‰©å±•åä¸º-java-å’Œ-js-çš„æ–‡ä»¶"><a href="#æ’é™¤æ‰©å±•åä¸º-java-å’Œ-js-çš„æ–‡ä»¶" class="headerlink" title="æ’é™¤æ‰©å±•åä¸º java å’Œ js çš„æ–‡ä»¶"></a>æ’é™¤æ‰©å±•åä¸º java å’Œ js çš„æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grep -E <span class="hljs-string">&quot;http&quot;</span>  . -R --exclude=*.&#123;java,js&#125;<br></code></pre></td></tr></table></figure><h4 id="æ’é™¤æ‰©å±•åä¸º-javaï¼Œmd-å’Œ-js-çš„æ–‡ä»¶"><a href="#æ’é™¤æ‰©å±•åä¸º-javaï¼Œmd-å’Œ-js-çš„æ–‡ä»¶" class="headerlink" title="æ’é™¤æ‰©å±•åä¸º javaï¼Œmd~ å’Œ js çš„æ–‡ä»¶"></a>æ’é™¤æ‰©å±•åä¸º javaï¼Œmd~ å’Œ js çš„æ–‡ä»¶</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">~/wd/rustNote/Linux_note$ grep -E DIR -R --exclude=*.&#123;java,js,md~&#125;<br>grep_note.md:    --exclude-dir=DIR<br>grep_note.md:    Exclude directories matching the pattern DIR from recursive searches.<br></code></pre></td></tr></table></figure><p>æ’é™¤æ‰©å±•åä¸ºjavaï¼Œ js å’Œ md~ çš„æ–‡ä»¶</p><p>æ’é™¤ä¸€äº›æ–‡ä»¶ï¼Œå¹¶ä¸”æ˜¾ç¤ºè¡Œå·<code>-n</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">grep -n -E <span class="hljs-string">&quot;org/webrtc/&quot;</span> . -R --exclude=*.&#123;java,ninja,TOC,so,o,jar&#125;<br></code></pre></td></tr></table></figure></p><h2 id="å¦‚ä½•åœ¨-Linux-ç³»ç»Ÿå’Œç±»-Unix-çš„æ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨å¸¦æ­£åˆ™è¡¨è¾¾å¼çš„-grep-å‘½ä»¤å‘¢ï¼Ÿ"><a href="#å¦‚ä½•åœ¨-Linux-ç³»ç»Ÿå’Œç±»-Unix-çš„æ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨å¸¦æ­£åˆ™è¡¨è¾¾å¼çš„-grep-å‘½ä»¤å‘¢ï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨ Linux ç³»ç»Ÿå’Œç±» Unix çš„æ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨å¸¦æ­£åˆ™è¡¨è¾¾å¼çš„ grep å‘½ä»¤å‘¢ï¼Ÿ"></a>å¦‚ä½•åœ¨ Linux ç³»ç»Ÿå’Œç±» Unix çš„æ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨å¸¦æ­£åˆ™è¡¨è¾¾å¼çš„ grep å‘½ä»¤å‘¢ï¼Ÿ</h2><p>Linux ç³»ç»Ÿè‡ªå¸¦äº†æ”¯æŒæ‹“å±•æ­£åˆ™è¡¨è¾¾å¼çš„ GNU ç‰ˆæœ¬ grep å·¥å…·ã€‚æ‰€æœ‰çš„ Linux ç³»ç»Ÿä¸­é»˜è®¤å®‰è£…çš„éƒ½æ˜¯ GNU ç‰ˆ grep ã€‚<br>grep å‘½ä»¤è¢«ç”¨æ¥æ£€ç´¢ä¸€å°æœåŠ¡å™¨æˆ–å·¥ä½œç«™ä¸Šä»»ä½•ä½ç½®çš„æ–‡æœ¬ä¿¡æ¯ã€‚</p><h3 id="å¿«é€Ÿäº†è§£æ­£åˆ™è¡¨è¾¾å¼"><a href="#å¿«é€Ÿäº†è§£æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="å¿«é€Ÿäº†è§£æ­£åˆ™è¡¨è¾¾å¼"></a>å¿«é€Ÿäº†è§£æ­£åˆ™è¡¨è¾¾å¼</h3><h4 id="å¦‚ä½•åŒ¹é…ä½ è¦æŸ¥æ‰¾çš„å†…å®¹ï¼Ÿ"><a href="#å¦‚ä½•åŒ¹é…ä½ è¦æŸ¥æ‰¾çš„å†…å®¹ï¼Ÿ" class="headerlink" title="å¦‚ä½•åŒ¹é…ä½ è¦æŸ¥æ‰¾çš„å†…å®¹ï¼Ÿ"></a>å¦‚ä½•åŒ¹é…ä½ è¦æŸ¥æ‰¾çš„å†…å®¹ï¼Ÿ</h4><p>æ­£åˆ™è¡¨è¾¾å¼åªä¸è¿‡æ˜¯æ¯ä¸ªè¾“å…¥è¡ŒåŒ¹é…çš„æ¨¡å¼ã€‚æ¨¡å¼æ˜¯ä¸€ä¸ªå­—ç¬¦åºåˆ—ã€‚ä¸‹é¢éƒ½æ˜¯èŒƒä¾‹ï¼š</p><p>ä¾‹å¦‚ï¼š<code>^w1â€ã€â€œw1|w2â€ã€â€œ[^ ]</code>ã€‚</p><p>åœ¨ <code>/etc/passswd</code> ä¸­æ£€ç´¢ <code>vivek</code> ï¼š <code>grep vivek /etc/passwd</code></p><p>è¾“å‡ºç»“æœæ¡ˆä¾‹ï¼š<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">vivek:x:1000:1000:Vivek Gite,,,:/home/vivek:/bin/bash<br>vivekgite:x:1001:1001::/home/vivekgite:/bin/sh<br>gitevivek:x:1002:1002::/home/gitevivek:/bin/sh<br></code></pre></td></tr></table></figure><br>åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½æœç´¢ â€˜vivekâ€™  (å³ä¸åŒºåˆ†å¤§å°)ï¼š<code>grep -i -w vivek /etc/passwd</code><br>ä¸åŒºåˆ†å¤§å°å†™åœ°æ£€ç´¢ â€˜vivekâ€™ å’Œ â€˜rajâ€™ ï¼š <code>grep -E -i -w &#39;vivek|raj&#39; /etc/passwd</code><br>åœ¨æœ€åä¸€ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨äº†æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å¼ã€‚</p><p>å›ºå®šæ£€ç´¢å†…å®¹çš„ä½ç½®ï¼š<br>ä½ å¯ä»¥ä½¿ç”¨ ^ å’Œ $ ç¬¦å·å¼ºåˆ¶ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åˆ†åˆ«åŒ¹é…ä¸€è¡Œçš„å¼€å§‹æˆ–ç»“æŸçš„ä½ç½®ã€‚<br>ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºä»¥ â€˜vivekâ€™ å¼€å¤´çš„æ–‡æœ¬ï¼š <code>grep ^vivek /etc/passwd</code><br>è¾“å‡ºç»“æœç¤ºä¾‹ï¼š<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-symbol">vivek:</span><span class="hljs-symbol">x:</span><span class="hljs-number">1000</span><span class="hljs-symbol">:</span><span class="hljs-number">1000</span><span class="hljs-symbol">:Vivek</span> <span class="hljs-title class_">Gite</span>,,,<span class="hljs-symbol">:/home/vivek</span><span class="hljs-symbol">:/bin/bash</span><br><span class="hljs-symbol">vivekgite:</span><span class="hljs-symbol">x:</span><span class="hljs-number">1001</span><span class="hljs-symbol">:</span><span class="hljs-number">1001</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/home/vivekgite</span><span class="hljs-symbol">:/bin/sh</span><br></code></pre></td></tr></table></figure></p><p>ä»¥<code>#!</code>å¼€å¤´çš„è¡Œ<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">rust@rust-pc:~<span class="hljs-regexp">/note/</span>Linux_note$ <span class="hljs-keyword">grep</span> <span class="hljs-string">&#x27;^#!&#x27;</span> *<br>organize_so_names.sh:#! <span class="hljs-regexp">/bin/</span>sh<br>sort_ranking_solution.md:#! <span class="hljs-regexp">/bin/</span>sh<br></code></pre></td></tr></table></figure></p><p>ä½ å¯ä»¥åªæ˜¾ç¤ºä»¥ vivek å¼€å¤´çš„æ–‡æœ¬è¡Œã€‚ä¸¾ä¾‹è¯´å°±æ˜¯ä¸æ˜¾ç¤º vivekgite , vivekg è¿™æ ·å•è¯å¼€å¤´çš„ã€‚<br><code>grep -w ^vivek /etc/passwd</code></p><p>æ£€ç´¢ä»¥ â€˜fooâ€™ ç»“å°¾çš„æ–‡æœ¬æ ¼å¼ï¼š<code>grep &#39;foo$&#39; FILENAME</code></p><p>ä½ è¿˜å¯ä»¥ç”¨ä¸‹é¢è¿™æ ·çš„æ–¹å¼æœç´¢ç©ºç™½è¡Œï¼š<code>grep &#39;^$&#39; FILENAME</code></p><h4 id="å¦‚ä½•åŒ¹é…å…·ä½“å­—ç¬¦ï¼Ÿ"><a href="#å¦‚ä½•åŒ¹é…å…·ä½“å­—ç¬¦ï¼Ÿ" class="headerlink" title="å¦‚ä½•åŒ¹é…å…·ä½“å­—ç¬¦ï¼Ÿ"></a>å¦‚ä½•åŒ¹é…å…·ä½“å­—ç¬¦ï¼Ÿ</h4><p>åŒ¹é… â€˜Vivekâ€™ æˆ– â€˜vivekâ€™ ï¼š<code>grep &#39;[vV]ivek&#39; FILENAME</code></p><p>æˆ–è€…å¯ä»¥è¿™æ ·ï¼š<code>grep &#39;[vV][iI][Vv][Ee][kK]&#39; FILENAME</code></p><p>ä½ å¯ä»¥åŒ¹é…æ•°å­—ï¼ˆä¾‹å¦‚åŒ¹é… vivek1 æˆ– Vivek2 ï¼‰ï¼š<code>grep -w &#39;[vV]ivek[0-9]&#39; FILENAME</code></p><p>ä½ å¯ä»¥åŒ¹é…ä¸¤ä½æ•°ï¼ˆä¾‹å¦‚åŒ¹é… foo11 ï¼Œ foo12 ï¼‰ï¼š<code>grep &#39;foo[0-9][0-9]&#39; FILENAME</code></p><p>ä¸ä»…ä»…æ˜¯æ•°å­—ï¼Œä½ å¯ä»¥åŒ¹é…å­—æ¯ï¼š<code>grep &#39;[A-Za-z]&#39; FILENAME</code></p><p>æ˜¾ç¤ºæ‰€æœ‰åŒ…å« â€œwâ€ æˆ– â€œnâ€ å­—æ¯çš„æ–‡æœ¬è¡Œï¼š<code>grep [wn] FILENAME</code></p><p>åœ¨æ‹¬å·å†…çš„è¡¨è¾¾å¼ä¸­ï¼Œåœ¨â€œ [: â€å’Œâ€œ :] â€ä¸­æ‰€é™„çš„å­—ç¬¦ç±»çš„åç§°ï¼šä»£è¡¨å±äºè¯¥ç±»çš„æ‰€æœ‰å­—ç¬¦çš„åˆ—è¡¨ã€‚æ ‡å‡†å­—ç¬¦ç±»åç§°ï¼š</p><ul><li>[:alnum:] â€“ å­—æ¯æ•°å­—å­—ç¬¦</li><li>[:alpha:] â€“ å­—æ¯é¡ºåº</li><li>[:blank:] â€“ ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦</li><li>[:digit:] â€“ æ•°å­—ï¼š â€˜0 1 2 3 4 5 6 7 8 9â€™</li><li>[:lower:] â€“ å°å†™å­—æ¯ï¼šâ€˜a b c d e f â€™</li><li>[:space:] â€“ ç‰¹æ®Šå­—ç¬¦ï¼šåˆ¶è¡¨ç¬¦ï¼Œæ¢è¡Œç¬¦ï¼Œå‚ç›´åˆ¶è¡¨ç¬¦ã€æ¢é¡µï¼Œå›è½¦ï¼Œå’Œç©ºé—´</li><li>[:upper:] â€“ å¤§å†™å­—æ¯ï¼šâ€˜A B C D E F G H I J K L M N O P Q R S T U V W X Y Zâ€™</li></ul><p>åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼ŒåŒ¹é…æ‰€æœ‰å¤§å†™å­—æ¯ï¼š<code>grep &#39;[:upper:]&#39; FILENAME</code></p><h4 id="å¦‚ä½•ä½¿ç”¨é€šé…ç¬¦ï¼Ÿ"><a href="#å¦‚ä½•ä½¿ç”¨é€šé…ç¬¦ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ç”¨é€šé…ç¬¦ï¼Ÿ"></a>å¦‚ä½•ä½¿ç”¨é€šé…ç¬¦ï¼Ÿ</h4><p>ä½ å¯ä»¥ç”¨ â€œ.â€ æ¥ä»£æ›¿å•ä¸ªå­—ç¬¦ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒæŸ¥è¯¢äº†æ‰€æœ‰ä»¥å­—æ¯ â€œbâ€ å¼€å¤´ã€å­—æ¯ â€œtâ€ ç»“å°¾çš„ä¸‰ä¸ªå­—ç¬¦çš„å•è¯ã€‚<br><code>grep &#39;\&lt;b.t\&gt;&#39; FILENAME</code><br>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ<br><code>\&lt;</code> åœ¨å•è¯çš„å¼€å§‹ä½ç½®åŒ¹é…ç©ºæ ¼å­—ç¬¦ä¸²<br><code>\&gt;</code> åœ¨å•è¯çš„ç»“å°¾åŒ¹é…ç©ºæ ¼å­—ç¬¦ä¸²<br>æ£€ç´¢å¹¶è¾“å‡ºæ‰€æœ‰ä¸¤ä¸ªå­—æ¯çš„ç»“æœï¼š<code>grep &#39;^..$&#39; FILENAME</code><br>æ£€ç´¢å¹¶æ˜¾ç¤ºæ‰€æœ‰ä»¥ â€˜.â€™ å’Œæ•°å­—å¼€å¤´çš„ç»“æœï¼š<code>grep &#39;^\.[0-9]&#39; FILENAME</code><br>è½¬ä¹‰å­—ç¬¦â€™.â€™<br>æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾ IP åœ°å€ 192.168.1.254 å°†ä¸èƒ½è·å¾—é¢„æœŸçš„ç»“æœï¼š<code>grep &#39;192.168.1.254&#39; /etc/hosts</code><br>å…¶ä¸­ä¸‰ä¸ªç‚¹éƒ½éœ€è¦è¢«è½¬ä¹‰ï¼š<code>grep &#39;192\.168\.1\.254&#39; /etc/hosts</code></p><p>ä»¥ä¸‹ç¤ºä¾‹å°†åªåŒ¹é…ä¸€ä¸ªåœ°å€ï¼š<br><code>egrep &#39;[[:digit:]]&#123;1,3&#125;\.[[:digit:]]&#123;1,3&#125;\.[[:digit:]]&#123;1,3&#125;\.[[:digit:]]&#123;1,3&#125;&#39; FILENAME</code></p><p>ä»¥ä¸‹å°†ä¸åˆ†å¤§å°å†™åœ°åŒ¹é…å•è¯ Linux æˆ– Unix ï¼š<code>egrep -i &#39;^(linux|unix)&#39; FILENAME</code></p><h3 id="æ·±å…¥æ¢ç´¢-grep-é«˜çº§æŸ¥æ‰¾æ¨¡å¼"><a href="#æ·±å…¥æ¢ç´¢-grep-é«˜çº§æŸ¥æ‰¾æ¨¡å¼" class="headerlink" title="æ·±å…¥æ¢ç´¢ grep é«˜çº§æŸ¥æ‰¾æ¨¡å¼"></a>æ·±å…¥æ¢ç´¢ grep é«˜çº§æŸ¥æ‰¾æ¨¡å¼</h3><h4 id="å¦‚ä½•æ£€ç´¢ä¸€ä¸ªå…·æœ‰ä»¥-â€˜-â€˜-å¼€å¤´çš„çš„æ¨¡å¼ï¼Ÿ"><a href="#å¦‚ä½•æ£€ç´¢ä¸€ä¸ªå…·æœ‰ä»¥-â€˜-â€˜-å¼€å¤´çš„çš„æ¨¡å¼ï¼Ÿ" class="headerlink" title="å¦‚ä½•æ£€ç´¢ä¸€ä¸ªå…·æœ‰ä»¥ â€˜-â€˜ å¼€å¤´çš„çš„æ¨¡å¼ï¼Ÿ"></a>å¦‚ä½•æ£€ç´¢ä¸€ä¸ªå…·æœ‰ä»¥ â€˜-â€˜ å¼€å¤´çš„çš„æ¨¡å¼ï¼Ÿ</h4><p>ä½¿ç”¨ -e é€‰é¡¹æœç´¢æ‰€æœ‰åŒ¹é… â€˜â€“testâ€“â€˜ çš„ç»“æœã€‚grep ä¼šå°è¯•æŠŠ â€˜â€“testâ€“â€˜ ä½œä¸ºä¸€ä¸ªé€‰é¡¹è§£æï¼š<br><code>grep -e &#39;--test--&#39; FILENAME</code></p><h4 id="å¦‚ä½•åœ¨grepä¸­ä½¿ç”¨-OR-çš„é€»è¾‘è¿ç®—-ï¼Ÿ"><a href="#å¦‚ä½•åœ¨grepä¸­ä½¿ç”¨-OR-çš„é€»è¾‘è¿ç®—-ï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨grepä¸­ä½¿ç”¨ OR çš„é€»è¾‘è¿ç®— ï¼Ÿ"></a>å¦‚ä½•åœ¨grepä¸­ä½¿ç”¨ OR çš„é€»è¾‘è¿ç®— ï¼Ÿ</h4><p><code>grep -E &#39;word1|word2&#39; FILENAME</code> æˆ–è€… <code>egrep &#39;word1|word2&#39; FILENAME</code><br>æˆ–è€…å¯ä»¥è¿™æ ·åš<code>grep &#39;word1\|word2&#39; FILENAME</code></p><h4 id="å¦‚ä½•åœ¨grepä¸­ä½¿ç”¨-AND-çš„é€»è¾‘è¿ç®—-ï¼Ÿ"><a href="#å¦‚ä½•åœ¨grepä¸­ä½¿ç”¨-AND-çš„é€»è¾‘è¿ç®—-ï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨grepä¸­ä½¿ç”¨ AND çš„é€»è¾‘è¿ç®— ï¼Ÿ"></a>å¦‚ä½•åœ¨grepä¸­ä½¿ç”¨ AND çš„é€»è¾‘è¿ç®— ï¼Ÿ</h4><p>æŒ‰ç…§ä¸‹é¢çš„è¯­æ³•æ˜¾ç¤ºæ‰€æœ‰åŒ…å«äº†å•è¯ â€˜word1â€² å’Œ â€˜word2â€² çš„ç»“æœï¼š<br><code>grep &#39;word1&#39; FILENAME | grep &#39;word2&#39;</code></p><p>æˆ–è€…å¯ä»¥è¿™æ ·ï¼š<code>grep &#39;foo.*bar\|word3.*word4&#39; FILENAME</code></p><h4 id="å¦‚ä½•æµ‹è¯•åºåˆ—ï¼Ÿ"><a href="#å¦‚ä½•æµ‹è¯•åºåˆ—ï¼Ÿ" class="headerlink" title="å¦‚ä½•æµ‹è¯•åºåˆ—ï¼Ÿ"></a>å¦‚ä½•æµ‹è¯•åºåˆ—ï¼Ÿ</h4><p>ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¯­æ³•æµ‹è¯•ä¸€ä¸ªå­—ç¬¦åœ¨åºåˆ—ä¸­çš„é‡å¤çš„æ¬¡æ•°ï¼š</p><ul><li>{N}</li><li>{N,}</li><li>{min,max}</li></ul><p>åŒ¹é…åŒ…å«ä¸¤ä¸ªå­—æ¯ v çš„å­—ç¬¦ä¸²ç»“æœï¼š<code>egrep &quot;v&#123;2&#125;&quot; FILENAME</code></p><p>ä¸‹é¢çš„ä¾‹å­ä¸­å°†æ£€ç´¢æ–‡ä»¶å†…åŒ…å« â€œcolâ€ å’Œ â€œcoolâ€ çš„å­—ç¬¦ä¸²ç»“æœï¼š<code>egrep &#39;co&#123;1,2&#125;l&#39; FILENAME</code></p><p>æœç´¢<code>pattern</code>æˆ–<code>patern</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql">rust<span class="hljs-variable">@rust</span><span class="hljs-operator">-</span>pc:<span class="hljs-operator">~</span><span class="hljs-operator">/</span>note<span class="hljs-operator">/</span>Linux_note$ egrep <span class="hljs-string">&#x27;pat&#123;1,2&#125;ern&#x27;</span> <span class="hljs-operator">*</span><br>grep_note.md:Exclude directories matching the <span class="hljs-keyword">pattern</span> DIR <span class="hljs-keyword">from</span> <span class="hljs-keyword">recursive</span> searches.<br>grep_note.md:grep_note.md:    Exclude directories matching the <span class="hljs-keyword">pattern</span> DIR <span class="hljs-keyword">from</span> <span class="hljs-keyword">recursive</span> searches.<br></code></pre></td></tr></table></figure><br>ä¸‹é¢çš„ä¾‹å­ä¸­å°†åŒ¹é…è‡³å°‘å«æœ‰3ä¸ªå­—æ¯ c çš„ç»“æœï¼š<code>egrep &#39;c&#123;3,&#125;&#39; FILENAME</code></p><p>ä¸‹é¢çš„ç¤ºä¾‹å°†åŒ¹é… â€œ91-1234567890â€³ æ ¼å¼çš„æ‰‹æœºå·ç ï¼ˆå³ â€œä¸¤ä½æ•°å­—-åä½æ•°å­—â€ï¼‰<br><code>grep &quot;[[:digit:]]\&#123;2\&#125;[ -]\?[[:digit:]]\&#123;10\&#125;&quot; FILENAME</code></p><h4 id="å¦‚ä½•ä½¿-grep-çš„è¾“å‡ºç»“æœé«˜äº®æ ‡æ³¨ï¼Ÿ"><a href="#å¦‚ä½•ä½¿-grep-çš„è¾“å‡ºç»“æœé«˜äº®æ ‡æ³¨ï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ grep çš„è¾“å‡ºç»“æœé«˜äº®æ ‡æ³¨ï¼Ÿ"></a>å¦‚ä½•ä½¿ grep çš„è¾“å‡ºç»“æœé«˜äº®æ ‡æ³¨ï¼Ÿ</h4><p>ä½¿ç”¨ä¸‹é¢ä¾‹å­çš„è¯­æ³•ï¼š<code>grep --color regex FILENAME</code></p><h4 id="å¦‚ä½•ä½¿-grep-çš„è¾“å‡ºåªæ˜¾ç¤ºåŒ¹é…çš„éƒ¨åˆ†è€Œä¸æ˜¯æ•´è¡Œï¼Ÿ"><a href="#å¦‚ä½•ä½¿-grep-çš„è¾“å‡ºåªæ˜¾ç¤ºåŒ¹é…çš„éƒ¨åˆ†è€Œä¸æ˜¯æ•´è¡Œï¼Ÿ" class="headerlink" title="å¦‚ä½•ä½¿ grep çš„è¾“å‡ºåªæ˜¾ç¤ºåŒ¹é…çš„éƒ¨åˆ†è€Œä¸æ˜¯æ•´è¡Œï¼Ÿ"></a>å¦‚ä½•ä½¿ grep çš„è¾“å‡ºåªæ˜¾ç¤ºåŒ¹é…çš„éƒ¨åˆ†è€Œä¸æ˜¯æ•´è¡Œï¼Ÿ</h4><p>ä½¿ç”¨ä¸‹é¢ä¾‹å­çš„è¯­æ³•ï¼š<code>grep -o regex FILENAME</code></p><h2 id="ç»Ÿè®¡è¡Œæ•°"><a href="#ç»Ÿè®¡è¡Œæ•°" class="headerlink" title="ç»Ÿè®¡è¡Œæ•°"></a>ç»Ÿè®¡è¡Œæ•°</h2><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">grep <span class="hljs-string">&quot;&quot;</span> -r . <span class="hljs-string">| wc -l</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Linux_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>Tools</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android å¹¿æ’­æœºåˆ¶ï¼ˆBroadcastï¼‰ä»‹ç»ä¸ä½¿ç”¨</title>
    <link href="/2015/10/29/Android/Android-Broadcast_intro_use/"/>
    <url>/2015/10/29/Android/Android-Broadcast_intro_use/</url>
    
    <content type="html"><![CDATA[<p>Androidåº”ç”¨å¯ä»¥é€šè¿‡å¹¿æ’­ä»ç³»ç»Ÿæˆ–å…¶ä»–Appæ¥æ”¶æˆ–å‘é€æ¶ˆæ¯ã€‚ç±»ä¼¼äºè®¢é˜…-å‘å¸ƒè®¾è®¡æ¨¡å¼ã€‚å½“æŸäº›äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå¯ä»¥å‘å‡ºå¹¿æ’­ã€‚<br>ç³»ç»Ÿåœ¨æŸäº›çŠ¶æ€æ”¹å˜æ—¶ä¼šå‘å‡ºå¹¿æ’­ï¼Œä¾‹å¦‚å¼€æœºã€å……ç”µã€‚Appä¹Ÿå¯å‘é€è‡ªå®šä¹‰å¹¿æ’­ã€‚å¹¿æ’­å¯ç”¨äºåº”ç”¨é—´çš„é€šè®¯ï¼Œæ˜¯IPCçš„ä¸€ç§æ–¹å¼ã€‚</p><h2 id="å¹¿æ’­çš„ç§ç±»"><a href="#å¹¿æ’­çš„ç§ç±»" class="headerlink" title="å¹¿æ’­çš„ç§ç±»"></a>å¹¿æ’­çš„ç§ç±»</h2><p>å¹¿æ’­çš„ç§ç±»ä¹Ÿå¯ä»¥çœ‹æˆæ˜¯å¹¿æ’­çš„å±æ€§ã€‚</p><h3 id="æ ‡å‡†å¹¿æ’­ï¼ˆNormal-Broadcastsï¼‰"><a href="#æ ‡å‡†å¹¿æ’­ï¼ˆNormal-Broadcastsï¼‰" class="headerlink" title="æ ‡å‡†å¹¿æ’­ï¼ˆNormal Broadcastsï¼‰"></a>æ ‡å‡†å¹¿æ’­ï¼ˆNormal Broadcastsï¼‰</h3><p>å®Œå…¨å¼‚æ­¥çš„å¹¿æ’­ã€‚å¹¿æ’­å‘å‡ºåï¼Œæ‰€æœ‰çš„å¹¿æ’­æ¥æ”¶å™¨å‡ ä¹åŒæ—¶æ¥æ”¶åˆ°è¿™æ¡å¹¿æ’­ã€‚<br>ä¸åŒçš„Appå¯ä»¥æ³¨å†Œå¹¶æ¥åˆ°æ ‡å‡†å¹¿æ’­ã€‚ä¾‹å¦‚ç³»ç»Ÿå¹¿æ’­ã€‚</p><h3 id="æœ‰åºå¹¿æ’­ï¼ˆOrdered-Broadcastsï¼‰"><a href="#æœ‰åºå¹¿æ’­ï¼ˆOrdered-Broadcastsï¼‰" class="headerlink" title="æœ‰åºå¹¿æ’­ï¼ˆOrdered Broadcastsï¼‰"></a>æœ‰åºå¹¿æ’­ï¼ˆOrdered Broadcastsï¼‰</h3><p>åŒæ­¥å¹¿æ’­ã€‚åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªå¹¿æ’­æ¥æ”¶å™¨èƒ½æ¥æ”¶åˆ°è¿™æ¡å¹¿æ’­ã€‚è¿™ä¸ªæ¥æ”¶å™¨å¤„ç†å®Œåï¼Œå¹¿æ’­æ‰ä¼šç»§ç»­ä¼ é€’ã€‚<br>æœ‰åºå¹¿æ’­æ˜¯å…¨å±€çš„å¹¿æ’­ã€‚</p><h3 id="æœ¬åœ°å¹¿æ’­ï¼ˆLocal-Broaddcastsï¼‰"><a href="#æœ¬åœ°å¹¿æ’­ï¼ˆLocal-Broaddcastsï¼‰" class="headerlink" title="æœ¬åœ°å¹¿æ’­ï¼ˆLocal Broaddcastsï¼‰"></a>æœ¬åœ°å¹¿æ’­ï¼ˆLocal Broaddcastsï¼‰</h3><p>åªåœ¨æœ¬Appå‘é€å’Œæ¥æ”¶çš„å¹¿æ’­ã€‚æ³¨å†Œä¸ºæœ¬åœ°å¹¿æ’­çš„æ¥æ”¶å™¨æ— æ³•æ”¶åˆ°æ ‡å‡†å¹¿æ’­ã€‚</p><h3 id="å¸¦æƒé™çš„å¹¿æ’­"><a href="#å¸¦æƒé™çš„å¹¿æ’­" class="headerlink" title="å¸¦æƒé™çš„å¹¿æ’­"></a>å¸¦æƒé™çš„å¹¿æ’­</h3><p>å‘é€å¹¿æ’­æ—¶å¯ä»¥å¸¦ä¸Šç›¸å…³æƒé™ï¼Œç”³è¯·äº†æƒé™çš„Appæˆ–å¹¿æ’­æ¥æ”¶å™¨æ‰èƒ½æ”¶åˆ°ç›¸åº”çš„å¸¦æƒé™çš„å¹¿æ’­ã€‚<br>å¦‚æœåœ¨manifestä¸­ç”³è¯·äº†ç›¸åº”æƒé™ï¼Œæ¥æ”¶å™¨å¯ä»¥ä¸ç”¨å†ç”³è¯·ä¸€æ¬¡æƒé™å³å¯æ¥åˆ°ç›¸åº”å¹¿æ’­ã€‚</p><h2 id="æ¥æ”¶å¹¿æ’­"><a href="#æ¥æ”¶å¹¿æ’­" class="headerlink" title="æ¥æ”¶å¹¿æ’­"></a>æ¥æ”¶å¹¿æ’­</h2><p>åˆ›å»ºå¹¿æ’­æ¥æ”¶å™¨ï¼Œè°ƒç”¨<code>onReceive()</code>æ–¹æ³•ï¼Œéœ€è¦ä¸€ä¸ªç»§æ‰¿BroadcastReceiverçš„ç±»ã€‚</p><h3 id="æ³¨å†Œå¹¿æ’­"><a href="#æ³¨å†Œå¹¿æ’­" class="headerlink" title="æ³¨å†Œå¹¿æ’­"></a>æ³¨å†Œå¹¿æ’­</h3><p>ä»£ç ä¸­æ³¨å†Œç§°ä¸ºåŠ¨æ€æ³¨å†Œã€‚åœ¨AndroidManifest.xmlä¸­æ³¨å†Œç§°ä¸ºé™æ€æ³¨å†Œã€‚åŠ¨æ€æ³¨å†Œçš„åˆšæ³¢æ¥æ”¶å™¨ä¸€å®šè¦å–æ¶ˆæ³¨å†Œã€‚åœ¨onDestroy()æ–¹æ³•ä¸­è°ƒç”¨unregisterReceiver()æ–¹æ³•æ¥å–æ¶ˆæ³¨å†Œã€‚</p><p>ä¸è¦åœ¨onReceive()æ–¹æ³•ä¸­æ·»åŠ è¿‡å¤šçš„é€»è¾‘æ“ä½œæˆ–è€—æ—¶çš„æ“ä½œã€‚å› ä¸ºåœ¨å¹¿æ’­æ¥æ”¶å™¨ä¸­ä¸å…è®¸å¼€å¯çº¿ç¨‹ï¼Œå½“onReceive()æ–¹æ³•è¿è¡Œè¾ƒé•¿æ—¶é—´è€Œæ²¡ç»“æŸæ—¶ï¼Œç¨‹åºä¼šæŠ¥é”™ã€‚å› æ­¤å¹¿æ’­æ¥æ”¶å™¨ä¸€èˆ¬ç”¨æ¥æ‰“å¼€å…¶ä»–ç»„ä»¶ï¼Œæ¯”å¦‚åˆ›å»ºä¸€æ¡çŠ¶æ€æ é€šçŸ¥æˆ–å¯åŠ¨ä¸€ä¸ªæœåŠ¡ã€‚</p><p>æ–°å»ºä¸€ä¸ªMyExampleReceiverç»§æ‰¿è‡ªBroadcastReceiverã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyExampleReceiver</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BroadcastReceiver</span> &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> &#123;<br>        Toast.makeText(context,<span class="hljs-string">&quot;Got it&quot;</span>,Toast.LENGTH_SHORT).show();<br>        <span class="hljs-comment">//abortBroadcast();</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><br><code>abortBroadcast()</code>å¯ä»¥æˆªæ–­æœ‰åºå¹¿æ’­</p><p>åœ¨AndroidManifest.xmlä¸­æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨ï¼›nameé‡Œå¡«æ¥æ”¶å™¨çš„åå­—ã€‚<br>å¯ä»¥è®¾ç½®å¹¿æ’­æ¥æ”¶å™¨ä¼˜å…ˆçº§ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span> <span class="hljs-attr">android:priority</span>=<span class="hljs-string">&quot;100&quot;</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">receiver</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;.MyExampleReceiver&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;com.rust.broadcasttest.MY_BROADCAST&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">receiver</span>&gt;</span><br></code></pre></td></tr></table></figure></p><p>è®©æ¥æ”¶å™¨æ¥æ”¶åˆ°ä¸€æ¡â€œcom.rust.broadcasttest.MY_BROADCASTâ€å¹¿æ’­ã€‚<br>å‘é€è‡ªå®šä¹‰å¹¿æ’­ï¼ˆæ ‡å‡†å¹¿æ’­ï¼‰æ—¶ï¼Œè¦ä¼ é€è¿™ä¸ªå€¼ã€‚ä¾‹å¦‚ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(<span class="hljs-string">&quot;com.rust.broadcasttest.MY_BROADCAST&quot;</span>);<br>sendBroadcast(intent);<br></code></pre></td></tr></table></figure></p><p>å‘é€æœ‰åºå¹¿æ’­ï¼Œåº”å½“è°ƒç”¨sendOrderedBroadcast()ï¼›<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(<span class="hljs-string">&quot;com.rust.broadcasttest.MY_BROADCAST&quot;</span>);<br>sendOrderedBroadcast(intentï¼Œ<span class="hljs-literal">null</span>);<br></code></pre></td></tr></table></figure></p><h2 id="å‘é€å¹¿æ’­"><a href="#å‘é€å¹¿æ’­" class="headerlink" title="å‘é€å¹¿æ’­"></a>å‘é€å¹¿æ’­</h2><p>Appæœ‰3ç§å‘é€å¹¿æ’­çš„æ–¹å¼ã€‚å‘é€å¹¿æ’­éœ€è¦ä½¿ç”¨Intentç±»ã€‚</p><h3 id="sendOrderedBroadcast-Intent-String"><a href="#sendOrderedBroadcast-Intent-String" class="headerlink" title="sendOrderedBroadcast(Intent, String)"></a>sendOrderedBroadcast(Intent, String)</h3><p>å‘é€æœ‰åºå¹¿æ’­ã€‚æ¯æ¬¡åªæœ‰1ä¸ªå¹¿æ’­æ¥æ”¶å™¨èƒ½æ¥åˆ°å¹¿æ’­ã€‚<br>æ¥æ”¶å™¨æ¥åˆ°æœ‰åºå¹¿æ’­åï¼Œå¯ä»¥å®Œå…¨åœ°æˆªæ–­å¹¿æ’­ï¼Œæˆ–è€…ä¼ é€’ä¸€äº›ä¿¡æ¯ç»™ä¸‹ä¸€ä¸ªæ¥æ”¶å™¨ã€‚<br>æœ‰åºå¹¿æ’­çš„é¡ºåºå¯å—<code>android:priority</code>æ ‡ç­¾å½±å“ã€‚åŒç­‰çº§çš„æ¥æ”¶å™¨æ”¶åˆ°å¹¿æ’­çš„é¡ºåºæ˜¯éšæœºçš„ã€‚</p><h3 id="sendBroadcast-Intent"><a href="#sendBroadcast-Intent" class="headerlink" title="sendBroadcast(Intent)"></a>sendBroadcast(Intent)</h3><p>ä»¥ä¸€ä¸ªæœªå®šä¹‰çš„é¡ºåºå‘æ‰€æœ‰æ¥æ”¶å™¨å‘é€å¹¿æ’­ã€‚ä¹Ÿç§°ä½œæ™®é€šå¹¿æ’­ã€‚<br>è¿™ç§æ–¹å¼æ›´é«˜æ•ˆï¼Œä½†æ˜¯æ¥æ”¶å™¨ä¸èƒ½ç»™ä¸‹ä¸€ä¸ªæ¥æ”¶å™¨ä¼ é€’æ¶ˆæ¯ã€‚è¿™ç±»å¹¿æ’­ä¹Ÿæ— æ³•æˆªæ–­ã€‚</p><h3 id="LocalBroadcastManager-sendBroadcast"><a href="#LocalBroadcastManager-sendBroadcast" class="headerlink" title="LocalBroadcastManager.sendBroadcast"></a>LocalBroadcastManager.sendBroadcast</h3><p>å¹¿æ’­åªèƒ½åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨è¿›è¡Œä¼ é€’ï¼Œå¹¶ä¸”å¹¿æ’­æ¥æ”¶å™¨ä¹Ÿåªèƒ½æ¥æ”¶åˆ°æ¥è‡ªæœ¬åº”ç”¨ç¨‹åºå‘å‡ºçš„å¹¿æ’­ã€‚<br>è¿™ä¸ªæ–¹æ³•æ¯”å…¨å±€å¹¿æ’­æ›´é«˜æ•ˆï¼ˆä¸éœ€è¦Interprocess communicationï¼ŒIPCï¼‰ï¼Œè€Œä¸”ä¸éœ€è¦æ‹…å¿ƒå…¶å®ƒAppä¼šæ”¶åˆ°ä½ çš„å¹¿æ’­ä»¥åŠå…¶ä»–å®‰å…¨é—®é¢˜ã€‚</p><h2 id="å¹¿æ’­ä¸æƒé™"><a href="#å¹¿æ’­ä¸æƒé™" class="headerlink" title="å¹¿æ’­ä¸æƒé™"></a>å¹¿æ’­ä¸æƒé™</h2><h3 id="å‘é€å¸¦ç€æƒé™çš„å¹¿æ’­"><a href="#å‘é€å¸¦ç€æƒé™çš„å¹¿æ’­" class="headerlink" title="å‘é€å¸¦ç€æƒé™çš„å¹¿æ’­"></a>å‘é€å¸¦ç€æƒé™çš„å¹¿æ’­</h3><p>å½“ä½ è°ƒç”¨<code>sendBroadcast(Intent, String)</code>æˆ–<code>sendOrderedBroadcast(Intent, String, BroadcastReceiver, Handler, int, String, Bundle)</code>æ—¶ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªæƒé™ã€‚<br>æ¥æ”¶å™¨åœ¨manifestä¸­ç”³è¯·äº†ç›¸åº”æƒé™æ—¶æ‰èƒ½æ”¶åˆ°è¿™ä¸ªå¹¿æ’­ã€‚</p><p>ä¾‹å¦‚å‘é€ä¸€ä¸ªå¸¦ç€æƒé™çš„å¹¿æ’­<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">sendBroadcast(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(<span class="hljs-string">&quot;com.example.NOTIFY&quot;</span>),<br>              Manifest.permission.SEND_SMS);<br></code></pre></td></tr></table></figure></p><p>æ¥æ”¶å¹¿æ’­çš„appå¿…é¡»æ³¨å†Œç›¸åº”çš„æƒé™<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.SEND_SMS&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure></p><p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰<a href="https://developer.android.com/guide/topics/manifest/permission-element.html">permission</a>ã€‚åœ¨manifestä¸­ä½¿ç”¨permissionæ ‡ç­¾<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;custom_permission&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure><br>æ·»åŠ åç¼–è¯‘ä¸€ä¸‹ã€‚å³å¯è°ƒç”¨<code>Manifest.permission.custom_permission</code></p><h3 id="æ¥æ”¶å¸¦æƒé™çš„å¹¿æ’­"><a href="#æ¥æ”¶å¸¦æƒé™çš„å¹¿æ’­" class="headerlink" title="æ¥æ”¶å¸¦æƒé™çš„å¹¿æ’­"></a>æ¥æ”¶å¸¦æƒé™çš„å¹¿æ’­</h3><p>è‹¥æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨æ—¶ç”³æ˜äº†æƒé™ï¼Œé‚£ä¹ˆåªä¼šæ¥æ”¶åˆ°å¸¦ç€ç›¸åº”æƒé™çš„å¹¿æ’­ã€‚</p><p>åœ¨é…ç½®æ–‡ä»¶ä¸­å£°æ˜æƒé™ï¼Œç¨‹åºæ‰èƒ½è®¿é—®ä¸€äº›å…³é”®ä¿¡æ¯ã€‚<br>ä¾‹å¦‚å…è®¸æŸ¥è¯¢ç³»ç»Ÿç½‘ç»œçŠ¶æ€ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span>/&gt;</span><br><br><span class="hljs-comment">&lt;!-- æœºå™¨å¼€æœºå¹¿æ’­ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;android.permission.BOOT_COMPLETED&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><br>å¦‚æœæ²¡æœ‰ç”³è¯·æƒé™ï¼Œç¨‹åºå¯èƒ½ä¼šæ„å¤–å…³é—­ã€‚</p><h2 id="ç¤ºä¾‹-ä½¿ç”¨æ ‡å‡†å¹¿æ’­ï¼Œæœ¬åœ°å¹¿æ’­ï¼Œå¸¦æƒé™çš„å¹¿æ’­ï¼Œæœ‰åºå¹¿æ’­"><a href="#ç¤ºä¾‹-ä½¿ç”¨æ ‡å‡†å¹¿æ’­ï¼Œæœ¬åœ°å¹¿æ’­ï¼Œå¸¦æƒé™çš„å¹¿æ’­ï¼Œæœ‰åºå¹¿æ’­" class="headerlink" title="ç¤ºä¾‹ - ä½¿ç”¨æ ‡å‡†å¹¿æ’­ï¼Œæœ¬åœ°å¹¿æ’­ï¼Œå¸¦æƒé™çš„å¹¿æ’­ï¼Œæœ‰åºå¹¿æ’­"></a>ç¤ºä¾‹ - ä½¿ç”¨æ ‡å‡†å¹¿æ’­ï¼Œæœ¬åœ°å¹¿æ’­ï¼Œå¸¦æƒé™çš„å¹¿æ’­ï¼Œæœ‰åºå¹¿æ’­</h2><p>å‘é€å’Œæ¥æ”¶å¹¿æ’­ã€‚åˆ†ä¸ºå‘é€å’Œæ¥æ”¶æ–¹2ä¸ªAppã€‚</p><p>ä½¿ç”¨å¸¦æƒé™çš„å¹¿æ’­ã€‚ç³»ç»Ÿæƒé™ä¸è‡ªå®šä¹‰æƒé™ã€‚<br>ä½¿ç”¨æƒé™éœ€è¦åœ¨AndroidManifest.xmlä¸­å£°æ˜ã€‚å¦‚æœæ˜¯è‡ªå®šä¹‰æƒé™ï¼Œéœ€è¦å…ˆæ·»åŠ è‡ªå®šä¹‰æƒé™ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- è‡ªå®šä¹‰çš„æƒé™  ç»™å¹¿æ’­ç”¨ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;com.rust.permission_rust_1&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;com.rust.permission_rust_1&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure></p><p>å‘é€å¹¿æ’­æ—¶å¸¦ä¸Šæƒé™å£°æ˜ã€‚æ¥æ”¶æ–¹ï¼ˆä¸è®ºæ˜¯å¦å·±æ–¹Appï¼‰éœ€è¦åœ¨<code>AndroidManifest.xml</code>ä¸­ç”³è¯·æƒé™ã€‚<br>æ³¨å†Œæ¥æ”¶å™¨æ—¶ä¹Ÿéœ€è¦å£°æ˜æƒé™ã€‚</p><p>å‘é€ä¸å¸¦æƒé™çš„æœ‰åºå¹¿æ’­<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendStandardOrderBroadcast</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(MSG_PHONE);<br>    sendOrderedBroadcast(intent, <span class="hljs-literal">null</span>);<br>    Log.d(TAG, <span class="hljs-string">&quot;[App1] å‘é€ä¸å¸¦æƒé™çš„æœ‰åºå¹¿æ’­, &quot;</span> + intent.getAction());<br>&#125;<br></code></pre></td></tr></table></figure></p><p>å‘é€æ–¹App1ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;rustApp&quot;</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">MSG_PHONE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;msg_phone&quot;</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PERMISSION_RUST_1</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;com.rust.permission_rust_1&quot;</span>;<br><br>    <span class="hljs-comment">// æ³¨å†Œå¹¿æ’­æ¥æ”¶å™¨</span><br>    registerReceiver(mStandardReceiver1, makeIF());<br>    registerReceiver(mStandardReceiver2, makeIF());<br>    registerReceiver(mStandardReceiver3, makeIF());<br><br>    registerReceiver(mStandardReceiverWithPermission, makeIF(),<br>            Manifest.permission.permission_rust_1, <span class="hljs-literal">null</span>);  <span class="hljs-comment">// å¸¦ä¸Šæƒé™</span><br><br>    LocalBroadcastManager.getInstance(getApplicationContext())<br>            .registerReceiver(mLocalReceiver1, makeIF());<br>    LocalBroadcastManager.getInstance(getApplicationContext())<br>            .registerReceiver(mLocalReceiver2, makeIF());<br>    LocalBroadcastManager.getInstance(getApplicationContext())<br>            .registerReceiver(mLocalReceiver3, makeIF());<br><br>    <span class="hljs-comment">// è§£é™¤æ¥æ”¶å™¨</span><br>    unregisterReceiver(mStandardReceiver1);<br>    unregisterReceiver(mStandardReceiver2);<br>    unregisterReceiver(mStandardReceiver3);<br><br>    unregisterReceiver(mStandardReceiverWithPermission);<br><br>    LocalBroadcastManager.getInstance(getApplicationContext())<br>            .unregisterReceiver(mLocalReceiver1);<br>    LocalBroadcastManager.getInstance(getApplicationContext())<br>            .unregisterReceiver(mLocalReceiver2);<br>    LocalBroadcastManager.getInstance(getApplicationContext())<br>            .unregisterReceiver(mLocalReceiver3);<br><br><br><span class="hljs-comment">// å‘é€æ ‡å‡†å¹¿æ’­</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendStandardBroadcast</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(MSG_PHONE);<br>    sendBroadcast(intent);<br>    Log.d(TAG, <span class="hljs-string">&quot;[App1] Dispatcher å‘é€æ ‡å‡†å¹¿æ’­&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// å‘é€å¸¦æƒé™çš„æ ‡å‡†å¹¿æ’­</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendStandardBroadcastWithPermission</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(MSG_PHONE);<br>    sendBroadcast(intent, PERMISSION_RUST_1);<br>    Log.d(TAG, <span class="hljs-string">&quot;[App1] Dispatcher å‘é€å¸¦æƒé™çš„æ ‡å‡†å¹¿æ’­&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// å‘é€æœ¬åœ°å¹¿æ’­</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sendAppLocalBroadcast</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(MSG_PHONE);<br>    LocalBroadcastManager.getInstance(getApplicationContext()).sendBroadcast(intent);<br>    Log.d(TAG, <span class="hljs-string">&quot;[App1] Dispatcher å‘é€æœ¬åœ°å¹¿æ’­&quot;</span>);<br>&#125;<br><br><span class="hljs-keyword">private</span> IntentFilter <span class="hljs-title function_">makeIF</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">IntentFilter</span> <span class="hljs-variable">intentFilter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntentFilter</span>(MSG_PHONE);<br>    intentFilter.addAction(Intent.ACTION_TIME_TICK);<br>    intentFilter.addAction(Intent.ACTION_TIME_CHANGED);<br>    <span class="hljs-keyword">return</span> intentFilter;<br>&#125;<br><br><span class="hljs-comment">// æ ‡å‡†æ¥æ”¶å™¨  ç”¨contextæ¥æ³¨å†Œ</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">BroadcastReceiver</span> <span class="hljs-variable">mStandardReceiver1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastReceiver</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;[App1] æ ‡å‡†æ¥æ”¶å™¨1 æ”¶åˆ°: &quot;</span> + intent.getAction());<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// æ ‡å‡†æ¥æ”¶å™¨  ç”¨contextæ¥æ³¨å†Œ</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">BroadcastReceiver</span> <span class="hljs-variable">mStandardReceiver2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastReceiver</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;[App1] æ ‡å‡†æ¥æ”¶å™¨2 æ”¶åˆ°: &quot;</span> + intent.getAction());<br>        <span class="hljs-keyword">if</span> (intent.getAction().endsWith(MSG_PHONE)) &#123;<br>            abortBroadcast(); <span class="hljs-comment">// æˆªæ–­æœ‰åºå¹¿æ’­</span><br>            Log.d(TAG, <span class="hljs-string">&quot;[App1] æ ‡å‡†æ¥æ”¶å™¨2æˆªæ–­æœ‰åºå¹¿æ’­ &quot;</span> + intent.getAction());<br>        &#125;<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// æ ‡å‡†æ¥æ”¶å™¨  ç”¨contextæ¥æ³¨å†Œ</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">BroadcastReceiver</span> <span class="hljs-variable">mStandardReceiver3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastReceiver</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;[App1] æ ‡å‡†æ¥æ”¶å™¨3 æ”¶åˆ°: &quot;</span> + intent.getAction());<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// æ³¨å†Œçš„æ—¶å€™ç»™å®ƒå¸¦æƒé™  æ ‡å‡†æ¥æ”¶å™¨</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">BroadcastReceiver</span> <span class="hljs-variable">mStandardReceiverWithPermission</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastReceiver</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;[App1] å¸¦æƒé™çš„æ ‡å‡†æ¥æ”¶å™¨æ”¶åˆ°: &quot;</span> + intent.getAction());<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç”¨LocalBroadcastManageræ¥æ³¨å†Œæˆä¸ºæœ¬åœ°æ¥æ”¶å™¨</span><br><span class="hljs-comment"> * æ”¶ä¸åˆ°æ ‡å‡†å¹¿æ’­ - ä¸è®ºæ˜¯æœ¬appå‘å‡ºçš„è¿˜æ˜¯åˆ«çš„åœ°æ–¹å‘å‡ºæ¥çš„</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">private</span> <span class="hljs-type">BroadcastReceiver</span> <span class="hljs-variable">mLocalReceiver1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastReceiver</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;[App1] æœ¬åœ°æ¥æ”¶å™¨1 æ”¶åˆ°: &quot;</span> + intent.getAction());<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">private</span> <span class="hljs-type">BroadcastReceiver</span> <span class="hljs-variable">mLocalReceiver2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastReceiver</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;[App1] æœ¬åœ°æ¥æ”¶å™¨2 æ”¶åˆ°: &quot;</span> + intent.getAction());<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">private</span> <span class="hljs-type">BroadcastReceiver</span> <span class="hljs-variable">mLocalReceiver3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastReceiver</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> &#123;<br>        Log.d(TAG, <span class="hljs-string">&quot;[App1] æœ¬åœ°æ¥æ”¶å™¨3 æ”¶åˆ°: &quot;</span> + intent.getAction());<br>    &#125;<br>&#125;;<br><br></code></pre></td></tr></table></figure></p><p>æ¥æ”¶æ–¹App2ä»£ç <br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- è‡ªå®šä¹‰çš„æƒé™  ç»™å¹¿æ’­ç”¨ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;com.rust.permission_rust_1&quot;</span> /&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;com.rust.permission_rust_1&quot;</span> /&gt;</span><br></code></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">MSG_PHONE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;msg_phone&quot;</span>;<br>        registerReceiver(mDefaultReceiver, makeIF());<br>        LocalBroadcastManager.getInstance(getApplicationContext())<br>                .registerReceiver(mLocalReceiver, makeIF());<br><br>        unregisterReceiver(mDefaultReceiver);<br>        LocalBroadcastManager.getInstance(getApplicationContext())<br>                .unregisterReceiver(mLocalReceiver);<br><br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">BroadcastReceiver</span> <span class="hljs-variable">mDefaultReceiver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastReceiver</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;[App2] standard receive: &quot;</span> + intent.getAction());<br>        &#125;<br>    &#125;;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">BroadcastReceiver</span> <span class="hljs-variable">mLocalReceiver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastReceiver</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;[App2] local receive: &quot;</span> + intent.getAction());<br>        &#125;<br>    &#125;;<br><br>    <span class="hljs-keyword">private</span> IntentFilter <span class="hljs-title function_">makeIF</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">IntentFilter</span> <span class="hljs-variable">intentFilter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntentFilter</span>(MSG_PHONE);<br>        intentFilter.addAction(Intent.ACTION_TIME_TICK);<br>        intentFilter.addAction(Intent.ACTION_TIME_CHANGED);<br>        <span class="hljs-keyword">return</span> intentFilter;<br>    &#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>LocalBroadcastManager</code>å‘å‡ºçš„æœ¬åœ°å¹¿æ’­ï¼Œå¦ä¸€ä¸ªAppæ˜¯æ¥æ”¶ä¸åˆ°çš„ã€‚<br>è¦æ”¶åˆ°æœ¬åœ°å¹¿æ’­ï¼ŒåŒæ ·éœ€è¦<code>LocalBroadcastManager</code>æ¥æ³¨å†Œæ¥æ”¶å™¨ã€‚</p><p>å¯ä»¥æŠŠæœ¬åœ°å¹¿æ’­çœ‹æˆæ˜¯ä¸€ä¸ªå±€éƒ¨çš„ï¼ŒAppå†…çš„å¹¿æ’­ä½“ç³»ã€‚</p><p>å®éªŒä¸­æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œ<code>Intent.ACTION_TIME_TICK</code>å¹¿æ’­æ˜¯å¯ä»¥æˆªæ–­çš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Android_Broadcast</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android AIDL äº†è§£ä¸ä½¿ç”¨</title>
    <link href="/2015/10/26/Android/Android-AIDL_intro_and_use/"/>
    <url>/2015/10/26/Android/Android-AIDL_intro_and_use/</url>
    
    <content type="html"><![CDATA[<h2 id="AIDLç®€ä»‹"><a href="#AIDLç®€ä»‹" class="headerlink" title="AIDLç®€ä»‹"></a>AIDLç®€ä»‹</h2><p>AIDLï¼ˆAndroid Interface Definition Language, Android æ¥å£å®šä¹‰è¯­è¨€ï¼‰<br>ç”¨äºå®šä¹‰C/Sä½“ç³»ç»“æ„ä¸­Serverç«¯å¯ä»¥æä¾›çš„æœåŠ¡è°ƒç”¨æ¥å£ï¼Œæ¡†æ¶å±‚æä¾›çš„Javaç³»ç»ŸæœåŠ¡æ¥å£å¤§å¤šç”±AIDLè¯­è¨€å®šä¹‰ã€‚<br>Androidæä¾›äº†AIDLå·¥å…·ï¼Œå¯å°†AIDLæ–‡ä»¶ç¼–è¯‘æˆJavaæ–‡ä»¶ã€‚æé«˜æœåŠ¡å¼€å‘çš„æ•ˆç‡</p><p>ç¨‹åºå‘˜å¯ä»¥åˆ©ç”¨AIDLè‡ªå®šä¹‰ç¼–ç¨‹æ¥å£ï¼Œåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å®ç°è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰ã€‚<br>åœ¨Androidå¹³å°ä¸Šï¼Œä¸€ä¸ªè¿›ç¨‹é€šå¸¸ä¸èƒ½è®¿é—®å¦å¤–ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤ï¼ŒAndroidå¹³å°å°†è¿™äº›è·¨è¿›ç¨‹è®¿é—®çš„å¯¹è±¡åˆ†è§£æˆæ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¯†åˆ«çš„ç®€å•å¯¹è±¡ã€‚<br>å¹¶ä¸ºè·¨åº”ç”¨è®¿é—®è€Œç‰¹æ®Šç¼–æ’å’Œæ•´ç†è¿™äº›å¯¹è±¡ã€‚ç”¨äºç¼–æ’å’Œæ•´ç†è¿™äº›å¯¹è±¡çš„ä»£ç ç¼–å†™èµ·æ¥ååˆ†å†—é•¿ï¼Œæ‰€ä»¥Androidçš„AIDLæä¾›äº†ç›¸å…³å·¥å…·æ¥è‡ªåŠ¨ç”Ÿæˆè¿™äº›ä»£ç ã€‚</p><p>å¼€å‘äººå‘˜åªéœ€è¦åœ¨AIDLæ–‡ä»¶ä¸­å®šä¹‰Serverç«¯å¯ä»¥æä¾›çš„æœåŠ¡æ–¹æ³•ï¼ŒAIDLå·¥å…·ä¾¿å¯å°†å…¶è½¬åŒ–ä¸ºJavaæ–‡ä»¶ã€‚è½¬åŒ–åçš„Javaæ–‡ä»¶åŒ…å«C/Sä½“ç³»ç»“æ„çš„ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>æœåŠ¡æ¥å£ ï¼ˆIPowerManagerï¼‰</li><li>æœåŠ¡åœ¨Clientç«¯çš„ä»£ç†ï¼ˆProxyï¼‰</li><li>æœåŠ¡å­˜æ ¹ï¼ˆStubï¼‰</li><li>Binderç±»å‹ä¸IIterfaceç±»å‹çš„è½¬æ¢æ¥å£ï¼ˆasInterface å’Œ asBinder æ–¹æ³•ï¼‰</li><li>æœåŠ¡æ–¹æ³•è¯·æ±‚ç </li></ul><h2 id="AIDLæ„ä¹‰"><a href="#AIDLæ„ä¹‰" class="headerlink" title="AIDLæ„ä¹‰"></a>AIDLæ„ä¹‰</h2><p>AIDLå·¥å…·å»ºç«‹äº†åŸºäºBinderçš„C/Sä½“ç³»ç»“æ„çš„é€šç”¨ç»„ä»¶ï¼›å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºå¼€å‘æœåŠ¡çš„åŠŸèƒ½ï¼Œè€Œä¸éœ€ç†ä¼šå…·ä½“çš„é€šä¿¡ç»“æ„ï¼Œæé«˜æ•ˆç‡ã€‚</p><h2 id="åº”ç”¨ç¤ºä¾‹"><a href="#åº”ç”¨ç¤ºä¾‹" class="headerlink" title="åº”ç”¨ç¤ºä¾‹"></a>åº”ç”¨ç¤ºä¾‹</h2><p>æ ¹æ®ä¸Šæ–‡æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªapkï¼Œä¸€ä¸ªä½œä¸ºæœåŠ¡æä¾›æ–¹ï¼Œä¸€ä¸ªä½œä¸ºAIDLæœåŠ¡è°ƒç”¨æ–¹ã€‚</p><h3 id="AIDLæœåŠ¡æä¾›æ–¹ä»£ç "><a href="#AIDLæœåŠ¡æä¾›æ–¹ä»£ç " class="headerlink" title="AIDLæœåŠ¡æä¾›æ–¹ä»£ç "></a>AIDLæœåŠ¡æä¾›æ–¹ä»£ç </h3><p>é¦–å…ˆæ˜¯AIDLæœåŠ¡æä¾›æ–¹ä¸»è¦æ–‡ä»¶ç›®å½•<br><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">main/aidl/<br>`<span class="hljs-comment">-- com</span><br>    `<span class="hljs-comment">-- rustfisher</span><br>        `<span class="hljs-comment">-- ndkproj</span><br>            `<span class="hljs-comment">-- ITomInterface.aidl // AIDLä»£ç </span><br><br>main/java<br>`<span class="hljs-comment">-- com</span><br>    `<span class="hljs-comment">-- rustfisher</span><br>        |<span class="hljs-comment">-- tom</span><br>        |   `<span class="hljs-comment">-- TomService.java // å¯¹åº”çš„Service</span><br><br>build/<span class="hljs-keyword">generated</span>/source/aidl/<br>`<span class="hljs-comment">-- debug</span><br>    `<span class="hljs-comment">-- com</span><br>        `<span class="hljs-comment">-- rustfisher</span><br>            `<span class="hljs-comment">-- ndkproj</span><br>                `<span class="hljs-comment">-- ITomInterface.java // å·¥ç¨‹ç¼–è¯‘åAIDLç”Ÿæˆçš„Javaæ–‡ä»¶ æä¾›ç»™è°ƒç”¨æ–¹</span><br></code></pre></td></tr></table></figure></p><h4 id="æ–°å»ºAIDLæ–‡ä»¶å¹¶å†™å¥½æ¥å£"><a href="#æ–°å»ºAIDLæ–‡ä»¶å¹¶å†™å¥½æ¥å£" class="headerlink" title="æ–°å»ºAIDLæ–‡ä»¶å¹¶å†™å¥½æ¥å£"></a>æ–°å»ºAIDLæ–‡ä»¶å¹¶å†™å¥½æ¥å£</h4><p>è¿›å…¥æœåŠ¡æ–¹çš„å·¥ç¨‹ï¼Œå³é”®æ–°å»ºAIDLæ–‡ä»¶<code>ITomInterface.aidl</code>ã€‚<br>æ–‡ä»¶ä¼šé»˜è®¤ç”Ÿæˆåœ¨<code>main/aidl/com/rustfisher/ndkproj</code>ä¸‹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// ITomInterface.aidl</span><br><span class="hljs-keyword">package</span> com.rustfisher.ndkproj;<br><br><span class="hljs-comment">// æ–‡ä»¶ååº”è¯¥å’Œæ¥å£åç›¸åŒ</span><br><span class="hljs-comment">// ç¼–å†™å¥½AIDLæ–‡ä»¶åå¯ä»¥å…ˆç¼–è¯‘ä¸€æ¬¡</span><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ITomInterface</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">basicTypes</span><span class="hljs-params">(<span class="hljs-type">int</span> anInt, <span class="hljs-type">long</span> aLong, <span class="hljs-type">boolean</span> aBoolean, <span class="hljs-type">float</span> aFloat,</span><br><span class="hljs-params">            <span class="hljs-type">double</span> aDouble, String aString)</span>;<br>    String <span class="hljs-title function_">helloAIDL</span><span class="hljs-params">(String name)</span>; <span class="hljs-comment">// æ­¤æ¬¡ä½¿ç”¨çš„æ–¹æ³•</span><br>&#125;<br></code></pre></td></tr></table></figure></p><h4 id="ç¼–å†™æœåŠ¡æ–¹çš„æ¥å£å®ç°ä»£ç "><a href="#ç¼–å†™æœåŠ¡æ–¹çš„æ¥å£å®ç°ä»£ç " class="headerlink" title="ç¼–å†™æœåŠ¡æ–¹çš„æ¥å£å®ç°ä»£ç "></a>ç¼–å†™æœåŠ¡æ–¹çš„æ¥å£å®ç°ä»£ç </h4><p>åœ¨<code>com.rustfisher.tom</code>åŒ…å†…åˆ›å»º<code>TomService.java</code>æ–‡ä»¶ï¼›å»ºç«‹å†…éƒ¨ç±»<code>TomServiceImpl</code>å®ç°æ¥å£çš„åŠŸèƒ½<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.rustfisher.ndkproj.ITomInterface;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TomService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Service</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;rustApp&quot;</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TomServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ITomInterface</span>.Stub &#123;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">basicTypes</span><span class="hljs-params">(<span class="hljs-type">int</span> anInt, <span class="hljs-type">long</span> aLong, <span class="hljs-type">boolean</span> aBoolean, <span class="hljs-type">float</span> aFloat, <span class="hljs-type">double</span> aDouble, String aString)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br><br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">helloAIDL</span><span class="hljs-params">(String name)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>            Log.d(TAG, name + <span class="hljs-string">&quot; requires helloAIDL()&quot;</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello &quot;</span> + name + <span class="hljs-string">&quot;, nice to meet you!&quot;</span>;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Nullable</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> IBinder <span class="hljs-title function_">onBind</span><span class="hljs-params">(Intent intent)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TomServiceImpl</span>(); <span class="hljs-comment">// ç»‘å®šæœåŠ¡åˆ™è¿”å› TomServiceImpl å®ä¾‹</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><h4 id="æœåŠ¡æ–¹åœ¨AndroidManifest-xmlæ–‡ä»¶ä¸­é…ç½®"><a href="#æœåŠ¡æ–¹åœ¨AndroidManifest-xmlæ–‡ä»¶ä¸­é…ç½®" class="headerlink" title="æœåŠ¡æ–¹åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­é…ç½®"></a>æœåŠ¡æ–¹åœ¨<code>AndroidManifest.xml</code>æ–‡ä»¶ä¸­é…ç½®</h4><p>å®ç°äº†<code>TomService</code>ç±»åï¼Œå¯¹æ­¤AIDLæœåŠ¡è¿›è¡Œé…ç½®ï¼›åœ¨<code>AndroidManifest.xml</code>æ–‡ä»¶ä¸­é…ç½®<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">service</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;com.rustfisher.tom.TomService&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">intent-filter</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">action</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">&quot;com.rustfisher.ndkproj.ITomInterface&quot;</span> /&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">intent-filter</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span><br></code></pre></td></tr></table></figure><br>actioné‡Œé¢å†™ä¸ŠAIDLæ–‡ä»¶</p><h4 id="å®‰è£…è¿è¡Œæ­¤apkåˆ°æ‰‹æœºä¸Š"><a href="#å®‰è£…è¿è¡Œæ­¤apkåˆ°æ‰‹æœºä¸Š" class="headerlink" title="å®‰è£…è¿è¡Œæ­¤apkåˆ°æ‰‹æœºä¸Š"></a>å®‰è£…è¿è¡Œæ­¤apkåˆ°æ‰‹æœºä¸Š</h4><p>è®©æœåŠ¡æ–¹è¿è¡Œèµ·æ¥</p><h3 id="AIDLè°ƒç”¨æ–¹ä»£ç ï¼ˆå®¢æˆ·ç«¯ï¼‰"><a href="#AIDLè°ƒç”¨æ–¹ä»£ç ï¼ˆå®¢æˆ·ç«¯ï¼‰" class="headerlink" title="AIDLè°ƒç”¨æ–¹ä»£ç ï¼ˆå®¢æˆ·ç«¯ï¼‰"></a>AIDLè°ƒç”¨æ–¹ä»£ç ï¼ˆå®¢æˆ·ç«¯ï¼‰</h3><p>å»ºç«‹ï¼ˆæˆ–è¿›å…¥ï¼‰AIDLè°ƒç”¨æ–¹çš„å·¥ç¨‹ï¼Œè¿™é‡Œæ˜¯aidlcallerå·¥ç¨‹ã€‚</p><p>ä¸»è¦æ–‡ä»¶ç›®å½•<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ada">java/<br>`<span class="hljs-comment">-- com</span><br>    |<span class="hljs-comment">-- rust</span><br>    |   `<span class="hljs-comment">-- aidlcaller</span><br>    |       `<span class="hljs-comment">-- MainActivity.java // æ¼”ç¤ºç”¨çš„</span><br>    `<span class="hljs-comment">-- rustfisher</span><br>        `<span class="hljs-comment">-- ndkproj // è¿™ä¸ªè·¯å¾„å°½é‡ä¿æŒä¸æœåŠ¡æä¾›æ–¹é‚£é‡Œçš„ä¸€è‡´</span><br>            `<span class="hljs-comment">-- ITomInterface.java // ä»æœåŠ¡æ–¹é‚£é‡Œcopyæ¥çš„</span><br></code></pre></td></tr></table></figure></p><p>æœ‰å¦‚ä¸‹3ä¸ªæ­¥éª¤ï¼š</p><ul><li>1.å°†AIDLæœåŠ¡ç«¯ç”Ÿæˆçš„Javaæ–‡ä»¶å¤åˆ¶åˆ°è°ƒç”¨æ–¹å·¥ç¨‹é‡Œï¼Œå°½é‡ä¿æŒè¿™ä¸ªJavaæ–‡ä»¶çš„è·¯å¾„ä¸æœåŠ¡ç«¯çš„ä¸€è‡´ï¼Œä¾¿äºè¯†åˆ«</li><li>2.å†™ä»£ç ç»‘å®šæœåŠ¡ï¼Œè·å–AIDLæœåŠ¡å¯¹è±¡</li><li>3.é€šè¿‡AIDLæœåŠ¡å¯¹è±¡å®ŒæˆAIDLæ¥å£è°ƒç”¨</li></ul><p>ç¼–å†™è°ƒç”¨æ–¹<code>MainActivity.java</code>ä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.rustfisher.ndkproj.ITomInterface;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;rustApp&quot;</span>;<br>    ITomInterface mTomService; <span class="hljs-comment">// AIDL æœåŠ¡</span><br>    TextView mTv1;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">ServiceConnection</span> <span class="hljs-variable">serviceConnection</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceConnection</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceConnected</span><span class="hljs-params">(ComponentName name, IBinder service)</span> &#123;<br>            mTomService = ITomInterface.Stub.asInterface(service);<span class="hljs-comment">// è·å–æœåŠ¡å¯¹è±¡</span><br>            mTv1.setClickable(<span class="hljs-literal">true</span>); <span class="hljs-comment">// éœ€è¦ç­‰æœåŠ¡ç»‘å®šå¥½  å†å…è®¸ç‚¹å‡»</span><br>            Log.d(TAG, <span class="hljs-string">&quot;[aidlcaller] onServiceConnected&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onServiceDisconnected</span><span class="hljs-params">(ComponentName name)</span> &#123;<br>            Log.d(TAG, <span class="hljs-string">&quot;onServiceDisconnected &quot;</span> + name);<br>        &#125;<br>    &#125;;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> &#123;<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br>        initAIDLService();<br>        initUI();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initUI</span><span class="hljs-params">()</span> &#123;<br>        mTv1 = (TextView) findViewById(R.id.tv1);<br>        mTv1.setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-type">String</span> <span class="hljs-variable">hello</span> <span class="hljs-operator">=</span> mTomService.helloAIDL(<span class="hljs-string">&quot;Jerry&quot;</span>);<br>                    Log.d(TAG, hello);<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    Log.e(TAG, <span class="hljs-string">&quot;mTomService initAIDLService: Fail &quot;</span>, e);<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initAIDLService</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">// è¿™ä¸ªæ˜¯æœåŠ¡æä¾›æ–¹çš„AndroidManifest action</span><br>        <span class="hljs-type">Intent</span> <span class="hljs-variable">intent</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intent</span>(<span class="hljs-string">&quot;com.rustfisher.ndkproj.ITomInterface&quot;</span>);<br>        intent.setPackage(<span class="hljs-string">&quot;com.rustfisher.ndkproj&quot;</span>); <span class="hljs-comment">// æœåŠ¡æä¾›è€…çš„åŒ…å</span><br>        bindService(intent, serviceConnection, Context.BIND_AUTO_CREATE);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></p><h4 id="æµ‹è¯•å’Œæ•ˆæœ"><a href="#æµ‹è¯•å’Œæ•ˆæœ" class="headerlink" title="æµ‹è¯•å’Œæ•ˆæœ"></a>æµ‹è¯•å’Œæ•ˆæœ</h4><p>ç‚¹å‡»è°ƒç”¨ç«¯çš„Viewï¼Œæ‰“å‡ºlog <code>Hello Jerry, nice to meet you!</code><br>æœåŠ¡ç«¯apkæ‰“å°logï¼š<code>Jerry requires helloAIDL()</code></p><p>å¦‚æœè°ƒç”¨å¤±è´¥åˆ™æŠ›å‡º <code>android.os.DeadObjectException</code></p><p>å½“æœåŠ¡æä¾›æ–¹Appæ²¡æœ‰åœ¨è¿è¡Œæ—¶ï¼Œè°ƒç”¨æ–¹å»è¯·æ±‚æœåŠ¡ä¼šå¤±è´¥ã€‚</p><p>æœåŠ¡ç«¯æ›´æ–°åï¼Œå¦‚æœaidlæ–‡ä»¶æ²¡æ”¹åŠ¨ï¼Œä¸éœ€è¦æ›´æ–°ç”Ÿæˆçš„Javaæ–‡ä»¶<br>å¦‚æœæœåŠ¡ç«¯apkè¢«å¸è½½ï¼Œè°ƒç”¨ç«¯ä½¿ç”¨æ­¤æœåŠ¡æ—¶ä¼šå‡ºé”™</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><p><a href="https://rustfisher.com/2019/08/08/Android/Android-Binder_mechanism_intro/">Android Binder æœºåˆ¶ä»‹ç»</a></p>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>AIDL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android NDK ä½¿ç”¨.a</title>
    <link href="/2015/10/26/Android/NDK-compile_import_a_file/"/>
    <url>/2015/10/26/Android/NDK-compile_import_a_file/</url>
    
    <content type="html"><![CDATA[<h2 id="Android-NDK-ä½¿ç”¨-a"><a href="#Android-NDK-ä½¿ç”¨-a" class="headerlink" title="Android NDK ä½¿ç”¨.a"></a>Android NDK ä½¿ç”¨.a</h2><p>ä¸€ä¸ªç¼–è¯‘æ—¶ä½¿ç”¨.aæ–‡ä»¶çš„ä¾‹å­ã€‚æµç¨‹æ˜¯å‡†å¤‡å¥½åº“æ–‡ä»¶ä»¥åŠå¯¹åº”çš„å¤´æ–‡ä»¶ï¼Œç¼–å†™makefileï¼Œç¼–è¯‘ã€‚</p><h3 id="å‡†å¤‡åº“æ–‡ä»¶ä¸å¤´æ–‡ä»¶"><a href="#å‡†å¤‡åº“æ–‡ä»¶ä¸å¤´æ–‡ä»¶" class="headerlink" title="å‡†å¤‡åº“æ–‡ä»¶ä¸å¤´æ–‡ä»¶"></a>å‡†å¤‡åº“æ–‡ä»¶ä¸å¤´æ–‡ä»¶</h3><p>å…ˆå‡†å¤‡å¤´æ–‡ä»¶å’Œ<code>.a</code>æ–‡ä»¶ã€‚è¿™é‡Œä»¥ncnnç›®å½•ä¸ºä¾‹ã€‚</p><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">|<span class="hljs-string">-- Android.mk</span><br><span class="hljs-string"></span>|<span class="hljs-string">-- Application.mk</span><br><span class="hljs-string"></span>|<span class="hljs-string">-- ncnn</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- include</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- benchmark.h</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- ....h # å¯¹åº”çš„å¤´æ–‡ä»¶</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">-- lib</span><br><span class="hljs-string"></span>|<span class="hljs-string">   </span>|<span class="hljs-string">   `-- libncnn.a</span><br></code></pre></td></tr></table></figure><h3 id="ç¼–å†™makefile"><a href="#ç¼–å†™makefile" class="headerlink" title="ç¼–å†™makefile"></a>ç¼–å†™makefile</h3><p>åœ¨<code>Android.mk</code>ä¸­å£°æ˜åº“æ–‡ä»¶ã€‚<br>è¿™é‡Œæ˜¯å¼•å…¥opencvçš„åº“ã€‚</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs makefile">LOCAL_PATH := <span class="hljs-variable">$(<span class="hljs-built_in">call</span> my-<span class="hljs-built_in">dir</span>)</span><br><br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(CLEAR_VARS)</span><br>LOCAL_MODULE    := ncnn<br>LOCAL_SRC_FILES := ncnn/lib/libncnn.a<br><span class="hljs-keyword">include</span> <span class="hljs-variable">$(PREBUILT_STATIC_LIBRARY)</span><br><br>LOCAL_STATIC_LIBRARIES := ncnn<br><br>OPENCVROOT:=<span class="hljs-variable">$(LOCAL_PATH)</span>/../../../../../../OpenCV-android-sdk<br>OPENCV_CAMERA_MODULES:=off<br>OPENCV_INSTALL_MODULES:=on<br><span class="hljs-comment">#OPENCV_LIB_TYPE:=SHARED</span><br>OPENCV_LIB_TYPE:=STATIC<br><span class="hljs-keyword">include</span> $&#123;OPENCVROOT&#125;/sdk/native/jni/OpenCV.mk<br><br><span class="hljs-comment"># v20 with sse</span><br>LOCAL_SRC_FILES := v20/fdssttracker.cpp v20/fhog.cpp v20/runtracker.cpp \<br>                     jni_eman.cpp \<br>                     ncnn/ssdmobilenet.cpp jni_encnn.cpp<br><br><span class="hljs-comment"># åé¢æ˜¯æ¨¡å—çš„é…ç½®</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œè¦æ³¨æ„ï¼Œå¤´æ–‡ä»¶å’Œ.aæ–‡ä»¶å¿…é¡»æ˜¯å¯¹åº”çš„ã€‚å¦åˆ™ç¼–è¯‘æ—¶ä¼šæŠ¥é”™<code>error: undefined reference to</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">E:/projects/myProj/myProject/f1/src/main/jni/ncnn/lib/libncnn.a(net.cpp.o):net.cpp:<span class="hljs-keyword">function</span> ncnn::Net::load_model(__STDIO_FILE_STRUCT*): error: undefined reference to <span class="hljs-string">&#x27;stderr&#x27;</span><br>E:/projects/myProj/myProject/f1/src/main/jni/ncnn/lib/libncnn.a(net.cpp.o):net.cpp:<span class="hljs-keyword">function</span> ncnn::Net::load_model(char const*): `error: undefined reference to`<br><span class="hljs-string">&#x27;stderr&#x27;</span><br>E:/projects/myProj/myProject/f1/src/main/jni/ncnn/lib/libncnn.a(net.cpp.o):net.cpp:<span class="hljs-keyword">function</span> ncnn::Net::load_model(unsigned char const*): error: undefined reference to <span class="hljs-string">&#x27;stderr&#x27;</span><br>E:/projects/myProj/myProject/f1/src/main/jni/ncnn/lib/libncnn.a(net.cpp.o):net.cpp:<span class="hljs-keyword">function</span> ncnn::Net::find_blob_index_by_name(char const*) const: error: undefined reference to <span class="hljs-string">&#x27;stderr&#x27;</span><br>clang++.exe: error: linker <span class="hljs-built_in">command</span> failed with <span class="hljs-built_in">exit</span> code 1 (use -v to see invocation)<br>make: *** [E:/projects/myProj/myProject/f1/src/main/obj/local/armeabi-v7a/libf1.so] Error 1<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Android_note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>NDK</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
